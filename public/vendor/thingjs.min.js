function SimpleHeatmap(e){this._canvas="string"==typeof e?document.getElementById(e):e,void 0===this._canvas&&(this._canvas=document.createElement("canvas"),this._canvas.width=128,this._canvas.height=128),this._ctx=this._canvas.getContext("2d"),this._max=1,this._min=0,this._dataDirty=!0,this._data=[],this._transformedData=[],this._canvasWidth=this._areaWidth=this._canvas.width,this._canvasHeight=this._areaHeight=this._canvas.height,this._alpha=!1,this._grad={};var t=this._createCanvas();t.width=1,t.height=256,this._gradCtx=t.getContext("2d"),this._gradCache={},this._gradData=null,this._r=0,this._radius=0,this._blur=0,this._circle=this._createCanvas(),this._cirCtx=this._circle.getContext("2d")}function TextEncoderLite(){}function TextDecoderLite(){}!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.THREE={})}(this,function(e){"use strict";function t(){}function r(e,t){this.x=e||0,this.y=t||0}function i(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}function n(e,t,r,i){this._x=e||0,this._y=t||0,this._z=r||0,this._w=void 0!==i?i:1}function o(e,t,r){this.x=e||0,this.y=t||0,this.z=r||0}function a(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}function s(e,t,i,n,o,l,c,u,h,p){Object.defineProperty(this,"id",{value:ls++}),this.uuid=os.generateUUID(),this.name="",this.image=void 0!==e?e:s.DEFAULT_IMAGE,this.mipmaps=[],this.mapping=void 0!==t?t:s.DEFAULT_MAPPING,this.wrapS=void 0!==i?i:Go,this.wrapT=void 0!==n?n:Go,this.magFilter=void 0!==o?o:Jo,this.minFilter=void 0!==l?l:Zo,this.anisotropy=void 0!==h?h:1,this.format=void 0!==c?c:da,this.type=void 0!==u?u:$o,this.offset=new r(0,0),this.repeat=new r(1,1),this.center=new r(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new a,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=void 0!==p?p:Ya,this.version=0,this.onUpdate=null}function l(e,t,r,i){this.x=e||0,this.y=t||0,this.z=r||0,this.w=void 0!==i?i:1}function c(e,t,r){this.width=e,this.height=t,this.scissor=new l(0,0,e,t),this.scissorTest=!1,this.viewport=new l(0,0,e,t),r=r||{},this.texture=new s(void 0,void 0,r.wrapS,r.wrapT,r.magFilter,r.minFilter,r.format,r.type,r.anisotropy,r.encoding),this.texture.generateMipmaps=void 0!==r.generateMipmaps&&r.generateMipmaps,this.texture.minFilter=void 0!==r.minFilter?r.minFilter:Jo,this.depthBuffer=void 0===r.depthBuffer||r.depthBuffer,this.stencilBuffer=void 0===r.stencilBuffer||r.stencilBuffer,this.depthTexture=void 0!==r.depthTexture?r.depthTexture:null}function u(e,t,r){c.call(this,e,t,r),this.activeCubeFace=0,this.activeMipMapLevel=0}function h(e,t,r,i,n,o,a,l,c,u,h,p){s.call(this,null,o,a,l,c,u,i,n,h,p),this.image={data:e,width:t,height:r},this.magFilter=void 0!==c?c:Xo,this.minFilter=void 0!==u?u:Xo,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}function p(e,t){this.min=void 0!==e?e:new o(1/0,1/0,1/0),this.max=void 0!==t?t:new o(-1/0,-1/0,-1/0)}function d(e,t){this.center=void 0!==e?e:new o,this.radius=void 0!==t?t:0}function f(e,t){this.normal=void 0!==e?e:new o(1,0,0),this.constant=void 0!==t?t:0}function m(e,t,r,i,n,o){this.planes=[void 0!==e?e:new f,void 0!==t?t:new f,void 0!==r?r:new f,void 0!==i?i:new f,void 0!==n?n:new f,void 0!==o?o:new f]}function g(e){var t={};for(var r in e){t[r]={};for(var i in e[r]){var n=e[r][i];n&&(n.isColor||n.isMatrix3||n.isMatrix4||n.isVector2||n.isVector3||n.isVector4||n.isTexture)?t[r][i]=n.clone():Array.isArray(n)?t[r][i]=n.slice():t[r][i]=n}}return t}function v(e){for(var t={},r=0;r<e.length;r++){var i=g(e[r]);for(var n in i)t[n]=i[n]}return t}function y(e,t,r){return void 0===t&&void 0===r?this.set(e):this.setRGB(e,t,r)}function E(){function e(n,o){!1!==r&&(i(n,o),t.requestAnimationFrame(e))}var t=null,r=!1,i=null;return{start:function(){!0!==r&&null!==i&&(t.requestAnimationFrame(e),r=!0)},stop:function(){r=!1},setAnimationLoop:function(e){i=e},setContext:function(e){t=e}}}function b(e){var t=new WeakMap;return{get:function(e){return e.isInterleavedBufferAttribute&&(e=e.data),t.get(e)},remove:function(r){r.isInterleavedBufferAttribute&&(r=r.data);var i=t.get(r);i&&(e.deleteBuffer(i.buffer),t.delete(r))},update:function(r,i){r.isInterleavedBufferAttribute&&(r=r.data);var n=t.get(r);void 0===n?t.set(r,function(t,r){var i=t.array,n=t.dynamic?35048:35044,o=e.createBuffer();e.bindBuffer(r,o),e.bufferData(r,i,n),t.onUploadCallback();var a=5126;return i instanceof Float32Array?a=5126:i instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):i instanceof Uint16Array?a=5123:i instanceof Int16Array?a=5122:i instanceof Uint32Array?a=5125:i instanceof Int32Array?a=5124:i instanceof Int8Array?a=5120:i instanceof Uint8Array&&(a=5121),{buffer:o,type:a,bytesPerElement:i.BYTES_PER_ELEMENT,version:t.version}}(r,i)):n.version<r.version&&(function(t,r,i){var n=r.array,o=r.updateRange;e.bindBuffer(i,t),!1===r.dynamic?e.bufferData(i,n,35044):-1===o.count?e.bufferSubData(i,0,n):0===o.count?console.error("THREE.WebGLObjects.updateBuffer: dynamic THREE.BufferAttribute marked as needsUpdate but updateRange.count is 0, ensure you are using set methods or updating manually."):(e.bufferSubData(i,o.offset*n.BYTES_PER_ELEMENT,n.subarray(o.offset,o.offset+o.count)),o.count=-1)}(n.buffer,r,i),n.version=r.version)}}}function x(e,t,r,i,n,a){this.a=e,this.b=t,this.c=r,this.normal=i&&i.isVector3?i:new o,this.vertexNormals=Array.isArray(i)?i:[],this.color=n&&n.isColor?n:new y,this.vertexColors=Array.isArray(n)?n:[],this.materialIndex=void 0!==a?a:0}function _(e,t,r,i){this._x=e||0,this._y=t||0,this._z=r||0,this._order=i||_.DefaultOrder}function w(){this.mask=1}function T(){Object.defineProperty(this,"id",{value:fs++}),this.uuid=os.generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=T.DefaultUp.clone();var e=new o,t=new _,r=new n,s=new o(1,1,1);t.onChange(function(){r.setFromEuler(t,!1)}),r.onChange(function(){t.setFromQuaternion(r,void 0,!1)}),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:r},scale:{configurable:!0,enumerable:!0,value:s},modelViewMatrix:{value:new i},normalMatrix:{value:new a}}),this.matrix=new i,this.matrixWorld=new i,this.matrixAutoUpdate=T.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new w,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.userData={},void 0!==THREE.MsgCenter&&this.isRenderableObject()&&THREE.MsgCenter.dispatchEvent({type:"obj_created",obj:this})}function M(){Object.defineProperty(this,"id",{value:ms+=2}),this.uuid=os.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.elementsNeedUpdate=!1,this.verticesNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1}function R(e,t,r){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=e,this.itemSize=t,this.count=void 0!==e?e.length/t:0,this.normalized=!0===r,this.dynamic=!1,this.updateRange={offset:0,count:-1},this.version=0}function S(e,t,r){R.call(this,new Int8Array(e),t,r)}function P(e,t,r){R.call(this,new Uint8Array(e),t,r)}function A(e,t,r){R.call(this,new Uint8ClampedArray(e),t,r)}function C(e,t,r){R.call(this,new Int16Array(e),t,r)}function L(e,t,r){R.call(this,new Uint16Array(e),t,r)}function O(e,t,r){R.call(this,new Int32Array(e),t,r)}function H(e,t,r){R.call(this,new Uint32Array(e),t,r)}function F(e,t,r){R.call(this,new Float32Array(e),t,r)}function I(e,t,r){R.call(this,new Float64Array(e),t,r)}function k(){this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1}function D(e){if(0===e.length)return-1/0;for(var t=e[0],r=1,i=e.length;r<i;++r)e[r]>t&&(t=e[r]);return t}function N(){Object.defineProperty(this,"id",{value:gs+=2}),this.uuid=os.generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}function j(e,t,r,i,n,o){M.call(this),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:r,widthSegments:i,heightSegments:n,depthSegments:o},this.fromBufferGeometry(new U(e,t,r,i,n,o)),this.mergeVertices()}function U(e,t,r,i,n,a){function s(e,t,r,i,n,a,s,m,g,v,y){var E,b,x=a/g,_=s/v,w=a/2,T=s/2,M=m/2,R=g+1,S=v+1,P=0,A=0,C=new o;for(b=0;b<S;b++){var L=b*_-T;for(E=0;E<R;E++){var O=E*x-w;C[e]=O*i,C[t]=L*n,C[r]=M,u.push(C.x,C.y,C.z),C[e]=0,C[t]=0,C[r]=m>0?1:-1,h.push(C.x,C.y,C.z),p.push(E/g),p.push(1-b/v),P+=1}}for(b=0;b<v;b++)for(E=0;E<g;E++){var H=d+E+R*b,F=d+E+R*(b+1),I=d+(E+1)+R*(b+1),k=d+(E+1)+R*b;c.push(H,F,k),c.push(F,I,k),A+=6}l.addGroup(f,A,y),f+=A,d+=P}N.call(this),this.type="BoxBufferGeometry",this.parameters={width:e,height:t,depth:r,widthSegments:i,heightSegments:n,depthSegments:a};var l=this;e=e||1,t=t||1,r=r||1,i=Math.floor(i)||1,n=Math.floor(n)||1;var c=[],u=[],h=[],p=[],d=0,f=0;s("z","y","x",-1,-1,r,t,e,a=Math.floor(a)||1,n,0),s("z","y","x",1,-1,r,t,-e,a,n,1),s("x","z","y",1,1,e,r,t,i,a,2),s("x","z","y",1,-1,e,r,-t,i,a,3),s("x","y","z",1,-1,e,t,r,i,n,4),s("x","y","z",-1,-1,e,t,-r,i,n,5),this.setIndex(c),this.addAttribute("position",new F(u,3)),this.addAttribute("normal",new F(h,3)),this.addAttribute("uv",new F(p,2))}function B(e,t,r,i){M.call(this),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:r,heightSegments:i},this.fromBufferGeometry(new V(e,t,r,i)),this.mergeVertices()}function V(e,t,r,i){N.call(this),this.type="PlaneBufferGeometry",this.parameters={width:e,height:t,widthSegments:r,heightSegments:i};var n,o,a=(e=e||1)/2,s=(t=t||1)/2,l=Math.floor(r)||1,c=Math.floor(i)||1,u=l+1,h=c+1,p=e/l,d=t/c,f=[],m=[],g=[],v=[];for(o=0;o<h;o++){var y=o*d-s;for(n=0;n<u;n++){var E=n*p-a;m.push(E,-y,0),g.push(0,0,1),v.push(n/l),v.push(1-o/c)}}for(o=0;o<c;o++)for(n=0;n<l;n++){var b=n+u*o,x=n+u*(o+1),_=n+1+u*(o+1),w=n+1+u*o;f.push(b,x,w),f.push(x,_,w)}this.setIndex(f),this.addAttribute("position",new F(m,3)),this.addAttribute("normal",new F(g,3)),this.addAttribute("uv",new F(v,2))}function z(){Object.defineProperty(this,"id",{value:vs++}),this.uuid=os.generateUUID(),this.name="",this.type="Material",this.fog=!0,this.lights=!0,this.blending=Zn,this.side=Gn,this.flatShading=!1,this.vertexColors=Yn,this.opacity=1,this.transparent=!1,this.blendSrc=po,this.blendDst=fo,this.blendEquation=io,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=wo,this.depthTest=!0,this.depthWrite=!0,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaTest=0,this.premultipliedAlpha=!1,this.visible=!0,this.userData={},this.needsUpdate=!0}function q(e){z.call(this),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,void 0!==e&&(void 0!==e.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(e))}function G(e,t){this.origin=void 0!==e?e:new o,this.direction=void 0!==t?t:new o}function W(e,t,r){this.a=void 0!==e?e:new o,this.b=void 0!==t?t:new o,this.c=void 0!==r?r:new o}function X(e){z.call(this),this.type="MeshBasicMaterial",this.color=new y(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Po,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.lights=!1,this.setValues(e)}function Y(e,t){T.call(this),this.type="Mesh",this.geometry=void 0!==e?e:new N,this.material=void 0!==t?t:new X({color:16777215*Math.random()}),this.drawMode=Ga,this.updateMorphTargets()}function Q(e,t){return Math.abs(t[1])-Math.abs(e[1])}function J(e,t,r,i,n,o,a,l,c,u){s.call(this,e=void 0!==e?e:[],t=void 0!==t?t:Do,r,i,n,o,a,l,c,u),this.flipY=!1}function K(e,t,r,i){s.call(this,null),this.image={data:e,width:t,height:r,depth:i},this.magFilter=Xo,this.minFilter=Xo,this.generateMipmaps=!1,this.flipY=!1}function Z(){this.seq=[],this.map={}}function $(e,t,r){var i=e[0];if(i<=0||i>0)return e;var n=t*r,o=xs[n];if(void 0===o&&(o=new Float32Array(n),xs[n]=o),0!==t){i.toArray(o,0);for(var a=1,s=0;a!==t;++a)s+=r,e[a].toArray(o,s)}return o}function ee(e,t){if(e.length!==t.length)return!1;for(var r=0,i=e.length;r<i;r++)if(e[r]!==t[r])return!1;return!0}function te(e,t){for(var r=0,i=t.length;r<i;r++)e[r]=t[r]}function re(e,t){var r=_s[t];void 0===r&&(r=new Int32Array(t),_s[t]=r);for(var i=0;i!==t;++i)r[i]=e.allocTextureUnit();return r}function ie(e,t){var r=this.cache;r[0]!==t&&(e.uniform1f(this.addr,t),r[0]=t)}function ne(e,t){var r=this.cache;r[0]!==t&&(e.uniform1i(this.addr,t),r[0]=t)}function oe(e,t){var r=this.cache;if(void 0!==t.x)r[0]===t.x&&r[1]===t.y||(e.uniform2f(this.addr,t.x,t.y),r[0]=t.x,r[1]=t.y);else{if(ee(r,t))return;e.uniform2fv(this.addr,t),te(r,t)}}function ae(e,t){var r=this.cache;if(void 0!==t.x)r[0]===t.x&&r[1]===t.y&&r[2]===t.z||(e.uniform3f(this.addr,t.x,t.y,t.z),r[0]=t.x,r[1]=t.y,r[2]=t.z);else if(void 0!==t.r)r[0]===t.r&&r[1]===t.g&&r[2]===t.b||(e.uniform3f(this.addr,t.r,t.g,t.b),r[0]=t.r,r[1]=t.g,r[2]=t.b);else{if(ee(r,t))return;e.uniform3fv(this.addr,t),te(r,t)}}function se(e,t){var r=this.cache;if(void 0!==t.x)r[0]===t.x&&r[1]===t.y&&r[2]===t.z&&r[3]===t.w||(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),r[0]=t.x,r[1]=t.y,r[2]=t.z,r[3]=t.w);else{if(ee(r,t))return;e.uniform4fv(this.addr,t),te(r,t)}}function le(e,t){var r=this.cache,i=t.elements;if(void 0===i){if(ee(r,t))return;e.uniformMatrix2fv(this.addr,!1,t),te(r,t)}else{if(ee(r,i))return;Ms.set(i),e.uniformMatrix2fv(this.addr,!1,Ms),te(r,i)}}function ce(e,t){var r=this.cache,i=t.elements;if(void 0===i){if(ee(r,t))return;e.uniformMatrix3fv(this.addr,!1,t),te(r,t)}else{if(ee(r,i))return;Ts.set(i),e.uniformMatrix3fv(this.addr,!1,Ts),te(r,i)}}function ue(e,t){var r=this.cache,i=t.elements;if(void 0===i){if(ee(r,t))return;e.uniformMatrix4fv(this.addr,!1,t),te(r,t)}else{if(ee(r,i))return;ws.set(i),e.uniformMatrix4fv(this.addr,!1,ws),te(r,i)}}function he(e,t,r){var i=this.cache,n=r.allocTextureUnit();i[0]!==n&&(e.uniform1i(this.addr,n),i[0]=n),r.setTexture2D(t||ys,n)}function pe(e,t,r){var i=this.cache,n=r.allocTextureUnit();i[0]!==n&&(e.uniform1i(this.addr,n),i[0]=n),r.setTexture3D(t||Es,n)}function de(e,t,r){var i=this.cache,n=r.allocTextureUnit();i[0]!==n&&(e.uniform1i(this.addr,n),i[0]=n),r.setTextureCube(t||bs,n)}function fe(e,t){var r=this.cache;ee(r,t)||(e.uniform2iv(this.addr,t),te(r,t))}function me(e,t){var r=this.cache;ee(r,t)||(e.uniform3iv(this.addr,t),te(r,t))}function ge(e,t){var r=this.cache;ee(r,t)||(e.uniform4iv(this.addr,t),te(r,t))}function ve(e,t){var r=this.cache;ee(r,t)||(e.uniform1fv(this.addr,t),te(r,t))}function ye(e,t){var r=this.cache;ee(r,t)||(e.uniform1iv(this.addr,t),te(r,t))}function Ee(e,t){var r=this.cache,i=$(t,this.size,2);ee(r,i)||(e.uniform2fv(this.addr,i),this.updateCache(i))}function be(e,t){var r=this.cache,i=$(t,this.size,3);ee(r,i)||(e.uniform3fv(this.addr,i),this.updateCache(i))}function xe(e,t){var r=this.cache,i=$(t,this.size,4);ee(r,i)||(e.uniform4fv(this.addr,i),this.updateCache(i))}function _e(e,t){var r=this.cache,i=$(t,this.size,4);ee(r,i)||(e.uniformMatrix2fv(this.addr,!1,i),this.updateCache(i))}function we(e,t){var r=this.cache,i=$(t,this.size,9);ee(r,i)||(e.uniformMatrix3fv(this.addr,!1,i),this.updateCache(i))}function Te(e,t){var r=this.cache,i=$(t,this.size,16);ee(r,i)||(e.uniformMatrix4fv(this.addr,!1,i),this.updateCache(i))}function Me(e,t,r){var i=this.cache,n=t.length,o=re(r,n);!1===ee(i,o)&&(e.uniform1iv(this.addr,o),te(i,o));for(var a=0;a!==n;++a)r.setTexture2D(t[a]||ys,o[a])}function Re(e,t,r){var i=this.cache,n=t.length,o=re(r,n);!1===ee(i,o)&&(e.uniform1iv(this.addr,o),te(i,o));for(var a=0;a!==n;++a)r.setTextureCube(t[a]||bs,o[a])}function Se(e,t,r){this.id=e,this.addr=r,this.cache=[],this.setValue=function(e){switch(e){case 5126:return ie;case 35664:return oe;case 35665:return ae;case 35666:return se;case 35674:return le;case 35675:return ce;case 35676:return ue;case 35678:case 36198:return he;case 35679:return pe;case 35680:return de;case 5124:case 35670:return ne;case 35667:case 35671:return fe;case 35668:case 35672:return me;case 35669:case 35673:return ge}}(t.type)}function Pe(e,t,r){this.id=e,this.addr=r,this.cache=[],this.size=t.size,this.setValue=function(e){switch(e){case 5126:return ve;case 35664:return Ee;case 35665:return be;case 35666:return xe;case 35674:return _e;case 35675:return we;case 35676:return Te;case 35678:return Me;case 35680:return Re;case 5124:case 35670:return ye;case 35667:case 35671:return fe;case 35668:case 35672:return me;case 35669:case 35673:return ge}}(t.type)}function Ae(e){this.id=e,Z.call(this)}function Ce(e,t){e.seq.push(t),e.map[t.id]=t}function Le(e,t,r){var i=e.name,n=i.length;for(Rs.lastIndex=0;;){var o=Rs.exec(i),a=Rs.lastIndex,s=o[1],l="]"===o[2],c=o[3];if(l&&(s|=0),void 0===c||"["===c&&a+2===n){Ce(r,void 0===c?new Se(s,e,t):new Pe(s,e,t));break}var u=r.map[s];void 0===u&&Ce(r,u=new Ae(s)),r=u}}function Oe(e,t,r){Z.call(this),this.renderer=r;for(var i=e.getProgramParameter(t,35718),n=0;n<i;++n){var o=e.getActiveUniform(t,n);Le(o,e.getUniformLocation(t,o.name),this)}}function He(e,t,r){var i=e.createShader(t);return e.shaderSource(i,r),e.compileShader(i),!1===e.getShaderParameter(i,35713)&&console.error("THREE.WebGLShader: Shader couldn't compile."),""!==e.getShaderInfoLog(i)&&console.warn("THREE.WebGLShader: gl.getShaderInfoLog()",35633===t?"vertex":"fragment",e.getShaderInfoLog(i),function(e){for(var t=e.split("\n"),r=0;r<t.length;r++)t[r]=r+1+": "+t[r];return t.join("\n")}(r)),i}function Fe(e){switch(e){case Ya:return["Linear","( value )"];case Qa:return["sRGB","( value )"];case Ka:return["RGBE","( value )"];case Za:return["RGBM","( value, 7.0 )"];case $a:return["RGBM","( value, 16.0 )"];case es:return["RGBD","( value, 256.0 )"];case Ja:return["Gamma","( value, float( GAMMA_FACTOR ) )"];default:throw new Error("unsupported encoding: "+e)}}function Ie(e,t){var r=Fe(t);return"vec4 "+e+"( vec4 value ) { return "+r[0]+"ToLinear"+r[1]+"; }"}function ke(e){return""!==e}function De(e,t){return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights)}function Ne(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}function je(e){return e.replace(/^[ \t]*#include +<([\w\d./]+)>/gm,function(e,t){var r=cs[t];if(void 0===r)throw new Error("Can not resolve #include <"+t+">");return je(r)})}function Ue(e){return e.replace(/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,function(e,t,r,i){for(var n="",o=parseInt(t);o<parseInt(r);o++)n+=i.replace(/\[ i \]/g,"[ "+o+" ]");return n})}function Be(e,t,r,i,n,o,a){var s=e.context,l=i.defines,c=n.vertexShader,u=n.fragmentShader,h="SHADOWMAP_TYPE_BASIC";o.shadowMapType===zn?h="SHADOWMAP_TYPE_PCF":o.shadowMapType===qn&&(h="SHADOWMAP_TYPE_PCF_SOFT");var p="ENVMAP_TYPE_CUBE",d="ENVMAP_MODE_REFLECTION",f="ENVMAP_BLENDING_MULTIPLY";if(o.envMap){switch(i.envMap.mapping){case Do:case No:p="ENVMAP_TYPE_CUBE";break;case Vo:case zo:p="ENVMAP_TYPE_CUBE_UV";break;case jo:case Uo:p="ENVMAP_TYPE_EQUIREC";break;case Bo:p="ENVMAP_TYPE_SPHERE"}switch(i.envMap.mapping){case No:case Uo:d="ENVMAP_MODE_REFRACTION"}switch(i.combine){case Po:f="ENVMAP_BLENDING_MULTIPLY";break;case Ao:f="ENVMAP_BLENDING_MIX";break;case Co:f="ENVMAP_BLENDING_ADD"}}var m,g,v=e.gammaFactor>0?e.gammaFactor:1,y=a.isWebGL2?"":function(e,t,r){return[(e=e||{}).derivatives||t.envMapCubeUV||t.bumpMap||t.normalMap&&!t.objectSpaceNormalMap||t.flatShading?"#extension GL_OES_standard_derivatives : enable":"",(e.fragDepth||t.logarithmicDepthBuffer)&&r.get("EXT_frag_depth")?"#extension GL_EXT_frag_depth : enable":"",e.drawBuffers&&r.get("WEBGL_draw_buffers")?"#extension GL_EXT_draw_buffers : require":"",(e.shaderTextureLOD||t.envMap)&&r.get("EXT_shader_texture_lod")?"#extension GL_EXT_shader_texture_lod : enable":""].filter(ke).join("\n")}(i.extensions,o,t),E=function(e){var t=[];for(var r in e){var i=e[r];!1!==i&&t.push("#define "+r+" "+i)}return t.join("\n")}(l),b=s.createProgram();if(i.isRawShaderMaterial?((m=[E].filter(ke).join("\n")).length>0&&(m+="\n"),(g=[y,E].filter(ke).join("\n")).length>0&&(g+="\n")):(m=["precision "+o.precision+" float;","precision "+o.precision+" int;","#define SHADER_NAME "+n.name,E,o.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+v,"#define MAX_BONES "+o.maxBones,o.useFog&&o.fog?"#define USE_FOG":"",o.useFog&&o.fogExp?"#define FOG_EXP2":"",o.map?"#define USE_MAP":"",o.envMap?"#define USE_ENVMAP":"",o.envMap?"#define "+d:"",o.lightMap?"#define USE_LIGHTMAP":"",o.aoMap?"#define USE_AOMAP":"",o.emissiveMap?"#define USE_EMISSIVEMAP":"",o.bumpMap?"#define USE_BUMPMAP":"",o.normalMap?"#define USE_NORMALMAP":"",o.normalMap&&o.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",o.displacementMap&&o.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",o.specularMap?"#define USE_SPECULARMAP":"",o.roughnessMap?"#define USE_ROUGHNESSMAP":"",o.metalnessMap?"#define USE_METALNESSMAP":"",o.alphaMap?"#define USE_ALPHAMAP":"",o.vertexColors?"#define USE_COLOR":"",o.flatShading?"#define FLAT_SHADED":"",o.skinning?"#define USE_SKINNING":"",o.useVertexTexture?"#define BONE_TEXTURE":"",o.morphTargets?"#define USE_MORPHTARGETS":"",o.morphNormals&&!1===o.flatShading?"#define USE_MORPHNORMALS":"",o.doubleSided?"#define DOUBLE_SIDED":"",o.flipSided?"#define FLIP_SIDED":"",o.shadowMapEnabled?"#define USE_SHADOWMAP":"",o.shadowMapEnabled?"#define "+h:"",o.sizeAttenuation?"#define USE_SIZEATTENUATION":"",o.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",o.logarithmicDepthBuffer&&(a.isWebGL2||t.get("EXT_frag_depth"))?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_COLOR","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(ke).join("\n"),g=[y,"precision "+o.precision+" float;","precision "+o.precision+" int;","#define SHADER_NAME "+n.name,E,o.alphaTest?"#define ALPHATEST "+o.alphaTest+(o.alphaTest%1?"":".0"):"","#define GAMMA_FACTOR "+v,o.useFog&&o.fog?"#define USE_FOG":"",o.useFog&&o.fogExp?"#define FOG_EXP2":"",o.map?"#define USE_MAP":"",o.matcap?"#define USE_MATCAP":"",o.envMap?"#define USE_ENVMAP":"",o.envMap?"#define "+p:"",o.envMap?"#define "+d:"",o.envMap?"#define "+f:"",o.lightMap?"#define USE_LIGHTMAP":"",o.aoMap?"#define USE_AOMAP":"",o.emissiveMap?"#define USE_EMISSIVEMAP":"",o.bumpMap?"#define USE_BUMPMAP":"",o.normalMap?"#define USE_NORMALMAP":"",o.normalMap&&o.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",o.specularMap?"#define USE_SPECULARMAP":"",o.roughnessMap?"#define USE_ROUGHNESSMAP":"",o.metalnessMap?"#define USE_METALNESSMAP":"",o.alphaMap?"#define USE_ALPHAMAP":"",o.vertexColors?"#define USE_COLOR":"",o.gradientMap?"#define USE_GRADIENTMAP":"",o.flatShading?"#define FLAT_SHADED":"",o.doubleSided?"#define DOUBLE_SIDED":"",o.flipSided?"#define FLIP_SIDED":"",o.shadowMapEnabled?"#define USE_SHADOWMAP":"",o.shadowMapEnabled?"#define "+h:"",o.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",o.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",o.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",o.logarithmicDepthBuffer&&(a.isWebGL2||t.get("EXT_frag_depth"))?"#define USE_LOGDEPTHBUF_EXT":"",o.envMap&&(a.isWebGL2||t.get("EXT_shader_texture_lod"))?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;",o.toneMapping!==Lo?"#define TONE_MAPPING":"",o.toneMapping!==Lo?cs.tonemapping_pars_fragment:"",o.toneMapping!==Lo?function(e,t){var r;switch(t){case Oo:r="Linear";break;case Ho:r="Reinhard";break;case Fo:r="Uncharted2";break;case Io:r="OptimizedCineon";break;case ko:r="ACESFilmic";break;default:throw new Error("unsupported toneMapping: "+t)}return"vec3 "+e+"( vec3 color ) { return "+r+"ToneMapping( color ); }"}("toneMapping",o.toneMapping):"",o.dithering?"#define DITHERING":"",o.outputEncoding||o.mapEncoding||o.matcapEncoding||o.envMapEncoding||o.emissiveMapEncoding?cs.encodings_pars_fragment:"",o.mapEncoding?Ie("mapTexelToLinear",o.mapEncoding):"",o.matcapEncoding?Ie("matcapTexelToLinear",o.matcapEncoding):"",o.envMapEncoding?Ie("envMapTexelToLinear",o.envMapEncoding):"",o.emissiveMapEncoding?Ie("emissiveMapTexelToLinear",o.emissiveMapEncoding):"",o.outputEncoding?function(e,t){var r=Fe(t);return"vec4 "+e+"( vec4 value ) { return LinearTo"+r[0]+r[1]+"; }"}("linearToOutputTexel",o.outputEncoding):"",o.depthPacking?"#define DEPTH_PACKING "+i.depthPacking:"","\n"].filter(ke).join("\n")),c=je(c),c=De(c,o),c=Ne(c,o),u=je(u),u=De(u,o),u=Ne(u,o),c=Ue(c),u=Ue(u),a.isWebGL2&&!i.isRawShaderMaterial){var x=!1,_=/^\s*#version\s+300\s+es\s*\n/;i.isShaderMaterial&&null!==c.match(_)&&null!==u.match(_)&&(x=!0,c=c.replace(_,""),u=u.replace(_,"")),m=["#version 300 es\n","#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+m,g=["#version 300 es\n","#define varying in",x?"":"out highp vec4 pc_fragColor;",x?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+g}var w=g+u,T=He(s,35633,m+c),M=He(s,35632,w);s.attachShader(b,T),s.attachShader(b,M),void 0!==i.index0AttributeName?s.bindAttribLocation(b,0,i.index0AttributeName):!0===o.morphTargets&&s.bindAttribLocation(b,0,"position"),s.linkProgram(b);var R=s.getProgramInfoLog(b).trim(),S=s.getShaderInfoLog(T).trim(),P=s.getShaderInfoLog(M).trim(),A=!0,C=!0;!1===s.getProgramParameter(b,35714)?(A=!1,console.error("THREE.WebGLProgram: shader error: ",s.getError(),"35715",s.getProgramParameter(b,35715),"gl.getProgramInfoLog",R,S,P)):""!==R?console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",R):""!==S&&""!==P||(C=!1),C&&(this.diagnostics={runnable:A,material:i,programLog:R,vertexShader:{log:S,prefix:m},fragmentShader:{log:P,prefix:g}}),s.deleteShader(T),s.deleteShader(M);var L;this.getUniforms=function(){return void 0===L&&(L=new Oe(s,b,e)),L};var O;return this.getAttributes=function(){return void 0===O&&(O=function(e,t){for(var r={},i=e.getProgramParameter(t,35721),n=0;n<i;n++){var o=e.getActiveAttrib(t,n).name;r[o]=e.getAttribLocation(t,o)}return r}(s,b)),O},this.destroy=function(){s.deleteProgram(b),this.program=void 0},Object.defineProperties(this,{uniforms:{get:function(){return console.warn("THREE.WebGLProgram: .uniforms is now .getUniforms()."),this.getUniforms()}},attributes:{get:function(){return console.warn("THREE.WebGLProgram: .attributes is now .getAttributes()."),this.getAttributes()}}}),this.name=n.name,this.id=Ss++,this.code=r,this.usedTimes=1,this.program=b,this.vertexShader=T,this.fragmentShader=M,this}function Ve(e,t,r){function i(e,t){var r;return e?e.isTexture?r=e.encoding:e.isWebGLRenderTarget&&(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),r=e.texture.encoding):r=Ya,r===Ya&&t&&(r=Ja),r}var n=[],o={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"phong",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"},a=["precision","supportsVertexTextures","map","mapEncoding","matcap","matcapEncoding","envMap","envMapMode","envMapEncoding","lightMap","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","objectSpaceNormalMap","displacementMap","specularMap","roughnessMap","metalnessMap","gradientMap","alphaMap","combine","vertexColors","fog","useFog","fogExp","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","maxMorphTargets","maxMorphNormals","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","alphaTest","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering"];this.getParameters=function(t,n,a,s,l,c,u){var h=o[t.type],p=u.isSkinnedMesh?function(e){var t=e.skeleton.bones;if(r.floatVertexTextures)return 1024;var i=r.maxVertexUniforms,n=Math.floor((i-20)/4),o=Math.min(n,t.length);return o<t.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+t.length+" bones. This GPU supports "+o+"."),0):o}(u):0,d=r.precision;null!==t.precision&&(d=r.getMaxPrecision(t.precision))!==t.precision&&console.warn("THREE.WebGLProgram.getParameters:",t.precision,"not supported, using",d,"instead.");var f=e.getRenderTarget();return{shaderID:h,precision:d,supportsVertexTextures:r.vertexTextures,outputEncoding:i(f?f.texture:null,e.gammaOutput),map:!!t.map,mapEncoding:i(t.map,e.gammaInput),matcap:!!t.matcap,matcapEncoding:i(t.matcap,e.gammaInput),envMap:!!t.envMap,envMapMode:t.envMap&&t.envMap.mapping,envMapEncoding:i(t.envMap,e.gammaInput),envMapCubeUV:!!t.envMap&&(t.envMap.mapping===Vo||t.envMap.mapping===zo),lightMap:!!t.lightMap,aoMap:!!t.aoMap,emissiveMap:!!t.emissiveMap,emissiveMapEncoding:i(t.emissiveMap,e.gammaInput),bumpMap:!!t.bumpMap,normalMap:!!t.normalMap,objectSpaceNormalMap:t.normalMapType===ns,displacementMap:!!t.displacementMap,roughnessMap:!!t.roughnessMap,metalnessMap:!!t.metalnessMap,specularMap:!!t.specularMap,alphaMap:!!t.alphaMap,gradientMap:!!t.gradientMap,combine:t.combine,vertexColors:t.vertexColors,fog:!!s,useFog:t.fog,fogExp:s&&s.isFogExp2,flatShading:t.flatShading,sizeAttenuation:t.sizeAttenuation,logarithmicDepthBuffer:r.logarithmicDepthBuffer,skinning:t.skinning&&p>0,maxBones:p,useVertexTexture:r.floatVertexTextures,morphTargets:t.morphTargets,morphNormals:t.morphNormals,maxMorphTargets:e.maxMorphTargets,maxMorphNormals:e.maxMorphNormals,numDirLights:n.directional.length,numPointLights:n.point.length,numSpotLights:n.spot.length,numRectAreaLights:n.rectArea.length,numHemiLights:n.hemi.length,numClippingPlanes:l,numClipIntersection:c,dithering:t.dithering,shadowMapEnabled:e.shadowMap.enabled&&u.receiveShadow&&a.length>0,shadowMapType:e.shadowMap.type,toneMapping:e.toneMapping,physicallyCorrectLights:e.physicallyCorrectLights,premultipliedAlpha:t.premultipliedAlpha,alphaTest:t.alphaTest,doubleSided:t.side===Xn,flipSided:t.side===Wn,depthPacking:void 0!==t.depthPacking&&t.depthPacking}},this.getProgramCode=function(t,r){var i=[];if(r.shaderID?i.push(r.shaderID):(i.push(t.fragmentShader),i.push(t.vertexShader)),void 0!==t.defines)for(var n in t.defines)i.push(n),i.push(t.defines[n]);for(var o=0;o<a.length;o++)i.push(r[a[o]]);return i.push(t.onBeforeCompile.toString()),i.push(e.gammaOutput),i.push(e.gammaFactor),i.join()},this.acquireProgram=function(i,o,a,s){for(var l,c=0,u=n.length;c<u;c++){var h=n[c];if(h.code===s){++(l=h).usedTimes;break}}return void 0===l&&(l=new Be(e,t,s,i,o,a,r),n.push(l)),l},this.releaseProgram=function(e){if(0==--e.usedTimes){var t=n.indexOf(e);n[t]=n[n.length-1],n.pop(),e.destroy()}},this.programs=n}function ze(e,t){return e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.program&&t.program&&e.program!==t.program?e.program.id-t.program.id:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function qe(e,t){return e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.material.id!==t.material.id?e.material.id-t.material.id:e.id-t.id}function Ge(){function e(e,i,n,o,a){var s=t[r];return void 0===s?(s={id:e.id,object:e,geometry:i,material:n,program:n.program,renderOrder:e.renderOrder,z:o,group:a},t[r]=s):(s.id=e.id,s.object=e,s.geometry=i,s.material=n,s.program=n.program,s.renderOrder=e.renderOrder,s.z=o,s.group=a),r++,s}var t=[],r=0,i=[],n=[];return{opaque:i,transparent:n,init:function(){r=0,i.length=0,n.length=0},push:function(t,r,o,a,s){var l=e(t,r,o,a,s);(!0===o.transparent?n:i).push(l)},unshift:function(t,r,o,a,s){var l=e(t,r,o,a,s);(!0===o.transparent?n:i).unshift(l)},sort:function(){i.length>1&&i.sort(ze),n.length>1&&n.sort(qe)}}}function We(){var e=new function(){var e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];var i;switch(t.type){case"DirectionalLight":i={direction:new o,color:new y,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new r};break;case"SpotLight":i={position:new o,direction:new o,color:new y,distance:0,coneCos:0,penumbraCos:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new r};break;case"PointLight":i={position:new o,color:new y,distance:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new r,shadowCameraNear:1,shadowCameraFar:1e3};break;case"HemisphereLight":i={direction:new o,skyColor:new y,groundColor:new y};break;case"RectAreaLight":i={color:new y,position:new o,halfWidth:new o,halfHeight:new o}}return e[t.id]=i,i}}},t={id:Ps++,hash:{stateID:-1,directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,shadowsLength:-1},ambient:[0,0,0],directional:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],point:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]},n=new o,a=new i,s=new i;return{setup:function(r,i,o){for(var l=0,c=0,u=0,h=0,p=0,d=0,f=0,m=0,g=o.matrixWorldInverse,v=0,y=r.length;v<y;v++){var E=r[v],b=E.color,x=E.intensity,_=E.distance,w=E.shadow&&E.shadow.map?E.shadow.map.texture:null;if(E.isAmbientLight)l+=b.r*x,c+=b.g*x,u+=b.b*x;else if(E.isDirectionalLight)(M=e.get(E)).color.copy(E.color).multiplyScalar(E.intensity),M.direction.setFromMatrixPosition(E.matrixWorld),n.setFromMatrixPosition(E.target.matrixWorld),M.direction.sub(n),M.direction.transformDirection(g),M.shadow=E.castShadow,E.castShadow&&(T=E.shadow,M.shadowBias=T.bias,M.shadowRadius=T.radius,M.shadowMapSize=T.mapSize),t.directionalShadowMap[h]=w,t.directionalShadowMatrix[h]=E.shadow.matrix,t.directional[h]=M,h++;else if(E.isSpotLight)(M=e.get(E)).position.setFromMatrixPosition(E.matrixWorld),M.position.applyMatrix4(g),M.color.copy(b).multiplyScalar(x),M.distance=_,M.direction.setFromMatrixPosition(E.matrixWorld),n.setFromMatrixPosition(E.target.matrixWorld),M.direction.sub(n),M.direction.transformDirection(g),M.coneCos=Math.cos(E.angle),M.penumbraCos=Math.cos(E.angle*(1-E.penumbra)),M.decay=E.decay,M.shadow=E.castShadow,E.castShadow&&(T=E.shadow,M.shadowBias=T.bias,M.shadowRadius=T.radius,M.shadowMapSize=T.mapSize),t.spotShadowMap[d]=w,t.spotShadowMatrix[d]=E.shadow.matrix,t.spot[d]=M,d++;else if(E.isRectAreaLight)(M=e.get(E)).color.copy(b).multiplyScalar(x),M.position.setFromMatrixPosition(E.matrixWorld),M.position.applyMatrix4(g),s.identity(),a.copy(E.matrixWorld),a.premultiply(g),s.extractRotation(a),M.halfWidth.set(.5*E.width,0,0),M.halfHeight.set(0,.5*E.height,0),M.halfWidth.applyMatrix4(s),M.halfHeight.applyMatrix4(s),t.rectArea[f]=M,f++;else if(E.isPointLight){if((M=e.get(E)).position.setFromMatrixPosition(E.matrixWorld),M.position.applyMatrix4(g),M.color.copy(E.color).multiplyScalar(E.intensity),M.distance=E.distance,M.decay=E.decay,M.shadow=E.castShadow,E.castShadow){var T=E.shadow;M.shadowBias=T.bias,M.shadowRadius=T.radius,M.shadowMapSize=T.mapSize,M.shadowCameraNear=T.camera.near,M.shadowCameraFar=T.camera.far}t.pointShadowMap[p]=w,t.pointShadowMatrix[p]=E.shadow.matrix,t.point[p]=M,p++}else if(E.isHemisphereLight){var M=e.get(E);M.direction.setFromMatrixPosition(E.matrixWorld),M.direction.transformDirection(g),M.direction.normalize(),M.skyColor.copy(E.color).multiplyScalar(x),M.groundColor.copy(E.groundColor).multiplyScalar(x),t.hemi[m]=M,m++}}t.ambient[0]=l,t.ambient[1]=c,t.ambient[2]=u,t.directional.length=h,t.spot.length=d,t.rectArea.length=f,t.point.length=p,t.hemi.length=m,t.hash.stateID=t.id,t.hash.directionalLength=h,t.hash.pointLength=p,t.hash.spotLength=d,t.hash.rectAreaLength=f,t.hash.hemiLength=m,t.hash.shadowsLength=i.length},state:t}}function Xe(){var e=new We,t=[],r=[];return{init:function(){t.length=0,r.length=0},state:{lightsArray:t,shadowsArray:r,lights:e},setupLights:function(i){e.setup(t,r,i)},pushLight:function(e){t.push(e)},pushShadow:function(e){r.push(e)}}}function Ye(e){z.call(this),this.type="MeshDepthMaterial",this.depthPacking=ts,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.setValues(e)}function Qe(e){z.call(this),this.type="MeshDistanceMaterial",this.referencePosition=new o,this.nearDistance=1,this.farDistance=1e3,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.lights=!1,this.setValues(e)}function Je(e,t,n){function a(t,r,i,n,o,a){var s=t.geometry,l=null,c=b,u=t.customDepthMaterial;if(i&&(c=x,u=t.customDistanceMaterial),u)l=u;else{var h=!1;r.morphTargets&&(s&&s.isBufferGeometry?h=s.morphAttributes&&s.morphAttributes.position&&s.morphAttributes.position.length>0:s&&s.isGeometry&&(h=s.morphTargets&&s.morphTargets.length>0)),t.isSkinnedMesh&&!1===r.skinning&&console.warn("THREE.WebGLShadowMap: THREE.SkinnedMesh with material.skinning set to false:",t);var p=t.isSkinnedMesh&&r.skinning,d=0;h&&(d|=v),p&&(d|=y),l=c[d]}if(e.localClippingEnabled&&!0===r.clipShadows&&0!==r.clippingPlanes.length){var f=l.uuid,m=r.uuid,g=_[f];void 0===g&&(g={},_[f]=g);var E=g[m];void 0===E&&(E=l.clone(),g[m]=E),l=E}return l.visible=r.visible,l.wireframe=r.wireframe,l.side=null!=r.shadowSide?r.shadowSide:w[r.side],l.clipShadows=r.clipShadows,l.clippingPlanes=r.clippingPlanes,l.clipIntersection=r.clipIntersection,l.wireframeLinewidth=r.wireframeLinewidth,l.linewidth=r.linewidth,i&&l.isMeshDistanceMaterial&&(l.referencePosition.copy(n),l.nearDistance=o,l.farDistance=a),l}function s(r,i,n,o){if(!1!==r.visible){if(r.layers.test(i.layers)&&(r.isMesh||r.isLine||r.isPoints)&&r.castShadow&&(!r.frustumCulled||u.intersectsObject(r))){r.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,r.matrixWorld);var l=t.update(r),c=r.material;if(Array.isArray(c))for(var h=l.groups,p=0,d=h.length;p<d;p++){var f=h[p],m=c[f.materialIndex];if(m&&m.visible){v=a(r,m,o,g,n.near,n.far);e.renderBufferDirect(n,null,l,v,r,f)}}else if(c.visible){var v=a(r,c,o,g,n.near,n.far);e.renderBufferDirect(n,null,l,v,r,null)}}for(var y=r.children,E=0,b=y.length;E<b;E++)s(y[E],i,n,o)}}for(var u=new m,h=new i,p=new r,d=new r(n,n),f=new o,g=new o,v=1,y=2,E=1+(v|y),b=new Array(E),x=new Array(E),_={},w={0:Wn,1:Gn,2:Xn},T=[new o(1,0,0),new o(-1,0,0),new o(0,0,1),new o(0,0,-1),new o(0,1,0),new o(0,-1,0)],M=[new o(0,1,0),new o(0,1,0),new o(0,1,0),new o(0,1,0),new o(0,0,1),new o(0,0,-1)],R=[new l,new l,new l,new l,new l,new l],S=0;S!==E;++S){var P=0!=(S&v),A=0!=(S&y),C=new Ye({depthPacking:rs,morphTargets:P,skinning:A});b[S]=C;var L=new Qe({morphTargets:P,skinning:A});x[S]=L}var O=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=zn,this.render=function(t,r,i){if(!1!==O.enabled&&(!1!==O.autoUpdate||!1!==O.needsUpdate)&&0!==t.length){e.context;var n=e.state;n.disable(3042),n.buffers.color.setClear(1,1,1,1),n.buffers.depth.setTest(!0),n.setScissorTest(!1);for(var o,a=0,l=t.length;a<l;a++){var m=t[a],v=m.shadow,y=m&&m.isPointLight;if(void 0!==v){var E=v.camera;if(p.copy(v.mapSize),p.min(d),y){var b=p.x,x=p.y;R[0].set(2*b,x,b,x),R[1].set(0,x,b,x),R[2].set(3*b,x,b,x),R[3].set(b,x,b,x),R[4].set(3*b,0,b,x),R[5].set(b,0,b,x),p.x*=4,p.y*=2}if(null===v.map){var _={minFilter:Xo,magFilter:Xo,format:da};v.map=new c(p.x,p.y,_),v.map.texture.name=m.name+".shadowMap",E.updateProjectionMatrix()}v.isSpotLightShadow&&v.update(m);var w=v.map,S=v.matrix;g.setFromMatrixPosition(m.matrixWorld),E.position.copy(g),y?(o=6,S.makeTranslation(-g.x,-g.y,-g.z)):(o=1,f.setFromMatrixPosition(m.target.matrixWorld),E.lookAt(f),E.updateMatrixWorld(),S.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),S.multiply(E.projectionMatrix),S.multiply(E.matrixWorldInverse)),e.setRenderTarget(w),e.clear();for(var P=0;P<o;P++){if(y){f.copy(E.position),f.add(T[P]),E.up.copy(M[P]),E.lookAt(f),E.updateMatrixWorld();var A=R[P];n.viewport(A)}h.multiplyMatrices(E.projectionMatrix,E.matrixWorldInverse),u.setFromMatrix(h),s(r,i,E,y)}}else console.warn("THREE.WebGLShadowMap:",m,"has no shadow.")}O.needsUpdate=!1}}}function Ke(e,t,r,i,n,o,a){function s(e,t){if(e.width>t||e.height>t){if("data"in e)return void console.warn("THREE.WebGLRenderer: image in DataTexture is too big ("+e.width+"x"+e.height+").");var r=t/Math.max(e.width,e.height),i=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");i.width=Math.floor(e.width*r),i.height=Math.floor(e.height*r);return i.getContext("2d").drawImage(e,0,0,e.width,e.height,0,0,i.width,i.height),console.warn("THREE.WebGLRenderer: image is too big ("+e.width+"x"+e.height+"). Resized to "+i.width+"x"+i.height),i}return e}function l(e){return os.isPowerOfTwo(e.width)&&os.isPowerOfTwo(e.height)}function c(e,t){return e.generateMipmaps&&(t||n.isWebGL2)&&e.minFilter!==Xo&&e.minFilter!==Jo}function u(t,r,n,o){e.generateMipmap(t);i.get(r).__maxMipLevel=Math.log(Math.max(n,o))*Math.LOG2E}function h(e,t){if(!n.isWebGL2)return e;if(6403===e){if(5126===t)return 33326;if(5131===t)return 33325;if(5121===t)return 33321}if(6407===e){if(5126===t)return 34837;if(5131===t)return 34843;if(5121===t)return 32849}if(6408===e){if(5126===t)return 34836;if(5131===t)return 34842;if(5121===t)return 32856}if(6402===e){if(5123===t)return 33189;if(5125===t)return 33190;if(5126===t)return 36012}if(34041===e){if(34042===t)return 35056;if(36269===t)return 36013}return e}function p(e){return e===Xo||e===Yo||e===Qo?9728:9729}function d(t){var r=t.target;r.removeEventListener("dispose",d),function(t){var r=i.get(t);if(t.image&&r.__image__webglTextureCube)e.deleteTexture(r.__image__webglTextureCube);else{if(void 0===r.__webglInit)return;e.deleteTexture(r.__webglTexture)}i.remove(t)}(r),r.isVideoTexture&&delete _[r.id],a.memory.textures--}function f(t){var r=t.target;r.removeEventListener("dispose",f),function(t){var r=i.get(t),n=i.get(t.texture);if(!t)return;void 0!==n.__webglTexture&&e.deleteTexture(n.__webglTexture);t.depthTexture&&t.depthTexture.dispose();if(t.isWebGLRenderTargetCube)for(var o=0;o<6;o++)e.deleteFramebuffer(r.__webglFramebuffer[o]),r.__webglDepthbuffer&&e.deleteRenderbuffer(r.__webglDepthbuffer[o]);else e.deleteFramebuffer(r.__webglFramebuffer),r.__webglDepthbuffer&&e.deleteRenderbuffer(r.__webglDepthbuffer);r.__webglSamplingbuffer&&e.deleteRenderbuffer(r.__webglSamplingbuffer);i.remove(t.texture),i.remove(t)}(r),a.memory.textures--}function m(e,t){var n=i.get(e);if(e.isVideoTexture&&function(e){var t=e.id,r=a.render.frame;_[t]!==r&&(_[t]=r,e.update())}(e),e.version>0&&n.__version!==e.version){var o=e.image;if(void 0===o)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined");else{if(!1!==o.complete)return void v(n,e,t);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}r.activeTexture(33984+t),r.bindTexture(3553,n.__webglTexture)}function g(r,a,s){var l;if(s||n.isWebGL2?(e.texParameteri(r,10242,o.convert(a.wrapS)),e.texParameteri(r,10243,o.convert(a.wrapT)),e.texParameteri(r,10240,o.convert(a.magFilter)),e.texParameteri(r,10241,o.convert(a.minFilter))):(e.texParameteri(r,10242,33071),e.texParameteri(r,10243,33071),a.wrapS===Go&&a.wrapT===Go||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),e.texParameteri(r,10240,p(a.magFilter)),e.texParameteri(r,10241,p(a.minFilter)),a.minFilter!==Xo&&a.minFilter!==Jo&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),l=t.get("EXT_texture_filter_anisotropic")){if(a.type===oa&&null===t.get("OES_texture_float_linear"))return;if(a.type===aa&&null===(n.isWebGL2||t.get("OES_texture_half_float_linear")))return;(a.anisotropy>1||i.get(a).__currentAnisotropy)&&(e.texParameterf(r,l.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(a.anisotropy,n.getMaxAnisotropy())),i.get(a).__currentAnisotropy=a.anisotropy)}}function v(t,i,p){var f;f=i.isDataTexture3D?32879:3553,void 0===t.__webglInit&&(t.__webglInit=!0,i.addEventListener("dispose",d),t.__webglTexture=e.createTexture(),a.memory.textures++),r.activeTexture(33984+p),r.bindTexture(f,t.__webglTexture),e.pixelStorei(37440,i.flipY),e.pixelStorei(37441,i.premultiplyAlpha),e.pixelStorei(3317,i.unpackAlignment);var m=s(i.image,n.maxTextureSize);(function(e){return!n.isWebGL2&&(e.wrapS!==Go||e.wrapT!==Go||e.minFilter!==Xo&&e.minFilter!==Jo)})(i)&&!1===l(m)&&(m=function(e){if(e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof ImageBitmap)return void 0===x&&(x=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")),x.width=os.floorPowerOfTwo(e.width),x.height=os.floorPowerOfTwo(e.height),x.getContext("2d").drawImage(e,0,0,x.width,x.height),console.warn("THREE.WebGLRenderer: image is not power of two ("+e.width+"x"+e.height+"). Resized to "+x.width+"x"+x.height),x;return e}(m));var v=l(m),y=o.convert(i.format),E=o.convert(i.type),b=h(y,E);g(f,i,v);var _,w=i.mipmaps;if(i.isDepthTexture){if(!n.isWebGL2){if(b=6402,i.type===oa){if(!n.isWebGL2)throw new Error("Float Depth Texture only supported in WebGL2.0");b=36012}else n.isWebGL2&&(b=33189);i.format===va&&6402===b&&i.type!==ra&&i.type!==na&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),i.type=ra,E=o.convert(i.type)),i.format===ya&&(b=34041,i.type!==ua&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),i.type=ua,E=o.convert(i.type)))}r.texImage2D(3553,0,b,m.width,m.height,0,y,E,null)}else if(i.isDataTexture)if(w.length>0&&v){for(var T=0,M=w.length;T<M;T++)_=w[T],r.texImage2D(3553,T,b,_.width,_.height,0,y,E,_.data);i.generateMipmaps=!1,t.__maxMipLevel=w.length-1}else r.texImage2D(3553,0,b,m.width,m.height,0,y,E,m.data),t.__maxMipLevel=0;else if(i.isCompressedTexture){for(var T=0,M=w.length;T<M;T++)_=w[T],i.format!==da&&i.format!==pa?r.getCompressedTextureFormats().indexOf(y)>-1?r.compressedTexImage2D(3553,T,b,_.width,_.height,0,_.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):r.texImage2D(3553,T,b,_.width,_.height,0,y,E,_.data);t.__maxMipLevel=w.length-1}else if(i.isDataTexture3D)r.texImage3D(32879,0,b,m.width,m.height,m.depth,0,y,E,m.data),t.__maxMipLevel=0;else if(w.length>0&&v){for(var T=0,M=w.length;T<M;T++)_=w[T],r.texImage2D(3553,T,b,y,E,_);i.generateMipmaps=!1,t.__maxMipLevel=w.length-1}else r.texImage2D(3553,0,b,y,E,m),t.__maxMipLevel=0;c(i,v)&&u(3553,i,m.width,m.height),t.__version=i.version,i.onUpdate&&i.onUpdate(i)}function y(t,a,s,l){if(a.multipleSampling>0)if(n.isWebGL2){if(3553===l){var c=i.get(a);return c.__webglSamplingbuffer=e.createRenderbuffer(),e.bindFramebuffer(36160,t),e.bindRenderbuffer(36161,c.__webglSamplingbuffer),e.renderbufferStorageMultisample(36161,Math.min(a.multipleSampling,8),e.RGBA8,a.width,a.height),void e.framebufferRenderbuffer(36160,s,36161,c.__webglSamplingbuffer)}console.warn("CubeRenderTarget not support Multiple Sampling Now!")}else console.warn("WebGL1.0 not support Multiple Sampling!");var u=o.convert(a.texture.format),p=o.convert(a.texture.type),d=h(u,p);r.texImage2D(l,0,d,a.width,a.height,0,u,p,null),e.bindFramebuffer(36160,t),e.framebufferTexture2D(36160,s,l,i.get(a.texture).__webglTexture,0),e.bindFramebuffer(36160,null)}function E(t,r){e.bindRenderbuffer(36161,t),r.depthBuffer&&!r.stencilBuffer?(n.isWebGL2&&r.multipleSampling>0?e.renderbufferStorageMultisample(e.RENDERBUFFER,Math.min(r.multipleSampling,8),e.DEPTH_COMPONENT16,r.width,r.height):e.renderbufferStorage(36161,33189,r.width,r.height),e.framebufferRenderbuffer(36160,36096,36161,t)):r.depthBuffer&&r.stencilBuffer?(n.isWebGL2&&r.multipleSampling>0?e.renderbufferStorageMultisample(e.RENDERBUFFER,Math.min(r.multipleSampling,8),e.DEPTH24_STENCIL8,r.width,r.height):e.renderbufferStorage(36161,34041,r.width,r.height),e.framebufferRenderbuffer(36160,33306,36161,t)):e.renderbufferStorage(36161,32854,r.width,r.height),e.bindRenderbuffer(36161,null)}function b(t){var r=i.get(t),n=!0===t.isWebGLRenderTargetCube;if(t.depthTexture){if(n)throw new Error("target.depthTexture not supported in Cube render targets");!function(t,r){if(r&&r.isWebGLRenderTargetCube)throw new Error("Depth Texture with cube render targets is not supported");if(e.bindFramebuffer(36160,t),!r.depthTexture||!r.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");i.get(r.depthTexture).__webglTexture&&r.depthTexture.image.width===r.width&&r.depthTexture.image.height===r.height||(r.depthTexture.image.width=r.width,r.depthTexture.image.height=r.height,r.depthTexture.needsUpdate=!0),m(r.depthTexture,0);var n=i.get(r.depthTexture).__webglTexture;if(r.depthTexture.format===va)e.framebufferTexture2D(36160,36096,3553,n,0);else{if(r.depthTexture.format!==ya)throw new Error("Unknown depthTexture format");e.framebufferTexture2D(36160,33306,3553,n,0)}}(r.__webglFramebuffer,t)}else if(n){r.__webglDepthbuffer=[];for(var o=0;o<6;o++)e.bindFramebuffer(36160,r.__webglFramebuffer[o]),r.__webglDepthbuffer[o]=e.createRenderbuffer(),E(r.__webglDepthbuffer[o],t)}else e.bindFramebuffer(36160,r.__webglFramebuffer),r.__webglDepthbuffer=e.createRenderbuffer(),E(r.__webglDepthbuffer,t);e.bindFramebuffer(36160,null)}var x,_={};this.setTexture2D=m,this.setTexture3D=function(e,t){var n=i.get(e);e.version>0&&n.__version!==e.version?v(n,e,t):(r.activeTexture(33984+t),r.bindTexture(32879,n.__webglTexture))},this.setTextureCube=function(t,p){var f=i.get(t);if(6===t.image.length)if(t.version>0&&f.__version!==t.version){f.__image__webglTextureCube||(t.addEventListener("dispose",d),f.__image__webglTextureCube=e.createTexture(),a.memory.textures++),r.activeTexture(33984+p),r.bindTexture(34067,f.__image__webglTextureCube),e.pixelStorei(37440,t.flipY);for(var m=t&&t.isCompressedTexture,v=t.image[0]&&t.image[0].isDataTexture,y=[],E=0;E<6;E++)y[E]=m||v?v?t.image[E].image:t.image[E]:s(t.image[E],n.maxCubemapSize);var b=y[0],x=l(b),_=o.convert(t.format),w=o.convert(t.type),T=h(_,w);for(g(34067,t,x),E=0;E<6;E++)if(m)for(var M,R=y[E].mipmaps,S=0,P=R.length;S<P;S++)M=R[S],t.format!==da&&t.format!==pa?r.getCompressedTextureFormats().indexOf(_)>-1?r.compressedTexImage2D(34069+E,S,T,M.width,M.height,0,M.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):r.texImage2D(34069+E,S,T,M.width,M.height,0,_,w,M.data);else v?r.texImage2D(34069+E,0,T,y[E].width,y[E].height,0,_,w,y[E].data):r.texImage2D(34069+E,0,T,_,w,y[E]);f.__maxMipLevel=m?R.length-1:0,c(t,x)&&u(34067,t,b.width,b.height),f.__version=t.version,t.onUpdate&&t.onUpdate(t)}else r.activeTexture(33984+p),r.bindTexture(34067,f.__image__webglTextureCube)},this.setTextureCubeDynamic=function(e,t){r.activeTexture(33984+t),r.bindTexture(34067,i.get(e).__webglTexture)},this.setupRenderTarget=function(t){var n=i.get(t),o=i.get(t.texture);t.addEventListener("dispose",f),o.__webglTexture=e.createTexture(),a.memory.textures++;var s=!0===t.isWebGLRenderTargetCube,h=l(t);if(s)for(n.__webglFramebuffer=[],p=0;p<6;p++)n.__webglFramebuffer[p]=e.createFramebuffer();else n.__webglFramebuffer=e.createFramebuffer();if(s){r.bindTexture(34067,o.__webglTexture),g(34067,t.texture,h);for(var p=0;p<6;p++)y(n.__webglFramebuffer[p],t,36064,34069+p);c(t.texture,h)&&u(34067,t.texture,t.width,t.height),r.bindTexture(34067,null)}else r.bindTexture(3553,o.__webglTexture),g(3553,t.texture,h),y(n.__webglFramebuffer,t,36064,3553),c(t.texture,h)&&u(3553,t.texture,t.width,t.height),r.bindTexture(3553,null);t.depthBuffer&&b(t)},this.updateRenderTargetMipmap=function(e){var t=e.texture;if(c(t,l(e))){var n=e.isWebGLRenderTargetCube?34067:3553,o=i.get(t).__webglTexture;r.bindTexture(n,o),u(n,t,e.width,e.height),r.bindTexture(n,null)}}}function Ze(e,t,r){return{convert:function(e){var i;if(e===qo)return 10497;if(e===Go)return 33071;if(e===Wo)return 33648;if(e===Xo)return 9728;if(e===Yo)return 9984;if(e===Qo)return 9986;if(e===Jo)return 9729;if(e===Ko)return 9985;if(e===Zo)return 9987;if(e===$o)return 5121;if(e===sa)return 32819;if(e===la)return 32820;if(e===ca)return 33635;if(e===ea)return 5120;if(e===ta)return 5122;if(e===ra)return 5123;if(e===ia)return 5124;if(e===na)return 5125;if(e===oa)return 5126;if(e===aa){if(r.isWebGL2)return 5131;if(null!==(i=t.get("OES_texture_half_float")))return i.HALF_FLOAT_OES}if(e===ha)return 6406;if(e===pa)return 6407;if(e===da)return 6408;if(e===fa)return 6409;if(e===ma)return 6410;if(e===va)return 6402;if(e===ya)return 34041;if(e===Ea)return 6403;if(e===io)return 32774;if(e===no)return 32778;if(e===oo)return 32779;if(e===lo)return 0;if(e===co)return 1;if(e===uo)return 768;if(e===ho)return 769;if(e===po)return 770;if(e===fo)return 771;if(e===mo)return 772;if(e===go)return 773;if(e===vo)return 774;if(e===yo)return 775;if(e===Eo)return 776;if((e===ba||e===xa||e===_a||e===wa)&&null!==(i=t.get("WEBGL_compressed_texture_s3tc"))){if(e===ba)return i.COMPRESSED_RGB_S3TC_DXT1_EXT;if(e===xa)return i.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(e===_a)return i.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(e===wa)return i.COMPRESSED_RGBA_S3TC_DXT5_EXT}if((e===Ta||e===Ma||e===Ra||e===Sa)&&null!==(i=t.get("WEBGL_compressed_texture_pvrtc"))){if(e===Ta)return i.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(e===Ma)return i.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(e===Ra)return i.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(e===Sa)return i.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(e===Pa&&null!==(i=t.get("WEBGL_compressed_texture_etc1")))return i.COMPRESSED_RGB_ETC1_WEBGL;if((e===Aa||e===Ca||e===La||e===Oa||e===Ha||e===Fa||e===Ia||e===ka||e===Da||e===Na||e===ja||e===Ua||e===Ba||e===Va)&&null!==(i=t.get("WEBGL_compressed_texture_astc")))return e;if(e===ao||e===so){if(r.isWebGL2){if(e===ao)return 32775;if(e===so)return 32776}if(null!==(i=t.get("EXT_blend_minmax"))){if(e===ao)return i.MIN_EXT;if(e===so)return i.MAX_EXT}}if(e===ua){if(r.isWebGL2)return 34042;if(null!==(i=t.get("WEBGL_depth_texture")))return i.UNSIGNED_INT_24_8_WEBGL}return 0}}}function $e(){T.call(this),this.type="Group"}function et(){T.call(this),this.type="Camera",this.matrixWorldInverse=new i,this.projectionMatrix=new i,this.projectionMatrixInverse=new i}function tt(e,t,r,i){et.call(this),this.type="PerspectiveCamera",this.fov=void 0!==e?e:50,this.zoom=1,this.near=void 0!==r?r:.1,this.far=void 0!==i?i:2e3,this.focus=10,this.aspect=void 0!==t?t:1,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}function rt(e){tt.call(this),this.cameras=e||[]}function it(e,t,r){As.setFromMatrixPosition(t.matrixWorld),Cs.setFromMatrixPosition(r.matrixWorld);var i=As.distanceTo(Cs),n=t.projectionMatrix.elements,o=r.projectionMatrix.elements,a=n[14]/(n[10]-1),s=n[14]/(n[10]+1),l=(n[9]+1)/n[5],c=(n[9]-1)/n[5],u=(n[8]-1)/n[0],h=(o[8]+1)/o[0],p=a*u,d=a*h,f=i/(-u+h),m=f*-u;t.matrixWorld.decompose(e.position,e.quaternion,e.scale),e.translateX(m),e.translateZ(f),e.matrixWorld.compose(e.position,e.quaternion,e.scale),e.matrixWorldInverse.getInverse(e.matrixWorld);var g=a+f,v=s+f,y=p-m,E=d+(i-m),b=l*s/v*g,x=c*s/v*g;e.projectionMatrix.makePerspective(y,E,b,x,g,v)}function nt(e){function t(){return null!==c&&!0===c.isPresenting}function r(){if(t()){var r=c.getEyeParameters("left"),i=r.renderWidth*m,n=r.renderHeight*m;M=e.getPixelRatio(),T=e.getSize(),e.setDrawingBufferSize(2*i,n,1),S.start()}else s.enabled&&e.setDrawingBufferSize(T.width,T.height,M),S.stop()}function a(e){for(var t=navigator.getGamepads&&navigator.getGamepads(),r=0,i=0,n=t.length;r<n;r++){var o=t[r];if(o&&("Daydream Controller"===o.id||"Gear VR Controller"===o.id||"Oculus Go Controller"===o.id||"OpenVR Gamepad"===o.id||o.id.startsWith("Oculus Touch")||o.id.startsWith("Spatial Controller"))){if(i===e)return o;i++}}}var s=this,c=null,u=null,h=null,p=[],d=new i,f=new i,m=1,g="stage";"undefined"!=typeof window&&"VRFrameData"in window&&(u=new window.VRFrameData,window.addEventListener("vrdisplaypresentchange",r,!1));var v=new i,y=new n,b=new o,x=new tt;x.bounds=new l(0,0,.5,1),x.layers.enable(1);var _=new tt;_.bounds=new l(.5,0,.5,1),_.layers.enable(2);var w=new rt([x,_]);w.layers.enable(1),w.layers.enable(2);var T,M,R=[];this.enabled=!1,this.getController=function(e){var t=p[e];return void 0===t&&((t=new $e).matrixAutoUpdate=!1,t.visible=!1,p[e]=t),t},this.getDevice=function(){return c},this.setDevice=function(e){void 0!==e&&(c=e),S.setContext(e)},this.setFramebufferScaleFactor=function(e){m=e},this.setFrameOfReferenceType=function(e){g=e},this.setPoseTarget=function(e){void 0!==e&&(h=e)},this.getCamera=function(e){var t="stage"===g?1.6:0;if(null===c)return e.position.set(0,t,0),e;if(c.depthNear=e.near,c.depthFar=e.far,c.getFrameData(u),"stage"===g){var r=c.stageParameters;r?d.fromArray(r.sittingToStandingTransform):d.makeTranslation(0,t,0)}var i=u.pose,n=null!==h?h:e;if(n.matrix.copy(d),n.matrix.decompose(n.position,n.quaternion,n.scale),null!==i.orientation&&(y.fromArray(i.orientation),n.quaternion.multiply(y)),null!==i.position&&(y.setFromRotationMatrix(d),b.fromArray(i.position),b.applyQuaternion(y),n.position.add(b)),n.updateMatrixWorld(),!1===c.isPresenting)return e;x.near=e.near,_.near=e.near,x.far=e.far,_.far=e.far,x.matrixWorldInverse.fromArray(u.leftViewMatrix),_.matrixWorldInverse.fromArray(u.rightViewMatrix),f.getInverse(d),"stage"===g&&(x.matrixWorldInverse.multiply(f),_.matrixWorldInverse.multiply(f));var o=n.parent;null!==o&&(v.getInverse(o.matrixWorld),x.matrixWorldInverse.multiply(v),_.matrixWorldInverse.multiply(v)),x.matrixWorld.getInverse(x.matrixWorldInverse),_.matrixWorld.getInverse(_.matrixWorldInverse),x.projectionMatrix.fromArray(u.leftProjectionMatrix),_.projectionMatrix.fromArray(u.rightProjectionMatrix),it(w,x,_);var s=c.getLayers();if(s.length){var l=s[0];null!==l.leftBounds&&4===l.leftBounds.length&&x.bounds.fromArray(l.leftBounds),null!==l.rightBounds&&4===l.rightBounds.length&&_.bounds.fromArray(l.rightBounds)}return function(){for(var e=0;e<p.length;e++){var t=p[e],r=a(e);if(void 0!==r&&void 0!==r.pose){if(null===r.pose)return;var i=r.pose;!1===i.hasPosition&&t.position.set(.2,-.6,-.05),null!==i.position&&t.position.fromArray(i.position),null!==i.orientation&&t.quaternion.fromArray(i.orientation),t.matrix.compose(t.position,t.quaternion,t.scale),t.matrix.premultiply(d),t.matrix.decompose(t.position,t.quaternion,t.scale),t.matrixWorldNeedsUpdate=!0,t.visible=!0;var n="Daydream Controller"===r.id?0:1;R[e]!==r.buttons[n].pressed&&(R[e]=r.buttons[n].pressed,!0===R[e]?t.dispatchEvent({type:"selectstart"}):(t.dispatchEvent({type:"selectend"}),t.dispatchEvent({type:"select"})))}else t.visible=!1}}(),w},this.getStandingMatrix=function(){return d},this.isPresenting=t;var S=new E;this.setAnimationLoop=function(e){S.setAnimationLoop(e)},this.submitFrame=function(){t()&&c.submitFrame()},this.dispose=function(){"undefined"!=typeof window&&window.removeEventListener("vrdisplaypresentchange",r)}}function ot(e){function t(){return null===J?le:1}function r(){Ee=new function(e){var t={};return{get:function(r){if(void 0!==t[r])return t[r];var i;switch(r){case"WEBGL_depth_texture":i=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":i=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":i=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":i=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:i=e.getExtension(r)}return null===i&&console.warn("THREE.WebGLRenderer: "+r+" extension not supported."),t[r]=i,i}}}(z),(be=new function(e,t,r){function i(t){if("highp"===t){if(e.getShaderPrecisionFormat(35633,36338).precision>0&&e.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";t="mediump"}return"mediump"===t&&e.getShaderPrecisionFormat(35633,36337).precision>0&&e.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}var n,o="undefined"!=typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext,a=void 0!==r.precision?r.precision:"highp",s=i(a);s!==a&&(console.warn("THREE.WebGLRenderer:",a,"not supported, using",s,"instead."),a=s);var l=!0===r.logarithmicDepthBuffer,c=e.getParameter(34930),u=e.getParameter(35660),h=e.getParameter(3379),p=e.getParameter(34076),d=e.getParameter(34921),f=e.getParameter(36347),m=e.getParameter(36348),g=e.getParameter(36349),v=u>0,y=o||!!t.get("OES_texture_float");return{isWebGL2:o,getMaxAnisotropy:function(){if(void 0!==n)return n;var r=t.get("EXT_texture_filter_anisotropic");return n=null!==r?e.getParameter(r.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0},getMaxPrecision:i,precision:a,logarithmicDepthBuffer:l,maxTextures:c,maxVertexTextures:u,maxTextureSize:h,maxCubemapSize:p,maxAttributes:d,maxVertexUniforms:f,maxVaryings:m,maxFragmentUniforms:g,vertexTextures:v,floatFragmentTextures:y,floatVertexTextures:v&&y}}(z,Ee,e)).isWebGL2||(Ee.get("WEBGL_depth_texture"),Ee.get("OES_texture_float"),Ee.get("OES_texture_half_float"),Ee.get("OES_texture_half_float_linear"),Ee.get("OES_standard_derivatives"),Ee.get("OES_element_index_uint"),Ee.get("ANGLE_instanced_arrays")),Ee.get("OES_texture_float_linear"),ke=new Ze(z,Ee,be),(xe=new function(e,t,r,i){function n(t,r,i){var n=new Uint8Array(4),o=e.createTexture();e.bindTexture(t,o),e.texParameteri(t,10241,9728),e.texParameteri(t,10240,9728);for(var a=0;a<i;a++)e.texImage2D(r+a,0,6408,1,1,0,6408,5121,n);return o}function o(r,n){y[r]=1,0===E[r]&&(e.enableVertexAttribArray(r),E[r]=1),b[r]!==n&&((i.isWebGL2?e:t.get("ANGLE_instanced_arrays"))[i.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](r,n),b[r]=n)}function a(t){!0!==x[t]&&(e.enable(t),x[t]=!0)}function s(t){!1!==x[t]&&(e.disable(t),x[t]=!1)}function c(t,i,n,o,l,c,u,h){if(t!==Kn){if(T||(a(3042),T=!0),t===ro)l=l||i,c=c||n,u=u||o,i===R&&l===A||(e.blendEquationSeparate(r.convert(i),r.convert(l)),R=i,A=l),n===S&&o===P&&c===C&&u===L||(e.blendFuncSeparate(r.convert(n),r.convert(o),r.convert(c),r.convert(u)),S=n,P=o,C=c,L=u),M=t,O=null;else if(t!==M||h!==O){if(R===io&&A===io||(e.blendEquation(32774),R=io,A=io),h)switch(t){case Zn:e.blendFuncSeparate(1,771,1,771);break;case $n:e.blendFunc(1,1);break;case eo:e.blendFuncSeparate(0,0,769,771);break;case to:e.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}else switch(t){case Zn:e.blendFuncSeparate(770,771,1,771);break;case $n:e.blendFunc(770,1);break;case eo:e.blendFunc(0,769);break;case to:e.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}S=null,P=null,C=null,L=null,M=t,O=h}}else T&&(s(3042),T=!1)}function u(t){H!==t&&(t?e.frontFace(2304):e.frontFace(2305),H=t)}function h(t){t!==Un?(a(2884),t!==F&&(t===Bn?e.cullFace(1029):t===Vn?e.cullFace(1028):e.cullFace(1032))):s(2884),F=t}function p(t,r,i){t?(a(32823),k===r&&D===i||(e.polygonOffset(r,i),k=r,D=i)):s(32823)}function d(t){void 0===t&&(t=33984+N-1),V!==t&&(e.activeTexture(t),V=t)}var f=new function(){var t=!1,r=new l,i=null,n=new l(0,0,0,0);return{setMask:function(r){i===r||t||(e.colorMask(r,r,r,r),i=r)},setLocked:function(e){t=e},setClear:function(t,i,o,a,s){!0===s&&(t*=a,i*=a,o*=a),r.set(t,i,o,a),!1===n.equals(r)&&(e.clearColor(t,i,o,a),n.copy(r))},reset:function(){t=!1,i=null,n.set(-1,0,0,0)}}},m=new function(){var t=!1,r=null,i=null,n=null;return{setTest:function(e){e?a(2929):s(2929)},setMask:function(i){r===i||t||(e.depthMask(i),r=i)},setFunc:function(t){if(i!==t){if(t)switch(t){case bo:e.depthFunc(512);break;case xo:e.depthFunc(519);break;case _o:e.depthFunc(513);break;case wo:e.depthFunc(515);break;case To:e.depthFunc(514);break;case Mo:e.depthFunc(518);break;case Ro:e.depthFunc(516);break;case So:e.depthFunc(517);break;default:e.depthFunc(515)}else e.depthFunc(515);i=t}},setLocked:function(e){t=e},setClear:function(t){n!==t&&(e.clearDepth(t),n=t)},reset:function(){t=!1,r=null,i=null,n=null}}},g=new function(){var t=!1,r=null,i=null,n=null,o=null,l=null,c=null,u=null,h=null;return{setTest:function(e){e?a(2960):s(2960)},setMask:function(i){r===i||t||(e.stencilMask(i),r=i)},setFunc:function(t,r,a){i===t&&n===r&&o===a||(e.stencilFunc(t,r,a),i=t,n=r,o=a)},setOp:function(t,r,i){l===t&&c===r&&u===i||(e.stencilOp(t,r,i),l=t,c=r,u=i)},setLocked:function(e){t=e},setClear:function(t){h!==t&&(e.clearStencil(t),h=t)},reset:function(){t=!1,r=null,i=null,n=null,o=null,l=null,c=null,u=null,h=null}}},v=e.getParameter(34921),y=new Uint8Array(v),E=new Uint8Array(v),b=new Uint8Array(v),x={},_=null,w=null,T=null,M=null,R=null,S=null,P=null,A=null,C=null,L=null,O=!1,H=null,F=null,I=null,k=null,D=null,N=e.getParameter(35661),j=!1,U=0,B=e.getParameter(7938);-1!==B.indexOf("WebGL")?(U=parseFloat(/^WebGL\ ([0-9])/.exec(B)[1]),j=U>=1):-1!==B.indexOf("OpenGL ES")&&(U=parseFloat(/^OpenGL\ ES\ ([0-9])/.exec(B)[1]),j=U>=2);var V=null,z={},q=new l,G=new l,W={};return W[3553]=n(3553,3553,1),W[34067]=n(34067,34069,6),f.setClear(0,0,0,1),m.setClear(1),g.setClear(0),a(2929),m.setFunc(wo),u(!1),h(Bn),a(2884),c(Kn),{buffers:{color:f,depth:m,stencil:g},initAttributes:function(){for(var e=0,t=y.length;e<t;e++)y[e]=0},enableAttribute:function(e){o(e,0)},enableAttributeAndDivisor:o,disableUnusedAttributes:function(){for(var t=0,r=E.length;t!==r;++t)E[t]!==y[t]&&(e.disableVertexAttribArray(t),E[t]=0)},enable:a,disable:s,getCompressedTextureFormats:function(){if(null===_&&(_=[],t.get("WEBGL_compressed_texture_pvrtc")||t.get("WEBGL_compressed_texture_s3tc")||t.get("WEBGL_compressed_texture_etc1")||t.get("WEBGL_compressed_texture_astc")))for(var r=e.getParameter(34467),i=0;i<r.length;i++)_.push(r[i]);return _},useProgram:function(t){return w!==t&&(e.useProgram(t),w=t,!0)},setBlending:c,setMaterial:function(e,t){e.side===Xn?s(2884):a(2884);var r=e.side===Wn;t&&(r=!r),u(r),e.blending===Zn&&!1===e.transparent?c(Kn):c(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha,e.premultipliedAlpha),m.setFunc(e.depthFunc),m.setTest(e.depthTest),m.setMask(e.depthWrite),f.setMask(e.colorWrite),p(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits)},setFlipSided:u,setCullFace:h,setLineWidth:function(t){t!==I&&(j&&e.lineWidth(t),I=t)},setPolygonOffset:p,setScissorTest:function(e){e?a(3089):s(3089)},activeTexture:d,bindTexture:function(t,r){null===V&&d();var i=z[V];void 0===i&&(i={type:void 0,texture:void 0},z[V]=i),i.type===t&&i.texture===r||(e.bindTexture(t,r||W[t]),i.type=t,i.texture=r)},compressedTexImage2D:function(){try{e.compressedTexImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage2D:function(){try{e.texImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage3D:function(){try{e.texImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},scissor:function(t){!1===q.equals(t)&&(e.scissor(t.x,t.y,t.z,t.w),q.copy(t))},viewport:function(t){!1===G.equals(t)&&(e.viewport(t.x,t.y,t.z,t.w),G.copy(t))},reset:function(){for(var t=0;t<E.length;t++)1===E[t]&&(e.disableVertexAttribArray(t),E[t]=0);x={},_=null,V=null,z={},w=null,M=null,H=null,F=null,f.reset(),m.reset(),g.reset()}}}(z,Ee,ke,be)).scissor(ie.copy(ue).multiplyScalar(le)),xe.viewport(re.copy(ce).multiplyScalar(le)),_e=new function(e){var t={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:t,programs:null,autoReset:!0,reset:function(){t.frame++,t.calls=0,t.triangles=0,t.points=0,t.lines=0},update:function(e,r,i){switch(i=i||1,t.calls++,r){case 4:t.triangles+=i*(e/3);break;case 5:case 6:t.triangles+=i*(e-2);break;case 1:t.lines+=i*(e/2);break;case 3:t.lines+=i*(e-1);break;case 2:t.lines+=i*e;break;case 0:t.points+=i*e;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",r)}}}}(z),we=new function(){var e=new WeakMap;return{get:function(t){var r=e.get(t);return void 0===r&&(r={},e.set(t,r)),r},remove:function(t){e.delete(t)},update:function(t,r,i){e.get(t)[r]=i},dispose:function(){e=new WeakMap}}},Te=new Ke(z,Ee,xe,we,be,ke,_e),Me=new b(z),Re=new function(e,t,r){function i(e){var a=e.target,s=n[a.id];null!==s.index&&t.remove(s.index);for(var l in s.attributes)t.remove(s.attributes[l]);a.removeEventListener("dispose",i),delete n[a.id];var c=o[s.id];c&&(t.remove(c),delete o[s.id]),r.memory.geometries--}var n={},o={};return{get:function(e,t){var o=n[t.id];return o||(t.addEventListener("dispose",i),t.isBufferGeometry?o=t:t.isGeometry&&(void 0===t._bufferGeometry&&(t._bufferGeometry=(new N).setFromObject(e)),o=t._bufferGeometry),n[t.id]=o,r.memory.geometries++,o)},update:function(e){var r=e.index,i=e.attributes;null!==r&&t.update(r,34963);for(var n in i)t.update(i[n],34962);var o=e.morphAttributes;for(var n in o)for(var a=o[n],s=0,l=a.length;s<l;s++)t.update(a[s],34962)},getWireframeAttribute:function(e){var r=o[e.id];if(r)return r;var i=[],n=e.index,a=e.attributes;if(null!==n)for(var s=0,l=(p=n.array).length;s<l;s+=3){var c=p[s+0],u=p[s+1],h=p[s+2];i.push(c,u,u,h,h,c)}else for(var p=a.position.array,s=0,l=p.length/3-1;s<l;s+=3){var c=s+0,u=s+1,h=s+2;i.push(c,u,u,h,h,c)}return r=new(D(i)>65535?H:L)(i,1),t.update(r,34963),o[e.id]=r,r}}}(z,Me,_e),Se=new function(e,t){var r={};return{update:function(i){var n=t.render.frame,o=i.geometry,a=e.get(i,o);return r[a.id]!==n&&(o.isGeometry&&a.updateFromObject(i),e.update(a),r[a.id]=n),a},dispose:function(){r={}}}}(Re,_e),He=new function(e){var t={},r=new Float32Array(8);return{update:function(i,n,o,a){var s=i.morphTargetInfluences,l=s.length,c=t[n.id];if(void 0===c){for(c=[],p=0;p<l;p++)c[p]=[p,0];t[n.id]=c}for(var u=o.morphTargets&&n.morphAttributes.position,h=o.morphNormals&&n.morphAttributes.normal,p=0;p<l;p++)0!==(d=c[p])[1]&&(u&&n.removeAttribute("morphTarget"+p),h&&n.removeAttribute("morphNormal"+p));for(p=0;p<l;p++)(d=c[p])[0]=p,d[1]=s[p];for(c.sort(Q),p=0;p<8;p++){var d=c[p];if(d){var f=d[0],m=d[1];if(m){u&&n.addAttribute("morphTarget"+p,u[f]),h&&n.addAttribute("morphNormal"+p,h[f]),r[p]=m;continue}}r[p]=0}a.getUniforms().setValue(e,"morphTargetInfluences",r)}}}(z),Pe=new Ve(G,Ee,be),Ae=new function(){var e={};return{get:function(t,r){var i,n=e[t.id];return void 0===n?(i=new Ge,e[t.id]={},e[t.id][r.id]=i):void 0===(i=n[r.id])&&(i=new Ge,n[r.id]=i),i},dispose:function(){e={}}}},Ce=new function(){var e={};return{get:function(t,r){var i;return void 0===e[t.id]?(i=new Xe,e[t.id]={},e[t.id][r.id]=i):void 0===e[t.id][r.id]?(i=new Xe,e[t.id][r.id]=i):i=e[t.id][r.id],i},dispose:function(){e={}}}},Le=new function(e,t,r,i){function n(e,r){t.buffers.color.setClear(e.r,e.g,e.b,r,i)}var o,a,s=new y(0),l=0,c=null,u=0;return{getClearColor:function(){return s},setClearColor:function(e,t){s.set(e),n(s,l=void 0!==t?t:1)},getClearAlpha:function(){return l},setClearAlpha:function(e){n(s,l=e)},render:function(t,i,h,p){var d=i.background;if(null===d?(n(s,l),c=null,u=0):d&&d.isColor&&(n(d,1),p=!0,c=null,u=0),(e.autoClear||p)&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),d&&(d.isCubeTexture||d.isWebGLRenderTargetCube)){void 0===a&&((a=new Y(new U(1,1,1),new q({type:"BackgroundCubeMaterial",uniforms:g(ds.cube.uniforms),vertexShader:ds.cube.vertexShader,fragmentShader:ds.cube.fragmentShader,side:Wn,depthTest:!0,depthWrite:!1,fog:!1}))).geometry.removeAttribute("normal"),a.geometry.removeAttribute("uv"),a.onBeforeRender=function(e,t,r){this.matrixWorld.copyPosition(r.matrixWorld)},Object.defineProperty(a.material,"map",{get:function(){return this.uniforms.tCube.value}}),r.update(a));var f=d.isWebGLRenderTargetCube?d.texture:d;a.material.uniforms.tCube.value=f,a.material.uniforms.tFlip.value=d.isWebGLRenderTargetCube?1:-1,f.colorMatrix?a.material.uniforms.colorMatrix.value.copy(f.colorMatrix):a.material.uniforms.colorMatrix.value.identity(),c===d&&u===f.version||(a.material.needsUpdate=!0,c=d,u=f.version),t.unshift(a,a.geometry,a.material,0,null)}else d&&d.isTexture&&(void 0===o&&((o=new Y(new V(2,2),new q({type:"BackgroundMaterial",uniforms:g(ds.background.uniforms),vertexShader:ds.background.vertexShader,fragmentShader:ds.background.fragmentShader,side:Gn,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.removeAttribute("normal"),Object.defineProperty(o.material,"map",{get:function(){return this.uniforms.t2D.value}}),r.update(o)),o.material.uniforms.t2D.value=d,!0===d.matrixAutoUpdate&&d.updateMatrix(),o.material.uniforms.uvTransform.value.copy(d.matrix),c===d&&u===d.version||(o.material.needsUpdate=!0,c=d,u=d.version),t.unshift(o,o.geometry,o.material,0,null))}}}(G,xe,Se,F),Fe=new function(e,t,r,i){var n;this.setMode=function(e){n=e},this.render=function(t,i){e.drawArrays(n,t,i),r.update(i,n)},this.renderInstances=function(o,a,s){var l;if(i.isWebGL2)l=e;else if(null===(l=t.get("ANGLE_instanced_arrays")))return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");l[i.isWebGL2?"drawArraysInstanced":"drawArraysInstancedANGLE"](n,a,s,o.maxInstancedCount),r.update(s,n,o.maxInstancedCount)}}(z,Ee,_e,be),Ie=new function(e,t,r,i){var n,o,a;this.setMode=function(e){n=e},this.setIndex=function(e){o=e.type,a=e.bytesPerElement},this.render=function(t,i){e.drawElements(n,i,o,t*a),r.update(i,n)},this.renderInstances=function(s,l,c){if(i.isWebGL2)u=e;else{var u;if(null===(u=t.get("ANGLE_instanced_arrays")))return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.")}u[i.isWebGL2?"drawElementsInstanced":"drawElementsInstancedANGLE"](n,c,o,l*a,s.maxInstancedCount),r.update(c,n,s.maxInstancedCount)}}(z,Ee,_e,be),_e.programs=Pe.programs,G.context=z,G.capabilities=be,G.extensions=Ee,G.properties=we,G.renderLists=Ae,G.state=xe,G.info=_e}function n(e){e.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),W=!0}function s(){console.log("THREE.WebGLRenderer: Context Restored."),W=!1,r()}function c(e){var t=e.target;t.removeEventListener("dispose",c),function(e){u(e),we.remove(e)}(t)}function u(e){var t=we.get(e).program;e.program=void 0,void 0!==t&&Pe.releaseProgram(t)}function p(e,t,r){if(!1!==e.visible){if(e.layers.test(t.layers))if(e.isLight)B.pushLight(e),e.castShadow&&B.pushShadow(e);else if(e.isSprite){if(!e.frustumCulled||pe.intersectsSprite(e)){r&&ve.setFromMatrixPosition(e.matrixWorld).applyMatrix4(ge);var i=Se.update(e),n=e.material;j.push(e,i,n,ve.z,null)}}else if(e.isImmediateRenderObject)r&&ve.setFromMatrixPosition(e.matrixWorld).applyMatrix4(ge),j.push(e,null,e.material,ve.z,null);else if((e.isMesh||e.isLine||e.isPoints)&&(e.isSkinnedMesh&&e.skeleton.update(e),!e.frustumCulled||pe.intersectsObject(e))){r&&ve.setFromMatrixPosition(e.matrixWorld).applyMatrix4(ge);var i=Se.update(e),n=e.material;if(Array.isArray(n))for(var o=i.groups,a=0,s=o.length;a<s;a++){var l=o[a],c=n[l.materialIndex];c&&c.visible&&j.push(e,i,c,ve.z,l)}else n.visible&&j.push(e,i,n,ve.z,null)}for(var u=e.children,a=0,s=u.length;a<s;a++)p(u[a],t,r)}}function d(e,t,r,i){for(var n=0,o=e.length;n<o;n++){var a=e[n],s=a.object,l=a.geometry,c=void 0===i?a.material:i,u=a.group;if(r.isArrayCamera){te=r;for(var h=r.cameras,p=0,d=h.length;p<d;p++){var f=h[p];if(s.layers.test(f.layers)){if("viewport"in f)xe.viewport(re.copy(f.viewport));else{var m=f.bounds,g=m.x*ae,y=m.y*se,E=m.z*ae,b=m.w*se;xe.viewport(re.set(g,y,E,b).multiplyScalar(le))}B.setupLights(f),v(s,t,f,l,c,u)}}}else te=null,v(s,t,r,l,c,u)}}function v(e,t,r,i,n,o){var a=e.onBeforeRender(G,t,r,i,n,o);if(null!==a){if(a&&(n=a),B=Ce.get(t,te||r),e.modelViewMatrix.multiplyMatrices(r.matrixWorldInverse,e.matrixWorld),e.normalMatrix.getNormalMatrix(e.modelViewMatrix),e.isImmediateRenderObject){xe.setMaterial(n);var s=_(r,t.fog,n,e);$.geometry=null,$.program=null,$.wireframe=!1,function(e,t){e.render(function(e){G.renderBufferImmediate(e,t)})}(e,s)}else G.renderBufferDirect(r,t.fog,i,n,e,o);e.onAfterRender(G,t,r,i,n,o),B=Ce.get(t,te||r)}}function x(e,t,r){var i=we.get(e),n=B.state.lights,o=B.state.shadowsArray,a=i.lightsHash,s=n.state.hash,l=Pe.getParameters(e,n.state,o,t,de.numPlanes,de.numIntersection,r),h=Pe.getProgramCode(e,l),p=i.program,d=!0;if(void 0===p)e.addEventListener("dispose",c);else if(p.code!==h)u(e);else if(a.stateID!==s.stateID||a.directionalLength!==s.directionalLength||a.pointLength!==s.pointLength||a.spotLength!==s.spotLength||a.rectAreaLength!==s.rectAreaLength||a.hemiLength!==s.hemiLength||a.shadowsLength!==s.shadowsLength)a.stateID=s.stateID,a.directionalLength=s.directionalLength,a.pointLength=s.pointLength,a.spotLength=s.spotLength,a.rectAreaLength=s.rectAreaLength,a.hemiLength=s.hemiLength,a.shadowsLength=s.shadowsLength,d=!1;else{if(void 0!==l.shaderID)return;d=!1}if(d){if(l.shaderID){var f=ds[l.shaderID];i.shader={name:e.type,uniforms:g(f.uniforms),vertexShader:f.vertexShader,fragmentShader:f.fragmentShader}}else i.shader={name:e.type,uniforms:e.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader};e.onBeforeCompile(i.shader,G),h=Pe.getProgramCode(e,l),p=Pe.acquireProgram(e,i.shader,l,h),i.program=p,e.program=p}var m=p.getAttributes();if(e.morphTargets){e.numSupportedMorphTargets=0;for(v=0;v<G.maxMorphTargets;v++)m["morphTarget"+v]>=0&&e.numSupportedMorphTargets++}if(e.morphNormals){e.numSupportedMorphNormals=0;for(var v=0;v<G.maxMorphNormals;v++)m["morphNormal"+v]>=0&&e.numSupportedMorphNormals++}var y=i.shader.uniforms;(e.isShaderMaterial||e.isRawShaderMaterial)&&!0!==e.clipping||(i.numClippingPlanes=de.numPlanes,i.numIntersection=de.numIntersection,y.clippingPlanes=de.uniform),i.fog=t,void 0===a&&(i.lightsHash=a={}),a.stateID=s.stateID,a.directionalLength=s.directionalLength,a.pointLength=s.pointLength,a.spotLength=s.spotLength,a.rectAreaLength=s.rectAreaLength,a.hemiLength=s.hemiLength,a.shadowsLength=s.shadowsLength,e.lights&&(y.ambientLightColor.value=n.state.ambient,y.directionalLights.value=n.state.directional,y.spotLights.value=n.state.spot,y.rectAreaLights.value=n.state.rectArea,y.pointLights.value=n.state.point,y.hemisphereLights.value=n.state.hemi,y.directionalShadowMap.value=n.state.directionalShadowMap,y.directionalShadowMatrix.value=n.state.directionalShadowMatrix,y.spotShadowMap.value=n.state.spotShadowMap,y.spotShadowMatrix.value=n.state.spotShadowMatrix,y.pointShadowMap.value=n.state.pointShadowMap,y.pointShadowMatrix.value=n.state.pointShadowMatrix);var E=i.program.getUniforms(),b=Oe.seqWithValue(E.seq,y);i.uniformsList=b}function _(e,t,r,i){oe=0;var n=we.get(r),o=B.state.lights,a=n.lightsHash,s=o.state.hash;if(fe&&(me||e!==ee)){var l=e===ee&&r.id===Z;de.setState(r.clippingPlanes,r.clipIntersection,r.clipShadows,e,n,l)}!1===r.needsUpdate&&(void 0===n.program?r.needsUpdate=!0:r.fog&&n.fog!==t?r.needsUpdate=!0:!r.lights||a.stateID===s.stateID&&a.directionalLength===s.directionalLength&&a.pointLength===s.pointLength&&a.spotLength===s.spotLength&&a.rectAreaLength===s.rectAreaLength&&a.hemiLength===s.hemiLength&&a.shadowsLength===s.shadowsLength?void 0===n.numClippingPlanes||n.numClippingPlanes===de.numPlanes&&n.numIntersection===de.numIntersection||(r.needsUpdate=!0):r.needsUpdate=!0),r.needsUpdate&&(x(r,t,i),r.needsUpdate=!1);var c=!1,u=!1,p=!1,d=n.program,f=d.getUniforms(),m=n.shader.uniforms;if(xe.useProgram(d.program)&&(c=!0,u=!0,p=!0),r.id!==Z&&(Z=r.id,u=!0),c||ee!==e){if(f.setValue(z,"projectionMatrix",e.projectionMatrix),be.logarithmicDepthBuffer&&f.setValue(z,"logDepthBufFC",2/(Math.log(e.far+1)/Math.LN2)),ee!==e&&(ee=e,u=!0,p=!0),r.isShaderMaterial||r.isMeshPhongMaterial||r.isMeshStandardMaterial||r.envMap){var g=f.map.cameraPosition;void 0!==g&&g.setValue(z,ve.setFromMatrixPosition(e.matrixWorld))}(r.isMeshPhongMaterial||r.isMeshLambertMaterial||r.isMeshBasicMaterial||r.isMeshStandardMaterial||r.isShaderMaterial||r.skinning)&&f.setValue(z,"viewMatrix",e.matrixWorldInverse)}if(r.skinning){f.setOptional(z,i,"bindMatrix"),f.setOptional(z,i,"bindMatrixInverse");var v=i.skeleton;if(v){var y=v.bones,E=i.bindMatrixInverse.clone();if(E.elements[12]=0,E.elements[13]=0,E.elements[14]=0,f.setValue(z,"localBindMatrixInverse",E),be.floatVertexTextures){if(void 0===v.boneTexture){var b=Math.sqrt(4*y.length);b=os.ceilPowerOfTwo(b),b=Math.max(b,4);var _=new Float32Array(b*b*4);_.set(v.boneMatrices);var R=new h(_,b,b,da,oa);R.needsUpdate=!0,v.boneMatrices=_,v.boneTexture=R,v.boneTextureSize=b}f.setValue(z,"boneTexture",v.boneTexture),f.setValue(z,"boneTextureSize",v.boneTextureSize)}else f.setOptional(z,v,"boneMatrices")}}return u&&(f.setValue(z,"toneMappingExposure",G.toneMappingExposure),f.setValue(z,"toneMappingWhitePoint",G.toneMappingWhitePoint),r.lights&&function(e,t){e.ambientLightColor.needsUpdate=t,e.directionalLights.needsUpdate=t,e.pointLights.needsUpdate=t,e.spotLights.needsUpdate=t,e.rectAreaLights.needsUpdate=t,e.hemisphereLights.needsUpdate=t}(m,p),t&&r.fog&&function(e,t){e.fogColor.value=t.color,t.isFog?(e.fogNear.value=t.near,e.fogFar.value=t.far):t.isFogExp2&&(e.fogDensity.value=t.density)}(m,t),r.isMeshBasicMaterial?w(m,r):r.isMeshLambertMaterial?(w(m,r),function(e,t){t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap)}(m,r)):r.isMeshPhongMaterial?(w(m,r),r.isMeshToonMaterial?function(e,t){T(e,t),t.gradientMap&&(e.gradientMap.value=t.gradientMap)}(m,r):T(m,r)):r.isMeshStandardMaterial?(w(m,r),r.isMeshPhysicalMaterial?function(e,t){M(e,t),e.reflectivity.value=t.reflectivity,e.clearCoat.value=t.clearCoat,e.clearCoatRoughness.value=t.clearCoatRoughness}(m,r):M(m,r)):r.isMeshMatcapMaterial?(w(m,r),function(e,t){t.matcap&&(e.matcap.value=t.matcap);t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===Wn&&(e.bumpScale.value*=-1));t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===Wn&&e.normalScale.value.negate());t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(m,r)):r.isMeshDepthMaterial?(w(m,r),function(e,t){t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(m,r)):r.isMeshDistanceMaterial?(w(m,r),function(e,t){t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias);e.referencePosition.value.copy(t.referencePosition),e.nearDistance.value=t.nearDistance,e.farDistance.value=t.farDistance}(m,r)):r.isMeshNormalMaterial?(w(m,r),function(e,t){t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===Wn&&(e.bumpScale.value*=-1));t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===Wn&&e.normalScale.value.negate());t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(m,r)):r.isLineBasicMaterial?(function(e,t){e.diffuse.value=t.color,e.opacity.value=t.opacity}(m,r),r.isLineDashedMaterial&&function(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}(m,r)):r.isPointsMaterial?function(e,t){e.diffuse.value=t.color,e.opacity.value=t.opacity,e.size.value=t.size*le,e.scale.value=.5*se,e.map.value=t.map,null!==t.map&&(!0===t.map.matrixAutoUpdate&&t.map.updateMatrix(),e.uvTransform.value.copy(t.map.matrix))}(m,r):r.isSpriteMaterial?function(e,t){e.diffuse.value=t.color,e.opacity.value=t.opacity,e.rotation.value=t.rotation,e.map.value=t.map,null!==t.map&&(!0===t.map.matrixAutoUpdate&&t.map.updateMatrix(),e.uvTransform.value.copy(t.map.matrix))}(m,r):r.isShadowMaterial&&(m.color.value=r.color,m.opacity.value=r.opacity),void 0!==m.ltc_1&&(m.ltc_1.value=ps.LTC_1),void 0!==m.ltc_2&&(m.ltc_2.value=ps.LTC_2),Oe.upload(z,n.uniformsList,m,G)),f.setValue(z,"baseId",r.baseId),r.isShaderMaterial&&!0===r.uniformsNeedUpdate&&(Oe.upload(z,n.uniformsList,m,G),r.uniformsNeedUpdate=!1),r.isSpriteMaterial&&f.setValue(z,"center",i.center),f.setValue(z,"modelViewMatrix",i.modelViewMatrix),f.setValue(z,"normalMatrix",i.normalMatrix),f.setValue(z,"modelMatrix",i.matrixWorld),d}function w(e,t){e.opacity.value=t.opacity,t.color&&(e.diffuse.value=t.color),t.emissive&&e.emissive.value.copy(t.emissive).multiplyScalar(t.emissiveIntensity),t.map&&(e.map.value=t.map),t.alphaMap&&(e.alphaMap.value=t.alphaMap),t.specularMap&&(e.specularMap.value=t.specularMap),t.envMap&&(e.envMap.value=t.envMap,e.flipEnvMap.value=t.envMap.isCubeTexture?-1:1,e.reflectivity.value=t.reflectivity,e.refractionRatio.value=t.refractionRatio,e.maxMipLevel.value=we.get(t.envMap).__maxMipLevel),t.lightMap&&(e.lightMap.value=t.lightMap,e.lightMapIntensity.value=t.lightMapIntensity),t.aoMap&&(e.aoMap.value=t.aoMap,e.aoMapIntensity.value=t.aoMapIntensity);var r;t.map?r=t.map:t.specularMap?r=t.specularMap:t.displacementMap?r=t.displacementMap:t.normalMap?r=t.normalMap:t.bumpMap?r=t.bumpMap:t.roughnessMap?r=t.roughnessMap:t.metalnessMap?r=t.metalnessMap:t.alphaMap?r=t.alphaMap:t.emissiveMap&&(r=t.emissiveMap),void 0!==r&&(r.isWebGLRenderTarget&&(r=r.texture),!0===r.matrixAutoUpdate&&r.updateMatrix(),e.uvTransform.value.copy(r.matrix)),t.alphaMap&&(!0===t.alphaMap.matrixAutoUpdate&&t.alphaMap.updateMatrix(),e.uvTransform1.value.copy(t.alphaMap.matrix))}function T(e,t){e.specular.value=t.specular,e.shininess.value=Math.max(t.shininess,1e-4),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===Wn&&(e.bumpScale.value*=-1)),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===Wn&&e.normalScale.value.negate()),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}function M(e,t){e.roughness.value=t.roughness,e.metalness.value=t.metalness,t.roughnessMap&&(e.roughnessMap.value=t.roughnessMap),t.metalnessMap&&(e.metalnessMap.value=t.metalnessMap),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===Wn&&(e.bumpScale.value*=-1)),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===Wn&&e.normalScale.value.negate()),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias),t.envMap&&(e.envMapIntensity.value=t.envMapIntensity)}console.log("THREE.WebGLRenderer",jn);var R=void 0!==(e=e||{}).canvas?e.canvas:document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),S=void 0!==e.context?e.context:null,P=void 0!==e.alpha&&e.alpha,A=void 0===e.depth||e.depth,C=void 0===e.stencil||e.stencil,O=void 0!==e.antialias&&e.antialias,F=void 0===e.premultipliedAlpha||e.premultipliedAlpha,I=void 0!==e.preserveDrawingBuffer&&e.preserveDrawingBuffer,k=void 0!==e.powerPreference?e.powerPreference:"default",j=null,B=null;this.domElement=R,this.context=null,this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.gammaInput=!1,this.gammaOutput=!1,this.physicallyCorrectLights=!1,this.toneMapping=Oo,this.toneMappingExposure=1,this.toneMappingWhitePoint=1,this.maxMorphTargets=8,this.maxMorphNormals=4;var z,G=this,W=!1,X=null,J=null,K=null,Z=-1,$={geometry:null,program:null,wireframe:!1},ee=null,te=null,re=new l,ie=new l,ne=null,oe=0,ae=R.width,se=R.height,le=1,ce=new l(0,0,ae,se),ue=new l(0,0,ae,se),he=!1,pe=new m,de=new function(){function e(){u.value!==i&&(u.value=i,u.needsUpdate=n>0),r.numPlanes=n,r.numIntersection=0}function t(e,t,i,n){var o=null!==e?e.length:0,a=null;if(0!==o){if(a=u.value,!0!==n||null===a){var s=i+4*o,h=t.matrixWorldInverse;c.getNormalMatrix(h),(null===a||a.length<s)&&(a=new Float32Array(s));for(var p=0,d=i;p!==o;++p,d+=4)l.copy(e[p]).applyMatrix4(h,c),l.normal.toArray(a,d),a[d+3]=l.constant}u.value=a,u.needsUpdate=!0}return r.numPlanes=o,a}var r=this,i=null,n=0,o=!1,s=!1,l=new f,c=new a,u={value:null,needsUpdate:!1};this.uniform=u,this.numPlanes=0,this.numIntersection=0,this.init=function(e,r,a){var s=0!==e.length||r||0!==n||o;return o=r,i=t(e,a,0),n=e.length,s},this.beginShadows=function(){s=!0,t(null)},this.endShadows=function(){s=!1,e()},this.setState=function(r,a,l,c,h,p){if(!o||null===r||0===r.length||s&&!l)s?t(null):e();else{var d=s?0:n,f=4*d,m=h.clippingState||null;u.value=m,m=t(r,c,f,p);for(var g=0;g!==f;++g)m[g]=i[g];h.clippingState=m,this.numIntersection=a?this.numPlanes:0,this.numPlanes+=d}}},fe=!1,me=!1,ge=new i,ve=new o;try{var ye={alpha:P,depth:A,stencil:C,antialias:O,premultipliedAlpha:F,preserveDrawingBuffer:I,powerPreference:k};if(R.addEventListener("webglcontextlost",n,!1),R.addEventListener("webglcontextrestored",s,!1),null===(z=S||R.getContext("webgl",ye)||R.getContext("experimental-webgl",ye)))throw null!==R.getContext("webgl")?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.");void 0===z.getShaderPrecisionFormat&&(z.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(e){console.error("THREE.WebGLRenderer: "+e.message)}var Ee,be,xe,_e,we,Te,Me,Re,Se,Pe,Ae,Ce,Le,He,Fe,Ie,ke;r();var De=null;"undefined"!=typeof navigator&&(De="xr"in navigator?new function(e){function t(){return null!==s&&null!==u}function r(e){var t=d[f.indexOf(e.inputSource)];t&&t.dispatchEvent({type:e.type})}function i(){e.setFramebuffer(null),b.stop()}function n(e,t){null===t?e.matrixWorld.copy(e.matrix):e.matrixWorld.multiplyMatrices(t.matrixWorld,e.matrix),e.matrixWorldInverse.getInverse(e.matrixWorld)}var o=e.context,a=null,s=null,c=1,u=null,h="stage",p=null,d=[],f=[],m=new tt;m.layers.enable(1),m.viewport=new l;var g=new tt;g.layers.enable(2),g.viewport=new l;var v=new rt([m,g]);v.layers.enable(1),v.layers.enable(2),this.enabled=!1,this.getController=function(e){var t=d[e];return void 0===t&&((t=new $e).matrixAutoUpdate=!1,t.visible=!1,d[e]=t),t},this.getDevice=function(){return a},this.setDevice=function(e){void 0!==e&&(a=e),e instanceof XRDevice&&o.setCompatibleXRDevice(e)},this.setFramebufferScaleFactor=function(e){c=e},this.setFrameOfReferenceType=function(e){h=e},this.setSession=function(t){null!==(s=t)&&(s.addEventListener("select",r),s.addEventListener("selectstart",r),s.addEventListener("selectend",r),s.addEventListener("end",i),s.baseLayer=new XRWebGLLayer(s,o,{framebufferScaleFactor:c}),s.requestFrameOfReference(h).then(function(t){u=t,e.setFramebuffer(s.baseLayer.framebuffer),b.setContext(s),b.start()}),f=s.getInputSources(),s.addEventListener("inputsourceschange",function(){f=s.getInputSources(),console.log(f);for(var e=0;e<d.length;e++)d[e].userData.inputSource=f[e]}))},this.getCamera=function(e){if(t()){var r=e.parent,i=v.cameras;for(n(v,r),a=0;a<i.length;a++)n(i[a],r);e.matrixWorld.copy(v.matrixWorld);for(var o=e.children,a=0,s=o.length;a<s;a++)o[a].updateMatrixWorld(!0);return it(v,m,g),v}return e},this.isPresenting=t;var y=null,b=new E;b.setAnimationLoop(function(e,t){if(null!==(p=t.getDevicePose(u)))for(var r=s.baseLayer,i=t.views,n=0;n<i.length;n++){var o=i[n],a=r.getViewport(o),l=p.getViewMatrix(o),c=v.cameras[n];c.matrix.fromArray(l).getInverse(c.matrix),c.projectionMatrix.fromArray(o.projectionMatrix),c.viewport.set(a.x,a.y,a.width,a.height),0===n&&v.matrix.copy(c.matrix)}for(n=0;n<d.length;n++){var h=d[n],m=f[n];if(m){var g=t.getInputPose(m,u);if(null!==g){"targetRay"in g?h.matrix.elements=g.targetRay.transformMatrix:"pointerMatrix"in g&&(h.matrix.elements=g.pointerMatrix),h.matrix.decompose(h.position,h.rotation,h.scale),h.visible=!0;continue}}h.visible=!1}y&&y(e)}),this.setAnimationLoop=function(e){y=e},this.dispose=function(){},this.getStandingMatrix=function(){return console.warn("THREE.WebXRManager: getStandingMatrix() is no longer needed."),new THREE.Matrix4},this.submitFrame=function(){}}(G):new nt(G)),this.vr=De;var Ne=new Je(G,Se,be.maxTextureSize);this.shadowMap=Ne,this.getContext=function(){return z},this.getContextAttributes=function(){return z.getContextAttributes()},this.forceContextLoss=function(){var e=Ee.get("WEBGL_lose_context");e&&e.loseContext()},this.forceContextRestore=function(){var e=Ee.get("WEBGL_lose_context");e&&e.restoreContext()},this.getPixelRatio=function(){return le},this.setPixelRatio=function(e){void 0!==e&&(le=e,this.setSize(ae,se,!1))},this.getSize=function(){return{width:ae,height:se}},this.setSize=function(e,t,r){De.isPresenting()?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(ae=e,se=t,R.width=e*le,R.height=t*le,!1!==r&&(R.style.width=e+"px",R.style.height=t+"px"),this.setViewport(0,0,e,t))},this.getDrawingBufferSize=function(){return{width:ae*le,height:se*le}},this.setDrawingBufferSize=function(e,t,r){ae=e,se=t,le=r,R.width=e*r,R.height=t*r,this.setViewport(0,0,e,t)},this.getCurrentViewport=function(){return re},this.setViewport=function(e,t,r,i){ce.set(e,se-t-i,r,i),xe.viewport(re.copy(ce).multiplyScalar(le))},this.setScissor=function(e,t,r,i){ue.set(e,se-t-i,r,i),xe.scissor(ie.copy(ue).multiplyScalar(le))},this.setScissorTest=function(e){xe.setScissorTest(he=e)},this.getClearColor=function(){return Le.getClearColor()},this.setClearColor=function(){Le.setClearColor.apply(Le,arguments)},this.getClearAlpha=function(){return Le.getClearAlpha()},this.setClearAlpha=function(){Le.setClearAlpha.apply(Le,arguments)},this.clear=function(e,t,r){var i=0;(void 0===e||e)&&(i|=16384),(void 0===t||t)&&(i|=256),(void 0===r||r)&&(i|=1024),z.clear(i)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){R.removeEventListener("webglcontextlost",n,!1),R.removeEventListener("webglcontextrestored",s,!1),Ae.dispose(),Ce.dispose(),we.dispose(),Se.dispose(),De.dispose(),Ue.stop()},this.blitRenderTarget=function(e,t){if(be.isWebGL2){var r=we.get(e).__webglFramebuffer,i=we.get(t).__webglFramebuffer;z.bindFramebuffer(z.READ_FRAMEBUFFER,r),z.bindFramebuffer(z.DRAW_FRAMEBUFFER,i),z.clearBufferfv(z.COLOR,0,[0,0,0,0]),z.blitFramebuffer(0,0,e.width,e.height,0,0,t.width,t.height,z.COLOR_BUFFER_BIT,z.NEAREST)}else console.warn("WebGL1 not support blitFramebuffer")},this.renderBufferImmediate=function(e,t){xe.initAttributes();var r=we.get(e);e.hasPositions&&!r.position&&(r.position=z.createBuffer()),e.hasNormals&&!r.normal&&(r.normal=z.createBuffer()),e.hasUvs&&!r.uv&&(r.uv=z.createBuffer()),e.hasColors&&!r.color&&(r.color=z.createBuffer());var i=t.getAttributes();e.hasPositions&&(z.bindBuffer(34962,r.position),z.bufferData(34962,e.positionArray,35048),xe.enableAttribute(i.position),z.vertexAttribPointer(i.position,3,5126,!1,0,0)),e.hasNormals&&(z.bindBuffer(34962,r.normal),z.bufferData(34962,e.normalArray,35048),xe.enableAttribute(i.normal),z.vertexAttribPointer(i.normal,3,5126,!1,0,0)),e.hasUvs&&(z.bindBuffer(34962,r.uv),z.bufferData(34962,e.uvArray,35048),xe.enableAttribute(i.uv),z.vertexAttribPointer(i.uv,2,5126,!1,0,0)),e.hasColors&&(z.bindBuffer(34962,r.color),z.bufferData(34962,e.colorArray,35048),xe.enableAttribute(i.color),z.vertexAttribPointer(i.color,3,5126,!1,0,0)),xe.disableUnusedAttributes(),z.drawArrays(4,0,e.count),e.count=0},this.renderBufferDirect=function(e,r,i,n,o,a){var s=o.isMesh&&o.normalMatrix.determinant()<0;xe.setMaterial(n,s);var l=_(e,r,n,o),c=!1;$.geometry===i.id&&$.program===l.id&&$.wireframe===(!0===n.wireframe)||($.geometry=i.id,$.program=l.id,$.wireframe=!0===n.wireframe,c=!0),o.morphTargetInfluences&&(He.update(o,i,n,l),c=!0);var u=i.index,h=i.attributes.position,p=1;!0===n.wireframe&&(u=Re.getWireframeAttribute(i),p=2);var d,f=Fe;null!==u&&(d=Me.get(u),(f=Ie).setIndex(d)),c&&(!function(e,t,r){if(r&&r.isInstancedBufferGeometry&!be.isWebGL2&&null===Ee.get("ANGLE_instanced_arrays"))console.error("THREE.WebGLRenderer.setupVertexAttributes: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");else{xe.initAttributes();var i=r.attributes,n=t.getAttributes(),o=e.defaultAttributeValues;for(var a in n){var s=n[a];if(s>=0){var l=i[a];if(void 0!==l){var c=l.normalized,u=l.itemSize,h=Me.get(l);if(void 0===h)continue;var p=h.buffer,d=h.type,f=h.bytesPerElement;if(l.isInterleavedBufferAttribute){var m=l.data,g=m.stride,v=l.offset;m&&m.isInstancedInterleavedBuffer?(xe.enableAttributeAndDivisor(s,m.meshPerAttribute),void 0===r.maxInstancedCount&&(r.maxInstancedCount=m.meshPerAttribute*m.count)):xe.enableAttribute(s),z.bindBuffer(34962,p),z.vertexAttribPointer(s,u,d,c,g*f,v*f)}else l.isInstancedBufferAttribute?(xe.enableAttributeAndDivisor(s,l.meshPerAttribute),void 0===r.maxInstancedCount&&(r.maxInstancedCount=l.meshPerAttribute*l.count)):xe.enableAttribute(s),z.bindBuffer(34962,p),z.vertexAttribPointer(s,u,d,c,0,0)}else if(void 0!==o){var y=o[a];if(void 0!==y)switch(y.length){case 2:z.vertexAttrib2fv(s,y);break;case 3:z.vertexAttrib3fv(s,y);break;case 4:z.vertexAttrib4fv(s,y);break;default:z.vertexAttrib1fv(s,y)}}}}xe.disableUnusedAttributes()}}(n,l,i),null!==u&&z.bindBuffer(34963,d.buffer));var m=1/0;null!==u?m=u.count:void 0!==h&&(m=h.count);var g=i.drawRange.start*p,v=i.drawRange.count*p,y=null!==a?a.start*p:0,E=null!==a?a.count*p:1/0,b=Math.max(g,y),x=Math.min(m,g+v,y+E)-1,w=Math.max(0,x-b+1);if(0!==w){if(o.isMesh)if(!0===n.wireframe)xe.setLineWidth(n.wireframeLinewidth*t()),f.setMode(1);else switch(o.drawMode){case Ga:f.setMode(4);break;case Wa:f.setMode(5);break;case Xa:f.setMode(6)}else if(o.isLine){var T=n.linewidth;void 0===T&&(T=1),xe.setLineWidth(T*t()),o.isLineSegments?f.setMode(1):o.isLineLoop?f.setMode(2):f.setMode(3)}else o.isPoints?f.setMode(0):o.isSprite&&f.setMode(4);i&&i.isInstancedBufferGeometry?i.maxInstancedCount>0&&f.renderInstances(i,b,w):f.render(b,w)}},this.compile=function(e,t){(B=Ce.get(e,t)).init(),e.traverse(function(e){e.isLight&&(B.pushLight(e),e.castShadow&&B.pushShadow(e))}),B.setupLights(t),e.traverse(function(t){if(t.material)if(Array.isArray(t.material))for(var r=0;r<t.material.length;r++)x(t.material[r],e.fog,t);else x(t.material,e.fog,t)})};var je=null,Ue=new E;Ue.setAnimationLoop(function(e){De.isPresenting()||je&&je(e)}),"undefined"!=typeof window&&Ue.setContext(window),this.setAnimationLoop=function(e){je=e,De.setAnimationLoop(e),Ue.start()},this.render=function(e,t,r,i){if(t&&t.isCamera){if(!W){$.geometry=null,$.program=null,$.wireframe=!1,Z=-1,ee=null,!0===e.autoUpdate&&e.updateMatrixWorld(),null===t.parent&&t.updateMatrixWorld(),De.enabled&&(t=De.getCamera(t)),(B=Ce.get(e,t)).init(),e.onBeforeRender(G,e,t,r),ge.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),pe.setFromMatrix(ge),me=this.localClippingEnabled,fe=de.init(this.clippingPlanes,me,t),(j=Ae.get(e,t)).init(),p(e,t,G.sortObjects),!0===G.sortObjects&&j.sort(),fe&&de.beginShadows();var n=B.state.shadowsArray;Ne.render(n,e,t),B.setupLights(t),fe&&de.endShadows(),this.info.autoReset&&this.info.reset(),void 0===r&&(r=null),this.setRenderTarget(r),Le.render(j,e,t,i);var o=j.opaque,a=j.transparent;if(e.overrideMaterial){var s=e.overrideMaterial;o.length&&d(o,e,t,s),a.length&&d(a,e,t,s)}else o.length&&d(o,e,t),a.length&&d(a,e,t);r&&Te.updateRenderTargetMipmap(r),xe.buffers.depth.setTest(!0),xe.buffers.depth.setMask(!0),xe.buffers.color.setMask(!0),xe.setPolygonOffset(!1),e.onAfterRender(G,e,t),De.enabled&&De.submitFrame(),j=null,B=null}}else console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.")},this.allocTextureUnit=function(){var e=oe;return e>=be.maxTextures&&console.warn("THREE.WebGLRenderer: Trying to use "+e+" texture units while this GPU supports only "+be.maxTextures),oe+=1,e},this.setTexture2D=function(){var e=!1;return function(t,r){t&&t.isWebGLRenderTarget&&(e||(console.warn("THREE.WebGLRenderer.setTexture2D: don't use render targets as textures. Use their .texture property instead."),e=!0),t=t.texture),Te.setTexture2D(t,r)}}(),this.setTexture3D=function(e,t){Te.setTexture3D(e,t)},this.setTexture=function(){var e=!1;return function(t,r){e||(console.warn("THREE.WebGLRenderer: .setTexture is deprecated, use setTexture2D instead."),e=!0),Te.setTexture2D(t,r)}}(),this.setTextureCube=function(){var e=!1;return function(t,r){t&&t.isWebGLRenderTargetCube&&(e||(console.warn("THREE.WebGLRenderer.setTextureCube: don't use cube render targets as textures. Use their .texture property instead."),e=!0),t=t.texture),t&&t.isCubeTexture||Array.isArray(t.image)&&6===t.image.length?Te.setTextureCube(t,r):Te.setTextureCubeDynamic(t,r)}}(),this.setFramebuffer=function(e){X=e},this.getRenderTarget=function(){return J},this.setRenderTarget=function(e){J=e,e&&void 0===we.get(e).__webglFramebuffer&&Te.setupRenderTarget(e);var t=X,r=!1;if(e){var i=we.get(e).__webglFramebuffer;e.isWebGLRenderTargetCube?(t=i[e.activeCubeFace],r=!0):t=i,re.copy(e.viewport),ie.copy(e.scissor),ne=e.scissorTest}else re.copy(ce).multiplyScalar(le),ie.copy(ue).multiplyScalar(le),ne=he;if(K!==t&&(z.bindFramebuffer(36160,t),K=t),xe.viewport(re),xe.scissor(ie),xe.setScissorTest(ne),r){var n=we.get(e.texture);z.framebufferTexture2D(36160,36064,34069+e.activeCubeFace,n.__webglTexture,e.activeMipMapLevel)}},this.readRenderTargetPixels=function(e,t,r,i,n,o){if(e&&e.isWebGLRenderTarget){var a=we.get(e).__webglFramebuffer;if(a){var s=!1;a!==K&&(z.bindFramebuffer(36160,a),s=!0);try{var l=e.texture,c=l.format,u=l.type;if(c!==da&&ke.convert(c)!==z.getParameter(35739))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");if(!(u===$o||ke.convert(u)===z.getParameter(35738)||u===oa&&(be.isWebGL2||Ee.get("OES_texture_float")||Ee.get("WEBGL_color_buffer_float"))||u===aa&&(be.isWebGL2?Ee.get("EXT_color_buffer_float"):Ee.get("EXT_color_buffer_half_float"))))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");36053===z.checkFramebufferStatus(36160)?t>=0&&t<=e.width-i&&r>=0&&r<=e.height-n&&z.readPixels(t,r,i,n,ke.convert(c),ke.convert(u),o):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{s&&z.bindFramebuffer(36160,K)}}}else console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.")},this.copyFramebufferToTexture=function(e,t,r){var i=t.image.width,n=t.image.height,o=ke.convert(t.format);this.setTexture2D(t,0),z.copyTexImage2D(3553,r||0,o,e.x,e.y,i,n,0)},this.copyTextureToTexture=function(e,t,r,i){var n=t.image.width,o=t.image.height,a=ke.convert(r.format),s=ke.convert(r.type);this.setTexture2D(r,0),t.isDataTexture?z.texSubImage2D(3553,i||0,e.x,e.y,n,o,a,s,t.image.data):z.texSubImage2D(3553,i||0,e.x,e.y,a,s,t.image)}}function at(e,t){this.name="",this.color=new y(e),this.density=void 0!==t?t:25e-5}function st(e,t,r){this.name="",this.color=new y(e),this.near=void 0!==t?t:1,this.far=void 0!==r?r:1e3}function lt(){T.call(this),this.type="Scene",this.background=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0}function ct(e,t){this.array=e,this.stride=t,this.count=void 0!==e?e.length/t:0,this.dynamic=!1,this.updateRange={offset:0,count:-1},this.version=0}function ut(e,t,r,i){this.data=e,this.itemSize=t,this.offset=r,this.normalized=!0===i}function ht(e){z.call(this),this.type="SpriteMaterial",this.color=new y(16777215),this.map=null,this.rotation=0,this.sizeAttenuation=!0,this.lights=!1,this.transparent=!0,this.setValues(e)}function pt(e){if(T.call(this),this.type="Sprite",void 0===Ls){Ls=new N;var t=new ct(new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),5);Ls.setIndex([0,1,2,0,2,3]),Ls.addAttribute("position",new ut(t,3,0,!1)),Ls.addAttribute("uv",new ut(t,2,3,!1))}this.geometry=Ls,this.material=void 0!==e?e:new ht,this.center=new r(.5,.5)}function dt(){T.call(this),this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]}})}function ft(e,t){e&&e.isGeometry&&console.error("THREE.SkinnedMesh no longer supports THREE.Geometry. Use THREE.BufferGeometry instead."),Y.call(this,e,t),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new i,this.bindMatrixInverse=new i}function mt(e,t){if(e=e||[],this.bones=e.slice(0),this.boneMatrices=new Float32Array(16*this.bones.length),void 0===t)this.calculateInverses();else if(this.bones.length===t.length)this.boneInverses=t.slice(0);else{console.warn("THREE.Skeleton boneInverses is the wrong length."),this.boneInverses=[];for(var r=0,n=this.bones.length;r<n;r++)this.boneInverses.push(new i)}}function gt(){T.call(this),this.type="Bone"}function vt(e){z.call(this),this.type="LineBasicMaterial",this.color=new y(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.lights=!1,this.setValues(e)}function yt(e,t,r){1===r&&console.error("THREE.Line: parameter THREE.LinePieces no longer supported. Use THREE.LineSegments instead."),T.call(this),this.type="Line",this.geometry=void 0!==e?e:new N,this.material=void 0!==t?t:new vt({color:16777215*Math.random()})}function Et(e,t){yt.call(this,e,t),this.type="LineSegments"}function bt(e,t){yt.call(this,e,t),this.type="LineLoop"}function xt(e){z.call(this),this.type="PointsMaterial",this.color=new y(16777215),this.map=null,this.size=1,this.sizeAttenuation=!0,this.morphTargets=!1,this.lights=!1,this.setValues(e)}function _t(e,t){T.call(this),this.type="Points",this.geometry=void 0!==e?e:new N,this.material=void 0!==t?t:new xt({color:16777215*Math.random()})}function wt(e,t,r,i,n,o,a,l,c){s.call(this,e,t,r,i,n,o,a,l,c),this.format=void 0!==a?a:pa,this.minFilter=void 0!==o?o:Jo,this.magFilter=void 0!==n?n:Jo,this.generateMipmaps=!1}function Tt(e,t,r,i,n,o,a,l,c,u,h,p){s.call(this,null,o,a,l,c,u,i,n,h,p),this.image={width:t,height:r},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}function Mt(e,t,r,i,n,o,a,l,c){s.call(this,e,t,r,i,n,o,a,l,c),this.needsUpdate=!0}function Rt(e,t,r,i,n,o,a,l,c,u){if((u=void 0!==u?u:va)!==va&&u!==ya)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===r&&u===va&&(r=ra),void 0===r&&u===ya&&(r=ua),s.call(this,null,i,n,o,a,l,u,r,c),this.image={width:e,height:t},this.magFilter=void 0!==a?a:Xo,this.minFilter=void 0!==l?l:Xo,this.flipY=!1,this.generateMipmaps=!1}function St(e){N.call(this),this.type="WireframeGeometry";var t,r,i,n,a,s,l,c,u,h,p=[],d=[0,0],f={},m=["a","b","c"];if(e&&e.isGeometry){var g=e.faces;for(t=0,i=g.length;t<i;t++){var v=g[t];for(r=0;r<3;r++)l=v[m[r]],c=v[m[(r+1)%3]],d[0]=Math.min(l,c),d[1]=Math.max(l,c),void 0===f[u=d[0]+","+d[1]]&&(f[u]={index1:d[0],index2:d[1]})}for(u in f)s=f[u],h=e.vertices[s.index1],p.push(h.x,h.y,h.z),h=e.vertices[s.index2],p.push(h.x,h.y,h.z)}else if(e&&e.isBufferGeometry){var y,E,b,x,_,w,T;if(h=new o,null!==e.index){for(y=e.attributes.position,E=e.index,0===(b=e.groups).length&&(b=[{start:0,count:E.count,materialIndex:0}]),n=0,a=b.length;n<a;++n)for(t=_=(x=b[n]).start,i=_+x.count;t<i;t+=3)for(r=0;r<3;r++)l=E.getX(t+r),c=E.getX(t+(r+1)%3),d[0]=Math.min(l,c),d[1]=Math.max(l,c),void 0===f[u=d[0]+","+d[1]]&&(f[u]={index1:d[0],index2:d[1]});for(u in f)s=f[u],h.fromBufferAttribute(y,s.index1),p.push(h.x,h.y,h.z),h.fromBufferAttribute(y,s.index2),p.push(h.x,h.y,h.z)}else for(t=0,i=(y=e.attributes.position).count/3;t<i;t++)for(r=0;r<3;r++)w=3*t+r,h.fromBufferAttribute(y,w),p.push(h.x,h.y,h.z),T=3*t+(r+1)%3,h.fromBufferAttribute(y,T),p.push(h.x,h.y,h.z)}this.addAttribute("position",new F(p,3))}function Pt(e,t,r){M.call(this),this.type="ParametricGeometry",this.parameters={func:e,slices:t,stacks:r},this.fromBufferGeometry(new At(e,t,r)),this.mergeVertices()}function At(e,t,r){N.call(this),this.type="ParametricBufferGeometry",this.parameters={func:e,slices:t,stacks:r};var i,n,a=[],s=[],l=[],c=[],u=new o,h=new o,p=new o,d=new o,f=new o;e.length<3&&console.error("THREE.ParametricGeometry: Function must now modify a Vector3 as third parameter.");var m=t+1;for(i=0;i<=r;i++){var g=i/r;for(n=0;n<=t;n++){var v=n/t;e(v,g,h),s.push(h.x,h.y,h.z),v-1e-5>=0?(e(v-1e-5,g,p),d.subVectors(h,p)):(e(v+1e-5,g,p),d.subVectors(p,h)),g-1e-5>=0?(e(v,g-1e-5,p),f.subVectors(h,p)):(e(v,g+1e-5,p),f.subVectors(p,h)),u.crossVectors(d,f).normalize(),l.push(u.x,u.y,u.z),c.push(v,g)}}for(i=0;i<r;i++)for(n=0;n<t;n++){var y=i*m+n,E=i*m+n+1,b=(i+1)*m+n+1,x=(i+1)*m+n;a.push(y,E,x),a.push(E,b,x)}this.setIndex(a),this.addAttribute("position",new F(s,3)),this.addAttribute("normal",new F(l,3)),this.addAttribute("uv",new F(c,2))}function Ct(e,t,r,i){M.call(this),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:r,detail:i},this.fromBufferGeometry(new Lt(e,t,r,i)),this.mergeVertices()}function Lt(e,t,i,n){function a(e){u.push(e.x,e.y,e.z)}function s(t,r){var i=3*t;r.x=e[i+0],r.y=e[i+1],r.z=e[i+2]}function l(e,t,r,i){i<0&&1===e.x&&(h[t]=e.x-1),0===r.x&&0===r.z&&(h[t]=i/2/Math.PI+.5)}function c(e){return Math.atan2(e.z,-e.x)}N.call(this),this.type="PolyhedronBufferGeometry",this.parameters={vertices:e,indices:t,radius:i,detail:n},i=i||1;var u=[],h=[];!function(e){for(var r=new o,i=new o,n=new o,l=0;l<t.length;l+=3)s(t[l+0],r),s(t[l+1],i),s(t[l+2],n),function(e,t,r,i){var n,o,s=Math.pow(2,i),l=[];for(n=0;n<=s;n++){l[n]=[];var c=e.clone().lerp(r,n/s),u=t.clone().lerp(r,n/s),h=s-n;for(o=0;o<=h;o++)l[n][o]=0===o&&n===s?c:c.clone().lerp(u,o/h)}for(n=0;n<s;n++)for(o=0;o<2*(s-n)-1;o++){var p=Math.floor(o/2);o%2==0?(a(l[n][p+1]),a(l[n+1][p]),a(l[n][p])):(a(l[n][p+1]),a(l[n+1][p+1]),a(l[n+1][p]))}}(r,i,n,e)}(n=n||0),function(e){for(var t=new o,r=0;r<u.length;r+=3)t.x=u[r+0],t.y=u[r+1],t.z=u[r+2],t.normalize().multiplyScalar(e),u[r+0]=t.x,u[r+1]=t.y,u[r+2]=t.z}(i),function(){for(var e=new o,t=0;t<u.length;t+=3){e.x=u[t+0],e.y=u[t+1],e.z=u[t+2];var i=c(e)/2/Math.PI+.5,n=function(e){return Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z))}(e)/Math.PI+.5;h.push(i,1-n)}!function(){for(var e=new o,t=new o,i=new o,n=new o,a=new r,s=new r,p=new r,d=0,f=0;d<u.length;d+=9,f+=6){e.set(u[d+0],u[d+1],u[d+2]),t.set(u[d+3],u[d+4],u[d+5]),i.set(u[d+6],u[d+7],u[d+8]),a.set(h[f+0],h[f+1]),s.set(h[f+2],h[f+3]),p.set(h[f+4],h[f+5]),n.copy(e).add(t).add(i).divideScalar(3);var m=c(n);l(a,f+0,e,m),l(s,f+2,t,m),l(p,f+4,i,m)}}(),function(){for(var e=0;e<h.length;e+=6){var t=h[e+0],r=h[e+2],i=h[e+4],n=Math.max(t,r,i),o=Math.min(t,r,i);n>.9&&o<.1&&(t<.2&&(h[e+0]+=1),r<.2&&(h[e+2]+=1),i<.2&&(h[e+4]+=1))}}()}(),this.addAttribute("position",new F(u,3)),this.addAttribute("normal",new F(u.slice(),3)),this.addAttribute("uv",new F(h,2)),0===n?this.computeVertexNormals():this.normalizeNormals()}function Ot(e,t){M.call(this),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new Ht(e,t)),this.mergeVertices()}function Ht(e,t){Lt.call(this,[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],e,t),this.type="TetrahedronBufferGeometry",this.parameters={radius:e,detail:t}}function Ft(e,t){M.call(this),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new It(e,t)),this.mergeVertices()}function It(e,t){Lt.call(this,[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],e,t),this.type="OctahedronBufferGeometry",this.parameters={radius:e,detail:t}}function kt(e,t){M.call(this),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new Dt(e,t)),this.mergeVertices()}function Dt(e,t){var r=(1+Math.sqrt(5))/2;Lt.call(this,[-1,r,0,1,r,0,-1,-r,0,1,-r,0,0,-1,r,0,1,r,0,-1,-r,0,1,-r,r,0,-1,r,0,1,-r,0,-1,-r,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],e,t),this.type="IcosahedronBufferGeometry",this.parameters={radius:e,detail:t}}function Nt(e,t){M.call(this),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new jt(e,t)),this.mergeVertices()}function jt(e,t){var r=(1+Math.sqrt(5))/2,i=1/r;Lt.call(this,[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-i,-r,0,-i,r,0,i,-r,0,i,r,-i,-r,0,-i,r,0,i,-r,0,i,r,0,-r,0,-i,r,0,-i,-r,0,i,r,0,i],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],e,t),this.type="DodecahedronBufferGeometry",this.parameters={radius:e,detail:t}}function Ut(e,t,r,i,n,o){M.call(this),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:t,radius:r,radialSegments:i,closed:n},void 0!==o&&console.warn("THREE.TubeGeometry: taper has been removed.");var a=new Bt(e,t,r,i,n);this.tangents=a.tangents,this.normals=a.normals,this.binormals=a.binormals,this.fromBufferGeometry(a),this.mergeVertices()}function Bt(e,t,i,n,a){function s(r){f=e.getPointAt(r/t,f);var o=l.normals[r],a=l.binormals[r];for(u=0;u<=n;u++){var s=u/n*Math.PI*2,c=Math.sin(s),d=-Math.cos(s);p.x=d*o.x+c*a.x,p.y=d*o.y+c*a.y,p.z=d*o.z+c*a.z,p.normalize(),g.push(p.x,p.y,p.z),h.x=f.x+i*p.x,h.y=f.y+i*p.y,h.z=f.z+i*p.z,m.push(h.x,h.y,h.z)}}N.call(this),this.type="TubeBufferGeometry",this.parameters={path:e,tubularSegments:t,radius:i,radialSegments:n,closed:a},t=t||64,i=i||1,n=n||8,a=a||!1;var l=e.computeFrenetFrames(t,a);this.tangents=l.tangents,this.normals=l.normals,this.binormals=l.binormals;var c,u,h=new o,p=new o,d=new r,f=new o,m=[],g=[],v=[],y=[];!function(){for(c=0;c<t;c++)s(c);s(!1===a?t:0),function(){for(c=0;c<=t;c++)for(u=0;u<=n;u++)d.x=c/t,d.y=u/n,v.push(d.x,d.y)}(),function(){for(u=1;u<=t;u++)for(c=1;c<=n;c++){var e=(n+1)*(u-1)+(c-1),r=(n+1)*u+(c-1),i=(n+1)*u+c,o=(n+1)*(u-1)+c;y.push(e,r,o),y.push(r,i,o)}}()}(),this.setIndex(y),this.addAttribute("position",new F(m,3)),this.addAttribute("normal",new F(g,3)),this.addAttribute("uv",new F(v,2))}function Vt(e,t,r,i,n,o,a){M.call(this),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:r,radialSegments:i,p:n,q:o},void 0!==a&&console.warn("THREE.TorusKnotGeometry: heightScale has been deprecated. Use .scale( x, y, z ) instead."),this.fromBufferGeometry(new zt(e,t,r,i,n,o)),this.mergeVertices()}function zt(e,t,r,i,n,a){function s(e,t,r,i,n){var o=Math.cos(e),a=Math.sin(e),s=r/t*e,l=Math.cos(s);n.x=i*(2+l)*.5*o,n.y=i*(2+l)*a*.5,n.z=i*Math.sin(s)*.5}N.call(this),this.type="TorusKnotBufferGeometry",this.parameters={radius:e,tube:t,tubularSegments:r,radialSegments:i,p:n,q:a},e=e||1,t=t||.4,r=Math.floor(r)||64,i=Math.floor(i)||8,n=n||2,a=a||3;var l,c,u=[],h=[],p=[],d=[],f=new o,m=new o,g=new o,v=new o,y=new o,E=new o,b=new o;for(l=0;l<=r;++l){var x=l/r*n*Math.PI*2;for(s(x,n,a,e,g),s(x+.01,n,a,e,v),E.subVectors(v,g),b.addVectors(v,g),y.crossVectors(E,b),b.crossVectors(y,E),y.normalize(),b.normalize(),c=0;c<=i;++c){var _=c/i*Math.PI*2,w=-t*Math.cos(_),T=t*Math.sin(_);f.x=g.x+(w*b.x+T*y.x),f.y=g.y+(w*b.y+T*y.y),f.z=g.z+(w*b.z+T*y.z),h.push(f.x,f.y,f.z),m.subVectors(f,g).normalize(),p.push(m.x,m.y,m.z),d.push(l/r),d.push(c/i)}}for(c=1;c<=r;c++)for(l=1;l<=i;l++){var M=(i+1)*(c-1)+(l-1),R=(i+1)*c+(l-1),S=(i+1)*c+l,P=(i+1)*(c-1)+l;u.push(M,R,P),u.push(R,S,P)}this.setIndex(u),this.addAttribute("position",new F(h,3)),this.addAttribute("normal",new F(p,3)),this.addAttribute("uv",new F(d,2))}function qt(e,t,r,i,n){M.call(this),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:r,tubularSegments:i,arc:n},this.fromBufferGeometry(new Gt(e,t,r,i,n)),this.mergeVertices()}function Gt(e,t,r,i,n){N.call(this),this.type="TorusBufferGeometry",this.parameters={radius:e,tube:t,radialSegments:r,tubularSegments:i,arc:n},e=e||1,t=t||.4,r=Math.floor(r)||8,i=Math.floor(i)||6,n=n||2*Math.PI;var a,s,l=[],c=[],u=[],h=[],p=new o,d=new o,f=new o;for(a=0;a<=r;a++)for(s=0;s<=i;s++){var m=s/i*n,g=a/r*Math.PI*2;d.x=(e+t*Math.cos(g))*Math.cos(m),d.y=(e+t*Math.cos(g))*Math.sin(m),d.z=t*Math.sin(g),c.push(d.x,d.y,d.z),p.x=e*Math.cos(m),p.y=e*Math.sin(m),f.subVectors(d,p).normalize(),u.push(f.x,f.y,f.z),h.push(s/i),h.push(a/r)}for(a=1;a<=r;a++)for(s=1;s<=i;s++){var v=(i+1)*a+s-1,y=(i+1)*(a-1)+s-1,E=(i+1)*(a-1)+s,b=(i+1)*a+s;l.push(v,y,b),l.push(y,E,b)}this.setIndex(l),this.addAttribute("position",new F(c,3)),this.addAttribute("normal",new F(u,3)),this.addAttribute("uv",new F(h,2))}function Wt(e,t,r,i,n){var o,a;if(n===function(e,t,r,i){for(var n=0,o=t,a=r-i;o<r;o+=i)n+=(e[a]-e[o])*(e[o+1]+e[a+1]),a=o;return n}(e,t,r,i)>0)for(o=t;o<r;o+=i)a=nr(o,e[o],e[o+1],a);else for(o=r-i;o>=t;o-=i)a=nr(o,e[o],e[o+1],a);return a&&er(a,a.next)&&(or(a),a=a.next),a}function Xt(e,t){if(!e)return e;t||(t=e);var r,i=e;do{if(r=!1,i.steiner||!er(i,i.next)&&0!==$t(i.prev,i,i.next))i=i.next;else{if(or(i),(i=t=i.prev)===i.next)break;r=!0}}while(r||i!==t);return t}function Yt(e,t,r,i,n,o,a){if(e){!a&&o&&function(e,t,r,i){var n=e;do{null===n.z&&(n.z=Kt(n.x,n.y,t,r,i)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next}while(n!==e);n.prevZ.nextZ=null,n.prevZ=null,function(e){var t,r,i,n,o,a,s,l,c=1;do{for(r=e,e=null,o=null,a=0;r;){for(a++,i=r,s=0,t=0;t<c&&(s++,i=i.nextZ);t++);for(l=c;s>0||l>0&&i;)0!==s&&(0===l||!i||r.z<=i.z)?(n=r,r=r.nextZ,s--):(n=i,i=i.nextZ,l--),o?o.nextZ=n:e=n,n.prevZ=o,o=n;r=i}o.nextZ=null,c*=2}while(a>1)}(n)}(e,i,n,o);for(var s,l,c=e;e.prev!==e.next;)if(s=e.prev,l=e.next,o?function(e,t,r,i){var n=e.prev,o=e,a=e.next;if($t(n,o,a)>=0)return!1;var s=n.x<o.x?n.x<a.x?n.x:a.x:o.x<a.x?o.x:a.x,l=n.y<o.y?n.y<a.y?n.y:a.y:o.y<a.y?o.y:a.y,c=n.x>o.x?n.x>a.x?n.x:a.x:o.x>a.x?o.x:a.x,u=n.y>o.y?n.y>a.y?n.y:a.y:o.y>a.y?o.y:a.y,h=Kt(s,l,t,r,i),p=Kt(c,u,t,r,i),d=e.nextZ;for(;d&&d.z<=p;){if(d!==e.prev&&d!==e.next&&Zt(n.x,n.y,o.x,o.y,a.x,a.y,d.x,d.y)&&$t(d.prev,d,d.next)>=0)return!1;d=d.nextZ}d=e.prevZ;for(;d&&d.z>=h;){if(d!==e.prev&&d!==e.next&&Zt(n.x,n.y,o.x,o.y,a.x,a.y,d.x,d.y)&&$t(d.prev,d,d.next)>=0)return!1;d=d.prevZ}return!0}(e,i,n,o):function(e){var t=e.prev,r=e,i=e.next;if($t(t,r,i)>=0)return!1;var n=e.next.next;for(;n!==e.prev;){if(Zt(t.x,t.y,r.x,r.y,i.x,i.y,n.x,n.y)&&$t(n.prev,n,n.next)>=0)return!1;n=n.next}return!0}(e))t.push(s.i/r),t.push(e.i/r),t.push(l.i/r),or(e),e=l.next,c=l.next;else if((e=l)===c){a?1===a?Yt(e=function(e,t,r){var i=e;do{var n=i.prev,o=i.next.next;!er(n,o)&&tr(n,i,i.next,o)&&rr(n,o)&&rr(o,n)&&(t.push(n.i/r),t.push(i.i/r),t.push(o.i/r),or(i),or(i.next),i=e=o),i=i.next}while(i!==e);return i}(e,t,r),t,r,i,n,o,2):2===a&&function(e,t,r,i,n,o){var a=e;do{for(var s=a.next.next;s!==a.prev;){if(a.i!==s.i&&function(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var r=e;do{if(r.i!==e.i&&r.next.i!==e.i&&r.i!==t.i&&r.next.i!==t.i&&tr(r,r.next,e,t))return!0;r=r.next}while(r!==e);return!1}(e,t)&&rr(e,t)&&rr(t,e)&&function(e,t){var r=e,i=!1,n=(e.x+t.x)/2,o=(e.y+t.y)/2;do{r.y>o!=r.next.y>o&&r.next.y!==r.y&&n<(r.next.x-r.x)*(o-r.y)/(r.next.y-r.y)+r.x&&(i=!i),r=r.next}while(r!==e);return i}(e,t)}(a,s)){var l=ir(a,s);return a=Xt(a,a.next),l=Xt(l,l.next),Yt(a,t,r,i,n,o),void Yt(l,t,r,i,n,o)}s=s.next}a=a.next}while(a!==e)}(e,t,r,i,n,o):Yt(Xt(e),t,r,i,n,o,1);break}}}function Qt(e,t,r,i){var n,o,a,s=[];for(n=0,o=t.length;n<o;n++)(a=Wt(e,t[n]*i,n<o-1?t[n+1]*i:e.length,i,!1))===a.next&&(a.steiner=!0),s.push(function(e){var t=e,r=e;do{t.x<r.x&&(r=t),t=t.next}while(t!==e);return r}(a));for(s.sort(Jt),n=0;n<s.length;n++)!function(e,t){if(t=function(e,t){var r,i=t,n=e.x,o=e.y,a=-1/0;do{if(o<=i.y&&o>=i.next.y&&i.next.y!==i.y){var s=i.x+(o-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(s<=n&&s>a){if(a=s,s===n){if(o===i.y)return i;if(o===i.next.y)return i.next}r=i.x<i.next.x?i:i.next}}i=i.next}while(i!==t);if(!r)return null;if(n===a)return r.prev;var l,c=r,u=r.x,h=r.y,p=1/0;for(i=r.next;i!==c;)n>=i.x&&i.x>=u&&n!==i.x&&Zt(o<h?n:a,o,u,h,o<h?a:n,o,i.x,i.y)&&((l=Math.abs(o-i.y)/(n-i.x))<p||l===p&&i.x>r.x)&&rr(i,e)&&(r=i,p=l),i=i.next;return r}(e,t)){var r=ir(t,e);Xt(r,r.next)}}(s[n],r),r=Xt(r,r.next);return r}function Jt(e,t){return e.x-t.x}function Kt(e,t,r,i,n){return e=32767*(e-r)*n,t=32767*(t-i)*n,e=16711935&(e|e<<8),e=252645135&(e|e<<4),e=858993459&(e|e<<2),e=1431655765&(e|e<<1),t=16711935&(t|t<<8),t=252645135&(t|t<<4),t=858993459&(t|t<<2),t=1431655765&(t|t<<1),e|t<<1}function Zt(e,t,r,i,n,o,a,s){return(n-a)*(t-s)-(e-a)*(o-s)>=0&&(e-a)*(i-s)-(r-a)*(t-s)>=0&&(r-a)*(o-s)-(n-a)*(i-s)>=0}function $t(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function er(e,t){return e.x===t.x&&e.y===t.y}function tr(e,t,r,i){return!!(er(e,t)&&er(r,i)||er(e,i)&&er(r,t))||$t(e,t,r)>0!=$t(e,t,i)>0&&$t(r,i,e)>0!=$t(r,i,t)>0}function rr(e,t){return $t(e.prev,e,e.next)<0?$t(e,t,e.next)>=0&&$t(e,e.prev,t)>=0:$t(e,t,e.prev)<0||$t(e,e.next,t)<0}function ir(e,t){var r=new ar(e.i,e.x,e.y),i=new ar(t.i,t.x,t.y),n=e.next,o=t.prev;return e.next=t,t.prev=e,r.next=n,n.prev=r,i.next=r,r.prev=i,o.next=i,i.prev=o,i}function nr(e,t,r,i){var n=new ar(e,t,r);return i?(n.next=i.next,n.prev=i,i.next.prev=n,i.next=n):(n.prev=n,n.next=n),n}function or(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function ar(e,t,r){this.i=e,this.x=t,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function sr(e){var t=e.length;t>2&&e[t-1].equals(e[0])&&e.pop()}function lr(e,t){for(var r=0;r<t.length;r++)e.push(t[r].x),e.push(t[r].y)}function cr(e,t){M.call(this),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},this.fromBufferGeometry(new ur(e,t)),this.mergeVertices()}function ur(e,t){N.call(this),this.type="ExtrudeBufferGeometry",this.parameters={shapes:e,options:t};for(var i=this,n=[],a=[],s=0,l=(e=Array.isArray(e)?e:[e]).length;s<l;s++){!function(e){function s(e,t,r){return t||console.error("THREE.ExtrudeGeometry: vec does not exist"),t.clone().multiplyScalar(r).add(e)}function l(e,t,i){var n,o,a,s=e.x-t.x,l=e.y-t.y,c=i.x-e.x,u=i.y-e.y,h=s*s+l*l,p=s*u-l*c;if(Math.abs(p)>Number.EPSILON){var d=Math.sqrt(h),f=Math.sqrt(c*c+u*u),m=t.x-l/d,g=t.y+s/d,v=((i.x-u/f-m)*u-(i.y+c/f-g)*c)/(s*u-l*c),y=(n=m+s*v-e.x)*n+(o=g+l*v-e.y)*o;if(y<=2)return new r(n,o);a=Math.sqrt(y/2)}else{var E=!1;s>Number.EPSILON?c>Number.EPSILON&&(E=!0):s<-Number.EPSILON?c<-Number.EPSILON&&(E=!0):Math.sign(l)===Math.sign(u)&&(E=!0),E?(n=-l,o=s,a=Math.sqrt(h)):(n=s,o=l,a=Math.sqrt(h/2))}return new r(n/a,o/a)}function c(e,t){var r,o;for(X=e.length;--X>=0;){r=X,(o=X-1)<0&&(o=e.length-1);var a=0,s=g+2*x;for(a=0;a<s;a++){var l=q*a,c=q*(a+1);!function(e,o,a,s){p(t+r+l),p(o),p(s),p(o),p(a),p(s);var c=n.length/3,u=w.generateSideWallUV(i,n,c-6,c-3,c-2,c-1);d(u[0]),d(u[1]),d(u[3]),d(u[1]),d(u[2]),d(u[3])}(0,t+o+l,t+o+c,t+r+c)}}}function u(e,t,r){f.push(e),f.push(t),f.push(r)}function h(e,t,r){p(e),p(t),p(r);var o=n.length/3,a=w.generateTopUV(i,n,o-3,o-2,o-1);d(a[0]),d(a[1]),d(a[2])}function p(e){n.push(f[3*e+0]),n.push(f[3*e+1]),n.push(f[3*e+2])}function d(e){a.push(e.x),a.push(e.y)}var f=[],m=void 0!==t.curveSegments?t.curveSegments:12,g=void 0!==t.steps?t.steps:1,v=void 0!==t.depth?t.depth:100,y=void 0===t.bevelEnabled||t.bevelEnabled,E=void 0!==t.bevelThickness?t.bevelThickness:6,b=void 0!==t.bevelSize?t.bevelSize:E-2,x=void 0!==t.bevelSegments?t.bevelSegments:3,_=t.extrudePath,w=void 0!==t.UVGenerator?t.UVGenerator:Fs;void 0!==t.amount&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),v=t.amount);var T,M,R,S,P,A=!1;_&&(T=_.getSpacedPoints(g),A=!0,y=!1,M=_.computeFrenetFrames(g,!1),R=new o,S=new o,P=new o),y||(x=0,E=0,b=0);var C,L,O,H=e.extractPoints(m),F=H.shape,I=H.holes;if(!Hs.isClockWise(F))for(F=F.reverse(),L=0,O=I.length;L<O;L++)C=I[L],Hs.isClockWise(C)&&(I[L]=C.reverse());var k=Hs.triangulateShape(F,I),D=F;for(L=0,O=I.length;L<O;L++)C=I[L],F=F.concat(C);for(var N,j,U,B,V,z,q=F.length,G=k.length,W=[],X=0,Y=D.length,Q=Y-1,J=X+1;X<Y;X++,Q++,J++)Q===Y&&(Q=0),J===Y&&(J=0),W[X]=l(D[X],D[Q],D[J]);var K,Z=[],$=W.concat();for(L=0,O=I.length;L<O;L++){for(C=I[L],K=[],X=0,Q=(Y=C.length)-1,J=X+1;X<Y;X++,Q++,J++)Q===Y&&(Q=0),J===Y&&(J=0),K[X]=l(C[X],C[Q],C[J]);Z.push(K),$=$.concat(K)}for(N=0;N<x;N++){for(U=N/x,B=E*Math.cos(U*Math.PI/2),j=b*Math.sin(U*Math.PI/2),X=0,Y=D.length;X<Y;X++)u((V=s(D[X],W[X],j)).x,V.y,-B);for(L=0,O=I.length;L<O;L++)for(C=I[L],K=Z[L],X=0,Y=C.length;X<Y;X++)u((V=s(C[X],K[X],j)).x,V.y,-B)}for(j=b,X=0;X<q;X++)V=y?s(F[X],$[X],j):F[X],A?(S.copy(M.normals[0]).multiplyScalar(V.x),R.copy(M.binormals[0]).multiplyScalar(V.y),P.copy(T[0]).add(S).add(R),u(P.x,P.y,P.z)):u(V.x,V.y,0);var ee;for(ee=1;ee<=g;ee++)for(X=0;X<q;X++)V=y?s(F[X],$[X],j):F[X],A?(S.copy(M.normals[ee]).multiplyScalar(V.x),R.copy(M.binormals[ee]).multiplyScalar(V.y),P.copy(T[ee]).add(S).add(R),u(P.x,P.y,P.z)):u(V.x,V.y,v/g*ee);for(N=x-1;N>=0;N--){for(U=N/x,B=E*Math.cos(U*Math.PI/2),j=b*Math.sin(U*Math.PI/2),X=0,Y=D.length;X<Y;X++)u((V=s(D[X],W[X],j)).x,V.y,v+B);for(L=0,O=I.length;L<O;L++)for(C=I[L],K=Z[L],X=0,Y=C.length;X<Y;X++)V=s(C[X],K[X],j),A?u(V.x,V.y+T[g-1].y,T[g-1].x+B):u(V.x,V.y,v+B)}!function(){var e=n.length/3;if(y){var t=0,r=q*t;for(X=0;X<G;X++)h((z=k[X])[2]+r,z[1]+r,z[0]+r);for(r=q*(t=g+2*x),X=0;X<G;X++)h((z=k[X])[0]+r,z[1]+r,z[2]+r)}else{for(X=0;X<G;X++)h((z=k[X])[2],z[1],z[0]);for(X=0;X<G;X++)h((z=k[X])[0]+q*g,z[1]+q*g,z[2]+q*g)}i.addGroup(e,n.length/3-e,0)}(),function(){var e=n.length/3,t=0;for(c(D,t),t+=D.length,L=0,O=I.length;L<O;L++)c(C=I[L],t),t+=C.length;i.addGroup(e,n.length/3-e,1)}()}(e[s])}this.addAttribute("position",new F(n,3)),this.addAttribute("uv",new F(a,2)),this.computeVertexNormals()}function hr(e,t,r){if(r.shapes=[],Array.isArray(e))for(var i=0,n=e.length;i<n;i++){var o=e[i];r.shapes.push(o.uuid)}else r.shapes.push(e.uuid);return void 0!==t.extrudePath&&(r.options.extrudePath=t.extrudePath.toJSON()),r}function pr(e,t){M.call(this),this.type="TextGeometry",this.parameters={text:e,parameters:t},this.fromBufferGeometry(new dr(e,t)),this.mergeVertices()}function dr(e,t){var r=(t=t||{}).font;if(!r||!r.isFont)return console.error("THREE.TextGeometry: font parameter is not an instance of THREE.Font."),new M;var i=r.generateShapes(e,t.size);t.depth=void 0!==t.height?t.height:50,void 0===t.bevelThickness&&(t.bevelThickness=10),void 0===t.bevelSize&&(t.bevelSize=8),void 0===t.bevelEnabled&&(t.bevelEnabled=!1),ur.call(this,i,t),this.type="TextBufferGeometry"}function fr(e,t,r,i,n,o,a){M.call(this),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:r,phiStart:i,phiLength:n,thetaStart:o,thetaLength:a},this.fromBufferGeometry(new mr(e,t,r,i,n,o,a)),this.mergeVertices()}function mr(e,t,r,i,n,a,s){N.call(this),this.type="SphereBufferGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:r,phiStart:i,phiLength:n,thetaStart:a,thetaLength:s},e=e||1,t=Math.max(3,Math.floor(t)||8),r=Math.max(2,Math.floor(r)||6),i=void 0!==i?i:0,n=void 0!==n?n:2*Math.PI;var l,c,u=(a=void 0!==a?a:0)+(s=void 0!==s?s:Math.PI),h=0,p=[],d=new o,f=new o,m=[],g=[],v=[],y=[];for(c=0;c<=r;c++){var E=[],b=c/r;for(l=0;l<=t;l++){var x=l/t;d.x=-e*Math.cos(i+x*n)*Math.sin(a+b*s),d.y=e*Math.cos(a+b*s),d.z=e*Math.sin(i+x*n)*Math.sin(a+b*s),g.push(d.x,d.y,d.z),f.set(d.x,d.y,d.z).normalize(),v.push(f.x,f.y,f.z),y.push(x,1-b),E.push(h++)}p.push(E)}for(c=0;c<r;c++)for(l=0;l<t;l++){var _=p[c][l+1],w=p[c][l],T=p[c+1][l],M=p[c+1][l+1];(0!==c||a>0)&&m.push(_,w,M),(c!==r-1||u<Math.PI)&&m.push(w,T,M)}this.setIndex(m),this.addAttribute("position",new F(g,3)),this.addAttribute("normal",new F(v,3)),this.addAttribute("uv",new F(y,2))}function gr(e,t,r,i,n,o){M.call(this),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:r,phiSegments:i,thetaStart:n,thetaLength:o},this.fromBufferGeometry(new vr(e,t,r,i,n,o)),this.mergeVertices()}function vr(e,t,i,n,a,s){N.call(this),this.type="RingBufferGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:i,phiSegments:n,thetaStart:a,thetaLength:s},e=e||.5,t=t||1,a=void 0!==a?a:0,s=void 0!==s?s:2*Math.PI,i=void 0!==i?Math.max(3,i):8;var l,c,u,h=[],p=[],d=[],f=[],m=e,g=(t-e)/(n=void 0!==n?Math.max(1,n):1),v=new o,y=new r;for(c=0;c<=n;c++){for(u=0;u<=i;u++)l=a+u/i*s,v.x=m*Math.cos(l),v.y=m*Math.sin(l),p.push(v.x,v.y,v.z),d.push(0,0,1),y.x=(v.x/t+1)/2,y.y=(v.y/t+1)/2,f.push(y.x,y.y);m+=g}for(c=0;c<n;c++){var E=c*(i+1);for(u=0;u<i;u++){var b=l=u+E,x=l+i+1,_=l+i+2,w=l+1;h.push(b,x,w),h.push(x,_,w)}}this.setIndex(h),this.addAttribute("position",new F(p,3)),this.addAttribute("normal",new F(d,3)),this.addAttribute("uv",new F(f,2))}function yr(e,t,r,i){M.call(this),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:r,phiLength:i},this.fromBufferGeometry(new Er(e,t,r,i)),this.mergeVertices()}function Er(e,t,i,n){N.call(this),this.type="LatheBufferGeometry",this.parameters={points:e,segments:t,phiStart:i,phiLength:n},t=Math.floor(t)||12,i=i||0,n=n||2*Math.PI,n=os.clamp(n,0,2*Math.PI);var a,s,l,c=[],u=[],h=[],p=1/t,d=new o,f=new r;for(s=0;s<=t;s++){var m=i+s*p*n,g=Math.sin(m),v=Math.cos(m);for(l=0;l<=e.length-1;l++)d.x=e[l].x*g,d.y=e[l].y,d.z=e[l].x*v,u.push(d.x,d.y,d.z),f.x=s/t,f.y=l/(e.length-1),h.push(f.x,f.y)}for(s=0;s<t;s++)for(l=0;l<e.length-1;l++){var y=a=l+s*e.length,E=a+e.length,b=a+e.length+1,x=a+1;c.push(y,E,x),c.push(E,b,x)}if(this.setIndex(c),this.addAttribute("position",new F(u,3)),this.addAttribute("uv",new F(h,2)),this.computeVertexNormals(),n===2*Math.PI){var _=this.attributes.normal.array,w=new o,T=new o,M=new o;for(a=t*e.length*3,s=0,l=0;s<e.length;s++,l+=3)w.x=_[l+0],w.y=_[l+1],w.z=_[l+2],T.x=_[a+l+0],T.y=_[a+l+1],T.z=_[a+l+2],M.addVectors(w,T).normalize(),_[l+0]=_[a+l+0]=M.x,_[l+1]=_[a+l+1]=M.y,_[l+2]=_[a+l+2]=M.z}}function br(e,t){M.call(this),this.type="ShapeGeometry","object"==typeof t&&(console.warn("THREE.ShapeGeometry: Options parameter has been removed."),t=t.curveSegments),this.parameters={shapes:e,curveSegments:t},this.fromBufferGeometry(new xr(e,t)),this.mergeVertices()}function xr(e,t){function r(e){var r,s,c,u=n.length/3,h=e.extractPoints(t),p=h.shape,d=h.holes;if(!1===Hs.isClockWise(p))for(p=p.reverse(),r=0,s=d.length;r<s;r++)c=d[r],!0===Hs.isClockWise(c)&&(d[r]=c.reverse());var f=Hs.triangulateShape(p,d);for(r=0,s=d.length;r<s;r++)c=d[r],p=p.concat(c);for(r=0,s=p.length;r<s;r++){var m=p[r];n.push(m.x,m.y,0),o.push(0,0,1),a.push(m.x,m.y)}for(r=0,s=f.length;r<s;r++){var g=f[r],v=g[0]+u,y=g[1]+u,E=g[2]+u;i.push(v,y,E),l+=3}}N.call(this),this.type="ShapeBufferGeometry",this.parameters={shapes:e,curveSegments:t},t=t||12;var i=[],n=[],o=[],a=[],s=0,l=0;if(!1===Array.isArray(e))r(e);else for(var c=0;c<e.length;c++)r(e[c]),this.addGroup(s,l,c),s+=l,l=0;this.setIndex(i),this.addAttribute("position",new F(n,3)),this.addAttribute("normal",new F(o,3)),this.addAttribute("uv",new F(a,2))}function _r(e,t){if(t.shapes=[],Array.isArray(e))for(var r=0,i=e.length;r<i;r++){var n=e[r];t.shapes.push(n.uuid)}else t.shapes.push(e.uuid);return t}function wr(e,t){N.call(this),this.type="EdgesGeometry",this.parameters={thresholdAngle:t},t=void 0!==t?t:1;var r,i,n,o,a=[],s=Math.cos(os.DEG2RAD*t),l=[0,0],c={},u=["a","b","c"];e.isBufferGeometry?(o=new M).fromBufferGeometry(e):o=e.clone(),o.mergeVertices(),o.computeFaceNormals();for(var h=o.vertices,p=o.faces,d=0,f=p.length;d<f;d++)for(var m=p[d],g=0;g<3;g++)r=m[u[g]],i=m[u[(g+1)%3]],l[0]=Math.min(r,i),l[1]=Math.max(r,i),void 0===c[n=l[0]+","+l[1]]?c[n]={index1:l[0],index2:l[1],face1:d,face2:void 0}:c[n].face2=d;for(n in c){var v=c[n];if(void 0===v.face2||p[v.face1].normal.dot(p[v.face2].normal)<=s){var y=h[v.index1];a.push(y.x,y.y,y.z),y=h[v.index2],a.push(y.x,y.y,y.z)}}this.addAttribute("position",new F(a,3))}function Tr(e,t,r,i,n,o,a,s){M.call(this),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:r,radialSegments:i,heightSegments:n,openEnded:o,thetaStart:a,thetaLength:s},this.fromBufferGeometry(new Mr(e,t,r,i,n,o,a,s)),this.mergeVertices()}function Mr(e,t,i,n,a,s,l,c){function u(i){var a,s,u,v=new r,b=new o,x=0,_=!0===i?e:t,w=!0===i?1:-1;for(s=g,a=1;a<=n;a++)d.push(0,y*w,0),f.push(0,w,0),m.push(.5,.5),g++;for(u=g,a=0;a<=n;a++){var T=a/n*c+l,M=Math.cos(T),R=Math.sin(T);b.x=_*R,b.y=y*w,b.z=_*M,d.push(b.x,b.y,b.z),f.push(0,w,0),v.x=.5*M+.5,v.y=.5*R*w+.5,m.push(v.x,v.y),g++}for(a=0;a<n;a++){var S=s+a,P=u+a;!0===i?p.push(P,P+1,S):p.push(P+1,P,S),x+=3}h.addGroup(E,x,!0===i?1:2),E+=x}N.call(this),this.type="CylinderBufferGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:i,radialSegments:n,heightSegments:a,openEnded:s,thetaStart:l,thetaLength:c};var h=this;e=void 0!==e?e:1,t=void 0!==t?t:1,i=i||1,n=Math.floor(n)||8,a=Math.floor(a)||1,s=void 0!==s&&s,l=void 0!==l?l:0,c=void 0!==c?c:2*Math.PI;var p=[],d=[],f=[],m=[],g=0,v=[],y=i/2,E=0;!function(){var r,s,u=new o,b=new o,x=0,_=(t-e)/i;for(s=0;s<=a;s++){var w=[],T=s/a,M=T*(t-e)+e;for(r=0;r<=n;r++){var R=r/n,S=R*c+l,P=Math.sin(S),A=Math.cos(S);b.x=M*P,b.y=-T*i+y,b.z=M*A,d.push(b.x,b.y,b.z),u.set(P,_,A).normalize(),f.push(u.x,u.y,u.z),m.push(R,1-T),w.push(g++)}v.push(w)}for(r=0;r<n;r++)for(s=0;s<a;s++){var C=v[s][r],L=v[s+1][r],O=v[s+1][r+1],H=v[s][r+1];p.push(C,L,H),p.push(L,O,H),x+=6}h.addGroup(E,x,0),E+=x}(),!1===s&&(e>0&&u(!0),t>0&&u(!1)),this.setIndex(p),this.addAttribute("position",new F(d,3)),this.addAttribute("normal",new F(f,3)),this.addAttribute("uv",new F(m,2))}function Rr(e,t,r,i,n,o,a){Tr.call(this,0,e,t,r,i,n,o,a),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:r,heightSegments:i,openEnded:n,thetaStart:o,thetaLength:a}}function Sr(e,t,r,i,n,o,a){Mr.call(this,0,e,t,r,i,n,o,a),this.type="ConeBufferGeometry",this.parameters={radius:e,height:t,radialSegments:r,heightSegments:i,openEnded:n,thetaStart:o,thetaLength:a}}function Pr(e,t,r,i){M.call(this),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:r,thetaLength:i},this.fromBufferGeometry(new Ar(e,t,r,i)),this.mergeVertices()}function Ar(e,t,i,n){N.call(this),this.type="CircleBufferGeometry",this.parameters={radius:e,segments:t,thetaStart:i,thetaLength:n},e=e||1,t=void 0!==t?Math.max(3,t):8,i=void 0!==i?i:0,n=void 0!==n?n:2*Math.PI;var a,s,l=[],c=[],u=[],h=[],p=new o,d=new r;for(c.push(0,0,0),u.push(0,0,1),h.push(.5,.5),s=0,a=3;s<=t;s++,a+=3){var f=i+s/t*n;p.x=e*Math.cos(f),p.y=e*Math.sin(f),c.push(p.x,p.y,p.z),u.push(0,0,1),d.x=(c[a]/e+1)/2,d.y=(c[a+1]/e+1)/2,h.push(d.x,d.y)}for(a=1;a<=t;a++)l.push(a,a+1,0);this.setIndex(l),this.addAttribute("position",new F(c,3)),this.addAttribute("normal",new F(u,3)),this.addAttribute("uv",new F(h,2))}function Cr(e){z.call(this),this.type="ShadowMaterial",this.color=new y(0),this.transparent=!0,this.setValues(e)}function Lr(e){q.call(this,e),this.type="RawShaderMaterial"}function Or(e){z.call(this),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new y(16777215),this.roughness=.5,this.metalness=.5,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new y(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=is,this.normalScale=new r(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function Hr(e){Or.call(this),this.defines={PHYSICAL:""},this.type="MeshPhysicalMaterial",this.reflectivity=.5,this.clearCoat=0,this.clearCoatRoughness=0,this.setValues(e)}function Fr(e){z.call(this),this.type="MeshPhongMaterial",this.color=new y(16777215),this.specular=new y(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new y(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=is,this.normalScale=new r(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Po,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function Ir(e){Fr.call(this),this.defines={TOON:""},this.type="MeshToonMaterial",this.gradientMap=null,this.setValues(e)}function kr(e){z.call(this),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=is,this.normalScale=new r(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function Dr(e){z.call(this),this.type="MeshLambertMaterial",this.color=new y(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new y(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Po,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function Nr(e){z.call(this),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new y(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=is,this.normalScale=new r(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.lights=!1,this.setValues(e)}function jr(e){vt.call(this),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}function Ur(e,t,r,i){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=void 0!==i?i:new t.constructor(r),this.sampleValues=t,this.valueSize=r}function Br(e,t,r,i){Ur.call(this,e,t,r,i),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0}function Vr(e,t,r,i){Ur.call(this,e,t,r,i)}function zr(e,t,r,i){Ur.call(this,e,t,r,i)}function qr(e,t,r,i){if(void 0===e)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===t||0===t.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=Ds.convertArray(t,this.TimeBufferType),this.values=Ds.convertArray(r,this.ValueBufferType),this.setInterpolation(i||this.DefaultInterpolation)}function Gr(e,t,r){qr.call(this,e,t,r)}function Wr(e,t,r,i){qr.call(this,e,t,r,i)}function Xr(e,t,r,i){qr.call(this,e,t,r,i)}function Yr(e,t,r,i){Ur.call(this,e,t,r,i)}function Qr(e,t,r,i){qr.call(this,e,t,r,i)}function Jr(e,t,r,i){qr.call(this,e,t,r,i)}function Kr(e,t,r,i){qr.call(this,e,t,r,i)}function Zr(e,t,r){this.name=e,this.tracks=r,this.duration=void 0!==t?t:-1,this.uuid=os.generateUUID(),this.duration<0&&this.resetDuration()}function $r(e){if(void 0===e.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");var t=function(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Xr;case"vector":case"vector2":case"vector3":case"vector4":return Kr;case"color":return Wr;case"quaternion":return Qr;case"bool":case"boolean":return Gr;case"string":return Jr}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+e)}(e.type);if(void 0===e.times){var r=[],i=[];Ds.flattenJSON(e.keys,r,i,"value"),e.times=r,e.values=i}return void 0!==t.parse?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)}function ei(e,t,r){var i=this,n=!1,o=0,a=0,s=void 0;this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=r,this.itemStart=function(e){a++,!1===n&&void 0!==i.onStart&&i.onStart(e,o,a),n=!0},this.itemEnd=function(e){o++,void 0!==i.onProgress&&i.onProgress(e,o,a),o===a&&(n=!1,void 0!==i.onLoad&&i.onLoad())},this.itemError=function(e){void 0!==i.onError&&i.onError(e)},this.resolveURL=function(e){return s?s(e):e},this.setURLModifier=function(e){return s=e,this}}function ti(e){this.manager=void 0!==e?e:js}function ri(e){this.manager=void 0!==e?e:js}function ii(e){this.manager=void 0!==e?e:js,this._parser=null}function ni(e){this.manager=void 0!==e?e:js,this._parser=null}function oi(e){this.manager=void 0!==e?e:js}function ai(e){this.manager=void 0!==e?e:js}function si(e){this.manager=void 0!==e?e:js}function li(){this.type="Curve",this.arcLengthDivisions=200}function ci(e,t,r,i,n,o,a,s){li.call(this),this.type="EllipseCurve",this.aX=e||0,this.aY=t||0,this.xRadius=r||1,this.yRadius=i||1,this.aStartAngle=n||0,this.aEndAngle=o||2*Math.PI,this.aClockwise=a||!1,this.aRotation=s||0}function ui(e,t,r,i,n,o){ci.call(this,e,t,r,r,i,n,o),this.type="ArcCurve"}function hi(){function e(e,o,a,s){t=e,r=a,i=-3*e+3*o-2*a-s,n=2*e-2*o+a+s}var t=0,r=0,i=0,n=0;return{initCatmullRom:function(t,r,i,n,o){e(r,i,o*(i-t),o*(n-r))},initNonuniformCatmullRom:function(t,r,i,n,o,a,s){var l=(r-t)/o-(i-t)/(o+a)+(i-r)/a,c=(i-r)/a-(n-r)/(a+s)+(n-i)/s;e(r,i,l*=a,c*=a)},calc:function(e){var o=e*e;return t+r*e+i*o+n*(o*e)}}}function pi(e,t,r,i){li.call(this),this.type="CatmullRomCurve3",this.points=e||[],this.closed=t||!1,this.curveType=r||"centripetal",this.tension=i||.5}function di(e,t,r,i,n){var o=.5*(i-t),a=.5*(n-r),s=e*e;return(2*r-2*i+o+a)*(e*s)+(-3*r+3*i-2*o-a)*s+o*e+r}function fi(e,t,r,i){return function(e,t){var r=1-e;return r*r*t}(e,t)+function(e,t){return 2*(1-e)*e*t}(e,r)+function(e,t){return e*e*t}(e,i)}function mi(e,t,r,i,n){return function(e,t){var r=1-e;return r*r*r*t}(e,t)+function(e,t){var r=1-e;return 3*r*r*e*t}(e,r)+function(e,t){return 3*(1-e)*e*e*t}(e,i)+function(e,t){return e*e*e*t}(e,n)}function gi(e,t,i,n){li.call(this),this.type="CubicBezierCurve",this.v0=e||new r,this.v1=t||new r,this.v2=i||new r,this.v3=n||new r}function vi(e,t,r,i){li.call(this),this.type="CubicBezierCurve3",this.v0=e||new o,this.v1=t||new o,this.v2=r||new o,this.v3=i||new o}function yi(e,t){li.call(this),this.type="LineCurve",this.v1=e||new r,this.v2=t||new r}function Ei(e,t){li.call(this),this.type="LineCurve3",this.v1=e||new o,this.v2=t||new o}function bi(e,t,i){li.call(this),this.type="QuadraticBezierCurve",this.v0=e||new r,this.v1=t||new r,this.v2=i||new r}function xi(e,t,r){li.call(this),this.type="QuadraticBezierCurve3",this.v0=e||new o,this.v1=t||new o,this.v2=r||new o}function _i(e){li.call(this),this.type="SplineCurve",this.points=e||[]}function wi(){li.call(this),this.type="CurvePath",this.curves=[],this.autoClose=!1}function Ti(e){wi.call(this),this.type="Path",this.currentPoint=new r,e&&this.setFromPoints(e)}function Mi(e){Ti.call(this,e),this.uuid=os.generateUUID(),this.type="Shape",this.holes=[]}function Ri(e,t){T.call(this),this.type="Light",this.color=new y(e),this.intensity=void 0!==t?t:1,this.receiveShadow=void 0}function Si(e,t,r){Ri.call(this,e,r),this.type="HemisphereLight",this.castShadow=void 0,this.position.copy(T.DefaultUp),this.updateMatrix(),this.groundColor=new y(t)}function Pi(e){this.camera=e,this.bias=0,this.radius=1,this.mapSize=new r(512,512),this.map=null,this.matrix=new i}function Ai(){Pi.call(this,new tt(50,1,.5,500))}function Ci(e,t,r,i,n,o){Ri.call(this,e,t),this.type="SpotLight",this.position.copy(T.DefaultUp),this.updateMatrix(),this.target=new T,Object.defineProperty(this,"power",{get:function(){return this.intensity*Math.PI},set:function(e){this.intensity=e/Math.PI}}),this.distance=void 0!==r?r:0,this.angle=void 0!==i?i:Math.PI/3,this.penumbra=void 0!==n?n:0,this.decay=void 0!==o?o:1,this.shadow=new Ai}function Li(e,t,r,i){Ri.call(this,e,t),this.type="PointLight",Object.defineProperty(this,"power",{get:function(){return 4*this.intensity*Math.PI},set:function(e){this.intensity=e/(4*Math.PI)}}),this.distance=void 0!==r?r:0,this.decay=void 0!==i?i:1,this.shadow=new Pi(new tt(90,1,.5,500))}function Oi(e,t,r,i,n,o){et.call(this),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=void 0!==e?e:-1,this.right=void 0!==t?t:1,this.top=void 0!==r?r:1,this.bottom=void 0!==i?i:-1,this.near=void 0!==n?n:.1,this.far=void 0!==o?o:2e3,this.updateProjectionMatrix()}function Hi(){Pi.call(this,new Oi(-5,5,5,-5,.5,500))}function Fi(e,t){Ri.call(this,e,t),this.type="DirectionalLight",this.position.copy(T.DefaultUp),this.updateMatrix(),this.target=new T,this.shadow=new Hi}function Ii(e,t){Ri.call(this,e,t),this.type="AmbientLight",this.castShadow=void 0}function ki(e,t,r,i){Ri.call(this,e,t),this.type="RectAreaLight",this.width=void 0!==r?r:10,this.height=void 0!==i?i:10}function Di(e){this.manager=void 0!==e?e:js,this.textures={}}function Ni(e){this.manager=void 0!==e?e:js}function ji(e){this.manager=void 0!==e?e:js,this.resourcePath=""}function Ui(e){"undefined"==typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"==typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.manager=void 0!==e?e:js,this.options=void 0}function Bi(){this.type="ShapePath",this.color=new y,this.subPaths=[],this.currentPath=null}function Vi(e){this.type="Font",this.data=e}function zi(e,t,r){for(var i=Array.from?Array.from(e):String(e).split(""),n=t/r.resolution,o=(r.boundingBox.yMax-r.boundingBox.yMin+r.underlineThickness)*n,a=[],s=0,l=0,c=0;c<i.length;c++){var u=i[c];if("\n"===u)s=0,l-=o;else{var h=function(e,t,r,i,n){var o=n.glyphs[e]||n.glyphs["?"];if(!o)return;var a,s,l,c,u,h,p,d,f=new Bi;if(o.o)for(var m=o._cachedOutline||(o._cachedOutline=o.o.split(" ")),g=0,v=m.length;g<v;){switch(m[g++]){case"m":a=m[g++]*t+r,s=m[g++]*t+i,f.moveTo(a,s);break;case"l":a=m[g++]*t+r,s=m[g++]*t+i,f.lineTo(a,s);break;case"q":l=m[g++]*t+r,c=m[g++]*t+i,u=m[g++]*t+r,h=m[g++]*t+i,f.quadraticCurveTo(u,h,l,c);break;case"b":l=m[g++]*t+r,c=m[g++]*t+i,u=m[g++]*t+r,h=m[g++]*t+i,p=m[g++]*t+r,d=m[g++]*t+i,f.bezierCurveTo(u,h,p,d,l,c)}}return{offsetX:o.ha*t,path:f}}(u,n,s,l,r);s+=h.offsetX,a.push(h.path)}}return a}function qi(e){this.manager=void 0!==e?e:js}function Gi(){}function Wi(e){this.manager=void 0!==e?e:js}function Xi(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new tt,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new tt,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1}function Yi(e,t,r,i){T.call(this),this.type="CubeCamera";var n=new tt(90,1,e,t);n.up.set(0,-1,0),n.lookAt(new o(1,0,0)),this.add(n);var a=new tt(90,1,e,t);a.up.set(0,-1,0),a.lookAt(new o(-1,0,0)),this.add(a);var s=new tt(90,1,e,t);s.up.set(0,0,1),s.lookAt(new o(0,1,0)),this.add(s);var l=new tt(90,1,e,t);l.up.set(0,0,-1),l.lookAt(new o(0,-1,0)),this.add(l);var c=new tt(90,1,e,t);c.up.set(0,-1,0),c.lookAt(new o(0,0,1)),this.add(c);var h=new tt(90,1,e,t);h.up.set(0,-1,0),h.lookAt(new o(0,0,-1)),this.add(h),i=i||{format:pa,magFilter:Jo,minFilter:Jo},this.renderTarget=new u(r,r,i),this.renderTarget.texture.name="CubeCamera",this.update=function(e,t){null===this.parent&&this.updateMatrixWorld();var r=this.renderTarget,i=r.texture.generateMipmaps;r.texture.generateMipmaps=!1,r.activeCubeFace=0,e.render(t,n,r),r.activeCubeFace=1,e.render(t,a,r),r.activeCubeFace=2,e.render(t,s,r),r.activeCubeFace=3,e.render(t,l,r),r.activeCubeFace=4,e.render(t,c,r),r.texture.generateMipmaps=i,r.activeCubeFace=5,e.render(t,h,r),e.setRenderTarget(null)},this.clear=function(e,t,r,i){for(var n=this.renderTarget,o=0;o<6;o++)n.activeCubeFace=o,e.setRenderTarget(n),e.clear(t,r,i);e.setRenderTarget(null)}}function Qi(e){this.autoStart=void 0===e||e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}function Ji(){T.call(this),this.type="AudioListener",this.context=Zs.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0}function Ki(e){T.call(this),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.startTime=0,this.offset=0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.sourceType="empty",this.filters=[]}function Zi(e){Ki.call(this,e),this.panner=this.context.createPanner(),this.panner.connect(this.gain)}function $i(e,t){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=void 0!==t?t:2048,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}function en(e,t,r){this.binding=e,this.valueSize=r;var i,n=Float64Array;switch(t){case"quaternion":i=this._slerp;break;case"string":case"bool":n=Array,i=this._select;break;default:i=this._lerp}this.buffer=new n(4*r),this._mixBufferRegion=i,this.cumulativeWeight=0,this.useCount=0,this.referenceCount=0}function tn(e,t,r){var i=r||rn.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,i)}function rn(e,t,r){this.path=t,this.parsedPath=r||rn.parseTrackName(t),this.node=rn.findNode(e,this.parsedPath.nodeName)||e,this.rootNode=e}function nn(){this.uuid=os.generateUUID(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;var e={};this._indicesByUUID=e;for(var t=0,r=arguments.length;t!==r;++t)e[arguments[t].uuid]=t;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};var i=this;this.stats={objects:{get total(){return i._objects.length},get inUse(){return this.total-i.nCachedObjects_}},get bindingsPerObject(){return i._bindings.length}}}function on(e,t,r){this._mixer=e,this._clip=t,this._localRoot=r||null;for(var i=t.tracks,n=i.length,o=new Array(n),a={endingStart:qa,endingEnd:qa},s=0;s!==n;++s){var l=i[s].createInterpolant(null);o[s]=l,l.settings=a}this._interpolantSettings=a,this._interpolants=o,this._propertyBindings=new Array(n),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=za,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}function an(e){this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}function sn(e){"string"==typeof e&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),e=arguments[1]),this.value=e}function ln(){N.call(this),this.type="InstancedBufferGeometry",this.maxInstancedCount=void 0}function cn(e,t,r){ct.call(this,e,t),this.meshPerAttribute=r||1}function un(e,t,r,i){"number"==typeof r&&(i=r,r=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),R.call(this,e,t,r),this.meshPerAttribute=i||1}function hn(e,t,r,i){this.ray=new G(e,t),this.near=r||0,this.far=i||1/0,this.params={Mesh:{},Line:{},LOD:{},Points:{threshold:1},Sprite:{}},Object.defineProperties(this.params,{PointCloud:{get:function(){return console.warn("THREE.Raycaster: params.PointCloud has been renamed to params.Points."),this.Points}}})}function pn(e,t){return e.distance-t.distance}function dn(e,t,r,i){if(!1!==e.visible&&(e.raycast(t,r),!0===i))for(var n=e.children,o=0,a=n.length;o<a;o++)dn(n[o],t,r,!0)}function fn(e,t,r){return this.radius=void 0!==e?e:1,this.phi=void 0!==t?t:0,this.theta=void 0!==r?r:0,this}function mn(e,t,r){return this.radius=void 0!==e?e:1,this.theta=void 0!==t?t:0,this.y=void 0!==r?r:0,this}function gn(e,t){this.min=void 0!==e?e:new r(1/0,1/0),this.max=void 0!==t?t:new r(-1/0,-1/0)}function vn(e,t){this.start=void 0!==e?e:new o,this.end=void 0!==t?t:new o}function yn(e){T.call(this),this.material=e,this.render=function(){}}function En(e,t,r,i){this.object=e,this.size=void 0!==t?t:1;var n=void 0!==r?r:16711680,o=void 0!==i?i:1,a=0,s=this.object.geometry;s&&s.isGeometry?a=3*s.faces.length:s&&s.isBufferGeometry&&(a=s.attributes.normal.count);var l=new N,c=new F(2*a*3,3);l.addAttribute("position",c),Et.call(this,l,new vt({color:n,linewidth:o})),this.matrixAutoUpdate=!1,this.update()}function bn(e,t){T.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=t;for(var r=new N,i=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1],n=0,o=1;n<32;n++,o++){var a=n/32*Math.PI*2,s=o/32*Math.PI*2;i.push(Math.cos(a),Math.sin(a),1,Math.cos(s),Math.sin(s),1)}r.addAttribute("position",new F(i,3));var l=new vt({fog:!1});this.cone=new Et(r,l),this.add(this.cone),this.update()}function xn(e){var t=[];e&&e.isBone&&t.push(e);for(var r=0;r<e.children.length;r++)t.push.apply(t,xn(e.children[r]));return t}function _n(e){for(var t=xn(e),r=new N,i=[],n=[],o=new y(0,0,1),a=new y(0,1,0),s=0;s<t.length;s++){var l=t[s];l.parent&&l.parent.isBone&&(i.push(0,0,0),i.push(0,0,0),n.push(o.r,o.g,o.b),n.push(a.r,a.g,a.b))}r.addAttribute("position",new F(i,3)),r.addAttribute("color",new F(n,3));var c=new vt({vertexColors:Jn,depthTest:!1,depthWrite:!1,transparent:!0});Et.call(this,r,c),this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}function wn(e,t,r){this.light=e,this.light.updateMatrixWorld(),this.color=r;var i=new mr(t,4,2),n=new X({wireframe:!0,fog:!1});Y.call(this,i,n),this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}function Tn(e,t){T.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=t;var r=new vt({fog:!1}),i=new N;i.addAttribute("position",new R(new Float32Array(15),3)),this.line=new yt(i,r),this.add(this.line),this.update()}function Mn(e,t,r){T.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=r;var i=new It(t);i.rotateY(.5*Math.PI),this.material=new X({wireframe:!0,fog:!1}),void 0===this.color&&(this.material.vertexColors=Jn);var n=i.getAttribute("position"),o=new Float32Array(3*n.count);i.addAttribute("color",new R(o,3)),this.add(new Y(i,this.material)),this.update()}function Rn(e,t,r,i){e=e||10,t=t||10,r=new y(void 0!==r?r:4473924),i=new y(void 0!==i?i:8947848);for(var n=t/2,o=e/t,a=e/2,s=[],l=[],c=0,u=0,h=-a;c<=t;c++,h+=o){s.push(-a,0,h,a,0,h),s.push(h,0,-a,h,0,a);var p=c===n?r:i;p.toArray(l,u),u+=3,p.toArray(l,u),u+=3,p.toArray(l,u),u+=3,p.toArray(l,u),u+=3}var d=new N;d.addAttribute("position",new F(s,3)),d.addAttribute("color",new F(l,3));var f=new vt({vertexColors:Jn});Et.call(this,d,f)}function Sn(e,t,r,i,n,o){e=e||10,t=t||16,r=r||8,i=i||64,n=new y(void 0!==n?n:4473924),o=new y(void 0!==o?o:8947848);var a,s,l,c,u,h,p,d=[],f=[];for(c=0;c<=t;c++)l=c/t*(2*Math.PI),a=Math.sin(l)*e,s=Math.cos(l)*e,d.push(0,0,0),d.push(a,0,s),p=1&c?n:o,f.push(p.r,p.g,p.b),f.push(p.r,p.g,p.b);for(c=0;c<=r;c++)for(p=1&c?n:o,h=e-e/r*c,u=0;u<i;u++)l=u/i*(2*Math.PI),a=Math.sin(l)*h,s=Math.cos(l)*h,d.push(a,0,s),f.push(p.r,p.g,p.b),l=(u+1)/i*(2*Math.PI),a=Math.sin(l)*h,s=Math.cos(l)*h,d.push(a,0,s),f.push(p.r,p.g,p.b);var m=new N;m.addAttribute("position",new F(d,3)),m.addAttribute("color",new F(f,3));var g=new vt({vertexColors:Jn});Et.call(this,m,g)}function Pn(e,t,r,i){this.object=e,this.size=void 0!==t?t:1;var n=void 0!==r?r:16776960,o=void 0!==i?i:1,a=0,s=this.object.geometry;s&&s.isGeometry?a=s.faces.length:console.warn("THREE.FaceNormalsHelper: only THREE.Geometry is supported. Use THREE.VertexNormalsHelper, instead.");var l=new N,c=new F(2*a*3,3);l.addAttribute("position",c),Et.call(this,l,new vt({color:n,linewidth:o})),this.matrixAutoUpdate=!1,this.update()}function An(e,t,r){T.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=r,void 0===t&&(t=1);var i=new N;i.addAttribute("position",new F([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));var n=new vt({fog:!1});this.lightPlane=new yt(i,n),this.add(this.lightPlane),(i=new N).addAttribute("position",new F([0,0,0,0,0,1],3)),this.targetLine=new yt(i,n),this.add(this.targetLine),this.update()}function Cn(e){function t(e,t,i){r(e,i),r(t,i)}function r(e,t){o.push(0,0,0),a.push(t.r,t.g,t.b),void 0===s[e]&&(s[e]=[]),s[e].push(o.length/3-1)}var i=new N,n=new vt({color:16777215,vertexColors:Qn}),o=[],a=[],s={},l=new y(16755200),c=new y(16711680),u=new y(43775),h=new y(16777215),p=new y(3355443);t("n1","n2",l),t("n2","n4",l),t("n4","n3",l),t("n3","n1",l),t("f1","f2",l),t("f2","f4",l),t("f4","f3",l),t("f3","f1",l),t("n1","f1",l),t("n2","f2",l),t("n3","f3",l),t("n4","f4",l),t("p","n1",c),t("p","n2",c),t("p","n3",c),t("p","n4",c),t("u1","u2",u),t("u2","u3",u),t("u3","u1",u),t("c","t",h),t("p","c",p),t("cn1","cn2",p),t("cn3","cn4",p),t("cf1","cf2",p),t("cf3","cf4",p),i.addAttribute("position",new F(o,3)),i.addAttribute("color",new F(a,3)),Et.call(this,i,n),this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=s,this.update()}function Ln(e,t){this.object=e,void 0===t&&(t=16776960);var r=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),i=new Float32Array(24),n=new N;n.setIndex(new R(r,1)),n.addAttribute("position",new R(i,3)),Et.call(this,n,new vt({color:t})),this.matrixAutoUpdate=!1,this.update()}function On(e,t){this.type="Box3Helper",this.box=e;var r=void 0!==t?t:16776960,i=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),n=new N;n.setIndex(new R(i,1)),n.addAttribute("position",new F([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),Et.call(this,n,new vt({color:r})),this.geometry.computeBoundingSphere()}function Hn(e,t,r){this.type="PlaneHelper",this.plane=e,this.size=void 0===t?1:t;var i=void 0!==r?r:16776960,n=new N;n.addAttribute("position",new F([1,-1,1,-1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,0,0,1,0,0,0],3)),n.computeBoundingSphere(),yt.call(this,n,new vt({color:i}));var o=new N;o.addAttribute("position",new F([1,1,1,-1,1,1,-1,-1,1,1,1,1,-1,-1,1,1,-1,1],3)),o.computeBoundingSphere(),this.add(new Y(o,new X({color:i,opacity:.2,transparent:!0,depthWrite:!1})))}function Fn(e,t,r,i,n,o){T.call(this),void 0===e&&(e=new THREE.Vector3(0,0,1)),void 0===t&&(t=new THREE.Vector3(0,0,0)),void 0===r&&(r=1),void 0===i&&(i=16776960),void 0===n&&(n=.2*r),void 0===o&&(o=.2*n),void 0===$s&&(($s=new N).addAttribute("position",new F([0,0,0,0,1,0],3)),(el=new Mr(0,.5,1,5,1)).translate(0,-.5,0)),this.position.copy(t),this.line=new yt($s,new vt({color:i})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new Y(el,new X({color:i})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(r,n,o)}function In(e){var t=[0,0,0,e=e||1,0,0,0,0,0,0,e,0,0,0,0,0,0,e],r=new N;r.addAttribute("position",new F(t,3)),r.addAttribute("color",new F([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3));var i=new vt({vertexColors:Jn});Et.call(this,r,i)}function kn(e){console.warn("THREE.ClosedSplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead."),pi.call(this,e),this.type="catmullrom",this.closed=!0}function Dn(e){console.warn("THREE.SplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead."),pi.call(this,e),this.type="catmullrom"}function Nn(e){console.warn("THREE.Spline has been removed. Use THREE.CatmullRomCurve3 instead."),pi.call(this,e),this.type="catmullrom"}void 0===Number.EPSILON&&(Number.EPSILON=Math.pow(2,-52)),void 0===Number.isInteger&&(Number.isInteger=function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e}),void 0===Math.sign&&(Math.sign=function(e){return e<0?-1:e>0?1:+e}),"name"in Function.prototype==!1&&Object.defineProperty(Function.prototype,"name",{get:function(){return this.toString().match(/^\s*function\s*([^\(\s]*)/)[1]}}),void 0===Object.assign&&(Object.assign=function(e){if(void 0===e||null===e)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),r=1;r<arguments.length;r++){var i=arguments[r];if(void 0!==i&&null!==i)for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t}),Object.assign(t.prototype,{addEventListener:function(e,t){void 0===this._listeners&&(this._listeners={});var r=this._listeners;void 0===r[e]&&(r[e]=[]),-1===r[e].indexOf(t)&&r[e].push(t)},hasEventListener:function(e,t){if(void 0===this._listeners)return!1;var r=this._listeners;return void 0!==r[e]&&-1!==r[e].indexOf(t)},removeEventListener:function(e,t){if(void 0!==this._listeners){var r=this._listeners[e];if(void 0!==r){var i=r.indexOf(t);-1!==i&&r.splice(i,1)}}},dispatchEvent:function(e){if(void 0!==this._listeners){var t=this._listeners[e.type];if(void 0!==t){e.target=this;for(var r=t.slice(0),i=0,n=r.length;i<n;i++)r[i].call(this,e)}}}});var jn="99",Un=0,Bn=1,Vn=2,zn=1,qn=2,Gn=0,Wn=1,Xn=2,Yn=0,Qn=1,Jn=2,Kn=0,Zn=1,$n=2,eo=3,to=4,ro=5,io=100,no=101,oo=102,ao=103,so=104,lo=200,co=201,uo=202,ho=203,po=204,fo=205,mo=206,go=207,vo=208,yo=209,Eo=210,bo=0,xo=1,_o=2,wo=3,To=4,Mo=5,Ro=6,So=7,Po=0,Ao=1,Co=2,Lo=0,Oo=1,Ho=2,Fo=3,Io=4,ko=5,Do=301,No=302,jo=303,Uo=304,Bo=305,Vo=306,zo=307,qo=1e3,Go=1001,Wo=1002,Xo=1003,Yo=1004,Qo=1005,Jo=1006,Ko=1007,Zo=1008,$o=1009,ea=1010,ta=1011,ra=1012,ia=1013,na=1014,oa=1015,aa=1016,sa=1017,la=1018,ca=1019,ua=1020,ha=1021,pa=1022,da=1023,fa=1024,ma=1025,ga=da,va=1026,ya=1027,Ea=1028,ba=33776,xa=33777,_a=33778,wa=33779,Ta=35840,Ma=35841,Ra=35842,Sa=35843,Pa=36196,Aa=37808,Ca=37809,La=37810,Oa=37811,Ha=37812,Fa=37813,Ia=37814,ka=37815,Da=37816,Na=37817,ja=37818,Ua=37819,Ba=37820,Va=37821,za=2201,qa=2400,Ga=0,Wa=1,Xa=2,Ya=3e3,Qa=3001,Ja=3007,Ka=3002,Za=3004,$a=3005,es=3006,ts=3200,rs=3201,is=0,ns=1,os={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){for(var e=[],t=0;t<256;t++)e[t]=(t<16?"0":"")+t.toString(16);return function(){var t=4294967295*Math.random()|0,r=4294967295*Math.random()|0,i=4294967295*Math.random()|0,n=4294967295*Math.random()|0;return(e[255&t]+e[t>>8&255]+e[t>>16&255]+e[t>>24&255]+"-"+e[255&r]+e[r>>8&255]+"-"+e[r>>16&15|64]+e[r>>24&255]+"-"+e[63&i|128]+e[i>>8&255]+"-"+e[i>>16&255]+e[i>>24&255]+e[255&n]+e[n>>8&255]+e[n>>16&255]+e[n>>24&255]).toUpperCase()}}(),clamp:function(e,t,r){return Math.max(t,Math.min(r,e))},euclideanModulo:function(e,t){return(e%t+t)%t},mapLinear:function(e,t,r,i,n){return i+(e-t)*(n-i)/(r-t)},lerp:function(e,t,r){return(1-r)*e+r*t},smoothstep:function(e,t,r){return e<=t?0:e>=r?1:(e=(e-t)/(r-t))*e*(3-2*e)},smootherstep:function(e,t,r){return e<=t?0:e>=r?1:(e=(e-t)/(r-t))*e*e*(e*(6*e-15)+10)},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},degToRad:function(e){return e*os.DEG2RAD},radToDeg:function(e){return e*os.RAD2DEG},isPowerOfTwo:function(e){return 0==(e&e-1)&&0!==e},ceilPowerOfTwo:function(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))},floorPowerOfTwo:function(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))}};Object.defineProperties(r.prototype,{width:{get:function(){return this.x},set:function(e){this.x=e}},height:{get:function(){return this.y},set:function(e){this.y=e}}}),Object.assign(r.prototype,{isVector2:!0,set:function(e,t){return this.x=e,this.y=t,this},setScalar:function(e){return this.x=e,this.y=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y)},copy:function(e){return this.x=e.x,this.y=e.y,this},add:function(e,t){return void 0!==t?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)},addScalar:function(e){return this.x+=e,this.y+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this},sub:function(e,t){return void 0!==t?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)},subScalar:function(e){return this.x-=e,this.y-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this},multiply:function(e){return this.x*=e.x,this.y*=e.y,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this},divide:function(e){return this.x/=e.x,this.y/=e.y,this},divideScalar:function(e){return this.multiplyScalar(1/e)},applyMatrix3:function(e){var t=this.x,r=this.y,i=e.elements;return this.x=i[0]*t+i[3]*r+i[6],this.y=i[1]*t+i[4]*r+i[7],this},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this},clampScalar:function(){var e=new r,t=new r;return function(r,i){return e.set(r,r),t.set(i,i),this.clamp(e,t)}}(),clampLength:function(e,t){var r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(t,r)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this},negate:function(){return this.x=-this.x,this.y=-this.y,this},dot:function(e){return this.x*e.x+this.y*e.y},cross:function(e){return this.x*e.y-this.y*e.x},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)},normalize:function(){return this.divideScalar(this.length()||1)},angle:function(){var e=Math.atan2(this.y,this.x);return e<0&&(e+=2*Math.PI),e},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,r=this.y-e.y;return t*t+r*r},manhattanDistanceTo:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)},setLength:function(e){return this.normalize().multiplyScalar(e)},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this},lerpVectors:function(e,t,r){return this.subVectors(t,e).multiplyScalar(r).add(e)},equals:function(e){return e.x===this.x&&e.y===this.y},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e},fromBufferAttribute:function(e,t,r){return void 0!==r&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this},rotateAround:function(e,t){var r=Math.cos(t),i=Math.sin(t),n=this.x-e.x,o=this.y-e.y;return this.x=n*r-o*i+e.x,this.y=n*i+o*r+e.y,this}}),Object.assign(i.prototype,{isMatrix4:!0,set:function(e,t,r,i,n,o,a,s,l,c,u,h,p,d,f,m){var g=this.elements;return g[0]=e,g[4]=t,g[8]=r,g[12]=i,g[1]=n,g[5]=o,g[9]=a,g[13]=s,g[2]=l,g[6]=c,g[10]=u,g[14]=h,g[3]=p,g[7]=d,g[11]=f,g[15]=m,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},clone:function(){return(new i).fromArray(this.elements)},copy:function(e){var t=this.elements,r=e.elements;return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],t[9]=r[9],t[10]=r[10],t[11]=r[11],t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15],this},copyPosition:function(e){var t=this.elements,r=e.elements;return t[12]=r[12],t[13]=r[13],t[14]=r[14],this},extractBasis:function(e,t,r){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),r.setFromMatrixColumn(this,2),this},makeBasis:function(e,t,r){return this.set(e.x,t.x,r.x,0,e.y,t.y,r.y,0,e.z,t.z,r.z,0,0,0,0,1),this},extractRotation:function(){var e=new o;return function(t){var r=this.elements,i=t.elements,n=1/e.setFromMatrixColumn(t,0).length(),o=1/e.setFromMatrixColumn(t,1).length(),a=1/e.setFromMatrixColumn(t,2).length();return r[0]=i[0]*n,r[1]=i[1]*n,r[2]=i[2]*n,r[3]=0,r[4]=i[4]*o,r[5]=i[5]*o,r[6]=i[6]*o,r[7]=0,r[8]=i[8]*a,r[9]=i[9]*a,r[10]=i[10]*a,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,this}}(),makeRotationFromEuler:function(e){e&&e.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var t=this.elements,r=e.x,i=e.y,n=e.z,o=Math.cos(r),a=Math.sin(r),s=Math.cos(i),l=Math.sin(i),c=Math.cos(n),u=Math.sin(n);if("XYZ"===e.order){var h=o*c,p=o*u,d=a*c,f=a*u;t[0]=s*c,t[4]=-s*u,t[8]=l,t[1]=p+d*l,t[5]=h-f*l,t[9]=-a*s,t[2]=f-h*l,t[6]=d+p*l,t[10]=o*s}else if("YXZ"===e.order){var m=s*c,g=s*u,v=l*c,y=l*u;t[0]=m+y*a,t[4]=v*a-g,t[8]=o*l,t[1]=o*u,t[5]=o*c,t[9]=-a,t[2]=g*a-v,t[6]=y+m*a,t[10]=o*s}else if("ZXY"===e.order){var m=s*c,g=s*u,v=l*c,y=l*u;t[0]=m-y*a,t[4]=-o*u,t[8]=v+g*a,t[1]=g+v*a,t[5]=o*c,t[9]=y-m*a,t[2]=-o*l,t[6]=a,t[10]=o*s}else if("ZYX"===e.order){var h=o*c,p=o*u,d=a*c,f=a*u;t[0]=s*c,t[4]=d*l-p,t[8]=h*l+f,t[1]=s*u,t[5]=f*l+h,t[9]=p*l-d,t[2]=-l,t[6]=a*s,t[10]=o*s}else if("YZX"===e.order){var E=o*s,b=o*l,x=a*s,_=a*l;t[0]=s*c,t[4]=_-E*u,t[8]=x*u+b,t[1]=u,t[5]=o*c,t[9]=-a*c,t[2]=-l*c,t[6]=b*u+x,t[10]=E-_*u}else if("XZY"===e.order){var E=o*s,b=o*l,x=a*s,_=a*l;t[0]=s*c,t[4]=-u,t[8]=l*c,t[1]=E*u+_,t[5]=o*c,t[9]=b*u-x,t[2]=x*u-b,t[6]=a*c,t[10]=_*u+E}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},makeRotationFromQuaternion:function(){var e=new o(0,0,0),t=new o(1,1,1);return function(r){return this.compose(e,r,t)}}(),lookAt:function(){var e=new o,t=new o,r=new o;return function(i,n,o){var a=this.elements;return r.subVectors(i,n),0===r.lengthSq()&&(r.z=1),r.normalize(),e.crossVectors(o,r),0===e.lengthSq()&&(1===Math.abs(o.z)?r.x+=1e-4:r.z+=1e-4,r.normalize(),e.crossVectors(o,r)),e.normalize(),t.crossVectors(r,e),a[0]=e.x,a[4]=t.x,a[8]=r.x,a[1]=e.y,a[5]=t.y,a[9]=r.y,a[2]=e.z,a[6]=t.z,a[10]=r.z,this}}(),multiply:function(e,t){return void 0!==t?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)},premultiply:function(e){return this.multiplyMatrices(e,this)},multiplyMatrices:function(e,t){var r=e.elements,i=t.elements,n=this.elements,o=r[0],a=r[4],s=r[8],l=r[12],c=r[1],u=r[5],h=r[9],p=r[13],d=r[2],f=r[6],m=r[10],g=r[14],v=r[3],y=r[7],E=r[11],b=r[15],x=i[0],_=i[4],w=i[8],T=i[12],M=i[1],R=i[5],S=i[9],P=i[13],A=i[2],C=i[6],L=i[10],O=i[14],H=i[3],F=i[7],I=i[11],k=i[15];return n[0]=o*x+a*M+s*A+l*H,n[4]=o*_+a*R+s*C+l*F,n[8]=o*w+a*S+s*L+l*I,n[12]=o*T+a*P+s*O+l*k,n[1]=c*x+u*M+h*A+p*H,n[5]=c*_+u*R+h*C+p*F,n[9]=c*w+u*S+h*L+p*I,n[13]=c*T+u*P+h*O+p*k,n[2]=d*x+f*M+m*A+g*H,n[6]=d*_+f*R+m*C+g*F,n[10]=d*w+f*S+m*L+g*I,n[14]=d*T+f*P+m*O+g*k,n[3]=v*x+y*M+E*A+b*H,n[7]=v*_+y*R+E*C+b*F,n[11]=v*w+y*S+E*L+b*I,n[15]=v*T+y*P+E*O+b*k,this},multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this},applyToBufferAttribute:function(){var e=new o;return function(t){for(var r=0,i=t.count;r<i;r++)e.x=t.getX(r),e.y=t.getY(r),e.z=t.getZ(r),e.applyMatrix4(this),t.setXYZ(r,e.x,e.y,e.z);return t}}(),determinant:function(){var e=this.elements,t=e[0],r=e[4],i=e[8],n=e[12],o=e[1],a=e[5],s=e[9],l=e[13],c=e[2],u=e[6],h=e[10],p=e[14];return e[3]*(+n*s*u-i*l*u-n*a*h+r*l*h+i*a*p-r*s*p)+e[7]*(+t*s*p-t*l*h+n*o*h-i*o*p+i*l*c-n*s*c)+e[11]*(+t*l*u-t*a*p-n*o*u+r*o*p+n*a*c-r*l*c)+e[15]*(-i*a*c-t*s*u+t*a*h+i*o*u-r*o*h+r*s*c)},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this},setPosition:function(e){var t=this.elements;return t[12]=e.x,t[13]=e.y,t[14]=e.z,this},getInverse:function(e,t){var r=this.elements,i=e.elements,n=i[0],o=i[1],a=i[2],s=i[3],l=i[4],c=i[5],u=i[6],h=i[7],p=i[8],d=i[9],f=i[10],m=i[11],g=i[12],v=i[13],y=i[14],E=i[15],b=d*y*h-v*f*h+v*u*m-c*y*m-d*u*E+c*f*E,x=g*f*h-p*y*h-g*u*m+l*y*m+p*u*E-l*f*E,_=p*v*h-g*d*h+g*c*m-l*v*m-p*c*E+l*d*E,w=g*d*u-p*v*u-g*c*f+l*v*f+p*c*y-l*d*y,T=n*b+o*x+a*_+s*w;if(0===T){var M="THREE.Matrix4: .getInverse() can't invert matrix, determinant is 0";if(!0===t)throw new Error(M);return console.warn(M),this.identity()}var R=1/T;return r[0]=b*R,r[1]=(v*f*s-d*y*s-v*a*m+o*y*m+d*a*E-o*f*E)*R,r[2]=(c*y*s-v*u*s+v*a*h-o*y*h-c*a*E+o*u*E)*R,r[3]=(d*u*s-c*f*s-d*a*h+o*f*h+c*a*m-o*u*m)*R,r[4]=x*R,r[5]=(p*y*s-g*f*s+g*a*m-n*y*m-p*a*E+n*f*E)*R,r[6]=(g*u*s-l*y*s-g*a*h+n*y*h+l*a*E-n*u*E)*R,r[7]=(l*f*s-p*u*s+p*a*h-n*f*h-l*a*m+n*u*m)*R,r[8]=_*R,r[9]=(g*d*s-p*v*s-g*o*m+n*v*m+p*o*E-n*d*E)*R,r[10]=(l*v*s-g*c*s+g*o*h-n*v*h-l*o*E+n*c*E)*R,r[11]=(p*c*s-l*d*s-p*o*h+n*d*h+l*o*m-n*c*m)*R,r[12]=w*R,r[13]=(p*v*a-g*d*a+g*o*f-n*v*f-p*o*y+n*d*y)*R,r[14]=(g*c*a-l*v*a-g*o*u+n*v*u+l*o*y-n*c*y)*R,r[15]=(l*d*a-p*c*a+p*o*u-n*d*u-l*o*f+n*c*f)*R,this},scale:function(e){var t=this.elements,r=e.x,i=e.y,n=e.z;return t[0]*=r,t[4]*=i,t[8]*=n,t[1]*=r,t[5]*=i,t[9]*=n,t[2]*=r,t[6]*=i,t[10]*=n,t[3]*=r,t[7]*=i,t[11]*=n,this},getMaxScaleOnAxis:function(){var e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],r=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],i=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,r,i))},makeTranslation:function(e,t,r){return this.set(1,0,0,e,0,1,0,t,0,0,1,r,0,0,0,1),this},makeRotationX:function(e){var t=Math.cos(e),r=Math.sin(e);return this.set(1,0,0,0,0,t,-r,0,0,r,t,0,0,0,0,1),this},makeRotationY:function(e){var t=Math.cos(e),r=Math.sin(e);return this.set(t,0,r,0,0,1,0,0,-r,0,t,0,0,0,0,1),this},makeRotationZ:function(e){var t=Math.cos(e),r=Math.sin(e);return this.set(t,-r,0,0,r,t,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(e,t){var r=Math.cos(t),i=Math.sin(t),n=1-r,o=e.x,a=e.y,s=e.z,l=n*o,c=n*a;return this.set(l*o+r,l*a-i*s,l*s+i*a,0,l*a+i*s,c*a+r,c*s-i*o,0,l*s-i*a,c*s+i*o,n*s*s+r,0,0,0,0,1),this},makeScale:function(e,t,r){return this.set(e,0,0,0,0,t,0,0,0,0,r,0,0,0,0,1),this},makeShear:function(e,t,r){return this.set(1,t,r,0,e,1,r,0,e,t,1,0,0,0,0,1),this},compose:function(e,t,r){var i=this.elements,n=t._x,o=t._y,a=t._z,s=t._w,l=n+n,c=o+o,u=a+a,h=n*l,p=n*c,d=n*u,f=o*c,m=o*u,g=a*u,v=s*l,y=s*c,E=s*u,b=r.x,x=r.y,_=r.z;return i[0]=(1-(f+g))*b,i[1]=(p+E)*b,i[2]=(d-y)*b,i[3]=0,i[4]=(p-E)*x,i[5]=(1-(h+g))*x,i[6]=(m+v)*x,i[7]=0,i[8]=(d+y)*_,i[9]=(m-v)*_,i[10]=(1-(h+f))*_,i[11]=0,i[12]=e.x,i[13]=e.y,i[14]=e.z,i[15]=1,this},decompose:function(){var e=new o,t=new i;return function(r,i,n){var o=this.elements,a=e.set(o[0],o[1],o[2]).length(),s=e.set(o[4],o[5],o[6]).length(),l=e.set(o[8],o[9],o[10]).length();this.determinant()<0&&(a=-a),r.x=o[12],r.y=o[13],r.z=o[14],t.copy(this);var c=1/a,u=1/s,h=1/l;return t.elements[0]*=c,t.elements[1]*=c,t.elements[2]*=c,t.elements[4]*=u,t.elements[5]*=u,t.elements[6]*=u,t.elements[8]*=h,t.elements[9]*=h,t.elements[10]*=h,i.setFromRotationMatrix(t),n.x=a,n.y=s,n.z=l,this}}(),makePerspective:function(e,t,r,i,n,o){void 0===o&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");var a=this.elements,s=2*n/(t-e),l=2*n/(r-i),c=(t+e)/(t-e),u=(r+i)/(r-i),h=-(o+n)/(o-n),p=-2*o*n/(o-n);return a[0]=s,a[4]=0,a[8]=c,a[12]=0,a[1]=0,a[5]=l,a[9]=u,a[13]=0,a[2]=0,a[6]=0,a[10]=h,a[14]=p,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this},makeOrthographic:function(e,t,r,i,n,o){var a=this.elements,s=1/(t-e),l=1/(r-i),c=1/(o-n),u=(t+e)*s,h=(r+i)*l,p=(o+n)*c;return a[0]=2*s,a[4]=0,a[8]=0,a[12]=-u,a[1]=0,a[5]=2*l,a[9]=0,a[13]=-h,a[2]=0,a[6]=0,a[10]=-2*c,a[14]=-p,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this},equals:function(e){for(var t=this.elements,r=e.elements,i=0;i<16;i++)if(t[i]!==r[i])return!1;return!0},fromArray:function(e,t){void 0===t&&(t=0);for(var r=0;r<16;r++)this.elements[r]=e[r+t];return this},toArray:function(e,t){void 0===e&&(e=[]),void 0===t&&(t=0);var r=this.elements;return e[t]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=r[3],e[t+4]=r[4],e[t+5]=r[5],e[t+6]=r[6],e[t+7]=r[7],e[t+8]=r[8],e[t+9]=r[9],e[t+10]=r[10],e[t+11]=r[11],e[t+12]=r[12],e[t+13]=r[13],e[t+14]=r[14],e[t+15]=r[15],e}}),Object.assign(n,{slerp:function(e,t,r,i){return r.copy(e).slerp(t,i)},slerpFlat:function(e,t,r,i,n,o,a){var s=r[i+0],l=r[i+1],c=r[i+2],u=r[i+3],h=n[o+0],p=n[o+1],d=n[o+2],f=n[o+3];if(u!==f||s!==h||l!==p||c!==d){var m=1-a,g=s*h+l*p+c*d+u*f,v=g>=0?1:-1,y=1-g*g;if(y>Number.EPSILON){var E=Math.sqrt(y),b=Math.atan2(E,g*v);m=Math.sin(m*b)/E,a=Math.sin(a*b)/E}var x=a*v;if(s=s*m+h*x,l=l*m+p*x,c=c*m+d*x,u=u*m+f*x,m===1-a){var _=1/Math.sqrt(s*s+l*l+c*c+u*u);s*=_,l*=_,c*=_,u*=_}}e[t]=s,e[t+1]=l,e[t+2]=c,e[t+3]=u}}),Object.defineProperties(n.prototype,{x:{get:function(){return this._x},set:function(e){this._x=e,this.onChangeCallback()}},y:{get:function(){return this._y},set:function(e){this._y=e,this.onChangeCallback()}},z:{get:function(){return this._z},set:function(e){this._z=e,this.onChangeCallback()}},w:{get:function(){return this._w},set:function(e){this._w=e,this.onChangeCallback()}}}),Object.assign(n.prototype,{isQuaternion:!0,set:function(e,t,r,i){return this._x=e,this._y=t,this._z=r,this._w=i,this.onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._w)},copy:function(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this.onChangeCallback(),this},setFromEuler:function(e,t){if(!e||!e.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");var r=e._x,i=e._y,n=e._z,o=e.order,a=Math.cos,s=Math.sin,l=a(r/2),c=a(i/2),u=a(n/2),h=s(r/2),p=s(i/2),d=s(n/2);return"XYZ"===o?(this._x=h*c*u+l*p*d,this._y=l*p*u-h*c*d,this._z=l*c*d+h*p*u,this._w=l*c*u-h*p*d):"YXZ"===o?(this._x=h*c*u+l*p*d,this._y=l*p*u-h*c*d,this._z=l*c*d-h*p*u,this._w=l*c*u+h*p*d):"ZXY"===o?(this._x=h*c*u-l*p*d,this._y=l*p*u+h*c*d,this._z=l*c*d+h*p*u,this._w=l*c*u-h*p*d):"ZYX"===o?(this._x=h*c*u-l*p*d,this._y=l*p*u+h*c*d,this._z=l*c*d-h*p*u,this._w=l*c*u+h*p*d):"YZX"===o?(this._x=h*c*u+l*p*d,this._y=l*p*u+h*c*d,this._z=l*c*d-h*p*u,this._w=l*c*u-h*p*d):"XZY"===o&&(this._x=h*c*u-l*p*d,this._y=l*p*u-h*c*d,this._z=l*c*d+h*p*u,this._w=l*c*u+h*p*d),!1!==t&&this.onChangeCallback(),this},setFromAxisAngle:function(e,t){var r=t/2,i=Math.sin(r);return this._x=e.x*i,this._y=e.y*i,this._z=e.z*i,this._w=Math.cos(r),this.onChangeCallback(),this},setFromRotationMatrix:function(e){var t,r=e.elements,i=r[0],n=r[4],o=r[8],a=r[1],s=r[5],l=r[9],c=r[2],u=r[6],h=r[10],p=i+s+h;return p>0?(t=.5/Math.sqrt(p+1),this._w=.25/t,this._x=(u-l)*t,this._y=(o-c)*t,this._z=(a-n)*t):i>s&&i>h?(t=2*Math.sqrt(1+i-s-h),this._w=(u-l)/t,this._x=.25*t,this._y=(n+a)/t,this._z=(o+c)/t):s>h?(t=2*Math.sqrt(1+s-i-h),this._w=(o-c)/t,this._x=(n+a)/t,this._y=.25*t,this._z=(l+u)/t):(t=2*Math.sqrt(1+h-i-s),this._w=(a-n)/t,this._x=(o+c)/t,this._y=(l+u)/t,this._z=.25*t),this.onChangeCallback(),this},setFromUnitVectors:function(){var e,t=new o;return function(r,i){return void 0===t&&(t=new o),(e=r.dot(i)+1)<1e-6?(e=0,Math.abs(r.x)>Math.abs(r.z)?t.set(-r.y,r.x,0):t.set(0,-r.z,r.y)):t.crossVectors(r,i),this._x=t.x,this._y=t.y,this._z=t.z,this._w=e,this.normalize()}}(),angleTo:function(e){return 2*Math.acos(Math.abs(os.clamp(this.dot(e),-1,1)))},rotateTowards:function(e,t){var r=this.angleTo(e);if(0===r)return this;var i=Math.min(1,t/r);return this.slerp(e,i),this},inverse:function(){return this.conjugate()},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this.onChangeCallback(),this},dot:function(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this.onChangeCallback(),this},multiply:function(e,t){return void 0!==t?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)},premultiply:function(e){return this.multiplyQuaternions(e,this)},multiplyQuaternions:function(e,t){var r=e._x,i=e._y,n=e._z,o=e._w,a=t._x,s=t._y,l=t._z,c=t._w;return this._x=r*c+o*a+i*l-n*s,this._y=i*c+o*s+n*a-r*l,this._z=n*c+o*l+r*s-i*a,this._w=o*c-r*a-i*s-n*l,this.onChangeCallback(),this},slerp:function(e,t){if(0===t)return this;if(1===t)return this.copy(e);var r=this._x,i=this._y,n=this._z,o=this._w,a=o*e._w+r*e._x+i*e._y+n*e._z;if(a<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),a>=1)return this._w=o,this._x=r,this._y=i,this._z=n,this;var s=1-a*a;if(s<=Number.EPSILON){var l=1-t;return this._w=l*o+t*this._w,this._x=l*r+t*this._x,this._y=l*i+t*this._y,this._z=l*n+t*this._z,this.normalize()}var c=Math.sqrt(s),u=Math.atan2(c,a),h=Math.sin((1-t)*u)/c,p=Math.sin(t*u)/c;return this._w=o*h+this._w*p,this._x=r*h+this._x*p,this._y=i*h+this._y*p,this._z=n*h+this._z*p,this.onChangeCallback(),this},equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w},fromArray:function(e,t){return void 0===t&&(t=0),this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this.onChangeCallback(),this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e},onChange:function(e){return this.onChangeCallback=e,this},onChangeCallback:function(){}}),Object.assign(o.prototype,{isVector3:!0,set:function(e,t,r){return this.x=e,this.y=t,this.z=r,this},setScalar:function(e){return this.x=e,this.y=e,this.z=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this},add:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this},sub:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)},subScalar:function(e){return this.x-=e,this.y-=e,this.z-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this},multiply:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this},multiplyVectors:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this},applyEuler:function(){var e=new n;return function(t){return t&&t.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(e.setFromEuler(t))}}(),applyAxisAngle:function(){var e=new n;return function(t,r){return this.applyQuaternion(e.setFromAxisAngle(t,r))}}(),applyMatrix3:function(e){var t=this.x,r=this.y,i=this.z,n=e.elements;return this.x=n[0]*t+n[3]*r+n[6]*i,this.y=n[1]*t+n[4]*r+n[7]*i,this.z=n[2]*t+n[5]*r+n[8]*i,this},applyMatrix4:function(e){var t=this.x,r=this.y,i=this.z,n=e.elements,o=1/(n[3]*t+n[7]*r+n[11]*i+n[15]);return this.x=(n[0]*t+n[4]*r+n[8]*i+n[12])*o,this.y=(n[1]*t+n[5]*r+n[9]*i+n[13])*o,this.z=(n[2]*t+n[6]*r+n[10]*i+n[14])*o,this},applyQuaternion:function(e){var t=this.x,r=this.y,i=this.z,n=e.x,o=e.y,a=e.z,s=e.w,l=s*t+o*i-a*r,c=s*r+a*t-n*i,u=s*i+n*r-o*t,h=-n*t-o*r-a*i;return this.x=l*s+h*-n+c*-a-u*-o,this.y=c*s+h*-o+u*-n-l*-a,this.z=u*s+h*-a+l*-o-c*-n,this},project:function(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)},unproject:function(){var e=new i;return function(t){return this.applyMatrix4(e.getInverse(t.projectionMatrix)).applyMatrix4(t.matrixWorld)}}(),transformDirection:function(e){var t=this.x,r=this.y,i=this.z,n=e.elements;return this.x=n[0]*t+n[4]*r+n[8]*i,this.y=n[1]*t+n[5]*r+n[9]*i,this.z=n[2]*t+n[6]*r+n[10]*i,this.normalize()},divide:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this},divideScalar:function(e){return this.multiplyScalar(1/e)},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this},clampScalar:function(){var e=new o,t=new o;return function(r,i){return e.set(r,r,r),t.set(i,i,i),this.clamp(e,t)}}(),clampLength:function(e,t){var r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(t,r)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(e){return this.normalize().multiplyScalar(e)},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this},lerpVectors:function(e,t,r){return this.subVectors(t,e).multiplyScalar(r).add(e)},cross:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t)):this.crossVectors(this,e)},crossVectors:function(e,t){var r=e.x,i=e.y,n=e.z,o=t.x,a=t.y,s=t.z;return this.x=i*s-n*a,this.y=n*o-r*s,this.z=r*a-i*o,this},projectOnVector:function(e){var t=e.dot(this)/e.lengthSq();return this.copy(e).multiplyScalar(t)},projectOnPlane:function(){var e=new o;return function(t){return e.copy(this).projectOnVector(t),this.sub(e)}}(),reflect:function(){var e=new o;return function(t){return this.sub(e.copy(t).multiplyScalar(2*this.dot(t)))}}(),angleTo:function(e){var t=this.dot(e)/Math.sqrt(this.lengthSq()*e.lengthSq());return Math.acos(os.clamp(t,-1,1))},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,r=this.y-e.y,i=this.z-e.z;return t*t+r*r+i*i},manhattanDistanceTo:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)},setFromSpherical:function(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)},setFromSphericalCoords:function(e,t,r){var i=Math.sin(t)*e;return this.x=i*Math.sin(r),this.y=Math.cos(t)*e,this.z=i*Math.cos(r),this},setFromCylindrical:function(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)},setFromCylindricalCoords:function(e,t,r){return this.x=e*Math.sin(t),this.y=r,this.z=e*Math.cos(t),this},setFromMatrixPosition:function(e){var t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this},setFromMatrixScale:function(e){var t=this.setFromMatrixColumn(e,0).length(),r=this.setFromMatrixColumn(e,1).length(),i=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=r,this.z=i,this},setFromMatrixColumn:function(e,t){return this.fromArray(e.elements,4*t)},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e},fromBufferAttribute:function(e,t,r){return void 0!==r&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}}),Object.assign(a.prototype,{isMatrix3:!0,set:function(e,t,r,i,n,o,a,s,l){var c=this.elements;return c[0]=e,c[1]=i,c[2]=a,c[3]=t,c[4]=n,c[5]=s,c[6]=r,c[7]=o,c[8]=l,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},clone:function(){return(new this.constructor).fromArray(this.elements)},copy:function(e){var t=this.elements,r=e.elements;return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],this},setFromMatrix4:function(e){var t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this},applyToBufferAttribute:function(){var e=new o;return function(t){for(var r=0,i=t.count;r<i;r++)e.x=t.getX(r),e.y=t.getY(r),e.z=t.getZ(r),e.applyMatrix3(this),t.setXYZ(r,e.x,e.y,e.z);return t}}(),multiply:function(e){return this.multiplyMatrices(this,e)},premultiply:function(e){return this.multiplyMatrices(e,this)},multiplyMatrices:function(e,t){var r=e.elements,i=t.elements,n=this.elements,o=r[0],a=r[3],s=r[6],l=r[1],c=r[4],u=r[7],h=r[2],p=r[5],d=r[8],f=i[0],m=i[3],g=i[6],v=i[1],y=i[4],E=i[7],b=i[2],x=i[5],_=i[8];return n[0]=o*f+a*v+s*b,n[3]=o*m+a*y+s*x,n[6]=o*g+a*E+s*_,n[1]=l*f+c*v+u*b,n[4]=l*m+c*y+u*x,n[7]=l*g+c*E+u*_,n[2]=h*f+p*v+d*b,n[5]=h*m+p*y+d*x,n[8]=h*g+p*E+d*_,this},multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this},determinant:function(){var e=this.elements,t=e[0],r=e[1],i=e[2],n=e[3],o=e[4],a=e[5],s=e[6],l=e[7],c=e[8];return t*o*c-t*a*l-r*n*c+r*a*s+i*n*l-i*o*s},getInverse:function(e,t){e&&e.isMatrix4&&console.error("THREE.Matrix3: .getInverse() no longer takes a Matrix4 argument.");var r=e.elements,i=this.elements,n=r[0],o=r[1],a=r[2],s=r[3],l=r[4],c=r[5],u=r[6],h=r[7],p=r[8],d=p*l-c*h,f=c*u-p*s,m=h*s-l*u,g=n*d+o*f+a*m;if(0===g){var v="THREE.Matrix3: .getInverse() can't invert matrix, determinant is 0";if(!0===t)throw new Error(v);return console.warn(v),this.identity()}var y=1/g;return i[0]=d*y,i[1]=(a*h-p*o)*y,i[2]=(c*o-a*l)*y,i[3]=f*y,i[4]=(p*n-a*u)*y,i[5]=(a*s-c*n)*y,i[6]=m*y,i[7]=(o*u-h*n)*y,i[8]=(l*n-o*s)*y,this},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this},getNormalMatrix:function(e){return this.setFromMatrix4(e).getInverse(this).transpose()},transposeIntoArray:function(e){var t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this},setUvTransform:function(e,t,r,i,n,o,a){var s=Math.cos(n),l=Math.sin(n);this.set(r*s,r*l,-r*(s*o+l*a)+o+e,-i*l,i*s,-i*(-l*o+s*a)+a+t,0,0,1)},scale:function(e,t){var r=this.elements;return r[0]*=e,r[3]*=e,r[6]*=e,r[1]*=t,r[4]*=t,r[7]*=t,this},rotate:function(e){var t=Math.cos(e),r=Math.sin(e),i=this.elements,n=i[0],o=i[3],a=i[6],s=i[1],l=i[4],c=i[7];return i[0]=t*n+r*s,i[3]=t*o+r*l,i[6]=t*a+r*c,i[1]=-r*n+t*s,i[4]=-r*o+t*l,i[7]=-r*a+t*c,this},translate:function(e,t){var r=this.elements;return r[0]+=e*r[2],r[3]+=e*r[5],r[6]+=e*r[8],r[1]+=t*r[2],r[4]+=t*r[5],r[7]+=t*r[8],this},equals:function(e){for(var t=this.elements,r=e.elements,i=0;i<9;i++)if(t[i]!==r[i])return!1;return!0},fromArray:function(e,t){void 0===t&&(t=0);for(var r=0;r<9;r++)this.elements[r]=e[r+t];return this},toArray:function(e,t){void 0===e&&(e=[]),void 0===t&&(t=0);var r=this.elements;return e[t]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=r[3],e[t+4]=r[4],e[t+5]=r[5],e[t+6]=r[6],e[t+7]=r[7],e[t+8]=r[8],e}});var as,ss={getDataURL:function(e){var t;if("undefined"==typeof HTMLCanvasElement)return e.src;if(e instanceof HTMLCanvasElement)t=e;else{void 0===as&&(as=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")),as.width=e.width,as.height=e.height;var r=as.getContext("2d");e instanceof ImageData?r.putImageData(e,0,0):r.drawImage(e,0,0,e.width,e.height),t=as}return t.width>2048||t.height>2048?t.toDataURL("image/jpeg",.6):t.toDataURL("image/png")}},ls=0;s.DEFAULT_IMAGE=void 0,s.DEFAULT_MAPPING=300,s.prototype=Object.assign(Object.create(t.prototype),{constructor:s,isTexture:!0,updateMatrix:function(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.name=e.name,this.image=e.image,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this},toJSON:function(e){var t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];var r={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY};if(void 0!==this.image){var i=this.image;if(void 0===i.uuid&&(i.uuid=os.generateUUID()),!t&&void 0===e.images[i.uuid]){var n;if(Array.isArray(i)){n=[];for(var o=0,a=i.length;o<a;o++)n.push(ss.getDataURL(i[o]))}else n=ss.getDataURL(i);e.images[i.uuid]={uuid:i.uuid,url:n}}r.image=i.uuid}return t||(e.textures[this.uuid]=r),r},dispose:function(){this.dispatchEvent({type:"dispose"})},transformUv:function(e){if(300!==this.mapping)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case qo:e.x=e.x-Math.floor(e.x);break;case Go:e.x=e.x<0?0:1;break;case Wo:1===Math.abs(Math.floor(e.x)%2)?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case qo:e.y=e.y-Math.floor(e.y);break;case Go:e.y=e.y<0?0:1;break;case Wo:1===Math.abs(Math.floor(e.y)%2)?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}}),Object.defineProperty(s.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Object.assign(l.prototype,{isVector4:!0,set:function(e,t,r,i){return this.x=e,this.y=t,this.z=r,this.w=i,this},setScalar:function(e){return this.x=e,this.y=e,this.z=e,this.w=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setW:function(e){return this.w=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y,this.z,this.w)},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this},add:function(e,t){return void 0!==t?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this},sub:function(e,t){return void 0!==t?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)},subScalar:function(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this},applyMatrix4:function(e){var t=this.x,r=this.y,i=this.z,n=this.w,o=e.elements;return this.x=o[0]*t+o[4]*r+o[8]*i+o[12]*n,this.y=o[1]*t+o[5]*r+o[9]*i+o[13]*n,this.z=o[2]*t+o[6]*r+o[10]*i+o[14]*n,this.w=o[3]*t+o[7]*r+o[11]*i+o[15]*n,this},divideScalar:function(e){return this.multiplyScalar(1/e)},setAxisAngleFromQuaternion:function(e){this.w=2*Math.acos(e.w);var t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this},setAxisAngleFromRotationMatrix:function(e){var t,r,i,n,o=e.elements,a=o[0],s=o[4],l=o[8],c=o[1],u=o[5],h=o[9],p=o[2],d=o[6],f=o[10];if(Math.abs(s-c)<.01&&Math.abs(l-p)<.01&&Math.abs(h-d)<.01){if(Math.abs(s+c)<.1&&Math.abs(l+p)<.1&&Math.abs(h+d)<.1&&Math.abs(a+u+f-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;var m=(a+1)/2,g=(u+1)/2,v=(f+1)/2,y=(s+c)/4,E=(l+p)/4,b=(h+d)/4;return m>g&&m>v?m<.01?(r=0,i=.707106781,n=.707106781):(i=y/(r=Math.sqrt(m)),n=E/r):g>v?g<.01?(r=.707106781,i=0,n=.707106781):(r=y/(i=Math.sqrt(g)),n=b/i):v<.01?(r=.707106781,i=.707106781,n=0):(r=E/(n=Math.sqrt(v)),i=b/n),this.set(r,i,n,t),this}var x=Math.sqrt((d-h)*(d-h)+(l-p)*(l-p)+(c-s)*(c-s));return Math.abs(x)<.001&&(x=1),this.x=(d-h)/x,this.y=(l-p)/x,this.z=(c-s)/x,this.w=Math.acos((a+u+f-1)/2),this},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this},clampScalar:function(){var e,t;return function(r,i){return void 0===e&&(e=new l,t=new l),e.set(r,r,r,r),t.set(i,i,i,i),this.clamp(e,t)}}(),clampLength:function(e,t){var r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(t,r)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(e){return this.normalize().multiplyScalar(e)},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this},lerpVectors:function(e,t,r){return this.subVectors(t,e).multiplyScalar(r).add(e)},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e},fromBufferAttribute:function(e,t,r){return void 0!==r&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}}),c.prototype=Object.assign(Object.create(t.prototype),{constructor:c,isWebGLRenderTarget:!0,setSize:function(e,t){this.width===e&&this.height===t||(this.width=e,this.height=t,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.width=e.width,this.height=e.height,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),(u.prototype=Object.create(c.prototype)).constructor=u,u.prototype.isWebGLRenderTargetCube=!0,(h.prototype=Object.create(s.prototype)).constructor=h,h.prototype.isDataTexture=!0,Object.assign(p.prototype,{isBox3:!0,set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromArray:function(e){for(var t=1/0,r=1/0,i=1/0,n=-1/0,o=-1/0,a=-1/0,s=0,l=e.length;s<l;s+=3){var c=e[s],u=e[s+1],h=e[s+2];c<t&&(t=c),u<r&&(r=u),h<i&&(i=h),c>n&&(n=c),u>o&&(o=u),h>a&&(a=h)}return this.min.set(t,r,i),this.max.set(n,o,a),this},setFromBufferAttribute:function(e){for(var t=1/0,r=1/0,i=1/0,n=-1/0,o=-1/0,a=-1/0,s=0,l=e.count;s<l;s++){var c=e.getX(s),u=e.getY(s),h=e.getZ(s);c<t&&(t=c),u<r&&(r=u),h<i&&(i=h),c>n&&(n=c),u>o&&(o=u),h>a&&(a=h)}return this.min.set(t,r,i),this.max.set(n,o,a),this},setFromPoints:function(e){this.makeEmpty();for(var t=0,r=e.length;t<r;t++)this.expandByPoint(e[t]);return this},setFromCenterAndSize:function(){var e=new o;return function(t,r){var i=e.copy(r).multiplyScalar(.5);return this.min.copy(t).sub(i),this.max.copy(t).add(i),this}}(),setFromObject:function(e){return this.makeEmpty(),this.expandByObject(e)},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},getCenter:function(e){return void 0===e&&(console.warn("THREE.Box3: .getCenter() target is now required"),e=new o),this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(e){return void 0===e&&(console.warn("THREE.Box3: .getSize() target is now required"),e=new o),this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},expandByObject:function(){function e(e){var o=e.geometry;if(void 0!==o)if(o.isGeometry){var a=o.vertices;for(r=0,i=a.length;r<i;r++)n.copy(a[r]),n.applyMatrix4(e.matrixWorld),t.expandByPoint(n)}else if(o.isBufferGeometry){var s=o.attributes.position;if(void 0!==s)for(r=0,i=s.count;r<i;r++)n.fromBufferAttribute(s,r).applyMatrix4(e.matrixWorld),t.expandByPoint(n)}}var t,r,i,n=new o;return function(r){return t=this,r.updateMatrixWorld(!0),r.traverse(e),this}}(),containsPoint:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z},getParameter:function(e,t){return void 0===t&&(console.warn("THREE.Box3: .getParameter() target is now required"),t=new o),t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))},intersectsBox:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)},intersectsSphere:function(){var e=new o;return function(t){return this.clampPoint(t.center,e),e.distanceToSquared(t.center)<=t.radius*t.radius}}(),intersectsPlane:function(e){var t,r;return e.normal.x>0?(t=e.normal.x*this.min.x,r=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,r=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,r+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,r+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,r+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,r+=e.normal.z*this.min.z),t<=-e.constant&&r>=-e.constant},intersectsTriangle:function(){function e(e){var n,o;for(n=0,o=e.length-3;n<=o;n+=3){l.fromArray(e,n);var a=u.x*Math.abs(l.x)+u.y*Math.abs(l.y)+u.z*Math.abs(l.z),s=t.dot(l),c=r.dot(l),h=i.dot(l);if(Math.max(-Math.max(s,c,h),Math.min(s,c,h))>a)return!1}return!0}var t=new o,r=new o,i=new o,n=new o,a=new o,s=new o,l=new o,c=new o,u=new o,h=new o;return function(o){if(this.isEmpty())return!1;this.getCenter(c),u.subVectors(this.max,c),t.subVectors(o.a,c),r.subVectors(o.b,c),i.subVectors(o.c,c),n.subVectors(r,t),a.subVectors(i,r),s.subVectors(t,i);var l=[0,-n.z,n.y,0,-a.z,a.y,0,-s.z,s.y,n.z,0,-n.x,a.z,0,-a.x,s.z,0,-s.x,-n.y,n.x,0,-a.y,a.x,0,-s.y,s.x,0];return!!e(l)&&(l=[1,0,0,0,1,0,0,0,1],!!e(l)&&(h.crossVectors(n,a),l=[h.x,h.y,h.z],e(l)))}}(),clampPoint:function(e,t){return void 0===t&&(console.warn("THREE.Box3: .clampPoint() target is now required"),t=new o),t.copy(e).clamp(this.min,this.max)},distanceToPoint:function(){var e=new o;return function(t){return e.copy(t).clamp(this.min,this.max).sub(t).length()}}(),getBoundingSphere:function(){var e=new o;return function(t){return void 0===t&&(console.warn("THREE.Box3: .getBoundingSphere() target is now required"),t=new d),this.getCenter(t.center),t.radius=.5*this.getSize(e).length(),t}}(),intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},applyMatrix4:function(){var e=[new o,new o,new o,new o,new o,new o,new o,new o];return function(t){return this.isEmpty()?this:(e[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),e[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),e[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),e[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),e[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),e[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),e[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),e[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(e),this)}}(),translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}),Object.assign(d.prototype,{set:function(e,t){return this.center.copy(e),this.radius=t,this},setFromPoints:function(){var e=new p;return function(t,r){var i=this.center;void 0!==r?i.copy(r):e.setFromPoints(t).getCenter(i);for(var n=0,o=0,a=t.length;o<a;o++)n=Math.max(n,i.distanceToSquared(t[o]));return this.radius=Math.sqrt(n),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.center.copy(e.center),this.radius=e.radius,this},empty:function(){return this.radius<=0},containsPoint:function(e){return e.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(e){return e.distanceTo(this.center)-this.radius},intersectsSphere:function(e){var t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t},intersectsBox:function(e){return e.intersectsSphere(this)},intersectsPlane:function(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius},clampPoint:function(e,t){var r=this.center.distanceToSquared(e);return void 0===t&&(console.warn("THREE.Sphere: .clampPoint() target is now required"),t=new o),t.copy(e),r>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t},getBoundingBox:function(e){return void 0===e&&(console.warn("THREE.Sphere: .getBoundingBox() target is now required"),e=new p),e.set(this.center,this.center),e.expandByScalar(this.radius),e},applyMatrix4:function(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this},translate:function(e){return this.center.add(e),this},equals:function(e){return e.center.equals(this.center)&&e.radius===this.radius}}),Object.assign(f.prototype,{set:function(e,t){return this.normal.copy(e),this.constant=t,this},setComponents:function(e,t,r,i){return this.normal.set(e,t,r),this.constant=i,this},setFromNormalAndCoplanarPoint:function(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this},setFromCoplanarPoints:function(){var e=new o,t=new o;return function(r,i,n){var o=e.subVectors(n,i).cross(t.subVectors(r,i)).normalize();return this.setFromNormalAndCoplanarPoint(o,r),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.normal.copy(e.normal),this.constant=e.constant,this},normalize:function(){var e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(e){return this.normal.dot(e)+this.constant},distanceToSphere:function(e){return this.distanceToPoint(e.center)-e.radius},projectPoint:function(e,t){return void 0===t&&(console.warn("THREE.Plane: .projectPoint() target is now required"),t=new o),t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)},intersectLine:function(){var e=new o;return function(t,r){void 0===r&&(console.warn("THREE.Plane: .intersectLine() target is now required"),r=new o);var i=t.delta(e),n=this.normal.dot(i);if(0!==n){var a=-(t.start.dot(this.normal)+this.constant)/n;if(!(a<0||a>1))return r.copy(i).multiplyScalar(a).add(t.start)}else if(0===this.distanceToPoint(t.start))return r.copy(t.start)}}(),intersectsLine:function(e){var t=this.distanceToPoint(e.start),r=this.distanceToPoint(e.end);return t<0&&r>0||r<0&&t>0},intersectsBox:function(e){return e.intersectsPlane(this)},intersectsSphere:function(e){return e.intersectsPlane(this)},coplanarPoint:function(e){return void 0===e&&(console.warn("THREE.Plane: .coplanarPoint() target is now required"),e=new o),e.copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(){var e=new o,t=new a;return function(r,i){var n=i||t.getNormalMatrix(r),o=this.coplanarPoint(e).applyMatrix4(r),a=this.normal.applyMatrix3(n).normalize();return this.constant=-o.dot(a),this}}(),translate:function(e){return this.constant-=e.dot(this.normal),this},equals:function(e){return e.normal.equals(this.normal)&&e.constant===this.constant}}),Object.assign(m.prototype,{set:function(e,t,r,i,n,o){var a=this.planes;return a[0].copy(e),a[1].copy(t),a[2].copy(r),a[3].copy(i),a[4].copy(n),a[5].copy(o),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){for(var t=this.planes,r=0;r<6;r++)t[r].copy(e.planes[r]);return this},setFromMatrix:function(e){var t=this.planes,r=e.elements,i=r[0],n=r[1],o=r[2],a=r[3],s=r[4],l=r[5],c=r[6],u=r[7],h=r[8],p=r[9],d=r[10],f=r[11],m=r[12],g=r[13],v=r[14],y=r[15];return t[0].setComponents(a-i,u-s,f-h,y-m).normalize(),t[1].setComponents(a+i,u+s,f+h,y+m).normalize(),t[2].setComponents(a+n,u+l,f+p,y+g).normalize(),t[3].setComponents(a-n,u-l,f-p,y-g).normalize(),t[4].setComponents(a-o,u-c,f-d,y-v).normalize(),t[5].setComponents(a+o,u+c,f+d,y+v).normalize(),this},intersectsObject:function(){var e=new d;return function(t){var r=t.geometry;return null===r.boundingSphere&&r.computeBoundingSphere(),e.copy(r.boundingSphere).applyMatrix4(t.matrixWorld),this.intersectsSphere(e)}}(),intersectsSprite:function(){var e=new d;return function(t){return e.center.set(0,0,0),e.radius=.7071067811865476,e.applyMatrix4(t.matrixWorld),this.intersectsSphere(e)}}(),intersectsSphere:function(e){for(var t=this.planes,r=e.center,i=-e.radius,n=0;n<6;n++){if(t[n].distanceToPoint(r)<i)return!1}return!0},intersectsBox:function(){var e=new o;return function(t){for(var r=this.planes,i=0;i<6;i++){var n=r[i];if(e.x=n.normal.x>0?t.max.x:t.min.x,e.y=n.normal.y>0?t.max.y:t.min.y,e.z=n.normal.z>0?t.max.z:t.min.z,n.distanceToPoint(e)<0)return!1}return!0}}(),containsPoint:function(e){for(var t=this.planes,r=0;r<6;r++)if(t[r].distanceToPoint(e)<0)return!1;return!0}});var cs={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef ALPHATEST\n\tif ( diffuseColor.a < ALPHATEST ) discard;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( PHYSICAL )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:"vec3 objectNormal = vec3( normal );",bsdfs:"float punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\tif( cutoffDistance > 0.0 ) {\n\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t}\n\treturn distanceFalloff;\n#else\n\tif( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\treturn pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t}\n\treturn 1.0;\n#endif\n}\nvec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\n\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\n}\nfloat G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\tfloat gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\treturn 1.0 / ( gl * gv );\n}\nfloat G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNL = saturate( dot( geometry.normal, incidentLight.direction ) );\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( G * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE  = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS  = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nvec3 BRDF_Specular_GGX_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 AB = vec2( -1.04, 1.04 ) * a004 + r.zw;\n\treturn specularColor * AB.x + AB.y;\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\n\treturn ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\n}\nfloat BlinnExponentToGGXRoughness( const in float blinnExponent ) {\n\treturn sqrt( 2.0 / ( blinnExponent + 2.0 ) );\n}",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 );\n\t\tfDet *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vViewPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vViewPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\t#if ! defined( PHYSICAL ) && ! defined( PHONG ) && ! defined( MATCAP )\n\t\tvarying vec3 vViewPosition;\n\t#endif\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0 && ! defined( PHYSICAL ) && ! defined( PHONG ) && ! defined( MATCAP )\n\tvarying vec3 vViewPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0 && ! defined( PHYSICAL ) && ! defined( PHONG ) && ! defined( MATCAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif",color_fragment:"#ifdef USE_COLOR\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif",color_vertex:"#ifdef USE_COLOR\n\tvColor.xyz = color.xyz;\n#endif",common:"#define PI 3.14159265359\n#define PI2 6.28318530718\n#define PI_HALF 1.5707963267949\n#define RECIPROCAL_PI 0.31830988618\n#define RECIPROCAL_PI2 0.15915494\n#define LOG2 1.442695\n#define EPSILON 1e-6\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#define whiteCompliment(a) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract(sin(sn) * c);\n}\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\tfloat distance = dot( planeNormal, point - pointOnPlane );\n\treturn - distance * planeNormal + point;\n}\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n}\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\treturn dot( weights, color.rgb );\n}",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n#define cubeUV_textureSize (1024.0)\nint getFaceFromDirection(vec3 direction) {\n\tvec3 absDirection = abs(direction);\n\tint face = -1;\n\tif( absDirection.x > absDirection.z ) {\n\t\tif(absDirection.x > absDirection.y )\n\t\t\tface = direction.x > 0.0 ? 0 : 3;\n\t\telse\n\t\t\tface = direction.y > 0.0 ? 1 : 4;\n\t}\n\telse {\n\t\tif(absDirection.z > absDirection.y )\n\t\t\tface = direction.z > 0.0 ? 2 : 5;\n\t\telse\n\t\t\tface = direction.y > 0.0 ? 1 : 4;\n\t}\n\treturn face;\n}\n#define cubeUV_maxLods1  (log2(cubeUV_textureSize*0.25) - 1.0)\n#define cubeUV_rangeClamp (exp2((6.0 - 1.0) * 2.0))\nvec2 MipLevelInfo( vec3 vec, float roughnessLevel, float roughness ) {\n\tfloat scale = exp2(cubeUV_maxLods1 - roughnessLevel);\n\tfloat dxRoughness = dFdx(roughness);\n\tfloat dyRoughness = dFdy(roughness);\n\tvec3 dx = dFdx( vec * scale * dxRoughness );\n\tvec3 dy = dFdy( vec * scale * dyRoughness );\n\tfloat d = max( dot( dx, dx ), dot( dy, dy ) );\n\td = clamp(d, 1.0, cubeUV_rangeClamp);\n\tfloat mipLevel = 0.5 * log2(d);\n\treturn vec2(floor(mipLevel), fract(mipLevel));\n}\n#define cubeUV_maxLods2 (log2(cubeUV_textureSize*0.25) - 2.0)\n#define cubeUV_rcpTextureSize (1.0 / cubeUV_textureSize)\nvec2 getCubeUV(vec3 direction, float roughnessLevel, float mipLevel) {\n\tmipLevel = roughnessLevel > cubeUV_maxLods2 - 3.0 ? 0.0 : mipLevel;\n\tfloat a = 16.0 * cubeUV_rcpTextureSize;\n\tvec2 exp2_packed = exp2( vec2( roughnessLevel, mipLevel ) );\n\tvec2 rcp_exp2_packed = vec2( 1.0 ) / exp2_packed;\n\tfloat powScale = exp2_packed.x * exp2_packed.y;\n\tfloat scale = rcp_exp2_packed.x * rcp_exp2_packed.y * 0.25;\n\tfloat mipOffset = 0.75*(1.0 - rcp_exp2_packed.y) * rcp_exp2_packed.x;\n\tbool bRes = mipLevel == 0.0;\n\tscale =  bRes && (scale < a) ? a : scale;\n\tvec3 r;\n\tvec2 offset;\n\tint face = getFaceFromDirection(direction);\n\tfloat rcpPowScale = 1.0 / powScale;\n\tif( face == 0) {\n\t\tr = vec3(direction.x, -direction.z, direction.y);\n\t\toffset = vec2(0.0+mipOffset,0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 1) {\n\t\tr = vec3(direction.y, direction.x, direction.z);\n\t\toffset = vec2(scale+mipOffset, 0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 2) {\n\t\tr = vec3(direction.z, direction.x, direction.y);\n\t\toffset = vec2(2.0*scale+mipOffset, 0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 3) {\n\t\tr = vec3(direction.x, direction.z, direction.y);\n\t\toffset = vec2(0.0+mipOffset,0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\telse if( face == 4) {\n\t\tr = vec3(direction.y, direction.x, -direction.z);\n\t\toffset = vec2(scale+mipOffset, 0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\telse {\n\t\tr = vec3(direction.z, -direction.x, direction.y);\n\t\toffset = vec2(2.0*scale+mipOffset, 0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\tr = normalize(r);\n\tfloat texelOffset = 0.5 * cubeUV_rcpTextureSize;\n\tvec2 s = ( r.yz / abs( r.x ) + vec2( 1.0 ) ) * 0.5;\n\tvec2 base = offset + vec2( texelOffset );\n\treturn base + s * ( scale - 2.0 * texelOffset );\n}\n#define cubeUV_maxLods3 (log2(cubeUV_textureSize*0.25) - 3.0)\nvec4 textureCubeUV( sampler2D envMap, vec3 reflectedDirection, float roughness ) {\n\tfloat roughnessVal = roughness* cubeUV_maxLods3;\n\tfloat r1 = floor(roughnessVal);\n\tfloat r2 = r1 + 1.0;\n\tfloat t = fract(roughnessVal);\n\tvec2 mipInfo = MipLevelInfo(reflectedDirection, r1, roughness);\n\tfloat s = mipInfo.y;\n\tfloat level0 = mipInfo.x;\n\tfloat level1 = level0 + 1.0;\n\tlevel1 = level1 > 5.0 ? 5.0 : level1;\n\tlevel0 += min( floor( s + 0.5 ), 5.0 );\n\tvec2 uv_10 = getCubeUV(reflectedDirection, r1, level0);\n\tvec4 color10 = envMapTexelToLinear(texture2D(envMap, uv_10));\n\tvec2 uv_20 = getCubeUV(reflectedDirection, r2, level0);\n\tvec4 color20 = envMapTexelToLinear(texture2D(envMap, uv_20));\n\tvec4 result = mix(color10, color20, t);\n\treturn vec4(result.rgb, 1.0);\n}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = normalMatrix * objectNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, uv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:"\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( gammaFactor ) ), value.a );\n}\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( 1.0 / gammaFactor ) ), value.a );\n}\nvec4 sRGBToLinear( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}\nvec4 RGBEToLinear( in vec4 value ) {\n\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\nvec4 LinearToRGBE( in vec4 value ) {\n\tfloat maxComponent = max( max( value.r, value.g ), value.b );\n\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n}\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * value.a * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat M = clamp( maxRGB / maxRange, 0.0, 1.0 );\n\tM = ceil( M * 255.0 ) / 255.0;\n\treturn vec4( value.rgb / ( M * maxRange ), M );\n}\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat D = max( maxRange / maxRGB, 1.0 );\n\tD = min( floor( D ) / 255.0, 1.0 );\n\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value )  {\n\tvec3 Xp_Y_XYZp = value.rgb * cLogLuvM;\n\tXp_Y_XYZp = max( Xp_Y_XYZp, vec3( 1e-6, 1e-6, 1e-6 ) );\n\tvec4 vResult;\n\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n\tvResult.w = fract( Le );\n\tvResult.z = ( Le - ( floor( vResult.w * 255.0 ) ) / 255.0 ) / 255.0;\n\treturn vResult;\n}\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n\tfloat Le = value.z * 255.0 + value.w;\n\tvec3 Xp_Y_XYZp;\n\tXp_Y_XYZp.y = exp2( ( Le - 127.0 ) / 2.0 );\n\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n\tvec3 vRGB = Xp_Y_XYZp.rgb * cLogLuvInverseM;\n\treturn vec4( max( vRGB, 0.0 ), 1.0 );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\tvec2 sampleUV;\n\t\treflectVec = normalize( reflectVec );\n\t\tsampleUV.y = asin( clamp( reflectVec.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\t\tsampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\tvec4 envColor = texture2D( envMap, sampleUV );\n\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\treflectVec = normalize( reflectVec );\n\t\tvec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0, 0.0, 1.0 ) );\n\t\tvec4 envColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\tenvColor = envMapTexelToLinear( envColor );\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_pars_fragment:"#if defined( USE_ENVMAP ) || defined( PHYSICAL )\n\tuniform float reflectivity;\n\tuniform float envMapIntensity;\n#endif\n#ifdef USE_ENVMAP\n\t#if ! defined( PHYSICAL ) && ( defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) )\n\t\tvarying vec3 vWorldPosition;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\tuniform float flipEnvMap;\n\tuniform int maxMipLevel;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( PHYSICAL )\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#if defined( USE_ENVMAP ) && defined( PHYSICAL )\n\tvec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {\n\t\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, queryVec, 1.0 );\n\t\t#else\n\t\t\tvec4 envMapColor = vec4( 0.0 );\n\t\t#endif\n\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t}\n\tfloat getSpecularMIPLevel( const in float blinnShininessExponent, const in int maxMIPLevel ) {\n\t\tfloat maxMIPLevelScalar = float( maxMIPLevel );\n\t\tfloat desiredMIPLevel = maxMIPLevelScalar + 0.79248 - 0.5 * log2( pow2( blinnShininessExponent ) + 1.0 );\n\t\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\n\t}\n\tvec3 getLightProbeIndirectRadiance( const in GeometricContext geometry, const in float blinnShininessExponent, const in int maxMIPLevel ) {\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( -geometry.viewDir, geometry.normal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( -geometry.viewDir, geometry.normal, refractionRatio );\n\t\t#endif\n\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\tfloat specularMIPLevel = getSpecularMIPLevel( blinnShininessExponent, maxMIPLevel );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, queryReflectVec, BlinnExponentToGGXRoughness(blinnShininessExponent ));\n\t\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\t\tvec2 sampleUV;\n\t\t\tsampleUV.y = asin( clamp( reflectVec.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\t\t\tsampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, sampleUV, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, sampleUV, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\t\tvec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0,0.0,1.0 ) );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#endif\n\t\treturn envMapColor.rgb * envMapIntensity;\n\t}\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tfogDepth = -mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float fogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = whiteCompliment( exp2( - fogDensity * fogDensity * fogDepth * fogDepth * LOG2 ) );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, fogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float fogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef TOON\n\tuniform sampler2D gradientMap;\n\tvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\t\tfloat dotNL = dot( normal, lightDirection );\n\t\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t\t#ifdef USE_GRADIENTMAP\n\t\t\treturn texture2D( gradientMap, coord ).rgb;\n\t\t#else\n\t\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t\t#endif\n\t}\n#endif",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\treflectedLight.indirectDiffuse += PI * texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_vertex:"vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\n#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvLightFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\n\t\t#endif\n\t}\n#endif",lights_pars_begin:"uniform vec3 ambientLightColor;\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treturn irradiance;\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tdirectLight.color = directionalLight.color;\n\t\tdirectLight.direction = directionalLight.direction;\n\t\tdirectLight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t\tfloat shadowCameraNear;\n\t\tfloat shadowCameraFar;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tdirectLight.color = pointLight.color;\n\t\tdirectLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\n\t\tdirectLight.visible = ( directLight.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight  ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tfloat angleCos = dot( directLight.direction, spotLight.direction );\n\t\tif ( angleCos > spotLight.coneCos ) {\n\t\t\tfloat spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\t\tdirectLight.color = spotLight.color;\n\t\t\tdirectLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tdirectLight.visible = true;\n\t\t} else {\n\t\t\tdirectLight.color = vec3( 0.0 );\n\t\t\tdirectLight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\n\t\tfloat dotNL = dot( geometry.normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tirradiance *= PI;\n\t\t#endif\n\t\treturn irradiance;\n\t}\n#endif",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct BlinnPhongMaterial {\n\tvec3\tdiffuseColor;\n\tvec3\tspecularColor;\n\tfloat\tspecularShininess;\n\tfloat\tspecularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\t#ifdef TOON\n\t\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\t#else\n\t\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\t\tvec3 irradiance = dotNL * directLight.color;\n\t#endif\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nmaterial.specularRoughness = clamp( roughnessFactor, 0.04, 1.0 );\n#ifdef STANDARD\n\tmaterial.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.clearCoat = saturate( clearCoat );\tmaterial.clearCoatRoughness = clamp( clearCoatRoughness, 0.04, 1.0 );\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3\tdiffuseColor;\n\tfloat\tspecularRoughness;\n\tvec3\tspecularColor;\n\t#ifndef STANDARD\n\t\tfloat clearCoat;\n\t\tfloat clearCoatRoughness;\n\t#endif\n};\n#define MAXIMUM_SPECULAR_COEFFICIENT 0.16\n#define DEFAULT_SPECULAR_COEFFICIENT 0.04\nfloat clearCoatDHRApprox( const in float roughness, const in float dotNL ) {\n\treturn DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.specularRoughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos - halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos + halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos + halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos - halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\t#ifndef STANDARD\n\t\tfloat clearCoatDHR = material.clearCoat * clearCoatDHRApprox( material.clearCoatRoughness, dotNL );\n\t#else\n\t\tfloat clearCoatDHR = 0.0;\n\t#endif\n\treflectedLight.directSpecular += ( 1.0 - clearCoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry, material.specularColor, material.specularRoughness );\n\treflectedLight.directDiffuse += ( 1.0 - clearCoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\t#ifndef STANDARD\n\t\treflectedLight.directSpecular += irradiance * material.clearCoat * BRDF_Specular_GGX( directLight, geometry, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearCoatRoughness );\n\t#endif\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 clearCoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t#ifndef STANDARD\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\tfloat dotNL = dotNV;\n\t\tfloat clearCoatDHR = material.clearCoat * clearCoatDHRApprox( material.clearCoatRoughness, dotNL );\n\t#else\n\t\tfloat clearCoatDHR = 0.0;\n\t#endif\n\treflectedLight.indirectSpecular += ( 1.0 - clearCoatDHR ) * radiance * BRDF_Specular_GGX_Environment( geometry, material.specularColor, material.specularRoughness );\n\t#ifndef STANDARD\n\t\treflectedLight.indirectSpecular += clearCoatRadiance * material.clearCoat * BRDF_Specular_GGX_Environment( geometry, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearCoatRoughness );\n\t#endif\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\n#define Material_BlinnShininessExponent( material )   GGXRoughnessToBlinnExponent( material.specularRoughness )\n#define Material_ClearCoat_BlinnShininessExponent( material )   GGXRoughnessToBlinnExponent( material.clearCoatRoughness )\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = normalize( vViewPosition );\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointDirectLightIrradiance( pointLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( pointLight.shadow, directLight.visible ) ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotDirectLightIrradiance( spotLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( spotLight.shadow, directLight.visible ) ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( directionalLight.shadow, directLight.visible ) ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t}\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearCoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec3 lightMapIrradiance = texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( PHYSICAL ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tirradiance += getLightProbeIndirectIrradiance( geometry, maxMipLevel );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getLightProbeIndirectRadiance( geometry, Material_BlinnShininessExponent( material ), maxMipLevel );\n\t#ifndef STANDARD\n\t\tclearCoatRadiance += getLightProbeIndirectRadiance( geometry, Material_ClearCoat_BlinnShininessExponent( material ), maxMipLevel );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, clearCoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t#else\n\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\tgl_Position.z *= gl_Position.w;\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 texelColor = texture2D( map, vUv );\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#ifdef USE_MAP\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n\tvec4 mapTexel = texture2D( map, uv );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n#endif",map_particle_pars_fragment:"#ifdef USE_MAP\n\tuniform mat3 uvTransform;\n\tuniform sampler2D map;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal += ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];\n\tobjectNormal += ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];\n\tobjectNormal += ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];\n\tobjectNormal += ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\t#ifndef USE_MORPHNORMALS\n\tuniform float morphTargetInfluences[ 8 ];\n\t#else\n\tuniform float morphTargetInfluences[ 4 ];\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\n\ttransformed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\n\ttransformed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\n\ttransformed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\n\t#ifndef USE_MORPHNORMALS\n\ttransformed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\n\ttransformed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\n\ttransformed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\n\ttransformed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\n\t#endif\n#endif",normal_fragment_begin:"#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t#endif\n#endif",normal_fragment_maps:"#ifdef USE_NORMALMAP\n\t#ifdef OBJECTSPACE_NORMALMAP\n\t\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t\t#ifdef FLIP_SIDED\n\t\t\tnormal = - normal;\n\t\t#endif\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t#endif\n\t\tnormal = normalize( normalMatrix * normal );\n\t#else\n\t\tnormal = perturbNormal2Arb( -vViewPosition, normal );\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n\t#ifdef OBJECTSPACE_NORMALMAP\n\t\tuniform mat3 normalMatrix;\n\t#else\n\t\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {\n\t\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\t\tvec2 st0 = dFdx( vUv.st );\n\t\t\tvec2 st1 = dFdy( vUv.st );\n\t\t\tfloat scale = sign( st1.t * st0.s - st0.t * st1.s );\n\t\t\tvec3 S = normalize( ( q0 * st1.t - q1 * st0.t ) * scale );\n\t\t\tvec3 T = normalize( ( - q0 * st1.s + q1 * st0.s ) * scale );\n\t\t\tvec3 N = normalize( surf_norm );\n\t\t\tmat3 tsn = mat3( S, T, N );\n\t\t\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t\t\tmapN.xy *= normalScale;\n\t\t\tmapN.xy *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t\treturn normalize( tsn * mapN );\n\t\t}\n\t#endif\n#endif",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn (( near + viewZ ) * far ) / (( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = modelViewMatrix * vec4( transformed, 1.0 );\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#if defined( DITHERING )\n  gl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#if defined( DITHERING )\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHTS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHTS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHTS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tfloat texture2DShadowLerp( sampler2D depths, vec2 size, vec2 uv, float compare ) {\n\t\tconst vec2 offset = vec2( 0.0, 1.0 );\n\t\tvec2 texelSize = vec2( 1.0 ) / size;\n\t\tvec2 centroidUV = floor( uv * size + 0.5 ) / size;\n\t\tfloat lb = texture2DCompare( depths, centroidUV + texelSize * offset.xx, compare );\n\t\tfloat lt = texture2DCompare( depths, centroidUV + texelSize * offset.xy, compare );\n\t\tfloat rb = texture2DCompare( depths, centroidUV + texelSize * offset.yx, compare );\n\t\tfloat rt = texture2DCompare( depths, centroidUV + texelSize * offset.yy, compare );\n\t\tvec2 f = fract( uv * size + 0.5 );\n\t\tfloat a = mix( lb, lt, f.y );\n\t\tfloat b = mix( rb, rt, f.y );\n\t\tfloat c = mix( a, b, f.x );\n\t\treturn c;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tshadow = (\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHTS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHTS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHTS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];\n\t#endif\n#endif",shadowmap_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\tDirectionalLight directionalLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tshadow *= bool( directionalLight.shadow ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\tSpotLight spotLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tshadow *= bool( spotLight.shadow ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\tPointLight pointLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tshadow *= bool( pointLight.shadow ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n  gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n\t#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nuniform float toneMappingWhitePoint;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\n#define Uncharted2Helper( x ) max( ( ( x * ( 0.15 * x + 0.10 * 0.50 ) + 0.20 * 0.02 ) / ( x * ( 0.15 * x + 0.50 ) + 0.20 * 0.30 ) ) - 0.02 / 0.30, vec3( 0.0 ) )\nvec3 Uncharted2ToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( Uncharted2Helper( color ) / Uncharted2Helper( vec3( toneMappingWhitePoint ) ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( ( color * ( 2.51 * color + 0.03 ) ) / ( color * ( 2.43 * color + 0.59 ) + 0.14 ) );\n}",uv_pars_fragment:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvarying vec2 vUv;\n\tuniform mat3 uvTransform;\n#endif",uv_vertex:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = uv2;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP )\n\tvec4 worldPosition = modelMatrix * vec4( transformed, 1.0 );\n#endif",background_frag:"uniform sampler2D t2D;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",cube_frag:"uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldDirection;\nvoid main() {\n\tvec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - gl_FragCoord.z ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( gl_FragCoord.z );\n\t#endif\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV;\n\tsampleUV.y = asin( clamp( direction.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\tsampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;\n\tvec4 texColor = texture2D( tEquirect, sampleUV );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\tvLineDistance = scale * lineDistance;\n\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\treflectedLight.indirectDiffuse += texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_ENVMAP\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\treflectedLight.indirectDiffuse = getAmbientLightIrradiance( ambientLightColor );\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t\tmatcapColor = matcapTexelToLinear( matcapColor );\n\t#else\n\t\tvec4 matcapColor = vec4( 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#ifndef FLAT_SHADED\n\t\tvNormal = normalize( transformedNormal );\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphysical_frag:"#define PHYSICAL\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifndef STANDARD\n\tuniform float clearCoat;\n\tuniform float clearCoatRoughness;\n#endif\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <envmap_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define PHYSICAL\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",normal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || ( defined( USE_NORMALMAP ) && ! defined( OBJECTSPACE_NORMALMAP ) )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\nvoid main() {\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n}",normal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || ( defined( USE_NORMALMAP ) && ! defined( OBJECTSPACE_NORMALMAP ) )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || ( defined( USE_NORMALMAP ) && ! defined( OBJECTSPACE_NORMALMAP ) )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <fog_fragment>\n}",shadow_vert:"#include <fog_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}"},us={clone:g,merge:v},hs={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};Object.assign(y.prototype,{isColor:!0,r:1,g:1,b:1,set:function(e){return e&&e.isColor?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e),this},setScalar:function(e){return this.r=e,this.g=e,this.b=e,this},setHex:function(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,this},setRGB:function(e,t,r){return this.r=e,this.g=t,this.b=r,this},setHSL:function(){function e(e,t,r){return r<0&&(r+=1),r>1&&(r-=1),r<1/6?e+6*(t-e)*r:r<.5?t:r<2/3?e+6*(t-e)*(2/3-r):e}return function(t,r,i){if(t=os.euclideanModulo(t,1),r=os.clamp(r,0,1),i=os.clamp(i,0,1),0===r)this.r=this.g=this.b=i;else{var n=i<=.5?i*(1+r):i+r-i*r,o=2*i-n;this.r=e(o,n,t+1/3),this.g=e(o,n,t),this.b=e(o,n,t-1/3)}return this}}(),setStyle:function(e){function t(t){void 0!==t&&parseFloat(t)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}var r;if(r=/^((?:rgb|hsl)a?)\(\s*([^\)]*)\)/.exec(e)){var i,n=r[1],o=r[2];switch(n){case"rgb":case"rgba":if(i=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(o))return this.r=Math.min(255,parseInt(i[1],10))/255,this.g=Math.min(255,parseInt(i[2],10))/255,this.b=Math.min(255,parseInt(i[3],10))/255,t(i[5]),this;if(i=/^(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(o))return this.r=Math.min(100,parseInt(i[1],10))/100,this.g=Math.min(100,parseInt(i[2],10))/100,this.b=Math.min(100,parseInt(i[3],10))/100,t(i[5]),this;break;case"hsl":case"hsla":if(i=/^([0-9]*\.?[0-9]+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(o)){var a=parseFloat(i[1])/360,s=parseInt(i[2],10)/100,l=parseInt(i[3],10)/100;return t(i[5]),this.setHSL(a,s,l)}}}else if(r=/^\#([A-Fa-f0-9]+)$/.exec(e)){var c=(u=r[1]).length;if(3===c)return this.r=parseInt(u.charAt(0)+u.charAt(0),16)/255,this.g=parseInt(u.charAt(1)+u.charAt(1),16)/255,this.b=parseInt(u.charAt(2)+u.charAt(2),16)/255,this;if(6===c)return this.r=parseInt(u.charAt(0)+u.charAt(1),16)/255,this.g=parseInt(u.charAt(2)+u.charAt(3),16)/255,this.b=parseInt(u.charAt(4)+u.charAt(5),16)/255,this}if(e&&e.length>0){var u=hs[e];void 0!==u?this.setHex(u):console.warn("THREE.Color: Unknown color "+e)}return this},clone:function(){return new this.constructor(this.r,this.g,this.b)},copy:function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this},copyGammaToLinear:function(e,t){return void 0===t&&(t=2),this.r=Math.pow(e.r,t),this.g=Math.pow(e.g,t),this.b=Math.pow(e.b,t),this},copyLinearToGamma:function(e,t){void 0===t&&(t=2);var r=t>0?1/t:1;return this.r=Math.pow(e.r,r),this.g=Math.pow(e.g,r),this.b=Math.pow(e.b,r),this},convertGammaToLinear:function(e){return this.copyGammaToLinear(this,e),this},convertLinearToGamma:function(e){return this.copyLinearToGamma(this,e),this},copySRGBToLinear:function(){function e(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}return function(t){return this.r=e(t.r),this.g=e(t.g),this.b=e(t.b),this}}(),copyLinearToSRGB:function(){function e(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}return function(t){return this.r=e(t.r),this.g=e(t.g),this.b=e(t.b),this}}(),convertSRGBToLinear:function(){return this.copySRGBToLinear(this),this},convertLinearToSRGB:function(){return this.copyLinearToSRGB(this),this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(e){void 0===e&&(console.warn("THREE.Color: .getHSL() target is now required"),e={h:0,s:0,l:0});var t,r,i=this.r,n=this.g,o=this.b,a=Math.max(i,n,o),s=Math.min(i,n,o),l=(s+a)/2;if(s===a)t=0,r=0;else{var c=a-s;switch(r=l<=.5?c/(a+s):c/(2-a-s),a){case i:t=(n-o)/c+(n<o?6:0);break;case n:t=(o-i)/c+2;break;case o:t=(i-n)/c+4}t/=6}return e.h=t,e.s=r,e.l=l,e},getStyle:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},offsetHSL:function(){var e={};return function(t,r,i){return this.getHSL(e),e.h+=t,e.s+=r,e.l+=i,this.setHSL(e.h,e.s,e.l),this}}(),add:function(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this},addColors:function(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this},addScalar:function(e){return this.r+=e,this.g+=e,this.b+=e,this},sub:function(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this},multiply:function(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this},multiplyScalar:function(e){return this.r*=e,this.g*=e,this.b*=e,this},lerp:function(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this},lerpHSL:function(){var e={h:0,s:0,l:0},t={h:0,s:0,l:0};return function(r,i){this.getHSL(e),r.getHSL(t);var n=os.lerp(e.h,t.h,i),o=os.lerp(e.s,t.s,i),a=os.lerp(e.l,t.l,i);return this.setHSL(n,o,a),this}}(),equals:function(e){return e.r===this.r&&e.g===this.g&&e.b===this.b},fromArray:function(e,t){return void 0===t&&(t=0),this.r=e[t],this.g=e[t+1],this.b=e[t+2],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e},toJSON:function(){return this.getHex()}});var ps={common:{diffuse:{value:new y(15658734)},opacity:{value:1},map:{value:null},uvTransform:{value:new a},uvTransform1:{value:new a},alphaMap:{value:null}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new r(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new y(16777215)}},lights:{ambientLightColor:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}}},points:{diffuse:{value:new y(15658734)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},uvTransform:{value:new a}},sprite:{diffuse:{value:new y(15658734)},opacity:{value:1},center:{value:new r(.5,.5)},rotation:{value:0},map:{value:null},uvTransform:{value:new a}}},ds={basic:{uniforms:v([ps.common,ps.specularmap,ps.envmap,ps.aomap,ps.lightmap,ps.fog]),vertexShader:cs.meshbasic_vert,fragmentShader:cs.meshbasic_frag},lambert:{uniforms:v([ps.common,ps.specularmap,ps.envmap,ps.aomap,ps.lightmap,ps.emissivemap,ps.fog,ps.lights,{emissive:{value:new y(0)}}]),vertexShader:cs.meshlambert_vert,fragmentShader:cs.meshlambert_frag},phong:{uniforms:v([ps.common,ps.specularmap,ps.envmap,ps.aomap,ps.lightmap,ps.emissivemap,ps.bumpmap,ps.normalmap,ps.displacementmap,ps.gradientmap,ps.fog,ps.lights,{emissive:{value:new y(0)},specular:{value:new y(1118481)},shininess:{value:30}}]),vertexShader:cs.meshphong_vert,fragmentShader:cs.meshphong_frag},standard:{uniforms:v([ps.common,ps.envmap,ps.aomap,ps.lightmap,ps.emissivemap,ps.bumpmap,ps.normalmap,ps.displacementmap,ps.roughnessmap,ps.metalnessmap,ps.fog,ps.lights,{emissive:{value:new y(0)},roughness:{value:.5},metalness:{value:.5},envMapIntensity:{value:1}}]),vertexShader:cs.meshphysical_vert,fragmentShader:cs.meshphysical_frag},matcap:{uniforms:v([ps.common,ps.bumpmap,ps.normalmap,ps.displacementmap,ps.fog,{matcap:{value:null}}]),vertexShader:cs.meshmatcap_vert,fragmentShader:cs.meshmatcap_frag},points:{uniforms:v([ps.points,ps.fog]),vertexShader:cs.points_vert,fragmentShader:cs.points_frag},dashed:{uniforms:v([ps.common,ps.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:cs.linedashed_vert,fragmentShader:cs.linedashed_frag},depth:{uniforms:v([ps.common,ps.displacementmap]),vertexShader:cs.depth_vert,fragmentShader:cs.depth_frag},normal:{uniforms:v([ps.common,ps.bumpmap,ps.normalmap,ps.displacementmap,{opacity:{value:1}}]),vertexShader:cs.normal_vert,fragmentShader:cs.normal_frag},sprite:{uniforms:v([ps.sprite,ps.fog]),vertexShader:cs.sprite_vert,fragmentShader:cs.sprite_frag},background:{uniforms:{uvTransform:{value:new a},t2D:{value:null}},vertexShader:cs.background_vert,fragmentShader:cs.background_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:cs.cube_vert,fragmentShader:cs.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:cs.equirect_vert,fragmentShader:cs.equirect_frag},distanceRGBA:{uniforms:v([ps.common,ps.displacementmap,{referencePosition:{value:new o},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:cs.distanceRGBA_vert,fragmentShader:cs.distanceRGBA_frag},shadow:{uniforms:v([ps.lights,ps.fog,{color:{value:new y(0)},opacity:{value:1}}]),vertexShader:cs.shadow_vert,fragmentShader:cs.shadow_frag}};ds.physical={uniforms:v([ds.standard.uniforms,{clearCoat:{value:0},clearCoatRoughness:{value:0}}]),vertexShader:cs.meshphysical_vert,fragmentShader:cs.meshphysical_frag},Object.assign(x.prototype,{clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.a=e.a,this.b=e.b,this.c=e.c,this.normal.copy(e.normal),this.color.copy(e.color),this.materialIndex=e.materialIndex;for(var t=0,r=e.vertexNormals.length;t<r;t++)this.vertexNormals[t]=e.vertexNormals[t].clone();for(var t=0,r=e.vertexColors.length;t<r;t++)this.vertexColors[t]=e.vertexColors[t].clone();return this}}),_.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],_.DefaultOrder="XYZ",Object.defineProperties(_.prototype,{x:{get:function(){return this._x},set:function(e){this._x=e,this.onChangeCallback()}},y:{get:function(){return this._y},set:function(e){this._y=e,this.onChangeCallback()}},z:{get:function(){return this._z},set:function(e){this._z=e,this.onChangeCallback()}},order:{get:function(){return this._order},set:function(e){this._order=e,this.onChangeCallback()}}}),Object.assign(_.prototype,{isEuler:!0,set:function(e,t,r,i){return this._x=e,this._y=t,this._z=r,this._order=i||this._order,this.onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._order)},copy:function(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this.onChangeCallback(),this},setFromRotationMatrix:function(e,t,r){var i=os.clamp,n=e.elements,o=n[0],a=n[4],s=n[8],l=n[1],c=n[5],u=n[9],h=n[2],p=n[6],d=n[10];return"XYZ"===(t=t||this._order)?(this._y=Math.asin(i(s,-1,1)),Math.abs(s)<.99999?(this._x=Math.atan2(-u,d),this._z=Math.atan2(-a,o)):(this._x=Math.atan2(p,c),this._z=0)):"YXZ"===t?(this._x=Math.asin(-i(u,-1,1)),Math.abs(u)<.99999?(this._y=Math.atan2(s,d),this._z=Math.atan2(l,c)):(this._y=Math.atan2(-h,o),this._z=0)):"ZXY"===t?(this._x=Math.asin(i(p,-1,1)),Math.abs(p)<.99999?(this._y=Math.atan2(-h,d),this._z=Math.atan2(-a,c)):(this._y=0,this._z=Math.atan2(l,o))):"ZYX"===t?(this._y=Math.asin(-i(h,-1,1)),Math.abs(h)<.99999?(this._x=Math.atan2(p,d),this._z=Math.atan2(l,o)):(this._x=0,this._z=Math.atan2(-a,c))):"YZX"===t?(this._z=Math.asin(i(l,-1,1)),Math.abs(l)<.99999?(this._x=Math.atan2(-u,c),this._y=Math.atan2(-h,o)):(this._x=0,this._y=Math.atan2(s,d))):"XZY"===t?(this._z=Math.asin(-i(a,-1,1)),Math.abs(a)<.99999?(this._x=Math.atan2(p,c),this._y=Math.atan2(s,o)):(this._x=Math.atan2(-u,d),this._y=0)):console.warn("THREE.Euler: .setFromRotationMatrix() given unsupported order: "+t),this._order=t,!1!==r&&this.onChangeCallback(),this},setFromQuaternion:function(){var e=new i;return function(t,r,i){return e.makeRotationFromQuaternion(t),this.setFromRotationMatrix(e,r,i)}}(),setFromVector3:function(e,t){return this.set(e.x,e.y,e.z,t||this._order)},reorder:function(){var e=new n;return function(t){return e.setFromEuler(this),this.setFromQuaternion(e,t)}}(),equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order},fromArray:function(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this.onChangeCallback(),this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e},toVector3:function(e){return e?e.set(this._x,this._y,this._z):new o(this._x,this._y,this._z)},onChange:function(e){return this.onChangeCallback=e,this},onChangeCallback:function(){}}),Object.assign(w.prototype,{set:function(e){this.mask=1<<e|0},enable:function(e){this.mask|=1<<e|0},toggle:function(e){this.mask^=1<<e|0},disable:function(e){this.mask&=~(1<<e|0)},test:function(e){return 0!=(this.mask&e.mask)}});var fs=0;T.DefaultUp=new o(0,1,0),T.DefaultMatrixAutoUpdate=!0,T.prototype=Object.assign(Object.create(t.prototype),{constructor:T,isObject3D:!0,onBeforeRender:function(){},onAfterRender:function(){},applyMatrix:function(e){this.matrix.multiplyMatrices(e,this.matrix),this.matrix.decompose(this.position,this.quaternion,this.scale)},applyQuaternion:function(e){return this.quaternion.premultiply(e),this},setRotationFromAxisAngle:function(e,t){this.quaternion.setFromAxisAngle(e,t)},setRotationFromEuler:function(e){this.quaternion.setFromEuler(e,!0)},setRotationFromMatrix:function(e){this.quaternion.setFromRotationMatrix(e)},setRotationFromQuaternion:function(e){this.quaternion.copy(e)},rotateOnAxis:function(){var e=new n;return function(t,r){return e.setFromAxisAngle(t,r),this.quaternion.multiply(e),this}}(),rotateOnWorldAxis:function(){var e=new n;return function(t,r){return e.setFromAxisAngle(t,r),this.quaternion.premultiply(e),this}}(),rotateX:function(){var e=new o(1,0,0);return function(t){return this.rotateOnAxis(e,t)}}(),rotateY:function(){var e=new o(0,1,0);return function(t){return this.rotateOnAxis(e,t)}}(),rotateZ:function(){var e=new o(0,0,1);return function(t){return this.rotateOnAxis(e,t)}}(),translateOnAxis:function(){var e=new o;return function(t,r){return e.copy(t).applyQuaternion(this.quaternion),this.position.add(e.multiplyScalar(r)),this}}(),translateX:function(){var e=new o(1,0,0);return function(t){return this.translateOnAxis(e,t)}}(),translateY:function(){var e=new o(0,1,0);return function(t){return this.translateOnAxis(e,t)}}(),translateZ:function(){var e=new o(0,0,1);return function(t){return this.translateOnAxis(e,t)}}(),localToWorld:function(e){return e.applyMatrix4(this.matrixWorld)},worldToLocal:function(){var e=new i;return function(t){return t.applyMatrix4(e.getInverse(this.matrixWorld))}}(),lookAt:function(){var e=new n,t=new i,r=new o,a=new o;return function(i,n,o){i.isVector3?r.copy(i):r.set(i,n,o);var s=this.parent;this.updateWorldMatrix(!0,!1),a.setFromMatrixPosition(this.matrixWorld),this.isCamera?t.lookAt(a,r,this.up):t.lookAt(r,a,this.up),this.quaternion.setFromRotationMatrix(t),s&&(t.extractRotation(s.matrixWorld),e.setFromRotationMatrix(t),this.quaternion.premultiply(e.inverse()))}}(),add:function(e){if(arguments.length>1){for(var t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(null!==e.parent&&e.parent.remove(e),e.parent=this,e.dispatchEvent({type:"added"}),this.children.push(e)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)},remove:function(e){if(arguments.length>1){for(var t=0;t<arguments.length;t++)this.remove(arguments[t]);return this}var r=this.children.indexOf(e);return-1!==r&&(e.parent=null,e.dispatchEvent({type:"removed"}),this.children.splice(r,1)),this},getObjectById:function(e){return this.getObjectByProperty("id",e)},getObjectByName:function(e){return this.getObjectByProperty("name",e)},getObjectByProperty:function(e,t){if(this[e]===t)return this;for(var r=0,i=this.children.length;r<i;r++){var n=this.children[r].getObjectByProperty(e,t);if(void 0!==n)return n}},getWorldPosition:function(e){return void 0===e&&(console.warn("THREE.Object3D: .getWorldPosition() target is now required"),e=new o),this.updateMatrixWorld(!0),e.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(){var e=new o,t=new o;return function(r){return void 0===r&&(console.warn("THREE.Object3D: .getWorldQuaternion() target is now required"),r=new n),this.updateMatrixWorld(!0),this.matrixWorld.decompose(e,r,t),r}}(),getWorldScale:function(){var e=new o,t=new n;return function(r){return void 0===r&&(console.warn("THREE.Object3D: .getWorldScale() target is now required"),r=new o),this.updateMatrixWorld(!0),this.matrixWorld.decompose(e,t,r),r}}(),getWorldDirection:function(e){void 0===e&&(console.warn("THREE.Object3D: .getWorldDirection() target is now required"),e=new o),this.updateMatrixWorld(!0);var t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()},raycast:function(){},traverse:function(e){e(this);for(var t=this.children,r=0,i=t.length;r<i;r++)t[r].traverse(e)},traverseVisible:function(e){if(!1!==this.visible){e(this);for(var t=this.children,r=0,i=t.length;r<i;r++)t[r].traverseVisible(e)}},traverseAncestors:function(e){var t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);for(var t=this.children,r=0,i=t.length;r<i;r++)t[r].updateMatrixWorld(e)},updateWorldMatrix:function(e,t){var r=this.parent;if(!0===e&&null!==r&&r.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===t)for(var i=this.children,n=0,o=i.length;n<o;n++)i[n].updateWorldMatrix(!1,!0)},toJSON:function(e){function t(t,r){return void 0===t[r.uuid]&&(t[r.uuid]=r.toJSON(e)),r.uuid}function r(e){var t=[];for(var r in e){var i=e[r];delete i.metadata,t.push(i)}return t}var i=void 0===e||"string"==typeof e,n={};i&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{}},n.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});var o={};if(o.uuid=this.uuid,o.type=this.type,""!==this.name&&(o.name=this.name),!0===this.castShadow&&(o.castShadow=!0),!0===this.receiveShadow&&(o.receiveShadow=!0),!1===this.visible&&(o.visible=!1),!1===this.frustumCulled&&(o.frustumCulled=!1),0!==this.renderOrder&&(o.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(o.userData=this.userData),o.layers=this.layers.mask,o.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(o.matrixAutoUpdate=!1),this.isMesh||this.isLine||this.isPoints){o.geometry=t(e.geometries,this.geometry);var a=this.geometry.parameters;if(void 0!==a&&void 0!==a.shapes){m=a.shapes;if(Array.isArray(m))for(var s=0,l=m.length;s<l;s++){var c=m[s];t(e.shapes,c)}else t(e.shapes,m)}}if(void 0!==this.material)if(Array.isArray(this.material)){for(var u=[],s=0,l=this.material.length;s<l;s++)u.push(t(e.materials,this.material[s]));o.material=u}else o.material=t(e.materials,this.material);if(this.children.length>0){o.children=[];for(s=0;s<this.children.length;s++)o.children.push(this.children[s].toJSON(e).object)}if(i){var h=r(e.geometries),p=r(e.materials),d=r(e.textures),f=r(e.images),m=r(e.shapes);h.length>0&&(n.geometries=h),p.length>0&&(n.materials=p),d.length>0&&(n.textures=d),f.length>0&&(n.images=f),m.length>0&&(n.shapes=m)}return n.object=o,n},clone:function(e){return(new this.constructor).copy(this,e)},copy:function(e,t){if(void 0===t&&(t=!0),this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(var r=0;r<e.children.length;r++){var i=e.children[r];this.add(i.clone())}return this}});var ms=0;M.prototype=Object.assign(Object.create(t.prototype),{constructor:M,isGeometry:!0,applyMatrix:function(e){for(var t=(new a).getNormalMatrix(e),r=0,i=this.vertices.length;r<i;r++){this.vertices[r].applyMatrix4(e)}for(var r=0,i=this.faces.length;r<i;r++){var n=this.faces[r];n.normal.applyMatrix3(t).normalize();for(var o=0,s=n.vertexNormals.length;o<s;o++)n.vertexNormals[o].applyMatrix3(t).normalize()}return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this},rotateX:function(){var e=new i;return function(t){return e.makeRotationX(t),this.applyMatrix(e),this}}(),rotateY:function(){var e=new i;return function(t){return e.makeRotationY(t),this.applyMatrix(e),this}}(),rotateZ:function(){var e=new i;return function(t){return e.makeRotationZ(t),this.applyMatrix(e),this}}(),translate:function(){var e=new i;return function(t,r,i){return e.makeTranslation(t,r,i),this.applyMatrix(e),this}}(),scale:function(){var e=new i;return function(t,r,i){return e.makeScale(t,r,i),this.applyMatrix(e),this}}(),lookAt:function(){var e=new T;return function(t){e.lookAt(t),e.updateMatrix(),this.applyMatrix(e.matrix)}}(),fromBufferGeometry:function(e){function t(e,t,n,a){var s=void 0===c?[]:[i.colors[e].clone(),i.colors[t].clone(),i.colors[n].clone()],p=new x(e,t,n,void 0===l?[]:[(new o).fromArray(l,3*e),(new o).fromArray(l,3*t),(new o).fromArray(l,3*n)],s,a);i.faces.push(p),void 0!==u&&i.faceVertexUvs[0].push([(new r).fromArray(u,2*e),(new r).fromArray(u,2*t),(new r).fromArray(u,2*n)]),void 0!==h&&i.faceVertexUvs[1].push([(new r).fromArray(h,2*e),(new r).fromArray(h,2*t),(new r).fromArray(h,2*n)])}var i=this,n=null!==e.index?e.index.array:void 0,a=e.attributes,s=a.position.array,l=void 0!==a.normal?a.normal.array:void 0,c=void 0!==a.color?a.color.array:void 0,u=void 0!==a.uv?a.uv.array:void 0,h=void 0!==a.uv2?a.uv2.array:void 0;void 0!==h&&(this.faceVertexUvs[1]=[]);for(var p=0,d=0;p<s.length;p+=3,d+=2)i.vertices.push((new o).fromArray(s,p)),void 0!==c&&i.colors.push((new y).fromArray(c,p));var f=e.groups;if(f.length>0)for(p=0;p<f.length;p++)for(var m=f[p],g=m.start,d=g,v=g+m.count;d<v;d+=3)void 0!==n?t(n[d],n[d+1],n[d+2],m.materialIndex):t(d,d+1,d+2,m.materialIndex);else if(void 0!==n)for(p=0;p<n.length;p+=3)t(n[p],n[p+1],n[p+2]);else for(p=0;p<s.length/3;p+=3)t(p,p+1,p+2);return this.computeFaceNormals(),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this},center:function(){var e=new o;return function(){return this.computeBoundingBox(),this.boundingBox.getCenter(e).negate(),this.translate(e.x,e.y,e.z),this}}(),normalize:function(){this.computeBoundingSphere();var e=this.boundingSphere.center,t=this.boundingSphere.radius,r=0===t?1:1/t,n=new i;return n.set(r,0,0,-r*e.x,0,r,0,-r*e.y,0,0,r,-r*e.z,0,0,0,1),this.applyMatrix(n),this},computeFaceNormals:function(){for(var e=new o,t=new o,r=0,i=this.faces.length;r<i;r++){var n=this.faces[r],a=this.vertices[n.a],s=this.vertices[n.b],l=this.vertices[n.c];e.subVectors(l,s),t.subVectors(a,s),e.cross(t),e.normalize(),n.normal.copy(e)}},computeVertexNormals:function(e){void 0===e&&(e=!0);var t,r,i,n,a,s;for(s=new Array(this.vertices.length),t=0,r=this.vertices.length;t<r;t++)s[t]=new o;if(e){var l,c,u,h=new o,p=new o;for(i=0,n=this.faces.length;i<n;i++)a=this.faces[i],l=this.vertices[a.a],c=this.vertices[a.b],u=this.vertices[a.c],h.subVectors(u,c),p.subVectors(l,c),h.cross(p),s[a.a].add(h),s[a.b].add(h),s[a.c].add(h)}else for(this.computeFaceNormals(),i=0,n=this.faces.length;i<n;i++)s[(a=this.faces[i]).a].add(a.normal),s[a.b].add(a.normal),s[a.c].add(a.normal);for(t=0,r=this.vertices.length;t<r;t++)s[t].normalize();for(i=0,n=this.faces.length;i<n;i++){var d=(a=this.faces[i]).vertexNormals;3===d.length?(d[0].copy(s[a.a]),d[1].copy(s[a.b]),d[2].copy(s[a.c])):(d[0]=s[a.a].clone(),d[1]=s[a.b].clone(),d[2]=s[a.c].clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeFlatVertexNormals:function(){var e,t,r;for(this.computeFaceNormals(),e=0,t=this.faces.length;e<t;e++){var i=(r=this.faces[e]).vertexNormals;3===i.length?(i[0].copy(r.normal),i[1].copy(r.normal),i[2].copy(r.normal)):(i[0]=r.normal.clone(),i[1]=r.normal.clone(),i[2]=r.normal.clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeMorphNormals:function(){var e,t,r,i,n;for(r=0,i=this.faces.length;r<i;r++)for((n=this.faces[r]).__originalFaceNormal?n.__originalFaceNormal.copy(n.normal):n.__originalFaceNormal=n.normal.clone(),n.__originalVertexNormals||(n.__originalVertexNormals=[]),e=0,t=n.vertexNormals.length;e<t;e++)n.__originalVertexNormals[e]?n.__originalVertexNormals[e].copy(n.vertexNormals[e]):n.__originalVertexNormals[e]=n.vertexNormals[e].clone();var a=new M;for(a.faces=this.faces,e=0,t=this.morphTargets.length;e<t;e++){if(!this.morphNormals[e]){this.morphNormals[e]={},this.morphNormals[e].faceNormals=[],this.morphNormals[e].vertexNormals=[];var s=this.morphNormals[e].faceNormals,l=this.morphNormals[e].vertexNormals;for(r=0,i=this.faces.length;r<i;r++)u=new o,h={a:new o,b:new o,c:new o},s.push(u),l.push(h)}var c=this.morphNormals[e];a.vertices=this.morphTargets[e].vertices,a.computeFaceNormals(),a.computeVertexNormals();var u,h;for(r=0,i=this.faces.length;r<i;r++)n=this.faces[r],u=c.faceNormals[r],h=c.vertexNormals[r],u.copy(n.normal),h.a.copy(n.vertexNormals[0]),h.b.copy(n.vertexNormals[1]),h.c.copy(n.vertexNormals[2])}for(r=0,i=this.faces.length;r<i;r++)(n=this.faces[r]).normal=n.__originalFaceNormal,n.vertexNormals=n.__originalVertexNormals},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new p),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new d),this.boundingSphere.setFromPoints(this.vertices)},merge:function(e,t,r){if(e&&e.isGeometry){var i,n=this.vertices.length,o=this.vertices,s=e.vertices,l=this.faces,c=e.faces,u=this.faceVertexUvs[0],h=e.faceVertexUvs[0],p=this.colors,d=e.colors;void 0===r&&(r=0),void 0!==t&&(i=(new a).getNormalMatrix(t));for(var f=0,m=s.length;f<m;f++){var g=s[f].clone();void 0!==t&&g.applyMatrix4(t),o.push(g)}for(var f=0,m=d.length;f<m;f++)p.push(d[f].clone());for(f=0,m=c.length;f<m;f++){var v,y,E,b=c[f],_=b.vertexNormals,w=b.vertexColors;(v=new x(b.a+n,b.b+n,b.c+n)).normal.copy(b.normal),void 0!==i&&v.normal.applyMatrix3(i).normalize();for(var T=0,M=_.length;T<M;T++)y=_[T].clone(),void 0!==i&&y.applyMatrix3(i).normalize(),v.vertexNormals.push(y);v.color.copy(b.color);for(var T=0,M=w.length;T<M;T++)E=w[T],v.vertexColors.push(E.clone());v.materialIndex=b.materialIndex+r,l.push(v)}for(f=0,m=h.length;f<m;f++){var R=h[f],S=[];if(void 0!==R){for(var T=0,M=R.length;T<M;T++)S.push(R[T].clone());u.push(S)}}}else console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",e)},mergeMesh:function(e){e&&e.isMesh?(e.matrixAutoUpdate&&e.updateMatrix(),this.merge(e.geometry,e.matrix)):console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",e)},mergeVertices:function(){var e,t,r,i,n,o,a,s,l={},c=[],u=[],h=Math.pow(10,4);for(r=0,i=this.vertices.length;r<i;r++)e=this.vertices[r],void 0===l[t=Math.round(e.x*h)+"_"+Math.round(e.y*h)+"_"+Math.round(e.z*h)]?(l[t]=r,c.push(this.vertices[r]),u[r]=c.length-1):u[r]=u[l[t]];var p=[];for(r=0,i=this.faces.length;r<i;r++){(n=this.faces[r]).a=u[n.a],n.b=u[n.b],n.c=u[n.c],o=[n.a,n.b,n.c];for(var d=0;d<3;d++)if(o[d]===o[(d+1)%3]){p.push(r);break}}for(r=p.length-1;r>=0;r--){var f=p[r];for(this.faces.splice(f,1),a=0,s=this.faceVertexUvs.length;a<s;a++)this.faceVertexUvs[a].splice(f,1)}var m=this.vertices.length-c.length;return this.vertices=c,m},setFromPoints:function(e){this.vertices=[];for(var t=0,r=e.length;t<r;t++){var i=e[t];this.vertices.push(new o(i.x,i.y,i.z||0))}return this},sortFacesByMaterialIndex:function(){for(var e=this.faces,t=e.length,r=0;r<t;r++)e[r]._id=r;e.sort(function(e,t){return e.materialIndex-t.materialIndex});var i,n,o=this.faceVertexUvs[0],a=this.faceVertexUvs[1];o&&o.length===t&&(i=[]),a&&a.length===t&&(n=[]);for(r=0;r<t;r++){var s=e[r]._id;i&&i.push(o[s]),n&&n.push(a[s])}i&&(this.faceVertexUvs[0]=i),n&&(this.faceVertexUvs[1]=n)},toJSON:function(){function e(e,t,r){return r?e|1<<t:e&~(1<<t)}function t(e){var t=e.x.toString()+e.y.toString()+e.z.toString();return void 0!==p[t]?p[t]:(p[t]=h.length/3,h.push(e.x,e.y,e.z),p[t])}function r(e){var t=e.r.toString()+e.g.toString()+e.b.toString();return void 0!==f[t]?f[t]:(f[t]=d.length,d.push(e.getHex()),f[t])}function i(e){var t=e.x.toString()+e.y.toString();return void 0!==g[t]?g[t]:(g[t]=m.length/2,m.push(e.x,e.y),g[t])}var n={metadata:{version:4.5,type:"Geometry",generator:"Geometry.toJSON"}};if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),void 0!==this.parameters){var o=this.parameters;for(var a in o)void 0!==o[a]&&(n[a]=o[a]);return n}for(var s=[],l=0;l<this.vertices.length;l++){var c=this.vertices[l];s.push(c.x,c.y,c.z)}for(var u=[],h=[],p={},d=[],f={},m=[],g={},l=0;l<this.faces.length;l++){var v=this.faces[l],y=void 0!==this.faceVertexUvs[0][l],E=v.normal.length()>0,b=v.vertexNormals.length>0,x=1!==v.color.r||1!==v.color.g||1!==v.color.b,_=v.vertexColors.length>0,w=0;if(w=e(w,0,0),w=e(w,1,!0),w=e(w,2,!1),w=e(w,3,y),w=e(w,4,E),w=e(w,5,b),w=e(w,6,x),w=e(w,7,_),u.push(w),u.push(v.a,v.b,v.c),u.push(v.materialIndex),y){var T=this.faceVertexUvs[0][l];u.push(i(T[0]),i(T[1]),i(T[2]))}if(E&&u.push(t(v.normal)),b){var M=v.vertexNormals;u.push(t(M[0]),t(M[1]),t(M[2]))}if(x&&u.push(r(v.color)),_){var R=v.vertexColors;u.push(r(R[0]),r(R[1]),r(R[2]))}}return n.data={},n.data.vertices=s,n.data.normals=h,d.length>0&&(n.data.colors=d),m.length>0&&(n.data.uvs=[m]),n.data.faces=u,n},clone:function(){return(new M).copy(this)},copy:function(e){var t,r,i,n,o,a;this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.name=e.name;var s=e.vertices;for(t=0,r=s.length;t<r;t++)this.vertices.push(s[t].clone());var l=e.colors;for(t=0,r=l.length;t<r;t++)this.colors.push(l[t].clone());var c=e.faces;for(t=0,r=c.length;t<r;t++)this.faces.push(c[t].clone());for(t=0,r=e.faceVertexUvs.length;t<r;t++){var u=e.faceVertexUvs[t];for(void 0===this.faceVertexUvs[t]&&(this.faceVertexUvs[t]=[]),i=0,n=u.length;i<n;i++){var h=u[i],p=[];for(o=0,a=h.length;o<a;o++){var d=h[o];p.push(d.clone())}this.faceVertexUvs[t].push(p)}}var f=e.morphTargets;for(t=0,r=f.length;t<r;t++){var m={};if(m.name=f[t].name,void 0!==f[t].vertices)for(m.vertices=[],i=0,n=f[t].vertices.length;i<n;i++)m.vertices.push(f[t].vertices[i].clone());if(void 0!==f[t].normals)for(m.normals=[],i=0,n=f[t].normals.length;i<n;i++)m.normals.push(f[t].normals[i].clone());this.morphTargets.push(m)}var g=e.morphNormals;for(t=0,r=g.length;t<r;t++){var v={};if(void 0!==g[t].vertexNormals)for(v.vertexNormals=[],i=0,n=g[t].vertexNormals.length;i<n;i++){var y=g[t].vertexNormals[i],E={};E.a=y.a.clone(),E.b=y.b.clone(),E.c=y.c.clone(),v.vertexNormals.push(E)}if(void 0!==g[t].faceNormals)for(v.faceNormals=[],i=0,n=g[t].faceNormals.length;i<n;i++)v.faceNormals.push(g[t].faceNormals[i].clone());this.morphNormals.push(v)}var b=e.skinWeights;for(t=0,r=b.length;t<r;t++)this.skinWeights.push(b[t].clone());var x=e.skinIndices;for(t=0,r=x.length;t<r;t++)this.skinIndices.push(x[t].clone());var _=e.lineDistances;for(t=0,r=_.length;t<r;t++)this.lineDistances.push(_[t]);var w=e.boundingBox;null!==w&&(this.boundingBox=w.clone());var T=e.boundingSphere;return null!==T&&(this.boundingSphere=T.clone()),this.elementsNeedUpdate=e.elementsNeedUpdate,this.verticesNeedUpdate=e.verticesNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.lineDistancesNeedUpdate=e.lineDistancesNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Object.defineProperty(R.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Object.assign(R.prototype,{isBufferAttribute:!0,onUploadCallback:function(){},setArray:function(e){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");return this.count=void 0!==e?e.length/this.itemSize:0,this.array=e,this},setDynamic:function(e){return this.dynamic=e,this},copy:function(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.dynamic=e.dynamic,this},copyAt:function(e,t,r){e*=this.itemSize,r*=t.itemSize;for(var i=0,n=this.itemSize;i<n;i++)this.array[e+i]=t.array[r+i];return this},copyArray:function(e){return this.array.set(e),this},copyColorsArray:function(e){for(var t=this.array,r=0,i=0,n=e.length;i<n;i++){var o=e[i];void 0===o&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",i),o=new y),t[r++]=o.r,t[r++]=o.g,t[r++]=o.b}return this},copyVector2sArray:function(e){for(var t=this.array,i=0,n=0,o=e.length;n<o;n++){var a=e[n];void 0===a&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",n),a=new r),t[i++]=a.x,t[i++]=a.y}return this},copyVector3sArray:function(e){for(var t=this.array,r=0,i=0,n=e.length;i<n;i++){var a=e[i];void 0===a&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",i),a=new o),t[r++]=a.x,t[r++]=a.y,t[r++]=a.z}return this},copyVector4sArray:function(e){for(var t=this.array,r=0,i=0,n=e.length;i<n;i++){var o=e[i];void 0===o&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",i),o=new l),t[r++]=o.x,t[r++]=o.y,t[r++]=o.z,t[r++]=o.w}return this},set:function(e,t){return void 0===t&&(t=0),this.array.set(e,t),this},getX:function(e){return this.array[e*this.itemSize]},setX:function(e,t){return this.array[e*this.itemSize]=t,this},getY:function(e){return this.array[e*this.itemSize+1]},setY:function(e,t){return this.array[e*this.itemSize+1]=t,this},getZ:function(e){return this.array[e*this.itemSize+2]},setZ:function(e,t){return this.array[e*this.itemSize+2]=t,this},getW:function(e){return this.array[e*this.itemSize+3]},setW:function(e,t){return this.array[e*this.itemSize+3]=t,this},setXY:function(e,t,r){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=r,this},setXYZ:function(e,t,r,i){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=r,this.array[e+2]=i,this},setXYZW:function(e,t,r,i,n){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=r,this.array[e+2]=i,this.array[e+3]=n,this},onUpload:function(e){return this.onUploadCallback=e,this},clone:function(){return new this.constructor(this.array,this.itemSize).copy(this)}}),(S.prototype=Object.create(R.prototype)).constructor=S,(P.prototype=Object.create(R.prototype)).constructor=P,(A.prototype=Object.create(R.prototype)).constructor=A,(C.prototype=Object.create(R.prototype)).constructor=C,(L.prototype=Object.create(R.prototype)).constructor=L,(O.prototype=Object.create(R.prototype)).constructor=O,(H.prototype=Object.create(R.prototype)).constructor=H,(F.prototype=Object.create(R.prototype)).constructor=F,(I.prototype=Object.create(R.prototype)).constructor=I,Object.assign(k.prototype,{computeGroups:function(e){for(var t,r=[],i=void 0,n=e.faces,o=0;o<n.length;o++){var a=n[o];a.materialIndex!==i&&(i=a.materialIndex,void 0!==t&&(t.count=3*o-t.start,r.push(t)),t={start:3*o,materialIndex:i})}void 0!==t&&(t.count=3*o-t.start,r.push(t)),this.groups=r},fromGeometry:function(e){var t,i=e.faces,n=e.vertices,o=e.faceVertexUvs,a=o[0]&&o[0].length>0,s=o[1]&&o[1].length>0,l=e.morphTargets,c=l.length;if(c>0){t=[];for(v=0;v<c;v++)t[v]={name:l[v].name,data:[]};this.morphTargets.position=t}var u,h=e.morphNormals,p=h.length;if(p>0){u=[];for(v=0;v<p;v++)u[v]={name:h[v].name,data:[]};this.morphTargets.normal=u}var d=e.skinIndices,f=e.skinWeights,m=d.length===n.length,g=f.length===n.length;n.length>0&&0===i.length&&console.error("THREE.DirectGeometry: Faceless geometries are not supported.");for(var v=0;v<i.length;v++){var y=i[v];this.vertices.push(n[y.a],n[y.b],n[y.c]);var E=y.vertexNormals;if(3===E.length)this.normals.push(E[0],E[1],E[2]);else{var b=y.normal;this.normals.push(b,b,b)}var x=y.vertexColors;if(3===x.length)this.colors.push(x[0],x[1],x[2]);else{var _=y.color;this.colors.push(_,_,_)}if(!0===a){void 0!==(w=o[0][v])?this.uvs.push(w[0],w[1],w[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",v),this.uvs.push(new r,new r,new r))}if(!0===s){var w=o[1][v];void 0!==w?this.uvs2.push(w[0],w[1],w[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",v),this.uvs2.push(new r,new r,new r))}for(M=0;M<c;M++){var T=l[M].vertices;t[M].data.push(T[y.a],T[y.b],T[y.c])}for(var M=0;M<p;M++){var R=h[M].vertexNormals[v];u[M].data.push(R.a,R.b,R.c)}m&&this.skinIndices.push(d[y.a],d[y.b],d[y.c]),g&&this.skinWeights.push(f[y.a],f[y.b],f[y.c])}return this.computeGroups(e),this.verticesNeedUpdate=e.verticesNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,this}});var gs=1;N.prototype=Object.assign(Object.create(t.prototype),{constructor:N,isBufferGeometry:!0,getIndex:function(){return this.index},setIndex:function(e){Array.isArray(e)?this.index=new(D(e)>65535?H:L)(e,1):this.index=e},addAttribute:function(e,t){return t&&t.isBufferAttribute||t&&t.isInterleavedBufferAttribute?"index"===e?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(t),this):(this.attributes[e]=t,this):(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.addAttribute(e,new R(arguments[1],arguments[2])))},getAttribute:function(e){return this.attributes[e]},removeAttribute:function(e){return delete this.attributes[e],this},addGroup:function(e,t,r){this.groups.push({start:e,count:t,materialIndex:void 0!==r?r:0})},clearGroups:function(){this.groups=[]},setDrawRange:function(e,t){this.drawRange.start=e,this.drawRange.count=t},applyMatrix:function(e){var t=this.attributes.position;void 0!==t&&(e.applyToBufferAttribute(t),t.needsUpdate=!0);var r=this.attributes.normal;if(void 0!==r){(new a).getNormalMatrix(e).applyToBufferAttribute(r),r.needsUpdate=!0}return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this},rotateX:function(){var e=new i;return function(t){return e.makeRotationX(t),this.applyMatrix(e),this}}(),rotateY:function(){var e=new i;return function(t){return e.makeRotationY(t),this.applyMatrix(e),this}}(),rotateZ:function(){var e=new i;return function(t){return e.makeRotationZ(t),this.applyMatrix(e),this}}(),translate:function(){var e=new i;return function(t,r,i){return e.makeTranslation(t,r,i),this.applyMatrix(e),this}}(),scale:function(){var e=new i;return function(t,r,i){return e.makeScale(t,r,i),this.applyMatrix(e),this}}(),lookAt:function(){var e=new T;return function(t){e.lookAt(t),e.updateMatrix(),this.applyMatrix(e.matrix)}}(),center:function(){var e=new o;return function(){return this.computeBoundingBox(),this.boundingBox.getCenter(e).negate(),this.translate(e.x,e.y,e.z),this}}(),setFromObject:function(e){var t=e.geometry;if(e.isPoints||e.isLine){var r=new F(3*t.vertices.length,3),i=new F(3*t.colors.length,3);if(this.addAttribute("position",r.copyVector3sArray(t.vertices)),this.addAttribute("color",i.copyColorsArray(t.colors)),t.lineDistances&&t.lineDistances.length===t.vertices.length){var n=new F(t.lineDistances.length,1);this.addAttribute("lineDistance",n.copyArray(t.lineDistances))}null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone())}else e.isMesh&&t&&t.isGeometry&&this.fromGeometry(t);return this},setFromPoints:function(e){for(var t=[],r=0,i=e.length;r<i;r++){var n=e[r];t.push(n.x,n.y,n.z||0)}return this.addAttribute("position",new F(t,3)),this},updateFromObject:function(e){var t=e.geometry;if(e.isMesh){var r=t.__directGeometry;if(!0===t.elementsNeedUpdate&&(r=void 0,t.elementsNeedUpdate=!1),void 0===r)return this.fromGeometry(t);r.verticesNeedUpdate=t.verticesNeedUpdate,r.normalsNeedUpdate=t.normalsNeedUpdate,r.colorsNeedUpdate=t.colorsNeedUpdate,r.uvsNeedUpdate=t.uvsNeedUpdate,r.groupsNeedUpdate=t.groupsNeedUpdate,t.verticesNeedUpdate=!1,t.normalsNeedUpdate=!1,t.colorsNeedUpdate=!1,t.uvsNeedUpdate=!1,t.groupsNeedUpdate=!1,t=r}var i;return!0===t.verticesNeedUpdate&&(void 0!==(i=this.attributes.position)&&(i.copyVector3sArray(t.vertices),i.needsUpdate=!0),t.verticesNeedUpdate=!1),!0===t.normalsNeedUpdate&&(void 0!==(i=this.attributes.normal)&&(i.copyVector3sArray(t.normals),i.needsUpdate=!0),t.normalsNeedUpdate=!1),!0===t.colorsNeedUpdate&&(void 0!==(i=this.attributes.color)&&(i.copyColorsArray(t.colors),i.needsUpdate=!0),t.colorsNeedUpdate=!1),t.uvsNeedUpdate&&(void 0!==(i=this.attributes.uv)&&(i.copyVector2sArray(t.uvs),i.needsUpdate=!0),t.uvsNeedUpdate=!1),t.lineDistancesNeedUpdate&&(void 0!==(i=this.attributes.lineDistance)&&(i.copyArray(t.lineDistances),i.needsUpdate=!0),t.lineDistancesNeedUpdate=!1),t.groupsNeedUpdate&&(t.computeGroups(e.geometry),this.groups=t.groups,t.groupsNeedUpdate=!1),this},fromGeometry:function(e){return e.__directGeometry=(new k).fromGeometry(e),this.fromDirectGeometry(e.__directGeometry)},fromDirectGeometry:function(e){var t=new Float32Array(3*e.vertices.length);if(this.addAttribute("position",new R(t,3).copyVector3sArray(e.vertices)),e.normals.length>0){var r=new Float32Array(3*e.normals.length);this.addAttribute("normal",new R(r,3).copyVector3sArray(e.normals))}if(e.colors.length>0){var i=new Float32Array(3*e.colors.length);this.addAttribute("color",new R(i,3).copyColorsArray(e.colors))}if(e.uvs.length>0){var n=new Float32Array(2*e.uvs.length);this.addAttribute("uv",new R(n,2).copyVector2sArray(e.uvs))}if(e.uvs2.length>0){var o=new Float32Array(2*e.uvs2.length);this.addAttribute("uv2",new R(o,2).copyVector2sArray(e.uvs2))}this.groups=e.groups;for(var a in e.morphTargets){for(var s=[],l=e.morphTargets[a],c=0,u=l.length;c<u;c++){var h=l[c],p=new F(3*h.data.length,3);p.name=h.name,s.push(p.copyVector3sArray(h.data))}this.morphAttributes[a]=s}if(e.skinIndices.length>0){var d=new F(4*e.skinIndices.length,4);this.addAttribute("skinIndex",d.copyVector4sArray(e.skinIndices))}if(e.skinWeights.length>0){var f=new F(4*e.skinWeights.length,4);this.addAttribute("skinWeight",f.copyVector4sArray(e.skinWeights))}return null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),this},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new p);var e=this.attributes.position;void 0!==e?this.boundingBox.setFromBufferAttribute(e):this.boundingBox.makeEmpty(),(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)},computeBoundingSphere:function(){var e=new p,t=new o;return function(){null===this.boundingSphere&&(this.boundingSphere=new d);var r=this.attributes.position;if(r){var i=this.boundingSphere.center;e.setFromBufferAttribute(r),e.getCenter(i);for(var n=0,o=0,a=r.count;o<a;o++)t.x=r.getX(o),t.y=r.getY(o),t.z=r.getZ(o),n=Math.max(n,i.distanceToSquared(t));this.boundingSphere.radius=Math.sqrt(n),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}}(),computeFaceNormals:function(){},computeVertexNormals:function(){var e=this.index,t=this.attributes;if(t.position){var r=t.position.array;if(void 0===t.normal)this.addAttribute("normal",new R(new Float32Array(r.length),3));else for(var i=t.normal.array,n=0,a=i.length;n<a;n++)i[n]=0;var s,l,c,u=t.normal.array,h=new o,p=new o,d=new o,f=new o,m=new o;if(e)for(var g=e.array,n=0,a=e.count;n<a;n+=3)s=3*g[n+0],l=3*g[n+1],c=3*g[n+2],h.fromArray(r,s),p.fromArray(r,l),d.fromArray(r,c),f.subVectors(d,p),m.subVectors(h,p),f.cross(m),u[s]+=f.x,u[s+1]+=f.y,u[s+2]+=f.z,u[l]+=f.x,u[l+1]+=f.y,u[l+2]+=f.z,u[c]+=f.x,u[c+1]+=f.y,u[c+2]+=f.z;else for(var n=0,a=r.length;n<a;n+=9)h.fromArray(r,n),p.fromArray(r,n+3),d.fromArray(r,n+6),f.subVectors(d,p),m.subVectors(h,p),f.cross(m),u[n]=f.x,u[n+1]=f.y,u[n+2]=f.z,u[n+3]=f.x,u[n+4]=f.y,u[n+5]=f.z,u[n+6]=f.x,u[n+7]=f.y,u[n+8]=f.z;this.normalizeNormals(),t.normal.needsUpdate=!0}},merge:function(e,t){if(e&&e.isBufferGeometry){void 0===t&&(t=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));var r=this.attributes;for(var i in r)if(void 0!==e.attributes[i])for(var n=r[i].array,o=e.attributes[i],a=o.array,s=0,l=o.itemSize*t;s<a.length;s++,l++)n[l]=a[s];return this}console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",e)},normalizeNormals:function(){var e=new o;return function(){for(var t=this.attributes.normal,r=0,i=t.count;r<i;r++)e.x=t.getX(r),e.y=t.getY(r),e.z=t.getZ(r),e.normalize(),t.setXYZ(r,e.x,e.y,e.z)}}(),toNonIndexed:function(){if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): Geometry is already non-indexed."),this;var e=new N,t=this.index.array,r=this.attributes;for(var i in r){for(var n=r[i],o=n.array,a=n.itemSize,s=new o.constructor(t.length*a),l=0,c=0,u=0,h=t.length;u<h;u++){l=t[u]*a;for(var p=0;p<a;p++)s[c++]=o[l++]}e.addAttribute(i,new R(s,a))}for(var d=this.groups,u=0,h=d.length;u<h;u++){var f=d[u];e.addGroup(f.start,f.count,f.materialIndex)}return e},toJSON:function(){var e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),void 0!==this.parameters){var t=this.parameters;for(var r in t)void 0!==t[r]&&(e[r]=t[r]);return e}e.data={attributes:{}};var i=this.index;if(null!==i){a=Array.prototype.slice.call(i.array);e.data.index={type:i.array.constructor.name,array:a}}var n=this.attributes;for(var r in n){var o=n[r],a=Array.prototype.slice.call(o.array);e.data.attributes[r]={itemSize:o.itemSize,type:o.array.constructor.name,array:a,normalized:o.normalized}}var s=this.groups;s.length>0&&(e.data.groups=JSON.parse(JSON.stringify(s)));var l=this.boundingSphere;return null!==l&&(e.data.boundingSphere={center:l.center.toArray(),radius:l.radius}),e},clone:function(){return(new N).copy(this)},copy:function(e){var t,r,i;this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.name=e.name;var n=e.index;null!==n&&this.setIndex(n.clone());var o=e.attributes;for(t in o){var a=o[t];this.addAttribute(t,a.clone())}var s=e.morphAttributes;for(t in s){var l=[],c=s[t];for(r=0,i=c.length;r<i;r++)l.push(c[r].clone());this.morphAttributes[t]=l}var u=e.groups;for(r=0,i=u.length;r<i;r++){var h=u[r];this.addGroup(h.start,h.count,h.materialIndex)}var p=e.boundingBox;null!==p&&(this.boundingBox=p.clone());var d=e.boundingSphere;return null!==d&&(this.boundingSphere=d.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),(j.prototype=Object.create(M.prototype)).constructor=j,(U.prototype=Object.create(N.prototype)).constructor=U,(B.prototype=Object.create(M.prototype)).constructor=B,(V.prototype=Object.create(N.prototype)).constructor=V;var vs=0;z.prototype=Object.assign(Object.create(t.prototype),{constructor:z,isMaterial:!0,onBeforeCompile:function(){},setValues:function(e){if(void 0!==e)for(var t in e){var r=e[t];if(void 0!==r)if("shading"!==t){var i=this[t];void 0!==i?i&&i.isColor?i.set(r):i&&i.isVector3&&r&&r.isVector3?i.copy(r):this[t]=r:console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.")}else console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===r;else console.warn("THREE.Material: '"+t+"' parameter is undefined.")}},toJSON:function(e){function t(e){var t=[];for(var r in e){var i=e[r];delete i.metadata,t.push(i)}return t}var r=void 0===e||"string"==typeof e;r&&(e={textures:{},images:{}});var i={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),void 0!==this.roughness&&(i.roughness=this.roughness),void 0!==this.metalness&&(i.metalness=this.metalness),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),1!==this.emissiveIntensity&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),void 0!==this.shininess&&(i.shininess=this.shininess),void 0!==this.clearCoat&&(i.clearCoat=this.clearCoat),void 0!==this.clearCoatRoughness&&(i.clearCoatRoughness=this.clearCoatRoughness),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(e).uuid),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(e).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(e).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(e).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(e).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(e).uuid,i.reflectivity=this.reflectivity,void 0!==this.combine&&(i.combine=this.combine),void 0!==this.envMapIntensity&&(i.envMapIntensity=this.envMapIntensity)),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.size&&(i.size=this.size),void 0!==this.sizeAttenuation&&(i.sizeAttenuation=this.sizeAttenuation),this.blending!==Zn&&(i.blending=this.blending),!0===this.flatShading&&(i.flatShading=this.flatShading),this.side!==Gn&&(i.side=this.side),this.vertexColors!==Yn&&(i.vertexColors=this.vertexColors),this.opacity<1&&(i.opacity=this.opacity),!0===this.transparent&&(i.transparent=this.transparent),i.depthFunc=this.depthFunc,i.depthTest=this.depthTest,i.depthWrite=this.depthWrite,0!==this.rotation&&(i.rotation=this.rotation),!0===this.polygonOffset&&(i.polygonOffset=!0),0!==this.polygonOffsetFactor&&(i.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(i.polygonOffsetUnits=this.polygonOffsetUnits),1!==this.linewidth&&(i.linewidth=this.linewidth),void 0!==this.dashSize&&(i.dashSize=this.dashSize),void 0!==this.gapSize&&(i.gapSize=this.gapSize),void 0!==this.scale&&(i.scale=this.scale),!0===this.dithering&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),!0===this.premultipliedAlpha&&(i.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(i.wireframe=this.wireframe),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(i.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(i.wireframeLinejoin=this.wireframeLinejoin),!0===this.morphTargets&&(i.morphTargets=!0),!0===this.skinning&&(i.skinning=!0),!1===this.visible&&(i.visible=!1),"{}"!==JSON.stringify(this.userData)&&(i.userData=this.userData),r){var n=t(e.textures),o=t(e.images);n.length>0&&(i.textures=n),o.length>0&&(i.images=o)}return i},clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.name=e.name,this.fog=e.fog,this.lights=e.lights,this.blending=e.blending,this.side=e.side,this.flatShading=e.flatShading,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.premultipliedAlpha=e.premultipliedAlpha,this.visible=e.visible,this.userData=JSON.parse(JSON.stringify(e.userData)),this.clipShadows=e.clipShadows,this.clipIntersection=e.clipIntersection;var t=e.clippingPlanes,r=null;if(null!==t){var i=t.length;r=new Array(i);for(var n=0;n!==i;++n)r[n]=t[n].clone()}return this.clippingPlanes=r,this.shadowSide=e.shadowSide,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),(q.prototype=Object.create(z.prototype)).constructor=q,q.prototype.isShaderMaterial=!0,q.prototype.copy=function(e){return z.prototype.copy.call(this,e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=g(e.uniforms),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.lights=e.lights,this.clipping=e.clipping,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.extensions=e.extensions,this},q.prototype.toJSON=function(e){var t=z.prototype.toJSON.call(this,e);t.uniforms={};for(var r in this.uniforms){var i=this.uniforms[r].value;i.isTexture?t.uniforms[r]={type:"t",value:i.toJSON(e).uuid}:i.isColor?t.uniforms[r]={type:"c",value:i.getHex()}:i.isVector2?t.uniforms[r]={type:"v2",value:i.toArray()}:i.isVector3?t.uniforms[r]={type:"v3",value:i.toArray()}:i.isVector4?t.uniforms[r]={type:"v4",value:i.toArray()}:i.isMatrix4?t.uniforms[r]={type:"m4",value:i.toArray()}:t.uniforms[r]={value:i}}return Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t},Object.assign(G.prototype,{set:function(e,t){return this.origin.copy(e),this.direction.copy(t),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this},at:function(e,t){return void 0===t&&(console.warn("THREE.Ray: .at() target is now required"),t=new o),t.copy(this.direction).multiplyScalar(e).add(this.origin)},lookAt:function(e){return this.direction.copy(e).sub(this.origin).normalize(),this},recast:function(){var e=new o;return function(t){return this.origin.copy(this.at(t,e)),this}}(),closestPointToPoint:function(e,t){void 0===t&&(console.warn("THREE.Ray: .closestPointToPoint() target is now required"),t=new o),t.subVectors(e,this.origin);var r=t.dot(this.direction);return r<0?t.copy(this.origin):t.copy(this.direction).multiplyScalar(r).add(this.origin)},distanceToPoint:function(e){return Math.sqrt(this.distanceSqToPoint(e))},distanceSqToPoint:function(){var e=new o;return function(t){var r=e.subVectors(t,this.origin).dot(this.direction);return r<0?this.origin.distanceToSquared(t):(e.copy(this.direction).multiplyScalar(r).add(this.origin),e.distanceToSquared(t))}}(),distanceSqToSegment:function(){var e=new o,t=new o,r=new o;return function(i,n,o,a){e.copy(i).add(n).multiplyScalar(.5),t.copy(n).sub(i).normalize(),r.copy(this.origin).sub(e);var s,l,c,u,h=.5*i.distanceTo(n),p=-this.direction.dot(t),d=r.dot(this.direction),f=-r.dot(t),m=r.lengthSq(),g=Math.abs(1-p*p);if(g>0)if(s=p*f-d,l=p*d-f,u=h*g,s>=0)if(l>=-u)if(l<=u){var v=1/g;c=(s*=v)*(s+p*(l*=v)+2*d)+l*(p*s+l+2*f)+m}else l=h,c=-(s=Math.max(0,-(p*l+d)))*s+l*(l+2*f)+m;else l=-h,c=-(s=Math.max(0,-(p*l+d)))*s+l*(l+2*f)+m;else l<=-u?c=-(s=Math.max(0,-(-p*h+d)))*s+(l=s>0?-h:Math.min(Math.max(-h,-f),h))*(l+2*f)+m:l<=u?(s=0,c=(l=Math.min(Math.max(-h,-f),h))*(l+2*f)+m):c=-(s=Math.max(0,-(p*h+d)))*s+(l=s>0?h:Math.min(Math.max(-h,-f),h))*(l+2*f)+m;else l=p>0?-h:h,c=-(s=Math.max(0,-(p*l+d)))*s+l*(l+2*f)+m;return o&&o.copy(this.direction).multiplyScalar(s).add(this.origin),a&&a.copy(t).multiplyScalar(l).add(e),c}}(),intersectSphere:function(){var e=new o;return function(t,r){e.subVectors(t.center,this.origin);var i=e.dot(this.direction),n=e.dot(e)-i*i,o=t.radius*t.radius;if(n>o)return null;var a=Math.sqrt(o-n),s=i-a,l=i+a;return s<0&&l<0?null:s<0?this.at(l,r):this.at(s,r)}}(),intersectsSphere:function(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius},distanceToPlane:function(e){var t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;var r=-(this.origin.dot(e.normal)+e.constant)/t;return r>=0?r:null},intersectPlane:function(e,t){var r=this.distanceToPlane(e);return null===r?null:this.at(r,t)},intersectsPlane:function(e){var t=e.distanceToPoint(this.origin);if(0===t)return!0;return e.normal.dot(this.direction)*t<0},intersectBox:function(e,t){var r,i,n,o,a,s,l=1/this.direction.x,c=1/this.direction.y,u=1/this.direction.z,h=this.origin;return l>=0?(r=(e.min.x-h.x)*l,i=(e.max.x-h.x)*l):(r=(e.max.x-h.x)*l,i=(e.min.x-h.x)*l),c>=0?(n=(e.min.y-h.y)*c,o=(e.max.y-h.y)*c):(n=(e.max.y-h.y)*c,o=(e.min.y-h.y)*c),r>o||n>i?null:((n>r||r!=r)&&(r=n),(o<i||i!=i)&&(i=o),u>=0?(a=(e.min.z-h.z)*u,s=(e.max.z-h.z)*u):(a=(e.max.z-h.z)*u,s=(e.min.z-h.z)*u),r>s||a>i?null:((a>r||r!=r)&&(r=a),(s<i||i!=i)&&(i=s),i<0?null:this.at(r>=0?r:i,t)))},intersectsBox:function(){var e=new o;return function(t){return null!==this.intersectBox(t,e)}}(),intersectTriangle:function(){var e=new o,t=new o,r=new o,i=new o;return function(n,o,a,s,l){t.subVectors(o,n),r.subVectors(a,n),i.crossVectors(t,r);var c,u=this.direction.dot(i);if(u>0){if(s)return null;c=1}else{if(!(u<0))return null;c=-1,u=-u}e.subVectors(this.origin,n);var h=c*this.direction.dot(r.crossVectors(e,r));if(h<0)return null;var p=c*this.direction.dot(t.cross(e));if(p<0)return null;if(h+p>u)return null;var d=-c*e.dot(i);return d<0?null:this.at(d/u,l)}}(),applyMatrix4:function(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this},equals:function(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}}),Object.assign(W,{getNormal:function(){var e=new o;return function(t,r,i,n){void 0===n&&(console.warn("THREE.Triangle: .getNormal() target is now required"),n=new o),n.subVectors(i,r),e.subVectors(t,r),n.cross(e);var a=n.lengthSq();return a>0?n.multiplyScalar(1/Math.sqrt(a)):n.set(0,0,0)}}(),getBarycoord:function(){var e=new o,t=new o,r=new o;return function(i,n,a,s,l){e.subVectors(s,n),t.subVectors(a,n),r.subVectors(i,n);var c=e.dot(e),u=e.dot(t),h=e.dot(r),p=t.dot(t),d=t.dot(r),f=c*p-u*u;if(void 0===l&&(console.warn("THREE.Triangle: .getBarycoord() target is now required"),l=new o),0===f)return l.set(-2,-1,-1);var m=1/f,g=(p*h-u*d)*m,v=(c*d-u*h)*m;return l.set(1-g-v,v,g)}}(),containsPoint:function(){var e=new o;return function(t,r,i,n){return W.getBarycoord(t,r,i,n,e),e.x>=0&&e.y>=0&&e.x+e.y<=1}}(),getUV:function(){var e=new o;return function(t,r,i,n,o,a,s,l){return this.getBarycoord(t,r,i,n,e),l.set(0,0),l.addScaledVector(o,e.x),l.addScaledVector(a,e.y),l.addScaledVector(s,e.z),l}}()}),Object.assign(W.prototype,{set:function(e,t,r){return this.a.copy(e),this.b.copy(t),this.c.copy(r),this},setFromPointsAndIndices:function(e,t,r,i){return this.a.copy(e[t]),this.b.copy(e[r]),this.c.copy(e[i]),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this},getArea:function(){var e=new o,t=new o;return function(){return e.subVectors(this.c,this.b),t.subVectors(this.a,this.b),.5*e.cross(t).length()}}(),getMidpoint:function(e){return void 0===e&&(console.warn("THREE.Triangle: .getMidpoint() target is now required"),e=new o),e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},getNormal:function(e){return W.getNormal(this.a,this.b,this.c,e)},getPlane:function(e){return void 0===e&&(console.warn("THREE.Triangle: .getPlane() target is now required"),e=new o),e.setFromCoplanarPoints(this.a,this.b,this.c)},getBarycoord:function(e,t){return W.getBarycoord(e,this.a,this.b,this.c,t)},containsPoint:function(e){return W.containsPoint(e,this.a,this.b,this.c)},getUV:function(e,t,r,i,n){return W.getUV(e,this.a,this.b,this.c,t,r,i,n)},intersectsBox:function(e){return e.intersectsTriangle(this)},closestPointToPoint:function(){var e=new o,t=new o,r=new o,i=new o,n=new o,a=new o;return function(s,l){void 0===l&&(console.warn("THREE.Triangle: .closestPointToPoint() target is now required"),l=new o);var c,u,h=this.a,p=this.b,d=this.c;e.subVectors(p,h),t.subVectors(d,h),i.subVectors(s,h);var f=e.dot(i),m=t.dot(i);if(f<=0&&m<=0)return l.copy(h);n.subVectors(s,p);var g=e.dot(n),v=t.dot(n);if(g>=0&&v<=g)return l.copy(p);var y=f*v-g*m;if(y<=0&&f>=0&&g<=0)return c=f/(f-g),l.copy(h).addScaledVector(e,c);a.subVectors(s,d);var E=e.dot(a),b=t.dot(a);if(b>=0&&E<=b)return l.copy(d);var x=E*m-f*b;if(x<=0&&m>=0&&b<=0)return u=m/(m-b),l.copy(h).addScaledVector(t,u);var _=g*b-E*v;if(_<=0&&v-g>=0&&E-b>=0)return r.subVectors(d,p),u=(v-g)/(v-g+(E-b)),l.copy(p).addScaledVector(r,u);var w=1/(_+x+y);return c=x*w,u=y*w,l.copy(h).addScaledVector(e,c).addScaledVector(t,u)}}(),equals:function(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}),(X.prototype=Object.create(z.prototype)).constructor=X,X.prototype.isMeshBasicMaterial=!0,X.prototype.copy=function(e){return z.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this},Y.prototype=Object.assign(Object.create(T.prototype),{constructor:Y,isMesh:!0,setDrawMode:function(e){this.drawMode=e},copy:function(e){return T.prototype.copy.call(this,e),this.drawMode=e.drawMode,void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this},updateMorphTargets:function(){var e,t,r,i=this.geometry;if(i.isBufferGeometry){var n=i.morphAttributes,o=Object.keys(n);if(o.length>0){var a=n[o[0]];if(void 0!==a)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},e=0,t=a.length;e<t;e++)r=a[e].name||String(e),this.morphTargetInfluences.push(0),this.morphTargetDictionary[r]=e}}else{var s=i.morphTargets;if(void 0!==s&&s.length>0)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},e=0,t=s.length;e<t;e++)r=s[e].name||String(e),this.morphTargetInfluences.push(0),this.morphTargetDictionary[r]=e}},raycast:function(){function e(e,t,r,i,n,o,a,s){if(null===(t.side===Wn?i.intersectTriangle(a,o,n,!0,s):i.intersectTriangle(n,o,a,t.side!==Xn,s)))return null;E.copy(s),E.applyMatrix4(e.matrixWorld);var l=r.ray.origin.distanceTo(E);return l<r.near||l>r.far?null:{distance:l,point:E.clone(),object:e}}function t(t,i,n,o,a,s,h,p,d){l.fromBufferAttribute(a,h),c.fromBufferAttribute(a,p),u.fromBufferAttribute(a,d);var f=e(t,i,n,o,l,c,u,y);if(f){s&&(m.fromBufferAttribute(s,h),g.fromBufferAttribute(s,p),v.fromBufferAttribute(s,d),f.uv=W.getUV(y,l,c,u,m,g,v,new r));var E=new x(h,p,d);W.getNormal(l,c,u,E.normal),f.face=E}return f}var n=new i,a=new G,s=new d,l=new o,c=new o,u=new o,h=new o,p=new o,f=new o,m=new r,g=new r,v=new r,y=new o,E=new o;return function(i,o){var d=this.geometry,E=this.material,b=this.matrixWorld;if(void 0!==E&&(null===d.boundingSphere&&d.computeBoundingSphere(),s.copy(d.boundingSphere),s.applyMatrix4(b),!1!==i.ray.intersectsSphere(s)&&(n.getInverse(b),a.copy(i.ray).applyMatrix4(n),null===d.boundingBox||!1!==a.intersectsBox(d.boundingBox)))){var x;if(d.isBufferGeometry){var _,w,T,M,R,S,P,A,C,L=d.index,O=d.attributes.position,H=d.attributes.uv,F=d.groups,I=d.drawRange;if(null!==L)if(Array.isArray(E))for(M=0,S=F.length;M<S;M++)for(C=E[(A=F[M]).materialIndex],R=Math.max(A.start,I.start),P=Math.min(A.start+A.count,I.start+I.count);R<P;R+=3)_=L.getX(R),w=L.getX(R+1),T=L.getX(R+2),(x=t(this,C,i,a,O,H,_,w,T))&&(x.faceIndex=Math.floor(R/3),o.push(x));else for(M=Math.max(0,I.start),S=Math.min(L.count,I.start+I.count);M<S;M+=3)_=L.getX(M),w=L.getX(M+1),T=L.getX(M+2),(x=t(this,E,i,a,O,H,_,w,T))&&(x.faceIndex=Math.floor(M/3),o.push(x));else if(void 0!==O)if(Array.isArray(E))for(M=0,S=F.length;M<S;M++)for(C=E[(A=F[M]).materialIndex],R=Math.max(A.start,I.start),P=Math.min(A.start+A.count,I.start+I.count);R<P;R+=3)(x=t(this,C,i,a,O,H,_=R,w=R+1,T=R+2))&&(x.faceIndex=Math.floor(R/3),o.push(x));else for(M=Math.max(0,I.start),S=Math.min(O.count,I.start+I.count);M<S;M+=3)(x=t(this,E,i,a,O,H,_=M,w=M+1,T=M+2))&&(x.faceIndex=Math.floor(M/3),o.push(x))}else if(d.isGeometry){var k,D,N,j,U=Array.isArray(E),B=d.vertices,V=d.faces,z=d.faceVertexUvs[0];z.length>0&&(j=z);for(var q=0,G=V.length;q<G;q++){var X=V[q],Y=U?E[X.materialIndex]:E;if(void 0!==Y){if(k=B[X.a],D=B[X.b],N=B[X.c],!0===Y.morphTargets){var Q=d.morphTargets,J=this.morphTargetInfluences;l.set(0,0,0),c.set(0,0,0),u.set(0,0,0);for(var K=0,Z=Q.length;K<Z;K++){var $=J[K];if(0!==$){var ee=Q[K].vertices;l.addScaledVector(h.subVectors(ee[X.a],k),$),c.addScaledVector(p.subVectors(ee[X.b],D),$),u.addScaledVector(f.subVectors(ee[X.c],N),$)}}l.add(k),c.add(D),u.add(N),k=l,D=c,N=u}if(x=e(this,Y,i,a,k,D,N,y)){if(j&&j[q]){var te=j[q];m.copy(te[0]),g.copy(te[1]),v.copy(te[2]),x.uv=W.getUV(y,k,D,N,m,g,v,new r)}x.face=X,x.faceIndex=q,o.push(x)}}}}}}}(),clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),(J.prototype=Object.create(s.prototype)).constructor=J,J.prototype.isCubeTexture=!0,Object.defineProperty(J.prototype,"images",{get:function(){return this.image},set:function(e){this.image=e}}),(K.prototype=Object.create(s.prototype)).constructor=K,K.prototype.isDataTexture3D=!0;var ys=new s,Es=new K,bs=new J,xs=[],_s=[],ws=new Float32Array(16),Ts=new Float32Array(9),Ms=new Float32Array(4);Pe.prototype.updateCache=function(e){var t=this.cache;e instanceof Float32Array&&t.length!==e.length&&(this.cache=new Float32Array(e.length)),te(t,e)},Ae.prototype.setValue=function(e,t,r){for(var i=this.seq,n=0,o=i.length;n!==o;++n){var a=i[n];a.setValue(e,t[a.id],r)}};var Rs=/([\w\d_]+)(\])?(\[|\.)?/g;Oe.prototype.setValue=function(e,t,r){var i=this.map[t];void 0!==i&&i.setValue(e,r,this.renderer)},Oe.prototype.setOptional=function(e,t,r){var i=t[r];void 0!==i&&this.setValue(e,r,i)},Oe.upload=function(e,t,r,i){for(var n=0,o=t.length;n!==o;++n){var a=t[n],s=r[a.id];!1!==s.needsUpdate&&a.setValue(e,s.value,i)}},Oe.seqWithValue=function(e,t){for(var r=[],i=0,n=e.length;i!==n;++i){var o=e[i];o.id in t&&r.push(o)}return r};var Ss=0,Ps=0;(Ye.prototype=Object.create(z.prototype)).constructor=Ye,Ye.prototype.isMeshDepthMaterial=!0,Ye.prototype.copy=function(e){return z.prototype.copy.call(this,e),this.depthPacking=e.depthPacking,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this},(Qe.prototype=Object.create(z.prototype)).constructor=Qe,Qe.prototype.isMeshDistanceMaterial=!0,Qe.prototype.copy=function(e){return z.prototype.copy.call(this,e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this},$e.prototype=Object.assign(Object.create(T.prototype),{constructor:$e,isGroup:!0}),et.prototype=Object.assign(Object.create(T.prototype),{constructor:et,isCamera:!0,copy:function(e,t){return T.prototype.copy.call(this,e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this},getWorldDirection:function(e){void 0===e&&(console.warn("THREE.Camera: .getWorldDirection() target is now required"),e=new o),this.updateMatrixWorld(!0);var t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()},updateMatrixWorld:function(e){T.prototype.updateMatrixWorld.call(this,e),this.matrixWorldInverse.getInverse(this.matrixWorld)},clone:function(){return(new this.constructor).copy(this)}}),tt.prototype=Object.assign(Object.create(et.prototype),{constructor:tt,isPerspectiveCamera:!0,copy:function(e,t){return et.prototype.copy.call(this,e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this},setFocalLength:function(e){var t=.5*this.getFilmHeight()/e;this.fov=2*os.RAD2DEG*Math.atan(t),this.updateProjectionMatrix()},getFocalLength:function(){var e=Math.tan(.5*os.DEG2RAD*this.fov);return.5*this.getFilmHeight()/e},getEffectiveFOV:function(){return 2*os.RAD2DEG*Math.atan(Math.tan(.5*os.DEG2RAD*this.fov)/this.zoom)},getFilmWidth:function(){return this.filmGauge*Math.min(this.aspect,1)},getFilmHeight:function(){return this.filmGauge/Math.max(this.aspect,1)},setViewOffset:function(e,t,r,i,n,o){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=r,this.view.offsetY=i,this.view.width=n,this.view.height=o,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var e=this.near,t=e*Math.tan(.5*os.DEG2RAD*this.fov)/this.zoom,r=2*t,i=this.aspect*r,n=-.5*i,o=this.view;if(null!==this.view&&this.view.enabled){var a=o.fullWidth,s=o.fullHeight;n+=o.offsetX*i/a,t-=o.offsetY*r/s,i*=o.width/a,r*=o.height/s}var l=this.filmOffset;0!==l&&(n+=e*l/this.getFilmWidth()),this.projectionMatrix.makePerspective(n,n+i,t,t-r,e,this.far),this.projectionMatrixInverse.getInverse(this.projectionMatrix)},toJSON:function(e){var t=T.prototype.toJSON.call(this,e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}),rt.prototype=Object.assign(Object.create(tt.prototype),{constructor:rt,isArrayCamera:!0});var As=new o,Cs=new o;at.prototype.isFogExp2=!0,at.prototype.clone=function(){return new at(this.color,this.density)},at.prototype.toJSON=function(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}},st.prototype.isFog=!0,st.prototype.clone=function(){return new st(this.color,this.near,this.far)},st.prototype.toJSON=function(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}},lt.prototype=Object.assign(Object.create(T.prototype),{constructor:lt,copy:function(e,t){return T.prototype.copy.call(this,e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.fog&&(this.fog=e.fog.clone()),null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.autoUpdate=e.autoUpdate,this.matrixAutoUpdate=e.matrixAutoUpdate,this},toJSON:function(e){var t=T.prototype.toJSON.call(this,e);return null!==this.background&&(t.object.background=this.background.toJSON(e)),null!==this.fog&&(t.object.fog=this.fog.toJSON()),t}}),Object.defineProperty(ct.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Object.assign(ct.prototype,{isInterleavedBuffer:!0,onUploadCallback:function(){},setArray:function(e){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");return this.count=void 0!==e?e.length/this.stride:0,this.array=e,this},setDynamic:function(e){return this.dynamic=e,this},copy:function(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.dynamic=e.dynamic,this},copyAt:function(e,t,r){e*=this.stride,r*=t.stride;for(var i=0,n=this.stride;i<n;i++)this.array[e+i]=t.array[r+i];return this},set:function(e,t){return void 0===t&&(t=0),this.array.set(e,t),this},clone:function(){return(new this.constructor).copy(this)},onUpload:function(e){return this.onUploadCallback=e,this}}),Object.defineProperties(ut.prototype,{count:{get:function(){return this.data.count}},array:{get:function(){return this.data.array}}}),Object.assign(ut.prototype,{isInterleavedBufferAttribute:!0,setX:function(e,t){return this.data.array[e*this.data.stride+this.offset]=t,this},setY:function(e,t){return this.data.array[e*this.data.stride+this.offset+1]=t,this},setZ:function(e,t){return this.data.array[e*this.data.stride+this.offset+2]=t,this},setW:function(e,t){return this.data.array[e*this.data.stride+this.offset+3]=t,this},getX:function(e){return this.data.array[e*this.data.stride+this.offset]},getY:function(e){return this.data.array[e*this.data.stride+this.offset+1]},getZ:function(e){return this.data.array[e*this.data.stride+this.offset+2]},getW:function(e){return this.data.array[e*this.data.stride+this.offset+3]},setXY:function(e,t,r){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=r,this},setXYZ:function(e,t,r,i){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=r,this.data.array[e+2]=i,this},setXYZW:function(e,t,r,i,n){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=r,this.data.array[e+2]=i,this.data.array[e+3]=n,this}}),(ht.prototype=Object.create(z.prototype)).constructor=ht,ht.prototype.isSpriteMaterial=!0,ht.prototype.copy=function(e){return z.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this};var Ls;pt.prototype=Object.assign(Object.create(T.prototype),{constructor:pt,isSprite:!0,raycast:function(){function e(e,t,r,i,n,o){s.subVectors(e,r).addScalar(.5).multiply(i),void 0!==n?(l.x=o*s.x-n*s.y,l.y=n*s.x+o*s.y):l.copy(s),e.copy(t),e.x+=l.x,e.y+=l.y,e.applyMatrix4(c)}var t=new o,n=new o,a=new o,s=new r,l=new r,c=new i,u=new o,h=new o,p=new o,d=new r,f=new r,m=new r;return function(i,o){n.setFromMatrixScale(this.matrixWorld),c.getInverse(this.modelViewMatrix).premultiply(this.matrixWorld),a.setFromMatrixPosition(this.modelViewMatrix);var s,l,g=this.material.rotation;0!==g&&(l=Math.cos(g),s=Math.sin(g));var v=this.center;e(u.set(-.5,-.5,0),a,v,n,s,l),e(h.set(.5,-.5,0),a,v,n,s,l),e(p.set(.5,.5,0),a,v,n,s,l),d.set(0,0),f.set(1,0),m.set(1,1);var y=i.ray.intersectTriangle(u,h,p,!1,t);if(null!==y||(e(h.set(-.5,.5,0),a,v,n,s,l),f.set(0,1),null!==(y=i.ray.intersectTriangle(u,p,h,!1,t)))){var E=i.ray.origin.distanceTo(t);E<i.near||E>i.far||o.push({distance:E,point:t.clone(),uv:W.getUV(t,u,h,p,d,f,m,new r),face:null,object:this})}}}(),clone:function(){return new this.constructor(this.material).copy(this)},copy:function(e){return T.prototype.copy.call(this,e),void 0!==e.center&&this.center.copy(e.center),this}}),dt.prototype=Object.assign(Object.create(T.prototype),{constructor:dt,copy:function(e){T.prototype.copy.call(this,e,!1);for(var t=e.levels,r=0,i=t.length;r<i;r++){var n=t[r];this.addLevel(n.object.clone(),n.distance)}return this},addLevel:function(e,t){void 0===t&&(t=0),t=Math.abs(t);for(var r=this.levels,i=0;i<r.length&&!(t<r[i].distance);i++);r.splice(i,0,{distance:t,object:e}),this.add(e)},getObjectForDistance:function(e){for(var t=this.levels,r=1,i=t.length;r<i&&!(e<t[r].distance);r++);return t[r-1].object},raycast:function(){var e=new o;return function(t,r){e.setFromMatrixPosition(this.matrixWorld);var i=t.ray.origin.distanceTo(e);this.getObjectForDistance(i).raycast(t,r)}}(),update:function(){var e=new o,t=new o;return function(r){var i=this.levels;if(i.length>1){e.setFromMatrixPosition(r.matrixWorld),t.setFromMatrixPosition(this.matrixWorld);var n=e.distanceTo(t);i[0].object.visible=!0;for(var o=1,a=i.length;o<a&&n>=i[o].distance;o++)i[o-1].object.visible=!1,i[o].object.visible=!0;for(;o<a;o++)i[o].object.visible=!1}}}(),toJSON:function(e){var t=T.prototype.toJSON.call(this,e);t.object.levels=[];for(var r=this.levels,i=0,n=r.length;i<n;i++){var o=r[i];t.object.levels.push({object:o.object.uuid,distance:o.distance})}return t}}),ft.prototype=Object.assign(Object.create(Y.prototype),{constructor:ft,isSkinnedMesh:!0,bind:function(e,t){this.skeleton=e,void 0===t&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.getInverse(t)},pose:function(){this.skeleton.pose()},normalizeSkinWeights:function(){for(var e=new l,t=this.geometry.attributes.skinWeight,r=0,i=t.count;r<i;r++){e.x=t.getX(r),e.y=t.getY(r),e.z=t.getZ(r),e.w=t.getW(r);var n=1/e.manhattanLength();n!==1/0?e.multiplyScalar(n):e.set(1,0,0,0),t.setXYZW(r,e.x,e.y,e.z,e.w)}},updateMatrixWorld:function(e){Y.prototype.updateMatrixWorld.call(this,e),"attached"===this.bindMode?this.bindMatrixInverse.getInverse(this.matrixWorld):"detached"===this.bindMode?this.bindMatrixInverse.getInverse(this.bindMatrix):console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),Object.assign(mt.prototype,{calculateInverses:function(){this.boneInverses=[];for(var e=0,t=this.bones.length;e<t;e++){var r=new i;this.bones[e]&&r.getInverse(this.bones[e].matrixWorld),this.boneInverses.push(r)}},pose:function(){var e,t,r;for(t=0,r=this.bones.length;t<r;t++)(e=this.bones[t])&&e.matrixWorld.getInverse(this.boneInverses[t]);for(t=0,r=this.bones.length;t<r;t++)(e=this.bones[t])&&(e.parent&&e.parent.isBone?(e.matrix.getInverse(e.parent.matrixWorld),e.matrix.multiply(e.matrixWorld)):e.matrix.copy(e.matrixWorld),e.matrix.decompose(e.position,e.quaternion,e.scale))},update:function(e){var t=new i,r=new i;return function(e){var i=this.bones,n=this.boneInverses,o=this.boneMatrices,a=this.boneTexture,s=new THREE.Vector3;e.getWorldPosition(s);for(var l=0,c=i.length;l<c;l++){var u=i[l]?i[l].matrixWorld:r;t.multiplyMatrices(u,n[l]);var h=t.elements;h[12]-=s.x,h[13]-=s.y,h[14]-=s.z,t.toArray(o,16*l)}void 0!==a&&(a.needsUpdate=!0)}}(),clone:function(){return new mt(this.bones,this.boneInverses)},getBoneByName:function(e){for(var t=0,r=this.bones.length;t<r;t++){var i=this.bones[t];if(i.name===e)return i}}}),gt.prototype=Object.assign(Object.create(T.prototype),{constructor:gt,isBone:!0}),(vt.prototype=Object.create(z.prototype)).constructor=vt,vt.prototype.isLineBasicMaterial=!0,vt.prototype.copy=function(e){return z.prototype.copy.call(this,e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this},yt.prototype=Object.assign(Object.create(T.prototype),{constructor:yt,isLine:!0,computeLineDistances:function(){var e=new o,t=new o;return function(){var r=this.geometry;if(r.isBufferGeometry)if(null===r.index){for(var i=r.attributes.position,n=[0],o=1,a=i.count;o<a;o++)e.fromBufferAttribute(i,o-1),t.fromBufferAttribute(i,o),n[o]=n[o-1],n[o]+=e.distanceTo(t);r.addAttribute("lineDistance",new F(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(r.isGeometry){var s=r.vertices;(n=r.lineDistances)[0]=0;for(var o=1,a=s.length;o<a;o++)n[o]=n[o-1],n[o]+=s[o-1].distanceTo(s[o])}return this}}(),raycast:function(){var e=new i,t=new G,r=new d;return function(i,n){var a=i.linePrecision,s=this.geometry,l=this.matrixWorld;if(null===s.boundingSphere&&s.computeBoundingSphere(),r.copy(s.boundingSphere),r.applyMatrix4(l),r.radius+=a,!1!==i.ray.intersectsSphere(r)){e.getInverse(l),t.copy(i.ray).applyMatrix4(e);var c=a/((this.scale.x+this.scale.y+this.scale.z)/3),u=c*c,h=new o,p=new o,d=new o,f=new o,m=this&&this.isLineSegments?2:1;if(s.isBufferGeometry){var g=s.index,v=s.attributes.position.array;if(null!==g)for(var y=g.array,E=0,b=y.length-1;E<b;E+=m){var x=y[E],_=y[E+1];h.fromArray(v,3*x),p.fromArray(v,3*_);if(!((M=t.distanceSqToSegment(h,p,f,d))>u)){f.applyMatrix4(this.matrixWorld);(R=i.ray.origin.distanceTo(f))<i.near||R>i.far||n.push({distance:R,point:d.clone().applyMatrix4(this.matrixWorld),index:E,face:null,faceIndex:null,object:this})}}else for(var E=0,b=v.length/3-1;E<b;E+=m){h.fromArray(v,3*E),p.fromArray(v,3*E+3);if(!((M=t.distanceSqToSegment(h,p,f,d))>u)){f.applyMatrix4(this.matrixWorld);(R=i.ray.origin.distanceTo(f))<i.near||R>i.far||n.push({distance:R,point:d.clone().applyMatrix4(this.matrixWorld),index:E,face:null,faceIndex:null,object:this})}}}else if(s.isGeometry)for(var w=s.vertices,T=w.length,E=0;E<T-1;E+=m){var M=t.distanceSqToSegment(w[E],w[E+1],f,d);if(!(M>u)){f.applyMatrix4(this.matrixWorld);var R=i.ray.origin.distanceTo(f);R<i.near||R>i.far||n.push({distance:R,point:d.clone().applyMatrix4(this.matrixWorld),index:E,face:null,faceIndex:null,object:this})}}}}}(),copy:function(e){return T.prototype.copy.call(this,e),this.geometry.copy(e.geometry),this.material.copy(e.material),this},clone:function(){return(new this.constructor).copy(this)}}),Et.prototype=Object.assign(Object.create(yt.prototype),{constructor:Et,isLineSegments:!0,computeLineDistances:function(){var e=new o,t=new o;return function(){var r=this.geometry;if(r.isBufferGeometry)if(null===r.index){for(var i=r.attributes.position,n=[],o=0,a=i.count;o<a;o+=2)e.fromBufferAttribute(i,o),t.fromBufferAttribute(i,o+1),n[o]=0===o?0:n[o-1],n[o+1]=n[o]+e.distanceTo(t);r.addAttribute("lineDistance",new F(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(r.isGeometry)for(var s=r.vertices,n=r.lineDistances,o=0,a=s.length;o<a;o+=2)e.copy(s[o]),t.copy(s[o+1]),n[o]=0===o?0:n[o-1],n[o+1]=n[o]+e.distanceTo(t);return this}}()}),bt.prototype=Object.assign(Object.create(yt.prototype),{constructor:bt,isLineLoop:!0}),(xt.prototype=Object.create(z.prototype)).constructor=xt,xt.prototype.isPointsMaterial=!0,xt.prototype.copy=function(e){return z.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.morphTargets=e.morphTargets,this},_t.prototype=Object.assign(Object.create(T.prototype),{constructor:_t,isPoints:!0,raycast:function(){var e=new i,t=new G,r=new d;return function(i,n){function a(e,r){var o=t.distanceSqToPoint(e);if(o<p){t.closestPointToPoint(e,f),f.applyMatrix4(c);var a=i.ray.origin.distanceTo(f);if(a<i.near||a>i.far)return;n.push({distance:a,distanceToRay:Math.sqrt(o),point:f.clone(),index:r,face:null,object:s})}}var s=this,l=this.geometry,c=this.matrixWorld,u=i.params.Points.threshold;if(null===l.boundingSphere&&l.computeBoundingSphere(),r.copy(l.boundingSphere),r.applyMatrix4(c),r.radius+=u,!1!==i.ray.intersectsSphere(r)){e.getInverse(c),t.copy(i.ray).applyMatrix4(e);var h=u/((this.scale.x+this.scale.y+this.scale.z)/3),p=h*h,d=new o,f=new o;if(l.isBufferGeometry){var m=l.index,g=l.attributes.position.array;if(null!==m)for(var v=m.array,y=0,E=v.length;y<E;y++){var b=v[y];d.fromArray(g,3*b),a(d,b)}else for(var y=0,x=g.length/3;y<x;y++)d.fromArray(g,3*y),a(d,y)}else for(var _=l.vertices,y=0,x=_.length;y<x;y++)a(_[y],y)}}}(),clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),wt.prototype=Object.assign(Object.create(s.prototype),{constructor:wt,isVideoTexture:!0,update:function(){var e=this.image;e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}),(Tt.prototype=Object.create(s.prototype)).constructor=Tt,Tt.prototype.isCompressedTexture=!0,(Mt.prototype=Object.create(s.prototype)).constructor=Mt,Mt.prototype.isCanvasTexture=!0,(Rt.prototype=Object.create(s.prototype)).constructor=Rt,Rt.prototype.isDepthTexture=!0,(St.prototype=Object.create(N.prototype)).constructor=St,(Pt.prototype=Object.create(M.prototype)).constructor=Pt,(At.prototype=Object.create(N.prototype)).constructor=At,(Ct.prototype=Object.create(M.prototype)).constructor=Ct,(Lt.prototype=Object.create(N.prototype)).constructor=Lt,(Ot.prototype=Object.create(M.prototype)).constructor=Ot,(Ht.prototype=Object.create(Lt.prototype)).constructor=Ht,(Ft.prototype=Object.create(M.prototype)).constructor=Ft,(It.prototype=Object.create(Lt.prototype)).constructor=It,(kt.prototype=Object.create(M.prototype)).constructor=kt,(Dt.prototype=Object.create(Lt.prototype)).constructor=Dt,(Nt.prototype=Object.create(M.prototype)).constructor=Nt,(jt.prototype=Object.create(Lt.prototype)).constructor=jt,(Ut.prototype=Object.create(M.prototype)).constructor=Ut,(Bt.prototype=Object.create(N.prototype)).constructor=Bt,(Vt.prototype=Object.create(M.prototype)).constructor=Vt,(zt.prototype=Object.create(N.prototype)).constructor=zt,(qt.prototype=Object.create(M.prototype)).constructor=qt,(Gt.prototype=Object.create(N.prototype)).constructor=Gt;var Os={triangulate:function(e,t,r){r=r||2;var i=t&&t.length,n=i?t[0]*r:e.length,o=Wt(e,0,n,r,!0),a=[];if(!o)return a;var s,l,c,u,h,p,d;if(i&&(o=Qt(e,t,o,r)),e.length>80*r){s=c=e[0],l=u=e[1];for(var f=r;f<n;f+=r)h=e[f],p=e[f+1],h<s&&(s=h),p<l&&(l=p),h>c&&(c=h),p>u&&(u=p);d=0!==(d=Math.max(c-s,u-l))?1/d:0}return Yt(o,a,r,s,l,d),a}},Hs={area:function(e){for(var t=e.length,r=0,i=t-1,n=0;n<t;i=n++)r+=e[i].x*e[n].y-e[n].x*e[i].y;return.5*r},isClockWise:function(e){return Hs.area(e)<0},triangulateShape:function(e,t){var r=[],i=[],n=[];sr(e),lr(r,e);var o=e.length;t.forEach(sr);for(s=0;s<t.length;s++)i.push(o),o+=t[s].length,lr(r,t[s]);for(var a=Os.triangulate(r,i),s=0;s<a.length;s+=3)n.push(a.slice(s,s+3));return n}};(cr.prototype=Object.create(M.prototype)).constructor=cr,cr.prototype.toJSON=function(){var e=M.prototype.toJSON.call(this);return hr(this.parameters.shapes,this.parameters.options,e)},(ur.prototype=Object.create(N.prototype)).constructor=ur,ur.prototype.toJSON=function(){var e=N.prototype.toJSON.call(this);return hr(this.parameters.shapes,this.parameters.options,e)};var Fs={generateTopUV:function(e,t,i,n,o){var a=t[3*i],s=t[3*i+1],l=t[3*n],c=t[3*n+1],u=t[3*o],h=t[3*o+1];return[new r(a,s),new r(l,c),new r(u,h)]},generateSideWallUV:function(e,t,i,n,o,a){var s=t[3*i],l=t[3*i+1],c=t[3*i+2],u=t[3*n],h=t[3*n+1],p=t[3*n+2],d=t[3*o],f=t[3*o+1],m=t[3*o+2],g=t[3*a],v=t[3*a+1],y=t[3*a+2];return Math.abs(l-h)<.01?[new r(s,1-c),new r(u,1-p),new r(d,1-m),new r(g,1-y)]:[new r(l,1-c),new r(h,1-p),new r(f,1-m),new r(v,1-y)]}};(pr.prototype=Object.create(M.prototype)).constructor=pr,(dr.prototype=Object.create(ur.prototype)).constructor=dr,(fr.prototype=Object.create(M.prototype)).constructor=fr,(mr.prototype=Object.create(N.prototype)).constructor=mr,(gr.prototype=Object.create(M.prototype)).constructor=gr,(vr.prototype=Object.create(N.prototype)).constructor=vr,(yr.prototype=Object.create(M.prototype)).constructor=yr,(Er.prototype=Object.create(N.prototype)).constructor=Er,(br.prototype=Object.create(M.prototype)).constructor=br,br.prototype.toJSON=function(){var e=M.prototype.toJSON.call(this);return _r(this.parameters.shapes,e)},(xr.prototype=Object.create(N.prototype)).constructor=xr,xr.prototype.toJSON=function(){var e=N.prototype.toJSON.call(this);return _r(this.parameters.shapes,e)},(wr.prototype=Object.create(N.prototype)).constructor=wr,(Tr.prototype=Object.create(M.prototype)).constructor=Tr,(Mr.prototype=Object.create(N.prototype)).constructor=Mr,(Rr.prototype=Object.create(Tr.prototype)).constructor=Rr,(Sr.prototype=Object.create(Mr.prototype)).constructor=Sr,(Pr.prototype=Object.create(M.prototype)).constructor=Pr,(Ar.prototype=Object.create(N.prototype)).constructor=Ar;var Is=Object.freeze({WireframeGeometry:St,ParametricGeometry:Pt,ParametricBufferGeometry:At,TetrahedronGeometry:Ot,TetrahedronBufferGeometry:Ht,OctahedronGeometry:Ft,OctahedronBufferGeometry:It,IcosahedronGeometry:kt,IcosahedronBufferGeometry:Dt,DodecahedronGeometry:Nt,DodecahedronBufferGeometry:jt,PolyhedronGeometry:Ct,PolyhedronBufferGeometry:Lt,TubeGeometry:Ut,TubeBufferGeometry:Bt,TorusKnotGeometry:Vt,TorusKnotBufferGeometry:zt,TorusGeometry:qt,TorusBufferGeometry:Gt,TextGeometry:pr,TextBufferGeometry:dr,SphereGeometry:fr,SphereBufferGeometry:mr,RingGeometry:gr,RingBufferGeometry:vr,PlaneGeometry:B,PlaneBufferGeometry:V,LatheGeometry:yr,LatheBufferGeometry:Er,ShapeGeometry:br,ShapeBufferGeometry:xr,ExtrudeGeometry:cr,ExtrudeBufferGeometry:ur,EdgesGeometry:wr,ConeGeometry:Rr,ConeBufferGeometry:Sr,CylinderGeometry:Tr,CylinderBufferGeometry:Mr,CircleGeometry:Pr,CircleBufferGeometry:Ar,BoxGeometry:j,BoxBufferGeometry:U});(Cr.prototype=Object.create(z.prototype)).constructor=Cr,Cr.prototype.isShadowMaterial=!0,Cr.prototype.copy=function(e){return z.prototype.copy.call(this,e),this.color.copy(e.color),this},(Lr.prototype=Object.create(q.prototype)).constructor=Lr,Lr.prototype.isRawShaderMaterial=!0,(Or.prototype=Object.create(z.prototype)).constructor=Or,Or.prototype.isMeshStandardMaterial=!0,Or.prototype.copy=function(e){return z.prototype.copy.call(this,e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},(Hr.prototype=Object.create(Or.prototype)).constructor=Hr,Hr.prototype.isMeshPhysicalMaterial=!0,Hr.prototype.copy=function(e){return Or.prototype.copy.call(this,e),this.defines={PHYSICAL:""},this.reflectivity=e.reflectivity,this.clearCoat=e.clearCoat,this.clearCoatRoughness=e.clearCoatRoughness,this},(Fr.prototype=Object.create(z.prototype)).constructor=Fr,Fr.prototype.isMeshPhongMaterial=!0,Fr.prototype.copy=function(e){return z.prototype.copy.call(this,e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},(Ir.prototype=Object.create(Fr.prototype)).constructor=Ir,Ir.prototype.isMeshToonMaterial=!0,Ir.prototype.copy=function(e){return Fr.prototype.copy.call(this,e),this.gradientMap=e.gradientMap,this},(kr.prototype=Object.create(z.prototype)).constructor=kr,kr.prototype.isMeshNormalMaterial=!0,kr.prototype.copy=function(e){return z.prototype.copy.call(this,e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},(Dr.prototype=Object.create(z.prototype)).constructor=Dr,Dr.prototype.isMeshLambertMaterial=!0,Dr.prototype.copy=function(e){return z.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},(Nr.prototype=Object.create(z.prototype)).constructor=Nr,Nr.prototype.isMeshMatcapMaterial=!0,Nr.prototype.copy=function(e){return z.prototype.copy.call(this,e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},(jr.prototype=Object.create(vt.prototype)).constructor=jr,jr.prototype.isLineDashedMaterial=!0,jr.prototype.copy=function(e){return vt.prototype.copy.call(this,e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this};var ks=Object.freeze({ShadowMaterial:Cr,SpriteMaterial:ht,RawShaderMaterial:Lr,ShaderMaterial:q,PointsMaterial:xt,MeshPhysicalMaterial:Hr,MeshStandardMaterial:Or,MeshPhongMaterial:Fr,MeshToonMaterial:Ir,MeshNormalMaterial:kr,MeshLambertMaterial:Dr,MeshDepthMaterial:Ye,MeshDistanceMaterial:Qe,MeshBasicMaterial:X,MeshMatcapMaterial:Nr,LineDashedMaterial:jr,LineBasicMaterial:vt,Material:z}),Ds={arraySlice:function(e,t,r){return Ds.isTypedArray(e)?new e.constructor(e.subarray(t,void 0!==r?r:e.length)):e.slice(t,r)},convertArray:function(e,t,r){return!e||!r&&e.constructor===t?e:"number"==typeof t.BYTES_PER_ELEMENT?new t(e):Array.prototype.slice.call(e)},isTypedArray:function(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)},getKeyframeOrder:function(e){for(var t=e.length,r=new Array(t),i=0;i!==t;++i)r[i]=i;return r.sort(function(t,r){return e[t]-e[r]}),r},sortedArray:function(e,t,r){for(var i=e.length,n=new e.constructor(i),o=0,a=0;a!==i;++o)for(var s=r[o]*t,l=0;l!==t;++l)n[a++]=e[s+l];return n},flattenJSON:function(e,t,r,i){for(var n=1,o=e[0];void 0!==o&&void 0===o[i];)o=e[n++];if(void 0!==o){var a=o[i];if(void 0!==a)if(Array.isArray(a))do{void 0!==(a=o[i])&&(t.push(o.time),r.push.apply(r,a)),o=e[n++]}while(void 0!==o);else if(void 0!==a.toArray)do{void 0!==(a=o[i])&&(t.push(o.time),a.toArray(r,r.length)),o=e[n++]}while(void 0!==o);else do{void 0!==(a=o[i])&&(t.push(o.time),r.push(a)),o=e[n++]}while(void 0!==o)}}};Object.assign(Ur.prototype,{evaluate:function(e){var t=this.parameterPositions,r=this._cachedIndex,i=t[r],n=t[r-1];e:{t:{var o;r:{i:if(!(e<i)){for(s=r+2;;){if(void 0===i){if(e<n)break i;return r=t.length,this._cachedIndex=r,this.afterEnd_(r-1,e,n)}if(r===s)break;if(n=i,i=t[++r],e<i)break t}o=t.length;break r}{if(e>=n)break e;var a=t[1];e<a&&(r=2,n=a);for(var s=r-2;;){if(void 0===n)return this._cachedIndex=0,this.beforeStart_(0,e,i);if(r===s)break;if(i=n,n=t[--r-1],e>=n)break t}o=r,r=0}}for(;r<o;){var l=r+o>>>1;e<t[l]?o=l:r=l+1}if(i=t[r],void 0===(n=t[r-1]))return this._cachedIndex=0,this.beforeStart_(0,e,i);if(void 0===i)return r=t.length,this._cachedIndex=r,this.afterEnd_(r-1,n,e)}this._cachedIndex=r,this.intervalChanged_(r,n,i)}return this.interpolate_(r,n,e,i)},settings:null,DefaultSettings_:{},getSettings_:function(){return this.settings||this.DefaultSettings_},copySampleValue_:function(e){for(var t=this.resultBuffer,r=this.sampleValues,i=this.valueSize,n=e*i,o=0;o!==i;++o)t[o]=r[n+o];return t},interpolate_:function(){throw new Error("call to abstract method")},intervalChanged_:function(){}}),Object.assign(Ur.prototype,{beforeStart_:Ur.prototype.copySampleValue_,afterEnd_:Ur.prototype.copySampleValue_}),Br.prototype=Object.assign(Object.create(Ur.prototype),{constructor:Br,DefaultSettings_:{endingStart:qa,endingEnd:qa},intervalChanged_:function(e,t,r){var i=this.parameterPositions,n=e-2,o=e+1,a=i[n],s=i[o];if(void 0===a)switch(this.getSettings_().endingStart){case 2401:n=e,a=2*t-r;break;case 2402:a=t+i[n=i.length-2]-i[n+1];break;default:n=e,a=r}if(void 0===s)switch(this.getSettings_().endingEnd){case 2401:o=e,s=2*r-t;break;case 2402:o=1,s=r+i[1]-i[0];break;default:o=e-1,s=t}var l=.5*(r-t),c=this.valueSize;this._weightPrev=l/(t-a),this._weightNext=l/(s-r),this._offsetPrev=n*c,this._offsetNext=o*c},interpolate_:function(e,t,r,i){for(var n=this.resultBuffer,o=this.sampleValues,a=this.valueSize,s=e*a,l=s-a,c=this._offsetPrev,u=this._offsetNext,h=this._weightPrev,p=this._weightNext,d=(r-t)/(i-t),f=d*d,m=f*d,g=-h*m+2*h*f-h*d,v=(1+h)*m+(-1.5-2*h)*f+(-.5+h)*d+1,y=(-1-p)*m+(1.5+p)*f+.5*d,E=p*m-p*f,b=0;b!==a;++b)n[b]=g*o[c+b]+v*o[l+b]+y*o[s+b]+E*o[u+b];return n}}),Vr.prototype=Object.assign(Object.create(Ur.prototype),{constructor:Vr,interpolate_:function(e,t,r,i){for(var n=this.resultBuffer,o=this.sampleValues,a=this.valueSize,s=e*a,l=s-a,c=(r-t)/(i-t),u=1-c,h=0;h!==a;++h)n[h]=o[l+h]*u+o[s+h]*c;return n}}),zr.prototype=Object.assign(Object.create(Ur.prototype),{constructor:zr,interpolate_:function(e){return this.copySampleValue_(e-1)}}),Object.assign(qr,{toJSON:function(e){var t,r=e.constructor;if(void 0!==r.toJSON)t=r.toJSON(e);else{t={name:e.name,times:Ds.convertArray(e.times,Array),values:Ds.convertArray(e.values,Array)};var i=e.getInterpolation();i!==e.DefaultInterpolation&&(t.interpolation=i)}return t.type=e.ValueTypeName,t}}),Object.assign(qr.prototype,{constructor:qr,TimeBufferType:Float32Array,ValueBufferType:Float32Array,DefaultInterpolation:2301,InterpolantFactoryMethodDiscrete:function(e){return new zr(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodLinear:function(e){return new Vr(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodSmooth:function(e){return new Br(this.times,this.values,this.getValueSize(),e)},setInterpolation:function(e){var t;switch(e){case 2300:t=this.InterpolantFactoryMethodDiscrete;break;case 2301:t=this.InterpolantFactoryMethodLinear;break;case 2302:t=this.InterpolantFactoryMethodSmooth}if(void 0===t){var r="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(e===this.DefaultInterpolation)throw new Error(r);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",r),this}return this.createInterpolant=t,this},getInterpolation:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return 2300;case this.InterpolantFactoryMethodLinear:return 2301;case this.InterpolantFactoryMethodSmooth:return 2302}},getValueSize:function(){return this.values.length/this.times.length},shift:function(e){if(0!==e)for(var t=this.times,r=0,i=t.length;r!==i;++r)t[r]+=e;return this},scale:function(e){if(1!==e)for(var t=this.times,r=0,i=t.length;r!==i;++r)t[r]*=e;return this},trim:function(e,t){for(var r=this.times,i=r.length,n=0,o=i-1;n!==i&&r[n]<e;)++n;for(;-1!==o&&r[o]>t;)--o;if(++o,0!==n||o!==i){n>=o&&(o=Math.max(o,1),n=o-1);var a=this.getValueSize();this.times=Ds.arraySlice(r,n,o),this.values=Ds.arraySlice(this.values,n*a,o*a)}return this},validate:function(){var e=!0,t=this.getValueSize();t-Math.floor(t)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);var r=this.times,i=this.values,n=r.length;0===n&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);for(var o=null,a=0;a!==n;a++){var s=r[a];if("number"==typeof s&&isNaN(s)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,a,s),e=!1;break}if(null!==o&&o>s){console.error("THREE.KeyframeTrack: Out of order keys.",this,a,s,o),e=!1;break}o=s}if(void 0!==i&&Ds.isTypedArray(i))for(var a=0,l=i.length;a!==l;++a){var c=i[a];if(isNaN(c)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,a,c),e=!1;break}}return e},optimize:function(){for(var e=this.times,t=this.values,r=this.getValueSize(),i=2302===this.getInterpolation(),n=1,o=e.length-1,a=1;a<o;++a){var s=!1,l=e[a];if(l!==e[a+1]&&(1!==a||l!==l[0]))if(i)s=!0;else for(var c=a*r,u=c-r,h=c+r,p=0;p!==r;++p){var d=t[c+p];if(d!==t[u+p]||d!==t[h+p]){s=!0;break}}if(s){if(a!==n){e[n]=e[a];for(var f=a*r,m=n*r,p=0;p!==r;++p)t[m+p]=t[f+p]}++n}}if(o>0){e[n]=e[o];for(var f=o*r,m=n*r,p=0;p!==r;++p)t[m+p]=t[f+p];++n}return n!==e.length&&(this.times=Ds.arraySlice(e,0,n),this.values=Ds.arraySlice(t,0,n*r)),this}}),Gr.prototype=Object.assign(Object.create(qr.prototype),{constructor:Gr,ValueTypeName:"bool",ValueBufferType:Array,DefaultInterpolation:2300,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),Wr.prototype=Object.assign(Object.create(qr.prototype),{constructor:Wr,ValueTypeName:"color"}),Xr.prototype=Object.assign(Object.create(qr.prototype),{constructor:Xr,ValueTypeName:"number"}),Yr.prototype=Object.assign(Object.create(Ur.prototype),{constructor:Yr,interpolate_:function(e,t,r,i){for(var o=this.resultBuffer,a=this.sampleValues,s=this.valueSize,l=e*s,c=(r-t)/(i-t),u=l+s;l!==u;l+=4)n.slerpFlat(o,0,a,l-s,a,l,c);return o}}),Qr.prototype=Object.assign(Object.create(qr.prototype),{constructor:Qr,ValueTypeName:"quaternion",DefaultInterpolation:2301,InterpolantFactoryMethodLinear:function(e){return new Yr(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodSmooth:void 0}),Jr.prototype=Object.assign(Object.create(qr.prototype),{constructor:Jr,ValueTypeName:"string",ValueBufferType:Array,DefaultInterpolation:2300,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),Kr.prototype=Object.assign(Object.create(qr.prototype),{constructor:Kr,ValueTypeName:"vector"}),Object.assign(Zr,{parse:function(e){for(var t=[],r=e.tracks,i=1/(e.fps||1),n=0,o=r.length;n!==o;++n)t.push($r(r[n]).scale(i));return new Zr(e.name,e.duration,t)},toJSON:function(e){for(var t=[],r=e.tracks,i={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid},n=0,o=r.length;n!==o;++n)t.push(qr.toJSON(r[n]));return i},CreateFromMorphTargetSequence:function(e,t,r,i){for(var n=t.length,o=[],a=0;a<n;a++){var s=[],l=[];s.push((a+n-1)%n,a,(a+1)%n),l.push(0,1,0);var c=Ds.getKeyframeOrder(s);s=Ds.sortedArray(s,1,c),l=Ds.sortedArray(l,1,c),i||0!==s[0]||(s.push(n),l.push(l[0])),o.push(new Xr(".morphTargetInfluences["+t[a].name+"]",s,l).scale(1/r))}return new Zr(e,-1,o)},findByName:function(e,t){var r=e;if(!Array.isArray(e)){var i=e;r=i.geometry&&i.geometry.animations||i.animations}for(var n=0;n<r.length;n++)if(r[n].name===t)return r[n];return null},CreateClipsFromMorphTargetSequences:function(e,t,r){for(var i={},n=/^([\w-]*?)([\d]+)$/,o=0,a=e.length;o<a;o++){var s=e[o],l=s.name.match(n);if(l&&l.length>1){var c=i[h=l[1]];c||(i[h]=c=[]),c.push(s)}}var u=[];for(var h in i)u.push(Zr.CreateFromMorphTargetSequence(h,i[h],t,r));return u},parseAnimation:function(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;for(var r=function(e,t,r,i,n){if(0!==r.length){var o=[],a=[];Ds.flattenJSON(r,o,a,i),0!==o.length&&n.push(new e(t,o,a))}},i=[],n=e.name||"default",o=e.length||-1,a=e.fps||30,s=e.hierarchy||[],l=0;l<s.length;l++){var c=s[l].keys;if(c&&0!==c.length)if(c[0].morphTargets){for(var u={},h=0;h<c.length;h++)if(c[h].morphTargets)for(m=0;m<c[h].morphTargets.length;m++)u[c[h].morphTargets[m]]=-1;for(var p in u){for(var d=[],f=[],m=0;m!==c[h].morphTargets.length;++m){var g=c[h];d.push(g.time),f.push(g.morphTarget===p?1:0)}i.push(new Xr(".morphTargetInfluence["+p+"]",d,f))}o=u.length*(a||1)}else{var v=".bones["+t[l].name+"]";r(Kr,v+".position",c,"pos",i),r(Qr,v+".quaternion",c,"rot",i),r(Kr,v+".scale",c,"scl",i)}}if(0===i.length)return null;return new Zr(n,o,i)}}),Object.assign(Zr.prototype,{resetDuration:function(){for(var e=0,t=0,r=this.tracks.length;t!==r;++t){var i=this.tracks[t];e=Math.max(e,i.times[i.times.length-1])}return this.duration=e,this},trim:function(){for(var e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this},validate:function(){for(var e=!0,t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e},optimize:function(){for(var e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}});var Ns={enabled:!1,files:{},add:function(e,t){!1!==this.enabled&&(this.files[e]=t)},get:function(e){if(!1!==this.enabled)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}},js=new ei,Us={};Object.assign(ti.prototype,{load:function(e,t,r,i){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);var n=this,o=Ns.get(e);if(void 0!==o)return n.manager.itemStart(e),setTimeout(function(){t&&t(o),n.manager.itemEnd(e)},0),o;if(void 0===Us[e]){var a=e.match(/^data:(.*?)(;base64)?,(.*)$/);if(a){var s=a[1],l=!!a[2],c=a[3];c=decodeURIComponent(c),l&&(c=atob(c));try{var u,h=(this.responseType||"").toLowerCase();switch(h){case"arraybuffer":case"blob":for(var p=new Uint8Array(c.length),d=0;d<c.length;d++)p[d]=c.charCodeAt(d);u="blob"===h?new Blob([p.buffer],{type:s}):p.buffer;break;case"document":var f=new DOMParser;u=f.parseFromString(c,s);break;case"json":u=JSON.parse(c);break;default:u=c}setTimeout(function(){t&&t(u),n.manager.itemEnd(e)},0)}catch(t){setTimeout(function(){i&&i(t),n.manager.itemError(e),n.manager.itemEnd(e)},0)}}else{Us[e]=[],Us[e].push({onLoad:t,onProgress:r,onError:i});var m=new XMLHttpRequest;m.open("GET",e,!0),m.addEventListener("load",function(t){var r=this.response;Ns.add(e,r);var i=Us[e];if(delete Us[e],200===this.status||0===this.status){0===this.status&&console.warn("THREE.FileLoader: HTTP Status 0 received.");for(var o=0,a=i.length;o<a;o++){(s=i[o]).onLoad&&s.onLoad(r)}n.manager.itemEnd(e)}else{for(var o=0,a=i.length;o<a;o++){var s=i[o];s.onError&&s.onError(t)}n.manager.itemError(e),n.manager.itemEnd(e)}},!1),m.addEventListener("progress",function(t){for(var r=Us[e],i=0,n=r.length;i<n;i++){var o=r[i];o.onProgress&&o.onProgress(t)}},!1),m.addEventListener("error",function(t){var r=Us[e];delete Us[e];for(var i=0,o=r.length;i<o;i++){var a=r[i];a.onError&&a.onError(t)}n.manager.itemError(e),n.manager.itemEnd(e)},!1),m.addEventListener("abort",function(t){var r=Us[e];delete Us[e];for(var i=0,o=r.length;i<o;i++){var a=r[i];a.onError&&a.onError(t)}n.manager.itemError(e),n.manager.itemEnd(e)},!1),void 0!==this.responseType&&(m.responseType=this.responseType),void 0!==this.withCredentials&&(m.withCredentials=this.withCredentials),m.overrideMimeType&&m.overrideMimeType(void 0!==this.mimeType?this.mimeType:"text/plain");for(var g in this.requestHeader)m.setRequestHeader(g,this.requestHeader[g]);m.send(null)}return n.manager.itemStart(e),m}Us[e].push({onLoad:t,onProgress:r,onError:i})},setPath:function(e){return this.path=e,this},setResponseType:function(e){return this.responseType=e,this},setWithCredentials:function(e){return this.withCredentials=e,this},setMimeType:function(e){return this.mimeType=e,this},setRequestHeader:function(e){return this.requestHeader=e,this}}),Object.assign(ri.prototype,{load:function(e,t,r,i){var n=this,o=new ti(n.manager);o.setPath(n.path),o.load(e,function(e){t(n.parse(JSON.parse(e)))},r,i)},parse:function(e,t){for(var r=[],i=0;i<e.length;i++){var n=Zr.parse(e[i]);r.push(n)}t(r)},setPath:function(e){return this.path=e,this}}),Object.assign(ii.prototype,{load:function(e,t,r,i){function n(n){l.load(e[n],function(e){var r=o._parser(e,!0);a[n]={width:r.width,height:r.height,format:r.format,mipmaps:r.mipmaps},6===(c+=1)&&(1===r.mipmapCount&&(s.minFilter=Jo),s.format=r.format,s.needsUpdate=!0,t&&t(s))},r,i)}var o=this,a=[],s=new Tt;s.image=a;var l=new ti(this.manager);if(l.setPath(this.path),l.setResponseType("arraybuffer"),Array.isArray(e))for(var c=0,u=0,h=e.length;u<h;++u)n(u);else l.load(e,function(e){var r=o._parser(e,!0);if(r.isCubemap)for(var i=r.mipmaps.length/r.mipmapCount,n=0;n<i;n++){a[n]={mipmaps:[]};for(var l=0;l<r.mipmapCount;l++)a[n].mipmaps.push(r.mipmaps[n*r.mipmapCount+l]),a[n].format=r.format,a[n].width=r.width,a[n].height=r.height}else s.image.width=r.width,s.image.height=r.height,s.mipmaps=r.mipmaps;1===r.mipmapCount&&(s.minFilter=Jo),s.format=r.format,s.needsUpdate=!0,t&&t(s)},r,i);return s},setPath:function(e){return this.path=e,this}}),Object.assign(ni.prototype,{load:function(e,t,r,i){var n=this,o=new h,a=new ti(this.manager);return a.setResponseType("arraybuffer"),a.setPath(this.path),a.load(e,function(e){var r=n._parser(e);r&&(void 0!==r.image?o.image=r.image:void 0!==r.data&&(o.image.width=r.width,o.image.height=r.height,o.image.data=r.data),o.wrapS=void 0!==r.wrapS?r.wrapS:Go,o.wrapT=void 0!==r.wrapT?r.wrapT:Go,o.magFilter=void 0!==r.magFilter?r.magFilter:Jo,o.minFilter=void 0!==r.minFilter?r.minFilter:Zo,o.anisotropy=void 0!==r.anisotropy?r.anisotropy:1,void 0!==r.format&&(o.format=r.format),void 0!==r.type&&(o.type=r.type),void 0!==r.mipmaps&&(o.mipmaps=r.mipmaps),1===r.mipmapCount&&(o.minFilter=Jo),o.needsUpdate=!0,t&&t(o,r))},r,i),o},setPath:function(e){return this.path=e,this}}),Object.assign(oi.prototype,{crossOrigin:"anonymous",load:function(e,t,r,i){function n(){l.removeEventListener("load",n,!1),l.removeEventListener("error",o,!1),Ns.add(e,this),t&&t(this),a.manager.itemEnd(e)}function o(t){l.removeEventListener("load",n,!1),l.removeEventListener("error",o,!1),i&&i(t),a.manager.itemError(e),a.manager.itemEnd(e)}void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);var a=this,s=Ns.get(e);if(void 0!==s)return a.manager.itemStart(e),setTimeout(function(){t&&t(s),a.manager.itemEnd(e)},0),s;var l=document.createElementNS("http://www.w3.org/1999/xhtml","img");return l.addEventListener("load",n,!1),l.addEventListener("error",o,!1),"data:"!==e.substr(0,5)&&void 0!==this.crossOrigin&&(l.crossOrigin=this.crossOrigin),a.manager.itemStart(e),l.src=e,l},setCrossOrigin:function(e){return this.crossOrigin=e,this},setPath:function(e){return this.path=e,this}}),Object.assign(ai.prototype,{crossOrigin:"anonymous",load:function(e,t,r,i){function n(r){a.load(e[r],function(e){o.images[r]=e,6===++s&&(o.needsUpdate=!0,t&&t(o))},void 0,i)}var o=new J,a=new oi(this.manager);a.setCrossOrigin(this.crossOrigin),a.setPath(this.path);for(var s=0,l=0;l<e.length;++l)n(l);return o},setCrossOrigin:function(e){return this.crossOrigin=e,this},setPath:function(e){return this.path=e,this}}),Object.assign(si.prototype,{crossOrigin:"anonymous",load:function(e,t,r,i){var n=new s,o=new oi(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setPath(this.path),o.load(e,function(r){n.image=r;var i=e.search(/\.jpe?g($|\?)/i)>0||0===e.search(/^data\:image\/jpeg/);n.format=i?pa:da,n.needsUpdate=!0,void 0!==t&&t(n)},r,i),n},setCrossOrigin:function(e){return this.crossOrigin=e,this},setPath:function(e){return this.path=e,this}}),Object.assign(li.prototype,{getPoint:function(){return console.warn("THREE.Curve: .getPoint() not implemented."),null},getPointAt:function(e,t){var r=this.getUtoTmapping(e);return this.getPoint(r,t)},getPoints:function(e){void 0===e&&(e=5);for(var t=[],r=0;r<=e;r++)t.push(this.getPoint(r/e));return t},getSpacedPoints:function(e){void 0===e&&(e=5);for(var t=[],r=0;r<=e;r++)t.push(this.getPointAt(r/e));return t},getLength:function(){var e=this.getLengths();return e[e.length-1]},getLengths:function(e){if(void 0===e&&(e=this.arcLengthDivisions),this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var t,r,i=[],n=this.getPoint(0),o=0;for(i.push(0),r=1;r<=e;r++)o+=(t=this.getPoint(r/e)).distanceTo(n),i.push(o),n=t;return this.cacheArcLengths=i,i},updateArcLengths:function(){this.needsUpdate=!0,this.getLengths()},getUtoTmapping:function(e,t){var r,i=this.getLengths(),n=0,o=i.length;r=t||e*i[o-1];for(var a,s=0,l=o-1;s<=l;)if(n=Math.floor(s+(l-s)/2),(a=i[n]-r)<0)s=n+1;else{if(!(a>0)){l=n;break}l=n-1}if(n=l,i[n]===r)return n/(o-1);var c=i[n];return(n+(r-c)/(i[n+1]-c))/(o-1)},getTangent:function(e){var t=e-1e-4,r=e+1e-4;t<0&&(t=0),r>1&&(r=1);var i=this.getPoint(t);return this.getPoint(r).clone().sub(i).normalize()},getTangentAt:function(e){var t=this.getUtoTmapping(e);return this.getTangent(t)},computeFrenetFrames:function(e,t){var r,n,a,s=new o,l=[],c=[],u=[],h=new o,p=new i;for(r=0;r<=e;r++)n=r/e,l[r]=this.getTangentAt(n),l[r].normalize();c[0]=new o,u[0]=new o;var d=Number.MAX_VALUE,f=Math.abs(l[0].x),m=Math.abs(l[0].y),g=Math.abs(l[0].z);for(f<=d&&(d=f,s.set(1,0,0)),m<=d&&(d=m,s.set(0,1,0)),g<=d&&s.set(0,0,1),h.crossVectors(l[0],s).normalize(),c[0].crossVectors(l[0],h),u[0].crossVectors(l[0],c[0]),r=1;r<=e;r++)c[r]=c[r-1].clone(),u[r]=u[r-1].clone(),h.crossVectors(l[r-1],l[r]),h.length()>Number.EPSILON&&(h.normalize(),a=Math.acos(os.clamp(l[r-1].dot(l[r]),-1,1)),c[r].applyMatrix4(p.makeRotationAxis(h,a))),u[r].crossVectors(l[r],c[r]);if(!0===t)for(a=Math.acos(os.clamp(c[0].dot(c[e]),-1,1)),a/=e,l[0].dot(h.crossVectors(c[0],c[e]))>0&&(a=-a),r=1;r<=e;r++)c[r].applyMatrix4(p.makeRotationAxis(l[r],a*r)),u[r].crossVectors(l[r],c[r]);return{tangents:l,normals:c,binormals:u}},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.arcLengthDivisions=e.arcLengthDivisions,this},toJSON:function(){var e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e},fromJSON:function(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}),(ci.prototype=Object.create(li.prototype)).constructor=ci,ci.prototype.isEllipseCurve=!0,ci.prototype.getPoint=function(e,t){for(var i=t||new r,n=2*Math.PI,o=this.aEndAngle-this.aStartAngle,a=Math.abs(o)<Number.EPSILON;o<0;)o+=n;for(;o>n;)o-=n;o<Number.EPSILON&&(o=a?0:n),!0!==this.aClockwise||a||(o===n?o=-n:o-=n);var s=this.aStartAngle+e*o,l=this.aX+this.xRadius*Math.cos(s),c=this.aY+this.yRadius*Math.sin(s);if(0!==this.aRotation){var u=Math.cos(this.aRotation),h=Math.sin(this.aRotation),p=l-this.aX,d=c-this.aY;l=p*u-d*h+this.aX,c=p*h+d*u+this.aY}return i.set(l,c)},ci.prototype.copy=function(e){return li.prototype.copy.call(this,e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this},ci.prototype.toJSON=function(){var e=li.prototype.toJSON.call(this);return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e},ci.prototype.fromJSON=function(e){return li.prototype.fromJSON.call(this,e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this},(ui.prototype=Object.create(ci.prototype)).constructor=ui,ui.prototype.isArcCurve=!0;var Bs=new o,Vs=new hi,zs=new hi,qs=new hi;(pi.prototype=Object.create(li.prototype)).constructor=pi,pi.prototype.isCatmullRomCurve3=!0,pi.prototype.getPoint=function(e,t){var r=t||new o,i=this.points,n=i.length,a=(n-(this.closed?0:1))*e,s=Math.floor(a),l=a-s;this.closed?s+=s>0?0:(Math.floor(Math.abs(s)/n)+1)*n:0===l&&s===n-1&&(s=n-2,l=1);var c,u,h,p;if(this.closed||s>0?c=i[(s-1)%n]:(Bs.subVectors(i[0],i[1]).add(i[0]),c=Bs),u=i[s%n],h=i[(s+1)%n],this.closed||s+2<n?p=i[(s+2)%n]:(Bs.subVectors(i[n-1],i[n-2]).add(i[n-1]),p=Bs),"centripetal"===this.curveType||"chordal"===this.curveType){var d="chordal"===this.curveType?.5:.25,f=Math.pow(c.distanceToSquared(u),d),m=Math.pow(u.distanceToSquared(h),d),g=Math.pow(h.distanceToSquared(p),d);m<1e-4&&(m=1),f<1e-4&&(f=m),g<1e-4&&(g=m),Vs.initNonuniformCatmullRom(c.x,u.x,h.x,p.x,f,m,g),zs.initNonuniformCatmullRom(c.y,u.y,h.y,p.y,f,m,g),qs.initNonuniformCatmullRom(c.z,u.z,h.z,p.z,f,m,g)}else"catmullrom"===this.curveType&&(Vs.initCatmullRom(c.x,u.x,h.x,p.x,this.tension),zs.initCatmullRom(c.y,u.y,h.y,p.y,this.tension),qs.initCatmullRom(c.z,u.z,h.z,p.z,this.tension));return r.set(Vs.calc(l),zs.calc(l),qs.calc(l)),r},pi.prototype.copy=function(e){li.prototype.copy.call(this,e),this.points=[];for(var t=0,r=e.points.length;t<r;t++){var i=e.points[t];this.points.push(i.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this},pi.prototype.toJSON=function(){var e=li.prototype.toJSON.call(this);e.points=[];for(var t=0,r=this.points.length;t<r;t++){var i=this.points[t];e.points.push(i.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e},pi.prototype.fromJSON=function(e){li.prototype.fromJSON.call(this,e),this.points=[];for(var t=0,r=e.points.length;t<r;t++){var i=e.points[t];this.points.push((new o).fromArray(i))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this},(gi.prototype=Object.create(li.prototype)).constructor=gi,gi.prototype.isCubicBezierCurve=!0,gi.prototype.getPoint=function(e,t){var i=t||new r,n=this.v0,o=this.v1,a=this.v2,s=this.v3;return i.set(mi(e,n.x,o.x,a.x,s.x),mi(e,n.y,o.y,a.y,s.y)),i},gi.prototype.copy=function(e){return li.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this},gi.prototype.toJSON=function(){var e=li.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e},gi.prototype.fromJSON=function(e){return li.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this},(vi.prototype=Object.create(li.prototype)).constructor=vi,vi.prototype.isCubicBezierCurve3=!0,vi.prototype.getPoint=function(e,t){var r=t||new o,i=this.v0,n=this.v1,a=this.v2,s=this.v3;return r.set(mi(e,i.x,n.x,a.x,s.x),mi(e,i.y,n.y,a.y,s.y),mi(e,i.z,n.z,a.z,s.z)),r},vi.prototype.copy=function(e){return li.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this},vi.prototype.toJSON=function(){var e=li.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e},vi.prototype.fromJSON=function(e){return li.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this},(yi.prototype=Object.create(li.prototype)).constructor=yi,yi.prototype.isLineCurve=!0,yi.prototype.getPoint=function(e,t){var i=t||new r;return 1===e?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(e).add(this.v1)),i},yi.prototype.getPointAt=function(e,t){return this.getPoint(e,t)},yi.prototype.getTangent=function(){return this.v2.clone().sub(this.v1).normalize()},yi.prototype.copy=function(e){return li.prototype.copy.call(this,e),this.v1.copy(e.v1),this.v2.copy(e.v2),this},yi.prototype.toJSON=function(){var e=li.prototype.toJSON.call(this);return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},yi.prototype.fromJSON=function(e){return li.prototype.fromJSON.call(this,e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},(Ei.prototype=Object.create(li.prototype)).constructor=Ei,Ei.prototype.isLineCurve3=!0,Ei.prototype.getPoint=function(e,t){var r=t||new o;return 1===e?r.copy(this.v2):(r.copy(this.v2).sub(this.v1),r.multiplyScalar(e).add(this.v1)),r},Ei.prototype.getPointAt=function(e,t){return this.getPoint(e,t)},Ei.prototype.copy=function(e){return li.prototype.copy.call(this,e),this.v1.copy(e.v1),this.v2.copy(e.v2),this},Ei.prototype.toJSON=function(){var e=li.prototype.toJSON.call(this);return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},Ei.prototype.fromJSON=function(e){return li.prototype.fromJSON.call(this,e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},(bi.prototype=Object.create(li.prototype)).constructor=bi,bi.prototype.isQuadraticBezierCurve=!0,bi.prototype.getPoint=function(e,t){var i=t||new r,n=this.v0,o=this.v1,a=this.v2;return i.set(fi(e,n.x,o.x,a.x),fi(e,n.y,o.y,a.y)),i},bi.prototype.copy=function(e){return li.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this},bi.prototype.toJSON=function(){var e=li.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},bi.prototype.fromJSON=function(e){return li.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},(xi.prototype=Object.create(li.prototype)).constructor=xi,xi.prototype.isQuadraticBezierCurve3=!0,xi.prototype.getPoint=function(e,t){var r=t||new o,i=this.v0,n=this.v1,a=this.v2;return r.set(fi(e,i.x,n.x,a.x),fi(e,i.y,n.y,a.y),fi(e,i.z,n.z,a.z)),r},xi.prototype.copy=function(e){return li.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this},xi.prototype.toJSON=function(){var e=li.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},xi.prototype.fromJSON=function(e){return li.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},(_i.prototype=Object.create(li.prototype)).constructor=_i,_i.prototype.isSplineCurve=!0,_i.prototype.getPoint=function(e,t){var i=t||new r,n=this.points,o=(n.length-1)*e,a=Math.floor(o),s=o-a,l=n[0===a?a:a-1],c=n[a],u=n[a>n.length-2?n.length-1:a+1],h=n[a>n.length-3?n.length-1:a+2];return i.set(di(s,l.x,c.x,u.x,h.x),di(s,l.y,c.y,u.y,h.y)),i},_i.prototype.copy=function(e){li.prototype.copy.call(this,e),this.points=[];for(var t=0,r=e.points.length;t<r;t++){var i=e.points[t];this.points.push(i.clone())}return this},_i.prototype.toJSON=function(){var e=li.prototype.toJSON.call(this);e.points=[];for(var t=0,r=this.points.length;t<r;t++){var i=this.points[t];e.points.push(i.toArray())}return e},_i.prototype.fromJSON=function(e){li.prototype.fromJSON.call(this,e),this.points=[];for(var t=0,i=e.points.length;t<i;t++){var n=e.points[t];this.points.push((new r).fromArray(n))}return this};var Gs=Object.freeze({ArcCurve:ui,CatmullRomCurve3:pi,CubicBezierCurve:gi,CubicBezierCurve3:vi,EllipseCurve:ci,LineCurve:yi,LineCurve3:Ei,QuadraticBezierCurve:bi,QuadraticBezierCurve3:xi,SplineCurve:_i});wi.prototype=Object.assign(Object.create(li.prototype),{constructor:wi,add:function(e){this.curves.push(e)},closePath:function(){var e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new yi(t,e))},getPoint:function(e){for(var t=e*this.getLength(),r=this.getCurveLengths(),i=0;i<r.length;){if(r[i]>=t){var n=r[i]-t,o=this.curves[i],a=o.getLength(),s=0===a?0:1-n/a;return o.getPointAt(s)}i++}return null},getLength:function(){var e=this.getCurveLengths();return e[e.length-1]},updateArcLengths:function(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()},getCurveLengths:function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;for(var e=[],t=0,r=0,i=this.curves.length;r<i;r++)t+=this.curves[r].getLength(),e.push(t);return this.cacheLengths=e,e},getSpacedPoints:function(e){void 0===e&&(e=40);for(var t=[],r=0;r<=e;r++)t.push(this.getPoint(r/e));return this.autoClose&&t.push(t[0]),t},getPoints:function(e){e=e||12;for(var t,r=[],i=0,n=this.curves;i<n.length;i++)for(var o=n[i],a=o&&o.isEllipseCurve?2*e:o&&(o.isLineCurve||o.isLineCurve3)?1:o&&o.isSplineCurve?e*o.points.length:e,s=o.getPoints(a),l=0;l<s.length;l++){var c=s[l];t&&t.equals(c)||(r.push(c),t=c)}return this.autoClose&&r.length>1&&!r[r.length-1].equals(r[0])&&r.push(r[0]),r},copy:function(e){li.prototype.copy.call(this,e),this.curves=[];for(var t=0,r=e.curves.length;t<r;t++){var i=e.curves[t];this.curves.push(i.clone())}return this.autoClose=e.autoClose,this},toJSON:function(){var e=li.prototype.toJSON.call(this);e.autoClose=this.autoClose,e.curves=[];for(var t=0,r=this.curves.length;t<r;t++){var i=this.curves[t];e.curves.push(i.toJSON())}return e},fromJSON:function(e){li.prototype.fromJSON.call(this,e),this.autoClose=e.autoClose,this.curves=[];for(var t=0,r=e.curves.length;t<r;t++){var i=e.curves[t];this.curves.push((new Gs[i.type]).fromJSON(i))}return this}}),Ti.prototype=Object.assign(Object.create(wi.prototype),{constructor:Ti,setFromPoints:function(e){this.moveTo(e[0].x,e[0].y);for(var t=1,r=e.length;t<r;t++)this.lineTo(e[t].x,e[t].y)},moveTo:function(e,t){this.currentPoint.set(e,t)},lineTo:function(e,t){var i=new yi(this.currentPoint.clone(),new r(e,t));this.curves.push(i),this.currentPoint.set(e,t)},quadraticCurveTo:function(e,t,i,n){var o=new bi(this.currentPoint.clone(),new r(e,t),new r(i,n));this.curves.push(o),this.currentPoint.set(i,n)},bezierCurveTo:function(e,t,i,n,o,a){var s=new gi(this.currentPoint.clone(),new r(e,t),new r(i,n),new r(o,a));this.curves.push(s),this.currentPoint.set(o,a)},splineThru:function(e){var t=new _i([this.currentPoint.clone()].concat(e));this.curves.push(t),this.currentPoint.copy(e[e.length-1])},arc:function(e,t,r,i,n,o){var a=this.currentPoint.x,s=this.currentPoint.y;this.absarc(e+a,t+s,r,i,n,o)},absarc:function(e,t,r,i,n,o){this.absellipse(e,t,r,r,i,n,o)},ellipse:function(e,t,r,i,n,o,a,s){var l=this.currentPoint.x,c=this.currentPoint.y;this.absellipse(e+l,t+c,r,i,n,o,a,s)},absellipse:function(e,t,r,i,n,o,a,s){var l=new ci(e,t,r,i,n,o,a,s);if(this.curves.length>0){var c=l.getPoint(0);c.equals(this.currentPoint)||this.lineTo(c.x,c.y)}this.curves.push(l);var u=l.getPoint(1);this.currentPoint.copy(u)},copy:function(e){return wi.prototype.copy.call(this,e),this.currentPoint.copy(e.currentPoint),this},toJSON:function(){var e=wi.prototype.toJSON.call(this);return e.currentPoint=this.currentPoint.toArray(),e},fromJSON:function(e){return wi.prototype.fromJSON.call(this,e),this.currentPoint.fromArray(e.currentPoint),this}}),Mi.prototype=Object.assign(Object.create(Ti.prototype),{constructor:Mi,getPointsHoles:function(e){for(var t=[],r=0,i=this.holes.length;r<i;r++)t[r]=this.holes[r].getPoints(e);return t},extractPoints:function(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}},copy:function(e){Ti.prototype.copy.call(this,e),this.holes=[];for(var t=0,r=e.holes.length;t<r;t++){var i=e.holes[t];this.holes.push(i.clone())}return this},toJSON:function(){var e=Ti.prototype.toJSON.call(this);e.uuid=this.uuid,e.holes=[];for(var t=0,r=this.holes.length;t<r;t++){var i=this.holes[t];e.holes.push(i.toJSON())}return e},fromJSON:function(e){Ti.prototype.fromJSON.call(this,e),this.uuid=e.uuid,this.holes=[];for(var t=0,r=e.holes.length;t<r;t++){var i=e.holes[t];this.holes.push((new Ti).fromJSON(i))}return this}}),Ri.prototype=Object.assign(Object.create(T.prototype),{constructor:Ri,isLight:!0,copy:function(e){return T.prototype.copy.call(this,e),this.color.copy(e.color),this.intensity=e.intensity,this},toJSON:function(e){var t=T.prototype.toJSON.call(this,e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,void 0!==this.groundColor&&(t.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(t.object.distance=this.distance),void 0!==this.angle&&(t.object.angle=this.angle),void 0!==this.decay&&(t.object.decay=this.decay),void 0!==this.penumbra&&(t.object.penumbra=this.penumbra),void 0!==this.shadow&&(t.object.shadow=this.shadow.toJSON()),t}}),Si.prototype=Object.assign(Object.create(Ri.prototype),{constructor:Si,isHemisphereLight:!0,copy:function(e){return Ri.prototype.copy.call(this,e),this.groundColor.copy(e.groundColor),this}}),Object.assign(Pi.prototype,{copy:function(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){var e={};return 0!==this.bias&&(e.bias=this.bias),1!==this.radius&&(e.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}),Ai.prototype=Object.assign(Object.create(Pi.prototype),{constructor:Ai,isSpotLightShadow:!0,update:function(e){var t=this.camera,r=2*os.RAD2DEG*e.angle,i=this.mapSize.width/this.mapSize.height,n=e.distance||t.far;r===t.fov&&i===t.aspect&&n===t.far||(t.fov=r,t.aspect=i,t.far=n,t.updateProjectionMatrix())}}),Ci.prototype=Object.assign(Object.create(Ri.prototype),{constructor:Ci,isSpotLight:!0,copy:function(e){return Ri.prototype.copy.call(this,e),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}),Li.prototype=Object.assign(Object.create(Ri.prototype),{constructor:Li,isPointLight:!0,copy:function(e){return Ri.prototype.copy.call(this,e),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}),Oi.prototype=Object.assign(Object.create(et.prototype),{constructor:Oi,isOrthographicCamera:!0,copy:function(e,t){return et.prototype.copy.call(this,e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this},setViewOffset:function(e,t,r,i,n,o){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=r,this.view.offsetY=i,this.view.width=n,this.view.height=o,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),r=(this.right+this.left)/2,i=(this.top+this.bottom)/2,n=r-e,o=r+e,a=i+t,s=i-t;if(null!==this.view&&this.view.enabled){var l=this.zoom/(this.view.width/this.view.fullWidth),c=this.zoom/(this.view.height/this.view.fullHeight),u=(this.right-this.left)/this.view.width,h=(this.top-this.bottom)/this.view.height;o=(n+=u*(this.view.offsetX/l))+u*(this.view.width/l),s=(a-=h*(this.view.offsetY/c))-h*(this.view.height/c)}this.projectionMatrix.makeOrthographic(n,o,a,s,this.near,this.far),this.projectionMatrixInverse.getInverse(this.projectionMatrix)},toJSON:function(e){var t=T.prototype.toJSON.call(this,e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}}),Hi.prototype=Object.assign(Object.create(Pi.prototype),{constructor:Hi}),Fi.prototype=Object.assign(Object.create(Ri.prototype),{constructor:Fi,isDirectionalLight:!0,copy:function(e){return Ri.prototype.copy.call(this,e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}),Ii.prototype=Object.assign(Object.create(Ri.prototype),{constructor:Ii,isAmbientLight:!0}),ki.prototype=Object.assign(Object.create(Ri.prototype),{constructor:ki,isRectAreaLight:!0,copy:function(e){return Ri.prototype.copy.call(this,e),this.width=e.width,this.height=e.height,this},toJSON:function(e){var t=Ri.prototype.toJSON.call(this,e);return t.object.width=this.width,t.object.height=this.height,t}}),Object.assign(Di.prototype,{load:function(e,t,r,i){var n=this,o=new ti(n.manager);o.setPath(n.path),o.load(e,function(e){t(n.parse(JSON.parse(e)))},r,i)},parse:function(e){function t(e){return void 0===n[e]&&console.warn("THREE.MaterialLoader: Undefined texture",e),n[e]}var n=this.textures,a=new ks[e.type];if(void 0!==e.uuid&&(a.uuid=e.uuid),void 0!==e.name&&(a.name=e.name),void 0!==e.color&&a.color.setHex(e.color),void 0!==e.roughness&&(a.roughness=e.roughness),void 0!==e.metalness&&(a.metalness=e.metalness),void 0!==e.emissive&&a.emissive.setHex(e.emissive),void 0!==e.specular&&a.specular.setHex(e.specular),void 0!==e.shininess&&(a.shininess=e.shininess),void 0!==e.clearCoat&&(a.clearCoat=e.clearCoat),void 0!==e.clearCoatRoughness&&(a.clearCoatRoughness=e.clearCoatRoughness),void 0!==e.vertexColors&&(a.vertexColors=e.vertexColors),void 0!==e.fog&&(a.fog=e.fog),void 0!==e.flatShading&&(a.flatShading=e.flatShading),void 0!==e.blending&&(a.blending=e.blending),void 0!==e.combine&&(a.combine=e.combine),void 0!==e.side&&(a.side=e.side),void 0!==e.opacity&&(a.opacity=e.opacity),void 0!==e.transparent&&(a.transparent=e.transparent),void 0!==e.alphaTest&&(a.alphaTest=e.alphaTest),void 0!==e.depthTest&&(a.depthTest=e.depthTest),void 0!==e.depthWrite&&(a.depthWrite=e.depthWrite),void 0!==e.colorWrite&&(a.colorWrite=e.colorWrite),void 0!==e.wireframe&&(a.wireframe=e.wireframe),void 0!==e.wireframeLinewidth&&(a.wireframeLinewidth=e.wireframeLinewidth),void 0!==e.wireframeLinecap&&(a.wireframeLinecap=e.wireframeLinecap),void 0!==e.wireframeLinejoin&&(a.wireframeLinejoin=e.wireframeLinejoin),void 0!==e.rotation&&(a.rotation=e.rotation),1!==e.linewidth&&(a.linewidth=e.linewidth),void 0!==e.dashSize&&(a.dashSize=e.dashSize),void 0!==e.gapSize&&(a.gapSize=e.gapSize),void 0!==e.scale&&(a.scale=e.scale),void 0!==e.polygonOffset&&(a.polygonOffset=e.polygonOffset),void 0!==e.polygonOffsetFactor&&(a.polygonOffsetFactor=e.polygonOffsetFactor),void 0!==e.polygonOffsetUnits&&(a.polygonOffsetUnits=e.polygonOffsetUnits),void 0!==e.skinning&&(a.skinning=e.skinning),void 0!==e.morphTargets&&(a.morphTargets=e.morphTargets),void 0!==e.dithering&&(a.dithering=e.dithering),void 0!==e.visible&&(a.visible=e.visible),void 0!==e.userData&&(a.userData=e.userData),void 0!==e.uniforms)for(var s in e.uniforms){var c=e.uniforms[s];switch(a.uniforms[s]={},c.type){case"t":a.uniforms[s].value=t(c.value);break;case"c":a.uniforms[s].value=(new y).setHex(c.value);break;case"v2":a.uniforms[s].value=(new r).fromArray(c.value);break;case"v3":a.uniforms[s].value=(new o).fromArray(c.value);break;case"v4":a.uniforms[s].value=(new l).fromArray(c.value);break;case"m4":a.uniforms[s].value=(new i).fromArray(c.value);break;default:a.uniforms[s].value=c.value}}if(void 0!==e.defines&&(a.defines=e.defines),void 0!==e.vertexShader&&(a.vertexShader=e.vertexShader),void 0!==e.fragmentShader&&(a.fragmentShader=e.fragmentShader),void 0!==e.shading&&(a.flatShading=1===e.shading),void 0!==e.size&&(a.size=e.size),void 0!==e.sizeAttenuation&&(a.sizeAttenuation=e.sizeAttenuation),void 0!==e.map&&(a.map=t(e.map)),void 0!==e.alphaMap&&(a.alphaMap=t(e.alphaMap),a.transparent=!0),void 0!==e.bumpMap&&(a.bumpMap=t(e.bumpMap)),void 0!==e.bumpScale&&(a.bumpScale=e.bumpScale),void 0!==e.normalMap&&(a.normalMap=t(e.normalMap)),void 0!==e.normalMapType&&(a.normalMapType=e.normalMapType),void 0!==e.normalScale){var u=e.normalScale;!1===Array.isArray(u)&&(u=[u,u]),a.normalScale=(new r).fromArray(u)}return void 0!==e.displacementMap&&(a.displacementMap=t(e.displacementMap)),void 0!==e.displacementScale&&(a.displacementScale=e.displacementScale),void 0!==e.displacementBias&&(a.displacementBias=e.displacementBias),void 0!==e.roughnessMap&&(a.roughnessMap=t(e.roughnessMap)),void 0!==e.metalnessMap&&(a.metalnessMap=t(e.metalnessMap)),void 0!==e.emissiveMap&&(a.emissiveMap=t(e.emissiveMap)),void 0!==e.emissiveIntensity&&(a.emissiveIntensity=e.emissiveIntensity),void 0!==e.specularMap&&(a.specularMap=t(e.specularMap)),void 0!==e.envMap&&(a.envMap=t(e.envMap)),void 0!==e.envMapIntensity&&(a.envMapIntensity=e.envMapIntensity),void 0!==e.reflectivity&&(a.reflectivity=e.reflectivity),void 0!==e.lightMap&&(a.lightMap=t(e.lightMap)),void 0!==e.lightMapIntensity&&(a.lightMapIntensity=e.lightMapIntensity),void 0!==e.aoMap&&(a.aoMap=t(e.aoMap)),void 0!==e.aoMapIntensity&&(a.aoMapIntensity=e.aoMapIntensity),void 0!==e.gradientMap&&(a.gradientMap=t(e.gradientMap)),a},setPath:function(e){return this.path=e,this},setTextures:function(e){return this.textures=e,this}});var Ws={decodeText:function(e){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(e);for(var t="",r=0,i=e.length;r<i;r++)t+=String.fromCharCode(e[r]);return decodeURIComponent(escape(t))},extractUrlBase:function(e){var t=e.lastIndexOf("/");return-1===t?"./":e.substr(0,t+1)}};Object.assign(Ni.prototype,{load:function(e,t,r,i){var n=this,o=new ti(n.manager);o.setPath(n.path),o.load(e,function(e){t(n.parse(JSON.parse(e)))},r,i)},parse:function(e){var t=new N,r=e.data.index;if(void 0!==r){s=new Xs[r.type](r.array);t.setIndex(new R(s,1))}var i=e.data.attributes;for(var n in i){var a=i[n],s=new Xs[a.type](a.array);t.addAttribute(n,new R(s,a.itemSize,a.normalized))}var l=e.data.groups||e.data.drawcalls||e.data.offsets;if(void 0!==l)for(var c=0,u=l.length;c!==u;++c){var h=l[c];t.addGroup(h.start,h.count,h.materialIndex)}var p=e.data.boundingSphere;if(void 0!==p){var f=new o;void 0!==p.center&&f.fromArray(p.center),t.boundingSphere=new d(f,p.radius)}return e.name&&(t.name=e.name),e.userData&&(t.userData=e.userData),t},setPath:function(e){return this.path=e,this}});var Xs={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:"undefined"!=typeof Uint8ClampedArray?Uint8ClampedArray:Uint8Array,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};Object.assign(ji.prototype,{crossOrigin:"anonymous",load:function(e,t,r,i){var n=this,o=void 0===this.path?Ws.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||o;var a=new ti(n.manager);a.setPath(this.path),a.load(e,function(r){var o=null;try{o=JSON.parse(r)}catch(t){return void 0!==i&&i(t),void console.error("THREE:ObjectLoader: Can't parse "+e+".",t.message)}var a=o.metadata;void 0!==a&&void 0!==a.type&&"geometry"!==a.type.toLowerCase()?n.parse(o,t):console.error("THREE.ObjectLoader: Can't load "+e)},r,i)},setPath:function(e){return this.path=e,this},setResourcePath:function(e){return this.resourcePath=e,this},setCrossOrigin:function(e){return this.crossOrigin=e,this},parse:function(e,t){var r=this.parseShape(e.shapes),i=this.parseGeometries(e.geometries,r),n=this.parseImages(e.images,function(){void 0!==t&&t(s)}),o=this.parseTextures(e.textures,n),a=this.parseMaterials(e.materials,o),s=this.parseObject(e.object,i,a);return e.animations&&(s.animations=this.parseAnimations(e.animations)),void 0!==e.images&&0!==e.images.length||void 0!==t&&t(s),s},parseShape:function(e){var t={};if(void 0!==e)for(var r=0,i=e.length;r<i;r++){var n=(new Mi).fromJSON(e[r]);t[n.uuid]=n}return t},parseGeometries:function(e,t){var r={};if(void 0!==e)for(var i=new Ni,n=0,o=e.length;n<o;n++){var a,s=e[n];switch(s.type){case"PlaneGeometry":case"PlaneBufferGeometry":a=new Is[s.type](s.width,s.height,s.widthSegments,s.heightSegments);break;case"BoxGeometry":case"BoxBufferGeometry":case"CubeGeometry":a=new Is[s.type](s.width,s.height,s.depth,s.widthSegments,s.heightSegments,s.depthSegments);break;case"CircleGeometry":case"CircleBufferGeometry":a=new Is[s.type](s.radius,s.segments,s.thetaStart,s.thetaLength);break;case"CylinderGeometry":case"CylinderBufferGeometry":a=new Is[s.type](s.radiusTop,s.radiusBottom,s.height,s.radialSegments,s.heightSegments,s.openEnded,s.thetaStart,s.thetaLength);break;case"ConeGeometry":case"ConeBufferGeometry":a=new Is[s.type](s.radius,s.height,s.radialSegments,s.heightSegments,s.openEnded,s.thetaStart,s.thetaLength);break;case"SphereGeometry":case"SphereBufferGeometry":a=new Is[s.type](s.radius,s.widthSegments,s.heightSegments,s.phiStart,s.phiLength,s.thetaStart,s.thetaLength);break;case"DodecahedronGeometry":case"DodecahedronBufferGeometry":case"IcosahedronGeometry":case"IcosahedronBufferGeometry":case"OctahedronGeometry":case"OctahedronBufferGeometry":case"TetrahedronGeometry":case"TetrahedronBufferGeometry":a=new Is[s.type](s.radius,s.detail);break;case"RingGeometry":case"RingBufferGeometry":a=new Is[s.type](s.innerRadius,s.outerRadius,s.thetaSegments,s.phiSegments,s.thetaStart,s.thetaLength);break;case"TorusGeometry":case"TorusBufferGeometry":a=new Is[s.type](s.radius,s.tube,s.radialSegments,s.tubularSegments,s.arc);break;case"TorusKnotGeometry":case"TorusKnotBufferGeometry":a=new Is[s.type](s.radius,s.tube,s.tubularSegments,s.radialSegments,s.p,s.q);break;case"LatheGeometry":case"LatheBufferGeometry":a=new Is[s.type](s.points,s.segments,s.phiStart,s.phiLength);break;case"PolyhedronGeometry":case"PolyhedronBufferGeometry":a=new Is[s.type](s.vertices,s.indices,s.radius,s.details);break;case"ShapeGeometry":case"ShapeBufferGeometry":for(var l=[],c=0,u=s.shapes.length;c<u;c++){h=t[s.shapes[c]];l.push(h)}a=new Is[s.type](l,s.curveSegments);break;case"ExtrudeGeometry":case"ExtrudeBufferGeometry":for(var l=[],c=0,u=s.shapes.length;c<u;c++){var h=t[s.shapes[c]];l.push(h)}var p=s.options.extrudePath;void 0!==p&&(s.options.extrudePath=(new Gs[p.type]).fromJSON(p)),a=new Is[s.type](l,s.options);break;case"BufferGeometry":a=i.parse(s);break;case"Geometry":if("THREE"in window&&"LegacyJSONLoader"in THREE){a=(new THREE.LegacyJSONLoader).parse(s,this.resourcePath).geometry}else console.error('THREE.ObjectLoader: You have to import LegacyJSONLoader in order load geometry data of type "Geometry".');break;default:console.warn('THREE.ObjectLoader: Unsupported geometry type "'+s.type+'"');continue}a.uuid=s.uuid,void 0!==s.name&&(a.name=s.name),!0===a.isBufferGeometry&&void 0!==s.userData&&(a.userData=s.userData),r[s.uuid]=a}return r},parseMaterials:function(e,t){var r={},i={};if(void 0!==e){var n=new Di;n.setTextures(t);for(var o=0,a=e.length;o<a;o++){var s=e[o];if("MultiMaterial"===s.type){for(var l=[],c=0;c<s.materials.length;c++){var u=s.materials[c];void 0===r[u.uuid]&&(r[u.uuid]=n.parse(u)),l.push(r[u.uuid])}i[s.uuid]=l}else i[s.uuid]=n.parse(s),r[s.uuid]=i[s.uuid]}}return i},parseAnimations:function(e){for(var t=[],r=0;r<e.length;r++){var i=e[r],n=Zr.parse(i);void 0!==i.uuid&&(n.uuid=i.uuid),t.push(n)}return t},parseImages:function(e,t){function r(e){return i.manager.itemStart(e),o.load(e,function(){i.manager.itemEnd(e)},void 0,function(){i.manager.itemError(e),i.manager.itemEnd(e)})}var i=this,n={};if(void 0!==e&&e.length>0){var o=new oi(new ei(t));o.setCrossOrigin(this.crossOrigin);for(var a=0,s=e.length;a<s;a++){var l=e[a],c=l.url;if(Array.isArray(c)){n[l.uuid]=[];for(var u=0,h=c.length;u<h;u++){var p=c[u],d=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(p)?p:i.resourcePath+p;n[l.uuid].push(r(d))}}else{d=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(l.url)?l.url:i.resourcePath+l.url;n[l.uuid]=r(d)}}}return n},parseTextures:function(e,t){function r(e,t){return"number"==typeof e?e:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",e),t[e])}var i={};if(void 0!==e)for(var n=0,o=e.length;n<o;n++){var a=e[n];void 0===a.image&&console.warn('THREE.ObjectLoader: No "image" specified for',a.uuid),void 0===t[a.image]&&console.warn("THREE.ObjectLoader: Undefined image",a.image);var l;(l=Array.isArray(t[a.image])?new J(t[a.image]):new s(t[a.image])).needsUpdate=!0,l.uuid=a.uuid,void 0!==a.name&&(l.name=a.name),void 0!==a.mapping&&(l.mapping=r(a.mapping,Ys)),void 0!==a.offset&&l.offset.fromArray(a.offset),void 0!==a.repeat&&l.repeat.fromArray(a.repeat),void 0!==a.center&&l.center.fromArray(a.center),void 0!==a.rotation&&(l.rotation=a.rotation),void 0!==a.wrap&&(l.wrapS=r(a.wrap[0],Qs),l.wrapT=r(a.wrap[1],Qs)),void 0!==a.format&&(l.format=a.format),void 0!==a.minFilter&&(l.minFilter=r(a.minFilter,Js)),void 0!==a.magFilter&&(l.magFilter=r(a.magFilter,Js)),void 0!==a.anisotropy&&(l.anisotropy=a.anisotropy),void 0!==a.flipY&&(l.flipY=a.flipY),i[a.uuid]=l}return i},parseObject:function(e,t,r){function i(e){return void 0===t[e]&&console.warn("THREE.ObjectLoader: Undefined geometry",e),t[e]}function n(e){if(void 0!==e){if(Array.isArray(e)){for(var t=[],i=0,n=e.length;i<n;i++){var o=e[i];void 0===r[o]&&console.warn("THREE.ObjectLoader: Undefined material",o),t.push(r[o])}return t}return void 0===r[e]&&console.warn("THREE.ObjectLoader: Undefined material",e),r[e]}}var o;switch(e.type){case"Scene":o=new lt,void 0!==e.background&&Number.isInteger(e.background)&&(o.background=new y(e.background)),void 0!==e.fog&&("Fog"===e.fog.type?o.fog=new st(e.fog.color,e.fog.near,e.fog.far):"FogExp2"===e.fog.type&&(o.fog=new at(e.fog.color,e.fog.density)));break;case"PerspectiveCamera":o=new tt(e.fov,e.aspect,e.near,e.far),void 0!==e.focus&&(o.focus=e.focus),void 0!==e.zoom&&(o.zoom=e.zoom),void 0!==e.filmGauge&&(o.filmGauge=e.filmGauge),void 0!==e.filmOffset&&(o.filmOffset=e.filmOffset),void 0!==e.view&&(o.view=Object.assign({},e.view));break;case"OrthographicCamera":o=new Oi(e.left,e.right,e.top,e.bottom,e.near,e.far),void 0!==e.zoom&&(o.zoom=e.zoom),void 0!==e.view&&(o.view=Object.assign({},e.view));break;case"AmbientLight":o=new Ii(e.color,e.intensity);break;case"DirectionalLight":o=new Fi(e.color,e.intensity);break;case"PointLight":o=new Li(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":o=new ki(e.color,e.intensity,e.width,e.height);break;case"SpotLight":o=new Ci(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay);break;case"HemisphereLight":o=new Si(e.color,e.groundColor,e.intensity);break;case"SkinnedMesh":console.warn("THREE.ObjectLoader.parseObject() does not support SkinnedMesh yet.");case"Mesh":var a=i(e.geometry),s=n(e.material);o=a.bones&&a.bones.length>0?new ft(a,s):new Y(a,s);break;case"LOD":o=new dt;break;case"Line":o=new yt(i(e.geometry),n(e.material),e.mode);break;case"LineLoop":o=new bt(i(e.geometry),n(e.material));break;case"LineSegments":o=new Et(i(e.geometry),n(e.material));break;case"PointCloud":case"Points":o=new _t(i(e.geometry),n(e.material));break;case"Sprite":o=new pt(n(e.material));break;case"Group":o=new $e;break;default:o=new T}if(o.uuid=e.uuid,void 0!==e.name&&(o.name=e.name),void 0!==e.matrix?(o.matrix.fromArray(e.matrix),void 0!==e.matrixAutoUpdate&&(o.matrixAutoUpdate=e.matrixAutoUpdate),o.matrixAutoUpdate&&o.matrix.decompose(o.position,o.quaternion,o.scale)):(void 0!==e.position&&o.position.fromArray(e.position),void 0!==e.rotation&&o.rotation.fromArray(e.rotation),void 0!==e.quaternion&&o.quaternion.fromArray(e.quaternion),void 0!==e.scale&&o.scale.fromArray(e.scale)),void 0!==e.castShadow&&(o.castShadow=e.castShadow),void 0!==e.receiveShadow&&(o.receiveShadow=e.receiveShadow),e.shadow&&(void 0!==e.shadow.bias&&(o.shadow.bias=e.shadow.bias),void 0!==e.shadow.radius&&(o.shadow.radius=e.shadow.radius),void 0!==e.shadow.mapSize&&o.shadow.mapSize.fromArray(e.shadow.mapSize),void 0!==e.shadow.camera&&(o.shadow.camera=this.parseObject(e.shadow.camera))),void 0!==e.visible&&(o.visible=e.visible),void 0!==e.frustumCulled&&(o.frustumCulled=e.frustumCulled),void 0!==e.renderOrder&&(o.renderOrder=e.renderOrder),void 0!==e.userData&&(o.userData=e.userData),void 0!==e.layers&&(o.layers.mask=e.layers),void 0!==e.children)for(var l=e.children,c=0;c<l.length;c++)o.add(this.parseObject(l[c],t,r));if("LOD"===e.type)for(var u=e.levels,h=0;h<u.length;h++){var p=u[h],d=o.getObjectByProperty("uuid",p.object);void 0!==d&&o.addLevel(d,p.distance)}return o}});var Ys={UVMapping:300,CubeReflectionMapping:Do,CubeRefractionMapping:No,EquirectangularReflectionMapping:jo,EquirectangularRefractionMapping:Uo,SphericalReflectionMapping:Bo,CubeUVReflectionMapping:Vo,CubeUVRefractionMapping:zo},Qs={RepeatWrapping:qo,ClampToEdgeWrapping:Go,MirroredRepeatWrapping:Wo},Js={NearestFilter:Xo,NearestMipMapNearestFilter:Yo,NearestMipMapLinearFilter:Qo,LinearFilter:Jo,LinearMipMapNearestFilter:Ko,LinearMipMapLinearFilter:Zo};Ui.prototype={constructor:Ui,setOptions:function(e){return this.options=e,this},load:function(e,t,r,i){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);var n=this,o=Ns.get(e);if(void 0!==o)return n.manager.itemStart(e),setTimeout(function(){t&&t(o),n.manager.itemEnd(e)},0),o;fetch(e).then(function(e){return e.blob()}).then(function(e){return createImageBitmap(e,n.options)}).then(function(r){Ns.add(e,r),t&&t(r),n.manager.itemEnd(e)}).catch(function(t){i&&i(t),n.manager.itemError(e),n.manager.itemEnd(e)})},setCrossOrigin:function(){return this},setPath:function(e){return this.path=e,this}},Object.assign(Bi.prototype,{moveTo:function(e,t){this.currentPath=new Ti,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t)},lineTo:function(e,t){this.currentPath.lineTo(e,t)},quadraticCurveTo:function(e,t,r,i){this.currentPath.quadraticCurveTo(e,t,r,i)},bezierCurveTo:function(e,t,r,i,n,o){this.currentPath.bezierCurveTo(e,t,r,i,n,o)},splineThru:function(e){this.currentPath.splineThru(e)},toShapes:function(e,t){function r(e){for(var t=[],r=0,i=e.length;r<i;r++){var n=e[r],o=new Mi;o.curves=n.curves,t.push(o)}return t}function i(e,t){for(var r=t.length,i=!1,n=r-1,o=0;o<r;n=o++){var a=t[n],s=t[o],l=s.x-a.x,c=s.y-a.y;if(Math.abs(c)>Number.EPSILON){if(c<0&&(a=t[o],l=-l,s=t[n],c=-c),e.y<a.y||e.y>s.y)continue;if(e.y===a.y){if(e.x===a.x)return!0}else{var u=c*(e.x-a.x)-l*(e.y-a.y);if(0===u)return!0;if(u<0)continue;i=!i}}else{if(e.y!==a.y)continue;if(s.x<=e.x&&e.x<=a.x||a.x<=e.x&&e.x<=s.x)return!0}}return i}var n=Hs.isClockWise,o=this.subPaths;if(0===o.length)return[];if(!0===t)return r(o);var a,s,l,c=[];if(1===o.length)return s=o[0],l=new Mi,l.curves=s.curves,c.push(l),c;var u=!n(o[0].getPoints());u=e?!u:u;var h,p=[],d=[],f=[],m=0;d[m]=void 0,f[m]=[];for(var g=0,v=o.length;g<v;g++)a=n(h=(s=o[g]).getPoints()),(a=e?!a:a)?(!u&&d[m]&&m++,d[m]={s:new Mi,p:h},d[m].s.curves=s.curves,u&&m++,f[m]=[]):f[m].push({h:s,p:h[0]});if(!d[0])return r(o);if(d.length>1){for(var y=!1,E=[],b=0,x=d.length;b<x;b++)p[b]=[];for(var b=0,x=d.length;b<x;b++)for(var _=f[b],w=0;w<_.length;w++){for(var T=_[w],M=!0,R=0;R<d.length;R++)i(T.p,d[R].p)&&(b!==R&&E.push({froms:b,tos:R,hole:w}),M?(M=!1,p[R].push(T)):y=!0);M&&p[b].push(T)}E.length>0&&(y||(f=p))}for(var S,g=0,P=d.length;g<P;g++){l=d[g].s,c.push(l);for(var A=0,C=(S=f[g]).length;A<C;A++)l.holes.push(S[A].h)}return c}}),Object.assign(Vi.prototype,{isFont:!0,generateShapes:function(e,t){void 0===t&&(t=100);for(var r=[],i=zi(e,t,this.data),n=0,o=i.length;n<o;n++)Array.prototype.push.apply(r,i[n].toShapes());return r}}),Object.assign(qi.prototype,{load:function(e,t,r,i){var n=this,o=new ti(this.manager);o.setPath(this.path),o.load(e,function(e){var r;try{r=JSON.parse(e)}catch(t){console.warn("THREE.FontLoader: typeface.js support is being deprecated. Use typeface.json instead."),r=JSON.parse(e.substring(65,e.length-2))}var i=n.parse(r);t&&t(i)},r,i)},parse:function(e){return new Vi(e)},setPath:function(e){return this.path=e,this}}),Gi.Handlers={handlers:[],add:function(e,t){this.handlers.push(e,t)},get:function(e){for(var t=this.handlers,r=0,i=t.length;r<i;r+=2){var n=t[r],o=t[r+1];if(n.test(e))return o}return null}},Object.assign(Gi.prototype,{crossOrigin:"anonymous",onLoadStart:function(){},onLoadProgress:function(){},onLoadComplete:function(){},initMaterials:function(e,t,r){for(var i=[],n=0;n<e.length;++n)i[n]=this.createMaterial(e[n],t,r);return i},createMaterial:function(){var e={NoBlending:Kn,NormalBlending:Zn,AdditiveBlending:$n,SubtractiveBlending:eo,MultiplyBlending:to,CustomBlending:ro},t=new y,r=new si,i=new Di;return function(n,o,a){function s(e,t,i,n,s){var c,u=o+e,h=Gi.Handlers.get(u);null!==h?c=h.load(u):(r.setCrossOrigin(a),c=r.load(u)),void 0!==t&&(c.repeat.fromArray(t),1!==t[0]&&(c.wrapS=qo),1!==t[1]&&(c.wrapT=qo)),void 0!==i&&c.offset.fromArray(i),void 0!==n&&("repeat"===n[0]&&(c.wrapS=qo),"mirror"===n[0]&&(c.wrapS=Wo),"repeat"===n[1]&&(c.wrapT=qo),"mirror"===n[1]&&(c.wrapT=Wo)),void 0!==s&&(c.anisotropy=s);var p=os.generateUUID();return l[p]=c,p}var l={},c={uuid:os.generateUUID(),type:"MeshLambertMaterial"};for(var u in n){var h=n[u];switch(u){case"DbgColor":case"DbgIndex":case"opticalDensity":case"illumination":break;case"DbgName":c.name=h;break;case"blending":c.blending=e[h];break;case"colorAmbient":case"mapAmbient":console.warn("THREE.Loader.createMaterial:",u,"is no longer supported.");break;case"colorDiffuse":c.color=t.fromArray(h).getHex();break;case"colorSpecular":c.specular=t.fromArray(h).getHex();break;case"colorEmissive":c.emissive=t.fromArray(h).getHex();break;case"specularCoef":c.shininess=h;break;case"shading":"basic"===h.toLowerCase()&&(c.type="MeshBasicMaterial"),"phong"===h.toLowerCase()&&(c.type="MeshPhongMaterial"),"standard"===h.toLowerCase()&&(c.type="MeshStandardMaterial");break;case"mapDiffuse":c.map=s(h,n.mapDiffuseRepeat,n.mapDiffuseOffset,n.mapDiffuseWrap,n.mapDiffuseAnisotropy);break;case"mapDiffuseRepeat":case"mapDiffuseOffset":case"mapDiffuseWrap":case"mapDiffuseAnisotropy":break;case"mapEmissive":c.emissiveMap=s(h,n.mapEmissiveRepeat,n.mapEmissiveOffset,n.mapEmissiveWrap,n.mapEmissiveAnisotropy);break;case"mapEmissiveRepeat":case"mapEmissiveOffset":case"mapEmissiveWrap":case"mapEmissiveAnisotropy":break;case"mapLight":c.lightMap=s(h,n.mapLightRepeat,n.mapLightOffset,n.mapLightWrap,n.mapLightAnisotropy);break;case"mapLightRepeat":case"mapLightOffset":case"mapLightWrap":case"mapLightAnisotropy":break;case"mapAO":c.aoMap=s(h,n.mapAORepeat,n.mapAOOffset,n.mapAOWrap,n.mapAOAnisotropy);break;case"mapAORepeat":case"mapAOOffset":case"mapAOWrap":case"mapAOAnisotropy":break;case"mapBump":c.bumpMap=s(h,n.mapBumpRepeat,n.mapBumpOffset,n.mapBumpWrap,n.mapBumpAnisotropy);break;case"mapBumpScale":c.bumpScale=h;break;case"mapBumpRepeat":case"mapBumpOffset":case"mapBumpWrap":case"mapBumpAnisotropy":break;case"mapNormal":c.normalMap=s(h,n.mapNormalRepeat,n.mapNormalOffset,n.mapNormalWrap,n.mapNormalAnisotropy);break;case"mapNormalFactor":c.normalScale=h;break;case"mapNormalRepeat":case"mapNormalOffset":case"mapNormalWrap":case"mapNormalAnisotropy":break;case"mapSpecular":c.specularMap=s(h,n.mapSpecularRepeat,n.mapSpecularOffset,n.mapSpecularWrap,n.mapSpecularAnisotropy);break;case"mapSpecularRepeat":case"mapSpecularOffset":case"mapSpecularWrap":case"mapSpecularAnisotropy":break;case"mapMetalness":c.metalnessMap=s(h,n.mapMetalnessRepeat,n.mapMetalnessOffset,n.mapMetalnessWrap,n.mapMetalnessAnisotropy);break;case"mapMetalnessRepeat":case"mapMetalnessOffset":case"mapMetalnessWrap":case"mapMetalnessAnisotropy":break;case"mapRoughness":c.roughnessMap=s(h,n.mapRoughnessRepeat,n.mapRoughnessOffset,n.mapRoughnessWrap,n.mapRoughnessAnisotropy);break;case"mapRoughnessRepeat":case"mapRoughnessOffset":case"mapRoughnessWrap":case"mapRoughnessAnisotropy":break;case"mapAlpha":c.alphaMap=s(h,n.mapAlphaRepeat,n.mapAlphaOffset,n.mapAlphaWrap,n.mapAlphaAnisotropy);break;case"mapAlphaRepeat":case"mapAlphaOffset":case"mapAlphaWrap":case"mapAlphaAnisotropy":break;case"flipSided":c.side=Wn;break;case"doubleSided":c.side=Xn;break;case"transparency":console.warn("THREE.Loader.createMaterial: transparency has been renamed to opacity"),c.opacity=h;break;case"depthTest":case"depthWrite":case"colorWrite":case"opacity":case"reflectivity":case"transparent":case"visible":case"wireframe":c[u]=h;break;case"vertexColors":!0===h&&(c.vertexColors=Jn),"face"===h&&(c.vertexColors=Qn);break;default:console.error("THREE.Loader.createMaterial: Unsupported",u,h)}}return"MeshBasicMaterial"===c.type&&delete c.emissive,"MeshPhongMaterial"!==c.type&&delete c.specular,c.opacity<1&&(c.transparent=!0),i.setTextures(l),i.parse(c)}}()});var Ks,Zs={getContext:function(){return void 0===Ks&&(Ks=new(window.AudioContext||window.webkitAudioContext)),Ks},setContext:function(e){Ks=e}};Object.assign(Wi.prototype,{load:function(e,t,r,i){var n=new ti(this.manager);n.setResponseType("arraybuffer"),n.setPath(this.path),n.load(e,function(e){var r=e.slice(0);Zs.getContext().decodeAudioData(r,function(e){t(e)})},r,i)},setPath:function(e){return this.path=e,this}}),Object.assign(Xi.prototype,{update:function(){var e,t,r,n,o,a,s,l,c=new i,u=new i;return function(i){if(e!==this||t!==i.focus||r!==i.fov||n!==i.aspect*this.aspect||o!==i.near||a!==i.far||s!==i.zoom||l!==this.eyeSep){e=this,t=i.focus,r=i.fov,n=i.aspect*this.aspect,o=i.near,a=i.far,s=i.zoom;var h,p,d=i.projectionMatrix.clone(),f=(l=this.eyeSep/2)*o/t,m=o*Math.tan(os.DEG2RAD*r*.5)/s;u.elements[12]=-l,c.elements[12]=l,h=-m*n+f,p=m*n+f,d.elements[0]=2*o/(p-h),d.elements[8]=(p+h)/(p-h),this.cameraL.projectionMatrix.copy(d),h=-m*n-f,p=m*n-f,d.elements[0]=2*o/(p-h),d.elements[8]=(p+h)/(p-h),this.cameraR.projectionMatrix.copy(d)}this.cameraL.matrixWorld.copy(i.matrixWorld).multiply(u),this.cameraR.matrixWorld.copy(i.matrixWorld).multiply(c)}}()}),(Yi.prototype=Object.create(T.prototype)).constructor=Yi,Object.assign(Qi.prototype,{start:function(){this.startTime=("undefined"==typeof performance?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0},stop:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1},getElapsedTime:function(){return this.getDelta(),this.elapsedTime},getDelta:function(){var e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var t=("undefined"==typeof performance?Date:performance).now();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}),Ji.prototype=Object.assign(Object.create(T.prototype),{constructor:Ji,getInput:function(){return this.gain},removeFilter:function(){return null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this},getFilter:function(){return this.filter},setFilter:function(e){return null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this},getMasterVolume:function(){return this.gain.gain.value},setMasterVolume:function(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this},updateMatrixWorld:function(){var e=new o,t=new n,r=new o,i=new o,a=new Qi;return function(n){T.prototype.updateMatrixWorld.call(this,n);var o=this.context.listener,s=this.up;if(this.timeDelta=a.getDelta(),this.matrixWorld.decompose(e,t,r),i.set(0,0,-1).applyQuaternion(t),o.positionX){var l=this.context.currentTime+this.timeDelta;o.positionX.linearRampToValueAtTime(e.x,l),o.positionY.linearRampToValueAtTime(e.y,l),o.positionZ.linearRampToValueAtTime(e.z,l),o.forwardX.linearRampToValueAtTime(i.x,l),o.forwardY.linearRampToValueAtTime(i.y,l),o.forwardZ.linearRampToValueAtTime(i.z,l),o.upX.linearRampToValueAtTime(s.x,l),o.upY.linearRampToValueAtTime(s.y,l),o.upZ.linearRampToValueAtTime(s.z,l)}else o.setPosition(e.x,e.y,e.z),o.setOrientation(i.x,i.y,i.z,s.x,s.y,s.z)}}()}),Ki.prototype=Object.assign(Object.create(T.prototype),{constructor:Ki,getOutput:function(){return this.gain},setNodeSource:function(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this},setMediaElementSource:function(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this},setBuffer:function(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this},play:function(){if(!0!==this.isPlaying){if(!1!==this.hasPlaybackControl){var e=this.context.createBufferSource();return e.buffer=this.buffer,e.detune.value=this.detune,e.loop=this.loop,e.onended=this.onEnded.bind(this),e.playbackRate.setValueAtTime(this.playbackRate,this.startTime),this.startTime=this.context.currentTime,e.start(this.startTime,this.offset),this.isPlaying=!0,this.source=e,this.connect()}console.warn("THREE.Audio: this Audio has no playback control.")}else console.warn("THREE.Audio: Audio is already playing.")},pause:function(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this.source.stop(),this.source.onended=null,this.offset+=(this.context.currentTime-this.startTime)*this.playbackRate,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")},stop:function(){if(!1!==this.hasPlaybackControl)return this.source.stop(),this.source.onended=null,this.offset=0,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")},connect:function(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(var e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this},disconnect:function(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(var e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this},getFilters:function(){return this.filters},setFilters:function(e){return e||(e=[]),!0===this.isPlaying?(this.disconnect(),this.filters=e,this.connect()):this.filters=e,this},setDetune:function(e){return this.detune=e,!0===this.isPlaying&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this},getDetune:function(){return this.detune},getFilter:function(){return this.getFilters()[0]},setFilter:function(e){return this.setFilters(e?[e]:[])},setPlaybackRate:function(e){if(!1!==this.hasPlaybackControl)return this.playbackRate=e,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")},getPlaybackRate:function(){return this.playbackRate},onEnded:function(){this.isPlaying=!1},getLoop:function(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop},setLoop:function(e){if(!1!==this.hasPlaybackControl)return this.loop=e,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")},getVolume:function(){return this.gain.gain.value},setVolume:function(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}}),Zi.prototype=Object.assign(Object.create(Ki.prototype),{constructor:Zi,getOutput:function(){return this.panner},getRefDistance:function(){return this.panner.refDistance},setRefDistance:function(e){return this.panner.refDistance=e,this},getRolloffFactor:function(){return this.panner.rolloffFactor},setRolloffFactor:function(e){return this.panner.rolloffFactor=e,this},getDistanceModel:function(){return this.panner.distanceModel},setDistanceModel:function(e){return this.panner.distanceModel=e,this},getMaxDistance:function(){return this.panner.maxDistance},setMaxDistance:function(e){return this.panner.maxDistance=e,this},setDirectionalCone:function(e,t,r){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=t,this.panner.coneOuterGain=r,this},updateMatrixWorld:function(){var e=new o,t=new n,r=new o,i=new o;return function(n){T.prototype.updateMatrixWorld.call(this,n);var o=this.panner;if(this.matrixWorld.decompose(e,t,r),i.set(0,0,1).applyQuaternion(t),o.positionX){var a=this.context.currentTime+this.listener.timeDelta;o.positionX.linearRampToValueAtTime(e.x,a),o.positionY.linearRampToValueAtTime(e.y,a),o.positionZ.linearRampToValueAtTime(e.z,a),o.orientationX.linearRampToValueAtTime(i.x,a),o.orientationY.linearRampToValueAtTime(i.y,a),o.orientationZ.linearRampToValueAtTime(i.z,a)}else o.setPosition(e.x,e.y,e.z),o.setOrientation(i.x,i.y,i.z)}}()}),Object.assign($i.prototype,{getFrequencyData:function(){return this.analyser.getByteFrequencyData(this.data),this.data},getAverageFrequency:function(){for(var e=0,t=this.getFrequencyData(),r=0;r<t.length;r++)e+=t[r];return e/t.length}}),Object.assign(en.prototype,{accumulate:function(e,t){var r=this.buffer,i=this.valueSize,n=e*i+i,o=this.cumulativeWeight;if(0===o){for(var a=0;a!==i;++a)r[n+a]=r[a];o=t}else{var s=t/(o+=t);this._mixBufferRegion(r,n,0,s,i)}this.cumulativeWeight=o},apply:function(e){var t=this.valueSize,r=this.buffer,i=e*t+t,n=this.cumulativeWeight,o=this.binding;if(this.cumulativeWeight=0,n<1){var a=3*t;this._mixBufferRegion(r,i,a,1-n,t)}for(var s=t,l=t+t;s!==l;++s)if(r[s]!==r[s+t]){o.setValue(r,i);break}},saveOriginalState:function(){var e=this.binding,t=this.buffer,r=this.valueSize,i=3*r;e.getValue(t,i);for(var n=r,o=i;n!==o;++n)t[n]=t[i+n%r];this.cumulativeWeight=0},restoreOriginalState:function(){var e=3*this.valueSize;this.binding.setValue(this.buffer,e)},_select:function(e,t,r,i,n){if(i>=.5)for(var o=0;o!==n;++o)e[t+o]=e[r+o]},_slerp:function(e,t,r,i){n.slerpFlat(e,t,e,t,e,r,i)},_lerp:function(e,t,r,i,n){for(var o=1-i,a=0;a!==n;++a){var s=t+a;e[s]=e[s]*o+e[r+a]*i}}});Object.assign(tn.prototype,{getValue:function(e,t){this.bind();var r=this._targetGroup.nCachedObjects_,i=this._bindings[r];void 0!==i&&i.getValue(e,t)},setValue:function(e,t){for(var r=this._bindings,i=this._targetGroup.nCachedObjects_,n=r.length;i!==n;++i)r[i].setValue(e,t)},bind:function(){for(var e=this._bindings,t=this._targetGroup.nCachedObjects_,r=e.length;t!==r;++t)e[t].bind()},unbind:function(){for(var e=this._bindings,t=this._targetGroup.nCachedObjects_,r=e.length;t!==r;++t)e[t].unbind()}}),Object.assign(rn,{Composite:tn,create:function(e,t,r){return e&&e.isAnimationObjectGroup?new rn.Composite(e,t,r):new rn(e,t,r)},sanitizeNodeName:function(){var e=new RegExp("[\\[\\]\\.:\\/]","g");return function(t){return t.replace(/\s/g,"_").replace(e,"")}}(),parseTrackName:function(){var e="[^\\[\\]\\.:\\/]",t="[^"+"\\[\\]\\.:\\/".replace("\\.","")+"]",r=/((?:WC+[\/:])*)/.source.replace("WC",e),i=/(WCOD+)?/.source.replace("WCOD",t),n=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",e),o=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",e),a=new RegExp("^"+r+i+n+o+"$"),s=["material","materials","bones"];return function(e){var t=a.exec(e);if(!t)throw new Error("PropertyBinding: Cannot parse trackName: "+e);var r={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},i=r.nodeName&&r.nodeName.lastIndexOf(".");if(void 0!==i&&-1!==i){var n=r.nodeName.substring(i+1);-1!==s.indexOf(n)&&(r.nodeName=r.nodeName.substring(0,i),r.objectName=n)}if(null===r.propertyName||0===r.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return r}}(),findNode:function(e,t){if(!t||""===t||"root"===t||"."===t||-1===t||t===e.name||t===e.uuid)return e;if(e.skeleton){var r=e.skeleton.getBoneByName(t);if(void 0!==r)return r}if(e.children){var i=function(e){for(var r=0;r<e.length;r++){var n=e[r];if(n.name===t||n.uuid===t)return n;var o=i(n.children);if(o)return o}return null},n=i(e.children);if(n)return n}return null}}),Object.assign(rn.prototype,{_getValue_unavailable:function(){},_setValue_unavailable:function(){},BindingType:{Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Versioning:{None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},GetterByBindingType:[function(e,t){e[t]=this.node[this.propertyName]},function(e,t){for(var r=this.resolvedProperty,i=0,n=r.length;i!==n;++i)e[t++]=r[i]},function(e,t){e[t]=this.resolvedProperty[this.propertyIndex]},function(e,t){this.resolvedProperty.toArray(e,t)}],SetterByBindingTypeAndVersioning:[[function(e,t){this.targetObject[this.propertyName]=e[t]},function(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0},function(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){for(var r=this.resolvedProperty,i=0,n=r.length;i!==n;++i)r[i]=e[t++]},function(e,t){for(var r=this.resolvedProperty,i=0,n=r.length;i!==n;++i)r[i]=e[t++];this.targetObject.needsUpdate=!0},function(e,t){for(var r=this.resolvedProperty,i=0,n=r.length;i!==n;++i)r[i]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){this.resolvedProperty[this.propertyIndex]=e[t]},function(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0},function(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){this.resolvedProperty.fromArray(e,t)},function(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0},function(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}]],getValue:function(e,t){this.bind(),this.getValue(e,t)},setValue:function(e,t){this.bind(),this.setValue(e,t)},bind:function(){var e=this.node,t=this.parsedPath,r=t.objectName,i=t.propertyName,n=t.propertyIndex;if(e||(e=rn.findNode(this.rootNode,t.nodeName)||this.rootNode,this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,e){if(r){var o=t.objectIndex;switch(r){case"materials":if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);e=e.material.materials;break;case"bones":if(!e.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);e=e.skeleton.bones;for(c=0;c<e.length;c++)if(e[c].name===o){o=c;break}break;default:if(void 0===e[r])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);e=e[r]}if(void 0!==o){if(void 0===e[o])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);e=e[o]}}var a=e[i];if(void 0!==a){var s=this.Versioning.None;this.targetObject=e,void 0!==e.needsUpdate?s=this.Versioning.NeedsUpdate:void 0!==e.matrixWorldNeedsUpdate&&(s=this.Versioning.MatrixWorldNeedsUpdate);var l=this.BindingType.Direct;if(void 0!==n){if("morphTargetInfluences"===i){if(!e.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(e.geometry.isBufferGeometry){if(!e.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);for(c=0;c<this.node.geometry.morphAttributes.position.length;c++)if(e.geometry.morphAttributes.position[c].name===n){n=c;break}}else{if(!e.geometry.morphTargets)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphTargets.",this);for(var c=0;c<this.node.geometry.morphTargets.length;c++)if(e.geometry.morphTargets[c].name===n){n=c;break}}}l=this.BindingType.ArrayElement,this.resolvedProperty=a,this.propertyIndex=n}else void 0!==a.fromArray&&void 0!==a.toArray?(l=this.BindingType.HasFromToArray,this.resolvedProperty=a):Array.isArray(a)?(l=this.BindingType.EntireArray,this.resolvedProperty=a):this.propertyName=i;this.getValue=this.GetterByBindingType[l],this.setValue=this.SetterByBindingTypeAndVersioning[l][s]}else{var u=t.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+u+"."+i+" but it wasn't found.",e)}}else console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.")},unbind:function(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}),Object.assign(rn.prototype,{_getValue_unbound:rn.prototype.getValue,_setValue_unbound:rn.prototype.setValue}),Object.assign(nn.prototype,{isAnimationObjectGroup:!0,add:function(){for(var e=this._objects,t=e.length,r=this.nCachedObjects_,i=this._indicesByUUID,n=this._paths,o=this._parsedPaths,a=this._bindings,s=a.length,l=void 0,c=0,u=arguments.length;c!==u;++c){var h=arguments[c],p=h.uuid,d=i[p];if(void 0===d){d=t++,i[p]=d,e.push(h);for(var f=0,m=s;f!==m;++f)a[f].push(new rn(h,n[f],o[f]))}else if(d<r){l=e[d];var g=--r,v=e[g];i[v.uuid]=d,e[d]=v,i[p]=g,e[g]=h;for(var f=0,m=s;f!==m;++f){var y=a[f],E=y[g],b=y[d];y[d]=E,void 0===b&&(b=new rn(h,n[f],o[f])),y[g]=b}}else e[d]!==l&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=r},remove:function(){for(var e=this._objects,t=this.nCachedObjects_,r=this._indicesByUUID,i=this._bindings,n=i.length,o=0,a=arguments.length;o!==a;++o){var s=arguments[o],l=s.uuid,c=r[l];if(void 0!==c&&c>=t){var u=t++,h=e[u];r[h.uuid]=c,e[c]=h,r[l]=u,e[u]=s;for(var p=0,d=n;p!==d;++p){var f=i[p],m=f[u],g=f[c];f[c]=m,f[u]=g}}}this.nCachedObjects_=t},uncache:function(){for(var e=this._objects,t=e.length,r=this.nCachedObjects_,i=this._indicesByUUID,n=this._bindings,o=n.length,a=0,s=arguments.length;a!==s;++a){var l=arguments[a].uuid,c=i[l];if(void 0!==c)if(delete i[l],c<r){var u=--r,h=e[u],p=e[v=--t];i[h.uuid]=c,e[c]=h,i[p.uuid]=u,e[u]=p,e.pop();for(var d=0,f=o;d!==f;++d){var m=(y=n[d])[u],g=y[v];y[c]=m,y[u]=g,y.pop()}}else{var v=--t;i[(p=e[v]).uuid]=c,e[c]=p,e.pop();for(var d=0,f=o;d!==f;++d){var y=n[d];y[c]=y[v],y.pop()}}}this.nCachedObjects_=r},subscribe_:function(e,t){var r=this._bindingsIndicesByPath,i=r[e],n=this._bindings;if(void 0!==i)return n[i];var o=this._paths,a=this._parsedPaths,s=this._objects,l=s.length,c=this.nCachedObjects_,u=new Array(l);i=n.length,r[e]=i,o.push(e),a.push(t),n.push(u);for(var h=c,p=s.length;h!==p;++h){var d=s[h];u[h]=new rn(d,e,t)}return u},unsubscribe_:function(e){var t=this._bindingsIndicesByPath,r=t[e];if(void 0!==r){var i=this._paths,n=this._parsedPaths,o=this._bindings,a=o.length-1,s=o[a];t[e[a]]=r,o[r]=s,o.pop(),n[r]=n[a],n.pop(),i[r]=i[a],i.pop()}}}),Object.assign(on.prototype,{play:function(){return this._mixer._activateAction(this),this},stop:function(){return this._mixer._deactivateAction(this),this.reset()},reset:function(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()},isRunning:function(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)},isScheduled:function(){return this._mixer._isActiveAction(this)},startAt:function(e){return this._startTime=e,this},setLoop:function(e,t){return this.loop=e,this.repetitions=t,this},setEffectiveWeight:function(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()},getEffectiveWeight:function(){return this._effectiveWeight},fadeIn:function(e){return this._scheduleFading(e,0,1)},fadeOut:function(e){return this._scheduleFading(e,1,0)},crossFadeFrom:function(e,t,r){if(e.fadeOut(t),this.fadeIn(t),r){var i=this._clip.duration,n=e._clip.duration,o=n/i,a=i/n;e.warp(1,o,t),this.warp(a,1,t)}return this},crossFadeTo:function(e,t,r){return e.crossFadeFrom(this,t,r)},stopFading:function(){var e=this._weightInterpolant;return null!==e&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this},setEffectiveTimeScale:function(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()},getEffectiveTimeScale:function(){return this._effectiveTimeScale},setDuration:function(e){return this.timeScale=this._clip.duration/e,this.stopWarping()},syncWith:function(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()},halt:function(e){return this.warp(this._effectiveTimeScale,0,e)},warp:function(e,t,r){var i=this._mixer,n=i.time,o=this._timeScaleInterpolant,a=this.timeScale;null===o&&(o=i._lendControlInterpolant(),this._timeScaleInterpolant=o);var s=o.parameterPositions,l=o.sampleValues;return s[0]=n,s[1]=n+r,l[0]=e/a,l[1]=t/a,this},stopWarping:function(){var e=this._timeScaleInterpolant;return null!==e&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this},getMixer:function(){return this._mixer},getClip:function(){return this._clip},getRoot:function(){return this._localRoot||this._mixer._root},_update:function(e,t,r,i){if(this.enabled){var n=this._startTime;if(null!==n){var o=(e-n)*r;if(o<0||0===r)return;this._startTime=null,t=r*o}t*=this._updateTimeScale(e);var a=this._updateTime(t),s=this._updateWeight(e);if(s>0)for(var l=this._interpolants,c=this._propertyBindings,u=0,h=l.length;u!==h;++u)l[u].evaluate(a),c[u].accumulate(i,s)}else this._updateWeight(e)},_updateWeight:function(e){var t=0;if(this.enabled){t=this.weight;var r=this._weightInterpolant;if(null!==r){var i=r.evaluate(e)[0];t*=i,e>r.parameterPositions[1]&&(this.stopFading(),0===i&&(this.enabled=!1))}}return this._effectiveWeight=t,t},_updateTimeScale:function(e){var t=0;if(!this.paused){t=this.timeScale;var r=this._timeScaleInterpolant;if(null!==r){t*=r.evaluate(e)[0],e>r.parameterPositions[1]&&(this.stopWarping(),0===t?this.paused=!0:this.timeScale=t)}}return this._effectiveTimeScale=t,t},_updateTime:function(e){var t=this.time+e,r=this._clip.duration,i=this.loop,n=this._loopCount,o=2202===i;if(0===e)return-1===n?t:o&&1==(1&n)?r-t:t;if(2200===i){-1===n&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(t>=r)t=r;else{if(!(t<0))break e;t=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(-1===n&&(e>=0?(n=0,this._setEndings(!0,0===this.repetitions,o)):this._setEndings(0===this.repetitions,!0,o)),t>=r||t<0){var a=Math.floor(t/r);t-=r*a,n+=Math.abs(a);var s=this.repetitions-n;if(s<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,t=e>0?r:0,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(1===s){var l=e<0;this._setEndings(l,!l,o)}else this._setEndings(!1,!1,o);this._loopCount=n,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:a})}}if(o&&1==(1&n))return this.time=t,r-t}return this.time=t,t},_setEndings:function(e,t,r){var i=this._interpolantSettings;r?(i.endingStart=2401,i.endingEnd=2401):(i.endingStart=e?this.zeroSlopeAtStart?2401:qa:2402,i.endingEnd=t?this.zeroSlopeAtEnd?2401:qa:2402)},_scheduleFading:function(e,t,r){var i=this._mixer,n=i.time,o=this._weightInterpolant;null===o&&(o=i._lendControlInterpolant(),this._weightInterpolant=o);var a=o.parameterPositions,s=o.sampleValues;return a[0]=n,s[0]=t,a[1]=n+e,s[1]=r,this}}),an.prototype=Object.assign(Object.create(t.prototype),{constructor:an,_bindAction:function(e,t){var r=e._localRoot||this._root,i=e._clip.tracks,n=i.length,o=e._propertyBindings,a=e._interpolants,s=r.uuid,l=this._bindingsByRootAndName,c=l[s];void 0===c&&(c={},l[s]=c);for(var u=0;u!==n;++u){var h=i[u],p=h.name,d=c[p];if(void 0!==d)o[u]=d;else{if(void 0!==(d=o[u])){null===d._cacheIndex&&(++d.referenceCount,this._addInactiveBinding(d,s,p));continue}var f=t&&t._propertyBindings[u].binding.parsedPath;++(d=new en(rn.create(r,p,f),h.ValueTypeName,h.getValueSize())).referenceCount,this._addInactiveBinding(d,s,p),o[u]=d}a[u].resultBuffer=d.buffer}},_activateAction:function(e){if(!this._isActiveAction(e)){if(null===e._cacheIndex){var t=(e._localRoot||this._root).uuid,r=e._clip.uuid,i=this._actionsByClip[r];this._bindAction(e,i&&i.knownActions[0]),this._addInactiveAction(e,r,t)}for(var n=e._propertyBindings,o=0,a=n.length;o!==a;++o){var s=n[o];0==s.useCount++&&(this._lendBinding(s),s.saveOriginalState())}this._lendAction(e)}},_deactivateAction:function(e){if(this._isActiveAction(e)){for(var t=e._propertyBindings,r=0,i=t.length;r!==i;++r){var n=t[r];0==--n.useCount&&(n.restoreOriginalState(),this._takeBackBinding(n))}this._takeBackAction(e)}},_initMemoryManager:function(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;var e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}},_isActiveAction:function(e){var t=e._cacheIndex;return null!==t&&t<this._nActiveActions},_addInactiveAction:function(e,t,r){var i=this._actions,n=this._actionsByClip,o=n[t];if(void 0===o)o={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,n[t]=o;else{var a=o.knownActions;e._byClipCacheIndex=a.length,a.push(e)}e._cacheIndex=i.length,i.push(e),o.actionByRoot[r]=e},_removeInactiveAction:function(e){var t=this._actions,r=t[t.length-1],i=e._cacheIndex;r._cacheIndex=i,t[i]=r,t.pop(),e._cacheIndex=null;var n=e._clip.uuid,o=this._actionsByClip,a=o[n],s=a.knownActions,l=s[s.length-1],c=e._byClipCacheIndex;l._byClipCacheIndex=c,s[c]=l,s.pop(),e._byClipCacheIndex=null;delete a.actionByRoot[(e._localRoot||this._root).uuid],0===s.length&&delete o[n],this._removeInactiveBindingsForAction(e)},_removeInactiveBindingsForAction:function(e){for(var t=e._propertyBindings,r=0,i=t.length;r!==i;++r){var n=t[r];0==--n.referenceCount&&this._removeInactiveBinding(n)}},_lendAction:function(e){var t=this._actions,r=e._cacheIndex,i=this._nActiveActions++,n=t[i];e._cacheIndex=i,t[i]=e,n._cacheIndex=r,t[r]=n},_takeBackAction:function(e){var t=this._actions,r=e._cacheIndex,i=--this._nActiveActions,n=t[i];e._cacheIndex=i,t[i]=e,n._cacheIndex=r,t[r]=n},_addInactiveBinding:function(e,t,r){var i=this._bindingsByRootAndName,n=i[t],o=this._bindings;void 0===n&&(n={},i[t]=n),n[r]=e,e._cacheIndex=o.length,o.push(e)},_removeInactiveBinding:function(e){var t=this._bindings,r=e.binding,i=r.rootNode.uuid,n=r.path,o=this._bindingsByRootAndName,a=o[i],s=t[t.length-1],l=e._cacheIndex;s._cacheIndex=l,t[l]=s,t.pop(),delete a[n];e:{for(var c in a)break e;delete o[i]}},_lendBinding:function(e){var t=this._bindings,r=e._cacheIndex,i=this._nActiveBindings++,n=t[i];e._cacheIndex=i,t[i]=e,n._cacheIndex=r,t[r]=n},_takeBackBinding:function(e){var t=this._bindings,r=e._cacheIndex,i=--this._nActiveBindings,n=t[i];e._cacheIndex=i,t[i]=e,n._cacheIndex=r,t[r]=n},_lendControlInterpolant:function(){var e=this._controlInterpolants,t=this._nActiveControlInterpolants++,r=e[t];return void 0===r&&((r=new Vr(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer)).__cacheIndex=t,e[t]=r),r},_takeBackControlInterpolant:function(e){var t=this._controlInterpolants,r=e.__cacheIndex,i=--this._nActiveControlInterpolants,n=t[i];e.__cacheIndex=i,t[i]=e,n.__cacheIndex=r,t[r]=n},_controlInterpolantsResultBuffer:new Float32Array(1),clipAction:function(e,t){var r=t||this._root,i=r.uuid,n="string"==typeof e?Zr.findByName(r,e):e,o=null!==n?n.uuid:e,a=this._actionsByClip[o],s=null;if(void 0!==a){var l=a.actionByRoot[i];if(void 0!==l)return l;s=a.knownActions[0],null===n&&(n=s._clip)}if(null===n)return null;var c=new on(this,n,t);return this._bindAction(c,s),this._addInactiveAction(c,o,i),c},existingAction:function(e,t){var r=t||this._root,i=r.uuid,n="string"==typeof e?Zr.findByName(r,e):e,o=n?n.uuid:e,a=this._actionsByClip[o];return void 0!==a?a.actionByRoot[i]||null:null},stopAllAction:function(){var e=this._actions,t=this._nActiveActions,r=this._bindings,i=this._nActiveBindings;this._nActiveActions=0,this._nActiveBindings=0;for(n=0;n!==t;++n)e[n].reset();for(var n=0;n!==i;++n)r[n].useCount=0;return this},update:function(e){e*=this.timeScale;for(var t=this._actions,r=this._nActiveActions,i=this.time+=e,n=Math.sign(e),o=this._accuIndex^=1,a=0;a!==r;++a){t[a]._update(i,e,n,o)}for(var s=this._bindings,l=this._nActiveBindings,a=0;a!==l;++a)s[a].apply(o);return this},getRoot:function(){return this._root},uncacheClip:function(e){var t=this._actions,r=e.uuid,i=this._actionsByClip,n=i[r];if(void 0!==n){for(var o=n.knownActions,a=0,s=o.length;a!==s;++a){var l=o[a];this._deactivateAction(l);var c=l._cacheIndex,u=t[t.length-1];l._cacheIndex=null,l._byClipCacheIndex=null,u._cacheIndex=c,t[c]=u,t.pop(),this._removeInactiveBindingsForAction(l)}delete i[r]}},uncacheRoot:function(e){var t=e.uuid,r=this._actionsByClip;for(var i in r){var n=r[i].actionByRoot[t];void 0!==n&&(this._deactivateAction(n),this._removeInactiveAction(n))}var o=this._bindingsByRootAndName[t];if(void 0!==o)for(var a in o){var s=o[a];s.restoreOriginalState(),this._removeInactiveBinding(s)}},uncacheAction:function(e,t){var r=this.existingAction(e,t);null!==r&&(this._deactivateAction(r),this._removeInactiveAction(r))}}),sn.prototype.clone=function(){return new sn(void 0===this.value.clone?this.value:this.value.clone())},ln.prototype=Object.assign(Object.create(N.prototype),{constructor:ln,isInstancedBufferGeometry:!0,copy:function(e){return N.prototype.copy.call(this,e),this.maxInstancedCount=e.maxInstancedCount,this},clone:function(){return(new this.constructor).copy(this)}}),cn.prototype=Object.assign(Object.create(ct.prototype),{constructor:cn,isInstancedInterleavedBuffer:!0,copy:function(e){return ct.prototype.copy.call(this,e),this.meshPerAttribute=e.meshPerAttribute,this}}),un.prototype=Object.assign(Object.create(R.prototype),{constructor:un,isInstancedBufferAttribute:!0,copy:function(e){return R.prototype.copy.call(this,e),this.meshPerAttribute=e.meshPerAttribute,this}}),Object.assign(hn.prototype,{linePrecision:1,set:function(e,t){this.ray.set(e,t)},setFromCamera:function(e,t){t&&t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize()):t&&t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld)):console.error("THREE.Raycaster: Unsupported camera type.")},intersectObject:function(e,t,r){var i=r||[];return dn(e,this,i,t),i.sort(pn),i},intersectObjects:function(e,t,r){var i=r||[];if(!1===Array.isArray(e))return console.warn("THREE.Raycaster.intersectObjects: objects is not an Array."),i;for(var n=0,o=e.length;n<o;n++)dn(e[n],this,i,t);return i.sort(pn),i}}),Object.assign(fn.prototype,{set:function(e,t,r){return this.radius=e,this.phi=t,this.theta=r,this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this},makeSafe:function(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this},setFromVector3:function(e){return this.setFromCartesianCoords(e.x,e.y,e.z)},setFromCartesianCoords:function(e,t,r){return this.radius=Math.sqrt(e*e+t*t+r*r),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,r),this.phi=Math.acos(os.clamp(t/this.radius,-1,1))),this}}),Object.assign(mn.prototype,{set:function(e,t,r){return this.radius=e,this.theta=t,this.y=r,this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this},setFromVector3:function(e){return this.setFromCartesianCoords(e.x,e.y,e.z)},setFromCartesianCoords:function(e,t,r){return this.radius=Math.sqrt(e*e+r*r),this.theta=Math.atan2(e,r),this.y=t,this}}),Object.assign(gn.prototype,{set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromPoints:function(e){this.makeEmpty();for(var t=0,r=e.length;t<r;t++)this.expandByPoint(e[t]);return this},setFromCenterAndSize:function(){var e=new r;return function(t,r){var i=e.copy(r).multiplyScalar(.5);return this.min.copy(t).sub(i),this.max.copy(t).add(i),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},getCenter:function(e){return void 0===e&&(console.warn("THREE.Box2: .getCenter() target is now required"),e=new r),this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(e){return void 0===e&&(console.warn("THREE.Box2: .getSize() target is now required"),e=new r),this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},containsPoint:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y},getParameter:function(e,t){return void 0===t&&(console.warn("THREE.Box2: .getParameter() target is now required"),t=new r),t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))},intersectsBox:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)},clampPoint:function(e,t){return void 0===t&&(console.warn("THREE.Box2: .clampPoint() target is now required"),t=new r),t.copy(e).clamp(this.min,this.max)},distanceToPoint:function(){var e=new r;return function(t){return e.copy(t).clamp(this.min,this.max).sub(t).length()}}(),intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}),Object.assign(vn.prototype,{set:function(e,t){return this.start.copy(e),this.end.copy(t),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.start.copy(e.start),this.end.copy(e.end),this},getCenter:function(e){return void 0===e&&(console.warn("THREE.Line3: .getCenter() target is now required"),e=new o),e.addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(e){return void 0===e&&(console.warn("THREE.Line3: .delta() target is now required"),e=new o),e.subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(e,t){return void 0===t&&(console.warn("THREE.Line3: .at() target is now required"),t=new o),this.delta(t).multiplyScalar(e).add(this.start)},closestPointToPointParameter:function(){var e=new o,t=new o;return function(r,i){e.subVectors(r,this.start),t.subVectors(this.end,this.start);var n=t.dot(t),o=t.dot(e)/n;return i&&(o=os.clamp(o,0,1)),o}}(),closestPointToPoint:function(e,t,r){var i=this.closestPointToPointParameter(e,t);return void 0===r&&(console.warn("THREE.Line3: .closestPointToPoint() target is now required"),r=new o),this.delta(r).multiplyScalar(i).add(this.start)},applyMatrix4:function(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this},equals:function(e){return e.start.equals(this.start)&&e.end.equals(this.end)}}),(yn.prototype=Object.create(T.prototype)).constructor=yn,yn.prototype.isImmediateRenderObject=!0,(En.prototype=Object.create(Et.prototype)).constructor=En,En.prototype.update=function(){var e=new o,t=new o,r=new a;return function(){var i=["a","b","c"];this.object.updateMatrixWorld(!0),r.getNormalMatrix(this.object.matrixWorld);var n=this.object.matrixWorld,o=this.geometry.attributes.position,a=this.object.geometry;if(a&&a.isGeometry)for(var s=a.vertices,l=a.faces,c=0,u=0,h=l.length;u<h;u++)for(var p=l[u],d=0,f=p.vertexNormals.length;d<f;d++){var m=s[p[i[d]]],g=p.vertexNormals[d];e.copy(m).applyMatrix4(n),t.copy(g).applyMatrix3(r).normalize().multiplyScalar(this.size).add(e),o.setXYZ(c,e.x,e.y,e.z),c+=1,o.setXYZ(c,t.x,t.y,t.z),c+=1}else if(a&&a.isBufferGeometry)for(var v=a.attributes.position,y=a.attributes.normal,c=0,d=0,f=v.count;d<f;d++)e.set(v.getX(d),v.getY(d),v.getZ(d)).applyMatrix4(n),t.set(y.getX(d),y.getY(d),y.getZ(d)),t.applyMatrix3(r).normalize().multiplyScalar(this.size).add(e),o.setXYZ(c,e.x,e.y,e.z),c+=1,o.setXYZ(c,t.x,t.y,t.z),c+=1;o.needsUpdate=!0}}(),(bn.prototype=Object.create(T.prototype)).constructor=bn,bn.prototype.dispose=function(){this.cone.geometry.dispose(),this.cone.material.dispose()},bn.prototype.update=function(){var e=new o;return function(){this.light.updateMatrixWorld();var t=this.light.distance?this.light.distance:1e3,r=t*Math.tan(this.light.angle);this.cone.scale.set(r,r,t),e.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(e),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}(),(_n.prototype=Object.create(Et.prototype)).constructor=_n,_n.prototype.updateMatrixWorld=function(){var e=new o,t=new i,r=new i;return function(i){var n=this.bones,o=this.geometry,a=o.getAttribute("position");r.getInverse(this.root.matrixWorld);for(var s=0,l=0;s<n.length;s++){var c=n[s];c.parent&&c.parent.isBone&&(t.multiplyMatrices(r,c.matrixWorld),e.setFromMatrixPosition(t),a.setXYZ(l,e.x,e.y,e.z),t.multiplyMatrices(r,c.parent.matrixWorld),e.setFromMatrixPosition(t),a.setXYZ(l+1,e.x,e.y,e.z),l+=2)}o.getAttribute("position").needsUpdate=!0,T.prototype.updateMatrixWorld.call(this,i)}}(),(wn.prototype=Object.create(Y.prototype)).constructor=wn,wn.prototype.dispose=function(){this.geometry.dispose(),this.material.dispose()},wn.prototype.update=function(){void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)},(Tn.prototype=Object.create(T.prototype)).constructor=Tn,Tn.prototype.dispose=function(){this.children[0].geometry.dispose(),this.children[0].material.dispose()},Tn.prototype.update=function(){var e=.5*this.light.width,t=.5*this.light.height,r=this.line.geometry.attributes.position,i=r.array;i[0]=e,i[1]=-t,i[2]=0,i[3]=e,i[4]=t,i[5]=0,i[6]=-e,i[7]=t,i[8]=0,i[9]=-e,i[10]=-t,i[11]=0,i[12]=e,i[13]=-t,i[14]=0,r.needsUpdate=!0,void 0!==this.color?this.line.material.color.set(this.color):this.line.material.color.copy(this.light.color)},(Mn.prototype=Object.create(T.prototype)).constructor=Mn,Mn.prototype.dispose=function(){this.children[0].geometry.dispose(),this.children[0].material.dispose()},Mn.prototype.update=function(){var e=new o,t=new y,r=new y;return function(){var i=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{var n=i.geometry.getAttribute("color");t.copy(this.light.color),r.copy(this.light.groundColor);for(var o=0,a=n.count;o<a;o++){var s=o<a/2?t:r;n.setXYZ(o,s.r,s.g,s.b)}n.needsUpdate=!0}i.lookAt(e.setFromMatrixPosition(this.light.matrixWorld).negate())}}(),(Rn.prototype=Object.create(Et.prototype)).constructor=Rn,(Sn.prototype=Object.create(Et.prototype)).constructor=Sn,(Pn.prototype=Object.create(Et.prototype)).constructor=Pn,Pn.prototype.update=function(){var e=new o,t=new o,r=new a;return function(){this.object.updateMatrixWorld(!0),r.getNormalMatrix(this.object.matrixWorld);for(var i=this.object.matrixWorld,n=this.geometry.attributes.position,o=this.object.geometry,a=o.vertices,s=o.faces,l=0,c=0,u=s.length;c<u;c++){var h=s[c],p=h.normal;e.copy(a[h.a]).add(a[h.b]).add(a[h.c]).divideScalar(3).applyMatrix4(i),t.copy(p).applyMatrix3(r).normalize().multiplyScalar(this.size).add(e),n.setXYZ(l,e.x,e.y,e.z),l+=1,n.setXYZ(l,t.x,t.y,t.z),l+=1}n.needsUpdate=!0}}(),(An.prototype=Object.create(T.prototype)).constructor=An,An.prototype.dispose=function(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()},An.prototype.update=function(){var e=new o,t=new o,r=new o;return function(){e.setFromMatrixPosition(this.light.matrixWorld),t.setFromMatrixPosition(this.light.target.matrixWorld),r.subVectors(t,e),this.lightPlane.lookAt(t),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(t),this.targetLine.scale.z=r.length()}}(),(Cn.prototype=Object.create(Et.prototype)).constructor=Cn,Cn.prototype.update=function(){function e(e,o,a,s){i.set(o,a,s).unproject(n);var l=r[e];if(void 0!==l)for(var c=t.getAttribute("position"),u=0,h=l.length;u<h;u++)c.setXYZ(l[u],i.x,i.y,i.z)}var t,r,i=new o,n=new et;return function(){t=this.geometry,r=this.pointMap;n.projectionMatrix.copy(this.camera.projectionMatrix),e("c",0,0,-1),e("t",0,0,1),e("n1",-1,-1,-1),e("n2",1,-1,-1),e("n3",-1,1,-1),e("n4",1,1,-1),e("f1",-1,-1,1),e("f2",1,-1,1),e("f3",-1,1,1),e("f4",1,1,1),e("u1",.7,1.1,-1),e("u2",-.7,1.1,-1),e("u3",0,2,-1),e("cf1",-1,0,1),e("cf2",1,0,1),e("cf3",0,-1,1),e("cf4",0,1,1),e("cn1",-1,0,-1),e("cn2",1,0,-1),e("cn3",0,-1,-1),e("cn4",0,1,-1),t.getAttribute("position").needsUpdate=!0}}(),(Ln.prototype=Object.create(Et.prototype)).constructor=Ln,Ln.prototype.update=function(){var e=new p;return function(t){if(void 0!==t&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),void 0!==this.object&&e.setFromObject(this.object),!e.isEmpty()){var r=e.min,i=e.max,n=this.geometry.attributes.position,o=n.array;o[0]=i.x,o[1]=i.y,o[2]=i.z,o[3]=r.x,o[4]=i.y,o[5]=i.z,o[6]=r.x,o[7]=r.y,o[8]=i.z,o[9]=i.x,o[10]=r.y,o[11]=i.z,o[12]=i.x,o[13]=i.y,o[14]=r.z,o[15]=r.x,o[16]=i.y,o[17]=r.z,o[18]=r.x,o[19]=r.y,o[20]=r.z,o[21]=i.x,o[22]=r.y,o[23]=r.z,n.needsUpdate=!0,this.geometry.computeBoundingSphere()}}}(),Ln.prototype.setFromObject=function(e){return this.object=e,this.update(),this},Ln.prototype.copy=function(e){return Et.prototype.copy.call(this,e),this.object=e.object,this},Ln.prototype.clone=function(){return(new this.constructor).copy(this)},(On.prototype=Object.create(Et.prototype)).constructor=On,On.prototype.updateMatrixWorld=function(e){var t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),T.prototype.updateMatrixWorld.call(this,e))},(Hn.prototype=Object.create(yt.prototype)).constructor=Hn,Hn.prototype.updateMatrixWorld=function(e){var t=-this.plane.constant;Math.abs(t)<1e-8&&(t=1e-8),this.scale.set(.5*this.size,.5*this.size,t),this.children[0].material.side=t<0?Wn:Gn,this.lookAt(this.plane.normal),T.prototype.updateMatrixWorld.call(this,e)};var $s,el;(Fn.prototype=Object.create(T.prototype)).constructor=Fn,Fn.prototype.setDirection=function(){var e,t=new o;return function(r){r.y>.99999?this.quaternion.set(0,0,0,1):r.y<-.99999?this.quaternion.set(1,0,0,0):(t.set(r.z,0,-r.x).normalize(),e=Math.acos(r.y),this.quaternion.setFromAxisAngle(t,e))}}(),Fn.prototype.setLength=function(e,t,r){void 0===t&&(t=.2*e),void 0===r&&(r=.2*t),this.line.scale.set(1,Math.max(0,e-t),1),this.line.updateMatrix(),this.cone.scale.set(r,t,r),this.cone.position.y=e,this.cone.updateMatrix()},Fn.prototype.setColor=function(e){this.line.material.color.copy(e),this.cone.material.color.copy(e)},Fn.prototype.copy=function(e){return T.prototype.copy.call(this,e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this},Fn.prototype.clone=function(){return(new this.constructor).copy(this)},(In.prototype=Object.create(Et.prototype)).constructor=In;li.create=function(e,t){return console.log("THREE.Curve.create() has been deprecated"),e.prototype=Object.create(li.prototype),e.prototype.constructor=e,e.prototype.getPoint=t,e},Object.assign(wi.prototype,{createPointsGeometry:function(e){console.warn("THREE.CurvePath: .createPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");var t=this.getPoints(e);return this.createGeometry(t)},createSpacedPointsGeometry:function(e){console.warn("THREE.CurvePath: .createSpacedPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");var t=this.getSpacedPoints(e);return this.createGeometry(t)},createGeometry:function(e){console.warn("THREE.CurvePath: .createGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");for(var t=new M,r=0,i=e.length;r<i;r++){var n=e[r];t.vertices.push(new o(n.x,n.y,n.z||0))}return t}}),Object.assign(Ti.prototype,{fromPoints:function(e){console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(e)}}),kn.prototype=Object.create(pi.prototype),Dn.prototype=Object.create(pi.prototype),Nn.prototype=Object.create(pi.prototype),Object.assign(Nn.prototype,{initFromArray:function(){console.error("THREE.Spline: .initFromArray() has been removed.")},getControlPointsArray:function(){console.error("THREE.Spline: .getControlPointsArray() has been removed.")},reparametrizeByArcLength:function(){console.error("THREE.Spline: .reparametrizeByArcLength() has been removed.")}}),Rn.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")},_n.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")},Object.assign(Gi.prototype,{extractUrlBase:function(e){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),Ws.extractUrlBase(e)}}),Object.assign(ji.prototype,{setTexturePath:function(e){return console.warn("THREE.ObjectLoader: .setTexturePath() has been renamed to .setResourcePath()."),this.setResourcePath(e)}}),Object.assign(gn.prototype,{center:function(e){return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),this.getCenter(e)},empty:function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(e){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},size:function(e){return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),this.getSize(e)}}),Object.assign(p.prototype,{center:function(e){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(e)},empty:function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(e){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},isIntersectionSphere:function(e){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)},size:function(e){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(e)}}),vn.prototype.center=function(e){return console.warn("THREE.Line3: .center() has been renamed to .getCenter()."),this.getCenter(e)},Object.assign(os,{random16:function(){return console.warn("THREE.Math: .random16() has been deprecated. Use Math.random() instead."),Math.random()},nearestPowerOfTwo:function(e){return console.warn("THREE.Math: .nearestPowerOfTwo() has been renamed to .floorPowerOfTwo()."),os.floorPowerOfTwo(e)},nextPowerOfTwo:function(e){return console.warn("THREE.Math: .nextPowerOfTwo() has been renamed to .ceilPowerOfTwo()."),os.ceilPowerOfTwo(e)}}),Object.assign(a.prototype,{flattenToArrayOffset:function(e,t){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},multiplyVector3:function(e){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},multiplyVector3Array:function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},applyToBuffer:function(e){return console.warn("THREE.Matrix3: .applyToBuffer() has been removed. Use matrix.applyToBufferAttribute( attribute ) instead."),this.applyToBufferAttribute(e)},applyToVector3Array:function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")}}),Object.assign(i.prototype,{extractPosition:function(e){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(e)},flattenToArrayOffset:function(e,t){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},getPosition:function(){var e;return function(){return void 0===e&&(e=new o),console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),e.setFromMatrixColumn(this,3)}}(),setRotationFromQuaternion:function(e){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(e)},multiplyToArray:function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},multiplyVector3:function(e){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},multiplyVector4:function(e){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},multiplyVector3Array:function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},rotateAxis:function(e){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),e.transformDirection(this)},crossVector:function(e){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},translate:function(){console.error("THREE.Matrix4: .translate() has been removed.")},rotateX:function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},rotateByAxis:function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},applyToBuffer:function(e){return console.warn("THREE.Matrix4: .applyToBuffer() has been removed. Use matrix.applyToBufferAttribute( attribute ) instead."),this.applyToBufferAttribute(e)},applyToVector3Array:function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},makeFrustum:function(e,t,r,i,n,o){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(e,t,i,r,n,o)}}),f.prototype.isIntersectionLine=function(e){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(e)},n.prototype.multiplyVector3=function(e){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),e.applyQuaternion(this)},Object.assign(G.prototype,{isIntersectionBox:function(e){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},isIntersectionPlane:function(e){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(e)},isIntersectionSphere:function(e){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)}}),Object.assign(W.prototype,{area:function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()},barycoordFromPoint:function(e,t){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(e,t)},midpoint:function(e){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(e)},normal:function(e){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(e)},plane:function(e){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(e)}}),Object.assign(W,{barycoordFromPoint:function(e,t,r,i,n){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),W.getBarycoord(e,t,r,i,n)},normal:function(e,t,r,i){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),W.getNormal(e,t,r,i)}}),Object.assign(Mi.prototype,{extractAllPoints:function(e){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(e)},extrude:function(e){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new cr(this,e)},makeGeometry:function(e){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new br(this,e)}}),Object.assign(r.prototype,{fromAttribute:function(e,t,r){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,r)},distanceToManhattan:function(e){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},lengthManhattan:function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(o.prototype,{setEulerFromRotationMatrix:function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(e){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(e)},getScaleFromMatrix:function(e){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(e)},getColumnFromMatrix:function(e,t){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(t,e)},applyProjection:function(e){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(e)},fromAttribute:function(e,t,r){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,r)},distanceToManhattan:function(e){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},lengthManhattan:function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(l.prototype,{fromAttribute:function(e,t,r){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,r)},lengthManhattan:function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(M.prototype,{computeTangents:function(){console.error("THREE.Geometry: .computeTangents() has been removed.")},computeLineDistances:function(){console.error("THREE.Geometry: .computeLineDistances() has been removed. Use THREE.Line.computeLineDistances() instead.")}}),Object.assign(T.prototype,{getChildByName:function(e){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(e)},renderDepth:function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},translate:function(e,t){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(t,e)},getWorldRotation:function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")}}),Object.defineProperties(T.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(e){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=e}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),Object.defineProperties(dt.prototype,{objects:{get:function(){return console.warn("THREE.LOD: .objects has been renamed to .levels."),this.levels}}}),Object.defineProperty(mt.prototype,"useVertexTexture",{get:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")},set:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")}}),ft.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")},Object.defineProperty(li.prototype,"__arcLengthDivisions",{get:function(){return console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions},set:function(e){console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions=e}}),tt.prototype.setLens=function(e,t){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),void 0!==t&&(this.filmGauge=t),this.setFocalLength(e)},Object.defineProperties(Ri.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(e){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=e}},shadowCameraLeft:{set:function(e){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=e}},shadowCameraRight:{set:function(e){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=e}},shadowCameraTop:{set:function(e){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=e}},shadowCameraBottom:{set:function(e){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=e}},shadowCameraNear:{set:function(e){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=e}},shadowCameraFar:{set:function(e){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=e}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(e){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=e}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(e){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=e}},shadowMapHeight:{set:function(e){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=e}}}),Object.defineProperties(R.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},copyIndicesArray:function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")}}),Object.assign(N.prototype,{addIndex:function(e){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(e)},addDrawCall:function(e,t,r){void 0!==r&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(e,t)},clearDrawCalls:function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},computeTangents:function(){console.warn("THREE.BufferGeometry: .computeTangents() has been removed.")},computeOffsets:function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")}}),Object.defineProperties(N.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),Object.assign(ur.prototype,{getArrays:function(){console.error("THREE.ExtrudeBufferGeometry: .getArrays() has been removed.")},addShapeList:function(){console.error("THREE.ExtrudeBufferGeometry: .addShapeList() has been removed.")},addShape:function(){console.error("THREE.ExtrudeBufferGeometry: .addShape() has been removed.")}}),Object.defineProperties(sn.prototype,{dynamic:{set:function(){console.warn("THREE.Uniform: .dynamic has been removed. Use object.onBeforeRender() instead.")}},onUpdate:{value:function(){return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this}}}),Object.defineProperties(z.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new y}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(e){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===e}}}),Object.defineProperties(Fr.prototype,{metal:{get:function(){return console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead."),!1},set:function(){console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead")}}}),Object.defineProperties(q.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(e){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=e}}}),Object.assign(ot.prototype,{clearTarget:function(e,t,r,i){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(e),this.clear(t,r,i)},animate:function(e){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(e)},getCurrentRenderTarget:function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},getMaxAnisotropy:function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()},getPrecision:function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision},resetGLState:function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()},supportsFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},supportsHalfFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},supportsStandardDerivatives:function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},supportsCompressedTextureS3TC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},supportsCompressedTexturePVRTC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},supportsBlendMinMax:function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},supportsVertexTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},supportsInstancedArrays:function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},enableScissorTest:function(e){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(e)},initMaterial:function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},addPrePlugin:function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},addPostPlugin:function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},updateShadowMap:function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},setFaceCulling:function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")}}),Object.defineProperties(ot.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=e}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=e}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(Je.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(c.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=e}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=e}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=e}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=e}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(e){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=e}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(e){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=e}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(e){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=e}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(e){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=e}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(e){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=e}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(e){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=e}}}),Object.defineProperties(nt.prototype,{standing:{set:function(){console.warn("THREE.WebVRManager: .standing has been removed.")}},userHeight:{set:function(){console.warn("THREE.WebVRManager: .userHeight has been removed.")}}}),Ki.prototype.load=function(e){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");var t=this;return(new Wi).load(e,function(e){t.setBuffer(e)}),this},$i.prototype.getData=function(){return console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData()."),this.getFrequencyData()},Yi.prototype.updateCubeMap=function(e,t){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(e,t)};var tl={merge:function(e,t,r){console.warn("THREE.GeometryUtils: .merge() has been moved to Geometry. Use geometry.merge( geometry2, matrix, materialIndexOffset ) instead.");var i;t.isMesh&&(t.matrixAutoUpdate&&t.updateMatrix(),i=t.matrix,t=t.geometry),e.merge(t,i,r)},center:function(e){return console.warn("THREE.GeometryUtils: .center() has been moved to Geometry. Use geometry.center() instead."),e.center()}};ss.crossOrigin=void 0,ss.loadTexture=function(e,t,r,i){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");var n=new si;n.setCrossOrigin(this.crossOrigin);var o=n.load(e,r,void 0,i);return t&&(o.mapping=t),o},ss.loadTextureCube=function(e,t,r,i){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");var n=new ai;n.setCrossOrigin(this.crossOrigin);var o=n.load(e,r,void 0,i);return t&&(o.mapping=t),o},ss.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},ss.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")};var rl={createMultiMaterialObject:function(){console.error("THREE.SceneUtils has been moved to /examples/js/utils/SceneUtils.js")},detach:function(){console.error("THREE.SceneUtils has been moved to /examples/js/utils/SceneUtils.js")},attach:function(){console.error("THREE.SceneUtils has been moved to /examples/js/utils/SceneUtils.js")}};e.WebGLRenderTargetCube=u,e.WebGLRenderTarget=c,e.WebGLRenderer=ot,e.ShaderLib=ds,e.UniformsLib=ps,e.UniformsUtils=us,e.ShaderChunk=cs,e.FogExp2=at,e.Fog=st,e.Scene=lt,e.Sprite=pt,e.LOD=dt,e.SkinnedMesh=ft,e.Skeleton=mt,e.Bone=gt,e.Mesh=Y,e.LineSegments=Et,e.LineLoop=bt,e.Line=yt,e.Points=_t,e.Group=$e,e.VideoTexture=wt,e.DataTexture=h,e.DataTexture3D=K,e.CompressedTexture=Tt,e.CubeTexture=J,e.CanvasTexture=Mt,e.DepthTexture=Rt,e.Texture=s,e.AnimationLoader=ri,e.CompressedTextureLoader=ii,e.DataTextureLoader=ni,e.CubeTextureLoader=ai,e.TextureLoader=si,e.ObjectLoader=ji,e.MaterialLoader=Di,e.BufferGeometryLoader=Ni,e.DefaultLoadingManager=js,e.LoadingManager=ei,e.ImageLoader=oi,e.ImageBitmapLoader=Ui,e.FontLoader=qi,e.FileLoader=ti,e.Loader=Gi,e.LoaderUtils=Ws,e.Cache=Ns,e.AudioLoader=Wi,e.SpotLightShadow=Ai,e.SpotLight=Ci,e.PointLight=Li,e.RectAreaLight=ki,e.HemisphereLight=Si,e.DirectionalLightShadow=Hi,e.DirectionalLight=Fi,e.AmbientLight=Ii,e.LightShadow=Pi,e.Light=Ri,e.StereoCamera=Xi,e.PerspectiveCamera=tt,e.OrthographicCamera=Oi,e.CubeCamera=Yi,e.ArrayCamera=rt,e.Camera=et,e.AudioListener=Ji,e.PositionalAudio=Zi,e.AudioContext=Zs,e.AudioAnalyser=$i,e.Audio=Ki,e.VectorKeyframeTrack=Kr,e.StringKeyframeTrack=Jr,e.QuaternionKeyframeTrack=Qr,e.NumberKeyframeTrack=Xr,e.ColorKeyframeTrack=Wr,e.BooleanKeyframeTrack=Gr,e.PropertyMixer=en,e.PropertyBinding=rn,e.KeyframeTrack=qr,e.AnimationUtils=Ds,e.AnimationObjectGroup=nn,e.AnimationMixer=an,e.AnimationClip=Zr,e.Uniform=sn,e.InstancedBufferGeometry=ln,e.BufferGeometry=N,e.Geometry=M,e.InterleavedBufferAttribute=ut,e.InstancedInterleavedBuffer=cn,e.InterleavedBuffer=ct,e.InstancedBufferAttribute=un,e.Face3=x,e.Object3D=T,e.Raycaster=hn,e.Layers=w,e.EventDispatcher=t,e.Clock=Qi,e.QuaternionLinearInterpolant=Yr,e.LinearInterpolant=Vr,e.DiscreteInterpolant=zr,e.CubicInterpolant=Br,e.Interpolant=Ur,e.Triangle=W,e.Math=os,e.Spherical=fn,e.Cylindrical=mn,e.Plane=f,e.Frustum=m,e.Sphere=d,e.Ray=G,e.Matrix4=i,e.Matrix3=a,e.Box3=p,e.Box2=gn,e.Line3=vn,e.Euler=_,e.Vector4=l,e.Vector3=o,e.Vector2=r,e.Quaternion=n,e.Color=y,e.ImmediateRenderObject=yn,e.VertexNormalsHelper=En,e.SpotLightHelper=bn,e.SkeletonHelper=_n,e.PointLightHelper=wn,e.RectAreaLightHelper=Tn,e.HemisphereLightHelper=Mn,e.GridHelper=Rn,e.PolarGridHelper=Sn,e.FaceNormalsHelper=Pn,e.DirectionalLightHelper=An,e.CameraHelper=Cn,e.BoxHelper=Ln,e.Box3Helper=On,e.PlaneHelper=Hn,e.ArrowHelper=Fn,e.AxesHelper=In,e.Shape=Mi,e.Path=Ti,e.ShapePath=Bi,e.Font=Vi,e.CurvePath=wi,e.Curve=li,e.ImageUtils=ss,e.ShapeUtils=Hs,e.WebGLUtils=Ze,e.WireframeGeometry=St,e.ParametricGeometry=Pt,e.ParametricBufferGeometry=At,e.TetrahedronGeometry=Ot,e.TetrahedronBufferGeometry=Ht,e.OctahedronGeometry=Ft,e.OctahedronBufferGeometry=It,e.IcosahedronGeometry=kt,e.IcosahedronBufferGeometry=Dt,e.DodecahedronGeometry=Nt,e.DodecahedronBufferGeometry=jt,e.PolyhedronGeometry=Ct,e.PolyhedronBufferGeometry=Lt,e.TubeGeometry=Ut,e.TubeBufferGeometry=Bt,e.TorusKnotGeometry=Vt,e.TorusKnotBufferGeometry=zt,e.TorusGeometry=qt,e.TorusBufferGeometry=Gt,e.TextGeometry=pr,e.TextBufferGeometry=dr,e.SphereGeometry=fr,e.SphereBufferGeometry=mr,e.RingGeometry=gr,e.RingBufferGeometry=vr,e.PlaneGeometry=B,e.PlaneBufferGeometry=V,e.LatheGeometry=yr,e.LatheBufferGeometry=Er,e.ShapeGeometry=br,e.ShapeBufferGeometry=xr,e.ExtrudeGeometry=cr,e.ExtrudeBufferGeometry=ur,e.EdgesGeometry=wr,e.ConeGeometry=Rr,e.ConeBufferGeometry=Sr,e.CylinderGeometry=Tr,e.CylinderBufferGeometry=Mr,e.CircleGeometry=Pr,e.CircleBufferGeometry=Ar,e.BoxGeometry=j,e.BoxBufferGeometry=U,e.ShadowMaterial=Cr,e.SpriteMaterial=ht,e.RawShaderMaterial=Lr,e.ShaderMaterial=q,e.PointsMaterial=xt,e.MeshPhysicalMaterial=Hr,e.MeshStandardMaterial=Or,e.MeshPhongMaterial=Fr,e.MeshToonMaterial=Ir,e.MeshNormalMaterial=kr,e.MeshLambertMaterial=Dr,e.MeshDepthMaterial=Ye,e.MeshDistanceMaterial=Qe,e.MeshBasicMaterial=X,e.MeshMatcapMaterial=Nr,e.LineDashedMaterial=jr,e.LineBasicMaterial=vt,e.Material=z,e.Float64BufferAttribute=I,e.Float32BufferAttribute=F,e.Uint32BufferAttribute=H,e.Int32BufferAttribute=O,e.Uint16BufferAttribute=L,e.Int16BufferAttribute=C,e.Uint8ClampedBufferAttribute=A,e.Uint8BufferAttribute=P,e.Int8BufferAttribute=S,e.BufferAttribute=R,e.ArcCurve=ui,e.CatmullRomCurve3=pi,e.CubicBezierCurve=gi,e.CubicBezierCurve3=vi,e.EllipseCurve=ci,e.LineCurve=yi,e.LineCurve3=Ei,e.QuadraticBezierCurve=bi,e.QuadraticBezierCurve3=xi,e.SplineCurve=_i,e.REVISION=jn,e.MOUSE={LEFT:0,MIDDLE:1,RIGHT:2},e.CullFaceNone=Un,e.CullFaceBack=Bn,e.CullFaceFront=Vn,e.CullFaceFrontBack=3,e.FrontFaceDirectionCW=0,e.FrontFaceDirectionCCW=1,e.BasicShadowMap=0,e.PCFShadowMap=zn,e.PCFSoftShadowMap=qn,e.FrontSide=Gn,e.BackSide=Wn,e.DoubleSide=Xn,e.FlatShading=1,e.SmoothShading=2,e.NoColors=Yn,e.FaceColors=Qn,e.VertexColors=Jn,e.NoBlending=Kn,e.NormalBlending=Zn,e.AdditiveBlending=$n,e.SubtractiveBlending=eo,e.MultiplyBlending=to,e.CustomBlending=ro,e.AddEquation=io,e.SubtractEquation=no,e.ReverseSubtractEquation=oo,e.MinEquation=ao,e.MaxEquation=so,e.ZeroFactor=lo,e.OneFactor=co,e.SrcColorFactor=uo,e.OneMinusSrcColorFactor=ho,e.SrcAlphaFactor=po,e.OneMinusSrcAlphaFactor=fo,e.DstAlphaFactor=mo,e.OneMinusDstAlphaFactor=go,e.DstColorFactor=vo,e.OneMinusDstColorFactor=yo,e.SrcAlphaSaturateFactor=Eo,e.NeverDepth=bo,e.AlwaysDepth=xo,e.LessDepth=_o,e.LessEqualDepth=wo,e.EqualDepth=To,e.GreaterEqualDepth=Mo,e.GreaterDepth=Ro,e.NotEqualDepth=So,e.MultiplyOperation=Po,e.MixOperation=Ao,e.AddOperation=Co,e.NoToneMapping=Lo,e.LinearToneMapping=Oo,e.ReinhardToneMapping=Ho,e.Uncharted2ToneMapping=Fo,e.CineonToneMapping=Io,e.ACESFilmicToneMapping=ko,e.UVMapping=300,e.CubeReflectionMapping=Do,e.CubeRefractionMapping=No,e.EquirectangularReflectionMapping=jo,e.EquirectangularRefractionMapping=Uo,e.SphericalReflectionMapping=Bo,e.CubeUVReflectionMapping=Vo,e.CubeUVRefractionMapping=zo,e.RepeatWrapping=qo,e.ClampToEdgeWrapping=Go,e.MirroredRepeatWrapping=Wo,e.NearestFilter=Xo,e.NearestMipMapNearestFilter=Yo,e.NearestMipMapLinearFilter=Qo,e.LinearFilter=Jo,e.LinearMipMapNearestFilter=Ko,e.LinearMipMapLinearFilter=Zo,e.UnsignedByteType=$o,e.ByteType=ea,e.ShortType=ta,e.UnsignedShortType=ra,e.IntType=ia,e.UnsignedIntType=na,e.FloatType=oa,e.HalfFloatType=aa,e.UnsignedShort4444Type=sa,e.UnsignedShort5551Type=la,e.UnsignedShort565Type=ca,e.UnsignedInt248Type=ua,e.AlphaFormat=ha,e.RGBFormat=pa,e.RGBAFormat=da,e.LuminanceFormat=fa,e.LuminanceAlphaFormat=ma,e.RGBEFormat=ga,e.DepthFormat=va,e.DepthStencilFormat=ya,e.RedFormat=Ea,e.RGB_S3TC_DXT1_Format=ba,e.RGBA_S3TC_DXT1_Format=xa,e.RGBA_S3TC_DXT3_Format=_a,e.RGBA_S3TC_DXT5_Format=wa,e.RGB_PVRTC_4BPPV1_Format=Ta,e.RGB_PVRTC_2BPPV1_Format=Ma,e.RGBA_PVRTC_4BPPV1_Format=Ra,e.RGBA_PVRTC_2BPPV1_Format=Sa,e.RGB_ETC1_Format=Pa,e.RGBA_ASTC_4x4_Format=Aa,e.RGBA_ASTC_5x4_Format=Ca,e.RGBA_ASTC_5x5_Format=La,e.RGBA_ASTC_6x5_Format=Oa,e.RGBA_ASTC_6x6_Format=Ha,e.RGBA_ASTC_8x5_Format=Fa,e.RGBA_ASTC_8x6_Format=Ia,e.RGBA_ASTC_8x8_Format=ka,e.RGBA_ASTC_10x5_Format=Da,e.RGBA_ASTC_10x6_Format=Na,e.RGBA_ASTC_10x8_Format=ja,e.RGBA_ASTC_10x10_Format=Ua,e.RGBA_ASTC_12x10_Format=Ba,e.RGBA_ASTC_12x12_Format=Va,e.LoopOnce=2200,e.LoopRepeat=za,e.LoopPingPong=2202,e.InterpolateDiscrete=2300,e.InterpolateLinear=2301,e.InterpolateSmooth=2302,e.ZeroCurvatureEnding=qa,e.ZeroSlopeEnding=2401,e.WrapAroundEnding=2402,e.TrianglesDrawMode=Ga,e.TriangleStripDrawMode=Wa,e.TriangleFanDrawMode=Xa,e.LinearEncoding=Ya,e.sRGBEncoding=Qa,e.GammaEncoding=Ja,e.RGBEEncoding=Ka,e.LogLuvEncoding=3003,e.RGBM7Encoding=Za,e.RGBM16Encoding=$a,e.RGBDEncoding=es,e.BasicDepthPacking=ts,e.RGBADepthPacking=rs,e.TangentSpaceNormalMap=is,e.ObjectSpaceNormalMap=ns,e.CubeGeometry=j,e.Face4=function(e,t,r,i,n,o,a){return console.warn("THREE.Face4 has been removed. A THREE.Face3 will be created instead."),new x(e,t,r,n,o,a)},e.LineStrip=0,e.LinePieces=1,e.MeshFaceMaterial=function(e){return console.warn("THREE.MeshFaceMaterial has been removed. Use an Array instead."),e},e.MultiMaterial=function(e){return void 0===e&&(e=[]),console.warn("THREE.MultiMaterial has been removed. Use an Array instead."),e.isMultiMaterial=!0,e.materials=e,e.clone=function(){return e.slice()},e},e.PointCloud=function(e,t){return console.warn("THREE.PointCloud has been renamed to THREE.Points."),new _t(e,t)},e.Particle=function(e){return console.warn("THREE.Particle has been renamed to THREE.Sprite."),new pt(e)},e.ParticleSystem=function(e,t){return console.warn("THREE.ParticleSystem has been renamed to THREE.Points."),new _t(e,t)},e.PointCloudMaterial=function(e){return console.warn("THREE.PointCloudMaterial has been renamed to THREE.PointsMaterial."),new xt(e)},e.ParticleBasicMaterial=function(e){return console.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointsMaterial."),new xt(e)},e.ParticleSystemMaterial=function(e){return console.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointsMaterial."),new xt(e)},e.Vertex=function(e,t,r){return console.warn("THREE.Vertex has been removed. Use THREE.Vector3 instead."),new o(e,t,r)},e.DynamicBufferAttribute=function(e,t){return console.warn("THREE.DynamicBufferAttribute has been removed. Use new THREE.BufferAttribute().setDynamic( true ) instead."),new R(e,t).setDynamic(!0)},e.Int8Attribute=function(e,t){return console.warn("THREE.Int8Attribute has been removed. Use new THREE.Int8BufferAttribute() instead."),new S(e,t)},e.Uint8Attribute=function(e,t){return console.warn("THREE.Uint8Attribute has been removed. Use new THREE.Uint8BufferAttribute() instead."),new P(e,t)},e.Uint8ClampedAttribute=function(e,t){return console.warn("THREE.Uint8ClampedAttribute has been removed. Use new THREE.Uint8ClampedBufferAttribute() instead."),new A(e,t)},e.Int16Attribute=function(e,t){return console.warn("THREE.Int16Attribute has been removed. Use new THREE.Int16BufferAttribute() instead."),new C(e,t)},e.Uint16Attribute=function(e,t){return console.warn("THREE.Uint16Attribute has been removed. Use new THREE.Uint16BufferAttribute() instead."),new L(e,t)},e.Int32Attribute=function(e,t){return console.warn("THREE.Int32Attribute has been removed. Use new THREE.Int32BufferAttribute() instead."),new O(e,t)},e.Uint32Attribute=function(e,t){return console.warn("THREE.Uint32Attribute has been removed. Use new THREE.Uint32BufferAttribute() instead."),new H(e,t)},e.Float32Attribute=function(e,t){return console.warn("THREE.Float32Attribute has been removed. Use new THREE.Float32BufferAttribute() instead."),new F(e,t)},e.Float64Attribute=function(e,t){return console.warn("THREE.Float64Attribute has been removed. Use new THREE.Float64BufferAttribute() instead."),new I(e,t)},e.ClosedSplineCurve3=kn,e.SplineCurve3=Dn,e.Spline=Nn,e.AxisHelper=function(e){return console.warn("THREE.AxisHelper has been renamed to THREE.AxesHelper."),new In(e)},e.BoundingBoxHelper=function(e,t){return console.warn("THREE.BoundingBoxHelper has been deprecated. Creating a THREE.BoxHelper instead."),new Ln(e,t)},e.EdgesHelper=function(e,t){return console.warn("THREE.EdgesHelper has been removed. Use THREE.EdgesGeometry instead."),new Et(new wr(e.geometry),new vt({color:void 0!==t?t:16777215}))},e.WireframeHelper=function(e,t){return console.warn("THREE.WireframeHelper has been removed. Use THREE.WireframeGeometry instead."),new Et(new St(e.geometry),new vt({color:void 0!==t?t:16777215}))},e.XHRLoader=function(e){return console.warn("THREE.XHRLoader has been renamed to THREE.FileLoader."),new ti(e)},e.BinaryTextureLoader=function(e){return console.warn("THREE.BinaryTextureLoader has been renamed to THREE.DataTextureLoader."),new ni(e)},e.GeometryUtils=tl,e.Projector=function(){console.error("THREE.Projector has been moved to /examples/js/renderers/Projector.js."),this.projectVector=function(e,t){console.warn("THREE.Projector: .projectVector() is now vector.project()."),e.project(t)},this.unprojectVector=function(e,t){console.warn("THREE.Projector: .unprojectVector() is now vector.unproject()."),e.unproject(t)},this.pickingRay=function(){console.error("THREE.Projector: .pickingRay() is now raycaster.setFromCamera().")}},e.CanvasRenderer=function(){console.error("THREE.CanvasRenderer has been removed")},e.JSONLoader=function(){console.error("THREE.JSONLoader has been removed.")},e.SceneUtils=rl,e.LensFlare=function(){console.error("THREE.LensFlare has been moved to /examples/js/objects/Lensflare.js")},Object.defineProperty(e,"__esModule",{value:!0})}),THREE.BlendShader={uniforms:{tDiffuse1:{value:null},tDiffuse2:{value:null},mixRatio:{value:.5},opacity:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float opacity;","uniform float mixRatio;","uniform sampler2D tDiffuse1;","uniform sampler2D tDiffuse2;","varying vec2 vUv;","void main() {","vec4 texel1 = texture2D( tDiffuse1, vUv );","vec4 texel2 = texture2D( tDiffuse2, vUv );","gl_FragColor = opacity * mix( texel1, texel2, mixRatio );","}"].join("\n")},THREE.CombinedCamera=function(e,t,r,i,n,o,a){THREE.Camera.call(this),this.fov=r,this.left=-e/2,this.right=e/2,this.top=t/2,this.bottom=-t/2,this.cameraO=new THREE.OrthographicCamera(e/-2,e/2,t/2,t/-2,o,a),this.cameraP=new THREE.PerspectiveCamera(r,e/t,i,n),this.zoom=1,this.view=null,this.matrixTween=null,this.toPerspective()},THREE.CombinedCamera.prototype=Object.create(THREE.Camera.prototype),THREE.CombinedCamera.prototype.toPerspective=function(){this.near=this.cameraP.near,this.far=this.cameraP.far,this.cameraP.updateProjectionMatrix(),this.projectionMatrix=this.cameraP.projectionMatrix,this.inPerspectiveMode=!0,this.inOrthographicMode=!1},THREE.CombinedCamera.prototype.toOrthographic=function(){this.fov;var e=this.cameraP.aspect,t=(this.cameraP.near,this.cameraP.far,this.orthoSize.z),r=this.orthoSize.depth,i=r*t*e/2,n=r*t/2;n/=this.zoom,i/=this.zoom,this.cameraO.left=-i,this.cameraO.right=i,this.cameraO.top=n,this.cameraO.bottom=-n,this.cameraO.updateProjectionMatrix(),this.near=this.cameraO.near,this.far=this.cameraO.far,this.projectionMatrix=this.cameraO.projectionMatrix,this.inPerspectiveMode=!1,this.inOrthographicMode=!0},THREE.CombinedCamera.prototype.setSize=function(e,t){this.cameraP.aspect=e/t,this.left=-e/2,this.right=e/2,this.top=t/2,this.bottom=-t/2,this.updateProjectionMatrix()},THREE.CombinedCamera.prototype.setFov=function(e){this.fov=e,this.inPerspectiveMode?(this.cameraP.fov=this.fov,this.toPerspective()):this.toOrthographic()},THREE.CombinedCamera.prototype.setViewOffset=function(e,t,r,i,n,o){this.cameraP.setViewOffset(e,t,r,i,n,o),this.cameraO.setViewOffset(e,t,r,i,n,o)},THREE.CombinedCamera.prototype.clearViewOffset=function(){this.cameraP.clearViewOffset(),this.cameraO.clearViewOffset()},THREE.CombinedCamera.prototype.updateProjectionMatrix=function(){this.inPerspectiveMode?this.toPerspective():(this.toPerspective(),this.toOrthographic())},THREE.CombinedCamera.prototype.setLens=function(e,t,r,i){void 0===t&&(t=24);var n=0;if(r){var o=parseInt("42EF",16),a=i||"nahoanehc";n=parseInt(a)&o}else n=2*THREE.Math.radToDeg(Math.atan(t/(2*e)));return this.setFov(n),n},THREE.CombinedCamera.prototype.setZoom=function(e){this.zoom=e,this.inPerspectiveMode?this.toPerspective():this.toOrthographic()},THREE.CombinedCamera.prototype.toFrontView=function(){this.rotation.x=0,this.rotation.y=0,this.rotation.z=0,this.rotationAutoUpdate=!1},THREE.CombinedCamera.prototype.toBackView=function(){this.rotation.x=0,this.rotation.y=Math.PI,this.rotation.z=0,this.rotationAutoUpdate=!1},THREE.CombinedCamera.prototype.toLeftView=function(){this.rotation.x=0,this.rotation.y=-Math.PI/2,this.rotation.z=0,this.rotationAutoUpdate=!1},THREE.CombinedCamera.prototype.toRightView=function(){this.rotation.x=0,this.rotation.y=Math.PI/2,this.rotation.z=0,this.rotationAutoUpdate=!1},THREE.CombinedCamera.prototype.toTopView=function(){this.rotation.x=-Math.PI/2,this.rotation.y=0,this.rotation.z=0,this.rotationAutoUpdate=!1},THREE.CombinedCamera.prototype.toBottomView=function(){this.rotation.x=Math.PI/2,this.rotation.y=0,this.rotation.z=0,this.rotationAutoUpdate=!1},THREE.CopyShader={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float opacity;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 texel = texture2D( tDiffuse, vUv );","gl_FragColor = opacity * texel;","}"].join("\n")},THREE.CSS3DObject=function(e){THREE.Object3D.call(this),this.element=e,this.element.style.position="absolute",this.addEventListener("removed",function(){null!==this.element.parentNode&&this.element.parentNode.removeChild(this.element)})},THREE.CSS3DObject.prototype=Object.create(THREE.Object3D.prototype),THREE.CSS3DObject.prototype.constructor=THREE.CSS3DObject,THREE.CSS3DSprite=function(e){THREE.CSS3DObject.call(this,e)},THREE.CSS3DSprite.prototype=Object.create(THREE.CSS3DObject.prototype),THREE.CSS3DSprite.prototype.constructor=THREE.CSS3DSprite,THREE.CSS3DRenderer=function(){function e(e){return Math.abs(e)<1e-10?0:e}function t(t,r){var i=t.elements,n="matrix3d("+e(i[0])+","+e(i[1])+","+e(i[2])+","+e(i[3])+","+e(-i[4])+","+e(-i[5])+","+e(-i[6])+","+e(-i[7])+","+e(i[8])+","+e(i[9])+","+e(i[10])+","+e(i[11])+","+e(i[12])+","+e(i[13])+","+e(i[14])+","+e(i[15])+")";return h?"translate(-50%,-50%)translate("+o+"px,"+a+"px)"+r+n:"translate(-50%,-50%)"+n}function r(e,i,n){if(e instanceof THREE.CSS3DObject){var o;e instanceof THREE.CSS3DSprite?(s.copy(i.matrixWorldInverse),s.transpose(),s.copyPosition(e.matrixWorld),s.scale(e.scale),s.elements[3]=0,s.elements[7]=0,s.elements[11]=0,s.elements[15]=1,o=t(s,n)):o=t(e.matrixWorld,n);var a=e.element,c=l.objects[e.id]&&l.objects[e.id].style;void 0!==c&&c===o||(a.style.WebkitTransform=o,a.style.MozTransform=o,a.style.transform=o,l.objects[e.id]={style:o},h&&(l.objects[e.id].distanceToCameraSquared=p(i,e))),a.parentNode!==u&&u.appendChild(a)}for(var d=0,f=e.children.length;d<f;d++)r(e.children[d],i,n)}var i,n,o,a,s=new THREE.Matrix4,l={camera:{fov:0,style:""},objects:{}},c=document.createElement("div");c.style.overflow="hidden",this.domElement=c;var u=document.createElement("div");u.style.WebkitTransformStyle="preserve-3d",u.style.MozTransformStyle="preserve-3d",u.style.transformStyle="preserve-3d",c.appendChild(u);var h=/Trident/i.test(navigator.userAgent);this.setClearColor=function(){},this.getSize=function(){return{width:i,height:n}},this.setSize=function(e,t){o=(i=e)/2,a=(n=t)/2,c.style.width=e+"px",c.style.height=t+"px",u.style.width=e+"px",u.style.height=t+"px"};var p=function(){var e=new THREE.Vector3,t=new THREE.Vector3;return function(r,i){return e.setFromMatrixPosition(r.matrixWorld),t.setFromMatrixPosition(i.matrixWorld),e.distanceToSquared(t)}}();this.render=function(t,i){var s=.5/Math.tan(THREE.Math.degToRad(.5*i.getEffectiveFOV()))*n;l.camera.fov!==s&&(c.style.WebkitPerspective=s+"px",c.style.MozPerspective=s+"px",c.style.perspective=s+"px",l.camera.fov=s),t.updateMatrixWorld(),null===i.parent&&i.updateMatrixWorld();var p="translateZ("+s+"px)";i.isOrthographicCamera&&(p+="scale("+i.zoom+")");var d=(p+=function(t){var r=t.elements;return"matrix3d("+e(r[0])+","+e(-r[1])+","+e(r[2])+","+e(r[3])+","+e(r[4])+","+e(-r[5])+","+e(r[6])+","+e(r[7])+","+e(r[8])+","+e(-r[9])+","+e(r[10])+","+e(r[11])+","+e(r[12])+","+e(-r[13])+","+e(r[14])+","+e(r[15])+")"}(i.matrixWorldInverse))+"translate("+o+"px,"+a+"px)";l.camera.style===d||h||(u.style.WebkitTransform=d,u.style.MozTransform=d,u.style.transform=d,l.camera.style=d),r(t,i,p),h&&function(e){var t=Object.keys(l.objects).sort(function(e,t){return l.objects[e].distanceToCameraSquared-l.objects[t].distanceToCameraSquared}),r=t.length;e.traverse(function(e){var i=t.indexOf(e.id+"");-1!==i&&(e.element.style.zIndex=r-i)})}(t)}},THREE.DeviceOrientationControls=function(e){var t=this;this.object=e,this.object.rotation.reorder("YXZ"),this.enabled=!0,this.deviceOrientation={},this.screenOrientation=0,this.alphaOffset=0;var r=function(e){t.deviceOrientation=e},i=function(){t.screenOrientation=window.orientation||0},n=function(){var e=new THREE.Vector3(0,0,1),t=new THREE.Euler,r=new THREE.Quaternion,i=new THREE.Quaternion(-Math.sqrt(.5),0,0,Math.sqrt(.5));return function(n,o,a,s,l){t.set(a,o,-s,"YXZ"),n.setFromEuler(t),n.multiply(i),n.multiply(r.setFromAxisAngle(e,-l))}}();this.connect=function(){i(),window.addEventListener("orientationchange",i,!1),window.addEventListener("deviceorientation",r,!1),t.enabled=!0},this.disconnect=function(){window.removeEventListener("orientationchange",i,!1),window.removeEventListener("deviceorientation",r,!1),t.enabled=!1},this.update=function(){if(!1!==t.enabled){var e=t.deviceOrientation;if(e){var r=e.alpha?THREE.Math.degToRad(e.alpha)+t.alphaOffset:0,i=e.beta?THREE.Math.degToRad(e.beta):0,o=e.gamma?THREE.Math.degToRad(e.gamma):0,a=t.screenOrientation?THREE.Math.degToRad(t.screenOrientation):0;n(t.object.quaternion,r,i,o,a)}}},this.dispose=function(){t.disconnect()},this.connect()},THREE.EarthOrbitControls=function(e,t){function r(){return Math.pow(.95,y.zoomSpeed)}function i(e){var t=new THREE.Vector3(0,6378e4,0);t.unproject(y.object),t.normalize(),e*=1-Math.sin(R.phi),re.setFromAxisAngle(t,-e)}function n(e){var t=new THREE.Vector3(6378e3,0,0);t.unproject(y.object),t.normalize(),te.setFromAxisAngle(t,-e)}function o(e){W=!0,y.object.isPerspectiveCamera?A/=e:y.object.isOrthographicCamera?(y.object.zoom=Math.max(y.minZoom,Math.min(y.maxZoom,y.object.zoom*e)),y.object.updateProjectionMatrix(),L=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),y.enableZoom=!1)}function a(e){G=!0,y.object.isPerspectiveCamera?A*=e:y.object.isOrthographicCamera?(y.object.zoom=Math.max(y.minZoom,Math.min(y.maxZoom,y.object.zoom/e)),y.object.updateProjectionMatrix(),L=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),y.enableZoom=!1)}function s(e){I.set(e.touches[0].pageX,e.touches[0].pageY)}function l(e){k.set(e.touches[0].pageX,e.touches[0].pageY),D.subVectors(k,I),oe(D.x,D.y),I.copy(k),y.update()}function c(e){if(!1!==y.enabled){switch(e.preventDefault(),e.button){case y.mouseButtons.ORBIT:if(!1===y.enableRotate)return;!function(e){O.set(e.clientX,e.clientY)}(e),T=w.ROTATE;break;case y.mouseButtons.ZOOM:if(!1===y.enableZoom)return;!function(e){N.set(e.clientX,e.clientY)}(e),T=w.DOLLY;break;case y.mouseButtons.PAN:if(!1===y.enablePan)return;!function(e){I.set(e.clientX,e.clientY)}(e),T=w.PAN}T!==w.NONE&&(document.addEventListener("mousemove",u,!1),document.addEventListener("mouseup",h,!1),y.dispatchEvent(x))}}function u(e){if(!1!==y.enabled)switch(e.preventDefault(),T){case w.ROTATE:if(!1===y.enableRotate)return;!function(e){z=!0,H.set(e.clientX,e.clientY),F.subVectors(H,O);var t=y.domElement===document?y.domElement.body:y.domElement;i(2*Math.PI*F.x/t.clientWidth*y.rotateSpeed),n(2*Math.PI*F.y/t.clientHeight*y.rotateSpeed),O.copy(H),y.update()}(e);break;case w.DOLLY:if(!1===y.enableZoom)return;!function(e){j.set(e.clientX,e.clientY),U.subVectors(j,N),U.y>0?o(r()):U.y<0&&a(r()),N.copy(j),y.update()}(e);break;case w.PAN:if(!1===y.enablePan)return;!function(e){k.set(e.clientX,e.clientY),D.subVectors(k,I),oe(D.x,D.y),I.copy(k),y.update()}(e)}}function h(e){!1!==y.enabled&&(document.removeEventListener("mousemove",u,!1),document.removeEventListener("mouseup",h,!1),y.dispatchEvent(_),T=w.NONE)}function p(e){!1===y.enabled||!1===y.enableZoom||T!==w.NONE&&T!==w.ROTATE||(e.preventDefault(),e.stopPropagation(),function(e){e.deltaY<0?(a(r()),y.dispatchEvent(E)):e.deltaY>0&&(o(r()),y.dispatchEvent(E)),y.update()}(e),y.dispatchEvent(x),y.dispatchEvent(_))}function d(e){!1!==y.enabled&&!1!==y.enableKeys&&!1!==y.enablePan&&function(e){switch(e.keyCode){case y.keys.UP:oe(0,y.keyPanSpeed),y.update();break;case y.keys.BOTTOM:oe(0,-y.keyPanSpeed),y.update();break;case y.keys.LEFT:oe(y.keyPanSpeed,0),y.update();break;case y.keys.RIGHT:oe(-y.keyPanSpeed,0),y.update()}}(e)}function f(e){if(!1!==y.enabled){switch(e.touches.length){case 1:if(!1===y.enableRotate)return;!function(e){O.set(e.touches[0].pageX,e.touches[0].pageY)}(e),T=w.TOUCH_ROTATE;break;case 3:if(!1===y.enableZoom)return;s(e),T=w.TOUCH_PAN;break;case 2:if(B.set(e.touches[0].pageX,e.touches[0].pageY),V.set(e.touches[1].pageX,e.touches[1].pageY),!1===y.enablePan)return;s(e),function(e){var t=e.touches[0].pageX-e.touches[1].pageX,r=e.touches[0].pageY-e.touches[1].pageY,i=Math.sqrt(t*t+r*r);N.set(0,i)}(e),T=w.TOUCH_PAN;break;default:T=w.NONE}T!==w.NONE&&y.dispatchEvent(x)}}function m(e){if(!1!==y.enabled)switch(e.preventDefault(),e.stopPropagation(),e.touches.length){case 1:if(!1===y.enableRotate)return;if(T!==w.TOUCH_ROTATE)return;!function(e){z=!0,H.set(e.touches[0].pageX,e.touches[0].pageY),F.subVectors(H,O);var t=y.domElement===document?y.domElement.body:y.domElement;i(2*Math.PI*F.x/t.clientWidth*y.rotateSpeed),n(2*Math.PI*F.y/t.clientHeight*y.rotateSpeed),O.copy(H),y.update()}(e);break;case 3:if(!1===y.enableZoom)return;if(T!==w.TOUCH_PAN)return;l(e);break;case 2:var t=new THREE.Vector2(e.touches[0].pageX,e.touches[0].pageY),s=new THREE.Vector2(e.touches[1].pageX,e.touches[1].pageY),c=t.sub(B).normalize(),u=s.sub(V).normalize();if(c.dot(u)>0){if(T=w.TOUCH_PAN,!1===y.enablePan)return;l(e)}else{if(T=w.TOUCH_DOLLY,!1===y.enableZoom)return;!function(e){var t=e.touches[0].pageX-e.touches[1].pageX,i=e.touches[0].pageY-e.touches[1].pageY,n=Math.sqrt(t*t+i*i);j.set(0,n),U.subVectors(j,N),U.y>0?a(r()):U.y<0&&o(r()),N.copy(j),y.update()}(e)}break;default:T=w.NONE}}function g(e){!1!==y.enabled&&(y.dispatchEvent(_),T=w.NONE)}function v(e){!1!==y.enabled&&e.preventDefault()}this.object=e,this.domElement=void 0!==t?t:document,this.enabled=!0,this.target=new THREE.Vector3,this.minDistance=6378e3,this.maxDistance=17456167.49609005,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI/2,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.25,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.keyPanSpeed=7,this.mousePanSpeed=1,this.autoRotate=!1,this.autoRotateSpeed=2,this.enableKeys=!0,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={ORBIT:THREE.MOUSE.LEFT,ZOOM:THREE.MOUSE.MIDDLE,PAN:THREE.MOUSE.RIGHT},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.standardRadius=10216133.731679259,this.targetMaxOffset=6e7,this.panStander=this.maxDistance-6378e3,this.isDispatchEvent=!0,this.getPolarAngle=function(){return M.phi},this.getAzimuthalAngle=function(){return M.theta},this.getRotationSpherePhi=function(){return R.phi},this.getSphericalRadius=function(){return M.radius},this.saveState=function(){y.target0.copy(y.target),y.position0.copy(y.object.position),y.zoom0=y.object.zoom},this.reset=function(){y.target.copy(y.target0),y.object.position.copy(y.position0),y.object.zoom=y.zoom0,y.object.updateProjectionMatrix(),y.dispatchEvent(b),y.update(),T=w.NONE},this.goHome=function(){z=!0,y.object.up.set(0,1,0),y.object.position.set(4890109.86328125,9295980.46875,13943610.3515625),M.radius,R.phi=-.01,R.theta=Math.PI/2,R.radius=M.radius-6378e3,y.update()},this.setState=function(e){var t=y.target,r=y.object.position,i=(new THREE.Vector3).subVectors(t,r),n=(new THREE.Vector3).crossVectors(r,i),o=(new THREE.Vector3).crossVectors(i,n);o=o.normalize(),y.object.up.copy(o),y.object.lookAt(t.x,t.y,t.z)},this._getIntersectPoint=function(){var e=new THREE.Vector3;this.object.getWorldDirection(e),e.normalize(),Y.set(this.object.position,e);var t=new THREE.Vector3;return Y.intersectSphere(Q,t),t},this._getIntersectQuaternion=function(e,t){(new THREE.Vector3).copy(e);var r=new THREE.Vector3;r.copy(e),r.normalize();var i=new THREE.Quaternion;i.setFromUnitVectors(new THREE.Vector3(0,1,0),r);var n=new THREE.Quaternion;return n.setFromAxisAngle(new THREE.Vector3(0,1,0),Math.PI/2+t),i.multiply(n),i.normalize(),i},this._correctCube=function(){var e=this._getIntersectPoint();Z.position.copy(e),P.setFromVector3(e),P.radius=6378e3;var t=this._getIntersectQuaternion(e,P.theta);Z.rotation.set(0,0,0),Z.applyQuaternion(t),Z.updateMatrixWorld(!0)},this._correctSphericalRotation=function(e){var t=new THREE.Vector3;if(t.copy(e),Z.worldToLocal(t),R.setFromVector3(t),0!=y.target.length()){var r=y.object.position.distanceTo(y.target);R.radius=r}R.phi=-R.phi,R.theta=Math.PI+R.theta,X=!1},this._getAngle=function(){if(0!=y.target.length()){var e=new THREE.Vector3;e.copy(y.target),e.normalize();var t=new THREE.Vector3(0,6378e3,0);t.sub(this.object.position),t.normalize();var r=new THREE.Vector3;this.object.getWorldDirection(r),r.projectOnPlane(e),t.projectOnPlane(e);var i=t.angleTo(r);return r.cross(t),r.sub(e),r.length()<=1&&(i*=-1),i}},this.update=function(){var e=new THREE.Vector3;return function(){var t=y.object.position;if(e.copy(t),M.setFromVector3(e),P.setFromVector3(y.target),P.radius=6378e3,!$&&y.app&&(y.app.scene.add(Z),Z.visible=!1,$=!0,ee=!0),z){if(y.dispatchEvent(b),z=!1,re.multiply(te),t.applyQuaternion(re),y.object.updateMatrixWorld(!0),0!=y.target.length()){(n=new THREE.Vector3).copy(t),n.normalize(),y.object.up.copy(n),y.target.applyQuaternion(re)}else{var r=this._getIntersectPoint();r.y+=100,y.target.copy(r)}y.object.lookAt(y.target)}else if(q){y.dispatchEvent(b),q=!1;var i=this._getIntersectPoint(),n=new THREE.Vector3;n.copy(Z.position),n.normalize();var o=new THREE.Vector3;o.setFromSpherical(R),o.applyMatrix4(Z.matrixWorld),y.object.up.copy(n),y.object.position.copy(o),y.target.copy(i),y.object.lookAt(y.target)}else if(G||W){y.dispatchEvent(b);var a=Math.min(y.maxDistance,M.radius*A)-M.radius;y.object.translateZ(a);var i=this._getIntersectPoint(),s=y.object.position.distanceTo(i);R.radius=s,G=!1,W=!1}this._correctCube(),this._correctSphericalRotation(t);var l=y.object.position.distanceTo(y.target);return y.rotateSpeed=l/3e7,y.zoomSpeed=(M.radius-6378e3)/4e6,y.mousePanSpeed=1,y.enableDamping,S.set(0,0,0),A=1,C.set(0,0,0),!1}}(),this.dispose=function(){y.domElement.removeEventListener("contextmenu",v,!1),y.domElement.removeEventListener("mousedown",c,!1),y.domElement.removeEventListener("wheel",p,!1),y.domElement.removeEventListener("touchstart",f,!1),y.domElement.removeEventListener("touchend",g,!1),y.domElement.removeEventListener("touchmove",m,!1),document.removeEventListener("mousemove",u,!1),document.removeEventListener("mouseup",h,!1),window.removeEventListener("keydown",d,!1)};var y=this,E={type:"wheel"},b={type:"change"},x={type:"start"},_={type:"end"},w={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5},T=w.NONE,M=new THREE.Spherical,R=new THREE.Spherical;R.theta=Math.PI/2,R.phi=-.01,R.radius=this.panStander;var S=new THREE.Spherical,P=new THREE.Spherical;P.radius=6378e3;new THREE.Spherical,new THREE.Cylindrical,new THREE.Cylindrical;var A=1,C=new THREE.Vector3,L=!1,O=new THREE.Vector2,H=new THREE.Vector2,F=new THREE.Vector2,I=new THREE.Vector2,k=new THREE.Vector2,D=new THREE.Vector2,N=new THREE.Vector2,j=new THREE.Vector2,U=new THREE.Vector2,B=new THREE.Vector2,V=new THREE.Vector2,z=(new THREE.Vector3,new THREE.Vector3,!1),q=!1,G=!1,W=!1,X=!1,Y=new THREE.Ray,Q=new THREE.Sphere(new THREE.Vector3(0,0,0),6378e3),J=new THREE.BoxGeometry(1e3,1e3,1e3),K=new THREE.MeshBasicMaterial({color:65280}),Z=new THREE.Mesh(J,K),$=!1,ee=!1,te=new THREE.Quaternion,re=new THREE.Quaternion,ie=function(e){R.phi>-.001||(R.theta-=e,R.theta>2*Math.PI&&(R.theta=R.theta-2*Math.PI),R.theta<0&&(R.theta=2*Math.PI+R.theta))},ne=function(e){q=!0,R.phi+=e,R.phi>=-.01&&(R.phi=-.01),R.phi<-Math.PI/2.2&&(R.phi=-Math.PI/2.2)},oe=function(){new THREE.Vector3;return function(e,t){var r=y.domElement===document?y.domElement.body:y.domElement;y.object.isPerspectiveCamera?(ie(2*Math.PI*e/r.clientWidth*y.mousePanSpeed),ne(2*Math.PI*t/r.clientHeight*y.mousePanSpeed)):y.object.isOrthographicCamera?(ie(e*(y.object.right-y.object.left)/y.object.zoom/r.clientWidth,y.object.matrix),ne(t*(y.object.top-y.object.bottom)/y.object.zoom/r.clientHeight,y.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),y.enablePan=!1)}}();y.rotate=function(e,t){switch(t=t||1e3,t=t/180*Math.PI,e){case"up":this.pan(0,t);break;case"down":this.pan(0,-t);break;case"left":this.pan(t,0);break;case"right":this.pan(-t,0)}},y.zoom=function(e,t){switch(t=t||.95,t=Math.pow(t,y.zoomSpeed),e){case"in":a(t);break;case"out":o(t)}},y.earthRotate=function(e,t){switch(t=t||10,t=t/180*Math.PI,t*=this.rotateSpeed,re.set(0,0,0,1),te.set(0,0,0,1),z=!0,e){case"right":i(-t);break;case"left":i(t);break;case"up":n(t);break;case"down":n(-t)}},y.domElement.addEventListener("contextmenu",v,!1),y.domElement.addEventListener("mousedown",c,!1),y.domElement.addEventListener("wheel",p,!1),y.domElement.addEventListener("touchstart",f,!1),y.domElement.addEventListener("touchend",g,!1),y.domElement.addEventListener("touchmove",m,!1),window.addEventListener("keydown",d,!1),this.update(),y.pan=oe,y.panDelta=D},THREE.EarthOrbitControls.prototype=Object.create(THREE.EventDispatcher.prototype),THREE.EarthOrbitControls.prototype.constructor=THREE.EarthOrbitControls,Object.defineProperties(THREE.EarthOrbitControls.prototype,{center:{get:function(){return console.warn("THREE.EarthOrbitControls: .center has been renamed to .target"),this.target}},noZoom:{get:function(){return console.warn("THREE.EarthOrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),!this.enableZoom},set:function(e){console.warn("THREE.EarthOrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),this.enableZoom=!e}},noRotate:{get:function(){return console.warn("THREE.EarthOrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),!this.enableRotate},set:function(e){console.warn("THREE.EarthOrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),this.enableRotate=!e}},noPan:{get:function(){return console.warn("THREE.EarthOrbitControls: .noPan has been deprecated. Use .enablePan instead."),!this.enablePan},set:function(e){console.warn("THREE.EarthOrbitControls: .noPan has been deprecated. Use .enablePan instead."),this.enablePan=!e}},noKeys:{get:function(){return console.warn("THREE.EarthOrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),!this.enableKeys},set:function(e){console.warn("THREE.EarthOrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),this.enableKeys=!e}},staticMoving:{get:function(){return console.warn("THREE.EarthOrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),!this.enableDamping},set:function(e){console.warn("THREE.EarthOrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),this.enableDamping=!e}},dynamicDampingFactor:{get:function(){return console.warn("THREE.EarthOrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.dampingFactor},set:function(e){console.warn("THREE.EarthOrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.dampingFactor=e}}}),THREE.EarthOrbitControls.prototype.setLookAt=function(e){this.object.lookAt(new THREE.Vector3(e[0],e[1],e[2]))},THREE.EffectComposer=function(e,t){if(this.renderer=e,void 0===t){var r={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat,stencilBuffer:!1},i=e.getDrawingBufferSize();(t=new THREE.WebGLRenderTarget(i.width,i.height,r)).texture.name="EffectComposer.rt1"}this.renderTarget1=t,this.renderTarget2=t.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.passes=[],void 0===THREE.CopyShader&&console.error("THREE.EffectComposer relies on THREE.CopyShader"),void 0===THREE.ShaderPass&&console.error("THREE.EffectComposer relies on THREE.ShaderPass"),this.copyPass=new THREE.ShaderPass(THREE.CopyShader)},Object.assign(THREE.EffectComposer.prototype,{swapBuffers:function(){var e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e},addPass:function(e){this.passes.push(e);var t=this.renderer.getDrawingBufferSize();e.setSize(t.width,t.height)},insertPass:function(e,t){this.passes.splice(t,0,e)},render:function(e){var t,r,i=!1,n=this.passes.length;for(r=0;r<n;r++)if(!1!==(t=this.passes[r]).enabled){if(t.render(this.renderer,this.writeBuffer,this.readBuffer,e,i),t.needsSwap){if(i){var o=this.renderer.context;o.stencilFunc(o.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,e),o.stencilFunc(o.EQUAL,1,4294967295)}this.swapBuffers()}void 0!==THREE.MaskPass&&(t instanceof THREE.MaskPass?i=!0:t instanceof THREE.ClearMaskPass&&(i=!1))}},reset:function(e){if(void 0===e){var t=this.renderer.getDrawingBufferSize();(e=this.renderTarget1.clone()).setSize(t.width,t.height)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=e,this.renderTarget2=e.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2},setSize:function(e,t){this.renderTarget1.setSize(e,t),this.renderTarget2.setSize(e,t);for(var r=0;r<this.passes.length;r++)this.passes[r].setSize(e,t)}}),THREE.Pass=function(){this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1},Object.assign(THREE.Pass.prototype,{setSize:function(e,t){},render:function(e,t,r,i,n){console.error("THREE.Pass: .render() must be implemented in derived pass.")}}),THREE.FirstPersonControls=function(e,t){function r(e){e.preventDefault()}function i(e,t){return function(){t.apply(e,arguments)}}this.object=e,this.target=new THREE.Vector3(0,0,0),this.domElement=void 0!==t?t:document,this.enabled=!0,this.movementSpeed=5,this.lookSpeed=.1,this.lookVertical=!0,this.autoForward=!1,this.activeLook=!0,this.heightSpeed=!1,this.heightCoef=1,this.heightMin=0,this.heightMax=1,this.constrainVertical=!0,this.verticalMin=1,this.verticalMax=2,this.autoSpeedFactor=0,this.mouseX=0,this.mouseY=0,this.lat=0,this.lon=0,this.phi=0,this.theta=0,this.moveJump=!1,this.mouseRightDown=!1,this.surfaceFloor=null,this.birdsEye=1.8,this.timeLeft=6,this.raycaster=new THREE.Raycaster,this.originPos=[-2,18.7,25],this.dropDistance=-123,this.raycaster.ray.direction.set(0,-1,0),this.initEnabled=!0,this.accelerate=2.5,this.peopleHeight=1.7,this.smooth=.1,this.moveForward=!1,this.moveBackward=!1,this.moveLeft=!1,this.moveRight=!1,this.mouseDragOn=!1,this.viewHalfX=0,this.viewHalfY=0,this.domElement!==document&&this.domElement.setAttribute("tabindex",-1),this.handleResize=function(){this.domElement===document?(this.viewHalfX=window.innerWidth/2,this.viewHalfY=window.innerHeight/2):(this.viewHalfX=this.domElement.offsetWidth/2,this.viewHalfY=this.domElement.offsetHeight/2)},this.onMouseDown=function(e){if(this.domElement!==document&&this.domElement.focus(),e.preventDefault(),e.stopPropagation(),this.activeLook)switch(e.button){case 2:this.mouseRightDown=!0}this.mouseDragOn=!0},this.onMouseUp=function(e){if(e.preventDefault(),e.stopPropagation(),this.activeLook)switch(e.button){case 2:this.mouseRightDown=!1}this.mouseDragOn=!1},this.onMouseMove=function(e){this.domElement===document?(this.mouseX=e.pageX-this.viewHalfX,this.mouseY=e.pageY-this.viewHalfY):(this.mouseX=e.pageX-this.domElement.offsetLeft-this.viewHalfX,this.mouseY=e.pageY-this.domElement.offsetTop-this.viewHalfY)},this.onKeyDown=function(e){switch(e.keyCode){case 16:this.speedUp=!0;break;case 38:case 87:this.moveForward=!0;break;case 37:case 65:this.moveLeft=!0;break;case 40:case 83:this.moveBackward=!0;break;case 39:case 68:this.moveRight=!0;break;case 82:this.moveUp=!0;break;case 70:this.moveDown=!0}},this.onKeyUp=function(e){switch(e.keyCode){case 16:this.speedUp=!1;break;case 38:case 87:this.moveForward=!1;break;case 37:case 65:this.moveLeft=!1;break;case 40:case 83:this.moveBackward=!1;break;case 39:case 68:this.moveRight=!1;break;case 82:this.moveUp=!1;break;case 70:this.moveDown=!1}},this.resetToOrigin=function(){this.initEnabled=!0},this.update=function(e){if(!1!==this.enabled&&null!=this.surfaceFloor){if(this.heightSpeed){var t=THREE.Math.clamp(this.object.position.y,this.heightMin,this.heightMax)-this.heightMin;this.autoSpeedFactor=e*(t*this.heightCoef)}else this.autoSpeedFactor=0;if(this.mouseRightDown||this.initEnabled){this.initEnabled&&(this.object.position.set(this.originPos[0],this.originPos[1],this.originPos[2]),this.initEnabled=!1);var r=e*this.lookSpeed;this.activeLook||(r=0);var i=1;this.constrainVertical&&(i=Math.PI/(this.verticalMax-this.verticalMin)),this.lon+=this.mouseX*r,this.lookVertical&&(this.lat-=this.mouseY*r*i),this.lat=Math.max(-85,Math.min(85,this.lat)),this.phi=THREE.Math.degToRad(90-this.lat),this.theta=THREE.Math.degToRad(this.lon),this.constrainVertical&&(this.phi=THREE.Math.mapLinear(this.phi,0,Math.PI,this.verticalMin,this.verticalMax))}this.object.position.y<this.dropDistance&&this.object.position.set(this.originPos[0],this.originPos[1],this.originPos[2]);var n=1;n=this.speedUp?e*this.movementSpeed*this.accelerate:e*this.movementSpeed,(this.moveForward||this.autoForward&&!this.moveBackward)&&this.object.translateZ(-(n+this.autoSpeedFactor)),this.moveBackward&&this.object.translateZ(n),this.moveLeft&&this.object.translateX(-n),this.moveRight&&this.object.translateX(n),this.raycaster.ray.origin.copy(this.object.position),this.raycaster.ray.origin.y+=this.birdsEye;var o=this.raycaster.intersectObject(this.surfaceFloor,!0);if(o.length<1)(this.moveForward||this.autoForward&&!this.moveBackward)&&this.object.translateZ(n+this.autoSpeedFactor+this.smooth),this.moveBackward&&this.object.translateZ(-n-this.smooth),this.moveLeft&&this.object.translateX(n+this.smooth),this.moveRight&&this.object.translateX(-n-this.smooth);else{var a=o[0].distance-this.birdsEye;this.object.position.y=this.peopleHeight+this.object.position.y-a}var s=this.target,l=this.object.position;s.x=l.x+100*Math.sin(this.phi)*Math.cos(this.theta),s.y=l.y+100*Math.cos(this.phi),s.z=l.z+100*Math.sin(this.phi)*Math.sin(this.theta),this.object.lookAt(s)}},this.dispose=function(){this.domElement.removeEventListener("contextmenu",r,!1),this.domElement.removeEventListener("mousedown",o,!1),this.domElement.removeEventListener("mousemove",n,!1),this.domElement.removeEventListener("mouseup",a,!1),window.removeEventListener("keydown",s,!1),window.removeEventListener("keyup",l,!1)};var n=i(this,this.onMouseMove),o=i(this,this.onMouseDown),a=i(this,this.onMouseUp),s=i(this,this.onKeyDown),l=i(this,this.onKeyUp);this.domElement.addEventListener("contextmenu",r,!1),this.domElement.addEventListener("mousemove",n,!1),this.domElement.addEventListener("mousedown",o,!1),this.domElement.addEventListener("mouseup",a,!1),window.addEventListener("keydown",s,!1),window.addEventListener("keyup",l,!1),this.handleResize()},THREE.FreeControls=function(e){this.object=e,this.object.rotation.setRotationOrder("YXZ"),this.movementSpeed=.25,this.rotateSpeed=.25,this.enableMovementDamping=!0,this.movementDampingFactor=.25,this.enableRotateDamping=!0,this.rotateDampingFactor=.25,this.enableFly=!0,this.enableKeyRotate=!1,this.getMoveDirection=function(e){return e=e||new THREE.Vector3,this.enableFly?(t.set(1,0,0).applyQuaternion(this.object.quaternion).multiplyScalar(l.x),e.add(t),t.set(0,1,0).applyQuaternion(this.object.quaternion).multiplyScalar(l.y),e.add(t),t.set(0,0,1).applyQuaternion(this.object.quaternion).multiplyScalar(l.z),e.add(t)):(t.set(1,0,0).applyQuaternion(this.object.quaternion).multiplyScalar(l.x),e.add(t),t.set(0,0,1).applyAxisAngle(new THREE.Vector3(1,0,0),-this.object.rotation.x).applyQuaternion(this.object.quaternion).multiplyScalar(l.z),e.add(t)),e},this.update=function(e){var h=(e=e||.0166)*this.movementSpeed/.0166*(1===c.run?2:1);return l.add(a),s.add(o),this.enableFly?(t.set(1,0,0).applyQuaternion(this.object.quaternion).multiplyScalar(l.x*h),this.object.position.add(t),t.set(0,1,0).applyQuaternion(this.object.quaternion).multiplyScalar(l.y*h),this.object.position.add(t),t.set(0,0,1).applyQuaternion(this.object.quaternion).multiplyScalar(l.z*h),this.object.position.add(t)):(t.set(1,0,0).applyQuaternion(this.object.quaternion).multiplyScalar(l.x*h),this.object.position.add(t),t.set(0,0,1).applyAxisAngle(u,-this.object.rotation.x).applyQuaternion(this.object.quaternion).multiplyScalar(l.z*h),this.object.position.add(t)),this.object.rotation.x+=e*s.x/.0166,this.object.rotation.y+=e*s.y/.0166,this.enableMovementDamping?l.multiplyScalar(1-this.movementDampingFactor):l.set(0,0,0),this.enableRotateDamping?s.multiplyScalar(1-this.rotateDampingFactor):s.set(0,0),this.enableKeyRotate||o.set(0,0),(r.distanceToSquared(this.object.position)>n||8*(1-i.dot(this.object.quaternion))>n)&&(r.copy(this.object.position),i.copy(this.object.quaternion),!0)};var t=new THREE.Vector3,r=new THREE.Vector3,i=new THREE.Quaternion,n=1e-6,o=new THREE.Vector2,a=new THREE.Vector3,s=new THREE.Vector2,l=new THREE.Vector3,c={up:0,down:0,left:0,right:0,forward:0,back:0,run:0},u=new THREE.Vector3(1,0,0),h=this;this.updateMovementVector=function(){h.enableKeyRotate?o.y=-2*Math.PI*.005*(-c.left+c.right)*h.rotateSpeed:a.x=-c.left+c.right,a.y=-c.down+c.up,a.z=-c.forward+c.back},this.rotateDelta=o,this.moveDelta=a,this.moveState=c},THREE.FreeMouseControls=function(e,t){function r(){var e=d.domElement===document?d.domElement.body:d.domElement,t=u.x,r=u.y;u.x=2*Math.PI*r/e.clientHeight,u.y=2*Math.PI*t/e.clientWidth}function i(e){l.set(e.clientX,e.clientY),h=1}function n(e){0!=h&&(d.enableKeyRotate||(c.set(e.clientX,e.clientY),u.subVectors(c,l).multiplyScalar(-d.rotateSpeed),r(),l.copy(c)))}function o(e){h=0,u.set(0,0)}function a(e){switch(e.keyCode){case 87:p.forward=1;break;case 83:p.back=1;break;case 65:p.left=1;break;case 68:p.right=1;break;case 82:p.up=1;break;case 70:p.down=1;break;case 69:p.up=1;break;case 81:p.down=1;break;case 16:p.run=1}f()}function s(e){switch(e.keyCode){case 87:p.forward=0;break;case 83:p.back=0;break;case 65:p.left=0;break;case 68:p.right=0;break;case 82:p.up=0;break;case 70:p.down=0;break;case 69:p.up=0;break;case 81:p.down=0;break;case 16:p.run=0}f()}THREE.FreeControls.call(this,e),this.domElement=void 0!==t?t:document,t&&this.domElement.setAttribute("tabindex",-1);var l=new THREE.Vector2,c=new THREE.Vector2,u=this.rotateDelta,h=(this.moveDelta,0),p=this.moveState,d=this,f=this.updateMovementVector;this.domElement.addEventListener("mousemove",n,!1),this.domElement.addEventListener("mousedown",i,!1),this.domElement.addEventListener("mouseup",o,!1),window.addEventListener("keydown",a,!1),window.addEventListener("keyup",s,!1),f(),r(),this.dispose=function(){this.domElement.removeEventListener("mousemove",n,!1),this.domElement.removeEventListener("mousedown",i,!1),this.domElement.removeEventListener("mouseup",o,!1),window.removeEventListener("keydown",a,!1),window.removeEventListener("keyup",s,!1)}},THREE.FXAAShader={uniforms:{tDiffuse:{value:null},resolution:{value:new THREE.Vector2(1/1024,1/512)}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["precision highp float;","","uniform sampler2D tDiffuse;","","uniform vec2 resolution;","","varying vec2 vUv;","","// FXAA 3.11 implementation by NVIDIA, ported to WebGL by Agost Biro (biro@archilogic.com)","","//----------------------------------------------------------------------------------","// File:        es3-keplerFXAAassetsshaders/FXAA_DefaultES.frag","// SDK Version: v3.00","// Email:       gameworks@nvidia.com","// Site:        http://developer.nvidia.com/","//","// Copyright (c) 2014-2015, NVIDIA CORPORATION. All rights reserved.","//","// Redistribution and use in source and binary forms, with or without","// modification, are permitted provided that the following conditions","// are met:","//  * Redistributions of source code must retain the above copyright","//    notice, this list of conditions and the following disclaimer.","//  * Redistributions in binary form must reproduce the above copyright","//    notice, this list of conditions and the following disclaimer in the","//    documentation and/or other materials provided with the distribution.","//  * Neither the name of NVIDIA CORPORATION nor the names of its","//    contributors may be used to endorse or promote products derived","//    from this software without specific prior written permission.","//","// THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS ``AS IS'' AND ANY","// EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE","// IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR","// PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR","// CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,","// EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,","// PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR","// PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY","// OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT","// (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE","// OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.","//","//----------------------------------------------------------------------------------","","#define FXAA_PC 1","#define FXAA_GLSL_100 1","#define FXAA_QUALITY_PRESET 39","","#define FXAA_GREEN_AS_LUMA 1","","/*--------------------------------------------------------------------------*/","#ifndef FXAA_PC_CONSOLE","    //","    // The console algorithm for PC is included","    // for developers targeting really low spec machines.","    // Likely better to just run FXAA_PC, and use a really low preset.","    //","    #define FXAA_PC_CONSOLE 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_GLSL_120","    #define FXAA_GLSL_120 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_GLSL_130","    #define FXAA_GLSL_130 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_HLSL_3","    #define FXAA_HLSL_3 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_HLSL_4","    #define FXAA_HLSL_4 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_HLSL_5","    #define FXAA_HLSL_5 0","#endif","/*==========================================================================*/","#ifndef FXAA_GREEN_AS_LUMA","    //","    // For those using non-linear color,","    // and either not able to get luma in alpha, or not wanting to,","    // this enables FXAA to run using green as a proxy for luma.","    // So with this enabled, no need to pack luma in alpha.","    //","    // This will turn off AA on anything which lacks some amount of green.","    // Pure red and blue or combination of only R and B, will get no AA.","    //","    // Might want to lower the settings for both,","    //    fxaaConsoleEdgeThresholdMin","    //    fxaaQualityEdgeThresholdMin","    // In order to insure AA does not get turned off on colors","    // which contain a minor amount of green.","    //","    // 1 = On.","    // 0 = Off.","    //","    #define FXAA_GREEN_AS_LUMA 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_EARLY_EXIT","    //","    // Controls algorithm's early exit path.","    // On PS3 turning this ON adds 2 cycles to the shader.","    // On 360 turning this OFF adds 10ths of a millisecond to the shader.","    // Turning this off on console will result in a more blurry image.","    // So this defaults to on.","    //","    // 1 = On.","    // 0 = Off.","    //","    #define FXAA_EARLY_EXIT 1","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_DISCARD","    //","    // Only valid for PC OpenGL currently.","    // Probably will not work when FXAA_GREEN_AS_LUMA = 1.","    //","    // 1 = Use discard on pixels which don't need AA.","    //     For APIs which enable concurrent TEX+ROP from same surface.","    // 0 = Return unchanged color on pixels which don't need AA.","    //","    #define FXAA_DISCARD 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_FAST_PIXEL_OFFSET","    //","    // Used for GLSL 120 only.","    //","    // 1 = GL API supports fast pixel offsets","    // 0 = do not use fast pixel offsets","    //","    #ifdef GL_EXT_gpu_shader4","        #define FXAA_FAST_PIXEL_OFFSET 1","    #endif","    #ifdef GL_NV_gpu_shader5","        #define FXAA_FAST_PIXEL_OFFSET 1","    #endif","    #ifdef GL_ARB_gpu_shader5","        #define FXAA_FAST_PIXEL_OFFSET 1","    #endif","    #ifndef FXAA_FAST_PIXEL_OFFSET","        #define FXAA_FAST_PIXEL_OFFSET 0","    #endif","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_GATHER4_ALPHA","    //","    // 1 = API supports gather4 on alpha channel.","    // 0 = API does not support gather4 on alpha channel.","    //","    #if (FXAA_HLSL_5 == 1)","        #define FXAA_GATHER4_ALPHA 1","    #endif","    #ifdef GL_ARB_gpu_shader5","        #define FXAA_GATHER4_ALPHA 1","    #endif","    #ifdef GL_NV_gpu_shader5","        #define FXAA_GATHER4_ALPHA 1","    #endif","    #ifndef FXAA_GATHER4_ALPHA","        #define FXAA_GATHER4_ALPHA 0","    #endif","#endif","","","/*============================================================================","                        FXAA QUALITY - TUNING KNOBS","------------------------------------------------------------------------------","NOTE the other tuning knobs are now in the shader function inputs!","============================================================================*/","#ifndef FXAA_QUALITY_PRESET","    //","    // Choose the quality preset.","    // This needs to be compiled into the shader as it effects code.","    // Best option to include multiple presets is to","    // in each shader define the preset, then include this file.","    //","    // OPTIONS","    // -----------------------------------------------------------------------","    // 10 to 15 - default medium dither (10=fastest, 15=highest quality)","    // 20 to 29 - less dither, more expensive (20=fastest, 29=highest quality)","    // 39       - no dither, very expensive","    //","    // NOTES","    // -----------------------------------------------------------------------","    // 12 = slightly faster then FXAA 3.9 and higher edge quality (default)","    // 13 = about same speed as FXAA 3.9 and better than 12","    // 23 = closest to FXAA 3.9 visually and performance wise","    //  _ = the lowest digit is directly related to performance","    // _  = the highest digit is directly related to style","    //","    #define FXAA_QUALITY_PRESET 12","#endif","","","/*============================================================================","","                           FXAA QUALITY - PRESETS","","============================================================================*/","","/*============================================================================","                     FXAA QUALITY - MEDIUM DITHER PRESETS","============================================================================*/","#if (FXAA_QUALITY_PRESET == 10)","    #define FXAA_QUALITY_PS 3","    #define FXAA_QUALITY_P0 1.5","    #define FXAA_QUALITY_P1 3.0","    #define FXAA_QUALITY_P2 12.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 11)","    #define FXAA_QUALITY_PS 4","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 3.0","    #define FXAA_QUALITY_P3 12.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 12)","    #define FXAA_QUALITY_PS 5","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 4.0","    #define FXAA_QUALITY_P4 12.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 13)","    #define FXAA_QUALITY_PS 6","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 4.0","    #define FXAA_QUALITY_P5 12.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 14)","    #define FXAA_QUALITY_PS 7","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 4.0","    #define FXAA_QUALITY_P6 12.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 15)","    #define FXAA_QUALITY_PS 8","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 4.0","    #define FXAA_QUALITY_P7 12.0","#endif","","/*============================================================================","                     FXAA QUALITY - LOW DITHER PRESETS","============================================================================*/","#if (FXAA_QUALITY_PRESET == 20)","    #define FXAA_QUALITY_PS 3","    #define FXAA_QUALITY_P0 1.5","    #define FXAA_QUALITY_P1 2.0","    #define FXAA_QUALITY_P2 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 21)","    #define FXAA_QUALITY_PS 4","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 22)","    #define FXAA_QUALITY_PS 5","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 23)","    #define FXAA_QUALITY_PS 6","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 24)","    #define FXAA_QUALITY_PS 7","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 3.0","    #define FXAA_QUALITY_P6 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 25)","    #define FXAA_QUALITY_PS 8","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 4.0","    #define FXAA_QUALITY_P7 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 26)","    #define FXAA_QUALITY_PS 9","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 4.0","    #define FXAA_QUALITY_P8 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 27)","    #define FXAA_QUALITY_PS 10","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 2.0","    #define FXAA_QUALITY_P8 4.0","    #define FXAA_QUALITY_P9 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 28)","    #define FXAA_QUALITY_PS 11","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 2.0","    #define FXAA_QUALITY_P8 2.0","    #define FXAA_QUALITY_P9 4.0","    #define FXAA_QUALITY_P10 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 29)","    #define FXAA_QUALITY_PS 12","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 2.0","    #define FXAA_QUALITY_P8 2.0","    #define FXAA_QUALITY_P9 2.0","    #define FXAA_QUALITY_P10 4.0","    #define FXAA_QUALITY_P11 8.0","#endif","","/*============================================================================","                     FXAA QUALITY - EXTREME QUALITY","============================================================================*/","#if (FXAA_QUALITY_PRESET == 39)","    #define FXAA_QUALITY_PS 12","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.0","    #define FXAA_QUALITY_P2 1.0","    #define FXAA_QUALITY_P3 1.0","    #define FXAA_QUALITY_P4 1.0","    #define FXAA_QUALITY_P5 1.5","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 2.0","    #define FXAA_QUALITY_P8 2.0","    #define FXAA_QUALITY_P9 2.0","    #define FXAA_QUALITY_P10 4.0","    #define FXAA_QUALITY_P11 8.0","#endif","","","","/*============================================================================","","                                API PORTING","","============================================================================*/","#if (FXAA_GLSL_100 == 1) || (FXAA_GLSL_120 == 1) || (FXAA_GLSL_130 == 1)","    #define FxaaBool bool","    #define FxaaDiscard discard","    #define FxaaFloat float","    #define FxaaFloat2 vec2","    #define FxaaFloat3 vec3","    #define FxaaFloat4 vec4","    #define FxaaHalf float","    #define FxaaHalf2 vec2","    #define FxaaHalf3 vec3","    #define FxaaHalf4 vec4","    #define FxaaInt2 ivec2","    #define FxaaSat(x) clamp(x, 0.0, 1.0)","    #define FxaaTex sampler2D","#else","    #define FxaaBool bool","    #define FxaaDiscard clip(-1)","    #define FxaaFloat float","    #define FxaaFloat2 float2","    #define FxaaFloat3 float3","    #define FxaaFloat4 float4","    #define FxaaHalf half","    #define FxaaHalf2 half2","    #define FxaaHalf3 half3","    #define FxaaHalf4 half4","    #define FxaaSat(x) saturate(x)","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_GLSL_100 == 1)","  #define FxaaTexTop(t, p) texture2D(t, p, 0.0)","  #define FxaaTexOff(t, p, o, r) texture2D(t, p + (o * r), 0.0)","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_GLSL_120 == 1)","    // Requires,","    //  #version 120","    // And at least,","    //  #extension GL_EXT_gpu_shader4 : enable","    //  (or set FXAA_FAST_PIXEL_OFFSET 1 to work like DX9)","    #define FxaaTexTop(t, p) texture2DLod(t, p, 0.0)","    #if (FXAA_FAST_PIXEL_OFFSET == 1)","        #define FxaaTexOff(t, p, o, r) texture2DLodOffset(t, p, 0.0, o)","    #else","        #define FxaaTexOff(t, p, o, r) texture2DLod(t, p + (o * r), 0.0)","    #endif","    #if (FXAA_GATHER4_ALPHA == 1)","        // use #extension GL_ARB_gpu_shader5 : enable","        #define FxaaTexAlpha4(t, p) textureGather(t, p, 3)","        #define FxaaTexOffAlpha4(t, p, o) textureGatherOffset(t, p, o, 3)","        #define FxaaTexGreen4(t, p) textureGather(t, p, 1)","        #define FxaaTexOffGreen4(t, p, o) textureGatherOffset(t, p, o, 1)","    #endif","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_GLSL_130 == 1)",'    // Requires "#version 130" or better',"    #define FxaaTexTop(t, p) textureLod(t, p, 0.0)","    #define FxaaTexOff(t, p, o, r) textureLodOffset(t, p, 0.0, o)","    #if (FXAA_GATHER4_ALPHA == 1)","        // use #extension GL_ARB_gpu_shader5 : enable","        #define FxaaTexAlpha4(t, p) textureGather(t, p, 3)","        #define FxaaTexOffAlpha4(t, p, o) textureGatherOffset(t, p, o, 3)","        #define FxaaTexGreen4(t, p) textureGather(t, p, 1)","        #define FxaaTexOffGreen4(t, p, o) textureGatherOffset(t, p, o, 1)","    #endif","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_HLSL_3 == 1)","    #define FxaaInt2 float2","    #define FxaaTex sampler2D","    #define FxaaTexTop(t, p) tex2Dlod(t, float4(p, 0.0, 0.0))","    #define FxaaTexOff(t, p, o, r) tex2Dlod(t, float4(p + (o * r), 0, 0))","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_HLSL_4 == 1)","    #define FxaaInt2 int2","    struct FxaaTex { SamplerState smpl; Texture2D tex; };","    #define FxaaTexTop(t, p) t.tex.SampleLevel(t.smpl, p, 0.0)","    #define FxaaTexOff(t, p, o, r) t.tex.SampleLevel(t.smpl, p, 0.0, o)","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_HLSL_5 == 1)","    #define FxaaInt2 int2","    struct FxaaTex { SamplerState smpl; Texture2D tex; };","    #define FxaaTexTop(t, p) t.tex.SampleLevel(t.smpl, p, 0.0)","    #define FxaaTexOff(t, p, o, r) t.tex.SampleLevel(t.smpl, p, 0.0, o)","    #define FxaaTexAlpha4(t, p) t.tex.GatherAlpha(t.smpl, p)","    #define FxaaTexOffAlpha4(t, p, o) t.tex.GatherAlpha(t.smpl, p, o)","    #define FxaaTexGreen4(t, p) t.tex.GatherGreen(t.smpl, p)","    #define FxaaTexOffGreen4(t, p, o) t.tex.GatherGreen(t.smpl, p, o)","#endif","","","/*============================================================================","                   GREEN AS LUMA OPTION SUPPORT FUNCTION","============================================================================*/","#if (FXAA_GREEN_AS_LUMA == 0)","    FxaaFloat FxaaLuma(FxaaFloat4 rgba) { return rgba.w; }","#else","    FxaaFloat FxaaLuma(FxaaFloat4 rgba) { return rgba.y; }","#endif","","","","","/*============================================================================","","                             FXAA3 QUALITY - PC","","============================================================================*/","#if (FXAA_PC == 1)","/*--------------------------------------------------------------------------*/","FxaaFloat4 FxaaPixelShader(","    //","    // Use noperspective interpolation here (turn off perspective interpolation).","    // {xy} = center of pixel","    FxaaFloat2 pos,","    //","    // Used only for FXAA Console, and not used on the 360 version.","    // Use noperspective interpolation here (turn off perspective interpolation).","    // {xy_} = upper left of pixel","    // {_zw} = lower right of pixel","    FxaaFloat4 fxaaConsolePosPos,","    //","    // Input color texture.","    // {rgb_} = color in linear or perceptual color space","    // if (FXAA_GREEN_AS_LUMA == 0)","    //     {__a} = luma in perceptual color space (not linear)","    FxaaTex tex,","    //","    // Only used on the optimized 360 version of FXAA Console.",'    // For everything but 360, just use the same input here as for "tex".',"    // For 360, same texture, just alias with a 2nd sampler.","    // This sampler needs to have an exponent bias of -1.","    FxaaTex fxaaConsole360TexExpBiasNegOne,","    //","    // Only used on the optimized 360 version of FXAA Console.",'    // For everything but 360, just use the same input here as for "tex".',"    // For 360, same texture, just alias with a 3nd sampler.","    // This sampler needs to have an exponent bias of -2.","    FxaaTex fxaaConsole360TexExpBiasNegTwo,","    //","    // Only used on FXAA Quality.","    // This must be from a constant/uniform.","    // {x_} = 1.0/screenWidthInPixels","    // {_y} = 1.0/screenHeightInPixels","    FxaaFloat2 fxaaQualityRcpFrame,","    //","    // Only used on FXAA Console.","    // This must be from a constant/uniform.","    // This effects sub-pixel AA quality and inversely sharpness.","    //   Where N ranges between,","    //     N = 0.50 (default)","    //     N = 0.33 (sharper)","    // {x__} = -N/screenWidthInPixels","    // {_y_} = -N/screenHeightInPixels","    // {_z_} =  N/screenWidthInPixels","    // {__w} =  N/screenHeightInPixels","    FxaaFloat4 fxaaConsoleRcpFrameOpt,","    //","    // Only used on FXAA Console.","    // Not used on 360, but used on PS3 and PC.","    // This must be from a constant/uniform.","    // {x__} = -2.0/screenWidthInPixels","    // {_y_} = -2.0/screenHeightInPixels","    // {_z_} =  2.0/screenWidthInPixels","    // {__w} =  2.0/screenHeightInPixels","    FxaaFloat4 fxaaConsoleRcpFrameOpt2,","    //","    // Only used on FXAA Console.","    // Only used on 360 in place of fxaaConsoleRcpFrameOpt2.","    // This must be from a constant/uniform.","    // {x__} =  8.0/screenWidthInPixels","    // {_y_} =  8.0/screenHeightInPixels","    // {_z_} = -4.0/screenWidthInPixels","    // {__w} = -4.0/screenHeightInPixels","    FxaaFloat4 fxaaConsole360RcpFrameOpt2,","    //","    // Only used on FXAA Quality.","    // This used to be the FXAA_QUALITY_SUBPIX define.","    // It is here now to allow easier tuning.","    // Choose the amount of sub-pixel aliasing removal.","    // This can effect sharpness.","    //   1.00 - upper limit (softer)","    //   0.75 - default amount of filtering","    //   0.50 - lower limit (sharper, less sub-pixel aliasing removal)","    //   0.25 - almost off","    //   0.00 - completely off","    FxaaFloat fxaaQualitySubpix,","    //","    // Only used on FXAA Quality.","    // This used to be the FXAA_QUALITY_EDGE_THRESHOLD define.","    // It is here now to allow easier tuning.","    // The minimum amount of local contrast required to apply algorithm.","    //   0.333 - too little (faster)","    //   0.250 - low quality","    //   0.166 - default","    //   0.125 - high quality","    //   0.063 - overkill (slower)","    FxaaFloat fxaaQualityEdgeThreshold,","    //","    // Only used on FXAA Quality.","    // This used to be the FXAA_QUALITY_EDGE_THRESHOLD_MIN define.","    // It is here now to allow easier tuning.","    // Trims the algorithm from processing darks.","    //   0.0833 - upper limit (default, the start of visible unfiltered edges)","    //   0.0625 - high quality (faster)","    //   0.0312 - visible limit (slower)","    // Special notes when using FXAA_GREEN_AS_LUMA,","    //   Likely want to set this to zero.","    //   As colors that are mostly not-green","    //   will appear very dark in the green channel!","    //   Tune by looking at mostly non-green content,","    //   then start at zero and increase until aliasing is a problem.","    FxaaFloat fxaaQualityEdgeThresholdMin,","    //","    // Only used on FXAA Console.","    // This used to be the FXAA_CONSOLE_EDGE_SHARPNESS define.","    // It is here now to allow easier tuning.","    // This does not effect PS3, as this needs to be compiled in.","    //   Use FXAA_CONSOLE_PS3_EDGE_SHARPNESS for PS3.","    //   Due to the PS3 being ALU bound,","    //   there are only three safe values here: 2 and 4 and 8.","    //   These options use the shaders ability to a free *|/ by 2|4|8.","    // For all other platforms can be a non-power of two.","    //   8.0 is sharper (default!!!)","    //   4.0 is softer","    //   2.0 is really soft (good only for vector graphics inputs)","    FxaaFloat fxaaConsoleEdgeSharpness,","    //","    // Only used on FXAA Console.","    // This used to be the FXAA_CONSOLE_EDGE_THRESHOLD define.","    // It is here now to allow easier tuning.","    // This does not effect PS3, as this needs to be compiled in.","    //   Use FXAA_CONSOLE_PS3_EDGE_THRESHOLD for PS3.","    //   Due to the PS3 being ALU bound,","    //   there are only two safe values here: 1/4 and 1/8.","    //   These options use the shaders ability to a free *|/ by 2|4|8.","    // The console setting has a different mapping than the quality setting.","    // Other platforms can use other values.","    //   0.125 leaves less aliasing, but is softer (default!!!)","    //   0.25 leaves more aliasing, and is sharper","    FxaaFloat fxaaConsoleEdgeThreshold,","    //","    // Only used on FXAA Console.","    // This used to be the FXAA_CONSOLE_EDGE_THRESHOLD_MIN define.","    // It is here now to allow easier tuning.","    // Trims the algorithm from processing darks.","    // The console setting has a different mapping than the quality setting.","    // This only applies when FXAA_EARLY_EXIT is 1.","    // This does not apply to PS3,","    // PS3 was simplified to avoid more shader instructions.","    //   0.06 - faster but more aliasing in darks","    //   0.05 - default","    //   0.04 - slower and less aliasing in darks","    // Special notes when using FXAA_GREEN_AS_LUMA,","    //   Likely want to set this to zero.","    //   As colors that are mostly not-green","    //   will appear very dark in the green channel!","    //   Tune by looking at mostly non-green content,","    //   then start at zero and increase until aliasing is a problem.","    FxaaFloat fxaaConsoleEdgeThresholdMin,","    //","    // Extra constants for 360 FXAA Console only.","    // Use zeros or anything else for other platforms.","    // These must be in physical constant registers and NOT immedates.","    // Immedates will result in compiler un-optimizing.","    // {xyzw} = float4(1.0, -1.0, 0.25, -0.25)","    FxaaFloat4 fxaaConsole360ConstDir",") {","/*--------------------------------------------------------------------------*/","    FxaaFloat2 posM;","    posM.x = pos.x;","    posM.y = pos.y;","    #if (FXAA_GATHER4_ALPHA == 1)","        #if (FXAA_DISCARD == 0)","            FxaaFloat4 rgbyM = FxaaTexTop(tex, posM);","            #if (FXAA_GREEN_AS_LUMA == 0)","                #define lumaM rgbyM.w","            #else","                #define lumaM rgbyM.y","            #endif","        #endif","        #if (FXAA_GREEN_AS_LUMA == 0)","            FxaaFloat4 luma4A = FxaaTexAlpha4(tex, posM);","            FxaaFloat4 luma4B = FxaaTexOffAlpha4(tex, posM, FxaaInt2(-1, -1));","        #else","            FxaaFloat4 luma4A = FxaaTexGreen4(tex, posM);","            FxaaFloat4 luma4B = FxaaTexOffGreen4(tex, posM, FxaaInt2(-1, -1));","        #endif","        #if (FXAA_DISCARD == 1)","            #define lumaM luma4A.w","        #endif","        #define lumaE luma4A.z","        #define lumaS luma4A.x","        #define lumaSE luma4A.y","        #define lumaNW luma4B.w","        #define lumaN luma4B.z","        #define lumaW luma4B.x","    #else","        FxaaFloat4 rgbyM = FxaaTexTop(tex, posM);","        #if (FXAA_GREEN_AS_LUMA == 0)","            #define lumaM rgbyM.w","        #else","            #define lumaM rgbyM.y","        #endif","        #if (FXAA_GLSL_100 == 1)","          FxaaFloat lumaS = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 0.0, 1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 1.0, 0.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaN = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 0.0,-1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0, 0.0), fxaaQualityRcpFrame.xy));","        #else","          FxaaFloat lumaS = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 0, 1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1, 0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaN = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 0,-1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 0), fxaaQualityRcpFrame.xy));","        #endif","    #endif","/*--------------------------------------------------------------------------*/","    FxaaFloat maxSM = max(lumaS, lumaM);","    FxaaFloat minSM = min(lumaS, lumaM);","    FxaaFloat maxESM = max(lumaE, maxSM);","    FxaaFloat minESM = min(lumaE, minSM);","    FxaaFloat maxWN = max(lumaN, lumaW);","    FxaaFloat minWN = min(lumaN, lumaW);","    FxaaFloat rangeMax = max(maxWN, maxESM);","    FxaaFloat rangeMin = min(minWN, minESM);","    FxaaFloat rangeMaxScaled = rangeMax * fxaaQualityEdgeThreshold;","    FxaaFloat range = rangeMax - rangeMin;","    FxaaFloat rangeMaxClamped = max(fxaaQualityEdgeThresholdMin, rangeMaxScaled);","    FxaaBool earlyExit = range < rangeMaxClamped;","/*--------------------------------------------------------------------------*/","    if(earlyExit)","        #if (FXAA_DISCARD == 1)","            FxaaDiscard;","        #else","            return rgbyM;","        #endif","/*--------------------------------------------------------------------------*/","    #if (FXAA_GATHER4_ALPHA == 0)","        #if (FXAA_GLSL_100 == 1)","          FxaaFloat lumaNW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0,-1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaSE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 1.0, 1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 1.0,-1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0, 1.0), fxaaQualityRcpFrame.xy));","        #else","          FxaaFloat lumaNW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1,-1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaSE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1, 1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1,-1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 1), fxaaQualityRcpFrame.xy));","        #endif","    #else","        FxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(1, -1), fxaaQualityRcpFrame.xy));","        FxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 1), fxaaQualityRcpFrame.xy));","    #endif","/*--------------------------------------------------------------------------*/","    FxaaFloat lumaNS = lumaN + lumaS;","    FxaaFloat lumaWE = lumaW + lumaE;","    FxaaFloat subpixRcpRange = 1.0/range;","    FxaaFloat subpixNSWE = lumaNS + lumaWE;","    FxaaFloat edgeHorz1 = (-2.0 * lumaM) + lumaNS;","    FxaaFloat edgeVert1 = (-2.0 * lumaM) + lumaWE;","/*--------------------------------------------------------------------------*/","    FxaaFloat lumaNESE = lumaNE + lumaSE;","    FxaaFloat lumaNWNE = lumaNW + lumaNE;","    FxaaFloat edgeHorz2 = (-2.0 * lumaE) + lumaNESE;","    FxaaFloat edgeVert2 = (-2.0 * lumaN) + lumaNWNE;","/*--------------------------------------------------------------------------*/","    FxaaFloat lumaNWSW = lumaNW + lumaSW;","    FxaaFloat lumaSWSE = lumaSW + lumaSE;","    FxaaFloat edgeHorz4 = (abs(edgeHorz1) * 2.0) + abs(edgeHorz2);","    FxaaFloat edgeVert4 = (abs(edgeVert1) * 2.0) + abs(edgeVert2);","    FxaaFloat edgeHorz3 = (-2.0 * lumaW) + lumaNWSW;","    FxaaFloat edgeVert3 = (-2.0 * lumaS) + lumaSWSE;","    FxaaFloat edgeHorz = abs(edgeHorz3) + edgeHorz4;","    FxaaFloat edgeVert = abs(edgeVert3) + edgeVert4;","/*--------------------------------------------------------------------------*/","    FxaaFloat subpixNWSWNESE = lumaNWSW + lumaNESE;","    FxaaFloat lengthSign = fxaaQualityRcpFrame.x;","    FxaaBool horzSpan = edgeHorz >= edgeVert;","    FxaaFloat subpixA = subpixNSWE * 2.0 + subpixNWSWNESE;","/*--------------------------------------------------------------------------*/","    if(!horzSpan) lumaN = lumaW;","    if(!horzSpan) lumaS = lumaE;","    if(horzSpan) lengthSign = fxaaQualityRcpFrame.y;","    FxaaFloat subpixB = (subpixA * (1.0/12.0)) - lumaM;","/*--------------------------------------------------------------------------*/","    FxaaFloat gradientN = lumaN - lumaM;","    FxaaFloat gradientS = lumaS - lumaM;","    FxaaFloat lumaNN = lumaN + lumaM;","    FxaaFloat lumaSS = lumaS + lumaM;","    FxaaBool pairN = abs(gradientN) >= abs(gradientS);","    FxaaFloat gradient = max(abs(gradientN), abs(gradientS));","    if(pairN) lengthSign = -lengthSign;","    FxaaFloat subpixC = FxaaSat(abs(subpixB) * subpixRcpRange);","/*--------------------------------------------------------------------------*/","    FxaaFloat2 posB;","    posB.x = posM.x;","    posB.y = posM.y;","    FxaaFloat2 offNP;","    offNP.x = (!horzSpan) ? 0.0 : fxaaQualityRcpFrame.x;","    offNP.y = ( horzSpan) ? 0.0 : fxaaQualityRcpFrame.y;","    if(!horzSpan) posB.x += lengthSign * 0.5;","    if( horzSpan) posB.y += lengthSign * 0.5;","/*--------------------------------------------------------------------------*/","    FxaaFloat2 posN;","    posN.x = posB.x - offNP.x * FXAA_QUALITY_P0;","    posN.y = posB.y - offNP.y * FXAA_QUALITY_P0;","    FxaaFloat2 posP;","    posP.x = posB.x + offNP.x * FXAA_QUALITY_P0;","    posP.y = posB.y + offNP.y * FXAA_QUALITY_P0;","    FxaaFloat subpixD = ((-2.0)*subpixC) + 3.0;","    FxaaFloat lumaEndN = FxaaLuma(FxaaTexTop(tex, posN));","    FxaaFloat subpixE = subpixC * subpixC;","    FxaaFloat lumaEndP = FxaaLuma(FxaaTexTop(tex, posP));","/*--------------------------------------------------------------------------*/","    if(!pairN) lumaNN = lumaSS;","    FxaaFloat gradientScaled = gradient * 1.0/4.0;","    FxaaFloat lumaMM = lumaM - lumaNN * 0.5;","    FxaaFloat subpixF = subpixD * subpixE;","    FxaaBool lumaMLTZero = lumaMM < 0.0;","/*--------------------------------------------------------------------------*/","    lumaEndN -= lumaNN * 0.5;","    lumaEndP -= lumaNN * 0.5;","    FxaaBool doneN = abs(lumaEndN) >= gradientScaled;","    FxaaBool doneP = abs(lumaEndP) >= gradientScaled;","    if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P1;","    if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P1;","    FxaaBool doneNP = (!doneN) || (!doneP);","    if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P1;","    if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P1;","/*--------------------------------------------------------------------------*/","    if(doneNP) {","        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","        doneN = abs(lumaEndN) >= gradientScaled;","        doneP = abs(lumaEndP) >= gradientScaled;","        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P2;","        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P2;","        doneNP = (!doneN) || (!doneP);","        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P2;","        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P2;","/*--------------------------------------------------------------------------*/","        #if (FXAA_QUALITY_PS > 3)","        if(doneNP) {","            if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","            if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","            if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","            if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","            doneN = abs(lumaEndN) >= gradientScaled;","            doneP = abs(lumaEndP) >= gradientScaled;","            if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P3;","            if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P3;","            doneNP = (!doneN) || (!doneP);","            if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P3;","            if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P3;","/*--------------------------------------------------------------------------*/","            #if (FXAA_QUALITY_PS > 4)","            if(doneNP) {","                if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                doneN = abs(lumaEndN) >= gradientScaled;","                doneP = abs(lumaEndP) >= gradientScaled;","                if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P4;","                if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P4;","                doneNP = (!doneN) || (!doneP);","                if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P4;","                if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P4;","/*--------------------------------------------------------------------------*/","                #if (FXAA_QUALITY_PS > 5)","                if(doneNP) {","                    if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                    if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                    if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                    if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                    doneN = abs(lumaEndN) >= gradientScaled;","                    doneP = abs(lumaEndP) >= gradientScaled;","                    if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P5;","                    if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P5;","                    doneNP = (!doneN) || (!doneP);","                    if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P5;","                    if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P5;","/*--------------------------------------------------------------------------*/","                    #if (FXAA_QUALITY_PS > 6)","                    if(doneNP) {","                        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                        doneN = abs(lumaEndN) >= gradientScaled;","                        doneP = abs(lumaEndP) >= gradientScaled;","                        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P6;","                        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P6;","                        doneNP = (!doneN) || (!doneP);","                        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P6;","                        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P6;","/*--------------------------------------------------------------------------*/","                        #if (FXAA_QUALITY_PS > 7)","                        if(doneNP) {","                            if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                            if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                            if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                            if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                            doneN = abs(lumaEndN) >= gradientScaled;","                            doneP = abs(lumaEndP) >= gradientScaled;","                            if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P7;","                            if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P7;","                            doneNP = (!doneN) || (!doneP);","                            if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P7;","                            if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P7;","/*--------------------------------------------------------------------------*/","    #if (FXAA_QUALITY_PS > 8)","    if(doneNP) {","        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","        doneN = abs(lumaEndN) >= gradientScaled;","        doneP = abs(lumaEndP) >= gradientScaled;","        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P8;","        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P8;","        doneNP = (!doneN) || (!doneP);","        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P8;","        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P8;","/*--------------------------------------------------------------------------*/","        #if (FXAA_QUALITY_PS > 9)","        if(doneNP) {","            if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","            if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","            if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","            if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","            doneN = abs(lumaEndN) >= gradientScaled;","            doneP = abs(lumaEndP) >= gradientScaled;","            if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P9;","            if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P9;","            doneNP = (!doneN) || (!doneP);","            if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P9;","            if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P9;","/*--------------------------------------------------------------------------*/","            #if (FXAA_QUALITY_PS > 10)","            if(doneNP) {","                if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                doneN = abs(lumaEndN) >= gradientScaled;","                doneP = abs(lumaEndP) >= gradientScaled;","                if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P10;","                if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P10;","                doneNP = (!doneN) || (!doneP);","                if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P10;","                if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P10;","/*--------------------------------------------------------------------------*/","                #if (FXAA_QUALITY_PS > 11)","                if(doneNP) {","                    if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                    if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                    if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                    if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                    doneN = abs(lumaEndN) >= gradientScaled;","                    doneP = abs(lumaEndP) >= gradientScaled;","                    if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P11;","                    if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P11;","                    doneNP = (!doneN) || (!doneP);","                    if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P11;","                    if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P11;","/*--------------------------------------------------------------------------*/","                    #if (FXAA_QUALITY_PS > 12)","                    if(doneNP) {","                        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                        doneN = abs(lumaEndN) >= gradientScaled;","                        doneP = abs(lumaEndP) >= gradientScaled;","                        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P12;","                        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P12;","                        doneNP = (!doneN) || (!doneP);","                        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P12;","                        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P12;","/*--------------------------------------------------------------------------*/","                    }","                    #endif","/*--------------------------------------------------------------------------*/","                }","                #endif","/*--------------------------------------------------------------------------*/","            }","            #endif","/*--------------------------------------------------------------------------*/","        }","        #endif","/*--------------------------------------------------------------------------*/","    }","    #endif","/*--------------------------------------------------------------------------*/","                        }","                        #endif","/*--------------------------------------------------------------------------*/","                    }","                    #endif","/*--------------------------------------------------------------------------*/","                }","                #endif","/*--------------------------------------------------------------------------*/","            }","            #endif","/*--------------------------------------------------------------------------*/","        }","        #endif","/*--------------------------------------------------------------------------*/","    }","/*--------------------------------------------------------------------------*/","    FxaaFloat dstN = posM.x - posN.x;","    FxaaFloat dstP = posP.x - posM.x;","    if(!horzSpan) dstN = posM.y - posN.y;","    if(!horzSpan) dstP = posP.y - posM.y;","/*--------------------------------------------------------------------------*/","    FxaaBool goodSpanN = (lumaEndN < 0.0) != lumaMLTZero;","    FxaaFloat spanLength = (dstP + dstN);","    FxaaBool goodSpanP = (lumaEndP < 0.0) != lumaMLTZero;","    FxaaFloat spanLengthRcp = 1.0/spanLength;","/*--------------------------------------------------------------------------*/","    FxaaBool directionN = dstN < dstP;","    FxaaFloat dst = min(dstN, dstP);","    FxaaBool goodSpan = directionN ? goodSpanN : goodSpanP;","    FxaaFloat subpixG = subpixF * subpixF;","    FxaaFloat pixelOffset = (dst * (-spanLengthRcp)) + 0.5;","    FxaaFloat subpixH = subpixG * fxaaQualitySubpix;","/*--------------------------------------------------------------------------*/","    FxaaFloat pixelOffsetGood = goodSpan ? pixelOffset : 0.0;","    FxaaFloat pixelOffsetSubpix = max(pixelOffsetGood, subpixH);","    if(!horzSpan) posM.x += pixelOffsetSubpix * lengthSign;","    if( horzSpan) posM.y += pixelOffsetSubpix * lengthSign;","    #if (FXAA_DISCARD == 1)","        return FxaaTexTop(tex, posM);","    #else","        return FxaaFloat4(FxaaTexTop(tex, posM).xyz, lumaM);","    #endif","}","/*==========================================================================*/","#endif","","void main() {","  gl_FragColor = FxaaPixelShader(","    vUv,","    vec4(0.0),","    tDiffuse,","    tDiffuse,","    tDiffuse,","    resolution,","    vec4(0.0),","    vec4(0.0),","    vec4(0.0),","    0.75,","    0.166,","    0.0833,","    0.0,","    0.0,","    0.0,","    vec4(0.0)","  );","","  // TODO avoid querying texture twice for same texel","  gl_FragColor.a = texture2D(tDiffuse, vUv).a;","}"].join("\n")},THREE.GLTFLoader=function(){function e(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager,this.dracoLoader=null}function t(e){this.name=E.KHR_LIGHTS_PUNCTUAL;var t=e.extensions&&e.extensions[E.KHR_LIGHTS_PUNCTUAL]||{};this.lightDefs=t.lights||[]}function r(e){this.name=E.KHR_MATERIALS_UNLIT}function i(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=E.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,THREE.DRACOLoader.getDecoderModule()}function n(e){this.name=E.KHR_TEXTURE_TRANSFORM}function o(e,t,r,i){THREE.Interpolant.call(this,e,t,r,i)}function a(e,t){return"string"!=typeof e||""===e?"":/^(https?:)?\/\//i.test(e)?e:/^data:.*,.*$/i.test(e)?e:/^blob:.*$/i.test(e)?e:t+e}function s(){return new THREE.MeshStandardMaterial({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:THREE.FrontSide})}function l(e,t,r){for(var i in r.extensions)void 0===e[i]&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[i]=r.extensions[i])}function c(e,t){void 0!==t.extras&&("object"==typeof t.extras?e.userData=t.extras:console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+t.extras))}function u(e,t,r){for(var i=!1,n=!1,o=0,a=t.length;o<a;o++){if(void 0!==(c=t[o]).POSITION&&(i=!0),void 0!==c.NORMAL&&(n=!0),i&&n)break}if(!i&&!n)return Promise.resolve(e);for(var s=[],l=[],o=0,a=t.length;o<a;o++){var c=t[o];if(i){u=void 0!==c.POSITION?r.getDependency("accessor",c.POSITION).then(function(e){return g(e)}):e.attributes.position;s.push(u)}if(n){var u=void 0!==c.NORMAL?r.getDependency("accessor",c.NORMAL).then(function(e){return g(e)}):e.attributes.normal;l.push(u)}}return Promise.all([Promise.all(s),Promise.all(l)]).then(function(r){for(var o=r[0],a=r[1],s=0,l=t.length;s<l;s++){var c=t[s],u="morphTarget"+s;if(i&&void 0!==c.POSITION){var h=o[s];h.name=u;for(var p=e.attributes.position,d=0,f=h.count;d<f;d++)h.setXYZ(d,h.getX(d)+p.getX(d),h.getY(d)+p.getY(d),h.getZ(d)+p.getZ(d))}if(n&&void 0!==c.NORMAL){var m=a[s];m.name=u;for(var g=e.attributes.normal,d=0,f=m.count;d<f;d++)m.setXYZ(d,m.getX(d)+g.getX(d),m.getY(d)+g.getY(d),m.getZ(d)+g.getZ(d))}}return i&&(e.morphAttributes.position=o),n&&(e.morphAttributes.normal=a),e})}function h(e,t){if(e.updateMorphTargets(),void 0!==t.weights)for(var r=0,i=t.weights.length;r<i;r++)e.morphTargetInfluences[r]=t.weights[r];if(t.extras&&Array.isArray(t.extras.targetNames)){var n=t.extras.targetNames;if(e.morphTargetInfluences.length===n.length){e.morphTargetDictionary={};for(var r=0,i=n.length;r<i;r++)e.morphTargetDictionary[n[r]]=r}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function p(e,t){var r=e.extensions?e.extensions[E.KHR_DRACO_MESH_COMPRESSION]:void 0,i=t.extensions?t.extensions[E.KHR_DRACO_MESH_COMPRESSION]:void 0;return r&&i?r.bufferView===i.bufferView&&d(r.attributes,i.attributes):e.indices===t.indices&&d(e.attributes,t.attributes)}function d(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(var r in e)if(e[r]!==t[r])return!1;return!0}function f(e,t){if(e.length!==t.length)return!1;for(var r=0,i=e.length;r<i;r++)if(e[r]!==t[r])return!1;return!0}function m(e,t){for(var r=0,i=e.length;r<i;r++){var n=e[r];if(p(n.primitive,t))return n.promise}return null}function g(e){if(e.isInterleavedBufferAttribute){for(var t=e.count,r=e.itemSize,i=e.array.slice(0,t*r),n=0;n<t;++n)i[n]=e.getX(n),r>=2&&(i[n+1]=e.getY(n)),r>=3&&(i[n+2]=e.getZ(n)),r>=4&&(i[n+3]=e.getW(n));return new THREE.BufferAttribute(i,r,e.normalized)}return e.clone()}function v(e,t,r){this.json=e||{},this.extensions=t||{},this.options=r||{},this.cache=new function(){var e={};return{get:function(t){return e[t]},add:function(t,r){e[t]=r},remove:function(t){delete e[t]},removeAll:function(){e={}}}},this.primitiveCache=[],this.multiplePrimitivesCache=[],this.multiPassGeometryCache=[],this.textureLoader=new THREE.TextureLoader(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.fileLoader=new THREE.FileLoader(this.options.manager),this.fileLoader.setResponseType("arraybuffer")}function y(e,t,r){function i(t,i){return r.getDependency("accessor",t).then(function(t){e.addAttribute(i,t)})}var n=t.attributes,o=[];for(var a in n){var s=P[a];s&&(s in e.attributes||o.push(i(n[a],s)))}if(void 0!==t.indices&&!e.index){var l=r.getDependency("accessor",t.indices).then(function(t){e.setIndex(t)});o.push(l)}return c(e,t),Promise.all(o).then(function(){return void 0!==t.targets?u(e,t.targets,r):e})}e.prototype={constructor:e,crossOrigin:"anonymous",load:function(e,t,r,i){var n,o=this;n=void 0!==this.resourcePath?this.resourcePath:void 0!==this.path?this.path:THREE.LoaderUtils.extractUrlBase(e),o.manager.itemStart(e);var a=function(t){i?i(t):console.error(t),o.manager.itemError(e),o.manager.itemEnd(e)},s=new THREE.FileLoader(o.manager);s.setPath(this.path),s.setResponseType("arraybuffer"),s.load(e,function(r){try{o.parse(r,n,function(r){t(r),o.manager.itemEnd(e)},a)}catch(e){a(e)}},r,a)},setCrossOrigin:function(e){return this.crossOrigin=e,this},setPath:function(e){return this.path=e,this},setResourcePath:function(e){return this.resourcePath=e,this},setDRACOLoader:function(e){return this.dracoLoader=e,this},parse:function(e,o,a,s){var c,u={};if("string"==typeof e)c=e;else{if(THREE.LoaderUtils.decodeText(new Uint8Array(e,0,4))===b){try{u[E.KHR_BINARY_GLTF]=new function(e){this.name=E.KHR_BINARY_GLTF,this.content=null,this.body=null;var t=new DataView(e,0,x);if(this.header={magic:THREE.LoaderUtils.decodeText(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==b)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected. Use LegacyGLTFLoader instead.");for(var r=new DataView(e,x),i=0;i<r.byteLength;){var n=r.getUint32(i,!0);i+=4;var o=r.getUint32(i,!0);if(i+=4,o===_.JSON){var a=new Uint8Array(e,x+i,n);this.content=THREE.LoaderUtils.decodeText(a)}else if(o===_.BIN){var s=x+i;this.body=e.slice(s,s+n)}i+=n}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}(e)}catch(e){return void(s&&s(e))}c=u[E.KHR_BINARY_GLTF].content}else c=THREE.LoaderUtils.decodeText(new Uint8Array(e))}var h=JSON.parseX(c,this);if(void 0===h.asset||h.asset.version[0]<2)s&&s(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported. Use LegacyGLTFLoader instead."));else{if(h.extensionsUsed)for(var p=0;p<h.extensionsUsed.length;++p){var d=h.extensionsUsed[p],f=h.extensionsRequired||[];switch(d){case E.KHR_LIGHTS_PUNCTUAL:u[d]=new t(h);break;case E.KHR_MATERIALS_UNLIT:u[d]=new r(h);break;case E.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:u[d]=new function(){return{name:E.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,specularGlossinessParams:["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity","refractionRatio"],getMaterialType:function(){return THREE.ShaderMaterial},extendParams:function(e,t,r){var i=t.extensions[this.name],n=THREE.ShaderLib.standard,o=THREE.UniformsUtils.clone(n.uniforms),a=["#ifdef USE_SPECULARMAP","\tuniform sampler2D specularMap;","#endif"].join("\n"),s=["#ifdef USE_GLOSSINESSMAP","\tuniform sampler2D glossinessMap;","#endif"].join("\n"),l=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","\tvec4 texelSpecular = texture2D( specularMap, vUv );","\ttexelSpecular = sRGBToLinear( texelSpecular );","\t// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","\tspecularFactor *= texelSpecular.rgb;","#endif"].join("\n"),c=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","\tvec4 texelGlossiness = texture2D( glossinessMap, vUv );","\t// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","\tglossinessFactor *= texelGlossiness.a;","#endif"].join("\n"),u=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb;","material.specularRoughness = clamp( 1.0 - glossinessFactor, 0.04, 1.0 );","material.specularColor = specularFactor.rgb;"].join("\n"),h=n.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",a).replace("#include <metalnessmap_pars_fragment>",s).replace("#include <roughnessmap_fragment>",l).replace("#include <metalnessmap_fragment>",c).replace("#include <lights_physical_fragment>",u);delete o.roughness,delete o.metalness,delete o.roughnessMap,delete o.metalnessMap,o.specular={value:(new THREE.Color).setHex(1118481)},o.glossiness={value:.5},o.specularMap={value:null},o.glossinessMap={value:null},e.vertexShader=n.vertexShader,e.fragmentShader=h,e.uniforms=o,e.defines={STANDARD:""},e.color=new THREE.Color(1,1,1),e.opacity=1;var p=[];if(Array.isArray(i.diffuseFactor)){var d=i.diffuseFactor;e.color.fromArray(d),e.opacity=d[3]}if(void 0!==i.diffuseTexture&&p.push(r.assignTexture(e,"map",i.diffuseTexture)),e.emissive=new THREE.Color(0,0,0),e.glossiness=void 0!==i.glossinessFactor?i.glossinessFactor:1,e.specular=new THREE.Color(1,1,1),Array.isArray(i.specularFactor)&&e.specular.fromArray(i.specularFactor),void 0!==i.specularGlossinessTexture){var f=i.specularGlossinessTexture;p.push(r.assignTexture(e,"glossinessMap",f)),p.push(r.assignTexture(e,"specularMap",f))}return Promise.all(p)},createMaterial:function(e){var t=new THREE.ShaderMaterial({defines:e.defines,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader,uniforms:e.uniforms,fog:!0,lights:!0,opacity:e.opacity,transparent:e.transparent});return t.isGLTFSpecularGlossinessMaterial=!0,t.color=e.color,t.map=void 0===e.map?null:e.map,t.lightMap=null,t.lightMapIntensity=1,t.aoMap=void 0===e.aoMap?null:e.aoMap,t.aoMapIntensity=1,t.emissive=e.emissive,t.emissiveIntensity=1,t.emissiveMap=void 0===e.emissiveMap?null:e.emissiveMap,t.bumpMap=void 0===e.bumpMap?null:e.bumpMap,t.bumpScale=1,t.normalMap=void 0===e.normalMap?null:e.normalMap,e.normalScale&&(t.normalScale=e.normalScale),t.displacementMap=null,t.displacementScale=1,t.displacementBias=0,t.specularMap=void 0===e.specularMap?null:e.specularMap,t.specular=e.specular,t.glossinessMap=void 0===e.glossinessMap?null:e.glossinessMap,t.glossiness=e.glossiness,t.alphaMap=null,t.envMap=void 0===e.envMap?null:e.envMap,t.envMapIntensity=1,t.refractionRatio=.98,t.extensions.derivatives=!0,t},cloneMaterial:function(e){var t=e.clone();t.isGLTFSpecularGlossinessMaterial=!0;for(var r=this.specularGlossinessParams,i=0,n=r.length;i<n;i++)t[r[i]]=e[r[i]];return t},refreshUniforms:function(e,t,r,i,n,o){if(!0===n.isGLTFSpecularGlossinessMaterial){var a=n.uniforms,s=n.defines;a.opacity.value=n.opacity,a.diffuse.value.copy(n.color),a.emissive.value.copy(n.emissive).multiplyScalar(n.emissiveIntensity),a.map.value=n.map,a.specularMap.value=n.specularMap,a.alphaMap.value=n.alphaMap,a.lightMap.value=n.lightMap,a.lightMapIntensity.value=n.lightMapIntensity,a.aoMap.value=n.aoMap,a.aoMapIntensity.value=n.aoMapIntensity;var l;n.map?l=n.map:n.specularMap?l=n.specularMap:n.displacementMap?l=n.displacementMap:n.normalMap?l=n.normalMap:n.bumpMap?l=n.bumpMap:n.glossinessMap?l=n.glossinessMap:n.alphaMap?l=n.alphaMap:n.emissiveMap&&(l=n.emissiveMap),void 0!==l&&(l.isWebGLRenderTarget&&(l=l.texture),!0===l.matrixAutoUpdate&&l.updateMatrix(),a.uvTransform.value.copy(l.matrix)),n.envMap&&(a.envMap.value=n.envMap,a.envMapIntensity.value=n.envMapIntensity,a.flipEnvMap.value=n.envMap.isCubeTexture?-1:1,a.reflectivity.value=n.reflectivity,a.refractionRatio.value=n.refractionRatio,a.maxMipLevel.value=e.properties.get(n.envMap).__maxMipLevel),a.specular.value.copy(n.specular),a.glossiness.value=n.glossiness,a.glossinessMap.value=n.glossinessMap,a.emissiveMap.value=n.emissiveMap,a.bumpMap.value=n.bumpMap,a.normalMap.value=n.normalMap,a.displacementMap.value=n.displacementMap,a.displacementScale.value=n.displacementScale,a.displacementBias.value=n.displacementBias,null!==a.glossinessMap.value&&void 0===s.USE_GLOSSINESSMAP&&(s.USE_GLOSSINESSMAP="",s.USE_ROUGHNESSMAP=""),null===a.glossinessMap.value&&void 0!==s.USE_GLOSSINESSMAP&&(delete s.USE_GLOSSINESSMAP,delete s.USE_ROUGHNESSMAP)}}}}(h);break;case E.KHR_DRACO_MESH_COMPRESSION:u[d]=new i(h,this.dracoLoader);break;case E.MSFT_TEXTURE_DDS:u[E.MSFT_TEXTURE_DDS]=new function(){if(!THREE.DDSLoader)throw new Error("THREE.GLTFLoader: Attempting to load .dds texture without importing THREE.DDSLoader");this.name=E.MSFT_TEXTURE_DDS,this.ddsLoader=new THREE.DDSLoader}(h);break;case E.KHR_TEXTURE_TRANSFORM:u[E.KHR_TEXTURE_TRANSFORM]=new n(h);break;default:f.indexOf(d)>=0&&console.warn('THREE.GLTFLoader: Unknown extension "'+d+'".')}}var m=new v(h,u,{path:o||this.resourcePath||"",crossOrigin:this.crossOrigin,manager:this.manager});m.parse(function(e,t,r,i,n){m.getDependencies("material").then(function(o){var s={scene:e,scenes:t,cameras:r,animations:i,asset:n.asset,parser:m,userData:{},materials:o};l(u,s,n),a(s)})},s)}}};var E={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",MSFT_TEXTURE_DDS:"MSFT_texture_dds"};t.prototype.loadLight=function(e){var t,r=this.lightDefs[e],i=new THREE.Color(16777215);void 0!==r.color&&i.fromArray(r.color);var n=void 0!==r.range?r.range:0;switch(r.type){case"directional":(t=new THREE.DirectionalLight(i)).target.position.set(0,0,-1),t.add(t.target);break;case"point":(t=new THREE.PointLight(i)).distance=n;break;case"spot":(t=new THREE.SpotLight(i)).distance=n,r.spot=r.spot||{},r.spot.innerConeAngle=void 0!==r.spot.innerConeAngle?r.spot.innerConeAngle:0,r.spot.outerConeAngle=void 0!==r.spot.outerConeAngle?r.spot.outerConeAngle:Math.PI/4,t.angle=r.spot.outerConeAngle,t.penumbra=1-r.spot.innerConeAngle/r.spot.outerConeAngle,t.target.position.set(0,0,-1),t.add(t.target);break;default:throw new Error('THREE.GLTFLoader: Unexpected light type, "'+r.type+'".')}return t.decay=2,void 0!==r.intensity&&(t.intensity=r.intensity),t.name=r.name||"light_"+e,Promise.resolve(t)},r.prototype.getMaterialType=function(e){return THREE.MeshBasicMaterial},r.prototype.extendParams=function(e,t,r){var i=[];e.color=new THREE.Color(1,1,1),e.opacity=1;var n=t.pbrMetallicRoughness;if(n){if(Array.isArray(n.baseColorFactor)){var o=n.baseColorFactor;e.color.fromArray(o),e.opacity=o[3]}void 0!==n.baseColorTexture&&i.push(r.assignTexture(e,"map",n.baseColorTexture))}return Promise.all(i)};var b="glTF",x=12,_={JSON:1313821514,BIN:5130562};i.prototype.decodePrimitive=function(e,t){var r=this.json,i=this.dracoLoader,n=e.extensions[this.name].bufferView,o=e.extensions[this.name].attributes,a={},s={},l={};for(var c in o)c in P&&(a[P[c]]=o[c]);for(c in e.attributes)if(void 0!==P[c]&&void 0!==o[c]){var u=r.accessors[e.attributes[c]],h=T[u.componentType];l[P[c]]=h,s[P[c]]=!0===u.normalized}return t.getDependency("bufferView",n).then(function(e){return new Promise(function(t){i.decodeDracoFile(e,function(e){for(var r in e.attributes){var i=e.attributes[r],n=s[r];void 0!==n&&(i.normalized=n)}t(e)},a,l)})})},n.prototype.extendTexture=function(e,t){return e=e.clone(),void 0!==t.offset&&e.offset.fromArray(t.offset),void 0!==t.rotation&&(e.rotation=t.rotation),void 0!==t.scale&&e.repeat.fromArray(t.scale),void 0!==t.texCoord&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),e.needsUpdate=!0,e},(o.prototype=Object.create(THREE.Interpolant.prototype)).constructor=o,o.prototype.copySampleValue_=function(e){for(var t=this.resultBuffer,r=this.sampleValues,i=this.valueSize,n=e*i*3+i,o=0;o!==i;o++)t[o]=r[n+o];return t},o.prototype.beforeStart_=o.prototype.copySampleValue_,o.prototype.afterEnd_=o.prototype.copySampleValue_,o.prototype.interpolate_=function(e,t,r,i){for(var n=this.resultBuffer,o=this.sampleValues,a=this.valueSize,s=2*a,l=3*a,c=i-t,u=(r-t)/c,h=u*u,p=h*u,d=e*l,f=d-l,m=-2*p+3*h,g=p-h,v=1-m,y=g-h+u,E=0;E!==a;E++){var b=o[f+E+a],x=o[f+E+s]*c,_=o[d+E+a],w=o[d+E]*c;n[E]=v*b+y*x+m*_+g*w}return n};var w={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},T=(Number,THREE.Matrix3,THREE.Matrix4,THREE.Vector2,THREE.Vector3,THREE.Vector4,THREE.Texture,{5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array}),M={9728:THREE.NearestFilter,9729:THREE.LinearFilter,9984:THREE.NearestMipMapNearestFilter,9985:THREE.LinearMipMapNearestFilter,9986:THREE.NearestMipMapLinearFilter,9987:THREE.LinearMipMapLinearFilter},R={33071:THREE.ClampToEdgeWrapping,33648:THREE.MirroredRepeatWrapping,10497:THREE.RepeatWrapping},S=(THREE.BackSide,THREE.FrontSide,THREE.NeverDepth,THREE.LessDepth,THREE.EqualDepth,THREE.LessEqualDepth,THREE.GreaterEqualDepth,THREE.NotEqualDepth,THREE.GreaterEqualDepth,THREE.AlwaysDepth,THREE.AddEquation,THREE.SubtractEquation,THREE.ReverseSubtractEquation,THREE.ZeroFactor,THREE.OneFactor,THREE.SrcColorFactor,THREE.OneMinusSrcColorFactor,THREE.SrcAlphaFactor,THREE.OneMinusSrcAlphaFactor,THREE.DstAlphaFactor,THREE.OneMinusDstAlphaFactor,THREE.DstColorFactor,THREE.OneMinusDstColorFactor,THREE.SrcAlphaSaturateFactor,{SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16}),P={POSITION:"position",NORMAL:"normal",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",TEXCOORD_2:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},A={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},C={CUBICSPLINE:THREE.InterpolateSmooth,LINEAR:THREE.InterpolateLinear,STEP:THREE.InterpolateDiscrete},L={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"},O={"image/png":THREE.RGBAFormat,"image/jpeg":THREE.RGBFormat};return v.prototype.parse=function(e,t){var r=this.json;this.cache.removeAll(),this.markDefs(),this.getMultiDependencies(["scene","animation","camera"]).then(function(t){var i=t.scenes||[],n=i[r.scene||0],o=t.animations||[],a=t.cameras||[];e(n,i,a,o,r)}).catch(t)},v.prototype.markDefs=function(){for(var e=this.json.nodes||[],t=this.json.skins||[],r=this.json.meshes||[],i={},n={},o=0,a=t.length;o<a;o++)for(var s=t[o].joints,l=0,c=s.length;l<c;l++)e[s[l]].isBone=!0;for(var u=0,h=e.length;u<h;u++){var p=e[u];void 0!==p.mesh&&(void 0===i[p.mesh]&&(i[p.mesh]=n[p.mesh]=0),i[p.mesh]++,void 0!==p.skin&&(r[p.mesh].isSkinnedMesh=!0))}this.json.meshReferences=i,this.json.meshUses=n},v.prototype.getDependency=function(e,t){var r=e+":"+t,i=this.cache.get(r);if(!i){switch(e){case"scene":i=this.loadScene(t);break;case"node":i=this.loadNode(t);break;case"mesh":i=this.loadMesh(t);break;case"accessor":i=this.loadAccessor(t);break;case"bufferView":i=this.loadBufferView(t);break;case"buffer":i=this.loadBuffer(t);break;case"material":i=this.loadMaterial(t);break;case"texture":i=this.loadTexture(t);break;case"skin":i=this.loadSkin(t);break;case"animation":i=this.loadAnimation(t);break;case"camera":i=this.loadCamera(t);break;case"light":i=this.extensions[E.KHR_LIGHTS_PUNCTUAL].loadLight(t);break;default:throw new Error("Unknown type: "+e)}this.cache.add(r,i)}return i},v.prototype.getDependencies=function(e){var t=this.cache.get(e);if(!t){var r=this,i=this.json[e+("mesh"===e?"es":"s")]||[];t=Promise.all(i.map(function(t,i){return r.getDependency(e,i)})),this.cache.add(e,t)}return t},v.prototype.getMultiDependencies=function(e){for(var t={},r=[],i=0,n=e.length;i<n;i++){var o=e[i],a=this.getDependencies(o);a=a.then(function(e,r){t[e]=r}.bind(this,o+("mesh"===o?"es":"s"))),r.push(a)}return Promise.all(r).then(function(){return t})},v.prototype.loadBuffer=function(e){var t=this.json.buffers[e],r=this.fileLoader;if(t.type&&"arraybuffer"!==t.type)throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(void 0===t.uri&&0===e)return Promise.resolve(this.extensions[E.KHR_BINARY_GLTF].body);var i=this.options;return new Promise(function(e,n){r.load(a(t.uri,i.path),e,void 0,function(){n(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})},v.prototype.loadBufferView=function(e){var t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(e){var r=t.byteLength||0,i=t.byteOffset||0;return e.slice(i,i+r)})},v.prototype.loadAccessor=function(e){var t=this,r=this.json,i=this.json.accessors[e];if(void 0===i.bufferView&&void 0===i.sparse)return Promise.resolve(null);var n=[];return void 0!==i.bufferView?n.push(this.getDependency("bufferView",i.bufferView)):n.push(null),void 0!==i.sparse&&(n.push(this.getDependency("bufferView",i.sparse.indices.bufferView)),n.push(this.getDependency("bufferView",i.sparse.values.bufferView))),Promise.all(n).then(function(e){var n,o,a=e[0],s=S[i.type],l=T[i.componentType],c=l.BYTES_PER_ELEMENT,u=c*s,h=i.byteOffset||0,p=void 0!==i.bufferView?r.bufferViews[i.bufferView].byteStride:void 0,d=!0===i.normalized;if(p&&p!==u){var f="InterleavedBuffer:"+i.bufferView+":"+i.componentType,m=t.cache.get(f);m||(n=new l(a),m=new THREE.InterleavedBuffer(n,p/c),t.cache.add(f,m)),o=new THREE.InterleavedBufferAttribute(m,s,h/c,d)}else n=null===a?new l(i.count*s):new l(a,h,i.count*s),o=new THREE.BufferAttribute(n,s,d);if(void 0!==i.sparse){var g=S.SCALAR,v=T[i.sparse.indices.componentType],y=i.sparse.indices.byteOffset||0,E=i.sparse.values.byteOffset||0,b=new v(e[1],y,i.sparse.count*g),x=new l(e[2],E,i.sparse.count*s);null!==a&&o.setArray(o.array.slice());for(var _=0,w=b.length;_<w;_++){var M=b[_];if(o.setX(M,x[_*s]),s>=2&&o.setY(M,x[_*s+1]),s>=3&&o.setZ(M,x[_*s+2]),s>=4&&o.setW(M,x[_*s+3]),s>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return o})},v.prototype.loadTexture=function(e){var t,r=this,i=this.json,n=this.options,o=this.textureLoader,s=window.URL||window.webkitURL,l=i.textures[e],c=l.extensions||{},u=(t=c[E.MSFT_TEXTURE_DDS]?i.images[c[E.MSFT_TEXTURE_DDS].source]:i.images[l.source]).uri,h=!1;return void 0!==t.bufferView&&(u=r.getDependency("bufferView",t.bufferView).then(function(e){h=!0;var r=new Blob([e],{type:t.mimeType});return u=s.createObjectURL(r)})),Promise.resolve(u).then(function(e){var t=THREE.Loader.Handlers.get(e);return t||(t=c[E.MSFT_TEXTURE_DDS]?r.extensions[E.MSFT_TEXTURE_DDS].ddsLoader:o),new Promise(function(r,i){t.load(a(e,n.path),r,void 0,i)})}).then(function(e){!0===h&&s.revokeObjectURL(u),e.flipY=!1,void 0!==l.name&&(e.name=l.name),t.mimeType in O&&(e.format=O[t.mimeType]);var r=(i.samplers||{})[l.sampler]||{};return e.magFilter=M[r.magFilter]||THREE.LinearFilter,e.minFilter=M[r.minFilter]||THREE.LinearMipMapLinearFilter,e.wrapS=R[r.wrapS]||THREE.RepeatWrapping,e.wrapT=R[r.wrapT]||THREE.RepeatWrapping,e})},v.prototype.assignTexture=function(e,t,r){var i=this;return this.getDependency("texture",r.index).then(function(n){if(i.extensions[E.KHR_TEXTURE_TRANSFORM]){var o=void 0!==r.extensions?r.extensions[E.KHR_TEXTURE_TRANSFORM]:void 0;o&&(n=i.extensions[E.KHR_TEXTURE_TRANSFORM].extendTexture(n,o))}e[t]=n})},v.prototype.loadMaterial=function(e){var t,r=this.json,i=this.extensions,n=r.materials[e],o={},a=n.extensions||{},s=[];if(a[E.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){var u=i[E.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];t=u.getMaterialType(n),s.push(u.extendParams(o,n,this))}else if(a[E.KHR_MATERIALS_UNLIT]){var h=i[E.KHR_MATERIALS_UNLIT];t=h.getMaterialType(n),s.push(h.extendParams(o,n,this))}else{t=THREE.MeshStandardMaterial;var p=n.pbrMetallicRoughness||{};if(o.color=new THREE.Color(1,1,1),o.opacity=1,Array.isArray(p.baseColorFactor)){var d=p.baseColorFactor;o.color.fromArray(d),o.opacity=d[3]}void 0!==p.baseColorTexture&&(s.push(this.assignTexture(o,"map",p.baseColorTexture)),1==p.baseColorTexture.texCoord&&(o.__useDiffuseUV2=!0)),o.metalness=void 0!==p.metallicFactor?p.metallicFactor:1,o.roughness=void 0!==p.roughnessFactor?p.roughnessFactor:1,void 0!==p.metallicRoughnessTexture&&(s.push(this.assignTexture(o,"metalnessMap",p.metallicRoughnessTexture)),s.push(this.assignTexture(o,"roughnessMap",p.metallicRoughnessTexture)))}!0===n.doubleSided&&(o.side=THREE.DoubleSide);var f=n.alphaMode||L.OPAQUE;f===L.BLEND?o.transparent=!0:(o.transparent=!1,f===L.MASK&&(o.alphaTest=void 0!==n.alphaCutoff?n.alphaCutoff:.5)),void 0!==n.normalTexture&&t!==THREE.MeshBasicMaterial&&(s.push(this.assignTexture(o,"normalMap",n.normalTexture)),o.normalScale=new THREE.Vector2(1,1),void 0!==n.normalTexture.scale&&o.normalScale.set(n.normalTexture.scale,n.normalTexture.scale)),void 0!==n.occlusionTexture&&t!==THREE.MeshBasicMaterial&&(s.push(this.assignTexture(o,"aoMap",n.occlusionTexture)),void 0!==n.occlusionTexture.strength&&(o.aoMapIntensity=n.occlusionTexture.strength)),void 0!==n.emissiveFactor&&t!==THREE.MeshBasicMaterial&&(o.emissive=(new THREE.Color).fromArray(n.emissiveFactor)),void 0!==n.emissiveTexture&&t!==THREE.MeshBasicMaterial&&s.push(this.assignTexture(o,"emissiveMap",n.emissiveTexture));var m=[],g=a.blend;if(g)for(var v=0;v<g.length;v++)g[v].maskTexture&&s.push(this.assignTexture(m,v,g[v].maskTexture));return Promise.all(s).then(function(){var e,r=o.__useDiffuseUV2;r&&delete o.__useDiffuseUV2,e=t===THREE.ShaderMaterial?i[E.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(o):new t(o),void 0!==n.name&&(e.name=n.name),e.normalScale&&(e.normalScale.y=-e.normalScale.y),e.map&&(e.map.encoding=THREE.sRGBEncoding),e.emissiveMap&&(e.emissiveMap.encoding=THREE.sRGBEncoding),e.specularMap&&(e.specularMap.encoding=THREE.sRGBEncoding),c(e,n),n.extensions&&l(i,e,n);for(var s in a)void 0===i[s]&&("sceneBlend"===s?(e.transparent=!0,e.blending=void 0===THREE[a[s]+"Blending"]?1:THREE[a[s]+"Blending"]):"blend"===s&&(e.__texture=m));var u=n.pbrMetallicRoughness.baseColorTexture,h=n.emissiveTexture,p=n.normalTexture;return void 0===e.userData.gltfExtensions&&(e.userData.gltfExtensions={}),u&&u.extensions&&(e.userData.gltfExtensions.baseColorTexture=u.extensions),h&&h.extensions&&(e.userData.gltfExtensions.emissiveTexture=h.extensions),p&&p.extensions&&(e.userData.gltfExtensions.normalTexture=p.extensions),r&&(e.userData.gltfExtensions.useDiffuseUV2=!0),e})},v.prototype.loadGeometries=function(e){function t(e){return n[E.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(e,i).then(function(t){return y(t,e,i)})}var r,i=this,n=this.extensions,o=this.primitiveCache,a=function(e){if(e.length<2)return!1;var t=e[0],r=t.targets||[];if(void 0===t.indices)return!1;for(var i=1,n=e.length;i<n;i++){var o=e[i];if(t.mode!==o.mode)return!1;if(void 0===o.indices)return!1;if(o.extensions&&o.extensions[E.KHR_DRACO_MESH_COMPRESSION])return!1;if(!d(t.attributes,o.attributes))return!1;var a=o.targets||[];if(r.length!==a.length)return!1;for(var s=0,l=r.length;s<l;s++)if(!d(r[s],a[s]))return!1}return!0}(e);a&&(r=e,e=[e[0]]);for(var s=[],l=0,c=e.length;l<c;l++){var u=e[l],h=m(o,u);if(h)s.push(h);else{var p;p=u.extensions&&u.extensions[E.KHR_DRACO_MESH_COMPRESSION]?t(u):y(new THREE.BufferGeometry,u,i),o.push({primitive:u,promise:p}),s.push(p)}}return Promise.all(s).then(function(t){if(a){var n=t[0];if(null!==(h=function(e,t,r){for(var i=0,n=e.length;i<n;i++){var o=e[i];if(t===o.baseGeometry&&f(r,o.primitives))return o.geometry}return null}(u=i.multiPassGeometryCache,n,r)))return[h.geometry];(p=new THREE.BufferGeometry).name=n.name,p.userData=n.userData;for(var o in n.attributes)p.addAttribute(o,n.attributes[o]);for(var o in n.morphAttributes)p.morphAttributes[o]=n.morphAttributes[o];for(var s=[],l=0,c=r.length;l<c;l++)s.push(i.getDependency("accessor",r[l].indices));return Promise.all(s).then(function(e){for(var t=[],i=0,o=0,a=r.length;o<a;o++){for(var s=e[o],l=0,c=s.count;l<c;l++)t.push(s.array[l]);p.addGroup(i,s.count,o),i+=s.count}return p.setIndex(t),u.push({geometry:p,baseGeometry:n,primitives:r}),[p]})}if(t.length>1&&void 0!==THREE.BufferGeometryUtils){for(var l=1,c=e.length;l<c;l++)if(e[0].mode!==e[l].mode)return t;var u=i.multiplePrimitivesCache,h=function(e,t){for(var r=0,i=e.length;r<i;r++){var n=e[r];if(f(t,n.baseGeometries))return n.geometry}return null}(u,t);if(h){if(null!==h.geometry)return[h.geometry]}else{var p=THREE.BufferGeometryUtils.mergeBufferGeometries(t,!0);if(u.push({geometry:p,baseGeometries:t}),null!==p)return[p]}}return t})},v.prototype.loadMesh=function(e){for(var t=this,r=this.json,i=this.extensions,n=r.meshes[e],o=n.primitives,a=[],l=0,u=o.length;l<u;l++){var p=void 0===o[l].material?s():this.getDependency("material",o[l].material);a.push(p)}return Promise.all(a).then(function(r){return t.loadGeometries(o).then(function(a){for(var s=1===a.length&&a[0].groups.length>0,l=[],u=0,p=a.length;u<p;u++){var d,f=a[u],m=o[u],g=s?r:r[u];if(m.mode===w.TRIANGLES||m.mode===w.TRIANGLE_STRIP||m.mode===w.TRIANGLE_FAN||void 0===m.mode)!0===(d=!0===n.isSkinnedMesh?new THREE.SkinnedMesh(f,g):new THREE.Mesh(f,g)).isSkinnedMesh&&d.normalizeSkinWeights(),m.mode===w.TRIANGLE_STRIP?d.drawMode=THREE.TriangleStripDrawMode:m.mode===w.TRIANGLE_FAN&&(d.drawMode=THREE.TriangleFanDrawMode);else if(m.mode===w.LINES)d=new THREE.LineSegments(f,g);else if(m.mode===w.LINE_STRIP)d=new THREE.Line(f,g);else if(m.mode===w.LINE_LOOP)d=new THREE.LineLoop(f,g);else{if(m.mode!==w.POINTS)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+m.mode);d=new THREE.Points(f,g)}Object.keys(d.geometry.morphAttributes).length>0&&h(d,n),d.name=n.name||"mesh_"+e,a.length>1&&(d.name+="_"+u),c(d,n),l.push(d);for(var v=s?d.material:[d.material],y=void 0!==f.attributes.color,b=void 0===f.attributes.normal,x=!0===d.isSkinnedMesh,_=Object.keys(f.morphAttributes).length>0,T=_&&void 0!==f.morphAttributes.normal,M=0,R=v.length;M<R;M++){g=v[M];if(d.isPoints){var S="PointsMaterial:"+g.uuid,P=t.cache.get(S);P||(P=new THREE.PointsMaterial,THREE.Material.prototype.copy.call(P,g),P.color.copy(g.color),P.map=g.map,P.lights=!1,t.cache.add(S,P)),g=P}else if(d.isLine){var S="LineBasicMaterial:"+g.uuid,A=t.cache.get(S);A||(A=new THREE.LineBasicMaterial,THREE.Material.prototype.copy.call(A,g),A.color.copy(g.color),A.lights=!1,t.cache.add(S,A)),g=A}if(y||b||x||_){S="ClonedMaterial:"+g.uuid+":";g.isGLTFSpecularGlossinessMaterial&&(S+="specular-glossiness:"),x&&(S+="skinning:"),y&&(S+="vertex-colors:"),b&&(S+="flat-shading:"),_&&(S+="morph-targets:"),T&&(S+="morph-normals:");var C=t.cache.get(S);C||(C=g.isGLTFSpecularGlossinessMaterial?i[E.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].cloneMaterial(g):g.clone(),x&&(C.skinning=!0),y&&(C.vertexColors=THREE.VertexColors),b&&(C.flatShading=!0),_&&(C.morphTargets=!0),T&&(C.morphNormals=!0),t.cache.add(S,C)),g=C}v[M]=g,g.aoMap&&void 0===f.attributes.uv2&&void 0!==f.attributes.uv&&(console.log("THREE.GLTFLoader: Duplicating UVs to support aoMap."),f.addAttribute("uv2",new THREE.BufferAttribute(f.attributes.uv.array,2))),g.isGLTFSpecularGlossinessMaterial&&(d.onBeforeRender=i[E.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].refreshUniforms)}d.material=s?v:v[0]}if(1===l.length)return l[0];for(var L=new THREE.Group,u=0,p=l.length;u<p;u++)L.add(l[u]);return L})})},v.prototype.loadCamera=function(e){var t,r=this.json.cameras[e],i=r[r.type];if(i)return"perspective"===r.type?t=new THREE.PerspectiveCamera(THREE.Math.radToDeg(i.yfov),i.aspectRatio||1,i.znear||1,i.zfar||2e6):"orthographic"===r.type&&(t=new THREE.OrthographicCamera(i.xmag/-2,i.xmag/2,i.ymag/2,i.ymag/-2,i.znear,i.zfar)),void 0!==r.name&&(t.name=r.name),c(t,r),Promise.resolve(t);console.warn("THREE.GLTFLoader: Missing camera parameters.")},v.prototype.loadSkin=function(e){var t=this.json.skins[e],r={joints:t.joints};return void 0===t.inverseBindMatrices?Promise.resolve(r):this.getDependency("accessor",t.inverseBindMatrices).then(function(e){return r.inverseBindMatrices=e,r})},v.prototype.loadAnimation=function(e){for(var t=this.json.animations[e],r=[],i=[],n=[],a=[],s=[],l=0,c=t.channels.length;l<c;l++){var u=t.channels[l],h=t.samplers[u.sampler],p=u.target,d=void 0!==p.node?p.node:p.id,f=void 0!==t.parameters?t.parameters[h.input]:h.input,m=void 0!==t.parameters?t.parameters[h.output]:h.output;r.push(this.getDependency("node",d)),i.push(this.getDependency("accessor",f)),n.push(this.getDependency("accessor",m)),a.push(h),s.push(p)}return Promise.all([Promise.all(r),Promise.all(i),Promise.all(n),Promise.all(a),Promise.all(s)]).then(function(r){for(var i=r[0],n=r[1],a=r[2],s=r[3],l=r[4],c=[],u=0,h=i.length;u<h;u++){var p=i[u],d=n[u],f=a[u],m=s[u],g=l[u];if(void 0!==p){p.updateMatrix(),p.matrixAutoUpdate=!0;var v;switch(A[g.path]){case A.weights:v=THREE.NumberKeyframeTrack;break;case A.rotation:v=THREE.QuaternionKeyframeTrack;break;case A.position:case A.scale:default:v=THREE.VectorKeyframeTrack}var y=p.name?p.name:p.uuid,E=void 0!==m.interpolation?C[m.interpolation]:THREE.InterpolateLinear,b=[];A[g.path]===A.weights?p.traverse(function(e){!0===e.isMesh&&e.morphTargetInfluences&&b.push(e.name?e.name:e.uuid)}):b.push(y);for(var x=0,_=b.length;x<_;x++){var w=new v(b[x]+"."+A[g.path],THREE.AnimationUtils.arraySlice(d.array,0),THREE.AnimationUtils.arraySlice(f.array,0),E);"CUBICSPLINE"===m.interpolation&&(w.createInterpolant=function(e){return new o(this.times,this.values,this.getValueSize()/3,e)},w.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),c.push(w)}}}var T=void 0!==t.name?t.name:"animation_"+e;return new THREE.AnimationClip(T,void 0,c)})},v.prototype.loadNode=function(e){var t=this.json,r=this.extensions,i=this,n=t.meshReferences,o=t.meshUses,a=t.nodes[e];return new Promise(function(e){!0===a.isBone?e(new THREE.Bone):void 0!==a.mesh?i.getDependency("mesh",a.mesh).then(function(t){var r;if(n[a.mesh]>1){var i=o[a.mesh]++;(r=t.clone()).name+="_instance_"+i,r.onBeforeRender=t.onBeforeRender;for(var s=0,l=r.children.length;s<l;s++)r.children[s].name+="_instance_"+i,r.children[s].onBeforeRender=t.children[s].onBeforeRender}else r=t;e(r)}):void 0!==a.camera?i.getDependency("camera",a.camera).then(e):a.extensions&&a.extensions[E.KHR_LIGHTS_PUNCTUAL]&&void 0!==a.extensions[E.KHR_LIGHTS_PUNCTUAL].light?i.getDependency("light",a.extensions[E.KHR_LIGHTS_PUNCTUAL].light).then(e):e(new THREE.Object3D)}).then(function(e){if(void 0!==a.name&&(e.name=THREE.PropertyBinding.sanitizeNodeName(a.name)),c(e,a),a.extensions&&l(r,e,a),void 0!==a.matrix){var t=new THREE.Matrix4;t.fromArray(a.matrix),e.applyMatrix(t)}else void 0!==a.translation&&e.position.fromArray(a.translation),void 0!==a.rotation&&e.quaternion.fromArray(a.rotation),void 0!==a.scale&&e.scale.fromArray(a.scale);return e})},v.prototype.loadScene=function(){function e(t,r,i,n){var o=i.nodes[t];return n.getDependency("node",t).then(function(e){if(void 0===o.skin)return e;var t;return n.getDependency("skin",o.skin).then(function(e){for(var r=[],i=0,o=(t=e).joints.length;i<o;i++)r.push(n.getDependency("node",t.joints[i]));return Promise.all(r)}).then(function(r){for(var i=!0===e.isGroup?e.children:[e],n=0,o=i.length;n<o;n++){for(var a=i[n],s=[],l=[],c=0,u=r.length;c<u;c++){var h=r[c];if(h){s.push(h);var p=new THREE.Matrix4;void 0!==t.inverseBindMatrices&&p.fromArray(t.inverseBindMatrices.array,16*c),l.push(p)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[c])}a.bind(new THREE.Skeleton(s,l),a.matrixWorld)}return e})}).then(function(t){r.add(t);var a=[];if(o.children)for(var s=o.children,l=0,c=s.length;l<c;l++){var u=s[l];a.push(e(u,t,i,n))}return Promise.all(a)})}return function(t){var r=this.json,i=this.extensions,n=this.json.scenes[t],o=new THREE.Scene;void 0!==n.name&&(o.name=n.name),c(o,n),n.extensions&&l(i,o,n);for(var a=n.nodes||[],s=[],u=0,h=a.length;u<h;u++)s.push(e(a[u],o,r,this));return Promise.all(s).then(function(){return o})}}(),e}(),THREE.LuminosityHighPassShader={shaderID:"luminosityHighPass",uniforms:{tDiffuse:{type:"t",value:null},luminosityThreshold:{type:"f",value:1},smoothWidth:{type:"f",value:1},defaultColor:{type:"c",value:new THREE.Color(0)},defaultOpacity:{type:"f",value:0}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform vec3 defaultColor;","uniform float defaultOpacity;","uniform float luminosityThreshold;","uniform float smoothWidth;","varying vec2 vUv;","void main() {","vec4 texel = texture2D( tDiffuse, vUv );","vec3 luma = vec3( 0.299, 0.587, 0.114 );","float v = dot( texel.xyz, luma );","vec4 outputColor = vec4( defaultColor.rgb, defaultOpacity );","float alpha = smoothstep( luminosityThreshold, luminosityThreshold + smoothWidth, v );","gl_FragColor = mix( outputColor, texel, alpha );","}"].join("\n")},THREE.OBJLoader=function(){function e(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager,this.materials=null}var t=/^[og]\s*(.+)?/,r=/^mtllib /,i=/^usemtl /;return e.prototype={constructor:e,load:function(e,t,r,i){var n=this,o=new THREE.FileLoader(n.manager);o.setPath(this.path),o.load(e,function(e){t(n.parse(e))},r,i)},setPath:function(e){return this.path=e,this},setMaterials:function(e){return this.materials=e,this},parse:function(e){console.time("OBJLoader");var n=new function(){var e={objects:[],object:{},vertices:[],normals:[],colors:[],uvs:[],materialLibraries:[],startObject:function(e,t){if(this.object&&!1===this.object.fromDeclaration)return this.object.name=e,void(this.object.fromDeclaration=!1!==t);var r=this.object&&"function"==typeof this.object.currentMaterial?this.object.currentMaterial():void 0;if(this.object&&"function"==typeof this.object._finalize&&this.object._finalize(!0),this.object={name:e||"",fromDeclaration:!1!==t,geometry:{vertices:[],normals:[],colors:[],uvs:[]},materials:[],smooth:!0,startMaterial:function(e,t){var r=this._finalize(!1);r&&(r.inherited||r.groupCount<=0)&&this.materials.splice(r.index,1);var i={index:this.materials.length,name:e||"",mtllib:Array.isArray(t)&&t.length>0?t[t.length-1]:"",smooth:void 0!==r?r.smooth:this.smooth,groupStart:void 0!==r?r.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(e){var t={index:"number"==typeof e?e:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return t.clone=this.clone.bind(t),t}};return this.materials.push(i),i},currentMaterial:function(){if(this.materials.length>0)return this.materials[this.materials.length-1]},_finalize:function(e){var t=this.currentMaterial();if(t&&-1===t.groupEnd&&(t.groupEnd=this.geometry.vertices.length/3,t.groupCount=t.groupEnd-t.groupStart,t.inherited=!1),e&&this.materials.length>1)for(var r=this.materials.length-1;r>=0;r--)this.materials[r].groupCount<=0&&this.materials.splice(r,1);return e&&0===this.materials.length&&this.materials.push({name:"",smooth:this.smooth}),t}},r&&r.name&&"function"==typeof r.clone){var i=r.clone(0);i.inherited=!0,this.object.materials.push(i)}this.objects.push(this.object)},finalize:function(){this.object&&"function"==typeof this.object._finalize&&this.object._finalize(!0)},parseVertexIndex:function(e,t){var r=parseInt(e,10);return 3*(r>=0?r-1:r+t/3)},parseNormalIndex:function(e,t){var r=parseInt(e,10);return 3*(r>=0?r-1:r+t/3)},parseUVIndex:function(e,t){var r=parseInt(e,10);return 2*(r>=0?r-1:r+t/2)},addVertex:function(e,t,r){var i=this.vertices,n=this.object.geometry.vertices;n.push(i[e+0],i[e+1],i[e+2]),n.push(i[t+0],i[t+1],i[t+2]),n.push(i[r+0],i[r+1],i[r+2])},addVertexPoint:function(e){var t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addVertexLine:function(e){var t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addNormal:function(e,t,r){var i=this.normals,n=this.object.geometry.normals;n.push(i[e+0],i[e+1],i[e+2]),n.push(i[t+0],i[t+1],i[t+2]),n.push(i[r+0],i[r+1],i[r+2])},addColor:function(e,t,r){var i=this.colors,n=this.object.geometry.colors;n.push(i[e+0],i[e+1],i[e+2]),n.push(i[t+0],i[t+1],i[t+2]),n.push(i[r+0],i[r+1],i[r+2])},addUV:function(e,t,r){var i=this.uvs,n=this.object.geometry.uvs;n.push(i[e+0],i[e+1]),n.push(i[t+0],i[t+1]),n.push(i[r+0],i[r+1])},addUVLine:function(e){var t=this.uvs;this.object.geometry.uvs.push(t[e+0],t[e+1])},addFace:function(e,t,r,i,n,o,a,s,l){var c=this.vertices.length,u=this.parseVertexIndex(e,c),h=this.parseVertexIndex(t,c),p=this.parseVertexIndex(r,c);if(this.addVertex(u,h,p),void 0!==i&&""!==i){var d=this.uvs.length;u=this.parseUVIndex(i,d),h=this.parseUVIndex(n,d),p=this.parseUVIndex(o,d),this.addUV(u,h,p)}if(void 0!==a&&""!==a){var f=this.normals.length;u=this.parseNormalIndex(a,f),h=a===s?u:this.parseNormalIndex(s,f),p=a===l?u:this.parseNormalIndex(l,f),this.addNormal(u,h,p)}this.colors.length>0&&this.addColor(u,h,p)},addPointGeometry:function(e){this.object.geometry.type="Points";for(var t=this.vertices.length,r=0,i=e.length;r<i;r++)this.addVertexPoint(this.parseVertexIndex(e[r],t))},addLineGeometry:function(e,t){this.object.geometry.type="Line";for(var r=this.vertices.length,i=this.uvs.length,n=0,o=e.length;n<o;n++)this.addVertexLine(this.parseVertexIndex(e[n],r));for(var a=0,o=t.length;a<o;a++)this.addUVLine(this.parseUVIndex(t[a],i))}};return e.startObject("",!1),e};-1!==e.indexOf("\r\n")&&(e=e.replace(/\r\n/g,"\n")),-1!==e.indexOf("\\\n")&&(e=e.replace(/\\\n/g,""));for(var o=e.split("\n"),a="",s="",l=[],c="function"==typeof"".trimLeft,u=0,h=o.length;u<h;u++)if(a=o[u],a=c?a.trimLeft():a.trim(),0!==a.length&&"#"!==(s=a.charAt(0)))if("v"===s){var p=a.split(/\s+/);switch(p[0]){case"v":n.vertices.push(parseFloat(p[1]),parseFloat(p[2]),parseFloat(p[3])),8===p.length&&n.colors.push(parseFloat(p[4]),parseFloat(p[5]),parseFloat(p[6]));break;case"vn":n.normals.push(parseFloat(p[1]),parseFloat(p[2]),parseFloat(p[3]));break;case"vt":n.uvs.push(parseFloat(p[1]),parseFloat(p[2]))}}else if("f"===s){for(var d=(P=a.substr(1).trim()).split(/\s+/),f=[],m=0,g=d.length;m<g;m++){var v=d[m];if(v.length>0){var y=v.split("/");f.push(y)}}for(var E=f[0],m=1,g=f.length-1;m<g;m++){var b=f[m],x=f[m+1];n.addFace(E[0],b[0],x[0],E[1],b[1],x[1],E[2],b[2],x[2])}}else if("l"===s){var _=a.substring(1).trim().split(" "),w=[],T=[];if(-1===a.indexOf("/"))w=_;else for(var M=0,R=_.length;M<R;M++){var S=_[M].split("/");""!==S[0]&&w.push(S[0]),""!==S[1]&&T.push(S[1])}n.addLineGeometry(w,T)}else if("p"===s){var P=a.substr(1).trim(),A=P.split(" ");n.addPointGeometry(A)}else if(null!==(l=t.exec(a))){var C=(" "+l[0].substr(1).trim()).substr(1);n.startObject(C)}else if(i.test(a))n.object.startMaterial(a.substring(7).trim(),n.materialLibraries);else if(r.test(a))n.materialLibraries.push(a.substring(7).trim());else{if("s"!==s){if("\0"===a)continue;throw new Error('THREE.OBJLoader: Unexpected line: "'+a+'"')}if((l=a.split(" ")).length>1){var L=l[1].trim().toLowerCase();n.object.smooth="0"!==L&&"off"!==L}else n.object.smooth=!0;(q=n.object.currentMaterial())&&(q.smooth=n.object.smooth)}n.finalize();var O=new THREE.Group;O.materialLibraries=[].concat(n.materialLibraries);for(var u=0,h=n.objects.length;u<h;u++){var H=n.objects[u],F=H.geometry,I=H.materials,k="Line"===F.type,D="Points"===F.type,N=!1;if(0!==F.vertices.length){var j=new THREE.BufferGeometry;j.addAttribute("position",new THREE.Float32BufferAttribute(F.vertices,3)),F.normals.length>0?j.addAttribute("normal",new THREE.Float32BufferAttribute(F.normals,3)):j.computeVertexNormals(),F.colors.length>0&&(N=!0,j.addAttribute("color",new THREE.Float32BufferAttribute(F.colors,3))),F.uvs.length>0&&j.addAttribute("uv",new THREE.Float32BufferAttribute(F.uvs,2));for(var U=[],B=0,V=I.length;B<V;B++){var z=I[B],q=void 0;if(null!==this.materials)if(q=this.materials.create(z.name),!k||!q||q instanceof THREE.LineBasicMaterial){if(D&&q&&!(q instanceof THREE.PointsMaterial)){var G=new THREE.PointsMaterial({size:10,sizeAttenuation:!1});W.copy(q),q=G}}else{var W=new THREE.LineBasicMaterial;W.copy(q),W.lights=!1,q=W}q||((q=k?new THREE.LineBasicMaterial:D?new THREE.PointsMaterial({size:1,sizeAttenuation:!1}):new THREE.MeshPhongMaterial).name=z.name),q.flatShading=!z.smooth,q.vertexColors=N?THREE.VertexColors:THREE.NoColors,U.push(q)}var X;if(U.length>1){for(var B=0,V=I.length;B<V;B++){z=I[B];j.addGroup(z.groupStart,z.groupCount,B)}X=k?new THREE.LineSegments(j,U):D?new THREE.Points(j,U):new THREE.Mesh(j,U)}else X=k?new THREE.LineSegments(j,U[0]):D?new THREE.Points(j,U[0]):new THREE.Mesh(j,U[0]);X.name=H.name,O.add(X)}}return console.timeEnd("OBJLoader"),O}},e}(),THREE.OrbitControls=function(e,t){function r(){return 2*Math.PI/60/60*y.autoRotateSpeed}function i(){return Math.pow(.95,y.zoomSpeed)}function n(e){S.theta-=e}function o(e){S.phi-=e}function a(e){y.object.isPerspectiveCamera?P/=e:y.object.isOrthographicCamera?(y.object.zoom=Math.max(y.minZoom,Math.min(y.maxZoom,y.object.zoom*e)),y.object.updateProjectionMatrix(),C=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),y.enableZoom=!1)}function s(e){y.object.isPerspectiveCamera?P*=e:y.object.isOrthographicCamera?(y.object.zoom=Math.max(y.minZoom,Math.min(y.maxZoom,y.object.zoom/e)),y.object.updateProjectionMatrix(),C=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),y.enableZoom=!1)}function l(e){F.set(e.clientX,e.clientY)}function c(e){if(!1!==y.enabled){switch(e.preventDefault(),e.button){case y.mouseButtons.LEFT:if(e.ctrlKey||e.metaKey){if(!1===y.enablePan)return;l(e),T=w.PAN}else{if(!1===y.enableRotate)return;!function(e){L.set(e.clientX,e.clientY)}(e),T=w.ROTATE}break;case y.mouseButtons.MIDDLE:if(!1===y.enableZoom)return;!function(e){D.set(e.clientX,e.clientY)}(e),T=w.DOLLY;break;case y.mouseButtons.RIGHT:if(!1===y.enablePan)return;l(e),T=w.PAN}T!==w.NONE&&(document.addEventListener("mousemove",u,!1),document.addEventListener("mouseup",h,!1),y.dispatchEvent(x))}}function u(e){if(!1!==y.enabled)switch(e.preventDefault(),T){case w.ROTATE:if(!1===y.enableRotate)return;!function(e){O.set(e.clientX,e.clientY),H.subVectors(O,L).multiplyScalar(y.rotateSpeed);var t=y.domElement===document?y.domElement.body:y.domElement;n(2*Math.PI*H.x/t.clientHeight),o(2*Math.PI*H.y/t.clientHeight),L.copy(O),y.update()}(e);break;case w.DOLLY:if(!1===y.enableZoom)return;!function(e){N.set(e.clientX,e.clientY),j.subVectors(N,D),j.y>0?a(i()):j.y<0&&s(i()),D.copy(N),y.update()}(e);break;case w.PAN:if(!1===y.enablePan)return;!function(e){I.set(e.clientX,e.clientY),k.subVectors(I,F).multiplyScalar(y.panSpeed),V(k.x,k.y),F.copy(I),y.update()}(e)}}function h(e){!1!==y.enabled&&(document.removeEventListener("mousemove",u,!1),document.removeEventListener("mouseup",h,!1),y.dispatchEvent(_),T=w.NONE)}function p(e){!1===y.enabled||!1===y.enableZoom||T!==w.NONE&&T!==w.ROTATE||(e.preventDefault(),e.stopPropagation(),function(e){e.deltaY<0?s(i()):e.deltaY>0&&a(i()),E.delta=e.deltaY,y.dispatchEvent(E),y.update()}(e))}function d(e){!1!==y.enabled&&!1!==y.enableKeys&&!1!==y.enablePan&&function(e){switch(e.keyCode){case y.keys.UP:V(0,y.keyPanSpeed),y.update();break;case y.keys.BOTTOM:V(0,-y.keyPanSpeed),y.update();break;case y.keys.LEFT:V(y.keyPanSpeed,0),y.update();break;case y.keys.RIGHT:V(-y.keyPanSpeed,0),y.update()}}(e)}function f(e){if(!1!==y.enabled){switch(e.preventDefault(),e.touches.length){case 1:if(!1===y.enableRotate)return;!function(e){L.set(e.touches[0].pageX,e.touches[0].pageY)}(e),T=w.TOUCH_ROTATE;break;case 2:if(!1===y.enableZoom&&!1===y.enablePan)return;!function(e){if(y.enableZoom){var t=e.touches[0].pageX-e.touches[1].pageX,r=e.touches[0].pageY-e.touches[1].pageY,i=Math.sqrt(t*t+r*r);D.set(0,i)}if(y.enablePan){var n=.5*(e.touches[0].pageX+e.touches[1].pageX),o=.5*(e.touches[0].pageY+e.touches[1].pageY);F.set(n,o)}}(e),T=w.TOUCH_DOLLY_PAN;break;default:T=w.NONE}T!==w.NONE&&y.dispatchEvent(x)}}function m(e){if(!1!==y.enabled)switch(e.preventDefault(),e.stopPropagation(),e.touches.length){case 1:if(!1===y.enableRotate)return;if(T!==w.TOUCH_ROTATE)return;!function(e){O.set(e.touches[0].pageX,e.touches[0].pageY),H.subVectors(O,L).multiplyScalar(y.rotateSpeed);var t=y.domElement===document?y.domElement.body:y.domElement;n(2*Math.PI*H.x/t.clientHeight),o(2*Math.PI*H.y/t.clientHeight),L.copy(O),y.update()}(e);break;case 2:if(!1===y.enableZoom&&!1===y.enablePan)return;if(T!==w.TOUCH_DOLLY_PAN)return;!function(e){if(y.enableZoom){var t=e.touches[0].pageX-e.touches[1].pageX,r=e.touches[0].pageY-e.touches[1].pageY,i=Math.sqrt(t*t+r*r);N.set(0,i),j.set(0,Math.pow(N.y/D.y,y.zoomSpeed)),a(j.y),D.copy(N)}if(y.enablePan){var n=.5*(e.touches[0].pageX+e.touches[1].pageX),o=.5*(e.touches[0].pageY+e.touches[1].pageY);I.set(n,o),k.subVectors(I,F).multiplyScalar(y.panSpeed),V(k.x,k.y),F.copy(I)}y.update()}(e);break;default:T=w.NONE}}function g(e){!1!==y.enabled&&(y.dispatchEvent(_),T=w.NONE)}function v(e){!1!==y.enabled&&e.preventDefault()}this.object=e,this.domElement=void 0!==t?t:document,this.enabled=!0,this.target=new THREE.Vector3,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.25,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!1,this.keyPanSpeed=7,this.autoRotate=!1,this.autoLeftRotate=!1,this.autoUpRotate=!1,this.autoRotateSpeed=2,this.enableKeys=!0,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={LEFT:THREE.MOUSE.LEFT,MIDDLE:THREE.MOUSE.MIDDLE,RIGHT:THREE.MOUSE.RIGHT},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.move=function(e,t){V(e,t)},this.getPolarAngle=function(){return R.phi},this.getAzimuthalAngle=function(){return R.theta},this.saveState=function(){y.target0.copy(y.target),y.position0.copy(y.object.position),y.zoom0=y.object.zoom},this.reset=function(){y.target.copy(y.target0),y.object.position.copy(y.position0),y.object.zoom=y.zoom0,y.object.updateProjectionMatrix(),y.dispatchEvent(b),y.update(),T=w.NONE},this.update=function(){var t=new THREE.Vector3,i=(new THREE.Quaternion).setFromUnitVectors(e.up,new THREE.Vector3(0,1,0)),a=i.clone().inverse(),s=new THREE.Vector3,l=new THREE.Quaternion;return function(){var e=y.object.position;return t.copy(e).sub(y.target),t.applyQuaternion(i),R.setFromVector3(t),y.autoRotate&&T===w.NONE&&(y.autoLeftRotate?n(r()):y.autoUpRotate&&o(r())),R.theta+=S.theta,R.phi+=S.phi,R.theta=Math.max(y.minAzimuthAngle,Math.min(y.maxAzimuthAngle,R.theta)),R.phi=Math.max(y.minPolarAngle,Math.min(y.maxPolarAngle,R.phi)),R.makeSafe(),R.radius*=P,R.radius=Math.max(y.minDistance,Math.min(y.maxDistance,R.radius)),y.target.add(A),t.setFromSpherical(R),t.applyQuaternion(a),e.copy(y.target).add(t),y.object.lookAt(y.target),!0===y.enableDamping?(S.theta*=1-y.dampingFactor,S.phi*=1-y.dampingFactor,A.multiplyScalar(1-y.dampingFactor)):(S.set(0,0,0),A.set(0,0,0)),P=1,!!(C||s.distanceToSquared(y.object.position)>M||8*(1-l.dot(y.object.quaternion))>M)&&(y.dispatchEvent(b),s.copy(y.object.position),l.copy(y.object.quaternion),C=!1,!0)}}(),this.dispose=function(){y.domElement.removeEventListener("contextmenu",v,!1),y.domElement.removeEventListener("mousedown",c,!1),y.domElement.removeEventListener("wheel",p,!1),y.domElement.removeEventListener("touchstart",f,!1),y.domElement.removeEventListener("touchend",g,!1),y.domElement.removeEventListener("touchmove",m,!1),document.removeEventListener("mousemove",u,!1),document.removeEventListener("mouseup",h,!1),window.removeEventListener("keydown",d,!1)};var y=this,E={type:"wheel",delta:0},b={type:"change"},x={type:"start"},_={type:"end"},w={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY_PAN:4},T=w.NONE,M=1e-6,R=new THREE.Spherical,S=new THREE.Spherical,P=1,A=new THREE.Vector3,C=!1,L=new THREE.Vector2,O=new THREE.Vector2,H=new THREE.Vector2,F=new THREE.Vector2,I=new THREE.Vector2,k=new THREE.Vector2,D=new THREE.Vector2,N=new THREE.Vector2,j=new THREE.Vector2,U=function(){var e=new THREE.Vector3;return function(t,r){e.setFromMatrixColumn(r,0),e.multiplyScalar(-t),A.add(e)}}(),B=function(){var e=new THREE.Vector3;return function(t,r){!0===y.screenSpacePanning?e.setFromMatrixColumn(r,1):(e.setFromMatrixColumn(r,0),e.crossVectors(y.object.up,e)),e.multiplyScalar(t),A.add(e)}}(),V=function(){var e=new THREE.Vector3;return function(t,r){var i=y.domElement===document?y.domElement.body:y.domElement;if(y.object.isPerspectiveCamera){var n=y.object.position;e.copy(n).sub(y.target);var o=e.length();o*=Math.tan(y.object.fov/2*Math.PI/180),U(2*t*o/i.clientHeight,y.object.matrix),B(2*r*o/i.clientHeight,y.object.matrix)}else y.object.isOrthographicCamera?(U(t*(y.object.right-y.object.left)/y.object.zoom/i.clientWidth,y.object.matrix),B(r*(y.object.top-y.object.bottom)/y.object.zoom/i.clientHeight,y.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),y.enablePan=!1)}}();y.domElement.addEventListener("contextmenu",v,!1),y.domElement.addEventListener("mousedown",c,!1),y.domElement.addEventListener("wheel",p,!1),y.domElement.addEventListener("touchstart",f,!1),y.domElement.addEventListener("touchend",g,!1),y.domElement.addEventListener("touchmove",m,!1),window.addEventListener("keydown",d,!1),this.update()},THREE.OrbitControls.prototype=Object.create(THREE.EventDispatcher.prototype),THREE.OrbitControls.prototype.constructor=THREE.OrbitControls,Object.defineProperties(THREE.OrbitControls.prototype,{center:{get:function(){return console.warn("THREE.OrbitControls: .center has been renamed to .target"),this.target}},noZoom:{get:function(){return console.warn("THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),!this.enableZoom},set:function(e){console.warn("THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),this.enableZoom=!e}},noRotate:{get:function(){return console.warn("THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),!this.enableRotate},set:function(e){console.warn("THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),this.enableRotate=!e}},noPan:{get:function(){return console.warn("THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead."),!this.enablePan},set:function(e){console.warn("THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead."),this.enablePan=!e}},noKeys:{get:function(){return console.warn("THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),!this.enableKeys},set:function(e){console.warn("THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),this.enableKeys=!e}},staticMoving:{get:function(){return console.warn("THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),!this.enableDamping},set:function(e){console.warn("THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),this.enableDamping=!e}},dynamicDampingFactor:{get:function(){return console.warn("THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.dampingFactor},set:function(e){console.warn("THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.dampingFactor=e}}}),THREE.Reflector=function(e,t){THREE.Mesh.call(this,e),this.type="Reflector";var r=this,i=void 0!==(t=t||{}).color?new THREE.Color(t.color):new THREE.Color(8355711),n=t.textureWidth||512,o=t.textureHeight||512,a=t.clipBias||0,s=t.shader||THREE.Reflector.ReflectorShader,l=void 0!==t.recursion?t.recursion:0,c=new THREE.Plane,u=new THREE.Vector3,h=new THREE.Vector3,p=new THREE.Vector3,d=new THREE.Matrix4,f=new THREE.Vector3(0,0,-1),m=new THREE.Vector4,g=new THREE.Vector4,v=new THREE.Vector3,y=new THREE.Vector3,E=new THREE.Vector4,b=new THREE.Matrix4,x=new THREE.PerspectiveCamera,_={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBFormat,stencilBuffer:!1},w=new THREE.WebGLRenderTarget(n,o,_);THREE.Math.isPowerOfTwo(n)&&THREE.Math.isPowerOfTwo(o)||(w.texture.generateMipmaps=!1);var T=new THREE.ShaderMaterial({uniforms:THREE.UniformsUtils.clone(s.uniforms),fragmentShader:s.fragmentShader,vertexShader:s.vertexShader});T.uniforms.tDiffuse.value=w.texture,T.uniforms.color.value=i,T.uniforms.textureMatrix.value=b,this.material=T,this.renderOrder=-1/0,this.onBeforeRender=function(e,t,i){if("recursion"in i.userData){if(i.userData.recursion===l)return;i.userData.recursion++}if(h.setFromMatrixPosition(r.matrixWorld),p.setFromMatrixPosition(i.matrixWorld),d.extractRotation(r.matrixWorld),u.set(0,0,1),u.applyMatrix4(d),v.subVectors(h,p),!(v.dot(u)>0)){v.reflect(u).negate(),v.add(h),d.extractRotation(i.matrixWorld),f.set(0,0,-1),f.applyMatrix4(d),f.add(p),y.subVectors(h,f),y.reflect(u).negate(),y.add(h),x.position.copy(v),x.up.set(0,1,0),x.up.applyMatrix4(d),x.up.reflect(u),x.lookAt(y),x.far=i.far,x.updateMatrixWorld(),x.projectionMatrix.copy(i.projectionMatrix),x.userData.recursion=0,b.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),b.multiply(x.projectionMatrix),b.multiply(x.matrixWorldInverse),b.multiply(r.matrixWorld),c.setFromNormalAndCoplanarPoint(u,h),c.applyMatrix4(x.matrixWorldInverse),m.set(c.normal.x,c.normal.y,c.normal.z,c.constant);var n=x.projectionMatrix;E.x=(Math.sign(m.x)+n.elements[8])/n.elements[0],E.y=(Math.sign(m.y)+n.elements[9])/n.elements[5],E.z=-1,E.w=(1+n.elements[10])/n.elements[14],m.multiplyScalar(2/m.dot(E)),n.elements[2]=m.x,n.elements[6]=m.y,n.elements[10]=m.z+1-a,n.elements[14]=m.w,r.visible=!1;var o=e.getRenderTarget(),s=e.vr.enabled,_=e.shadowMap.autoUpdate;e.vr.enabled=!1,e.shadowMap.autoUpdate=!1,e.render(t,x,w,!0),e.vr.enabled=s,e.shadowMap.autoUpdate=_,e.setRenderTarget(o);var T=i.bounds;if(void 0!==T){var M=e.getSize(),R=e.getPixelRatio();g.x=T.x*M.width*R,g.y=T.y*M.height*R,g.z=T.z*M.width*R,g.w=T.w*M.height*R,e.state.viewport(g)}r.visible=!0}},this.getRenderTarget=function(){return w}},THREE.Reflector.prototype=Object.create(THREE.Mesh.prototype),THREE.Reflector.prototype.constructor=THREE.Reflector,THREE.Reflector.ReflectorShader={uniforms:{color:{type:"c",value:null},tDiffuse:{type:"t",value:null},textureMatrix:{type:"m4",value:null}},vertexShader:["uniform mat4 textureMatrix;","varying vec4 vUv;","void main() {","\tvUv = textureMatrix * vec4( position, 1.0 );","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform vec3 color;","uniform sampler2D tDiffuse;","varying vec4 vUv;","float blendOverlay( float base, float blend ) {","\treturn( base < 0.5 ? ( 2.0 * base * blend ) : ( 1.0 - 2.0 * ( 1.0 - base ) * ( 1.0 - blend ) ) );","}","vec3 blendOverlay( vec3 base, vec3 blend ) {","\treturn vec3( blendOverlay( base.r, blend.r ), blendOverlay( base.g, blend.g ), blendOverlay( base.b, blend.b ) );","}","void main() {","\tvec4 base = texture2DProj( tDiffuse, vUv );","\tgl_FragColor = vec4( blendOverlay( base.rgb, color ), 1.0 );","}"].join("\n")},THREE.ReflectorRTT=function(e,t){THREE.Reflector.call(this,e,t),this.geometry.setDrawRange(0,0)},THREE.ReflectorRTT.prototype=Object.create(THREE.Reflector.prototype),THREE.Refractor=function(e,t){THREE.Mesh.call(this,e),this.type="Refractor";var r=this,i=void 0!==(t=t||{}).color?new THREE.Color(t.color):new THREE.Color(8355711),n=t.textureWidth||512,o=t.textureHeight||512,a=t.clipBias||0,s=t.shader||THREE.Refractor.RefractorShader,l=new THREE.PerspectiveCamera;l.matrixAutoUpdate=!1,l.userData.refractor=!0;var c=new THREE.Plane,u=new THREE.Matrix4,h={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBFormat,stencilBuffer:!1},p=new THREE.WebGLRenderTarget(n,o,h);THREE.Math.isPowerOfTwo(n)&&THREE.Math.isPowerOfTwo(o)||(p.texture.generateMipmaps=!1),this.material=new THREE.ShaderMaterial({uniforms:THREE.UniformsUtils.clone(s.uniforms),vertexShader:s.vertexShader,fragmentShader:s.fragmentShader,transparent:!0}),this.material.uniforms.color.value=i,this.material.uniforms.tDiffuse.value=p.texture,this.material.uniforms.textureMatrix.value=u;var d=function(){var e=new THREE.Vector3,t=new THREE.Vector3,i=new THREE.Matrix4,n=new THREE.Vector3,o=new THREE.Vector3;return function(a){return e.setFromMatrixPosition(r.matrixWorld),t.setFromMatrixPosition(a.matrixWorld),n.subVectors(e,t),i.extractRotation(r.matrixWorld),o.set(0,0,1),o.applyMatrix4(i),n.dot(o)<0}}(),f=function(){var e=new THREE.Vector3,t=new THREE.Vector3,i=new THREE.Quaternion,n=new THREE.Vector3;return function(){r.matrixWorld.decompose(t,i,n),e.set(0,0,1).applyQuaternion(i).normalize(),e.negate(),c.setFromNormalAndCoplanarPoint(e,t)}}(),m=function(){var e=new THREE.Plane,t=new THREE.Vector4,r=new THREE.Vector4;return function(i){l.matrixWorld.copy(i.matrixWorld),l.matrixWorldInverse.getInverse(l.matrixWorld),l.projectionMatrix.copy(i.projectionMatrix),l.far=i.far,e.copy(c),e.applyMatrix4(l.matrixWorldInverse),t.set(e.normal.x,e.normal.y,e.normal.z,e.constant);var n=l.projectionMatrix;r.x=(Math.sign(t.x)+n.elements[8])/n.elements[0],r.y=(Math.sign(t.y)+n.elements[9])/n.elements[5],r.z=-1,r.w=(1+n.elements[10])/n.elements[14],t.multiplyScalar(2/t.dot(r)),n.elements[2]=t.x,n.elements[6]=t.y,n.elements[10]=t.z+1-a,n.elements[14]=t.w}}(),g=function(){var e=new THREE.Vector4;return function(t,i,n){r.visible=!1;var o=t.getRenderTarget(),a=t.vr.enabled,s=t.shadowMap.autoUpdate;t.vr.enabled=!1,t.shadowMap.autoUpdate=!1,t.render(i,l,p,!0),t.vr.enabled=a,t.shadowMap.autoUpdate=s,t.setRenderTarget(o);var c=n.bounds;if(void 0!==c){var u=t.getSize(),h=t.getPixelRatio();e.x=c.x*u.width*h,e.y=c.y*u.height*h,e.z=c.z*u.width*h,e.w=c.w*u.height*h,t.state.viewport(e)}r.visible=!0}}();this.onBeforeRender=function(e,t,i){!0!==i.userData.refractor&&!0!=!d(i)&&(f(),function(e){u.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),u.multiply(e.projectionMatrix),u.multiply(e.matrixWorldInverse),u.multiply(r.matrixWorld)}(i),m(i),g(e,t,i))},this.getRenderTarget=function(){return p}},THREE.Refractor.prototype=Object.create(THREE.Mesh.prototype),THREE.Refractor.prototype.constructor=THREE.Refractor,THREE.Refractor.RefractorShader={uniforms:{color:{type:"c",value:null},tDiffuse:{type:"t",value:null},textureMatrix:{type:"m4",value:null}},vertexShader:["uniform mat4 textureMatrix;","varying vec4 vUv;","void main() {","\tvUv = textureMatrix * vec4( position, 1.0 );","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform vec3 color;","uniform sampler2D tDiffuse;","varying vec4 vUv;","float blendOverlay( float base, float blend ) {","\treturn( base < 0.5 ? ( 2.0 * base * blend ) : ( 1.0 - 2.0 * ( 1.0 - base ) * ( 1.0 - blend ) ) );","}","vec3 blendOverlay( vec3 base, vec3 blend ) {","\treturn vec3( blendOverlay( base.r, blend.r ), blendOverlay( base.g, blend.g ), blendOverlay( base.b, blend.b ) );","}","void main() {","\tvec4 base = texture2DProj( tDiffuse, vUv );","\tgl_FragColor = vec4( blendOverlay( base.rgb, color ), 1.0 );","}"].join("\n")},THREE.RenderPass=function(e,t,r,i,n){THREE.Pass.call(this),this.scene=e,this.camera=t,this.overrideMaterial=r,this.clearColor=i,this.clearAlpha=void 0!==n?n:0,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1},THREE.RenderPass.prototype=Object.assign(Object.create(THREE.Pass.prototype),{constructor:THREE.RenderPass,render:function(e,t,r,i,n){var o=e.autoClear;e.autoClear=!1,this.scene.overrideMaterial=this.overrideMaterial;var a,s;this.clearColor&&(a=e.getClearColor().getHex(),s=e.getClearAlpha(),e.setClearColor(this.clearColor,this.clearAlpha)),this.clearDepth&&e.clearDepth(),e.render(this.scene,this.camera,this.renderToScreen?null:r,this.clear),this.clearColor&&e.setClearColor(a,s),this.scene.overrideMaterial=null,e.autoClear=o}}),THREE.SavePass=function(e){THREE.Pass.call(this),void 0===THREE.CopyShader&&console.error("THREE.SavePass relies on THREE.CopyShader");var t=THREE.CopyShader;this.textureID="tDiffuse",this.uniforms=THREE.UniformsUtils.clone(t.uniforms),this.material=new THREE.ShaderMaterial({uniforms:this.uniforms,vertexShader:t.vertexShader,fragmentShader:t.fragmentShader}),this.renderTarget=e,void 0===this.renderTarget&&(this.renderTarget=new THREE.WebGLRenderTarget(window.innerWidth,window.innerHeight,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBFormat,stencilBuffer:!1}),this.renderTarget.texture.name="SavePass.rt"),this.needsSwap=!1,this.camera=new THREE.OrthographicCamera(-1,1,1,-1,0,1),this.scene=new THREE.Scene,this.quad=new THREE.Mesh(new THREE.PlaneBufferGeometry(2,2),null),this.quad.frustumCulled=!1,this.scene.add(this.quad)},THREE.SavePass.prototype=Object.assign(Object.create(THREE.Pass.prototype),{constructor:THREE.SavePass,render:function(e,t,r){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=r.texture),this.quad.material=this.material,e.render(this.scene,this.camera,this.renderTarget,this.clear)}}),THREE.SceneUtils={createMultiMaterialObject:function(e,t){for(var r=new THREE.Group,i=0,n=t.length;i<n;i++)r.add(new THREE.Mesh(e,t[i]));return r},detach:function(e,t,r){e.applyMatrix(t.matrixWorld),t.remove(e),r.add(e)},attach:function(e,t,r){e.applyMatrix((new THREE.Matrix4).getInverse(r.matrixWorld)),t.remove(e),r.add(e)}},THREE.ShaderPass=function(e,t){THREE.Pass.call(this),this.textureID=void 0!==t?t:"tDiffuse",e instanceof THREE.ShaderMaterial?(this.uniforms=e.uniforms,this.material=e):e&&(this.uniforms=THREE.UniformsUtils.clone(e.uniforms),this.material=new THREE.ShaderMaterial({defines:e.defines||{},uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),this.camera=new THREE.OrthographicCamera(-1,1,1,-1,0,1),this.scene=new THREE.Scene,this.quad=new THREE.Mesh(new THREE.PlaneBufferGeometry(2,2),null),this.quad.frustumCulled=!1,this.scene.add(this.quad)},THREE.ShaderPass.prototype=Object.assign(Object.create(THREE.Pass.prototype),{constructor:THREE.ShaderPass,render:function(e,t,r,i,n){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=r.texture),this.quad.material=this.material,this.renderToScreen?e.render(this.scene,this.camera):e.render(this.scene,this.camera,t,this.clear)}}),THREE.SimplifyModifier=function(){},function(){function e(e,t){var r=e.indexOf(t);r>-1&&e.splice(r,1)}function t(e,t){var r=t.position.distanceTo(e.position),i=0,n=[],o=(e.faces,e.faces.length);for(c=0;c<o;c++)(u=e.faces[c]).hasVertex(t)&&n.push(u);for(c=0;c<o;c++){var a=1;u=e.faces[c];for(h=0;h<n.length;h++){p=n[h];var s=u.normal.dot(p.normal);a=Math.min(a,(1.001-s)/2)}i=Math.max(i,a)}n.length<2&&(i=1),e.isBorder()&&n.length>1&&(i=1);for(var l=0,c=0;c<o;c++){for(var u=e.faces[c],h=0;h<n.length;h++){var p=n[h];if(u.uvAt(e).equals(p.uvAt(e)))break}h==n.length&&l++}l&&(i=1);return r*i+0}function r(e){if(0===e.neighbors.length)return e.collapseNeighbor=null,void(e.collapseCost=-.01);e.collapseCost=1e5,e.collapseNeighbor=null;for(var r=0;r<e.neighbors.length;r++){var i=t(e,e.neighbors[r]);e.collapseNeighbor||(e.collapseNeighbor=e.neighbors[r],e.collapseCost=i,e.minCost=i,e.totalCost=0,e.costCount=0),e.costCount++,e.totalCost+=i,i<e.minCost&&(e.collapseNeighbor=e.neighbors[r],e.minCost=i)}e.collapseCost=e.totalCost/e.costCount}function i(t,r){for(console.assert(0===t.faces.length);t.neighbors.length;){e(t.neighbors.pop().neighbors,t)}e(r,t)}function n(t,r){e(r,t),t.v1&&e(t.v1.faces,t),t.v2&&e(t.v2.faces,t),t.v3&&e(t.v3.faces,t);for(var i,n,o=[this.v1,this.v2,this.v3],a=0;a<3;a++)n=o[(a+1)%3],(i=o[a])&&n&&(i.removeIfNonNeighbor(n),n.removeIfNonNeighbor(i))}function o(e,t,o,a){if(a){var s=[];for(u=0;u<o.neighbors.length;u++)s.push(o.neighbors[u]);for(var l=[],c=o.faces.length,u=0;u<c;u++){(h=o.faces[u]).hasVertex(a)&&l.push(h)}for(u=0;u<c;u++){var h=o.faces[u];if(!h.hasVertex(a))for(var p=0;p<l.length;p++){var d=l[p];if(h.uvAt(o).equals(d.uvAt(o))){h.setUV(o,d.uvAt(a));break}l.length}}for(u=o.faces.length-1;u>=0;u--)o.faces[u].hasVertex(a)&&n(o.faces[u],t);for(u=o.faces.length-1;u>=0;u--)o.faces[u].replaceVertex(o,a);for(i(o,e),u=0;u<s.length;u++)r(s[u])}else i(o,e)}function a(e){for(var t=e[0],r=0;r<e.length;r++)e[r].collapseCost<t.collapseCost&&(t=e[r]);return t}function s(e,t,r,i,n,o,a,s,l){this.a=i,this.b=n,this.c=o,this.v1=e,this.v2=t,this.v3=r,this.uv1=a,this.uv2=s,this.uv3=l,this.normal=new THREE.Vector3,this.computeNormal(),e.faces.push(this),e.addUniqueNeighbor(t),e.addUniqueNeighbor(r),t.faces.push(this),t.addUniqueNeighbor(e),t.addUniqueNeighbor(r),r.faces.push(this),r.addUniqueNeighbor(e),r.addUniqueNeighbor(t)}function l(e,t){this.position=e,this.id=t,this.faces=[],this.neighbors=[],this.collapseCost=0,this.collapseNeighbor=null}var c=new THREE.Vector3,u=new THREE.Vector3;s.prototype.computeNormal=function(){var e=this.v1.position,t=this.v2.position,r=this.v3.position;c.subVectors(r,t),u.subVectors(e,t),c.cross(u).normalize(),this.normal.copy(c)},s.prototype.hasVertex=function(e){return e===this.v1||e===this.v2||e===this.v3},s.prototype.replaceVertex=function(t,r){t===this.v1?this.v1=r:t===this.v2?this.v2=r:t===this.v3&&(this.v3=r),e(t.faces,this),r.faces.push(this),t.removeIfNonNeighbor(this.v1),this.v1.removeIfNonNeighbor(t),t.removeIfNonNeighbor(this.v2),this.v2.removeIfNonNeighbor(t),t.removeIfNonNeighbor(this.v3),this.v3.removeIfNonNeighbor(t),this.v1.addUniqueNeighbor(this.v2),this.v1.addUniqueNeighbor(this.v3),this.v2.addUniqueNeighbor(this.v1),this.v2.addUniqueNeighbor(this.v3),this.v3.addUniqueNeighbor(this.v1),this.v3.addUniqueNeighbor(this.v2),this.computeNormal()},s.prototype.uvAt=function(e){var t=[this.v1,this.v2,this.v3].reduce(function(t,r,i){return!t.length&&e.position.equals(r)&&t.push(i),t},[])[0];return[this.uv1,this.uv2,this.uv3][t]},s.prototype.setUV=function(e,t){var r=[this.v1,this.v2,this.v3].reduce(function(t,r,i){return!t.length&&e.position.equals(r)&&t.push(i),t},[])[0];[this.uv1,this.uv2,this.uv3][r]=t},l.prototype.addUniqueNeighbor=function(e){!function(e,t){-1===e.indexOf(t)&&e.push(t)}(this.neighbors,e)},l.prototype.removeIfNonNeighbor=function(e){var t=this.neighbors,r=this.faces,i=t.indexOf(e);if(-1!==i){for(var n=0;n<r.length;n++)if(r[n].hasVertex(e))return;t.splice(i,1)}},l.prototype.isBorder=function(){for(var e=this.neighbors.length,t=0;t<e;t++){for(var r=0,i=this.faces.length,n=0;n<i;n++)this.faces[n].hasVertex(this.neighbors[t])&&r++;if(1===r)return!0}return!1},THREE.SimplifyModifier.prototype.modify=function(e,t){e instanceof THREE.BufferGeometry&&!e.vertices&&!e.faces&&(console.log("converting BufferGeometry to Geometry"),e=(new THREE.Geometry).fromBufferGeometry(e)),e.mergeVertices();var i,n,c=e.vertices,u=e.faces,h=e.faceVertexUvs[0],p=(new THREE.Geometry,new Array(c.length)),d=new Array(u.length);new Array(h.length);for(i=0,n=c.length;i<n;i++)p[i]=new l(c[i],i);for(i=0,n=u.length;i<n;i++)E=u[i],h[i],d[i]=new s(p[E.a],p[E.b],p[E.c],E.a,E.b,E.c,h[i][0],h[i][1],h[i][2]);for(i=0,n=p.length;i<n;i++)r(p[i]);new Array(p.length),new Array(p.length);for(var f,m=t;m--;){if(!(f=a(p))){console.log("no next vertex");break}o(p,d,f,f.collapseNeighbor)}var g=new THREE.Geometry;for(i=0;i<p.length;i++){var v=p[i];g.vertices.push(v.position)}for(i=0;i<d.length;i++){var y=d[i],E=new THREE.Face3(p.indexOf(y.v1),p.indexOf(y.v2),p.indexOf(y.v3),y.normal);g.faces.push(E),g.faceVertexUvs[0].push([y.uv1,y.uv2,y.uv3])}return g}}(),THREE.Sky=function(){var e=THREE.Sky.SkyShader,t=new THREE.ShaderMaterial({fragmentShader:e.fragmentShader,vertexShader:e.vertexShader,uniforms:THREE.UniformsUtils.clone(e.uniforms),side:THREE.BackSide});THREE.Mesh.call(this,new THREE.BoxBufferGeometry(1,1,1),t)},THREE.Sky.prototype=Object.assign(Object.create(THREE.Mesh.prototype),{constructor:THREE.Sky,isSky:!0}),THREE.Sky.SkyShader={uniforms:{luminance:{value:1},turbidity:{value:2},rayleigh:{value:1},mieCoefficient:{value:.005},mieDirectionalG:{value:.8},sunPosition:{value:new THREE.Vector3}},vertexShader:["uniform vec3 sunPosition;","uniform float rayleigh;","uniform float turbidity;","uniform float mieCoefficient;","varying vec3 vWorldPosition;","varying vec3 vSunDirection;","varying float vSunfade;","varying vec3 vBetaR;","varying vec3 vBetaM;","varying float vSunE;","const vec3 up = vec3( 0.0, 1.0, 0.0 );","const float e = 2.71828182845904523536028747135266249775724709369995957;","const float pi = 3.141592653589793238462643383279502884197169;","const vec3 lambda = vec3( 680E-9, 550E-9, 450E-9 );","const vec3 totalRayleigh = vec3( 5.804542996261093E-6, 1.3562911419845635E-5, 3.0265902468824876E-5 );","const float v = 4.0;","const vec3 K = vec3( 0.686, 0.678, 0.666 );","const vec3 MieConst = vec3( 1.8399918514433978E14, 2.7798023919660528E14, 4.0790479543861094E14 );","const float cutoffAngle = 1.6110731556870734;","const float steepness = 1.5;","const float EE = 1000.0;","float sunIntensity( float zenithAngleCos ) {","\tzenithAngleCos = clamp( zenithAngleCos, -1.0, 1.0 );","\treturn EE * max( 0.0, 1.0 - pow( e, -( ( cutoffAngle - acos( zenithAngleCos ) ) / steepness ) ) );","}","vec3 totalMie( float T ) {","\tfloat c = ( 0.2 * T ) * 10E-18;","\treturn 0.434 * c * MieConst;","}","void main() {","\tvec4 worldPosition = modelMatrix * vec4( position, 1.0 );","\tvWorldPosition = worldPosition.xyz;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","\tgl_Position.z = gl_Position.w;","\tvSunDirection = normalize( sunPosition );","\tvSunE = sunIntensity( dot( vSunDirection, up ) );","\tvSunfade = 1.0 - clamp( 1.0 - exp( ( sunPosition.y / 450000.0 ) ), 0.0, 1.0 );","\tfloat rayleighCoefficient = rayleigh - ( 1.0 * ( 1.0 - vSunfade ) );","\tvBetaR = totalRayleigh * rayleighCoefficient;","\tvBetaM = totalMie( turbidity ) * mieCoefficient;","}"].join("\n"),fragmentShader:["varying vec3 vWorldPosition;","varying vec3 vSunDirection;","varying float vSunfade;","varying vec3 vBetaR;","varying vec3 vBetaM;","varying float vSunE;","uniform float luminance;","uniform float mieDirectionalG;","const vec3 cameraPos = vec3( 0.0, 0.0, 0.0 );","const float pi = 3.141592653589793238462643383279502884197169;","const float n = 1.0003;","const float N = 2.545E25;","const float rayleighZenithLength = 8.4E3;","const float mieZenithLength = 1.25E3;","const vec3 up = vec3( 0.0, 1.0, 0.0 );","const float sunAngularDiameterCos = 0.999956676946448443553574619906976478926848692873900859324;","const float THREE_OVER_SIXTEENPI = 0.05968310365946075;","const float ONE_OVER_FOURPI = 0.07957747154594767;","float rayleighPhase( float cosTheta ) {","\treturn THREE_OVER_SIXTEENPI * ( 1.0 + pow( cosTheta, 2.0 ) );","}","float hgPhase( float cosTheta, float g ) {","\tfloat g2 = pow( g, 2.0 );","\tfloat inverse = 1.0 / pow( 1.0 - 2.0 * g * cosTheta + g2, 1.5 );","\treturn ONE_OVER_FOURPI * ( ( 1.0 - g2 ) * inverse );","}","const float A = 0.15;","const float B = 0.50;","const float C = 0.10;","const float D = 0.20;","const float E = 0.02;","const float F = 0.30;","const float whiteScale = 1.0748724675633854;","vec3 Uncharted2Tonemap( vec3 x ) {","\treturn ( ( x * ( A * x + C * B ) + D * E ) / ( x * ( A * x + B ) + D * F ) ) - E / F;","}","void main() {","\tfloat zenithAngle = acos( max( 0.0, dot( up, normalize( vWorldPosition - cameraPos ) ) ) );","\tfloat inverse = 1.0 / ( cos( zenithAngle ) + 0.15 * pow( 93.885 - ( ( zenithAngle * 180.0 ) / pi ), -1.253 ) );","\tfloat sR = rayleighZenithLength * inverse;","\tfloat sM = mieZenithLength * inverse;","\tvec3 Fex = exp( -( vBetaR * sR + vBetaM * sM ) );","\tfloat cosTheta = dot( normalize( vWorldPosition - cameraPos ), vSunDirection );","\tfloat rPhase = rayleighPhase( cosTheta * 0.5 + 0.5 );","\tvec3 betaRTheta = vBetaR * rPhase;","\tfloat mPhase = hgPhase( cosTheta, mieDirectionalG );","\tvec3 betaMTheta = vBetaM * mPhase;","\tvec3 Lin = pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * ( 1.0 - Fex ), vec3( 1.5 ) );","\tLin *= mix( vec3( 1.0 ), pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * Fex, vec3( 1.0 / 2.0 ) ), clamp( pow( 1.0 - dot( up, vSunDirection ), 5.0 ), 0.0, 1.0 ) );","\tvec3 direction = normalize( vWorldPosition - cameraPos );","\tfloat theta = acos( direction.y ); // elevation --\x3e y-axis, [-pi/2, pi/2]","\tfloat phi = atan( direction.z, direction.x ); // azimuth --\x3e x-axis [-pi/2, pi/2]","\tvec2 uv = vec2( phi, theta ) / vec2( 2.0 * pi, pi ) + vec2( 0.5, 0.0 );","\tvec3 L0 = vec3( 0.1 ) * Fex;","\tfloat sundisk = smoothstep( sunAngularDiameterCos, sunAngularDiameterCos + 0.00002, cosTheta );","\tL0 += ( vSunE * 19000.0 * Fex ) * sundisk;","\tvec3 texColor = ( Lin + L0 ) * 0.04 + vec3( 0.0, 0.0003, 0.00075 );","\tvec3 curr = Uncharted2Tonemap( ( log2( 2.0 / pow( luminance, 4.0 ) ) ) * texColor );","\tvec3 color = curr * whiteScale;","\tvec3 retColor = pow( color, vec3( 1.0 / ( 1.2 + ( 1.2 * vSunfade ) ) ) );","\tgl_FragColor = vec4( retColor, 1.0 );","}"].join("\n")},THREE.SubdivisionModifier=function(e){this.subdivisions=void 0===e?1:e},THREE.SubdivisionModifier.prototype.modify=function(e){for(var t=this.subdivisions;t-- >0;)this.smooth(e);e.computeFaceNormals(),e.computeVertexNormals()},function(){function e(e,t,r){return r[Math.min(e,t)+"_"+Math.max(e,t)]}function t(e,t,r,i,n,o){var a,s=Math.min(e,t),l=Math.max(e,t),c=s+"_"+l;if(c in i)a=i[c];else{a={a:r[s],b:r[l],newEdge:null,faces:[]},i[c]=a}a.faces.push(n),o[e].edges.push(a),o[t].edges.push(a)}function r(e,t,r,i,n){e.push(new THREE.Face3(t,r,i,void 0,void 0,n))}function i(e,t){return Math.abs(t-e)/2+Math.min(e,t)}function n(e,t,r,i){e.push([t.clone(),r.clone(),i.clone()])}var o=["a","b","c"];THREE.SubdivisionModifier.prototype.smooth=function(a){var s,l,c,u,h,p,d,f,m,g,v,y,E,b,x=new THREE.Vector3,_=[];s=a.vertices,l=a.faces;var w=void 0!==(c=a.faceVertexUvs[0])&&c.length>0;(function(e,r,i,n){var o,a,s;for(o=0,a=e.length;o<a;o++)i[o]={edges:[]};for(o=0,a=r.length;o<a;o++)t((s=r[o]).a,s.b,e,n,s,i),t(s.b,s.c,e,n,s,i),t(s.c,s.a,e,n,s,i)})(s,l,v=new Array(s.length),y={}),E=[];var T,M,R,S,P,A,C;for(d in y){for(M=y[d],R=new THREE.Vector3,P=3/8,A=1/8,2!=(C=M.faces.length)&&(P=.5,A=0),R.addVectors(M.a,M.b).multiplyScalar(P),x.set(0,0,0),m=0;m<C;m++){for(S=M.faces[m],g=0;g<3&&((T=s[S[o[g]]])===M.a||T===M.b);g++);x.add(T)}x.multiplyScalar(A),R.add(x),M.newEdge=E.length,E.push(R)}var L,O,H,F,I,k,D;for(b=[],d=0,f=s.length;d<f;d++){for(k=s[d],3==(p=(I=v[d].edges).length)?L=3/16:p>3&&(L=3/(8*p)),O=1-p*L,H=L,p<=2&&2==p&&(O=.75,H=1/8),D=k.clone().multiplyScalar(O),x.set(0,0,0),m=0;m<p;m++)T=(F=I[m]).a!==k?F.a:F.b,x.add(T);x.multiplyScalar(H),D.add(x),b.push(D)}u=b.concat(E);var N,j,U,B=b.length;h=[];var V,z,q,G,W=new THREE.Vector2,X=new THREE.Vector2,Y=new THREE.Vector2;for(d=0,f=l.length;d<f;d++)r(h,N=e((S=l[d]).a,S.b,y).newEdge+B,j=e(S.b,S.c,y).newEdge+B,U=e(S.c,S.a,y).newEdge+B,S.materialIndex),r(h,S.a,N,U,S.materialIndex),r(h,S.b,j,N,S.materialIndex),r(h,S.c,U,j,S.materialIndex),w&&(z=(V=c[d])[0],q=V[1],G=V[2],W.set(i(z.x,q.x),i(z.y,q.y)),X.set(i(q.x,G.x),i(q.y,G.y)),Y.set(i(z.x,G.x),i(z.y,G.y)),n(_,W,X,Y),n(_,z,W,Y),n(_,q,X,W),n(_,G,Y,X));a.vertices=u,a.faces=h,w&&(a.faceVertexUvs[0]=_)}}();var THREEx=THREEx||{};THREEx.HtmlMixer=THREEx.HtmlMixer||{},THREEx.HtmlMixer.Context=function(e,t,r){var i=[];this.update=function(){i.forEach(function(e){e()})};this.cssFactor=1e3;var n=new THREE.CSS3DRenderer;this.rendererCss=n,this.rendererWebgl=e;var o=new THREE.PerspectiveCamera(r.fov,r.aspect,1e3*r.near,1e3*r.far);i.push(function(){o.quaternion.copy(r.quaternion),o.position.copy(r.position).multiplyScalar(1e3)});var a=new THREE.Scene;this.cssScene=a,this.autoUpdateObjects=!0,i.push(function(){!0===this.autoUpdateObjects&&a.traverse(function(e){if(e instanceof THREE.Scene!=!0){var t=e.userData.mixerPlane;void 0!==t&&t.update()}})}.bind(this)),i.push(function(e,t){n.render(a,o)})},THREEx.HtmlMixer.Plane=function(e,t,r){function i(){t.style.width=h+"px",t.style.height=p+"px"}(r=r||{}).elementW=void 0!==r.elementW?r.elementW:768,r.planeW=void 0!==r.planeW?r.planeW:1,r.planeH=void 0!==r.planeH?r.planeH:.75,r.object3d=void 0!==r.object3d?r.object3d:null,this.domElement=t;var n=[];this.update=function(){n.forEach(function(e){e()})};var o=r.planeW,a=r.planeH;if(null===r.object3d)var s=new THREE.MeshBasicMaterial({opacity:0,color:new THREE.Color("black"),blending:THREE.NoBlending,side:THREE.DoubleSide}),l=new THREE.PlaneGeometry(r.planeW,r.planeH),c=new THREE.Mesh(l,s);else c=r.object3d;this.object3d=c;var u=a/o,h=r.elementW,p=h*u;this.setDomElement=function(e){console.log("setDomElement: newDomElement",e);var r=t;r.parentNode&&r.parentNode.removeChild(r),this.domElement=t=e,d.element=t,i()},i();var d=new THREE.CSS3DObject(t);this.cssObject=d,d.scale.set(1,1,1).multiplyScalar(e.cssFactor/(h/o)),d.userData.mixerPlane=this,c.addEventListener("added",function(t){e.cssScene.add(d)}),c.addEventListener("removed",function(t){e.cssScene.remove(d)}),n.push(function(){c.updateMatrixWorld();var t=c.matrixWorld,r=new THREE.Vector3,i=new THREE.Vector3,n=new THREE.Quaternion;t.decompose(r,n,i),d.quaternion.copy(n),d.position.copy(r).multiplyScalar(e.cssFactor);var o=h/(c.geometry.parameters.width*i.x);d.scale.set(1,1,1).multiplyScalar(e.cssFactor/o)})},THREE.TransformControls=function(e,t){function r(e,t){var r=t;Object.defineProperty(h,e,{get:function(){return void 0!==r?r:t},set:function(t){r!==t&&(r=t,u[e]=t,c[e]=t,h.dispatchEvent({type:e+"-changed",value:t}),h.dispatchEvent(p))}}),h[e]=t,u[e]=t,c[e]=t}function i(e){var r=e.changedTouches?e.changedTouches[0]:e,i=t.getBoundingClientRect();return{x:(r.clientX-i.left)/i.width*2-1,y:-(r.clientY-i.top)/i.height*2+1,button:e.button}}function n(e){e.preventDefault()}function o(e){h.enabled&&h.pointerHover(i(e))}function a(e){h.enabled&&(e.preventDefault(),document.addEventListener("mousemove",s,!1),h.pointerHover(i(e)),h.pointerDown(i(e)))}function s(e){h.enabled&&(e.preventDefault(),h.pointerMove(i(e)))}function l(e){h.enabled&&(e.preventDefault(),document.removeEventListener("mousemove",s,!1),h.pointerUp(i(e)))}THREE.Object3D.call(this),t=void 0!==t?t:document,this.visible=!1;var c=new THREE.TransformControlsGizmo;this._gizmo=c,this.add(c);var u=new THREE.TransformControlsPlane;this._plane=u,this.add(u);var h=this;r("camera",e),r("object",void 0),r("enabled",!0),r("axis",null),r("mode","translate"),r("translationSnap",null),r("rotationSnap",null),r("space","world"),r("size",1),r("dragging",!1),r("showX",!0),r("showY",!0),r("showZ",!0);var p={type:"change"},d={type:"mouseDown"},f={type:"mouseUp",mode:h.mode},m={type:"objectChange"},g=new THREE.Raycaster,v=new THREE.Vector3,y=new THREE.Vector3,E=new THREE.Quaternion,b={X:new THREE.Vector3(1,0,0),Y:new THREE.Vector3(0,1,0),Z:new THREE.Vector3(0,0,1)},x=new THREE.Quaternion,_=new THREE.Vector3,w=new THREE.Vector3,T=new THREE.Vector3,M=new THREE.Vector3,R=0,S=new THREE.Vector3,P=new THREE.Quaternion,A=new THREE.Vector3,C=new THREE.Vector3,L=new THREE.Quaternion,O=new THREE.Vector3,H=new THREE.Vector3,F=new THREE.Quaternion,I=new THREE.Vector3,k=new THREE.Vector3,D=new THREE.Quaternion,N=new THREE.Vector3,j=new THREE.Vector3,U=new THREE.Vector3,B=new THREE.Quaternion,V=new THREE.Vector3;r("parentQuaternion",L),r("worldPosition",k),r("worldPositionStart",H),r("worldQuaternion",D),r("worldQuaternionStart",F),r("cameraPosition",S),r("cameraQuaternion",P),r("pointStart",w),r("pointEnd",T),r("rotationAxis",M),r("rotationAngle",R),r("eye",j),t.addEventListener("mousedown",a,!1),t.addEventListener("touchstart",a,!1),t.addEventListener("mousemove",o,!1),t.addEventListener("touchmove",o,!1),t.addEventListener("touchmove",s,!1),document.addEventListener("mouseup",l,!1),t.addEventListener("touchend",l,!1),t.addEventListener("touchcancel",l,!1),t.addEventListener("touchleave",l,!1),t.addEventListener("contextmenu",n,!1),this.dispose=function(){t.removeEventListener("mousedown",a),t.removeEventListener("touchstart",a),t.removeEventListener("mousemove",o),t.removeEventListener("touchmove",o),t.removeEventListener("touchmove",s),document.removeEventListener("mouseup",l),t.removeEventListener("touchend",l),t.removeEventListener("touchcancel",l),t.removeEventListener("touchleave",l),t.removeEventListener("contextmenu",n)},this.attach=function(e){this.object=e,this.visible=!0},this.detach=function(){this.object=void 0,this.visible=!1,this.axis=null},this.updateMatrixWorld=function(){void 0!==this.object&&(this.object.updateMatrixWorld(),this.object.parent.matrixWorld.decompose(C,L,O),this.object.matrixWorld.decompose(k,D,N)),this.camera.updateMatrixWorld(),this.camera.matrixWorld.decompose(S,P,A),this.camera.isPerspectiveCamera?j.copy(S).sub(k).normalize():this.camera.isOrthographicCamera&&j.copy(S).normalize(),THREE.Object3D.prototype.updateMatrixWorld.call(this)},this.pointerHover=function(e){if(void 0!==this.object&&!0!==this.dragging&&(void 0===e.button||0===e.button)){g.setFromCamera(e,this.camera);var t=g.intersectObjects(c.picker[this.mode].children,!0)[0]||!1;this.axis=t?t.object.name:null}},this.pointerDown=function(e){if(!(void 0===this.object||!0===this.dragging||void 0!==e.button&&0!==e.button||0!==e.button&&void 0!==e.button||null===this.axis)){g.setFromCamera(e,this.camera);var t=g.intersectObjects([u],!0)[0]||!1;if(t){var r=this.space;if("scale"===this.mode?r="local":"E"!==this.axis&&"XYZE"!==this.axis&&"XYZ"!==this.axis||(r="world"),"local"===r&&"rotate"===this.mode){var i=this.rotationSnap;"X"===this.axis&&i&&(this.object.rotation.x=Math.round(this.object.rotation.x/i)*i),"Y"===this.axis&&i&&(this.object.rotation.y=Math.round(this.object.rotation.y/i)*i),"Z"===this.axis&&i&&(this.object.rotation.z=Math.round(this.object.rotation.z/i)*i)}this.object.updateMatrixWorld(),this.object.parent.updateMatrixWorld(),U.copy(this.object.position),B.copy(this.object.quaternion),V.copy(this.object.scale),this.object.matrixWorld.decompose(H,F,I),w.copy(t.point).sub(H),"local"===r&&w.applyQuaternion(F.clone().inverse())}this.dragging=!0,d.mode=this.mode,this.dispatchEvent(d)}},this.pointerMove=function(e){var t=this.axis,r=this.mode,i=this.object,n=this.space;if("scale"===r?n="local":"E"!==t&&"XYZE"!==t&&"XYZ"!==t||(n="world"),void 0!==i&&null!==t&&!1!==this.dragging&&(void 0===e.button||0===e.button)){g.setFromCamera(e,this.camera);var o=g.intersectObjects([u],!0)[0]||!1;if(!1!==o){if(T.copy(o.point).sub(H),"local"===n&&T.applyQuaternion(F.clone().inverse()),"translate"===r)-1===t.search("X")&&(T.x=w.x),-1===t.search("Y")&&(T.y=w.y),-1===t.search("Z")&&(T.z=w.z),"local"===n?i.position.copy(T).sub(w).applyQuaternion(B):i.position.copy(T).sub(w),i.position.add(U),this.translationSnap&&("local"===n&&(i.position.applyQuaternion(E.copy(B).inverse()),-1!==t.search("X")&&(i.position.x=Math.round(i.position.x/this.translationSnap)*this.translationSnap),-1!==t.search("Y")&&(i.position.y=Math.round(i.position.y/this.translationSnap)*this.translationSnap),-1!==t.search("Z")&&(i.position.z=Math.round(i.position.z/this.translationSnap)*this.translationSnap),i.position.applyQuaternion(B)),"world"===n&&(i.parent&&i.position.add(v.setFromMatrixPosition(i.parent.matrixWorld)),-1!==t.search("X")&&(i.position.x=Math.round(i.position.x/this.translationSnap)*this.translationSnap),-1!==t.search("Y")&&(i.position.y=Math.round(i.position.y/this.translationSnap)*this.translationSnap),-1!==t.search("Z")&&(i.position.z=Math.round(i.position.z/this.translationSnap)*this.translationSnap),i.parent&&i.position.sub(v.setFromMatrixPosition(i.parent.matrixWorld))));else if("scale"===r){if(-1!==t.search("XYZ")){var a=T.length()/w.length();T.dot(w)<0&&(a*=-1),v.set(a,a,a)}else v.copy(T).divide(w),-1===t.search("X")&&(v.x=1),-1===t.search("Y")&&(v.y=1),-1===t.search("Z")&&(v.z=1);i.scale.copy(V).multiply(v)}else if("rotate"===r){var s=20/k.distanceTo(v.setFromMatrixPosition(this.camera.matrixWorld)),l="local"===this.space?D:x,c=b[t];"E"===t?(v.copy(T).cross(w),M.copy(j),R=T.angleTo(w)*(v.dot(j)<0?1:-1)):"XYZE"===t?(v.copy(T).sub(w).cross(j).normalize(),M.copy(v),R=T.sub(w).dot(v.cross(j))*s):"X"!==t&&"Y"!==t&&"Z"!==t||(_.copy(c).applyQuaternion(l),M.copy(c),v=c.clone(),y=T.clone().sub(w),"local"===n&&(v.applyQuaternion(l),y.applyQuaternion(F)),R=y.dot(v.cross(j).normalize())*s),this.rotationSnap&&(R=Math.round(R/this.rotationSnap)*this.rotationSnap),this.rotationAngle=R,"local"===n?(i.quaternion.copy(B),i.quaternion.multiply(E.setFromAxisAngle(M,R))):(i.quaternion.copy(E.setFromAxisAngle(M,R)),i.quaternion.multiply(B))}this.dispatchEvent(p),this.dispatchEvent(m)}}},this.pointerUp=function(e){void 0!==e.button&&0!==e.button||(this.dragging&&null!==this.axis&&(f.mode=this.mode,this.dispatchEvent(f)),this.dragging=!1,void 0===e.button&&(this.axis=null))},this.getMode=function(){return h.mode},this.setMode=function(e){h.mode=e},this.setTranslationSnap=function(e){h.translationSnap=e},this.setRotationSnap=function(e){h.rotationSnap=e},this.setSize=function(e){h.size=e},this.setSpace=function(e){h.space=e},this.update=function(){console.warn("THREE.TransformControls: update function has been depricated.")}},THREE.TransformControls.prototype=Object.assign(Object.create(THREE.Object3D.prototype),{constructor:THREE.TransformControls,isTransformControls:!0}),THREE.TransformControlsGizmo=function(){"use strict";THREE.Object3D.call(this),this.type="TransformControlsGizmo";var e=new THREE.MeshBasicMaterial({depthTest:!1,depthWrite:!1,transparent:!0,side:THREE.DoubleSide,fog:!1}),t=new THREE.LineBasicMaterial({depthTest:!1,depthWrite:!1,transparent:!0,linewidth:1,fog:!1}),r=e.clone();r.opacity=.15;var i=e.clone();i.opacity=.33;var n=e.clone();n.color.set(16711680);var o=e.clone();o.color.set(65280);var a=e.clone();a.color.set(255);var s=e.clone();s.opacity=.25;var l=s.clone();l.color.set(16776960);var c=s.clone();c.color.set(65535);var u=s.clone();u.color.set(16711935);e.clone().color.set(16776960);var h=t.clone();h.color.set(16711680);var p=t.clone();p.color.set(65280);var d=t.clone();d.color.set(255);var f=t.clone();f.color.set(65535);var m=t.clone();m.color.set(16711935);var g=t.clone();g.color.set(16776960);var v=t.clone();v.color.set(7895160);var y=g.clone();y.opacity=.25;var E=new THREE.CylinderBufferGeometry(0,.05,.2,12,1,!1),b=new THREE.BoxBufferGeometry(.125,.125,.125),x=new THREE.BufferGeometry;x.addAttribute("position",new THREE.Float32BufferAttribute([0,0,0,1,0,0],3));var _=function(e,t){for(var r=new THREE.BufferGeometry,i=[],n=0;n<=64*t;++n)i.push(0,Math.cos(n/32*Math.PI)*e,Math.sin(n/32*Math.PI)*e);return r.addAttribute("position",new THREE.Float32BufferAttribute(i,3)),r},w={X:[[new THREE.Mesh(E,n),[1,0,0],[0,0,-Math.PI/2],null,"fwd"],[new THREE.Mesh(E,n),[1,0,0],[0,0,Math.PI/2],null,"bwd"],[new THREE.Line(x,h)]],Y:[[new THREE.Mesh(E,o),[0,1,0],null,null,"fwd"],[new THREE.Mesh(E,o),[0,1,0],[Math.PI,0,0],null,"bwd"],[new THREE.Line(x,p),null,[0,0,Math.PI/2]]],Z:[[new THREE.Mesh(E,a),[0,0,1],[Math.PI/2,0,0],null,"fwd"],[new THREE.Mesh(E,a),[0,0,1],[-Math.PI/2,0,0],null,"bwd"],[new THREE.Line(x,d),null,[0,-Math.PI/2,0]]],XYZ:[[new THREE.Mesh(new THREE.OctahedronBufferGeometry(.1,0),s),[0,0,0],[0,0,0]]],XY:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.295,.295),l),[.15,.15,0]],[new THREE.Line(x,g),[.18,.3,0],null,[.125,1,1]],[new THREE.Line(x,g),[.3,.18,0],[0,0,Math.PI/2],[.125,1,1]]],YZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.295,.295),c),[0,.15,.15],[0,Math.PI/2,0]],[new THREE.Line(x,f),[0,.18,.3],[0,0,Math.PI/2],[.125,1,1]],[new THREE.Line(x,f),[0,.3,.18],[0,-Math.PI/2,0],[.125,1,1]]],XZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.295,.295),u),[.15,0,.15],[-Math.PI/2,0,0]],[new THREE.Line(x,m),[.18,0,.3],null,[.125,1,1]],[new THREE.Line(x,m),[.3,0,.18],[0,-Math.PI/2,0],[.125,1,1]]]},T={X:[[new THREE.Mesh(new THREE.CylinderBufferGeometry(.2,0,1,4,1,!1),r),[.6,0,0],[0,0,-Math.PI/2]]],Y:[[new THREE.Mesh(new THREE.CylinderBufferGeometry(.2,0,1,4,1,!1),r),[0,.6,0]]],Z:[[new THREE.Mesh(new THREE.CylinderBufferGeometry(.2,0,1,4,1,!1),r),[0,0,.6],[Math.PI/2,0,0]]],XYZ:[[new THREE.Mesh(new THREE.OctahedronBufferGeometry(.2,0),r)]],XY:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.4,.4),r),[.2,.2,0]]],YZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.4,.4),r),[0,.2,.2],[0,Math.PI/2,0]]],XZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.4,.4),r),[.2,0,.2],[-Math.PI/2,0,0]]]},M={START:[[new THREE.Mesh(new THREE.OctahedronBufferGeometry(.01,2),i),null,null,null,"helper"]],END:[[new THREE.Mesh(new THREE.OctahedronBufferGeometry(.01,2),i),null,null,null,"helper"]],DELTA:[[new THREE.Line(function(e,t){var r=new THREE.BufferGeometry;return r.addAttribute("position",new THREE.Float32BufferAttribute([0,0,0,1,1,1],3)),r}(),i),null,null,null,"helper"]],X:[[new THREE.Line(x,i.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new THREE.Line(x,i.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new THREE.Line(x,i.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},R={X:[[new THREE.Line(_(1,.5),h)],[new THREE.Mesh(new THREE.OctahedronBufferGeometry(.04,0),n),[0,0,.99],null,[1,3,1]]],Y:[[new THREE.Line(_(1,.5),p),null,[0,0,-Math.PI/2]],[new THREE.Mesh(new THREE.OctahedronBufferGeometry(.04,0),o),[0,0,.99],null,[3,1,1]]],Z:[[new THREE.Line(_(1,.5),d),null,[0,Math.PI/2,0]],[new THREE.Mesh(new THREE.OctahedronBufferGeometry(.04,0),a),[.99,0,0],null,[1,3,1]]],E:[[new THREE.Line(_(1.25,1),y),null,[0,Math.PI/2,0]],[new THREE.Mesh(new THREE.CylinderBufferGeometry(.03,0,.15,4,1,!1),y),[1.17,0,0],[0,0,-Math.PI/2],[1,1,.001]],[new THREE.Mesh(new THREE.CylinderBufferGeometry(.03,0,.15,4,1,!1),y),[-1.17,0,0],[0,0,Math.PI/2],[1,1,.001]],[new THREE.Mesh(new THREE.CylinderBufferGeometry(.03,0,.15,4,1,!1),y),[0,-1.17,0],[Math.PI,0,0],[1,1,.001]],[new THREE.Mesh(new THREE.CylinderBufferGeometry(.03,0,.15,4,1,!1),y),[0,1.17,0],[0,0,0],[1,1,.001]]],XYZE:[[new THREE.Line(_(1,1),v),null,[0,Math.PI/2,0]]]},S={AXIS:[[new THREE.Line(x,i.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},P={X:[[new THREE.Mesh(new THREE.TorusBufferGeometry(1,.1,4,24),r),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new THREE.Mesh(new THREE.TorusBufferGeometry(1,.1,4,24),r),[0,0,0],[Math.PI/2,0,0]]],Z:[[new THREE.Mesh(new THREE.TorusBufferGeometry(1,.1,4,24),r),[0,0,0],[0,0,-Math.PI/2]]],E:[[new THREE.Mesh(new THREE.TorusBufferGeometry(1.25,.1,2,24),r)]],XYZE:[[new THREE.Mesh(new THREE.SphereBufferGeometry(.7,10,8),r)]]},A={X:[[new THREE.Mesh(b,n),[.8,0,0],[0,0,-Math.PI/2]],[new THREE.Line(x,h),null,null,[.8,1,1]]],Y:[[new THREE.Mesh(b,o),[0,.8,0]],[new THREE.Line(x,p),null,[0,0,Math.PI/2],[.8,1,1]]],Z:[[new THREE.Mesh(b,a),[0,0,.8],[Math.PI/2,0,0]],[new THREE.Line(x,d),null,[0,-Math.PI/2,0],[.8,1,1]]],XY:[[new THREE.Mesh(b,l),[.85,.85,0],null,[2,2,.2]],[new THREE.Line(x,g),[.855,.98,0],null,[.125,1,1]],[new THREE.Line(x,g),[.98,.855,0],[0,0,Math.PI/2],[.125,1,1]]],YZ:[[new THREE.Mesh(b,c),[0,.85,.85],null,[.2,2,2]],[new THREE.Line(x,f),[0,.855,.98],[0,0,Math.PI/2],[.125,1,1]],[new THREE.Line(x,f),[0,.98,.855],[0,-Math.PI/2,0],[.125,1,1]]],XZ:[[new THREE.Mesh(b,u),[.85,0,.85],null,[2,.2,2]],[new THREE.Line(x,m),[.855,0,.98],null,[.125,1,1]],[new THREE.Line(x,m),[.98,0,.855],[0,-Math.PI/2,0],[.125,1,1]]],XYZX:[[new THREE.Mesh(new THREE.BoxBufferGeometry(.125,.125,.125),s),[1.1,0,0]]],XYZY:[[new THREE.Mesh(new THREE.BoxBufferGeometry(.125,.125,.125),s),[0,1.1,0]]],XYZZ:[[new THREE.Mesh(new THREE.BoxBufferGeometry(.125,.125,.125),s),[0,0,1.1]]]},C={X:[[new THREE.Mesh(new THREE.CylinderBufferGeometry(.2,0,.8,4,1,!1),r),[.5,0,0],[0,0,-Math.PI/2]]],Y:[[new THREE.Mesh(new THREE.CylinderBufferGeometry(.2,0,.8,4,1,!1),r),[0,.5,0]]],Z:[[new THREE.Mesh(new THREE.CylinderBufferGeometry(.2,0,.8,4,1,!1),r),[0,0,.5],[Math.PI/2,0,0]]],XY:[[new THREE.Mesh(b,r),[.85,.85,0],null,[3,3,.2]]],YZ:[[new THREE.Mesh(b,r),[0,.85,.85],null,[.2,3,3]]],XZ:[[new THREE.Mesh(b,r),[.85,0,.85],null,[3,.2,3]]],XYZX:[[new THREE.Mesh(new THREE.BoxBufferGeometry(.2,.2,.2),r),[1.1,0,0]]],XYZY:[[new THREE.Mesh(new THREE.BoxBufferGeometry(.2,.2,.2),r),[0,1.1,0]]],XYZZ:[[new THREE.Mesh(new THREE.BoxBufferGeometry(.2,.2,.2),r),[0,0,1.1]]]},L={X:[[new THREE.Line(x,i.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new THREE.Line(x,i.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new THREE.Line(x,i.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},O=function(e){var t=new THREE.Object3D;for(var r in e)for(var i=e[r].length;i--;){var n=e[r][i][0].clone(),o=e[r][i][1],a=e[r][i][2],s=e[r][i][3],l=e[r][i][4];n.name=r,n.tag=l,o&&n.position.set(o[0],o[1],o[2]),a&&n.rotation.set(a[0],a[1],a[2]),s&&n.scale.set(s[0],s[1],s[2]),n.updateMatrix();var c=n.geometry.clone();c.applyMatrix(n.matrix),n.geometry=c,n.position.set(0,0,0),n.rotation.set(0,0,0),n.scale.set(1,1,1),t.add(n)}return t},H=new THREE.Vector3(0,0,0),F=new THREE.Euler,I=new THREE.Vector3(0,1,0),k=new THREE.Vector3(0,0,0),D=new THREE.Matrix4,N=new THREE.Quaternion,j=new THREE.Quaternion,U=new THREE.Quaternion,B=new THREE.Vector3(1,0,0),V=new THREE.Vector3(0,1,0),z=new THREE.Vector3(0,0,1);this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo.translate=O(w)),this.add(this.gizmo.rotate=O(R)),this.add(this.gizmo.scale=O(A)),this.add(this.picker.translate=O(T)),this.add(this.picker.rotate=O(P)),this.add(this.picker.scale=O(C)),this.add(this.helper.translate=O(M)),this.add(this.helper.rotate=O(S)),this.add(this.helper.scale=O(L)),this.picker.translate.visible=!1,this.picker.rotate.visible=!1,this.picker.scale.visible=!1,this.updateMatrixWorld=function(){var e=this.space;"scale"===this.mode&&(e="local");var t="local"===e?this.worldQuaternion:U;this.gizmo.translate.visible="translate"===this.mode,this.gizmo.rotate.visible="rotate"===this.mode,this.gizmo.scale.visible="scale"===this.mode,this.helper.translate.visible="translate"===this.mode,this.helper.rotate.visible="rotate"===this.mode,this.helper.scale.visible="scale"===this.mode;var r=[];r=(r=(r=r.concat(this.picker[this.mode].children)).concat(this.gizmo[this.mode].children)).concat(this.helper[this.mode].children);for(var i=0;i<r.length;i++){var n=r[i];n.visible=!0,n.rotation.set(0,0,0),n.position.copy(this.worldPosition);var o=this.worldPosition.distanceTo(this.cameraPosition);if(n.scale.set(1,1,1).multiplyScalar(o*this.size/7),"helper"!==n.tag){if(n.quaternion.copy(t),"translate"===this.mode||"scale"===this.mode){"X"!==n.name&&"XYZX"!==n.name||Math.abs(I.copy(B).applyQuaternion(t).dot(this.eye))>.99&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),"Y"!==n.name&&"XYZY"!==n.name||Math.abs(I.copy(V).applyQuaternion(t).dot(this.eye))>.99&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),"Z"!==n.name&&"XYZZ"!==n.name||Math.abs(I.copy(z).applyQuaternion(t).dot(this.eye))>.99&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),"XY"===n.name&&Math.abs(I.copy(z).applyQuaternion(t).dot(this.eye))<.2&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),"YZ"===n.name&&Math.abs(I.copy(B).applyQuaternion(t).dot(this.eye))<.2&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),"XZ"===n.name&&Math.abs(I.copy(V).applyQuaternion(t).dot(this.eye))<.2&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),-1!==n.name.search("X")&&(I.copy(B).applyQuaternion(t).dot(this.eye)<-.4?"fwd"===n.tag?n.visible=!1:n.scale.x*=-1:"bwd"===n.tag&&(n.visible=!1)),-1!==n.name.search("Y")&&(I.copy(V).applyQuaternion(t).dot(this.eye)<-.4?"fwd"===n.tag?n.visible=!1:n.scale.y*=-1:"bwd"===n.tag&&(n.visible=!1)),-1!==n.name.search("Z")&&(I.copy(z).applyQuaternion(t).dot(this.eye)<-.4?"fwd"===n.tag?n.visible=!1:n.scale.z*=-1:"bwd"===n.tag&&(n.visible=!1))}else"rotate"===this.mode&&(j.copy(t),I.copy(this.eye).applyQuaternion(N.copy(t).inverse()),-1!==n.name.search("E")&&n.quaternion.setFromRotationMatrix(D.lookAt(this.eye,k,V)),"X"===n.name&&(N.setFromAxisAngle(B,Math.atan2(-I.y,I.z)),N.multiplyQuaternions(j,N),n.quaternion.copy(N)),"Y"===n.name&&(N.setFromAxisAngle(V,Math.atan2(I.x,I.z)),N.multiplyQuaternions(j,N),n.quaternion.copy(N)),"Z"===n.name&&(N.setFromAxisAngle(z,Math.atan2(I.y,I.x)),N.multiplyQuaternions(j,N),n.quaternion.copy(N)));n.visible=n.visible&&(-1===n.name.indexOf("X")||this.showX),n.visible=n.visible&&(-1===n.name.indexOf("Y")||this.showY),n.visible=n.visible&&(-1===n.name.indexOf("Z")||this.showZ),n.visible=n.visible&&(-1===n.name.indexOf("E")||this.showX&&this.showY&&this.showZ),n.material._opacity=n.material._opacity||n.material.opacity,n.material._color=n.material._color||n.material.color.clone(),n.material.color.copy(n.material._color),n.material.opacity=n.material._opacity,this.enabled?this.axis&&(n.name===this.axis?(n.material.opacity=1,n.material.color.lerp(new THREE.Color(1,1,1),.5)):this.axis.split("").some(function(e){return n.name===e})?(n.material.opacity=1,n.material.color.lerp(new THREE.Color(1,1,1),.5)):(n.material.opacity*=.25,n.material.color.lerp(new THREE.Color(1,1,1),.5))):(n.material.opacity*=.5,n.material.color.lerp(new THREE.Color(1,1,1),.5))}else n.visible=!1,"AXIS"===n.name?(n.position.copy(this.worldPositionStart),n.visible=!!this.axis,"X"===this.axis&&(N.setFromEuler(F.set(0,0,0)),n.quaternion.copy(t).multiply(N),Math.abs(I.copy(B).applyQuaternion(t).dot(this.eye))>.9&&(n.visible=!1)),"Y"===this.axis&&(N.setFromEuler(F.set(0,0,Math.PI/2)),n.quaternion.copy(t).multiply(N),Math.abs(I.copy(V).applyQuaternion(t).dot(this.eye))>.9&&(n.visible=!1)),"Z"===this.axis&&(N.setFromEuler(F.set(0,Math.PI/2,0)),n.quaternion.copy(t).multiply(N),Math.abs(I.copy(z).applyQuaternion(t).dot(this.eye))>.9&&(n.visible=!1)),"XYZE"===this.axis&&(N.setFromEuler(F.set(0,Math.PI/2,0)),I.copy(this.rotationAxis),n.quaternion.setFromRotationMatrix(D.lookAt(k,I,V)),n.quaternion.multiply(N),n.visible=this.dragging),"E"===this.axis&&(n.visible=!1)):"START"===n.name?(n.position.copy(this.worldPositionStart),n.visible=this.dragging):"END"===n.name?(n.position.copy(this.worldPosition),n.visible=this.dragging):"DELTA"===n.name?(n.position.copy(this.worldPositionStart),n.quaternion.copy(this.worldQuaternionStart),H.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),H.applyQuaternion(this.worldQuaternionStart.clone().inverse()),n.scale.copy(H),n.visible=this.dragging):(n.quaternion.copy(t),this.dragging?n.position.copy(this.worldPositionStart):n.position.copy(this.worldPosition),this.axis&&(n.visible=-1!==this.axis.search(n.name)))}THREE.Object3D.prototype.updateMatrixWorld.call(this)}},THREE.TransformControlsGizmo.prototype=Object.assign(Object.create(THREE.Object3D.prototype),{constructor:THREE.TransformControlsGizmo,isTransformControlsGizmo:!0}),THREE.TransformControlsPlane=function(){"use strict";THREE.Mesh.call(this,new THREE.PlaneBufferGeometry(1e5,1e5,2,2),new THREE.MeshBasicMaterial({visible:!1,wireframe:!0,side:THREE.DoubleSide,transparent:!0,opacity:.1})),this.type="TransformControlsPlane";var e=new THREE.Vector3(1,0,0),t=new THREE.Vector3(0,1,0),r=new THREE.Vector3(0,0,1),i=new THREE.Vector3,n=new THREE.Vector3,o=new THREE.Vector3,a=new THREE.Matrix4,s=new THREE.Quaternion;this.updateMatrixWorld=function(){var l=this.space;switch(this.position.copy(this.worldPosition),"scale"===this.mode&&(l="local"),e.set(1,0,0).applyQuaternion("local"===l?this.worldQuaternion:s),t.set(0,1,0).applyQuaternion("local"===l?this.worldQuaternion:s),r.set(0,0,1).applyQuaternion("local"===l?this.worldQuaternion:s),o.copy(t),this.mode){case"translate":case"scale":switch(this.axis){case"X":o.copy(this.eye).cross(e),n.copy(e).cross(o);break;case"Y":o.copy(this.eye).cross(t),n.copy(t).cross(o);break;case"Z":o.copy(this.eye).cross(r),n.copy(r).cross(o);break;case"XY":n.copy(r);break;case"YZ":n.copy(e);break;case"XZ":o.copy(r),n.copy(t);break;case"XYZ":case"E":n.set(0,0,0)}break;case"rotate":default:n.set(0,0,0)}0===n.length()?this.quaternion.copy(this.cameraQuaternion):(a.lookAt(i.set(0,0,0),n,o),this.quaternion.setFromRotationMatrix(a)),THREE.Object3D.prototype.updateMatrixWorld.call(this)}},THREE.TransformControlsPlane.prototype=Object.assign(Object.create(THREE.Mesh.prototype),{constructor:THREE.TransformControlsPlane,isTransformControlsPlane:!0}),THREE.UnrealBloomPass=function(e,t,r,i){THREE.Pass.call(this),this.strength=void 0!==t?t:1,this.radius=r,this.threshold=i,this.resolution=void 0!==e?new THREE.Vector2(e.x,e.y):new THREE.Vector2(256,256);var n={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat};this.renderTargetsHorizontal=[],this.renderTargetsVertical=[],this.nMips=5;var o=Math.round(this.resolution.x/2),a=Math.round(this.resolution.y/2);this.renderTargetBright=new THREE.WebGLRenderTarget(o,a,n),this.renderTargetBright.texture.name="UnrealBloomPass.bright",this.renderTargetBright.texture.generateMipmaps=!1;for(u=0;u<this.nMips;u++){s=new THREE.WebGLRenderTarget(o,a,n);s.texture.name="UnrealBloomPass.h"+u,s.texture.generateMipmaps=!1,this.renderTargetsHorizontal.push(s);var s;(s=new THREE.WebGLRenderTarget(o,a,n)).texture.name="UnrealBloomPass.v"+u,s.texture.generateMipmaps=!1,this.renderTargetsVertical.push(s),o=Math.round(o/2),a=Math.round(a/2)}void 0===THREE.LuminosityHighPassShader&&console.error("THREE.UnrealBloomPass relies on THREE.LuminosityHighPassShader");var l=THREE.LuminosityHighPassShader;this.highPassUniforms=THREE.UniformsUtils.clone(l.uniforms),this.highPassUniforms.luminosityThreshold.value=i,this.highPassUniforms.smoothWidth.value=.01,this.materialHighPassFilter=new THREE.ShaderMaterial({uniforms:this.highPassUniforms,vertexShader:l.vertexShader,fragmentShader:l.fragmentShader,defines:{}}),this.separableBlurMaterials=[];for(var c=[3,5,7,9,11],o=Math.round(this.resolution.x/2),a=Math.round(this.resolution.y/2),u=0;u<this.nMips;u++)this.separableBlurMaterials.push(this.getSeperableBlurMaterial(c[u])),this.separableBlurMaterials[u].uniforms.texSize.value=new THREE.Vector2(o,a),o=Math.round(o/2),a=Math.round(a/2);this.compositeMaterial=this.getCompositeMaterial(this.nMips),this.compositeMaterial.uniforms.blurTexture1.value=this.renderTargetsVertical[0].texture,this.compositeMaterial.uniforms.blurTexture2.value=this.renderTargetsVertical[1].texture,this.compositeMaterial.uniforms.blurTexture3.value=this.renderTargetsVertical[2].texture,this.compositeMaterial.uniforms.blurTexture4.value=this.renderTargetsVertical[3].texture,this.compositeMaterial.uniforms.blurTexture5.value=this.renderTargetsVertical[4].texture,this.compositeMaterial.uniforms.bloomStrength.value=t,this.compositeMaterial.uniforms.bloomRadius.value=.1,this.compositeMaterial.needsUpdate=!0;this.compositeMaterial.uniforms.bloomFactors.value=[1,.8,.6,.4,.2],this.bloomTintColors=[new THREE.Vector3(1,1,1),new THREE.Vector3(1,1,1),new THREE.Vector3(1,1,1),new THREE.Vector3(1,1,1),new THREE.Vector3(1,1,1)],this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors,void 0===THREE.CopyShader&&console.error("THREE.BloomPass relies on THREE.CopyShader");var h=THREE.CopyShader;this.copyUniforms=THREE.UniformsUtils.clone(h.uniforms),this.copyUniforms.opacity.value=1,this.materialCopy=new THREE.ShaderMaterial({uniforms:this.copyUniforms,vertexShader:h.vertexShader,fragmentShader:h.fragmentShader,blending:THREE.AdditiveBlending,depthTest:!1,depthWrite:!1,transparent:!0}),this.enabled=!0,this.needsSwap=!1,this.oldClearColor=new THREE.Color,this.oldClearAlpha=1,this.camera=new THREE.OrthographicCamera(-1,1,1,-1,0,1),this.scene=new THREE.Scene,this.basic=new THREE.MeshBasicMaterial,this.quad=new THREE.Mesh(new THREE.PlaneBufferGeometry(2,2),null),this.quad.frustumCulled=!1,this.scene.add(this.quad)},THREE.UnrealBloomPass.prototype=Object.assign(Object.create(THREE.Pass.prototype),{constructor:THREE.UnrealBloomPass,dispose:function(){for(e=0;e<this.renderTargetsHorizontal.length;e++)this.renderTargetsHorizontal[e].dispose();for(var e=0;e<this.renderTargetsVertical.length;e++)this.renderTargetsVertical[e].dispose();this.renderTargetBright.dispose()},setSize:function(e,t){var r=Math.round(e/2),i=Math.round(t/2);this.renderTargetBright.setSize(r,i);for(var n=0;n<this.nMips;n++)this.renderTargetsHorizontal[n].setSize(r,i),this.renderTargetsVertical[n].setSize(r,i),this.separableBlurMaterials[n].uniforms.texSize.value=new THREE.Vector2(r,i),r=Math.round(r/2),i=Math.round(i/2)},render:function(e,t,r,i,n){this.oldClearColor.copy(e.getClearColor()),this.oldClearAlpha=e.getClearAlpha();var o=e.autoClear;e.autoClear=!1,e.setClearColor(new THREE.Color(0,0,0),0),n&&e.context.disable(e.context.STENCIL_TEST),this.renderToScreen&&(this.quad.material=this.basic,this.basic.map=r.texture,e.render(this.scene,this.camera,void 0,!0)),this.highPassUniforms.tDiffuse.value=r.texture,this.highPassUniforms.luminosityThreshold.value=this.threshold,this.quad.material=this.materialHighPassFilter,e.render(this.scene,this.camera,this.renderTargetBright,!0);for(var a=this.renderTargetBright,s=0;s<this.nMips;s++)this.quad.material=this.separableBlurMaterials[s],this.separableBlurMaterials[s].uniforms.colorTexture.value=a.texture,this.separableBlurMaterials[s].uniforms.direction.value=THREE.UnrealBloomPass.BlurDirectionX,e.render(this.scene,this.camera,this.renderTargetsHorizontal[s],!0),this.separableBlurMaterials[s].uniforms.colorTexture.value=this.renderTargetsHorizontal[s].texture,this.separableBlurMaterials[s].uniforms.direction.value=THREE.UnrealBloomPass.BlurDirectionY,e.render(this.scene,this.camera,this.renderTargetsVertical[s],!0),a=this.renderTargetsVertical[s];this.quad.material=this.compositeMaterial,this.compositeMaterial.uniforms.bloomStrength.value=this.strength,this.compositeMaterial.uniforms.bloomRadius.value=this.radius,this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors,e.render(this.scene,this.camera,this.renderTargetsHorizontal[0],!0),this.quad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=this.renderTargetsHorizontal[0].texture,n&&e.context.enable(e.context.STENCIL_TEST),this.renderToScreen?e.render(this.scene,this.camera,void 0,!1):e.render(this.scene,this.camera,r,!1),e.setClearColor(this.oldClearColor,this.oldClearAlpha),e.autoClear=o},getSeperableBlurMaterial:function(e){return new THREE.ShaderMaterial({defines:{KERNEL_RADIUS:e,SIGMA:e},uniforms:{colorTexture:{value:null},texSize:{value:new THREE.Vector2(.5,.5)},direction:{value:new THREE.Vector2(.5,.5)}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"#include <common>\t\t\t\tvarying vec2 vUv;\n\t\t\t\tuniform sampler2D colorTexture;\n\t\t\t\tuniform vec2 texSize;\t\t\t\tuniform vec2 direction;\t\t\t\t\t\t\t\tfloat gaussianPdf(in float x, in float sigma) {\t\t\t\t\treturn 0.39894 * exp( -0.5 * x * x/( sigma * sigma))/sigma;\t\t\t\t}\t\t\t\tvoid main() {\n\t\t\t\t\tvec2 invSize = 1.0 / texSize;\t\t\t\t\tfloat fSigma = float(SIGMA);\t\t\t\t\tfloat weightSum = gaussianPdf(0.0, fSigma);\t\t\t\t\tvec3 diffuseSum = texture2D( colorTexture, vUv).rgb * weightSum;\t\t\t\t\tfor( int i = 1; i < KERNEL_RADIUS; i ++ ) {\t\t\t\t\t\tfloat x = float(i);\t\t\t\t\t\tfloat w = gaussianPdf(x, fSigma);\t\t\t\t\t\tvec2 uvOffset = direction * invSize * x;\t\t\t\t\t\tvec3 sample1 = texture2D( colorTexture, vUv + uvOffset).rgb;\t\t\t\t\t\tvec3 sample2 = texture2D( colorTexture, vUv - uvOffset).rgb;\t\t\t\t\t\tdiffuseSum += (sample1 + sample2) * w;\t\t\t\t\t\tweightSum += 2.0 * w;\t\t\t\t\t}\t\t\t\t\tgl_FragColor = vec4(diffuseSum/weightSum, 1.0);\n\t\t\t\t}"})},getCompositeMaterial:function(e){return new THREE.ShaderMaterial({defines:{NUM_MIPS:e},uniforms:{blurTexture1:{value:null},blurTexture2:{value:null},blurTexture3:{value:null},blurTexture4:{value:null},blurTexture5:{value:null},dirtTexture:{value:null},bloomStrength:{value:1},bloomFactors:{value:null},bloomTintColors:{value:null},bloomRadius:{value:0}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"varying vec2 vUv;\t\t\t\tuniform sampler2D blurTexture1;\t\t\t\tuniform sampler2D blurTexture2;\t\t\t\tuniform sampler2D blurTexture3;\t\t\t\tuniform sampler2D blurTexture4;\t\t\t\tuniform sampler2D blurTexture5;\t\t\t\tuniform sampler2D dirtTexture;\t\t\t\tuniform float bloomStrength;\t\t\t\tuniform float bloomRadius;\t\t\t\tuniform float bloomFactors[NUM_MIPS];\t\t\t\tuniform vec3 bloomTintColors[NUM_MIPS];\t\t\t\t\t\t\t\tfloat lerpBloomFactor(const in float factor) { \t\t\t\t\tfloat mirrorFactor = 1.2 - factor;\t\t\t\t\treturn mix(factor, mirrorFactor, bloomRadius);\t\t\t\t}\t\t\t\t\t\t\t\tvoid main() {\t\t\t\t\tgl_FragColor = bloomStrength * ( lerpBloomFactor(bloomFactors[0]) * vec4(bloomTintColors[0], 1.0) * texture2D(blurTexture1, vUv) + \t\t\t\t\t\t\t\t\t\t\t\t\t lerpBloomFactor(bloomFactors[1]) * vec4(bloomTintColors[1], 1.0) * texture2D(blurTexture2, vUv) + \t\t\t\t\t\t\t\t\t\t\t\t\t lerpBloomFactor(bloomFactors[2]) * vec4(bloomTintColors[2], 1.0) * texture2D(blurTexture3, vUv) + \t\t\t\t\t\t\t\t\t\t\t\t\t lerpBloomFactor(bloomFactors[3]) * vec4(bloomTintColors[3], 1.0) * texture2D(blurTexture4, vUv) + \t\t\t\t\t\t\t\t\t\t\t\t\t lerpBloomFactor(bloomFactors[4]) * vec4(bloomTintColors[4], 1.0) * texture2D(blurTexture5, vUv) );\t\t\t\t}"})}}),THREE.UnrealBloomPass.BlurDirectionX=new THREE.Vector2(1,0),THREE.UnrealBloomPass.BlurDirectionY=new THREE.Vector2(0,1),THREE.Water=function(e,t){THREE.Mesh.call(this,e),this.type="Water";var r=this,i=void 0!==(t=t||{}).color?new THREE.Color(t.color):new THREE.Color(16777215),n=t.textureWidth||512,o=t.textureHeight||512,a=t.clipBias||0,s=t.flowDirection||new THREE.Vector2(1,0),l=t.flowSpeed||.03,c=t.reflectivity||.02,u=t.scale||1,h=t.shader||THREE.Water.WaterShader,p=new THREE.TextureLoader,d=t.flowMap||void 0,f=t.normalMap0||p.load("textures/water/Water_1_M_Normal.jpg"),m=t.normalMap1||p.load("textures/water/Water_2_M_Normal.jpg"),g=.15,v=.5*g,y=new THREE.Matrix4,E=new THREE.Clock;if(void 0!==THREE.Reflector)if(void 0!==THREE.Refractor){var b=new THREE.Reflector(e,{textureWidth:n,textureHeight:o,clipBias:a}),x=new THREE.Refractor(e,{textureWidth:n,textureHeight:o,clipBias:a});b.matrixAutoUpdate=!1,x.matrixAutoUpdate=!1,this.material=new THREE.ShaderMaterial({uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.fog,h.uniforms]),vertexShader:h.vertexShader,fragmentShader:h.fragmentShader,transparent:!0,fog:!0}),void 0!==d?(this.material.defines.USE_FLOWMAP="",this.material.uniforms.tFlowMap={type:"t",value:d}):this.material.uniforms.flowDirection={type:"v2",value:s},f.wrapS=f.wrapT=THREE.RepeatWrapping,m.wrapS=m.wrapT=THREE.RepeatWrapping,this.material.uniforms.tReflectionMap.value=b.getRenderTarget().texture,this.material.uniforms.tRefractionMap.value=x.getRenderTarget().texture,this.material.uniforms.tNormalMap0.value=f,this.material.uniforms.tNormalMap1.value=m,this.material.uniforms.color.value=i,this.material.uniforms.reflectivity.value=c,this.material.uniforms.textureMatrix.value=y,this.material.uniforms.config.value.x=0,this.material.uniforms.config.value.y=v,this.material.uniforms.config.value.z=v,this.material.uniforms.config.value.w=u,this.onBeforeRender=function(e,t,i){!function(e){y.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),y.multiply(e.projectionMatrix),y.multiply(e.matrixWorldInverse),y.multiply(r.matrixWorld)}(i),function(){var e=E.getDelta(),t=r.material.uniforms.config;t.value.x+=l*e,t.value.y=t.value.x+v,t.value.x>=g?(t.value.x=0,t.value.y=v):t.value.y>=g&&(t.value.y=t.value.y-g)}(),r.visible=!1,b.matrixWorld.copy(r.matrixWorld),x.matrixWorld.copy(r.matrixWorld),b.onBeforeRender(e,t,i),x.onBeforeRender(e,t,i),r.visible=!0}}else console.error("THREE.Water: Required component THREE.Refractor not found.");else console.error("THREE.Water: Required component THREE.Reflector not found.")},THREE.Water.prototype=Object.create(THREE.Mesh.prototype),THREE.Water.prototype.constructor=THREE.Water,THREE.Water.WaterShader={uniforms:{color:{type:"c",value:null},reflectivity:{type:"f",value:0},tReflectionMap:{type:"t",value:null},tRefractionMap:{type:"t",value:null},tNormalMap0:{type:"t",value:null},tNormalMap1:{type:"t",value:null},textureMatrix:{type:"m4",value:null},config:{type:"v4",value:new THREE.Vector4}},vertexShader:["#include <fog_pars_vertex>","uniform mat4 textureMatrix;","varying vec4 vCoord;","varying vec2 vUv;","varying vec3 vToEye;","void main() {","\tvUv = uv;","\tvCoord = textureMatrix * vec4( position, 1.0 );","\tvec4 worldPosition = modelMatrix * vec4( position, 1.0 );","\tvToEye = cameraPosition - worldPosition.xyz;","\tvec4 mvPosition =  viewMatrix * worldPosition;","\tgl_Position = projectionMatrix * mvPosition;","\t#include <fog_vertex>","}"].join("\n"),fragmentShader:["#include <fog_pars_fragment>","uniform sampler2D tReflectionMap;","uniform sampler2D tRefractionMap;","uniform sampler2D tNormalMap0;","uniform sampler2D tNormalMap1;","#ifdef USE_FLOWMAP","\tuniform sampler2D tFlowMap;","#else","\tuniform vec2 flowDirection;","#endif","uniform vec3 color;","uniform float reflectivity;","uniform vec4 config;","varying vec4 vCoord;","varying vec2 vUv;","varying vec3 vToEye;","void main() {","\tfloat flowMapOffset0 = config.x;","\tfloat flowMapOffset1 = config.y;","\tfloat halfCycle = config.z;","\tfloat scale = config.w;","\tvec3 toEye = normalize( vToEye );","\tvec2 flow;","\t#ifdef USE_FLOWMAP","\t\tflow = texture2D( tFlowMap, vUv ).rg * 2.0 - 1.0;","\t#else","\t\tflow = flowDirection;","\t#endif","\tflow.x *= - 1.0;","\tvec4 normalColor0 = texture2D( tNormalMap0, ( vUv * scale ) + flow * flowMapOffset0 );","\tvec4 normalColor1 = texture2D( tNormalMap1, ( vUv * scale ) + flow * flowMapOffset1 );","\tfloat flowLerp = abs( halfCycle - flowMapOffset0 ) / halfCycle;","\tvec4 normalColor = mix( normalColor0, normalColor1, flowLerp );","\tvec3 normal = normalize( vec3( normalColor.r * 2.0 - 1.0, normalColor.b,  normalColor.g * 2.0 - 1.0 ) );","\tfloat theta = max( dot( toEye, normal ), 0.0 );","\tfloat reflectance = reflectivity + ( 1.0 - reflectivity ) * pow( ( 1.0 - theta ), 5.0 );","\tvec3 coord = vCoord.xyz / vCoord.w;","\tvec2 uv = coord.xy + coord.z * normal.xz * 0.05;","\tvec4 reflectColor = texture2D( tReflectionMap, vec2( 1.0 - uv.x, uv.y ) );","\tvec4 refractColor = texture2D( tRefractionMap, uv );","\tgl_FragColor = vec4( color, 1.0 ) * mix( refractColor, reflectColor, reflectance );","\t#include <tonemapping_fragment>","\t#include <encodings_fragment>","\t#include <fog_fragment>","}"].join("\n")},function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.exprEval=t()}(this,function(){"use strict";function e(e,t){this.type=e,this.value=void 0!==t&&null!==t?t:0}function t(t){return new e(B,t)}function r(t){return new e(V,t)}function i(t){return new e(z,t)}function n(t,r,i,o,a){for(var s,l,c,u,h=[],p=[],d=0;d<t.length;d++){var f=t[d],m=f.type;if(m===U)h.push(f);else if(m===q&&a.hasOwnProperty(f.value))f=new e(U,a[f.value]),h.push(f);else if(m===V&&h.length>1)l=h.pop(),s=h.pop(),u=i[f.value],f=new e(U,u(s.value,l.value)),h.push(f);else if(m===z&&h.length>2)c=h.pop(),l=h.pop(),s=h.pop(),"?"===f.value?h.push(s.value?l.value:c.value):(u=o[f.value],f=new e(U,u(s.value,l.value,c.value)),h.push(f));else if(m===B&&h.length>0)s=h.pop(),u=r[f.value],f=new e(U,u(s.value)),h.push(f);else if(m===W){for(;h.length>0;)p.push(h.shift());p.push(new e(W,n(f.value,r,i,o,a)))}else if(m===X&&h.length>0)s=h.pop(),h.push(new e(U,s.value[f.value]));else{for(;h.length>0;)p.push(h.shift());p.push(f)}}for(;h.length>0;)p.push(h.shift());return p}function o(n,a,s){for(var l=[],c=0;c<n.length;c++){var u=n[c],h=u.type;if(h===q&&u.value===a)for(var p=0;p<s.tokens.length;p++){var d,f=s.tokens[p];d=f.type===B?t(f.value):f.type===V?r(f.value):f.type===z?i(f.value):new e(f.type,f.value),l.push(d)}else h===W?l.push(new e(W,o(u.value,a,s))):l.push(u)}return l}function a(e,t,r){for(var i,n,o,s,l=[],c=0;c<e.length;c++){var u=e[c],h=u.type;if(h===U)l.push(u.value);else if(h===V)n=l.pop(),i=l.pop(),"and"===u.value?l.push(!!i&&!!a(n,t,r)):"or"===u.value?l.push(!!i||!!a(n,t,r)):(s=t.binaryOps[u.value],l.push(s(i,n)));else if(h===z)o=l.pop(),n=l.pop(),i=l.pop(),"?"===u.value?l.push(a(i?n:o,t,r)):(s=t.ternaryOps[u.value],l.push(s(i,n,o)));else if(h===q)if(u.value in t.functions)l.push(t.functions[u.value]);else{var p=r[u.value];if(void 0===p)throw new Error("undefined variable: "+u.value);l.push(p)}else if(h===B)i=l.pop(),s=t.unaryOps[u.value],l.push(s(i));else if(h===G){for(var d=u.value,f=[];d-- >0;)f.unshift(l.pop());if(!(s=l.pop()).apply||!s.call)throw new Error(s+" is not a function");l.push(s.apply(void 0,f))}else if(h===W)l.push(u.value);else{if(h!==X)throw new Error("invalid Expression");i=l.pop(),l.push(i[u.value])}}if(l.length>1)throw new Error("invalid Expression (parity)");return l[0]}function s(e,t){for(var r,i,n,o,a=[],l=0;l<e.length;l++){var c=e[l],u=c.type;if(u===U)"number"==typeof c.value&&c.value<0?a.push("("+c.value+")"):a.push(function(e){if("string"==typeof e)return JSON.stringify(e).replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029");return e}(c.value));else if(u===V)i=a.pop(),r=a.pop(),o=c.value,t?"^"===o?a.push("Math.pow("+r+", "+i+")"):"and"===o?a.push("(!!"+r+" && !!"+i+")"):"or"===o?a.push("(!!"+r+" || !!"+i+")"):"||"===o?a.push("(String("+r+") + String("+i+"))"):"=="===o?a.push("("+r+" === "+i+")"):"!="===o?a.push("("+r+" !== "+i+")"):a.push("("+r+" "+o+" "+i+")"):a.push("("+r+" "+o+" "+i+")");else if(u===z){if(n=a.pop(),i=a.pop(),r=a.pop(),"?"!==(o=c.value))throw new Error("invalid Expression");a.push("("+r+" ? "+i+" : "+n+")")}else if(u===q)a.push(c.value);else if(u===B)r=a.pop(),"-"===(o=c.value)||"+"===o?a.push("("+o+r+")"):t?"not"===o?a.push("(!"+r+")"):"!"===o?a.push("fac("+r+")"):a.push(o+"("+r+")"):"!"===o?a.push("("+r+"!)"):a.push("("+o+" "+r+")");else if(u===G){for(var h=c.value,p=[];h-- >0;)p.unshift(a.pop());o=a.pop(),a.push(o+"("+p.join(", ")+")")}else if(u===X)r=a.pop(),a.push(r+"."+c.value);else{if(u!==W)throw new Error("invalid Expression");a.push("("+s(c.value,t)+")")}}if(a.length>1)throw new Error("invalid Expression (parity)");return String(a[0])}function l(e,t){for(var r=0;r<e.length;r++)if(e[r]===t)return!0;return!1}function c(e,t,r){for(var i=!!(r=r||{}).withMembers,n=null,o=0;o<e.length;o++){var a=e[o];a.type!==q||l(t,a.value)?a.type===X&&i&&null!==n?n+="."+a.value:a.type===W?c(a.value,t,r):null!==n&&(l(t,n)||t.push(n),n=null):i?null!==n?(l(t,n)||t.push(n),n=a.value):n=a.value:t.push(a.value)}null===n||l(t,n)||t.push(n)}function u(e,t){this.tokens=e,this.parser=t,this.unaryOps=t.unaryOps,this.binaryOps=t.binaryOps,this.ternaryOps=t.ternaryOps,this.functions=t.functions}function h(e,t,r){this.type=e,this.value=t,this.index=r}function p(e,t){this.pos=0,this.current=null,this.unaryOps=e.unaryOps,this.binaryOps=e.binaryOps,this.ternaryOps=e.ternaryOps,this.consts=e.consts,this.expression=t,this.savedPosition=0,this.savedCurrent=null,this.options=e.options}function d(e,t,r){this.parser=e,this.tokens=t,this.current=null,this.nextToken=null,this.next(),this.savedCurrent=null,this.savedNextToken=null,this.allowMemberAccess=!1!==r.allowMemberAccess}function f(e,t){return Number(e)+Number(t)}function m(e,t){return e-t}function g(e,t){return e*t}function v(e,t){return e/t}function y(e,t){return e%t}function E(e,t){return""+e+t}function b(e,t){return e===t}function x(e,t){return e!==t}function _(e,t){return e>t}function w(e,t){return e<t}function T(e,t){return e>=t}function M(e,t){return e<=t}function R(e,t){return Boolean(e&&t)}function S(e,t){return Boolean(e||t)}function P(e,t){return l(t,e)}function A(e){return Math.log(e)*Math.LOG10E}function C(e){return-e}function L(e){return!e}function O(e){return Math.random()*(e||1)}function H(e){return F(e+1)}function F(e){var t,r;if(function(e){return isFinite(e)&&e===Math.round(e)}(e)){if(e<=0)return isFinite(e)?1/0:NaN;if(e>171)return 1/0;for(var i=e-2,n=e-1;i>1;)n*=i,i--;return 0===n&&(n=1),n}if(e<.5)return Math.PI/(Math.sin(Math.PI*e)*F(1-e));if(e>=171.35)return 1/0;if(e>85){var o=e*e,a=o*e,s=a*e,l=s*e;return Math.sqrt(2*Math.PI/e)*Math.pow(e/Math.E,e)*(1+1/(12*e)+1/(288*o)-139/(51840*a)-571/(2488320*s)+163879/(209018880*l)+5246819/(75246796800*l*e))}--e,r=te[0];for(var c=1;c<te.length;++c)r+=te[c]/(e+c);return t=e+ee+.5,Math.sqrt(2*Math.PI)*Math.pow(t,e+.5)*Math.exp(-t)*r}function I(e){return String(e).length}function k(){for(var e=0,t=0,r=0;r<arguments.length;r++){var i,n=Math.abs(arguments[r]);t<n?(e=e*(i=t/n)*i+1,t=n):e+=n>0?(i=n/t)*i:n}return t===1/0?1/0:t*Math.sqrt(e)}function D(e,t,r){return e?t:r}function N(e,t){return void 0===t||0==+t?Math.round(e):(e=+e,t=-+t,isNaN(e)||"number"!=typeof t||t%1!=0?NaN:(e=e.toString().split("e"),e=Math.round(+(e[0]+"e"+(e[1]?+e[1]-t:-t))),+((e=e.toString().split("e"))[0]+"e"+(e[1]?+e[1]+t:t))))}function j(e){this.options=e||{},this.unaryOps={sin:Math.sin,cos:Math.cos,tan:Math.tan,asin:Math.asin,acos:Math.acos,atan:Math.atan,sinh:Math.sinh||function(e){return(Math.exp(e)-Math.exp(-e))/2},cosh:Math.cosh||function(e){return(Math.exp(e)+Math.exp(-e))/2},tanh:Math.tanh||function(e){return e===1/0?1:e===-1/0?-1:(Math.exp(e)-Math.exp(-e))/(Math.exp(e)+Math.exp(-e))},asinh:Math.asinh||function(e){return e===-1/0?e:Math.log(e+Math.sqrt(e*e+1))},acosh:Math.acosh||function(e){return Math.log(e+Math.sqrt(e*e-1))},atanh:Math.atanh||function(e){return Math.log((1+e)/(1-e))/2},sqrt:Math.sqrt,log:Math.log,ln:Math.log,lg:Math.log10||A,log10:Math.log10||A,abs:Math.abs,ceil:Math.ceil,floor:Math.floor,round:Math.round,trunc:Math.trunc||function(e){return e<0?Math.ceil(e):Math.floor(e)},"-":C,"+":Number,exp:Math.exp,not:L,length:I,"!":H},this.binaryOps={"+":f,"-":m,"*":g,"/":v,"%":y,"^":Math.pow,"||":E,"==":b,"!=":x,">":_,"<":w,">=":T,"<=":M,and:R,or:S,in:P},this.ternaryOps={"?":D},this.functions={random:O,fac:H,min:Math.min,max:Math.max,hypot:Math.hypot||k,pyt:Math.hypot||k,pow:Math.pow,atan2:Math.atan2,if:D,gamma:F,roundTo:N},this.consts={E:Math.E,PI:Math.PI,true:!0,false:!1}}var U="INUMBER",B="IOP1",V="IOP2",z="IOP3",q="IVAR",G="IFUNCALL",W="IEXPR",X="IMEMBER";e.prototype.toString=function(){switch(this.type){case U:case B:case V:case z:case q:return this.value;case G:return"CALL "+this.value;case X:return"."+this.value;default:return"Invalid Instruction"}},u.prototype.simplify=function(e){return e=e||{},new u(n(this.tokens,this.unaryOps,this.binaryOps,this.ternaryOps,e),this.parser)},u.prototype.substitute=function(e,t){return t instanceof u||(t=this.parser.parse(String(t))),new u(o(this.tokens,e,t),this.parser)},u.prototype.evaluate=function(e){return e=e||{},a(this.tokens,this,e)},u.prototype.toString=function(){return s(this.tokens,!1)},u.prototype.symbols=function(e){e=e||{};var t=[];return c(this.tokens,t,e),t},u.prototype.variables=function(e){e=e||{};var t=[];c(this.tokens,t,e);var r=this.functions;return t.filter(function(e){return!(e in r)})},u.prototype.toJSFunction=function(e,t){var r=this,i=new Function(e,"with(this.functions) with (this.ternaryOps) with (this.binaryOps) with (this.unaryOps) { return "+s(this.simplify(t).tokens,!0)+"; }");return function(){return i.apply(r,arguments)}};var Y="TOP";h.prototype.toString=function(){return this.type+": "+this.value},p.prototype.newToken=function(e,t,r){return new h(e,t,null!=r?r:this.pos)},p.prototype.save=function(){this.savedPosition=this.pos,this.savedCurrent=this.current},p.prototype.restore=function(){this.pos=this.savedPosition,this.current=this.savedCurrent},p.prototype.next=function(){return this.pos>=this.expression.length?this.newToken("TEOF","EOF"):this.isWhitespace()||this.isComment()?this.next():this.isRadixInteger()||this.isNumber()||this.isOperator()||this.isString()||this.isParen()||this.isComma()||this.isNamedOp()||this.isConst()||this.isName()?this.current:void this.parseError('Unknown character "'+this.expression.charAt(this.pos)+'"')},p.prototype.isString=function(){var e=!1,t=this.pos,r=this.expression.charAt(t);if("'"===r||'"'===r)for(var i=this.expression.indexOf(r,t+1);i>=0&&this.pos<this.expression.length;){if(this.pos=i+1,"\\"!==this.expression.charAt(i-1)){var n=this.expression.substring(t+1,i);this.current=this.newToken("TSTRING",this.unescape(n),t),e=!0;break}i=this.expression.indexOf(r,i+1)}return e},p.prototype.isParen=function(){var e=this.expression.charAt(this.pos);return("("===e||")"===e)&&(this.current=this.newToken("TPAREN",e),this.pos++,!0)},p.prototype.isComma=function(){return","===this.expression.charAt(this.pos)&&(this.current=this.newToken("TCOMMA",","),this.pos++,!0)},p.prototype.isConst=function(){for(var e=this.pos,t=e;t<this.expression.length;t++){var r=this.expression.charAt(t);if(r.toUpperCase()===r.toLowerCase()&&(t===this.pos||"_"!==r&&"."!==r&&(r<"0"||r>"9")))break}if(t>e){var i=this.expression.substring(e,t);if(i in this.consts)return this.current=this.newToken("TNUMBER",this.consts[i]),this.pos+=i.length,!0}return!1},p.prototype.isNamedOp=function(){for(var e=this.pos,t=e;t<this.expression.length;t++){var r=this.expression.charAt(t);if(r.toUpperCase()===r.toLowerCase()&&(t===this.pos||"_"!==r&&(r<"0"||r>"9")))break}if(t>e){var i=this.expression.substring(e,t);if(this.isOperatorEnabled(i)&&(i in this.binaryOps||i in this.unaryOps||i in this.ternaryOps))return this.current=this.newToken(Y,i),this.pos+=i.length,!0}return!1},p.prototype.isName=function(){for(var e=this.pos,t=e,r=!1;t<this.expression.length;t++){var i=this.expression.charAt(t);if(i.toUpperCase()===i.toLowerCase()){if(t===this.pos&&("$"===i||"_"===i)){"_"===i&&(r=!0);continue}if(t===this.pos||!r||"_"!==i&&(i<"0"||i>"9"))break}else r=!0}if(r){var n=this.expression.substring(e,t);return this.current=this.newToken("TNAME",n),this.pos+=n.length,!0}return!1},p.prototype.isWhitespace=function(){for(var e=!1,t=this.expression.charAt(this.pos);!(" "!==t&&"\t"!==t&&"\n"!==t&&"\r"!==t||(e=!0,this.pos++,this.pos>=this.expression.length));)t=this.expression.charAt(this.pos);return e};var Q=/^[0-9a-f]{4}$/i;p.prototype.unescape=function(e){var t=e.indexOf("\\");if(t<0)return e;for(var r=e.substring(0,t);t>=0;){var i=e.charAt(++t);switch(i){case"'":r+="'";break;case'"':r+='"';break;case"\\":r+="\\";break;case"/":r+="/";break;case"b":r+="\b";break;case"f":r+="\f";break;case"n":r+="\n";break;case"r":r+="\r";break;case"t":r+="\t";break;case"u":var n=e.substring(t+1,t+5);Q.test(n)||this.parseError("Illegal escape sequence: \\u"+n),r+=String.fromCharCode(parseInt(n,16)),t+=4;break;default:throw this.parseError('Illegal escape sequence: "\\'+i+'"')}++t;var o=e.indexOf("\\",t);r+=e.substring(t,o<0?e.length:o),t=o}return r},p.prototype.isComment=function(){return"/"===this.expression.charAt(this.pos)&&"*"===this.expression.charAt(this.pos+1)&&(this.pos=this.expression.indexOf("*/",this.pos)+2,1===this.pos&&(this.pos=this.expression.length),!0)},p.prototype.isRadixInteger=function(){var e=this.pos;if(e>=this.expression.length-2||"0"!==this.expression.charAt(e))return!1;++e;var t,r;if("x"===this.expression.charAt(e))t=16,r=/^[0-9a-f]$/i,++e;else{if("b"!==this.expression.charAt(e))return!1;t=2,r=/^[01]$/i,++e}for(var i=!1,n=e;e<this.expression.length;){var o=this.expression.charAt(e);if(!r.test(o))break;e++,i=!0}return i&&(this.current=this.newToken("TNUMBER",parseInt(this.expression.substring(n,e),t)),this.pos=e),i},p.prototype.isNumber=function(){for(var e,t=!1,r=this.pos,i=r,n=r,o=!1,a=!1;r<this.expression.length&&((e=this.expression.charAt(r))>="0"&&e<="9"||!o&&"."===e);)"."===e?o=!0:a=!0,r++,t=a;if(t&&(n=r),"e"===e||"E"===e){r++;for(var s=!0,l=!1;r<this.expression.length;){if(e=this.expression.charAt(r),!s||"+"!==e&&"-"!==e){if(!(e>="0"&&e<="9"))break;l=!0,s=!1}else s=!1;r++}l||(r=n)}return t?(this.current=this.newToken("TNUMBER",parseFloat(this.expression.substring(i,r))),this.pos=r):this.pos=n,t},p.prototype.isOperator=function(){var e=this.pos,t=this.expression.charAt(this.pos);if("+"===t||"-"===t||"*"===t||"/"===t||"%"===t||"^"===t||"?"===t||":"===t||"."===t)this.current=this.newToken(Y,t);else if(""===t||""===t)this.current=this.newToken(Y,"*");else if(">"===t)"="===this.expression.charAt(this.pos+1)?(this.current=this.newToken(Y,">="),this.pos++):this.current=this.newToken(Y,">");else if("<"===t)"="===this.expression.charAt(this.pos+1)?(this.current=this.newToken(Y,"<="),this.pos++):this.current=this.newToken(Y,"<");else if("|"===t){if("|"!==this.expression.charAt(this.pos+1))return!1;this.current=this.newToken(Y,"||"),this.pos++}else if("="===t){if("="!==this.expression.charAt(this.pos+1))return!1;this.current=this.newToken(Y,"=="),this.pos++}else{if("!"!==t)return!1;"="===this.expression.charAt(this.pos+1)?(this.current=this.newToken(Y,"!="),this.pos++):this.current=this.newToken(Y,t)}return this.pos++,!!this.isOperatorEnabled(this.current.value)||(this.pos=e,!1)};var J={"+":"add","-":"subtract","*":"multiply","/":"divide","%":"remainder","^":"power","!":"factorial","<":"comparison",">":"comparison","<=":"comparison",">=":"comparison","==":"comparison","!=":"comparison","||":"concatenate",and:"logical",or:"logical",not:"logical","?":"conditional",":":"conditional"};p.prototype.isOperatorEnabled=function(e){var t=function(e){return J.hasOwnProperty(e)?J[e]:e}(e),r=this.options.operators||{};return"in"===t?!!r.in:!(t in r&&!r[t])},p.prototype.getCoordinates=function(){var e,t=0,r=-1;do{t++,e=this.pos-r,r=this.expression.indexOf("\n",r+1)}while(r>=0&&r<this.pos);return{line:t,column:e}},p.prototype.parseError=function(e){var t=this.getCoordinates();throw new Error("parse error ["+t.line+":"+t.column+"]: "+e)},d.prototype.next=function(){return this.current=this.nextToken,this.nextToken=this.tokens.next()},d.prototype.tokenMatches=function(e,t){return void 0===t||(Array.isArray(t)?l(t,e.value):"function"==typeof t?t(e):e.value===t)},d.prototype.save=function(){this.savedCurrent=this.current,this.savedNextToken=this.nextToken,this.tokens.save()},d.prototype.restore=function(){this.tokens.restore(),this.current=this.savedCurrent,this.nextToken=this.savedNextToken},d.prototype.accept=function(e,t){return!(this.nextToken.type!==e||!this.tokenMatches(this.nextToken,t))&&(this.next(),!0)},d.prototype.expect=function(e,t){if(!this.accept(e,t)){var r=this.tokens.getCoordinates();throw new Error("parse error ["+r.line+":"+r.column+"]: Expected "+(t||e))}},d.prototype.parseAtom=function(t){if(this.accept("TNAME"))t.push(new e(q,this.current.value));else if(this.accept("TNUMBER"))t.push(new e(U,this.current.value));else if(this.accept("TSTRING"))t.push(new e(U,this.current.value));else{if(!this.accept("TPAREN","("))throw new Error("unexpected "+this.nextToken);this.parseExpression(t),this.expect("TPAREN",")")}},d.prototype.parseExpression=function(e){this.parseConditionalExpression(e)},d.prototype.parseConditionalExpression=function(t){for(this.parseOrExpression(t);this.accept(Y,"?");){var r=[],n=[];this.parseConditionalExpression(r),this.expect(Y,":"),this.parseConditionalExpression(n),t.push(new e(W,r)),t.push(new e(W,n)),t.push(i("?"))}},d.prototype.parseOrExpression=function(t){for(this.parseAndExpression(t);this.accept(Y,"or");){var i=[];this.parseAndExpression(i),t.push(new e(W,i)),t.push(r("or"))}},d.prototype.parseAndExpression=function(t){for(this.parseComparison(t);this.accept(Y,"and");){var i=[];this.parseComparison(i),t.push(new e(W,i)),t.push(r("and"))}};var K=["==","!=","<","<=",">=",">","in"];d.prototype.parseComparison=function(e){for(this.parseAddSub(e);this.accept(Y,K);){var t=this.current;this.parseAddSub(e),e.push(r(t.value))}};var Z=["+","-","||"];d.prototype.parseAddSub=function(e){for(this.parseTerm(e);this.accept(Y,Z);){var t=this.current;this.parseTerm(e),e.push(r(t.value))}};var $=["*","/","%"];d.prototype.parseTerm=function(e){for(this.parseFactor(e);this.accept(Y,$);){var t=this.current;this.parseFactor(e),e.push(r(t.value))}},d.prototype.parseFactor=function(e){var r=this.tokens.unaryOps;if(this.save(),this.accept(Y,function(e){return e.value in r}))if("-"!==this.current.value&&"+"!==this.current.value&&"TPAREN"===this.nextToken.type&&"("===this.nextToken.value)this.restore(),this.parseExponential(e);else{var i=this.current;this.parseFactor(e),e.push(t(i.value))}else this.parseExponential(e)},d.prototype.parseExponential=function(e){for(this.parsePostfixExpression(e);this.accept(Y,"^");)this.parseFactor(e),e.push(r("^"))},d.prototype.parsePostfixExpression=function(e){for(this.parseFunctionCall(e);this.accept(Y,"!");)e.push(t("!"))},d.prototype.parseFunctionCall=function(r){var i=this.tokens.unaryOps;if(this.accept(Y,function(e){return e.value in i})){var n=this.current;this.parseAtom(r),r.push(t(n.value))}else for(this.parseMemberExpression(r);this.accept("TPAREN","(");)if(this.accept("TPAREN",")"))r.push(new e(G,0));else{var o=this.parseArgumentList(r);r.push(new e(G,o))}},d.prototype.parseArgumentList=function(e){for(var t=0;!this.accept("TPAREN",")");)for(this.parseExpression(e),++t;this.accept("TCOMMA");)this.parseExpression(e),++t;return t},d.prototype.parseMemberExpression=function(t){for(this.parseAtom(t);this.accept(Y,".");){if(!this.allowMemberAccess)throw new Error('unexpected ".", member access is not permitted');this.expect("TNAME"),t.push(new e(X,this.current.value))}};var ee=4.7421875,te=[.9999999999999971,57.15623566586292,-59.59796035547549,14.136097974741746,-.4919138160976202,3399464998481189e-20,4652362892704858e-20,-9837447530487956e-20,.0001580887032249125,-.00021026444172410488,.00021743961811521265,-.0001643181065367639,8441822398385275e-20,-26190838401581408e-21,36899182659531625e-22];j.prototype.parse=function(e){var t=[],r=new d(this,new p(this,e),{allowMemberAccess:this.options.allowMemberAccess});return r.parseExpression(t),r.expect("TEOF","EOF"),new u(t,this)},j.prototype.evaluate=function(e,t){return this.parse(e).evaluate(t)};var re=new j;j.parse=function(e){return re.parse(e)},j.evaluate=function(e,t){return re.parse(e).evaluate(t)};return{Parser:j,Expression:u}});var Graph=function(e){var t=function(e){var t,r=[];for(t in e)Object.prototype.hasOwnProperty.call(e,t)&&r.push(t);return r},r=function(e,t){return parseFloat(e)-parseFloat(t)},i=function(e,i,n,o){o=o||1/0;var a,s={},l={0:[i]},c={},u=function(e,t){var r=""+e;l[r]||(l[r]=[]),l[r].push(t)};for(s[i]=0;l&&(a=t(l)).length;){a.sort(r);var h=a[0],p=l[h],d=p.shift(),f=parseFloat(h),m=e[d]||{};p.length||delete l[h];for(var g in m)if(Object.prototype.hasOwnProperty.call(m,g)){var v=m[g]+f,y=s[g];(void 0===y||y>v)&&(s[g]=v,u(v,g),c[g]=d)}}return void 0===s[n]?null:c},n=function(e,t){for(var r=[],i=t;void 0!==i;)r.push(i),i=e[i];return r.reverse(),r},o=function(e,t){for(var r,o,a,s=t.shift(),l=[];t.length;){if(r=t.shift(),!(o=i(e,s,r)))return null;if(a=n(o,r),!t.length)return l.concat(a);l.push.apply(l,a.slice(0,-1)),s=r}},a=function(e,t){try{return Array.prototype.slice.call(e,t)}catch(o){for(var r=[],i=t||0,n=e.length;i<n;++i)r.push(e[i]);return r}},s=function(e){this.map=e};return s.prototype.findShortestPath=function(e,t){return"[object Array]"===Object.prototype.toString.call(e)?o(this.map,e):2===arguments.length?o(this.map,[e,t]):o(this.map,a(arguments))},s.findShortestPath=function(e,t,r){return"[object Array]"===Object.prototype.toString.call(t)?o(e,t):3===arguments.length?o(e,[t,r]):o(e,a(arguments,1))},s}(),MSPE={distributions:{BOX:1,SPHERE:2,DISC:3},valueOverLifetimeLength:4};"function"==typeof define&&define.amd?define("spe",MSPE):"undefined"!=typeof exports&&"undefined"!=typeof module&&(module.exports=MSPE),MSPE.shaderChunks={defines:[].join("\n"),uniforms:["uniform sampler2D tex;"].join("\n"),attributes:["attribute vec3 mcol0;","attribute vec3 mcol1;","attribute vec3 mcol2;","attribute vec3 mcol3;","attribute vec4 color;"].join("\n"),varyings:["varying vec2 vUv;","varying vec4 varyColor;"].join("\n")},MSPE.shaders={vertex:[MSPE.shaderChunks.uniforms,MSPE.shaderChunks.attributes,MSPE.shaderChunks.varyings,"void main()","{","\tmat4 matrix = mat4(","\t\tvec4( mcol0, 0 ),","\t\tvec4( mcol1, 0 ),","\t\tvec4( mcol2, 0 ),","\t\tvec4( mcol3, 1 )","\t);","\tvaryColor = color;","\tvec3 positionEye = ( modelViewMatrix * matrix * vec4( position, 1.0 ) ).xyz;","   vUv = vec2( uv.x, uv.y );","\tgl_Position = projectionMatrix * vec4( positionEye, 1.0 );","}"].join("\n"),fragment:[MSPE.shaderChunks.uniforms,MSPE.shaderChunks.varyings,"void main() {","    gl_FragColor = varyColor * texture2D(tex, vUv);",THREE.ShaderChunk.fog_fragment,"}"].join("\n")},MSPE.utils={types:{BOOLEAN:"boolean",STRING:"string",NUMBER:"number",OBJECT:"object"},ensureTypedArg:function(e,t,r){"use strict";return typeof e===t?e:r},ensureArrayTypedArg:function(e,t,r){"use strict";if(Array.isArray(e)){for(var i=e.length-1;i>=0;--i)if(typeof e[i]!==t)return r;return e}return this.ensureTypedArg(e,t,r)},ensureInstanceOf:function(e,t,r){"use strict";return void 0!==t&&e instanceof t?e:r},ensureArrayInstanceOf:function(e,t,r){"use strict";if(Array.isArray(e)){for(var i=e.length-1;i>=0;--i)if(void 0!==t&&e[i]instanceof t==!1)return r;return e}return this.ensureInstanceOf(e,t,r)},ensureValueOverLifetimeCompliance:function(e,t,r){"use strict";t=t||3,r=r||3,!1===Array.isArray(e._value)&&(e._value=[e._value]),!1===Array.isArray(e._spread)&&(e._spread=[e._spread]);var i=this.clamp(e._value.length,t,r),n=this.clamp(e._spread.length,t,r),o=Math.max(i,n);e._value.length!==o&&(e._value=this.interpolateArray(e._value,o)),e._spread.length!==o&&(e._spread=this.interpolateArray(e._spread,o))},interpolateArray:function(e,t){"use strict";for(var r=e.length,i=["function"==typeof e[0].clone?e[0].clone():e[0]],n=(r-1)/(t-1),o=1;o<t-1;++o){var a=o*n,s=Math.floor(a),l=Math.ceil(a),c=a-s;i[o]=this.lerpTypeAgnostic(e[s],e[l],c)}return i.push("function"==typeof e[r-1].clone?e[r-1].clone():e[r-1]),i},clamp:function(e,t,r){"use strict";return Math.max(t,Math.min(e,r))},zeroToEpsilon:function(e,t){"use strict";var r=e;return r=t?1e-5*Math.random()*10:1e-5,e<0&&e>-1e-5&&(r=-r),r},lerpTypeAgnostic:function(e,t,r){"use strict";var i,n=this.types;return typeof e==n.NUMBER&&typeof t==n.NUMBER?e+(t-e)*r:e instanceof THREE.Vector2&&t instanceof THREE.Vector2||typeof e.x==n.NUMBER&&typeof e.y==n.NUMBER&&null==e.z&&void 0==e.z&&typeof t.x==n.NUMBER&&typeof t.y==n.NUMBER&&null==t.z&&void 0==t.z?(e instanceof THREE.Vector2?i=e.clone():((i={}).x=e.x,i.y=e.y),i.x=this.lerp(e.x,t.x,r),i.y=this.lerp(e.y,t.y,r),i):e instanceof THREE.Vector3&&t instanceof THREE.Vector3||typeof e.x==n.NUMBER&&typeof e.y==n.NUMBER&&typeof e.z==n.NUMBER&&null==e.w&&void 0==e.w&&typeof t.x==n.NUMBER&&typeof t.y==n.NUMBER&&typeof t.z==n.NUMBER&&null==t.w&&void 0==t.w?(e instanceof THREE.Vector3?i=e.clone():((i={}).x=e.x,i.y=e.y,i.z=e.z),i.x=this.lerp(e.x,t.x,r),i.y=this.lerp(e.y,t.y,r),i.z=this.lerp(e.z,t.z,r),i):e instanceof THREE.Vector4&&t instanceof THREE.Vector4||typeof e.x==n.NUMBER&&typeof e.y==n.NUMBER&&typeof e.z==n.NUMBER&&typeof e.w==n.NUMBER&&typeof t.x==n.NUMBER&&typeof t.y==n.NUMBER&&typeof t.z==n.NUMBER&&typeof t.w==n.NUMBER?(e instanceof THREE.Vector4?i=e.clone():((i={}).x=e.x,i.y=e.y,i.z=e.z,i.w=e.w),i.x=this.lerp(e.x,t.x,r),i.y=this.lerp(e.y,t.y,r),i.z=this.lerp(e.z,t.z,r),i.w=this.lerp(e.w,t.w,r),i):e instanceof THREE.Color&&t instanceof THREE.Color||typeof e.r==n.NUMBER&&typeof e.g==n.NUMBER&&typeof e.b==n.NUMBER&&typeof t.r==n.NUMBER&&typeof t.g==n.NUMBER&&typeof t.b==n.NUMBER?(e instanceof THREE.Color?i=e.clone():((i={}).r=e.r,i.g=e.g,i.b=e.b),i.r=this.lerp(e.r,t.r,r),i.g=this.lerp(e.g,t.g,r),i.b=this.lerp(e.b,t.b,r),i):void console.warn("Invalid argument types, or argument types do not match:",e,t)},lerp:function(e,t,r){"use strict";return e+(t-e)*r},roundToNearestMultiple:function(e,t){"use strict";var r=0;return 0===t?e:0==(r=Math.abs(e)%t)?e:e<0?-(Math.abs(e)-r):e+t-r},arrayValuesAreEqual:function(e){"use strict";for(var t=0;t<e.length-1;++t)if(e[t]!==e[t+1])return!1;return!0},randomFloat:function(e,t){"use strict";return e+t*(Math.random()-.5)},randomVector3:function(e,t,r,i,n){"use strict";var o=r.x+(Math.random()*i.x-.5*i.x),a=r.y+(Math.random()*i.y-.5*i.y),s=r.z+(Math.random()*i.z-.5*i.z);n&&(o=.5*-n.x+this.roundToNearestMultiple(o,n.x),a=.5*-n.y+this.roundToNearestMultiple(a,n.y),s=.5*-n.z+this.roundToNearestMultiple(s,n.z)),e.typedArray.setVec3Components(t,o,a,s)},getRandomVector3:function(e,t,r){"use strict";var i=e.x+(Math.random()*t.x-.5*t.x),n=e.y+(Math.random()*t.y-.5*t.y),o=e.z+(Math.random()*t.z-.5*t.z);r&&(i=.5*-r.x+this.roundToNearestMultiple(i,r.x),n=.5*-r.y+this.roundToNearestMultiple(n,r.y),o=.5*-r.z+this.roundToNearestMultiple(o,r.z));return new THREE.Vector3(i,n,o)},randomColor:function(e,t,r,i){"use strict";var n=r.r+Math.random()*i.x,o=r.g+Math.random()*i.y,a=r.b+Math.random()*i.z;n=this.clamp(n,0,1),o=this.clamp(o,0,1),a=this.clamp(a,0,1),e.typedArray.setVec3Components(t,n,o,a)},randomColorAsHex:function(){"use strict";var e=new THREE.Color;return function(t,r,i,n){for(var o=i.length,a=[],s=0;s<o;++s){var l=n[s];e.copy(i[s]),e.r+=Math.random()*l.x-.5*l.x,e.g+=Math.random()*l.y-.5*l.y,e.b+=Math.random()*l.z-.5*l.z,e.r=this.clamp(e.r,0,1),e.g=this.clamp(e.g,0,1),e.b=this.clamp(e.b,0,1),a.push(e.getHex())}t.typedArray.setVec4Components(r,a[0],a[1],a[2],a[3])}}(),getRandomColor:function(e,t){"use strict";for(var r=e.length,i=[],n=0;n<r;++n){var o=t[n],a=new THREE.Color;a.copy(e[n]),a.r+=Math.random()*o.x-.5*o.x,a.g+=Math.random()*o.y-.5*o.y,a.b+=Math.random()*o.z-.5*o.z,a.r=this.clamp(a.r,0,1),a.g=this.clamp(a.g,0,1),a.b=this.clamp(a.b,0,1),i.push(a)}return i},randomVector3OnSphere:function(e,t,r,i,n,o,a,s){"use strict";var l=2*Math.random()-1,c=6.2832*Math.random(),u=Math.sqrt(1-l*l),h=this.randomFloat(i,n),p=0,d=0,f=0;a&&(h=Math.round(h/a)*a),p=u*Math.cos(c)*h,d=u*Math.sin(c)*h,f=l*h,p*=o.x,d*=o.y,f*=o.z,p+=r.x,d+=r.y,f+=r.z,e.typedArray.setVec3Components(t,p,d,f)},getRandomVector3OnSphere:function(e,t,r,i,n,o){"use strict";var a=2*Math.random()-1,s=6.2832*Math.random(),l=Math.sqrt(1-a*a),c=this.randomFloat(t,r),u=0,h=0,p=0;return n&&(c=Math.round(c/n)*n),u=l*Math.cos(s)*c,h=l*Math.sin(s)*c,p=a*c,u*=i.x,h*=i.y,p*=i.z,u+=e.x,h+=e.y,p+=e.z,new THREE.Vector3(u,h,p)},seededRandom:function(e){var t=1e4*Math.sin(e);return t-(0|t)},randomVector3OnDisc:function(e,t,r,i,n,o,a){"use strict";var s=6.2832*Math.random(),l=Math.abs(this.randomFloat(i,n)),c=0,u=0,h=0;a&&(l=Math.round(l/a)*a),c=Math.cos(s)*l,u=Math.sin(s)*l,c*=o.x,u*=o.y,c+=r.x,u+=r.y,h+=r.z,e.typedArray.setVec3Components(t,c,u,h)},getRandomVector3OnDisc:function(e,t,r,i,n){"use strict";var o=6.2832*Math.random(),a=Math.abs(this.randomFloat(t,r)),s=0,l=0,c=0;return n&&(a=Math.round(a/n)*n),s=Math.cos(o)*a,l=Math.sin(o)*a,s*=i.x,l*=i.y,s+=e.x,l+=e.y,c+=e.z,new THREE.Vector3(s,l,c)},randomDirectionVector3OnSphere:function(){"use strict";var e=new THREE.Vector3;return function(t,r,i,n,o,a,s,l){e.copy(a),e.x-=i,e.y-=n,e.z-=o,e.normalize().multiplyScalar(-this.randomFloat(s,l)),t.typedArray.setVec3Components(r,e.x,e.y,e.z)}}(),getRandomDirectionVector3OnSphere:function(e,t,r){"use strict";var i=new THREE.Vector3;return i.copy(e),i.x-=this.randomFloat(0,1),i.y-=this.randomFloat(0,1),i.z-=this.randomFloat(0,1),i.normalize().multiplyScalar(-this.randomFloat(t,r)),i},getDirectionVector3OnSphere:function(e,t,r,i,n,o){"use strict";var a=new THREE.Vector3;a.copy(e),a.normalize().multiplyScalar(this.randomFloat(r,i));var s=this.getRandomVector3(n,o);return a.add(s),a},randomDirectionVector3OnDisc:function(){"use strict";var e=new THREE.Vector3;return function(t,r,i,n,o,a,s,l){e.copy(a),e.x-=i,e.y-=n,e.z-=o,e.normalize().multiplyScalar(-this.randomFloat(s,l)),t.typedArray.setVec3Components(r,e.x,e.y,0)}}(),getPackedRotationAxis:function(){"use strict";var e=new THREE.Vector3,t=new THREE.Vector3,r=new THREE.Color,i=new THREE.Vector3(1,1,1);return function(n,o){return e.copy(n).normalize(),t.copy(o).normalize(),e.x+=.5*-o.x+Math.random()*o.x,e.y+=.5*-o.y+Math.random()*o.y,e.z+=.5*-o.z+Math.random()*o.z,e.normalize().add(i).multiplyScalar(.5),r.setRGB(e.x,e.y,e.z),r.getHex()}}(),getRotationAxis:function(){"use strict";var e=new THREE.Vector3,t=new THREE.Vector3,r=(new THREE.Color,new THREE.Vector3(1,1,1));return function(i,n){return e.copy(i).normalize(),t.copy(n).normalize(),e.x+=.5*-n.x+Math.random()*n.x,e.y+=.5*-n.y+Math.random()*n.y,e.z+=.5*-n.z+Math.random()*n.z,e.normalize().add(r).multiplyScalar(.5),e}}(),setMatrix:function(){var e=new THREE.Quaternion;return function(t,r,i,n){e.setFromEuler(r,!1),n.compose(t,e,i)}}(),clock:function(){var e=new THREE.Clock;return function(){return e}}()},MSPE.Group=function(e){"use strict";var t=MSPE.utils,r=t.types;if(e=t.ensureTypedArg(e,r.OBJECT,{}),e.texture=t.ensureTypedArg(e.texture,r.OBJECT,{}),this.uuid=THREE.Math.generateUUID(),this.fixedTimeStep=t.ensureTypedArg(e.fixedTimeStep,r.NUMBER,.016),this.texture=t.ensureInstanceOf(e.texture.value,THREE.Texture,null),this.hasPerspective=t.ensureTypedArg(e.hasPerspective,r.BOOLEAN,!0),this.colorize=t.ensureTypedArg(e.colorize,r.BOOLEAN,!0),this.maxParticleCount=t.ensureTypedArg(e.maxParticleCount,r.NUMBER,1e3),this.vec4Quaternion=t.ensureInstanceOf(e.vec4Quaternion,THREE.Vector4,new THREE.Vector4(0,0,0,1)),this.vec4Quaternion=this.vec4Quaternion.normalize(),null==e.bufferGeometry||void 0==e.bufferGeometry||!(e.bufferGeometry instanceof THREE.BufferGeometry))return console.error("[MSPE.js] : [MSPE.Group] : error options.bufferGeometry!"),null;this.instancedBufferGeometry=null,this.mesh=null,this.materialList=[],this.geometryList=[],this.bufferGeometry=e.bufferGeometry,this.bufferGeometry=this.bufferGeometry.toNonIndexed(),this.bufferGeometry.computeBoundingBox(),this.geometryList.push(this.bufferGeometry),this.instancedBufferGeometry=new THREE.InstancedBufferGeometry,this.geometryList.push(this.instancedBufferGeometry);var i=this.bufferGeometry.attributes.position.clone();if(this.instancedBufferGeometry.addAttribute("position",i),null!=this.bufferGeometry.attributes.uv&&void 0!=this.bufferGeometry.attributes.uv){var n=this.bufferGeometry.attributes.uv.clone();this.instancedBufferGeometry.addAttribute("uv",n)}this.instanceBuffer=new THREE.InstancedInterleavedBuffer(new Float32Array(16*this.maxParticleCount),16,1).setDynamic(!0),this.mcol0=new THREE.InterleavedBufferAttribute(this.instanceBuffer,3,0),this.mcol1=new THREE.InterleavedBufferAttribute(this.instanceBuffer,3,3),this.mcol2=new THREE.InterleavedBufferAttribute(this.instanceBuffer,3,6),this.mcol3=new THREE.InterleavedBufferAttribute(this.instanceBuffer,3,9),this.colors=new THREE.InterleavedBufferAttribute(this.instanceBuffer,4,12);!function(){var e=new THREE.Vector3(0,0,0),t=new THREE.Euler(0,0,0),r=new THREE.Quaternion,i=new THREE.Vector3(1,1,1)}();for(var o=new THREE.Matrix4,a=o.elements,s=0,l=this.mcol0.count;s<l;s++){var c=new THREE.Vector3(0,0,0),u=new THREE.Euler(0,0,0),h=new THREE.Vector3(0,0,0);t.setMatrix(c,u,h,o),this.mcol0.setXYZ(s,a[0],a[1],a[2]),this.mcol1.setXYZ(s,a[4],a[5],a[6]),this.mcol2.setXYZ(s,a[8],a[9],a[10]),this.mcol3.setXYZ(s,a[12],a[13],a[14]),this.colors.setXYZW(s,1,1,1,1)}this.instancedBufferGeometry.addAttribute("mcol0",this.mcol0),this.instancedBufferGeometry.addAttribute("mcol1",this.mcol1),this.instancedBufferGeometry.addAttribute("mcol2",this.mcol2),this.instancedBufferGeometry.addAttribute("mcol3",this.mcol3),this.instancedBufferGeometry.addAttribute("color",this.colors),this.blending=t.ensureTypedArg(e.blending,r.NUMBER,THREE.AdditiveBlending),this.transparent=t.ensureTypedArg(e.transparent,r.BOOLEAN,!0),this.alphaTest=parseFloat(t.ensureTypedArg(e.alphaTest,r.NUMBER,0)),this.depthWrite=t.ensureTypedArg(e.depthWrite,r.BOOLEAN,!1),this.depthTest=t.ensureTypedArg(e.depthTest,r.BOOLEAN,!0),this.fog=t.ensureTypedArg(e.fog,r.BOOLEAN,!0),this.scale=t.ensureTypedArg(e.scale,r.NUMBER,300),this.emitters=[],this.emitterIDs=[],this.particleCount=0,this.uniforms={tex:{type:"t",value:this.texture}},this.material=new THREE.ShaderMaterial({uniforms:this.uniforms,vertexShader:MSPE.shaders.vertex,fragmentShader:MSPE.shaders.fragment,blending:this.blending,transparent:this.transparent,alphaTest:this.alphaTest,depthWrite:this.depthWrite,depthTest:this.depthTest,fog:this.fog}),this.materialList.push(this.material),this.mesh=new THREE.Mesh(this.instancedBufferGeometry,this.material),this.bEnableTrail=t.ensureTypedArg(e.bEnableTrail,r.BOOLEAN,!1),this.bEnableTrail&&(this.textureTrail=t.ensureInstanceOf(e.textureTrail,THREE.Texture,null),null!=this.textureTrail&&void 0!=this.textureTrail||(console.error("[MSPE.js] : [MSPE.Group] : error options.textureTrail!"),this.textureTrail=this.texture),this.fTrailLife=parseFloat(t.ensureTypedArg(e.fTrailLife,r.NUMBER,1)),this.fTrailWidthStart=parseFloat(t.ensureTypedArg(e.fTrailWidthStart,r.NUMBER,1)),this.fTrailWidthEnd=parseFloat(t.ensureTypedArg(e.fTrailWidthEnd,r.NUMBER,1)))},MSPE.Group.constructor=MSPE.Group,MSPE.Group.prototype._updateDefines=function(){"use strict"},MSPE.Group.prototype.addEmitter=function(e){"use strict";if(e instanceof MSPE.Emitter!=!1)if(this.emitterIDs.indexOf(e.uuid)>-1)console.error("[MSPE.js] : [MSPE.Group] : [addEmitter] : Emitter already exists in this group. Will not add again.");else{if(null===e.group){var t,r=this.particleCount;return t=Math.min(r+e.particleCount,this.maxParticleCount),this.particleCount=t,e.particleCount=t-r,e.activationStart=r,e.activationEnd=e.activationStart+e.particleCount,e._calculatePPSValue(e.maxAge._value+e.maxAge._spread),e.attach(this),this.emitters.push(e),this.emitterIDs.push(e.uuid),this.material.needsUpdate=!0,this.instanceBuffer.needsUpdate=!0,this}console.error("[MSPE.js] : [MSPE.Group] : [addEmitter] : Emitter already belongs to another group. Will not add to requested group.")}else console.error("[MSPE.js] : [MSPE.Group] : [addEmitter] : emitter argument must be instance of MSPE.Emitter;")},MSPE.Group.prototype.removeEmitter=function(e){"use strict";var t=this.emitterIDs.indexOf(e.uuid);e instanceof MSPE.Emitter!=!1?-1!==t?(this.emitters[t].dispose(),this.emitters.splice(t,1),this.emitterIDs.splice(t,1),this.particleCount-=e.particleCount,this.material.needsUpdate=!0,this.instanceBuffer.needsUpdate=!0,e.group=null):console.error("[MSPE.js] : [MSPE.Group] : [removeEmitter] : Emitter does not exist in this group. Will not remove."):console.error("[MSPE.js] : [MSPE.Group] : [removeEmitter] : emitter argument must be instance of MSPE.Emitter;")},MSPE.Group.prototype.tick=function(e,t){"use strict";var r=this.emitters,i=r.length,n=e||this.fixedTimeStep;if(0!==i){for(var o=0;o<i;++o)r[o].tick(n,t);this.instanceBuffer.needsUpdate=!0}},MSPE.Group.prototype.dispose=function(){"use strict";return this.materialList.forEach(function(e){e.dispose()}),this.geometryList.forEach(function(e){e.dispose()}),this.materialList=[],this.geometryList=[],this},MSPE.Emitter=function(e){"use strict";var t=MSPE.utils,r=t.types,i=MSPE.valueOverLifetimeLength;(e=t.ensureTypedArg(e,r.OBJECT,{})).position=t.ensureTypedArg(e.position,r.OBJECT,{}),e.velocity=t.ensureTypedArg(e.velocity,r.OBJECT,{}),e.acceleration=t.ensureTypedArg(e.acceleration,r.OBJECT,{}),e.radius=t.ensureTypedArg(e.radius,r.OBJECT,{}),e.drag=t.ensureTypedArg(e.drag,r.OBJECT,{}),e.rotation=t.ensureTypedArg(e.rotation,r.OBJECT,{}),e.color=t.ensureTypedArg(e.color,r.OBJECT,{}),e.opacity=t.ensureTypedArg(e.opacity,r.OBJECT,{}),e.size=t.ensureTypedArg(e.size,r.OBJECT,{}),e.angle=t.ensureTypedArg(e.angle,r.OBJECT,{}),e.wiggle=t.ensureTypedArg(e.wiggle,r.OBJECT,{}),e.maxAge=t.ensureTypedArg(e.maxAge,r.OBJECT,{}),this.uuid=THREE.Math.generateUUID(),this.type=t.ensureTypedArg(e.type,r.NUMBER,SPE.distributions.BOX),this.position={_value:t.ensureInstanceOf(e.position.value,THREE.Vector3,new THREE.Vector3),_spread:t.ensureInstanceOf(e.position.spread,THREE.Vector3,new THREE.Vector3),_spreadClamp:t.ensureInstanceOf(e.position.spreadClamp,THREE.Vector3,new THREE.Vector3),_distribution:t.ensureTypedArg(e.position.distribution,r.NUMBER,this.type),_randomise:t.ensureTypedArg(e.position.randomise,r.BOOLEAN,!1),_radius:t.ensureTypedArg(e.position.radius,r.NUMBER,10),_radiusScale:t.ensureInstanceOf(e.position.radiusScale,THREE.Vector3,new THREE.Vector3(1,1,1)),_distributionClamp:t.ensureTypedArg(e.position.distributionClamp,r.NUMBER,0)},this.velocity={_value:t.ensureInstanceOf(e.velocity.value,THREE.Vector3,new THREE.Vector3),_spread:t.ensureInstanceOf(e.velocity.spread,THREE.Vector3,new THREE.Vector3),_spreadClamp:t.ensureInstanceOf(e.velocity.spreadClamp,THREE.Vector3,new THREE.Vector3),_distribution:t.ensureTypedArg(e.velocity.distribution,r.NUMBER,this.type),_randomise:t.ensureTypedArg(e.velocity.randomise,r.BOOLEAN,!1),_radius:t.ensureTypedArg(e.velocity.radius,r.NUMBER,10),_radiusScale:t.ensureInstanceOf(e.velocity.radiusScale,THREE.Vector3,new THREE.Vector3(1,1,1)),_distributionClamp:t.ensureTypedArg(e.velocity.distributionClamp,r.NUMBER,0)},this.acceleration={_value:t.ensureInstanceOf(e.acceleration.value,THREE.Vector3,new THREE.Vector3),_spread:t.ensureInstanceOf(e.acceleration.spread,THREE.Vector3,new THREE.Vector3),_spreadClamp:t.ensureInstanceOf(e.acceleration.spreadClamp,THREE.Vector3,new THREE.Vector3),_distribution:t.ensureTypedArg(e.acceleration.distribution,r.NUMBER,this.type),_randomise:t.ensureTypedArg(e.acceleration.randomise,r.BOOLEAN,!1),_radius:t.ensureTypedArg(e.acceleration.radius,r.NUMBER,10),_radiusScale:t.ensureInstanceOf(e.acceleration.radiusScale,THREE.Vector3,new THREE.Vector3(1,1,1)),_distributionClamp:t.ensureTypedArg(e.acceleration.distributionClamp,r.NUMBER,0)},this.drag={_value:t.ensureTypedArg(e.drag.value,r.NUMBER,0),_spread:t.ensureTypedArg(e.drag.spread,r.NUMBER,0),_randomise:t.ensureTypedArg(e.drag.randomise,r.BOOLEAN,!1)},this.wiggle={_value:t.ensureTypedArg(e.wiggle.value,r.NUMBER,0),_spread:t.ensureTypedArg(e.wiggle.spread,r.NUMBER,0)},this.rotation={_axis:t.ensureInstanceOf(e.rotation.axis,THREE.Vector3,new THREE.Vector3(0,1,0)),_axisSpread:t.ensureInstanceOf(e.rotation.axisSpread,THREE.Vector3,new THREE.Vector3),_angle:t.ensureTypedArg(e.rotation.angle,r.NUMBER,0),_angleSpread:t.ensureTypedArg(e.rotation.angleSpread,r.NUMBER,0),_static:t.ensureTypedArg(e.rotation.static,r.BOOLEAN,!1),_center:t.ensureInstanceOf(e.rotation.center,THREE.Vector3,this.position._value.clone()),_randomise:t.ensureTypedArg(e.rotation.randomise,r.BOOLEAN,!1)},this.maxAge={_value:t.ensureTypedArg(e.maxAge.value,r.NUMBER,2),_spread:t.ensureTypedArg(e.maxAge.spread,r.NUMBER,0)},this.color={_value:t.ensureArrayInstanceOf(e.color.value,THREE.Color,new THREE.Color),_spread:t.ensureArrayInstanceOf(e.color.spread,THREE.Vector3,new THREE.Vector3),_randomise:t.ensureTypedArg(e.position.randomise,r.BOOLEAN,!1)},this.opacity={_value:t.ensureArrayTypedArg(e.opacity.value,r.NUMBER,1),_spread:t.ensureArrayTypedArg(e.opacity.spread,r.NUMBER,0),_randomise:t.ensureTypedArg(e.position.randomise,r.BOOLEAN,!1)},this.size={_value:t.ensureArrayTypedArg(e.size.value,r.NUMBER,1),_spread:t.ensureArrayTypedArg(e.size.spread,r.NUMBER,0),_randomise:t.ensureTypedArg(e.position.randomise,r.BOOLEAN,!1)},this.angle={_value:t.ensureArrayTypedArg(e.angle.value,r.NUMBER,0),_spread:t.ensureArrayTypedArg(e.angle.spread,r.NUMBER,0),_randomise:t.ensureTypedArg(e.position.randomise,r.BOOLEAN,!1)},this.SHOULD_DRAG_PARTICLES=!!Math.max(this.drag._value,this.drag._spread),this.SHOULD_WIGGLE_PARTICLES=!!Math.max(this.wiggle._value,this.wiggle._spread),this.SHOULD_ROTATE_PARTICLES=!!Math.max(this.rotation._angle,this.rotation._angleSpread),this.SHOULD_COLORIZE_PARTICLES=!0,this.SHOULD_SIZE_PARTICLES=!0,this.SHOULD_ANGLE_PARTICLES=!0,this.particleCount=t.ensureTypedArg(e.particleCount,r.NUMBER,100),this.objPool=new MSPE.BufferAttributeObjPool({iCount:this.particleCount}),this.duration=t.ensureTypedArg(e.duration,r.NUMBER,null),this.isStatic=t.ensureTypedArg(e.isStatic,r.BOOLEAN,!1),this.isLookAtCamera=t.ensureTypedArg(e.isLookAtCamera,r.BOOLEAN,!1),this.isLookAtCameraOnlyY=t.ensureTypedArg(e.isLookAtCameraOnlyY,r.BOOLEAN,!1),this.activeMultiplier=t.ensureTypedArg(e.activeMultiplier,r.NUMBER,1),this.direction=t.ensureTypedArg(e.direction,r.NUMBER,1),this.alive=t.ensureTypedArg(e.alive,r.BOOLEAN,!0),this.particlesPerSecond=0,this.age=0,this.activationStart=t.ensureTypedArg(e.activationStart,r.NUMBER,0),this.activationEnd=this.activationStart+this.particleCount,this._calculatePPSValue(this.maxAge._value+this.maxAge._spread),this.arrayParticles=new Array,this.group=null,this.bInitSpeed=!1,this.bInitSpeedAcc=!1,this.resetFlags={position:t.ensureTypedArg(e.position.randomise,r.BOOLEAN,!1)||t.ensureTypedArg(e.radius.randomise,r.BOOLEAN,!1),velocity:t.ensureTypedArg(e.velocity.randomise,r.BOOLEAN,!1),acceleration:t.ensureTypedArg(e.acceleration.randomise,r.BOOLEAN,!1)||t.ensureTypedArg(e.drag.randomise,r.BOOLEAN,!1),rotation:t.ensureTypedArg(e.rotation.randomise,r.BOOLEAN,!1),rotationCenter:t.ensureTypedArg(e.rotation.randomise,r.BOOLEAN,!1),size:t.ensureTypedArg(e.size.randomise,r.BOOLEAN,!1),color:t.ensureTypedArg(e.color.randomise,r.BOOLEAN,!1),opacity:t.ensureTypedArg(e.opacity.randomise,r.BOOLEAN,!1),angle:t.ensureTypedArg(e.angle.randomise,r.BOOLEAN,!1)},this.updateFlags={},this.updateCounts={},this.updateMap={maxAge:"params",position:"position",velocity:"velocity",acceleration:"acceleration",drag:"acceleration",wiggle:"params",rotation:"rotation",size:"size",color:"color",opacity:"opacity",angle:"angle"};for(var n in this.updateMap)this.updateMap.hasOwnProperty(n)&&(this.updateCounts[this.updateMap[n]]=0,this.updateFlags[this.updateMap[n]]=!1,this._createGetterSetters(this[n],n));t.ensureValueOverLifetimeCompliance(this.color,i,i),t.ensureValueOverLifetimeCompliance(this.opacity,i,i),t.ensureValueOverLifetimeCompliance(this.size,i,i),t.ensureValueOverLifetimeCompliance(this.angle,i,i)},MSPE.Emitter.constructor=MSPE.Emitter,MSPE.Emitter.prototype._createGetterSetters=function(e,t){"use strict";var r=this;for(var i in e)if(e.hasOwnProperty(i)){var n=i.replace("_","");Object.defineProperty(e,n,{get:function(e){return function(){return this[e]}}(i),set:function(e){return function(i){var n=r.updateMap[t],o=this[e],a=MSPE.valueOverLifetimeLength;"_rotationCenter"===e?(r.updateFlags.rotationCenter=!0,r.updateCounts.rotationCenter=0):"_randomise"===e?r.resetFlags[n]=i:(r.updateFlags[n]=!0,r.updateCounts[n]=0),this[e]=i,Array.isArray(o)&&MSPE.utils.ensureValueOverLifetimeCompliance(r[t],a,a)}}(i)})}},MSPE.Emitter.prototype.attach=function(e){this.group=e},MSPE.Emitter.prototype._calculatePPSValue=function(e){"use strict";var t=this.particleCount;this.duration?this.particlesPerSecond=t/(e<this.duration?e:this.duration):this.particlesPerSecond=t/e},MSPE.Emitter.prototype._activateParticles=function(e,t){"use strict";this.direction;for(var r=0;r<e;++r){var i=new MSPE.Particle({emitter:this});null!=i&&void 0!=i&&this.arrayParticles.push(i)}},MSPE.Emitter.prototype.tick=function(e,t){"use strict";if(!this.isStatic)if(!1!==this.alive)if(null!==this.duration&&this.age>this.duration){for(var r=0,i=this.arrayParticles.length;r<i;++r)this.arrayParticles[r].tick(e,t),this.arrayParticles[r].alive||(this.arrayParticles[r].dispose(),this.arrayParticles.splice(r,1),i=this.arrayParticles.length,r--);this.arrayParticles.length<=0&&(this.alive=!1,this.age=0)}else{if(this.activationIndex=this.arrayParticles.length,this.activationIndex<this.particleCount){var n=this.activationIndex,o=this.particlesPerSecond*this.activeMultiplier*e,a=1===this.particleCount?n:0|n,s=Math.min(a+o,this.activationEnd)-a;s=Math.min(this.particleCount-this.activationIndex,s),this._activateParticles(s)}for(var r=0,i=this.arrayParticles.length;r<i;++r)this.arrayParticles[r].tick(e,t),this.arrayParticles[r].alive||(this.arrayParticles[r].dispose(),this.arrayParticles.splice(r,1),i=this.arrayParticles.length,r--);this.age+=e}else this.age=0},MSPE.Emitter.prototype.dispose=function(){"use strict";for(var e=0,t=this.arrayParticles.length;e<t;++e)this.arrayParticles[e].dispose();this.particlesPerSecond=0,this.activationIndex=0,this.activeParticleCount=0,this.group=null,this.age=0,this.objPool.dispose()},MSPE.Particle=function(e){"use strict";var t=MSPE.utils,r=t.types;if(null!=(e=t.ensureTypedArg(e,r.OBJECT,{})).emitter&&void 0!=e.emitter&&e.emitter instanceof MSPE.Emitter){if(this.emitter=e.emitter,this.position={_value:e.emitter.position.value,_spread:e.emitter.position.spread,_spreadClamp:e.emitter.position.spreadClamp,_distribution:e.emitter.position.distribution,_randomise:e.emitter.position.randomise,_radius:e.emitter.position.radius,_radiusScale:e.emitter.position.radiusScale,_distributionClamp:e.emitter.position.distributionClamp},this.velocity={_value:e.emitter.velocity.value,_spread:e.emitter.velocity.spread,_spreadClamp:e.emitter.velocity.spreadClamp,_distribution:e.emitter.velocity.distribution,_randomise:e.emitter.velocity.randomise,_radius:e.emitter.velocity.radius,_radiusScale:e.emitter.velocity.radiusScale,_distributionClamp:e.emitter.velocity.distributionClamp},this.acceleration={_value:e.emitter.acceleration.value,_spread:e.emitter.acceleration.spread,_spreadClamp:e.emitter.acceleration.spreadClamp,_distribution:e.emitter.acceleration.distribution,_randomise:e.emitter.acceleration.randomise,_radius:e.emitter.acceleration.radius,_radiusScale:e.emitter.acceleration.radiusScale,_distributionClamp:e.emitter.acceleration.distributionClamp},this.drag={_value:e.emitter.drag.value,_spread:e.emitter.drag.spread,_randomise:e.emitter.position.randomise},this.wiggle={_value:e.emitter.wiggle.value,_spread:e.emitter.wiggle.spread},this.rotation={_axis:e.emitter.rotation.axis,_axisSpread:e.emitter.rotation.axisSpread,_angle:e.emitter.rotation.angle,_angleSpread:e.emitter.rotation.angleSpread,_static:e.emitter.rotation.static,_center:e.emitter.rotation.center,_randomise:e.emitter.position.randomise},this.maxAge={_value:e.emitter.maxAge.value,_spread:e.emitter.maxAge.spread},this.color={_value:e.emitter.color.value,_spread:e.emitter.color.spread,_randomise:e.emitter.position.randomise},this.opacity={_value:e.emitter.opacity.value,_spread:e.emitter.opacity.spread,_randomise:e.emitter.position.randomise},this.size={_value:e.emitter.size.value,_spread:e.emitter.size.spread,_randomise:e.emitter.position.randomise},this.angle={_value:e.emitter.angle.value,_spread:e.emitter.angle.spread,_randomise:e.emitter.position.randomise},this.alive=e.emitter.alive,this.age=0,this.vec3RealPosition=this._assignPositionValue(),this.vec3RealVelocity=this._assignVelocityValue(),this.vec3RealAcceleration=this._assignAccelerationValue(),this.arrayRealColor=this._assignColorValue(),this.arrayRealOpacity=this._assignOpacityAbsLifetimeValue(),this.arrayRealSize=this._assignSizeAbsLifetimeValue(),this.arrayRealAngle=this._assignAngleValue(),this.fRealDrag=t.clamp(t.randomFloat(this.drag._value,this.drag._spread),0,1),this.fRealWiggle=t.randomFloat(this.wiggle._value,this.wiggle._spread),this.fRealMaxAge=MSPE.utils.randomFloat(this.maxAge._value,this.maxAge._spread),this.vec3RealRotationAxis=MSPE.utils.getRotationAxis(this.rotation._axis,this.rotation._axisSpread),this.fRealRotationAngle=MSPE.utils.randomFloat(this.rotation._angle,this.rotation._angleSpread),this.uuidTrial="",this.obj=this.emitter.objPool.takeAnObj(),null==this.obj||void 0==this.obj)return this.alive=!1,this.dispose(),null;this.matrix=new THREE.Matrix4,this.matrixElements=this.matrix.elements,this.vec3Position=new THREE.Vector3(0,0,0),this.vec3Rotation=new THREE.Euler(0,0,0),this.vec3Scale=new THREE.Vector3(.1,.1,.1),this.obj.setUse(!0),this.iBufferIndex=this.obj.iIndex+this.emitter.activationStart,this.updateFlags={},this.updateCounts={},this.updateMap={maxAge:"params",position:"position",velocity:"velocity",acceleration:"acceleration",drag:"acceleration",wiggle:"params",rotation:"rotation",size:"size",color:"color",opacity:"opacity",angle:"angle"};for(var i in this.updateMap)this.updateMap.hasOwnProperty(i)&&(this.updateCounts[this.updateMap[i]]=0,this.updateFlags[this.updateMap[i]]=!1,this._createGetterSetters(this[i],i));return this.emitter.group.bEnableTrail&&(this.trailRenderHelper=new TrailRenderHelper,this.trailRenderHelper.onTriggerMeshInited=this.onTriggerMeshInited,this.trailRenderHelper.init({fTimeLong:this.emitter.group.fTrailLife,fTimeStart:MSPE.utils.clock().getElapsedTime(),iStep:0,fWidthStart:this.emitter.group.fTrailWidthStart,fWidthEnd:this.emitter.group.fTrailWidthEnd,shaderColor:new THREE.Vector4(1,1,1,1),shaderTexture:this.emitter.group.textureTrail,shaderTexMode:"Stretch",shaderBlending:this.emitter.group.blending,shaderTransparent:this.emitter.group.transparent,shaderAlphaTest:this.emitter.group.alphaTest,shaderDepthWrite:this.emitter.group.depthWrite,shaderDepthTest:this.emitter.group.depthTest},function(){}),this.uuidTrial=this.trailRenderHelper.attach(function(e){})),this}console.error("[MSPE.js] : [MSPE.Particle] : error options.emitter;")},MSPE.Particle.constructor=MSPE.Particle,MSPE.Particle.prototype.onTriggerMeshInited=function(e){this.meshTrial=e},MSPE.Particle.prototype._createGetterSetters=function(e,t){"use strict";var r=this;for(var i in e)if(e.hasOwnProperty(i)){var n=i.replace("_","");Object.defineProperty(e,n,{get:function(e){return function(){return this[e]}}(i),set:function(e){return function(i){var n=r.updateMap[t],o=this[e],a=MSPE.valueOverLifetimeLength;"_rotationCenter"===e?(r.updateFlags.rotationCenter=!0,r.updateCounts.rotationCenter=0):"_randomise"===e?r.resetFlags[n]=i:(r.updateFlags[n]=!0,r.updateCounts[n]=0),this[e]=i,Array.isArray(o)&&MSPE.utils.ensureValueOverLifetimeCompliance(r[t],a,a)}}(i)})}},MSPE.Particle.prototype.tick=function(e,t){"use strict";if(!this.emitter.isStatic){if(!1!==this.emitter.alive&&!1!==this.alive)return null!==this.emitter.duration&&this.age>this.emitter.duration?(this.alive=!1,void(this.age=0)):(this.age+=e,this.running(t),this.age>this.fRealMaxAge?(this.alive=!1,void(this.age=0)):void 0);this.age=0}},MSPE.Particle.prototype._assignPositionValue=function(){"use strict";var e=MSPE.distributions,t=MSPE.utils,r=this.position,i=r._value,n=r._spread,o=this.emitter.type,a=new THREE.Vector3(0,0,0);switch(o){case e.BOX:a=t.getRandomVector3(i,n,r._spreadClamp);break;case e.SPHERE:a=t.getRandomVector3OnSphere(i,r._radius,r._spread.x,r._radiusScale,r._spreadClamp.x,r._distributionClamp||this.particleCount);break;case e.DISC:a=t.getRandomVector3OnDisc(i,r._radius,r._spread.x,r._radiusScale,r._spreadClamp.x)}return a},MSPE.Particle.prototype._assignVelocityValue=function(){"use strict";var e=this.emitter.group.vec4Quaternion.clone();e=e.normalize();var t=MSPE.distributions,r=MSPE.utils,i=this.velocity,n=i._value,o=i._spread,a=this.emitter.type;this.emitter.bInitSpeed||(n=n.applyQuaternion(e),o=o.applyQuaternion(e),this.emitter.bInitSpeed=!0);var s=new THREE.Vector3(0,0,0);switch(a){case t.BOX:s=r.getRandomVector3(n,o);break;case t.SPHERE:s=r.getRandomDirectionVector3OnSphere(this.emitter.position.value,n.x,o.x);break;case t.DISC:s=r.getRandomVector3OnDisc(n,i._radius,i._spread.x,i._radiusScale,i._spreadClamp.x)}return s},MSPE.Particle.prototype._assignAccelerationValue=function(){"use strict";var e=this.emitter.group.vec4Quaternion.clone();e=e.normalize();var t=MSPE.distributions,r=MSPE.utils,i=this.acceleration,n=i._value,o=i._spread,a=this.emitter.type;this.emitter.bInitSpeedAcc||(n=n.applyQuaternion(e),o=o.applyQuaternion(e),this.emitter.bInitSpeedAcc=!0);var s=new THREE.Vector3(0,0,0);switch(a){case t.BOX:s=r.getRandomVector3(n,o);break;case t.SPHERE:s=r.getDirectionVector3OnSphere(this.vec3RealVelocity,this.emitter.position.value,this.emitter.velocity.value.y,this.emitter.velocity.spread.y,n,o);break;case t.DISC:s=r.getRandomVector3OnDisc(n,i._radius,i._spread.x,i._radiusScale,i._spreadClamp.x)}return s},MSPE.Particle.prototype._assignColorValue=function(){"use strict";return MSPE.utils.getRandomColor(this.color._value,this.color._spread)},MSPE.Particle.prototype._assignOpacityAbsLifetimeValue=function(){"use strict";var e,t,r=this.opacity,i=MSPE.utils;return t=new Array,i.arrayValuesAreEqual(r._value)&&i.arrayValuesAreEqual(r._spread)?(e=Math.abs(i.randomFloat(r._value[0],r._spread[0])),t.push(e),t.push(e),t.push(e),t.push(e)):(e=Math.abs(i.randomFloat(r._value[0],r._spread[0])),t.push(e),e=Math.abs(i.randomFloat(r._value[1],r._spread[1])),t.push(e),e=Math.abs(i.randomFloat(r._value[2],r._spread[2])),t.push(e),e=Math.abs(i.randomFloat(r._value[3],r._spread[3])),t.push(e)),t},MSPE.Particle.prototype._assignSizeAbsLifetimeValue=function(){"use strict";var e,t,r=this.size,i=MSPE.utils;return t=new Array,i.arrayValuesAreEqual(r._value)&&i.arrayValuesAreEqual(r._spread)?(e=Math.abs(i.randomFloat(r._value[0],r._spread[0])),t.push(e),t.push(e),t.push(e),t.push(e)):(e=Math.abs(i.randomFloat(r._value[0],r._spread[0])),t.push(e),e=Math.abs(i.randomFloat(r._value[1],r._spread[1])),t.push(e),e=Math.abs(i.randomFloat(r._value[2],r._spread[2])),t.push(e),e=Math.abs(i.randomFloat(r._value[3],r._spread[3])),t.push(e)),t},MSPE.Particle.prototype._assignAngleValue=function(){"use strict";var e,t=new Array,r=this.angle,i=MSPE.utils;return i.arrayValuesAreEqual(r._value)&&i.arrayValuesAreEqual(r._spread)?(e=i.randomFloat(r._value[0],r._spread[0]),t.push(e),t.push(e),t.push(e),t.push(e)):(e=i.randomFloat(r._value[0],r._spread[0]),t.push(e),e=i.randomFloat(r._value[1],r._spread[1]),t.push(e),e=i.randomFloat(r._value[2],r._spread[2]),t.push(e),e=i.randomFloat(r._value[3],r._spread[3]),t.push(e)),t},MSPE.Particle.prototype.getRotationMatrix=function(e,t){e=e.normalize();var r=Math.sin(t),i=Math.cos(t),n=1-i;return(new THREE.Matrix4).set(n*e.x*e.x+i,n*e.x*e.y-e.z*r,n*e.z*e.x+e.y*r,0,n*e.x*e.y+e.z*r,n*e.y*e.y+i,n*e.y*e.z-e.x*r,0,n*e.z*e.x-e.y*r,n*e.y*e.z+e.x*r,n*e.z*e.z+i,0,0,0,0,1)},MSPE.Particle.prototype.when_gt=function(e,t){return Math.max(Math.sign(e-t),0)},MSPE.Particle.prototype.when_lt=function(e,t){return Math.min(Math.max(1-Math.sign(e-t),0),1)},MSPE.Particle.prototype.when_eq=function(e,t){return 1-Math.abs(Math.sign(e-t))},MSPE.Particle.prototype.when_ge=function(e,t){return 1-this.when_lt(e,t)},MSPE.Particle.prototype.when_le=function(e,t){return 1-this.when_gt(e,t)},MSPE.Particle.prototype.and=function(e,t){return e*t},MSPE.Particle.prototype.or=function(e,t){return Math.min(e+t,1)},MSPE.Particle.prototype.getFloatOverLifetime=function(e,t){var r=0,i=e*(MSPE.valueOverLifetimeLength-1),n=0;r+=t[0]*this.when_eq(i,0);for(var o=0;o<MSPE.valueOverLifetimeLength-1;++o)n=o,r+=this.and(this.when_gt(i,n),this.when_le(i,n+1))*MSPE.utils.lerp(t[o],t[o+1],i-n);return r},MSPE.Particle.prototype.getColorOverLifetime=function(e,t,r,i,n){var o=new THREE.Vector3(0,0,0),a=new Array;a.push(t.r),a.push(r.r),a.push(i.r),a.push(n.r);var s=new Array;s.push(t.g),s.push(r.g),s.push(i.g),s.push(n.g);var l=new Array;return l.push(t.b),l.push(r.b),l.push(i.b),l.push(n.b),o.x=this.getFloatOverLifetime(e,a),o.y=this.getFloatOverLifetime(e,s),o.z=this.getFloatOverLifetime(e,l),o},MSPE.Particle.prototype.getRotation=function(e,t){if(0==this.fRealRotationAngle)return e;var r,i,n=new THREE.Vector3(this.vec3RealRotationAxis.x,this.vec3RealRotationAxis.y,this.vec3RealRotationAxis.z),o=new THREE.Vector3(this.rotation._center.x,this.rotation._center.y,this.rotation._center.z),a=0;a+=this.when_eq(this.rotation._static?0:1,0)*this.fRealRotationAngle,a+=this.when_gt(this.rotation._static?0:1,0)*MSPE.utils.lerp(0,this.fRealRotationAngle,t),r=o.sub(e),i=this.getRotationMatrix(n,a);var s=new THREE.Vector4(r.x,r.y,r.z,0);s.applyMatrix4(i);var l=new THREE.Vector3(s.x,s.y,s.z);return o.sub(l)},MSPE.Particle.prototype.running=function(e){var t=this.age,r=this.age/this.fRealMaxAge,i=new THREE.Vector3(this.vec3RealPosition.x,this.vec3RealPosition.y,this.vec3RealPosition.z),n=new THREE.Vector3(this.vec3RealVelocity.x,this.vec3RealVelocity.y,this.vec3RealVelocity.z),o=new THREE.Vector3(this.vec3RealAcceleration.x,this.vec3RealAcceleration.y,this.vec3RealAcceleration.z);if(this.emitter.SHOULD_DRAG_PARTICLES){var a=1-.5*r*this.fRealDrag;o=o.multiplyScalar(a)}var s=new THREE.Vector3;s.copy(n),s.multiplyScalar(t);var l=new THREE.Vector3;l.copy(o),l.multiplyScalar(t*t*.5);var c=new THREE.Vector3;if(c.copy(i),c.add(s.add(l)),this.emitter.SHOULD_WIGGLE_PARTICLES){var u=r*this.fRealWiggle*Math.PI,h=Math.sin(u),p=Math.cos(u);c.x+=h,c.y+=p,c.z+=h}if(this.emitter.SHOULD_ROTATE_PARTICLES&&(c=this.getRotation(c,r)),this.vec3Position=c,this.emitter.SHOULD_SIZE_PARTICLES){var d=this.getFloatOverLifetime(r,this.arrayRealSize);this.vec3Scale=new THREE.Vector3(d,d,d)}if(this.emitter.isLookAtCamera||this.emitter.isLookAtCameraOnlyY){if(this.emitter.isLookAtCamera){f=(f=new THREE.Euler).setFromQuaternion(e.quaternion),this.vec3Rotation=f}else if(this.emitter.isLookAtCameraOnlyY){var f=new THREE.Euler;f=f.setFromQuaternion(e.quaternion),this.vec3Rotation=new THREE.Euler(0,f.z,0,"XYZ")}}else if(this.emitter.SHOULD_ANGLE_PARTICLES){var m=this.getFloatOverLifetime(r,this.arrayRealAngle);this.vec3Rotation=new THREE.Euler(m,m,m)}if(this.emitter.group.bEnableTrail){var g=MSPE.utils.clock().getElapsedTime();this.trailRenderHelper.tick({uuid:this.uuidTrial,timeNow:g,position:this.vec3Position,rotation:this.vec3Rotation})}if(MSPE.utils.setMatrix(this.vec3Position,this.vec3Rotation,this.vec3Scale,this.matrix),this.emitter.group.mcol0.setXYZ(this.iBufferIndex,this.matrixElements[0],this.matrixElements[1],this.matrixElements[2]),this.emitter.group.mcol1.setXYZ(this.iBufferIndex,this.matrixElements[4],this.matrixElements[5],this.matrixElements[6]),this.emitter.group.mcol2.setXYZ(this.iBufferIndex,this.matrixElements[8],this.matrixElements[9],this.matrixElements[10]),this.emitter.group.mcol3.setXYZ(this.iBufferIndex,this.matrixElements[12],this.matrixElements[13],this.matrixElements[14]),this.emitter.SHOULD_COLORIZE_PARTICLES){var v=this.getColorOverLifetime(r,this.arrayRealColor[0],this.arrayRealColor[1],this.arrayRealColor[2],this.arrayRealColor[3]),y=this.getFloatOverLifetime(r,this.arrayRealOpacity);this.emitter.group.bEnableTrail&&null!=this.trailRenderHelper&&void 0!=this.trailRenderHelper&&this.trailRenderHelper.updateColor({r:v.x,g:v.y,b:v.z,a:y}),this.emitter.group.colors.setXYZW(this.iBufferIndex,v.x,v.y,v.z,y)}},MSPE.Particle.prototype.dispose=function(){"use strict";this.emitter.group.bEnableTrail&&(this.trailRenderHelper.detach(this.uuidTrial),this.trailRenderHelper.dispose(),this.meshTrial&&this.meshTrial.parent&&this.meshTrial.parent.remove(this.meshTrial)),null!=this.obj&&void 0!=this.obj&&this.obj.setUse(!1)},MSPE.BufferAttributeObjPool=function(e){"use strict";var t=MSPE.utils,r=t.types;if(null!=(e=t.ensureTypedArg(e,r.OBJECT,{})).iCount&&void 0!=e.iCount&&"number"==typeof e.iCount){this.iCount=e.iCount,this.objPool=new Array;for(var i=0;i<this.iCount;i++){var n=new MSPE.BufferAttributeObj({iIndex:i});this.objPool.push(n)}}else console.error("[MSPE] : [BufferAttributeObjPool] : error options.iCount;")},MSPE.BufferAttributeObjPool.constructor=MSPE.BufferAttributeObjPool,MSPE.BufferAttributeObjPool.prototype.setUse=function(e,t){"use strict";null!=e&&void 0!=e&&"number"==typeof e?e+1>this.objPool.length?console.error("[MSPE] : [BufferAttributeObjPool] : [setUse] : error iIndex; iIndex = "+e+"; while this.objPool.length = "+this.objPool.length):null!=t&&void 0!=t&&"boolean"==typeof t?this.objPool[e].setUse(t):console.error("[MSPE] : [BufferAttributeObjPool] : [setUse] : error bU;"):console.error("[MSPE] : [BufferAttributeObjPool] : [setUse] : error iIndex;")},MSPE.BufferAttributeObjPool.prototype.getUse=function(e){"use strict";if(null!=e&&void 0!=e&&"number"==typeof e){if(!(e+1>this.objPool.length))return this.objPool[e].getUse();console.error("[MSPE] : [BufferAttributeObjPool] : [getUse] : error iIndex; iIndex = "+e+"; while this.objPool.length = "+this.objPool.length)}else console.error("[MSPE] : [BufferAttributeObjPool] : [getUse] : error iIndex;")},MSPE.BufferAttributeObjPool.prototype.takeAnObj=function(){"use strict";for(var e=0,t=this.objPool.length;e<t;e++)if(!this.objPool[e].getUse())return this.objPool[e];return null},MSPE.BufferAttributeObjPool.prototype.reset=function(){"use strict";for(var e=0,t=this.objPool.length;e<t;e++)this.objPool[e].setUse(!1)},MSPE.BufferAttributeObjPool.prototype.dispose=function(){"use strict";for(var e=0,t=this.objPool.length;e<t;e++)this.objPool[e].dispose()},MSPE.BufferAttributeObj=function(e){"use strict";var t=MSPE.utils,r=t.types;null!=(e=t.ensureTypedArg(e,r.OBJECT,{})).iIndex&&void 0!=e.iIndex&&"number"==typeof e.iIndex?(this.iIndex=e.iIndex,this.bUsed=!1):console.error("[MSPE] : [BufferAttributeObj] : error options.iIndex;")},MSPE.BufferAttributeObj.constructor=MSPE.BufferAttributeObj,MSPE.BufferAttributeObj.prototype.setUse=function(e){"use strict";this.bUsed=e},MSPE.BufferAttributeObj.prototype.getUse=function(){"use strict";return this.bUsed},MSPE.BufferAttributeObj.prototype.dispose=function(){"use strict"},function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).poly2tri=e()}}(function(){return function e(t,r,i){function n(a,s){if(!r[a]){if(!t[a]){var l="function"==typeof require&&require;if(!s&&l)return l(a,!0);if(o)return o(a,!0);var c=new Error("Cannot find module '"+a+"'");throw c.code="MODULE_NOT_FOUND",c}var u=r[a]={exports:{}};t[a][0].call(u.exports,function(e){return n(t[a][1][e]||e)},u,u.exports,e,t,r,i)}return r[a].exports}for(var o="function"==typeof require&&require,a=0;a<i.length;a++)n(i[a]);return n}({1:[function(e,t,r){t.exports={version:"1.5.0"}},{}],2:[function(e,t,r){"use strict";var i=function(e,t){this.head_=e,this.tail_=t,this.search_node_=e};i.prototype.head=function(){return this.head_},i.prototype.setHead=function(e){this.head_=e},i.prototype.tail=function(){return this.tail_},i.prototype.setTail=function(e){this.tail_=e},i.prototype.search=function(){return this.search_node_},i.prototype.setSearch=function(e){this.search_node_=e},i.prototype.findSearchNode=function(){return this.search_node_},i.prototype.locateNode=function(e){var t=this.search_node_;if(e<t.value){for(;t=t.prev;)if(e>=t.value)return this.search_node_=t,t}else for(;t=t.next;)if(e<t.value)return this.search_node_=t.prev,t.prev;return null},i.prototype.locatePoint=function(e){var t=e.x,r=this.findSearchNode(t),i=r.point.x;if(t===i){if(e!==r.point)if(e===r.prev.point)r=r.prev;else{if(e!==r.next.point)throw new Error("poly2tri Invalid AdvancingFront.locatePoint() call");r=r.next}}else if(t<i)for(;(r=r.prev)&&e!==r.point;);else for(;(r=r.next)&&e!==r.point;);return r&&(this.search_node_=r),r},t.exports=i,t.exports.Node=function(e,t){this.point=e,this.triangle=t||null,this.next=null,this.prev=null,this.value=e.x}},{}],3:[function(e,t,r){"use strict";t.exports=function(e,t){if(!e)throw new Error(t||"Assert Failed")}},{}],4:[function(e,t,r){"use strict";var i=e("./xy"),n=function(e,t){this.x=+e||0,this.y=+t||0,this._p2t_edge_list=null};n.prototype.toString=function(){return i.toStringBase(this)},n.prototype.toJSON=function(){return{x:this.x,y:this.y}},n.prototype.clone=function(){return new n(this.x,this.y)},n.prototype.set_zero=function(){return this.x=0,this.y=0,this},n.prototype.set=function(e,t){return this.x=+e||0,this.y=+t||0,this},n.prototype.negate=function(){return this.x=-this.x,this.y=-this.y,this},n.prototype.add=function(e){return this.x+=e.x,this.y+=e.y,this},n.prototype.sub=function(e){return this.x-=e.x,this.y-=e.y,this},n.prototype.mul=function(e){return this.x*=e,this.y*=e,this},n.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},n.prototype.normalize=function(){var e=this.length();return this.x/=e,this.y/=e,e},n.prototype.equals=function(e){return this.x===e.x&&this.y===e.y},n.negate=function(e){return new n(-e.x,-e.y)},n.add=function(e,t){return new n(e.x+t.x,e.y+t.y)},n.sub=function(e,t){return new n(e.x-t.x,e.y-t.y)},n.mul=function(e,t){return new n(e*t.x,e*t.y)},n.cross=function(e,t){return"number"==typeof e?"number"==typeof t?e*t:new n(-e*t.y,e*t.x):"number"==typeof t?new n(t*e.y,-t*e.x):e.x*t.y-e.y*t.x},n.toString=i.toString,n.compare=i.compare,n.cmp=i.compare,n.equals=i.equals,n.dot=function(e,t){return e.x*t.x+e.y*t.y},t.exports=n},{"./xy":11}],5:[function(e,t,r){"use strict";var i=e("./xy"),n=function(e,t){this.name="PointError",this.points=t=t||[],this.message=e||"Invalid Points!";for(var r=0;r<t.length;r++)this.message+=" "+i.toString(t[r])};(n.prototype=new Error).constructor=n,t.exports=n},{"./xy":11}],6:[function(e,t,r){(function(t){"use strict";var i=t.poly2tri;r.noConflict=function(){return t.poly2tri=i,r},r.VERSION=e("../dist/version.json").version,r.PointError=e("./pointerror"),r.Point=e("./point"),r.Triangle=e("./triangle"),r.SweepContext=e("./sweepcontext");var n=e("./sweep");r.triangulate=n.triangulate,r.sweep={Triangulate:n.triangulate}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../dist/version.json":1,"./point":4,"./pointerror":5,"./sweep":7,"./sweepcontext":8,"./triangle":9}],7:[function(e,t,r){"use strict";function i(e,t,r){e.edge_event.constrained_edge=t,e.edge_event.right=t.p.x>t.q.x,o(r.triangle,t.p,t.q)||(function(e,t,r){e.edge_event.right?function(e,t,r){for(;r.next.point.x<t.p.x;)R(t.q,r.next.point,t.p)===M.CCW?u(e,t,r):r=r.next}(e,t,r):function(e,t,r){for(;r.prev.point.x>t.p.x;)R(t.q,r.prev.point,t.p)===M.CW?d(e,t,r):r=r.prev}(e,t,r)}(e,t,r),n(e,t.p,t.q,r.triangle,t.q))}function n(e,t,r,i,a){if(!o(i,t,r)){var s=i.pointCCW(a),l=R(r,s,t);if(l===M.COLLINEAR)throw new b("poly2tri EdgeEvent: Collinear not supported!",[r,s,t]);var c=i.pointCW(a),u=R(r,c,t);if(u===M.COLLINEAR)throw new b("poly2tri EdgeEvent: Collinear not supported!",[r,c,t]);l===u?(i=l===M.CW?i.neighborCCW(a):i.neighborCW(a),n(e,t,r,i,a)):g(e,t,r,i,a)}}function o(e,t,r){var i=e.edgeIndex(t,r);if(-1!==i){e.markConstrainedEdgeByIndex(i);var n=e.getNeighbor(i);return n&&n.markConstrainedEdgeByPoints(t,r),!0}return!1}function a(e,t){var r=new x(t.prev.point,t.point,t.next.point);r.markNeighbor(t.prev.triangle),r.markNeighbor(t.triangle),e.addToMap(r),t.prev.next=t.next,t.next.prev=t.prev,s(e,r)||e.mapTriangleToNodes(r)}function s(e,t){for(var r=0;r<3;++r)if(!t.delaunay_edge[r]){var i=t.getNeighbor(r);if(i){var n=t.getPoint(r),o=i.oppositePoint(t,n),a=i.index(o);if(i.constrained_edge[a]||i.delaunay_edge[a]){t.constrained_edge[r]=i.constrained_edge[a];continue}if(function(e,t,r,i){var n=e.x-i.x,o=e.y-i.y,a=t.x-i.x,s=t.y-i.y,l=n*s-a*o;if(l<=0)return!1;var c=r.x-i.x,u=r.y-i.y,h=c*o-n*u;return!(h<=0)&&(n*n+o*o)*(a*u-c*s)+(a*a+s*s)*h+(c*c+u*u)*l>0}(n,t.pointCCW(n),t.pointCW(n),o)){t.delaunay_edge[r]=!0,i.delaunay_edge[a]=!0,l(t,n,i,o);var c=!s(e,t);return c&&e.mapTriangleToNodes(t),(c=!s(e,i))&&e.mapTriangleToNodes(i),t.delaunay_edge[r]=!1,i.delaunay_edge[a]=!1,!0}}}return!1}function l(e,t,r,i){var n,o,a,s;n=e.neighborCCW(t),o=e.neighborCW(t),a=r.neighborCCW(i),s=r.neighborCW(i);var l,c,u,h;l=e.getConstrainedEdgeCCW(t),c=e.getConstrainedEdgeCW(t),u=r.getConstrainedEdgeCCW(i),h=r.getConstrainedEdgeCW(i);var p,d,f,m;p=e.getDelaunayEdgeCCW(t),d=e.getDelaunayEdgeCW(t),f=r.getDelaunayEdgeCCW(i),m=r.getDelaunayEdgeCW(i),e.legalize(t,i),r.legalize(i,t),r.setDelaunayEdgeCCW(t,p),e.setDelaunayEdgeCW(t,d),e.setDelaunayEdgeCCW(i,f),r.setDelaunayEdgeCW(i,m),r.setConstrainedEdgeCCW(t,l),e.setConstrainedEdgeCW(t,c),e.setConstrainedEdgeCCW(i,u),r.setConstrainedEdgeCW(i,h),e.clearNeighbors(),r.clearNeighbors(),n&&r.markNeighbor(n),o&&e.markNeighbor(o),a&&e.markNeighbor(a),s&&r.markNeighbor(s),e.markNeighbor(r)}function c(e,t){if(!function(e,t){var r;return r=e.basin.left_highest?e.basin.left_node.point.y-t.point.y:e.basin.right_node.point.y-t.point.y,e.basin.width>r}(e,t)&&(a(e,t),t.prev!==e.basin.left_node||t.next!==e.basin.right_node)){if(t.prev===e.basin.left_node){if(R(t.point,t.next.point,t.next.next.point)===M.CW)return;t=t.next}else if(t.next===e.basin.right_node){if(R(t.point,t.prev.point,t.prev.prev.point)===M.CCW)return;t=t.prev}else t=t.prev.point.y<t.next.point.y?t.prev:t.next;c(e,t)}}function u(e,t,r){r.point.x<t.p.x&&(R(r.point,r.next.point,r.next.next.point)===M.CCW?h(e,t,r):(p(e,t,r),u(e,t,r)))}function h(e,t,r){a(e,r.next),r.next.point!==t.p&&R(t.q,r.next.point,t.p)===M.CCW&&R(r.point,r.next.point,r.next.next.point)===M.CCW&&h(e,t,r)}function p(e,t,r){R(r.next.point,r.next.next.point,r.next.next.next.point)===M.CCW?h(e,t,r.next):R(t.q,r.next.next.point,t.p)===M.CCW&&p(e,t,r.next)}function d(e,t,r){r.point.x>t.p.x&&(R(r.point,r.prev.point,r.prev.prev.point)===M.CW?m(e,t,r):(f(e,t,r),d(e,t,r)))}function f(e,t,r){R(r.prev.point,r.prev.prev.point,r.prev.prev.prev.point)===M.CW?m(e,t,r.prev):R(t.q,r.prev.prev.point,t.p)===M.CW&&f(e,t,r.prev)}function m(e,t,r){a(e,r.prev),r.prev.point!==t.p&&R(t.q,r.prev.point,t.p)===M.CW&&R(r.point,r.prev.point,r.prev.prev.point)===M.CW&&m(e,t,r)}function g(e,t,r,i,o){var a=i.neighborAcross(o);E(a,"FLIP failed due to missing triangle!");var c=a.oppositePoint(i,o);if(i.getConstrainedEdgeAcross(o)){var u=i.index(o);throw new b("poly2tri Intersecting Constraints",[o,c,i.getPoint((u+1)%3),i.getPoint((u+2)%3)])}if(S(o,i.pointCCW(o),i.pointCW(o),c))if(l(i,o,a,c),e.mapTriangleToNodes(i),e.mapTriangleToNodes(a),o===r&&c===t)r===e.edge_event.constrained_edge.q&&t===e.edge_event.constrained_edge.p&&(i.markConstrainedEdgeByPoints(t,r),a.markConstrainedEdgeByPoints(t,r),s(e,i),s(e,a));else{i=function(e,t,r,i,n,o){var a;return t===M.CCW?(a=i.edgeIndex(n,o),i.delaunay_edge[a]=!0,s(e,i),i.clearDelaunayEdges(),r):(a=r.edgeIndex(n,o),r.delaunay_edge[a]=!0,s(e,r),r.clearDelaunayEdges(),i)}(e,R(r,c,t),i,a,o,c),g(e,t,r,i,o)}else y(e,t,r,i,a,v(t,r,a,c)),n(e,t,r,i,o)}function v(e,t,r,i){var n=R(t,i,e);if(n===M.CW)return r.pointCCW(i);if(n===M.CCW)return r.pointCW(i);throw new b("poly2tri [Unsupported] nextFlipPoint: opposing point on constrained edge!",[t,i,e])}function y(e,t,r,i,n,o){var a=n.neighborAcross(o);E(a,"FLIP failed due to missing triangle");var s=a.oppositePoint(n,o);S(r,i.pointCCW(r),i.pointCW(r),s)?g(e,r,s,a,s):y(e,t,r,i,a,v(t,r,a,s))}var E=e("./assert"),b=e("./pointerror"),x=e("./triangle"),_=e("./advancingfront").Node,w=e("./utils"),T=w.EPSILON,M=w.Orientation,R=w.orient2d,S=w.inScanArea,P=w.isAngleObtuse;r.triangulate=function(e){e.initTriangulation(),e.createAdvancingFront(),function(e){var t,r=e.pointCount();for(t=1;t<r;++t)for(var n=e.getPoint(t),o=function(e,t){var r=e.locateNode(t),i=function(e,t,r){var i=new x(t,r.point,r.next.point);i.markNeighbor(r.triangle),e.addToMap(i);var n=new _(t);return n.next=r.next,n.prev=r,r.next.prev=n,r.next=n,s(e,i)||e.mapTriangleToNodes(i),n}(e,t,r);return t.x<=r.point.x+T&&a(e,r),function(e,t){for(var r=t.next;r.next&&!P(r.point,r.next.point,r.prev.point);)a(e,r),r=r.next;for(r=t.prev;r.prev&&!P(r.point,r.next.point,r.prev.point);)a(e,r),r=r.prev;t.next&&t.next.next&&function(e){var t=e.point.x-e.next.next.point.x,r=e.point.y-e.next.next.point.y;return E(r>=0,"unordered y"),t>=0||Math.abs(t)<r}(t)&&function(e,t){for(R(t.point,t.next.point,t.next.next.point)===M.CCW?e.basin.left_node=t.next.next:e.basin.left_node=t.next,e.basin.bottom_node=e.basin.left_node;e.basin.bottom_node.next&&e.basin.bottom_node.point.y>=e.basin.bottom_node.next.point.y;)e.basin.bottom_node=e.basin.bottom_node.next;if(e.basin.bottom_node!==e.basin.left_node){for(e.basin.right_node=e.basin.bottom_node;e.basin.right_node.next&&e.basin.right_node.point.y<e.basin.right_node.next.point.y;)e.basin.right_node=e.basin.right_node.next;e.basin.right_node!==e.basin.bottom_node&&(e.basin.width=e.basin.right_node.point.x-e.basin.left_node.point.x,e.basin.left_highest=e.basin.left_node.point.y>e.basin.right_node.point.y,c(e,e.basin.bottom_node))}}(e,t)}(e,i),i}(e,n),l=n._p2t_edge_list,u=0;l&&u<l.length;++u)i(e,l[u],o)}(e),function(e){for(var t=e.front().head().next.triangle,r=e.front().head().next.point;!t.getConstrainedEdgeCW(r);)t=t.neighborCCW(r);e.meshClean(t)}(e)}},{"./advancingfront":2,"./assert":3,"./pointerror":5,"./triangle":9,"./utils":10}],8:[function(e,t,r){"use strict";var i=e("./pointerror"),n=e("./point"),o=e("./triangle"),a=e("./sweep"),s=e("./advancingfront"),l=s.Node,c=function(e,t){if(this.p=e,this.q=t,e.y>t.y)this.q=e,this.p=t;else if(e.y===t.y)if(e.x>t.x)this.q=e,this.p=t;else if(e.x===t.x)throw new i("poly2tri Invalid Edge constructor: repeated points!",[e]);this.q._p2t_edge_list||(this.q._p2t_edge_list=[]),this.q._p2t_edge_list.push(this)},u=function(){this.left_node=null,this.bottom_node=null,this.right_node=null,this.width=0,this.left_highest=!1};u.prototype.clear=function(){this.left_node=null,this.bottom_node=null,this.right_node=null,this.width=0,this.left_highest=!1};var h=function(e,t){t=t||{},this.triangles_=[],this.map_=[],this.points_=t.cloneArrays?e.slice(0):e,this.edge_list=[],this.pmin_=this.pmax_=null,this.front_=null,this.head_=null,this.tail_=null,this.af_head_=null,this.af_middle_=null,this.af_tail_=null,this.basin=new u,this.edge_event=new function(){this.constrained_edge=null,this.right=!1},this.initEdges(this.points_)};h.prototype.addHole=function(e){this.initEdges(e);var t,r=e.length;for(t=0;t<r;t++)this.points_.push(e[t]);return this},h.prototype.AddHole=h.prototype.addHole,h.prototype.addHoles=function(e){var t,r=e.length;for(t=0;t<r;t++)this.initEdges(e[t]);return this.points_=this.points_.concat.apply(this.points_,e),this},h.prototype.addPoint=function(e){return this.points_.push(e),this},h.prototype.AddPoint=h.prototype.addPoint,h.prototype.addPoints=function(e){return this.points_=this.points_.concat(e),this},h.prototype.triangulate=function(){return a.triangulate(this),this},h.prototype.getBoundingBox=function(){return{min:this.pmin_,max:this.pmax_}},h.prototype.getTriangles=function(){return this.triangles_},h.prototype.GetTriangles=h.prototype.getTriangles,h.prototype.front=function(){return this.front_},h.prototype.pointCount=function(){return this.points_.length},h.prototype.head=function(){return this.head_},h.prototype.setHead=function(e){this.head_=e},h.prototype.tail=function(){return this.tail_},h.prototype.setTail=function(e){this.tail_=e},h.prototype.getMap=function(){return this.map_},h.prototype.initTriangulation=function(){var e,t=this.points_[0].x,r=this.points_[0].x,i=this.points_[0].y,o=this.points_[0].y,a=this.points_.length;for(e=1;e<a;e++){var s=this.points_[e];s.x>t&&(t=s.x),s.x<r&&(r=s.x),s.y>i&&(i=s.y),s.y<o&&(o=s.y)}this.pmin_=new n(r,o),this.pmax_=new n(t,i);var l=.3*(t-r),c=.3*(i-o);this.head_=new n(t+l,o-c),this.tail_=new n(r-l,o-c),this.points_.sort(n.compare)},h.prototype.initEdges=function(e){var t,r=e.length;for(t=0;t<r;++t)this.edge_list.push(new c(e[t],e[(t+1)%r]))},h.prototype.getPoint=function(e){return this.points_[e]},h.prototype.addToMap=function(e){this.map_.push(e)},h.prototype.locateNode=function(e){return this.front_.locateNode(e.x)},h.prototype.createAdvancingFront=function(){var e,t,r,i=new o(this.points_[0],this.tail_,this.head_);this.map_.push(i),e=new l(i.getPoint(1),i),t=new l(i.getPoint(0),i),r=new l(i.getPoint(2)),this.front_=new s(e,r),e.next=t,t.next=r,t.prev=e,r.prev=t},h.prototype.removeNode=function(e){},h.prototype.mapTriangleToNodes=function(e){for(var t=0;t<3;++t)if(!e.getNeighbor(t)){var r=this.front_.locatePoint(e.pointCW(e.getPoint(t)));r&&(r.triangle=e)}},h.prototype.removeFromMap=function(e){var t,r=this.map_,i=r.length;for(t=0;t<i;t++)if(r[t]===e){r.splice(t,1);break}},h.prototype.meshClean=function(e){for(var t,r,i=[e];t=i.pop();)if(!t.isInterior())for(t.setInterior(!0),this.triangles_.push(t),r=0;r<3;r++)t.constrained_edge[r]||i.push(t.getNeighbor(r))},t.exports=h},{"./advancingfront":2,"./point":4,"./pointerror":5,"./sweep":7,"./triangle":9}],9:[function(e,t,r){"use strict";var i=function(e,t,r){this.points_=[e,t,r],this.neighbors_=[null,null,null],this.interior_=!1,this.constrained_edge=[!1,!1,!1],this.delaunay_edge=[!1,!1,!1]},n=e("./xy").toString;i.prototype.toString=function(){return"["+n(this.points_[0])+n(this.points_[1])+n(this.points_[2])+"]"},i.prototype.getPoint=function(e){return this.points_[e]},i.prototype.GetPoint=i.prototype.getPoint,i.prototype.getPoints=function(){return this.points_},i.prototype.getNeighbor=function(e){return this.neighbors_[e]},i.prototype.containsPoint=function(e){var t=this.points_;return e===t[0]||e===t[1]||e===t[2]},i.prototype.containsEdge=function(e){return this.containsPoint(e.p)&&this.containsPoint(e.q)},i.prototype.containsPoints=function(e,t){return this.containsPoint(e)&&this.containsPoint(t)},i.prototype.isInterior=function(){return this.interior_},i.prototype.setInterior=function(e){return this.interior_=e,this},i.prototype.markNeighborPointers=function(e,t,r){var i=this.points_;if(e===i[2]&&t===i[1]||e===i[1]&&t===i[2])this.neighbors_[0]=r;else if(e===i[0]&&t===i[2]||e===i[2]&&t===i[0])this.neighbors_[1]=r;else{if(!(e===i[0]&&t===i[1]||e===i[1]&&t===i[0]))throw new Error("poly2tri Invalid Triangle.markNeighborPointers() call");this.neighbors_[2]=r}},i.prototype.markNeighbor=function(e){var t=this.points_;e.containsPoints(t[1],t[2])?(this.neighbors_[0]=e,e.markNeighborPointers(t[1],t[2],this)):e.containsPoints(t[0],t[2])?(this.neighbors_[1]=e,e.markNeighborPointers(t[0],t[2],this)):e.containsPoints(t[0],t[1])&&(this.neighbors_[2]=e,e.markNeighborPointers(t[0],t[1],this))},i.prototype.clearNeighbors=function(){this.neighbors_[0]=null,this.neighbors_[1]=null,this.neighbors_[2]=null},i.prototype.clearDelaunayEdges=function(){this.delaunay_edge[0]=!1,this.delaunay_edge[1]=!1,this.delaunay_edge[2]=!1},i.prototype.pointCW=function(e){var t=this.points_;return e===t[0]?t[2]:e===t[1]?t[0]:e===t[2]?t[1]:null},i.prototype.pointCCW=function(e){var t=this.points_;return e===t[0]?t[1]:e===t[1]?t[2]:e===t[2]?t[0]:null},i.prototype.neighborCW=function(e){return e===this.points_[0]?this.neighbors_[1]:e===this.points_[1]?this.neighbors_[2]:this.neighbors_[0]},i.prototype.neighborCCW=function(e){return e===this.points_[0]?this.neighbors_[2]:e===this.points_[1]?this.neighbors_[0]:this.neighbors_[1]},i.prototype.getConstrainedEdgeCW=function(e){return e===this.points_[0]?this.constrained_edge[1]:e===this.points_[1]?this.constrained_edge[2]:this.constrained_edge[0]},i.prototype.getConstrainedEdgeCCW=function(e){return e===this.points_[0]?this.constrained_edge[2]:e===this.points_[1]?this.constrained_edge[0]:this.constrained_edge[1]},i.prototype.getConstrainedEdgeAcross=function(e){return e===this.points_[0]?this.constrained_edge[0]:e===this.points_[1]?this.constrained_edge[1]:this.constrained_edge[2]},i.prototype.setConstrainedEdgeCW=function(e,t){e===this.points_[0]?this.constrained_edge[1]=t:e===this.points_[1]?this.constrained_edge[2]=t:this.constrained_edge[0]=t},i.prototype.setConstrainedEdgeCCW=function(e,t){e===this.points_[0]?this.constrained_edge[2]=t:e===this.points_[1]?this.constrained_edge[0]=t:this.constrained_edge[1]=t},i.prototype.getDelaunayEdgeCW=function(e){return e===this.points_[0]?this.delaunay_edge[1]:e===this.points_[1]?this.delaunay_edge[2]:this.delaunay_edge[0]},i.prototype.getDelaunayEdgeCCW=function(e){return e===this.points_[0]?this.delaunay_edge[2]:e===this.points_[1]?this.delaunay_edge[0]:this.delaunay_edge[1]},i.prototype.setDelaunayEdgeCW=function(e,t){e===this.points_[0]?this.delaunay_edge[1]=t:e===this.points_[1]?this.delaunay_edge[2]=t:this.delaunay_edge[0]=t},i.prototype.setDelaunayEdgeCCW=function(e,t){e===this.points_[0]?this.delaunay_edge[2]=t:e===this.points_[1]?this.delaunay_edge[0]=t:this.delaunay_edge[1]=t},i.prototype.neighborAcross=function(e){return e===this.points_[0]?this.neighbors_[0]:e===this.points_[1]?this.neighbors_[1]:this.neighbors_[2]},i.prototype.oppositePoint=function(e,t){var r=e.pointCW(t);return this.pointCW(r)},i.prototype.legalize=function(e,t){var r=this.points_;if(e===r[0])r[1]=r[0],r[0]=r[2],r[2]=t;else if(e===r[1])r[2]=r[1],r[1]=r[0],r[0]=t;else{if(e!==r[2])throw new Error("poly2tri Invalid Triangle.legalize() call");r[0]=r[2],r[2]=r[1],r[1]=t}},i.prototype.index=function(e){var t=this.points_;if(e===t[0])return 0;if(e===t[1])return 1;if(e===t[2])return 2;throw new Error("poly2tri Invalid Triangle.index() call")},i.prototype.edgeIndex=function(e,t){var r=this.points_;if(e===r[0]){if(t===r[1])return 2;if(t===r[2])return 1}else if(e===r[1]){if(t===r[2])return 0;if(t===r[0])return 2}else if(e===r[2]){if(t===r[0])return 1;if(t===r[1])return 0}return-1},i.prototype.markConstrainedEdgeByIndex=function(e){this.constrained_edge[e]=!0},i.prototype.markConstrainedEdgeByEdge=function(e){this.markConstrainedEdgeByPoints(e.p,e.q)},i.prototype.markConstrainedEdgeByPoints=function(e,t){var r=this.points_;t===r[0]&&e===r[1]||t===r[1]&&e===r[0]?this.constrained_edge[2]=!0:t===r[0]&&e===r[2]||t===r[2]&&e===r[0]?this.constrained_edge[1]=!0:(t===r[1]&&e===r[2]||t===r[2]&&e===r[1])&&(this.constrained_edge[0]=!0)},t.exports=i},{"./xy":11}],10:[function(e,t,r){"use strict";var i=1e-12;r.EPSILON=i;var n={CW:1,CCW:-1,COLLINEAR:0};r.Orientation=n,r.orient2d=function(e,t,r){var o=(e.x-r.x)*(t.y-r.y)-(e.y-r.y)*(t.x-r.x);return o>-i&&o<i?n.COLLINEAR:o>0?n.CCW:n.CW},r.inScanArea=function(e,t,r,n){return!((e.x-t.x)*(n.y-t.y)-(n.x-t.x)*(e.y-t.y)>=-i||(e.x-r.x)*(n.y-r.y)-(n.x-r.x)*(e.y-r.y)<=i)},r.isAngleObtuse=function(e,t,r){var i=t.x-e.x,n=t.y-e.y;return i*(r.x-e.x)+n*(r.y-e.y)<0}},{}],11:[function(e,t,r){"use strict";function i(e){return"("+e.x+";"+e.y+")"}t.exports={toString:function(e){var t=e.toString();return"[object Object]"===t?i(e):t},toStringBase:i,compare:function(e,t){return e.y===t.y?e.x-t.x:e.y-t.y},equals:function(e,t){return e.x===t.x&&e.y===t.y}}},{}]},{},[6])(6)}),function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).polylabel=e()}}(function(){return function(){function e(t,r,i){function n(a,s){if(!r[a]){if(!t[a]){var l="function"==typeof require&&require;if(!s&&l)return l(a,!0);if(o)return o(a,!0);var c=new Error("Cannot find module '"+a+"'");throw c.code="MODULE_NOT_FOUND",c}var u=r[a]={exports:{}};t[a][0].call(u.exports,function(e){var r=t[a][1][e];return n(r||e)},u,u.exports,e,t,r,i)}return r[a].exports}for(var o="function"==typeof require&&require,a=0;a<i.length;a++)n(i[a]);return n}return e}()({1:[function(e,t,r){"use strict";function i(e,t,r){t=t||1;for(var i,s,l,c,u=0;u<e[0].length;u++){var h=e[0][u];(!u||h[0]<i)&&(i=h[0]),(!u||h[1]<s)&&(s=h[1]),(!u||h[0]>l)&&(l=h[0]),(!u||h[1]>c)&&(c=h[1])}var p=l-i,d=c-s,f=Math.min(p,d),m=f/2,g=new a(null,n);if(0===f)return[i,s];for(var v=i;v<l;v+=f)for(var y=s;y<c;y+=f)g.push(new o(v+m,y+m,m,e));var E=function(e){for(var t=0,r=0,i=0,n=e[0],a=0,s=n.length,l=s-1;a<s;l=a++){var c=n[a],u=n[l],h=c[0]*u[1]-u[0]*c[1];r+=(c[0]+u[0])*h,i+=(c[1]+u[1])*h,t+=3*h}return 0===t?new o(n[0][0],n[0][1],0,e):new o(r/t,i/t,0,e)}(e),b=new o(i+p/2,s+d/2,0,e);b.d>E.d&&(E=b);for(var x=g.length;g.length;){var _=g.pop();_.d>E.d&&(E=_,r&&console.log("found best %d after %d probes",Math.round(1e4*_.d)/1e4,x)),_.max-E.d<=t||(m=_.h/2,g.push(new o(_.x-m,_.y-m,m,e)),g.push(new o(_.x+m,_.y-m,m,e)),g.push(new o(_.x-m,_.y+m,m,e)),g.push(new o(_.x+m,_.y+m,m,e)),x+=4)}return r&&(console.log("num probes: "+x),console.log("best distance: "+E.d)),[E.x,E.y]}function n(e,t){return t.max-e.max}function o(e,t,r,i){this.x=e,this.y=t,this.h=r,this.d=function(e,t,r){for(var i=!1,n=1/0,o=0;o<r.length;o++)for(var a=r[o],s=0,l=a.length,c=l-1;s<l;c=s++){var u=a[s],h=a[c];u[1]>t!=h[1]>t&&e<(h[0]-u[0])*(t-u[1])/(h[1]-u[1])+u[0]&&(i=!i),n=Math.min(n,function(e,t,r,i){var n=r[0],o=r[1],a=i[0]-n,s=i[1]-o;if(0!==a||0!==s){var l=((e-n)*a+(t-o)*s)/(a*a+s*s);l>1?(n=i[0],o=i[1]):l>0&&(n+=a*l,o+=s*l)}return a=e-n,s=t-o,a*a+s*s}(e,t,u,h))}return(i?1:-1)*Math.sqrt(n)}(e,t,i),this.max=this.d+this.h*Math.SQRT2}var a=e("tinyqueue");t.exports=i,t.exports.default=i},{tinyqueue:2}],2:[function(e,t,r){"use strict";function i(e,t){if(!(this instanceof i))return new i(e,t);if(this.data=e||[],this.length=this.data.length,this.compare=t||function(e,t){return e<t?-1:e>t?1:0},this.length>0)for(var r=(this.length>>1)-1;r>=0;r--)this._down(r)}t.exports=i,t.exports.default=i,i.prototype={push:function(e){this.data.push(e),this.length++,this._up(this.length-1)},pop:function(){if(0!==this.length){var e=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),e}},peek:function(){return this.data[0]},_up:function(e){for(var t=this.data,r=this.compare,i=t[e];e>0;){var n=e-1>>1,o=t[n];if(r(i,o)>=0)break;t[e]=o,e=n}t[e]=i},_down:function(e){for(var t=this.data,r=this.compare,i=this.length>>1,n=t[e];e<i;){var o=1+(e<<1),a=o+1,s=t[o];if(a<this.length&&r(t[a],s)<0&&(o=a,s=t[a]),r(s,n)>=0)break;t[e]=s,e=o}t[e]=n}}},{}]},{},[1])(1)}),SimpleHeatmap.prototype=Object.assign(Object.create({}),{constructor:SimpleHeatmap,defaultRadius:25,defaultGradient:{.4:"blue",.6:"cyan",.7:"lime",.8:"yellow",1:"red"},canvas:function(){return this._canvas},data:function(e){return this._data=e,this._dataDirty=!0,this},add:function(e){return this._data.push(e),this._dataDirty=!0,this},clear:function(){return this._data=[],this._dataDirty=!0,this},max:function(e){return this._max!==e&&(this._max=e,this._dataDirty=!0),this},min:function(e){return this._min!==e&&(this._min=e,this._dataDirty=!0),this},setCanvasSize:function(e,t){return this._canvasWidth===e&&this._canvasHeight===t||(this._canvasWidth=this._canvas.width=e,this._canvasHeight=this._canvas.height=t,this._dataDirty=!0),this},setAreaSize:function(e,t){return this._areaWidth===e&&this._areaHeight===t||(this._areaWidth=e,this._areaHeight=t,this._dataDirty=!0),this},alpha:function(e){return this._alpha=e,this},radius:function(e,t){if(t=void 0!==t?t:15,e===this._radius&&t===this._blur)return this;this._radius=e,this._blur=t,this._r=this._radius+this._blur;var r=this._circle,i=this._cirCtx;return r.width=r.height=2*this._r,i.shadowOffsetX=i.shadowOffsetY=2*this._r,i.shadowBlur=t,i.shadowColor="black",i.beginPath(),i.arc(-this._r,-this._r,e,0,2*Math.PI,!0),i.closePath(),i.fill(),this},gradient:function(e){var t=this._getGradientCode(this._grad),r=this._getGradientCode(e);if(t===r)return this;if(this._grad=Object.assign({},e),this._gradCache[r])return this._gradData=this._gradCache[r],this;var i=this._gradCtx.createLinearGradient(0,0,0,256);for(var n in e)i.addColorStop(+n,e[n]);return this._gradCtx.fillStyle=i,this._gradCtx.fillRect(0,0,1,256),this._gradData=this._gradCtx.getImageData(0,0,1,256).data,this._gradCache[r]=this._gradData,this},draw:function(){0===this._r&&this.radius(this.defaultRadius),this._gradData||this.gradient(this.defaultGradient),this._dataDirty&&this._transformData();var e=this._ctx;e.clearRect(0,0,this._canvasWidth,this._canvasHeight);for(var t,r=0,i=this._transformedData.length;r<i;r++)t=this._transformedData[r],e.globalAlpha=t[2],e.drawImage(this._circle,t[0]-this._r,t[1]-this._r);var n=e.getImageData(0,0,this._canvasWidth,this._canvasHeight);return this._colorize(n.data,this._gradData,this._alpha),e.putImageData(n,0,0),this},_transformData:function(){this._transformedData=[];var e=this._canvasWidth/this._areaWidth,t=this._canvasHeight/this._areaHeight,r=this;this._data.map(function(i){var n=i[0],o=i[1];n=n*e+r._canvasWidth/2,o=o*t+r._canvasHeight/2;var a=Math.min(Math.max((i[2]-r._min)/(r._max-r._min),.05),1);r._transformedData.push([n,o,a])})},_colorize:function(e,t,r){for(var i,n=0,o=e.length;n<o;n+=4)i=4*e[n+3],r&&0===i||(e[n]=t[i],e[n+1]=t[i+1],e[n+2]=t[i+2],r||(e[n+3]=255))},_getGradientCode:function(e){var t="grad:(";for(var r in e)t+=r+":"+e[r]+",";return t+=")"},_createCanvas:function(){return"undefined"!=typeof document?document.createElement("canvas"):new this._canvas.constructor}});var SPE={distributions:{BOX:1,SPHERE:2,DISC:3},valueOverLifetimeLength:4};"function"==typeof define&&define.amd?define("spe",SPE):"undefined"!=typeof exports&&"undefined"!=typeof module&&(module.exports=SPE),SPE.TypedArrayHelper=function(e,t,r,i){"use strict";this.componentSize=r||1,this.size=t||1,this.TypedArrayConstructor=e||Float32Array,this.array=new e(t*this.componentSize),this.indexOffset=i||0},SPE.TypedArrayHelper.constructor=SPE.TypedArrayHelper,SPE.TypedArrayHelper.prototype.setSize=function(e,t){"use strict";var r=this.array.length;return t||(e*=this.componentSize),e<r?this.shrink(e):e>r?this.grow(e):void console.info("TypedArray is already of size:",e+".","Will not resize.")},SPE.TypedArrayHelper.prototype.shrink=function(e){"use strict";return this.array=this.array.subarray(0,e),this.size=e,this},SPE.TypedArrayHelper.prototype.grow=function(e){"use strict";var t=this.array,r=new this.TypedArrayConstructor(e);return r.set(t),this.array=r,this.size=e,this},SPE.TypedArrayHelper.prototype.splice=function(e,t){"use strict";e*=this.componentSize,t*=this.componentSize;for(var r=[],i=this.array,n=i.length,o=0;o<n;++o)(o<e||o>=t)&&r.push(i[o]);return this.setFromArray(0,r),this},SPE.TypedArrayHelper.prototype.setFromArray=function(e,t){"use strict";var r=e+t.length;return r>this.array.length?this.grow(r):r<this.array.length&&this.shrink(r),this.array.set(t,this.indexOffset+e),this},SPE.TypedArrayHelper.prototype.setVec2=function(e,t){"use strict";return this.setVec2Components(e,t.x,t.y)},SPE.TypedArrayHelper.prototype.setVec2Components=function(e,t,r){"use strict";var i=this.array,n=this.indexOffset+e*this.componentSize;return i[n]=t,i[n+1]=r,this},SPE.TypedArrayHelper.prototype.setVec3=function(e,t){"use strict";return this.setVec3Components(e,t.x,t.y,t.z)},SPE.TypedArrayHelper.prototype.setVec3Components=function(e,t,r,i){"use strict";var n=this.array,o=this.indexOffset+e*this.componentSize;return n[o]=t,n[o+1]=r,n[o+2]=i,this},SPE.TypedArrayHelper.prototype.setVec4=function(e,t){"use strict";return this.setVec4Components(e,t.x,t.y,t.z,t.w)},SPE.TypedArrayHelper.prototype.setVec4Components=function(e,t,r,i,n){"use strict";var o=this.array,a=this.indexOffset+e*this.componentSize;return o[a]=t,o[a+1]=r,o[a+2]=i,o[a+3]=n,this},SPE.TypedArrayHelper.prototype.setMat3=function(e,t){"use strict";return this.setFromArray(this.indexOffset+e*this.componentSize,t.elements)},SPE.TypedArrayHelper.prototype.setMat4=function(e,t){"use strict";return this.setFromArray(this.indexOffset+e*this.componentSize,t.elements)},SPE.TypedArrayHelper.prototype.setColor=function(e,t){"use strict";return this.setVec3Components(e,t.r,t.g,t.b)},SPE.TypedArrayHelper.prototype.setNumber=function(e,t){"use strict";return this.array[this.indexOffset+e*this.componentSize]=t,this},SPE.TypedArrayHelper.prototype.getValueAtIndex=function(e){"use strict";return this.array[this.indexOffset+e]},SPE.TypedArrayHelper.prototype.getComponentValueAtIndex=function(e){"use strict";return this.array.subarray(this.indexOffset+e*this.componentSize)},SPE.ShaderAttribute=function(e,t,r){"use strict";var i=SPE.ShaderAttribute.typeSizeMap;this.type="string"==typeof e&&i.hasOwnProperty(e)?e:"f",this.componentSize=i[this.type],this.arrayType=r||Float32Array,this.typedArray=null,this.bufferAttribute=null,this.dynamicBuffer=!!t,this.updateMin=0,this.updateMax=0},SPE.ShaderAttribute.constructor=SPE.ShaderAttribute,SPE.ShaderAttribute.typeSizeMap={f:1,v2:2,v3:3,v4:4,c:3,m3:9,m4:16},SPE.ShaderAttribute.prototype.setUpdateRange=function(e,t){"use strict";this.updateMin=Math.min(e*this.componentSize,this.updateMin*this.componentSize),this.updateMax=Math.max(t*this.componentSize,this.updateMax*this.componentSize)},SPE.ShaderAttribute.prototype.flagUpdate=function(){"use strict";var e=this.bufferAttribute,t=e.updateRange;t.offset=this.updateMin,t.count=Math.min(this.updateMax-this.updateMin+this.componentSize,this.typedArray.array.length),e.needsUpdate=!0},SPE.ShaderAttribute.prototype.resetUpdateRange=function(){"use strict";this.updateMin=0,this.updateMax=0},SPE.ShaderAttribute.prototype.resetDynamic=function(){"use strict";this.bufferAttribute.dynamic=this.dynamicBuffer},SPE.ShaderAttribute.prototype.splice=function(e,t){"use strict";this.typedArray.splice(e,t),this.forceUpdateAll()},SPE.ShaderAttribute.prototype.forceUpdateAll=function(){"use strict";this.bufferAttribute.array=this.typedArray.array,this.bufferAttribute.updateRange.offset=0,this.bufferAttribute.updateRange.count=-1,this.bufferAttribute.dynamic=!1,this.bufferAttribute.needsUpdate=!0},SPE.ShaderAttribute.prototype._ensureTypedArray=function(e){"use strict";null!==this.typedArray&&this.typedArray.size===e*this.componentSize||(null!==this.typedArray&&this.typedArray.size!==e?this.typedArray.setSize(e):null===this.typedArray&&(this.typedArray=new SPE.TypedArrayHelper(this.arrayType,e,this.componentSize)))},SPE.ShaderAttribute.prototype._createBufferAttribute=function(e){"use strict";if(this._ensureTypedArray(e),null!==this.bufferAttribute)return this.bufferAttribute.array=this.typedArray.array,parseFloat(THREE.REVISION)>=81&&(this.bufferAttribute.count=this.bufferAttribute.array.length/this.bufferAttribute.itemSize),void(this.bufferAttribute.needsUpdate=!0);this.bufferAttribute=new THREE.BufferAttribute(this.typedArray.array,this.componentSize),this.bufferAttribute.dynamic=this.dynamicBuffer},SPE.ShaderAttribute.prototype.getLength=function(){"use strict";return null===this.typedArray?0:this.typedArray.array.length},SPE.shaderChunks={defines:["#define PACKED_COLOR_SIZE 256.0","#define PACKED_COLOR_DIVISOR 255.0"].join("\n"),uniforms:["uniform float deltaTime;","uniform float runTime;","uniform sampler2D tex;","uniform vec4 textureAnimation;","uniform float scale;"].join("\n"),attributes:["attribute vec4 acceleration;","attribute vec3 velocity;","attribute vec4 rotation;","attribute vec3 rotationCenter;","attribute vec4 params;","attribute vec4 size;","attribute vec4 angle;","attribute vec4 color;","attribute vec4 opacity;","attribute vec4 trail;"].join("\n"),varyings:["varying vec4 vColor;","//#ifdef SHOULD_ROTATE_TEXTURE","    varying float vAngle;","//#endif","#ifdef SHOULD_CALCULATE_SPRITE","    varying vec4 vSpriteSheet;","#endif","#ifdef SHOULD_TRAIL_PARTICLES","    varying float fTrailSpeed;","    varying vec4 vec4Path_0;","    varying vec4 vec4Path_1;","    varying vec4 vec4Path_2;","    varying vec4 vec4Path_3;","    varying vec4 vec4Path_4;","    varying vec4 vec4Path_5;","    varying vec4 vec4Path_6;","    varying vec4 vec4Path_7;","    varying vec4 vec4Path_8;","    varying vec4 vec4Path_9;","#endif"].join("\n"),branchAvoidanceFunctions:["float when_gt(float x, float y) {","    return max(sign(x - y), 0.0);","}","float when_lt(float x, float y) {","    return min( max(1.0 - sign(x - y), 0.0), 1.0 );","}","float when_eq( float x, float y ) {","    return 1.0 - abs( sign( x - y ) );","}","float when_ge(float x, float y) {","  return 1.0 - when_lt(x, y);","}","float when_le(float x, float y) {","  return 1.0 - when_gt(x, y);","}","float and(float a, float b) {","    return a * b;","}","float or(float a, float b) {","    return min(a + b, 1.0);","}"].join("\n"),unpackColor:["vec3 unpackColor( in float hex ) {","   vec3 c = vec3( 0.0 );","   float r = mod( (hex / PACKED_COLOR_SIZE / PACKED_COLOR_SIZE), PACKED_COLOR_SIZE );","   float g = mod( (hex / PACKED_COLOR_SIZE), PACKED_COLOR_SIZE );","   float b = mod( hex, PACKED_COLOR_SIZE );","   c.r = r / PACKED_COLOR_DIVISOR;","   c.g = g / PACKED_COLOR_DIVISOR;","   c.b = b / PACKED_COLOR_DIVISOR;","   return c;","}"].join("\n"),unpackRotationAxis:["vec3 unpackRotationAxis( in float hex ) {","   vec3 c = vec3( 0.0 );","   float r = mod( (hex / PACKED_COLOR_SIZE / PACKED_COLOR_SIZE), PACKED_COLOR_SIZE );","   float g = mod( (hex / PACKED_COLOR_SIZE), PACKED_COLOR_SIZE );","   float b = mod( hex, PACKED_COLOR_SIZE );","   c.r = r / PACKED_COLOR_DIVISOR;","   c.g = g / PACKED_COLOR_DIVISOR;","   c.b = b / PACKED_COLOR_DIVISOR;","   c *= vec3( 2.0 );","   c -= vec3( 1.0 );","   return c;","}"].join("\n"),floatOverLifetime:["float getFloatOverLifetime( in float positionInTime, in vec4 attr ) {","    highp float value = 0.0;","    float deltaAge = positionInTime * float( VALUE_OVER_LIFETIME_LENGTH - 1 );","    float fIndex = 0.0;","    float shouldApplyValue = 0.0;","    value += attr[ 0 ] * when_eq( deltaAge, 0.0 );","","    for( int i = 0; i < VALUE_OVER_LIFETIME_LENGTH - 1; ++i ) {","       fIndex = float( i );","       shouldApplyValue = and( when_gt( deltaAge, fIndex ), when_le( deltaAge, fIndex + 1.0 ) );","       value += shouldApplyValue * mix( attr[ i ], attr[ i + 1 ], deltaAge - fIndex );","    }","","    return value;","}"].join("\n"),colorOverLifetime:["vec3 getColorOverLifetime( in float positionInTime, in vec3 color1, in vec3 color2, in vec3 color3, in vec3 color4 ) {","    vec3 value = vec3( 0.0 );","    value.x = getFloatOverLifetime( positionInTime, vec4( color1.x, color2.x, color3.x, color4.x ) );","    value.y = getFloatOverLifetime( positionInTime, vec4( color1.y, color2.y, color3.y, color4.y ) );","    value.z = getFloatOverLifetime( positionInTime, vec4( color1.z, color2.z, color3.z, color4.z ) );","    return value;","}"].join("\n"),paramFetchingFunctions:["float getAlive() {","   return params.x;","}","float getAge() {","   return params.y;","}","float getMaxAge() {","   return params.z;","}","float getWiggle() {","   return params.w;","}"].join("\n"),forceFetchingFunctions:["vec4 getPosition( in float age ) {","   return modelViewMatrix * vec4( position, 1.0 );","}","vec3 getVelocity( in float age ) {","   return velocity * age;","}","vec3 getAcceleration( in float age ) {","   return acceleration.xyz * age;","}"].join("\n"),rotationFunctions:["#ifdef SHOULD_ROTATE_PARTICLES","   mat4 getRotationMatrix( in vec3 axis, in float angle) {","       axis = normalize(axis);","       float s = sin(angle);","       float c = cos(angle);","       float oc = 1.0 - c;","","       return mat4(oc * axis.x * axis.x + c,           oc * axis.x * axis.y - axis.z * s,  oc * axis.z * axis.x + axis.y * s,  0.0,","                   oc * axis.x * axis.y + axis.z * s,  oc * axis.y * axis.y + c,           oc * axis.y * axis.z - axis.x * s,  0.0,","                   oc * axis.z * axis.x - axis.y * s,  oc * axis.y * axis.z + axis.x * s,  oc * axis.z * axis.z + c,           0.0,","                   0.0,                                0.0,                                0.0,                                1.0);","   }","","   vec3 getRotation( in vec3 pos, in float positionInTime ) {","      if( rotation.y == 0.0 ) {","           return pos;","      }","","      vec3 axis = unpackRotationAxis( rotation.x );","      vec3 center = rotationCenter;","      vec3 translated;","      mat4 rotationMatrix;","      float angle = 0.0;","      angle += when_eq( rotation.z, 0.0 ) * rotation.y;","      angle += when_gt( rotation.z, 0.0 ) * mix( 0.0, rotation.y, positionInTime );","      translated = rotationCenter - pos;","      rotationMatrix = getRotationMatrix( axis, angle );","      return center - vec3( rotationMatrix * vec4( translated, 0.0 ) );","   }","#endif"].join("\n"),rotateTexture:["    vec2 vUv = vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y );","","    #ifdef SHOULD_ROTATE_TEXTURE","       float x = gl_PointCoord.x - 0.5;","       float y = 1.0 - gl_PointCoord.y - 0.5;","       float c = cos( -vAngle );","       float s = sin( -vAngle );","       vUv = vec2( c * x + s * y + 0.5, c * y - s * x + 0.5 );","    #endif","","    #ifdef SHOULD_CALCULATE_SPRITE","        float framesX = vSpriteSheet.x;","        float framesY = vSpriteSheet.y;","        float columnNorm = vSpriteSheet.z;","        float rowNorm = vSpriteSheet.w;","        vUv.x = gl_PointCoord.x * framesX + columnNorm;","        vUv.y = 1.0 - (gl_PointCoord.y * framesY + rowNorm);","       if(vAngle != 0.0)","       {","           lowp float cos50 = cos(-vAngle);","           lowp float sin50 = sin(-vAngle);","           vec2 rotator50 = vUv;","           lowp float fWCeil = 1.0 / textureAnimation.x;","           lowp float fHCeil = 1.0 / textureAnimation.y;","           lowp float fHalfWCeil = fWCeil * 0.5;","           lowp float fHalfHCeil = fHCeil * 0.5;","           lowp float fXCenter = 0.0;","           lowp float fYCenter = 0.0;","           for(lowp float i = 0.0; i < 20.0; i+=1.0)","           {","               if(i >= textureAnimation.x) break;","               for(lowp float j = 0.0; j < 20.0; j+=1.0)","               {","                   if(j >= textureAnimation.y) break;","                   fXCenter = (i) * (fWCeil) + fHalfWCeil;","                   fYCenter = (j) * (fHCeil) + fHalfHCeil;","                   if(pow(((vUv.x - fXCenter)/(fHalfWCeil)), 2.0) + pow(((vUv.y - fYCenter)/(fHalfHCeil)), 2.0) <= 1.0)","                       rotator50 = (mat2( cos50 , -sin50 , sin50 , cos50 ) * (vUv - vec2( fXCenter,fYCenter ))) + vec2( fXCenter,fYCenter );","                   vUv = rotator50;","               }","           }","       }","      #else","       if(vAngle != 0.0)","       {","           lowp float cos50 = cos(-vAngle);","           lowp float sin50 = sin(-vAngle);","           vec2 rotator50 = vUv;","           lowp float fWCeil = 1.0 / textureAnimation.x;","           lowp float fHCeil = 1.0 / textureAnimation.y;","           lowp float fHalfWCeil = fWCeil * 0.5;","           lowp float fHalfHCeil = fHCeil * 0.5;","           lowp float fXCenter = 0.0;","           lowp float fYCenter = 0.0;","           for(lowp float i = 0.0; i < 20.0; i+=1.0)","           {","               if(i >= textureAnimation.x) break;","               for(lowp float j = 0.0; j < 20.0; j+=1.0)","               {","                   if(j >= textureAnimation.y) break;","                   fXCenter = (i) * (fWCeil) + fHalfWCeil;","                   fYCenter = (j) * (fHCeil) + fHalfHCeil;","                   if(pow(((vUv.x - fXCenter)/(fHalfWCeil)), 2.0) + pow(((vUv.y - fYCenter)/(fHalfHCeil)), 2.0) <= 1.0)","                       rotator50 = (mat2( cos50 , -sin50 , sin50 , cos50 ) * (vUv - vec2( fXCenter,fYCenter ))) + vec2( fXCenter,fYCenter );","                   vUv = rotator50;","               }","           }","       }","    #endif","","    vec4 rotatedTexture = texture2D( tex, vUv );","    #ifdef SHOULD_TRAIL_PARTICLES","\t    float fVelocityScale = fTrailSpeed;","\t    vec2 a_0 = (vec4Path_1.xy / vec4Path_1.w) * 0.5 + 0.5;","\t    vec2 b_0 = (vec4Path_0.xy / vec4Path_0.w) * 0.5 + 0.5;","\t    vec2 velocity_0 = fVelocityScale * (a_0 - b_0);","\t    vec2 a_1 = (vec4Path_2.xy / vec4Path_2.w) * 0.5 + 0.5;","\t    vec2 b_1 = (vec4Path_1.xy / vec4Path_1.w) * 0.5 + 0.5;","\t    vec2 velocity_1 = fVelocityScale * (a_1 - b_0);","\t    vec2 a_2 = (vec4Path_3.xy / vec4Path_3.w) * 0.5 + 0.5;","\t    vec2 b_2 = (vec4Path_2.xy / vec4Path_2.w) * 0.5 + 0.5;","\t    vec2 velocity_2 = fVelocityScale * (a_2 - b_0);","\t    vec2 a_3 = (vec4Path_4.xy / vec4Path_4.w) * 0.5 + 0.5;","\t    vec2 b_3 = (vec4Path_3.xy / vec4Path_3.w) * 0.5 + 0.5;","\t    vec2 velocity_3 = fVelocityScale * (a_3 - b_0);","\t    vec2 a_4 = (vec4Path_5.xy / vec4Path_5.w) * 0.5 + 0.5;","\t    vec2 b_4 = (vec4Path_4.xy / vec4Path_4.w) * 0.5 + 0.5;","\t    vec2 velocity_4 = fVelocityScale * (a_4 - b_0);","\t    vec2 a_5 = (vec4Path_6.xy / vec4Path_6.w) * 0.5 + 0.5;","\t    vec2 b_5 = (vec4Path_5.xy / vec4Path_5.w) * 0.5 + 0.5;","\t    vec2 velocity_5 = fVelocityScale * (a_5 - b_0);","\t    vec2 a_6 = (vec4Path_7.xy / vec4Path_7.w) * 0.5 + 0.5;","\t    vec2 b_6 = (vec4Path_6.xy / vec4Path_6.w) * 0.5 + 0.5;","\t    vec2 velocity_6 = fVelocityScale * (a_6 - b_0);","\t    vec2 a_7 = (vec4Path_8.xy / vec4Path_8.w) * 0.5 + 0.5;","\t    vec2 b_7 = (vec4Path_7.xy / vec4Path_7.w) * 0.5 + 0.5;","\t    vec2 velocity_7 = fVelocityScale * (a_7 - b_0);","\t    vec2 a_8 = (vec4Path_9.xy / vec4Path_9.w) * 0.5 + 0.5;","\t    vec2 b_8 = (vec4Path_8.xy / vec4Path_8.w) * 0.5 + 0.5;","\t    vec2 velocity_8 = fVelocityScale * (a_8 - b_0);","\t    vec4 oResult;","\t    oResult = texture2D(tex, vUv);","\t    vec2 offset_0 = velocity_0 * (float(1) / float(9) - 0.5);","\t    vec2 offset_1 = velocity_1 * (float(2) / float(9) - 0.5);","\t    vec2 offset_2 = velocity_2 * (float(3) / float(9) - 0.5);","\t    vec2 offset_3 = velocity_3 * (float(4) / float(9) - 0.5);","\t    vec2 offset_4 = velocity_4 * (float(5) / float(9) - 0.5);","\t    vec2 offset_5 = velocity_5 * (float(6) / float(9) - 0.5);","\t    vec2 offset_6 = velocity_6 * (float(7) / float(9) - 0.5);","\t    vec2 offset_7 = velocity_7 * (float(8) / float(9) - 0.5);","\t    vec2 offset_8 = velocity_8 * (float(9) / float(9) - 0.5);","\t    oResult += texture2D(tex, vUv + offset_0);","\t    oResult += texture2D(tex, vUv + offset_1);","\t    oResult += texture2D(tex, vUv + offset_2);","\t    oResult += texture2D(tex, vUv + offset_3);","\t    oResult += texture2D(tex, vUv + offset_4);","\t    oResult += texture2D(tex, vUv + offset_5);","\t    oResult += texture2D(tex, vUv + offset_6);","\t    oResult += texture2D(tex, vUv + offset_7);","\t    oResult += texture2D(tex, vUv + offset_8);","       rotatedTexture = oResult;","    #endif"].join("\n")},SPE.shaders={vertex:[SPE.shaderChunks.defines,SPE.shaderChunks.uniforms,SPE.shaderChunks.attributes,SPE.shaderChunks.varyings,THREE.ShaderChunk.common,THREE.ShaderChunk.logdepthbuf_pars_vertex,THREE.ShaderChunk.fog_pars_vertex,SPE.shaderChunks.branchAvoidanceFunctions,SPE.shaderChunks.unpackColor,SPE.shaderChunks.unpackRotationAxis,SPE.shaderChunks.floatOverLifetime,SPE.shaderChunks.colorOverLifetime,SPE.shaderChunks.paramFetchingFunctions,SPE.shaderChunks.forceFetchingFunctions,SPE.shaderChunks.rotationFunctions,"void main() {","    highp float age = getAge();","    highp float alive = getAlive();","    highp float maxAge = getMaxAge();","    highp float positionInTime = (age / maxAge);","    highp float isAlive = when_gt( alive, 0.0 );","    #ifdef SHOULD_WIGGLE_PARTICLES","        float wiggleAmount = positionInTime * getWiggle();","        float wiggleSin = isAlive * sin( wiggleAmount );","        float wiggleCos = isAlive * cos( wiggleAmount );","    #endif","    vec3 vel = getVelocity( age );","    vec3 accel = getAcceleration( age );","    vec3 force = vec3( 0.0 );","    vec3 pos = vec3( position );","    float drag = 1.0 - (positionInTime * 0.5) * acceleration.w;","    force += vel;","    force *= drag;","    force += accel * age;","    pos += force;","    #ifdef SHOULD_WIGGLE_PARTICLES","        pos.x += wiggleSin;","        pos.y += wiggleCos;","        pos.z += wiggleSin;","    #endif","    #ifdef SHOULD_ROTATE_PARTICLES","        pos = getRotation( pos, positionInTime );","    #endif","    vec4 mvPosition = modelViewMatrix * vec4( pos, 1.0 );","    #ifdef SHOULD_TRAIL_PARTICLES","    float fTimeStep = trail.x * trail.z;","    fTrailSpeed = trail.y;","    for(int i = 0; i < 10; i++)","    {","       highp float age_i = age - float(i) * fTimeStep;","       highp float positionInTime_i = (age_i / maxAge);","       #ifdef SHOULD_WIGGLE_PARTICLES","           float wiggleAmount_i = positionInTime_i * getWiggle();","           float wiggleSin_i = isAlive * sin( wiggleAmount_i );","           float wiggleCos_i = isAlive * cos( wiggleAmount_i );","       #endif","       vec3 vel_i = getVelocity( age_i );","       vec3 accel_i = getAcceleration( age_i );","       vec3 force_i = vec3( 0.0 );","       vec3 pos_i = vec3( position );","       float drag_i = 1.0 - (positionInTime_i * 0.5) * acceleration.w;","       force_i += vel_i;","       force_i *= drag_i;","       force_i += accel_i * age_i;","       pos_i += force_i;","       #ifdef SHOULD_WIGGLE_PARTICLES","           pos_i.x += wiggleSin_i;","           pos_i.y += wiggleCos_i;","           pos_i.z += wiggleSin_i;","       #endif","       #ifdef SHOULD_ROTATE_PARTICLES","           pos_i = getRotation( pos_i, positionInTime_i );","       #endif","       vec4 mvPosition_i = projectionMatrix * modelViewMatrix * vec4( pos_i, 1.0 );","       if(i == 0) vec4Path_0 = mvPosition_i;","       if(i == 1) vec4Path_1 = mvPosition_i;","       if(i == 2) vec4Path_2 = mvPosition_i;","       if(i == 3) vec4Path_3 = mvPosition_i;","       if(i == 4) vec4Path_4 = mvPosition_i;","       if(i == 5) vec4Path_5 = mvPosition_i;","       if(i == 6) vec4Path_6 = mvPosition_i;","       if(i == 7) vec4Path_7 = mvPosition_i;","       if(i == 8) vec4Path_8 = mvPosition_i;","       if(i == 9) vec4Path_9 = mvPosition_i;","    }","    #endif","    highp float pointSize = getFloatOverLifetime( positionInTime, size ) * isAlive;","    #ifdef HAS_PERSPECTIVE","        float perspective = scale / length( mvPosition.xyz );","    #else","        float perspective = 1.0;","    #endif","    float pointSizePerspective = pointSize * perspective;","    #ifdef COLORIZE","       vec3 c = isAlive * getColorOverLifetime(","           positionInTime,","           unpackColor( color.x ),","           unpackColor( color.y ),","           unpackColor( color.z ),","           unpackColor( color.w )","       );","    #else","       vec3 c = vec3(1.0);","    #endif","    float o = isAlive * getFloatOverLifetime( positionInTime, opacity );","    vColor = vec4( c, o );","    //#ifdef SHOULD_ROTATE_TEXTURE","        vAngle = isAlive * getFloatOverLifetime( positionInTime, angle );","    //#endif","    #ifdef SHOULD_CALCULATE_SPRITE","        float framesX = textureAnimation.x;","        float framesY = textureAnimation.y;","        float loopCount = textureAnimation.w;","        float totalFrames = textureAnimation.z;","        float frameNumber = mod( (positionInTime * loopCount) * totalFrames, totalFrames );","        float column = floor(mod( frameNumber, framesX ));","        float row = floor( (frameNumber - column) / framesX );","        float columnNorm = column / framesX;","        float rowNorm = row / framesY;","        vSpriteSheet.x = 1.0 / framesX;","        vSpriteSheet.y = 1.0 / framesY;","        vSpriteSheet.z = columnNorm;","        vSpriteSheet.w = rowNorm;","    #endif","    gl_PointSize = pointSizePerspective;","    gl_Position = projectionMatrix * mvPosition;",THREE.ShaderChunk.logdepthbuf_vertex,THREE.ShaderChunk.fog_vertex,"}"].join("\n"),fragment:[SPE.shaderChunks.uniforms,THREE.ShaderChunk.common,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.logdepthbuf_pars_fragment,SPE.shaderChunks.varyings,SPE.shaderChunks.branchAvoidanceFunctions,"void main() {","    vec3 outgoingLight = vColor.xyz;","    ","    #ifdef ALPHATEST","       if ( vColor.w < float(ALPHATEST) ) discard;","    #endif",SPE.shaderChunks.rotateTexture,THREE.ShaderChunk.logdepthbuf_fragment,"    outgoingLight = vColor.xyz * rotatedTexture.xyz;","    gl_FragColor = vec4( outgoingLight.xyz, rotatedTexture.w * vColor.w );",THREE.ShaderChunk.fog_fragment,"}"].join("\n")},SPE.utils={types:{BOOLEAN:"boolean",STRING:"string",NUMBER:"number",OBJECT:"object"},ensureTypedArg:function(e,t,r){"use strict";return typeof e===t?e:r},ensureArrayTypedArg:function(e,t,r){"use strict";if(Array.isArray(e)){for(var i=e.length-1;i>=0;--i)if(typeof e[i]!==t)return r;return e}return this.ensureTypedArg(e,t,r)},ensureInstanceOf:function(e,t,r){"use strict";return void 0!==t&&e instanceof t?e:r},ensureArrayInstanceOf:function(e,t,r){"use strict";if(Array.isArray(e)){for(var i=e.length-1;i>=0;--i)if(void 0!==t&&e[i]instanceof t==!1)return r;return e}return this.ensureInstanceOf(e,t,r)},ensureValueOverLifetimeCompliance:function(e,t,r){"use strict";t=t||3,r=r||3,!1===Array.isArray(e._value)&&(e._value=[e._value]),!1===Array.isArray(e._spread)&&(e._spread=[e._spread]);var i=this.clamp(e._value.length,t,r),n=this.clamp(e._spread.length,t,r),o=Math.max(i,n);e._value.length!==o&&(e._value=this.interpolateArray(e._value,o)),e._spread.length!==o&&(e._spread=this.interpolateArray(e._spread,o))},interpolateArray:function(e,t){"use strict";for(var r=e.length,i=["function"==typeof e[0].clone?e[0].clone():e[0]],n=(r-1)/(t-1),o=1;o<t-1;++o){var a=o*n,s=Math.floor(a),l=Math.ceil(a),c=a-s;i[o]=this.lerpTypeAgnostic(e[s],e[l],c)}return i.push("function"==typeof e[r-1].clone?e[r-1].clone():e[r-1]),i},clamp:function(e,t,r){"use strict";return Math.max(t,Math.min(e,r))},zeroToEpsilon:function(e,t){"use strict";var r=e;return r=t?1e-5*Math.random()*10:1e-5,e<0&&e>-1e-5&&(r=-r),r},lerpTypeAgnostic:function(e,t,r){"use strict";var i,n=this.types;return typeof e==n.NUMBER&&typeof t==n.NUMBER?e+(t-e)*r:e instanceof THREE.Vector2&&t instanceof THREE.Vector2||typeof e.x==n.NUMBER&&typeof e.y==n.NUMBER&&null==e.z&&void 0==e.z&&typeof t.x==n.NUMBER&&typeof t.y==n.NUMBER&&null==t.z&&void 0==t.z?(e instanceof THREE.Vector2?i=e.clone():((i={}).x=e.x,i.y=e.y),i.x=this.lerp(e.x,t.x,r),i.y=this.lerp(e.y,t.y,r),i):e instanceof THREE.Vector3&&t instanceof THREE.Vector3||typeof e.x==n.NUMBER&&typeof e.y==n.NUMBER&&typeof e.z==n.NUMBER&&null==e.w&&void 0==e.w&&typeof t.x==n.NUMBER&&typeof t.y==n.NUMBER&&typeof t.z==n.NUMBER&&null==t.w&&void 0==t.w?(e instanceof THREE.Vector3?i=e.clone():((i={}).x=e.x,i.y=e.y,i.z=e.z),i.x=this.lerp(e.x,t.x,r),i.y=this.lerp(e.y,t.y,r),i.z=this.lerp(e.z,t.z,r),i):e instanceof THREE.Vector4&&t instanceof THREE.Vector4||typeof e.x==n.NUMBER&&typeof e.y==n.NUMBER&&typeof e.z==n.NUMBER&&typeof e.w==n.NUMBER&&typeof t.x==n.NUMBER&&typeof t.y==n.NUMBER&&typeof t.z==n.NUMBER&&typeof t.w==n.NUMBER?(e instanceof THREE.Vector4?i=e.clone():((i={}).x=e.x,i.y=e.y,i.z=e.z,i.w=e.w),i.x=this.lerp(e.x,t.x,r),i.y=this.lerp(e.y,t.y,r),i.z=this.lerp(e.z,t.z,r),i.w=this.lerp(e.w,t.w,r),i):e instanceof THREE.Color&&t instanceof THREE.Color||typeof e.r==n.NUMBER&&typeof e.g==n.NUMBER&&typeof e.b==n.NUMBER&&typeof t.r==n.NUMBER&&typeof t.g==n.NUMBER&&typeof t.b==n.NUMBER?(e instanceof THREE.Color?i=e.clone():((i={}).r=e.r,i.g=e.g,i.b=e.b),i.r=this.lerp(e.r,t.r,r),i.g=this.lerp(e.g,t.g,r),i.b=this.lerp(e.b,t.b,r),i):void console.warn("Invalid argument types, or argument types do not match:",e,t)},lerp:function(e,t,r){"use strict";return e+(t-e)*r},roundToNearestMultiple:function(e,t){"use strict";var r=0;return 0===t?e:0==(r=Math.abs(e)%t)?e:e<0?-(Math.abs(e)-r):e+t-r},arrayValuesAreEqual:function(e){"use strict";for(var t=0;t<e.length-1;++t)if(e[t]!==e[t+1])return!1;return!0},randomFloat:function(e,t){"use strict";return e+t*(Math.random()-.5)},randomVector3:function(e,t,r,i,n){"use strict";var o=r.x+(Math.random()*i.x-.5*i.x),a=r.y+(Math.random()*i.y-.5*i.y),s=r.z+(Math.random()*i.z-.5*i.z);n&&(o=.5*-n.x+this.roundToNearestMultiple(o,n.x),a=.5*-n.y+this.roundToNearestMultiple(a,n.y),s=.5*-n.z+this.roundToNearestMultiple(s,n.z)),e.typedArray.setVec3Components(t,o,a,s)},getRandomVector3:function(e,t,r){"use strict";var i=e.x+(Math.random()*t.x-.5*t.x),n=e.y+(Math.random()*t.y-.5*t.y),o=e.z+(Math.random()*t.z-.5*t.z);r&&(i=.5*-r.x+this.roundToNearestMultiple(i,r.x),n=.5*-r.y+this.roundToNearestMultiple(n,r.y),o=.5*-r.z+this.roundToNearestMultiple(o,r.z));return new THREE.Vector3(i,n,o)},randomColor:function(e,t,r,i){"use strict";var n=r.r+Math.random()*i.x,o=r.g+Math.random()*i.y,a=r.b+Math.random()*i.z;n=this.clamp(n,0,1),o=this.clamp(o,0,1),a=this.clamp(a,0,1),e.typedArray.setVec3Components(t,n,o,a)},randomColorAsHex:function(){"use strict";var e=new THREE.Color;return function(t,r,i,n){for(var o=i.length,a=[],s=0;s<o;++s){var l=n[s];e.copy(i[s]),e.r+=Math.random()*l.x-.5*l.x,e.g+=Math.random()*l.y-.5*l.y,e.b+=Math.random()*l.z-.5*l.z,e.r=this.clamp(e.r,0,1),e.g=this.clamp(e.g,0,1),e.b=this.clamp(e.b,0,1),a.push(e.getHex())}t.typedArray.setVec4Components(r,a[0],a[1],a[2],a[3])}}(),randomVector3OnSphere:function(e,t,r,i,n,o,a,s){"use strict";var l=2*Math.random()-1,c=6.2832*Math.random(),u=Math.sqrt(1-l*l),h=this.randomFloat(i,n),p=0,d=0,f=0;a&&(h=Math.round(h/a)*a),p=u*Math.cos(c)*h,d=u*Math.sin(c)*h,f=l*h,p*=o.x,d*=o.y,f*=o.z,p+=r.x,d+=r.y,f+=r.z,e.typedArray.setVec3Components(t,p,d,f)},seededRandom:function(e){var t=1e4*Math.sin(e);return t-(0|t)},randomVector3OnDisc:function(e,t,r,i,n,o,a){"use strict";var s=6.2832*Math.random(),l=Math.abs(this.randomFloat(i,n)),c=0,u=0,h=0;a&&(l=Math.round(l/a)*a),c=Math.cos(s)*l,u=Math.sin(s)*l,c*=o.x,u*=o.y,c+=r.x,u+=r.y,h+=r.z,e.typedArray.setVec3Components(t,c,u,h)},randomDirectionVector3OnSphere:function(){"use strict";var e=new THREE.Vector3;return function(t,r,i,n,o,a,s,l){e.copy(a),e.x-=i,e.y-=n,e.z-=o,e.normalize().multiplyScalar(-this.randomFloat(s,l)),t.typedArray.setVec3Components(r,e.x,e.y,e.z)}}(),directionVector3OnSphere:function(){"use strict";var e=new THREE.Vector3;return function(t,r,i,n,o,a,s,l,c,u){e.copy(a),e.x-=i,e.y-=n,e.z-=o,e.normalize().multiplyScalar(-this.randomFloat(s,l));var h=this.getRandomVector3(c,u);e.add(h),t.typedArray.setVec3Components(r,e.x,e.y,e.z)}}(),randomDirectionVector3OnDisc:function(){"use strict";var e=new THREE.Vector3;return function(t,r,i,n,o,a,s,l){e.copy(a),e.x-=i,e.y-=n,e.z-=o,e.normalize().multiplyScalar(-this.randomFloat(s,l)),t.typedArray.setVec3Components(r,e.x,e.y,0)}}(),getPackedRotationAxis:function(){"use strict";var e=new THREE.Vector3,t=new THREE.Vector3,r=new THREE.Color,i=new THREE.Vector3(1,1,1);return function(n,o){return e.copy(n).normalize(),t.copy(o).normalize(),e.x+=.5*-o.x+Math.random()*o.x,e.y+=.5*-o.y+Math.random()*o.y,e.z+=.5*-o.z+Math.random()*o.z,e.normalize().add(i).multiplyScalar(.5),r.setRGB(e.x,e.y,e.z),r.getHex()}}()},SPE.Group=function(e){"use strict";var t=SPE.utils,r=t.types;(e=t.ensureTypedArg(e,r.OBJECT,{})).texture=t.ensureTypedArg(e.texture,r.OBJECT,{}),this.uuid=THREE.Math.generateUUID(),this.fixedTimeStep=t.ensureTypedArg(e.fixedTimeStep,r.NUMBER,.016),null!=e.texture.frames&&void 0!=e.texture.frames&&(e.texture.frames.x=t.ensureTypedArg(e.texture.frames.x,r.NUMBER,1),e.texture.frames.y=t.ensureTypedArg(e.texture.frames.y,r.NUMBER,1)),this.texture=t.ensureInstanceOf(e.texture.value,THREE.Texture,null),this.textureFrames=t.ensureInstanceOf(new THREE.Vector2(e.texture.frames.x,e.texture.frames.y),THREE.Vector2,new THREE.Vector2(1,1)),this.textureFrameCount=t.ensureTypedArg(e.texture.frameCount,r.NUMBER,this.textureFrames.x*this.textureFrames.y),this.textureLoop=t.ensureTypedArg(e.texture.loop,r.NUMBER,1),this.textureFrames.max(new THREE.Vector2(1,1)),this.hasPerspective=t.ensureTypedArg(e.hasPerspective,r.BOOLEAN,!0),this.colorize=t.ensureTypedArg(e.colorize,r.BOOLEAN,!0),this.maxParticleCount=t.ensureTypedArg(e.maxParticleCount,r.NUMBER,null),this.vec4Quaternion=t.ensureInstanceOf(e.vec4Quaternion,THREE.Vector4,new THREE.Vector4(0,0,0,1)),this.vec4Quaternion=this.vec4Quaternion.normalize(),this.blending=t.ensureTypedArg(e.blending,r.NUMBER,THREE.AdditiveBlending),this.transparent=t.ensureTypedArg(e.transparent,r.BOOLEAN,!0),this.alphaTest=parseFloat(t.ensureTypedArg(e.alphaTest,r.NUMBER,0)),this.depthWrite=t.ensureTypedArg(e.depthWrite,r.BOOLEAN,!1),this.depthTest=t.ensureTypedArg(e.depthTest,r.BOOLEAN,!0),this.fog=t.ensureTypedArg(e.fog,r.BOOLEAN,!0),this.scale=t.ensureTypedArg(e.scale,r.NUMBER,300),this.emitters=[],this.emitterIDs=[],this._pool=[],this._poolCreationSettings=null,this._createNewWhenPoolEmpty=0,this._attributesNeedRefresh=!1,this._attributesNeedDynamicReset=!1,this.particleCount=0,this.uniforms={tex:{type:"t",value:this.texture},textureAnimation:{type:"v4",value:new THREE.Vector4(this.textureFrames.x,this.textureFrames.y,this.textureFrameCount,Math.max(Math.abs(this.textureLoop),1))},fogColor:{type:"c",value:null},fogNear:{type:"f",value:10},fogFar:{type:"f",value:200},fogDensity:{type:"f",value:.5},deltaTime:{type:"f",value:0},runTime:{type:"f",value:0},scale:{type:"f",value:this.scale}},this.defines={HAS_PERSPECTIVE:this.hasPerspective,COLORIZE:this.colorize,VALUE_OVER_LIFETIME_LENGTH:SPE.valueOverLifetimeLength,SHOULD_ROTATE_TEXTURE:!1,SHOULD_TRAIL_PARTICLES:!0,SHOULD_ROTATE_PARTICLES:!1,SHOULD_WIGGLE_PARTICLES:!1,SHOULD_CALCULATE_SPRITE:this.textureFrames.x>1||this.textureFrames.y>1},this.attributes={position:new SPE.ShaderAttribute("v3",!0),acceleration:new SPE.ShaderAttribute("v4",!0),velocity:new SPE.ShaderAttribute("v3",!0),rotation:new SPE.ShaderAttribute("v4",!0),rotationCenter:new SPE.ShaderAttribute("v3",!0),params:new SPE.ShaderAttribute("v4",!0),size:new SPE.ShaderAttribute("v4",!0),angle:new SPE.ShaderAttribute("v4",!0),color:new SPE.ShaderAttribute("v4",!0),opacity:new SPE.ShaderAttribute("v4",!0),trail:new SPE.ShaderAttribute("v4",!0)},this.attributeKeys=Object.keys(this.attributes),this.attributeCount=this.attributeKeys.length,this.material=new THREE.ShaderMaterial({uniforms:this.uniforms,vertexShader:SPE.shaders.vertex,fragmentShader:SPE.shaders.fragment,blending:this.blending,transparent:this.transparent,alphaTest:this.alphaTest,depthWrite:this.depthWrite,depthTest:this.depthTest,defines:this.defines,fog:this.fog}),this.geometry=new THREE.BufferGeometry,this.mesh=new THREE.Points(this.geometry,this.material),null===this.maxParticleCount&&console.warn("SPE.Group: No maxParticleCount specified. Adding emitters after rendering will probably cause errors.")},SPE.Group.constructor=SPE.Group,SPE.Group.prototype._updateDefines=function(){"use strict";var e,t=this.emitters,r=t.length-1,i=this.defines;for(r;r>=0;--r)e=t[r],i.SHOULD_CALCULATE_SPRITE||(i.SHOULD_ROTATE_TEXTURE=i.SHOULD_ROTATE_TEXTURE||!!Math.max(Math.max.apply(null,e.angle.value),Math.max.apply(null,e.angle.spread))),i.SHOULD_ROTATE_PARTICLES=i.SHOULD_ROTATE_PARTICLES||!!Math.max(e.rotation.angle,e.rotation.angleSpread),i.SHOULD_WIGGLE_PARTICLES=i.SHOULD_WIGGLE_PARTICLES||!!Math.max(e.wiggle.value,e.wiggle.spread),i.SHOULD_TRAIL_PARTICLES=i.SHOULD_TRAIL_PARTICLES||!!Math.max(e.trail.value,e.trail.spread);this.material.needsUpdate=!0},SPE.Group.prototype._applyAttributesToGeometry=function(){"use strict";var e,t,r=this.attributes,i=this.geometry,n=i.attributes;for(var o in r)r.hasOwnProperty(o)&&(e=r[o],(t=n[o])?t.array=e.typedArray.array:i.addAttribute(o,e.bufferAttribute),e.bufferAttribute.needsUpdate=!0);this.geometry.setDrawRange(0,this.particleCount)},SPE.Group.prototype.addEmitter=function(e){"use strict";if(e instanceof SPE.Emitter!=!1)if(this.emitterIDs.indexOf(e.uuid)>-1)console.error("Emitter already exists in this group. Will not add again.");else{if(null===e.group){var t=this.attributes,r=this.particleCount,i=r+e.particleCount;this.particleCount=i,null!==this.maxParticleCount&&this.particleCount>this.maxParticleCount&&console.warn("SPE.Group: maxParticleCount exceeded. Requesting",this.particleCount,"particles, can support only",this.maxParticleCount),e._calculatePPSValue(e.maxAge._value+e.maxAge._spread),e._setBufferUpdateRanges(this.attributeKeys),e._setAttributeOffset(r),e.group=this,e.attributes=this.attributes;for(var n in t)t.hasOwnProperty(n)&&t[n]._createBufferAttribute(null!==this.maxParticleCount?this.maxParticleCount:this.particleCount);for(var o=r;o<i;++o)e._assignPositionValue(o),e._assignForceValue(o,"velocity"),e._assignAccForceValue(o,"acceleration"),e._assignAbsLifetimeValue(o,"opacity"),e._assignAbsLifetimeValue(o,"size"),e._assignAngleValue(o),e._assignRotationValue(o),e._assignParamsValue(o),e._assignColorValue(o),e._assignTrailValue(o);return this._applyAttributesToGeometry(),this.emitters.push(e),this.emitterIDs.push(e.uuid),this._updateDefines(e),this.material.needsUpdate=!0,this.geometry.needsUpdate=!0,this._attributesNeedRefresh=!0,this}console.error("Emitter already belongs to another group. Will not add to requested group.")}else console.error("`emitter` argument must be instance of SPE.Emitter. Was provided with:",e)},SPE.Group.prototype.removeEmitter=function(e){"use strict";var t=this.emitterIDs.indexOf(e.uuid);if(e instanceof SPE.Emitter!=!1)if(-1!==t){for(var r=e.attributeOffset,i=r+e.particleCount,n=this.attributes.params.typedArray,o=r;o<i;++o)n.array[4*o]=0,n.array[4*o+1]=0;this.emitters.splice(t,1),this.emitterIDs.splice(t,1);for(var a in this.attributes)this.attributes.hasOwnProperty(a)&&this.attributes[a].splice(r,i);this.particleCount-=e.particleCount,e._onRemove(),this._attributesNeedRefresh=!0}else console.error("Emitter does not exist in this group. Will not remove.");else console.error("`emitter` argument must be instance of SPE.Emitter. Was provided with:",e)},SPE.Group.prototype.getFromPool=function(){"use strict";var e=this._pool,t=this._createNewWhenPoolEmpty;if(e.length)return e.pop();if(t){var r=new SPE.Emitter(this._poolCreationSettings);return this.addEmitter(r),r}return null},SPE.Group.prototype.releaseIntoPool=function(e){"use strict";{if(e instanceof SPE.Emitter!=!1)return e.reset(),this._pool.unshift(e),this;console.error("Argument is not instanceof SPE.Emitter:",e)}},SPE.Group.prototype.getPool=function(){"use strict";return this._pool},SPE.Group.prototype.addPool=function(e,t,r){"use strict";var i;this._poolCreationSettings=t,this._createNewWhenPoolEmpty=!!r;for(var n=0;n<e;++n)i=Array.isArray(t)?new SPE.Emitter(t[n]):new SPE.Emitter(t),this.addEmitter(i),this.releaseIntoPool(i);return this},SPE.Group.prototype._triggerSingleEmitter=function(e){"use strict";var t=this.getFromPool(),r=this;{if(null!==t)return e instanceof THREE.Vector3&&(t.position.value.copy(e),t.position.value=t.position.value),t.enable(),setTimeout(function(){t.disable(),r.releaseIntoPool(t)},1e3*Math.max(t.duration,t.maxAge.value+t.maxAge.spread)),this;console.log("SPE.Group pool ran out.")}},SPE.Group.prototype.triggerPoolEmitter=function(e,t){"use strict";if("number"==typeof e&&e>1)for(var r=0;r<e;++r)this._triggerSingleEmitter(t);else this._triggerSingleEmitter(t);return this},SPE.Group.prototype._updateUniforms=function(e){"use strict";this.uniforms.runTime.value+=e,this.uniforms.deltaTime.value=e},SPE.Group.prototype._resetBufferRanges=function(){"use strict";var e=this.attributeKeys,t=this.attributeCount-1,r=this.attributes;for(t;t>=0;--t)r[e[t]].resetUpdateRange()},SPE.Group.prototype._updateBuffers=function(e){"use strict";var t,r,i,n=this.attributeKeys,o=this.attributeCount-1,a=this.attributes,s=e.bufferUpdateRanges;for(o;o>=0;--o)r=s[t=n[o]],(i=a[t]).setUpdateRange(r.min,r.max),i.flagUpdate()},SPE.Group.prototype.tick=function(e){"use strict";var t=this.emitters,r=t.length,i=e||this.fixedTimeStep,n=this.attributeKeys,o=this.attributes;if(this._updateUniforms(i),this._resetBufferRanges(),0!==r||!1!==this._attributesNeedRefresh||!1!==this._attributesNeedDynamicReset){for(var a,s=0;s<r;++s)(a=t[s]).tick(i),this._updateBuffers(a);if(!0===this._attributesNeedDynamicReset){for(s=this.attributeCount-1;s>=0;--s)o[n[s]].resetDynamic();this._attributesNeedDynamicReset=!1}if(!0===this._attributesNeedRefresh){for(s=this.attributeCount-1;s>=0;--s)o[n[s]].forceUpdateAll();this._attributesNeedRefresh=!1,this._attributesNeedDynamicReset=!0}}},SPE.Group.prototype.dispose=function(){"use strict";return this.geometry.dispose(),this.material.dispose(),this},SPE.Emitter=function(e){"use strict";var t=SPE.utils,r=t.types,i=SPE.valueOverLifetimeLength;(e=t.ensureTypedArg(e,r.OBJECT,{})).position=t.ensureTypedArg(e.position,r.OBJECT,{}),e.velocity=t.ensureTypedArg(e.velocity,r.OBJECT,{}),e.acceleration=t.ensureTypedArg(e.acceleration,r.OBJECT,{}),e.radius=t.ensureTypedArg(e.radius,r.OBJECT,{}),e.drag=t.ensureTypedArg(e.drag,r.OBJECT,{}),e.rotation=t.ensureTypedArg(e.rotation,r.OBJECT,{}),e.color=t.ensureTypedArg(e.color,r.OBJECT,{}),e.opacity=t.ensureTypedArg(e.opacity,r.OBJECT,{}),e.size=t.ensureTypedArg(e.size,r.OBJECT,{}),e.angle=t.ensureTypedArg(e.angle,r.OBJECT,{}),e.wiggle=t.ensureTypedArg(e.wiggle,r.OBJECT,{}),e.trail=t.ensureTypedArg(e.trail,r.OBJECT,{}),e.maxAge=t.ensureTypedArg(e.maxAge,r.OBJECT,{}),e.onParticleSpawn&&console.warn("onParticleSpawn has been removed. Please set properties directly to alter values at runtime."),this.uuid=THREE.Math.generateUUID(),this.type=t.ensureTypedArg(e.type,r.NUMBER,SPE.distributions.BOX),this.position={_value:t.ensureInstanceOf(e.position.value,THREE.Vector3,new THREE.Vector3),_spread:t.ensureInstanceOf(e.position.spread,THREE.Vector3,new THREE.Vector3),_spreadClamp:t.ensureInstanceOf(e.position.spreadClamp,THREE.Vector3,new THREE.Vector3),_distribution:t.ensureTypedArg(e.position.distribution,r.NUMBER,this.type),_randomise:t.ensureTypedArg(e.position.randomise,r.BOOLEAN,!1),_radius:t.ensureTypedArg(e.position.radius,r.NUMBER,10),_radiusScale:t.ensureInstanceOf(e.position.radiusScale,THREE.Vector3,new THREE.Vector3(1,1,1)),_distributionClamp:t.ensureTypedArg(e.position.distributionClamp,r.NUMBER,0)},this.velocity={_value:t.ensureInstanceOf(e.velocity.value,THREE.Vector3,new THREE.Vector3),_spread:t.ensureInstanceOf(e.velocity.spread,THREE.Vector3,new THREE.Vector3),_distribution:t.ensureTypedArg(e.velocity.distribution,r.NUMBER,this.type),_randomise:t.ensureTypedArg(e.position.randomise,r.BOOLEAN,!1)},this.acceleration={_value:t.ensureInstanceOf(e.acceleration.value,THREE.Vector3,new THREE.Vector3),_spread:t.ensureInstanceOf(e.acceleration.spread,THREE.Vector3,new THREE.Vector3),_distribution:t.ensureTypedArg(e.acceleration.distribution,r.NUMBER,this.type),_randomise:t.ensureTypedArg(e.position.randomise,r.BOOLEAN,!1)},this.drag={_value:t.ensureTypedArg(e.drag.value,r.NUMBER,0),_spread:t.ensureTypedArg(e.drag.spread,r.NUMBER,0),_randomise:t.ensureTypedArg(e.position.randomise,r.BOOLEAN,!1)},this.wiggle={_value:t.ensureTypedArg(e.wiggle.value,r.NUMBER,0),_spread:t.ensureTypedArg(e.wiggle.spread,r.NUMBER,0)},this.rotation={_axis:t.ensureInstanceOf(e.rotation.axis,THREE.Vector3,new THREE.Vector3(0,1,0)),_axisSpread:t.ensureInstanceOf(e.rotation.axisSpread,THREE.Vector3,new THREE.Vector3),_angle:t.ensureTypedArg(e.rotation.angle,r.NUMBER,0),_angleSpread:t.ensureTypedArg(e.rotation.angleSpread,r.NUMBER,0),_static:t.ensureTypedArg(e.rotation.static,r.BOOLEAN,!1),_center:t.ensureInstanceOf(e.rotation.center,THREE.Vector3,this.position._value.clone()),_randomise:t.ensureTypedArg(e.position.randomise,r.BOOLEAN,!1)},this.maxAge={_value:t.ensureTypedArg(e.maxAge.value,r.NUMBER,2),_spread:t.ensureTypedArg(e.maxAge.spread,r.NUMBER,0)},this.color={_value:t.ensureArrayInstanceOf(e.color.value,THREE.Color,new THREE.Color),_spread:t.ensureArrayInstanceOf(e.color.spread,THREE.Vector3,new THREE.Vector3),_randomise:t.ensureTypedArg(e.position.randomise,r.BOOLEAN,!1)},this.opacity={_value:t.ensureArrayTypedArg(e.opacity.value,r.NUMBER,1),_spread:t.ensureArrayTypedArg(e.opacity.spread,r.NUMBER,0),_randomise:t.ensureTypedArg(e.position.randomise,r.BOOLEAN,!1)},this.size={_value:t.ensureArrayTypedArg(e.size.value,r.NUMBER,1),_spread:t.ensureArrayTypedArg(e.size.spread,r.NUMBER,0),_randomise:t.ensureTypedArg(e.position.randomise,r.BOOLEAN,!1)},this.angle={_value:t.ensureArrayTypedArg(e.angle.value,r.NUMBER,0),_spread:t.ensureArrayTypedArg(e.angle.spread,r.NUMBER,0),_randomise:t.ensureTypedArg(e.position.randomise,r.BOOLEAN,!1)},this.bInitSpeed=!1,this.bInitSpeedAcc=!1,this.particleCount=t.ensureTypedArg(e.particleCount,r.NUMBER,100),this.duration=t.ensureTypedArg(e.duration,r.NUMBER,null),this.isStatic=t.ensureTypedArg(e.isStatic,r.BOOLEAN,!1),this.activeMultiplier=t.ensureTypedArg(e.activeMultiplier,r.NUMBER,1),this.direction=t.ensureTypedArg(e.direction,r.NUMBER,1),this.trail={_value:t.ensureArrayTypedArg(e.trail.value,r.NUMBER,0),_spread:t.ensureArrayTypedArg(e.trail.spread,r.NUMBER,0),_step:t.ensureArrayTypedArg(e.trail.step,r.NUMBER,0),_stepSpread:t.ensureArrayTypedArg(e.trail.stepSpread,r.NUMBER,0),_direction:t.ensureArrayTypedArg(e.trail.direction,r.NUMBER,-1*this.direction)},this.alive=t.ensureTypedArg(e.alive,r.BOOLEAN,!0),this.particlesPerSecond=0,this.activationIndex=0,this.attributeOffset=0,this.attributeEnd=0,this.age=0,this.activeParticleCount=0,this.group=null,this.attributes=null,this.paramsArray=null,this.resetFlags={position:t.ensureTypedArg(e.position.randomise,r.BOOLEAN,!1)||t.ensureTypedArg(e.radius.randomise,r.BOOLEAN,!1),velocity:t.ensureTypedArg(e.velocity.randomise,r.BOOLEAN,!1),acceleration:t.ensureTypedArg(e.acceleration.randomise,r.BOOLEAN,!1)||t.ensureTypedArg(e.drag.randomise,r.BOOLEAN,!1),rotation:t.ensureTypedArg(e.rotation.randomise,r.BOOLEAN,!1),rotationCenter:t.ensureTypedArg(e.rotation.randomise,r.BOOLEAN,!1),size:t.ensureTypedArg(e.size.randomise,r.BOOLEAN,!1),color:t.ensureTypedArg(e.color.randomise,r.BOOLEAN,!1),opacity:t.ensureTypedArg(e.opacity.randomise,r.BOOLEAN,!1),angle:t.ensureTypedArg(e.angle.randomise,r.BOOLEAN,!1)},this.updateFlags={},this.updateCounts={},this.updateMap={maxAge:"params",position:"position",velocity:"velocity",acceleration:"acceleration",drag:"acceleration",wiggle:"params",rotation:"rotation",size:"size",color:"color",opacity:"opacity",angle:"angle",trail:"trail"};for(var n in this.updateMap)this.updateMap.hasOwnProperty(n)&&(this.updateCounts[this.updateMap[n]]=0,this.updateFlags[this.updateMap[n]]=!1,this._createGetterSetters(this[n],n));this.bufferUpdateRanges={},this.attributeKeys=null,this.attributeCount=0,t.ensureValueOverLifetimeCompliance(this.color,i,i),t.ensureValueOverLifetimeCompliance(this.opacity,i,i),t.ensureValueOverLifetimeCompliance(this.size,i,i),t.ensureValueOverLifetimeCompliance(this.angle,i,i)},SPE.Emitter.constructor=SPE.Emitter,SPE.Emitter.prototype._createGetterSetters=function(e,t){"use strict";var r=this;for(var i in e)if(e.hasOwnProperty(i)){var n=i.replace("_","");Object.defineProperty(e,n,{get:function(e){return function(){return this[e]}}(i),set:function(e){return function(i){var n=r.updateMap[t],o=this[e],a=SPE.valueOverLifetimeLength;"_rotationCenter"===e?(r.updateFlags.rotationCenter=!0,r.updateCounts.rotationCenter=0):"_randomise"===e?r.resetFlags[n]=i:(r.updateFlags[n]=!0,r.updateCounts[n]=0),r.group._updateDefines(),this[e]=i,Array.isArray(o)&&SPE.utils.ensureValueOverLifetimeCompliance(r[t],a,a)}}(i)})}},SPE.Emitter.prototype._setBufferUpdateRanges=function(e){"use strict";this.attributeKeys=e,this.attributeCount=e.length;for(var t=this.attributeCount-1;t>=0;--t)this.bufferUpdateRanges[e[t]]={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY}},SPE.Emitter.prototype._calculatePPSValue=function(e){"use strict";var t=this.particleCount;this.duration?this.particlesPerSecond=t/(e<this.duration?e:this.duration):this.particlesPerSecond=t/e},SPE.Emitter.prototype._setAttributeOffset=function(e){this.attributeOffset=e,this.activationIndex=e,this.activationEnd=e+this.particleCount},SPE.Emitter.prototype._assignValue=function(e,t){"use strict";switch(e){case"position":this._assignPositionValue(t);break;case"velocity":this._assignForceValue(t,e);break;case"acceleration":this._assignAccForceValue(t,e);break;case"size":case"opacity":this._assignAbsLifetimeValue(t,e);break;case"angle":this._assignAngleValue(t);break;case"params":this._assignParamsValue(t);break;case"rotation":this._assignRotationValue(t);break;case"color":this._assignColorValue(t);break;case"trail":this._assignTrailValue(t)}},SPE.Emitter.prototype._assignPositionValue=function(e){"use strict";var t=SPE.distributions,r=SPE.utils,i=this.position,n=this.attributes.position,o=i._value,a=i._spread;switch(i._distribution){case t.BOX:r.randomVector3(n,e,o,a,i._spreadClamp);break;case t.SPHERE:r.randomVector3OnSphere(n,e,o,i._radius,i._spread.x,i._radiusScale,i._spreadClamp.x,i._distributionClamp||this.particleCount);break;case t.DISC:r.randomVector3OnDisc(n,e,o,i._radius,i._spread.x,i._radiusScale,i._spreadClamp.x)}},SPE.Emitter.prototype._assignTrailValue=function(e){"use strict";this.attributes.trail.typedArray.setVec4Components(e,this.trail._direction,SPE.utils.randomFloat(this.trail._value,this.trail._spread),SPE.utils.randomFloat(this.trail._step,this.trail._stepSpread))},SPE.Emitter.prototype._assignForceValue=function(e,t){"use strict";var r=this.group.vec4Quaternion.clone();r=r.normalize();var i,n,o,a,s,l=SPE.distributions,c=SPE.utils,u=this[t],h=u._value,p=u._spread,d=u._distribution;switch(this.bInitSpeed||(h=h.applyQuaternion(r),p=p.applyQuaternion(r),this.bInitSpeed=!0),d){case l.BOX:c.randomVector3(this.attributes[t],e,h,p);break;case l.SPHERE:n=(i=this.attributes.position.typedArray.array)[s=3*e],o=i[s+1],a=i[s+2],c.randomDirectionVector3OnSphere(this.attributes[t],e,n,o,a,this.position._value,u._value.x,u._spread.x);break;case l.DISC:n=(i=this.attributes.position.typedArray.array)[s=3*e],o=i[s+1],a=i[s+2],c.randomDirectionVector3OnDisc(this.attributes[t],e,n,o,a,this.position._value,u._value.x,u._spread.x)}if("acceleration"===t){var f=c.clamp(c.randomFloat(this.drag._value,this.drag._spread),0,2);this.attributes.acceleration.typedArray.array[4*e+3]=f}},SPE.Emitter.prototype._assignAccForceValue=function(e,t){"use strict";var r=this.group.vec4Quaternion.clone();r=r.normalize();var i,n,o,a,s,l=SPE.distributions,c=SPE.utils,u=this[t],h=this.velocity,p=u._value,d=u._spread,f=u._distribution;switch(this.bInitSpeedAcc||(p=p.applyQuaternion(r),d=d.applyQuaternion(r),this.bInitSpeedAcc=!0),f){case l.BOX:c.randomVector3(this.attributes[t],e,p,d);break;case l.SPHERE:n=(i=this.attributes.position.typedArray.array)[s=3*e],o=i[s+1],a=i[s+2],c.directionVector3OnSphere(this.attributes[t],e,n,o,a,this.position._value,h._value.y,h._spread.y,u._value,u._spread);break;case l.DISC:n=(i=this.attributes.position.typedArray.array)[s=3*e],o=i[s+1],a=i[s+2],c.randomDirectionVector3OnDisc(this.attributes[t],e,n,o,a,this.position._value,u._value.x,u._spread.x)}if("acceleration"===t){var m=c.clamp(c.randomFloat(this.drag._value,this.drag._spread),0,2);this.attributes.acceleration.typedArray.array[4*e+3]=m}},SPE.Emitter.prototype._assignAbsLifetimeValue=function(e,t){"use strict";var r,i=this.attributes[t].typedArray,n=this[t],o=SPE.utils;o.arrayValuesAreEqual(n._value)&&o.arrayValuesAreEqual(n._spread)?(r=Math.abs(o.randomFloat(n._value[0],n._spread[0])),i.setVec4Components(e,r,r,r,r)):i.setVec4Components(e,Math.abs(o.randomFloat(n._value[0],n._spread[0])),Math.abs(o.randomFloat(n._value[1],n._spread[1])),Math.abs(o.randomFloat(n._value[2],n._spread[2])),Math.abs(o.randomFloat(n._value[3],n._spread[3])))},SPE.Emitter.prototype._assignAngleValue=function(e){"use strict";var t,r=this.attributes.angle.typedArray,i=this.angle,n=SPE.utils;n.arrayValuesAreEqual(i._value)&&n.arrayValuesAreEqual(i._spread)?(t=n.randomFloat(i._value[0],i._spread[0]),r.setVec4Components(e,t,t,t,t)):r.setVec4Components(e,n.randomFloat(i._value[0],i._spread[0]),n.randomFloat(i._value[1],i._spread[1]),n.randomFloat(i._value[2],i._spread[2]),n.randomFloat(i._value[3],i._spread[3]))},SPE.Emitter.prototype._assignParamsValue=function(e){"use strict";this.attributes.params.typedArray.setVec4Components(e,this.isStatic?1:0,0,Math.abs(SPE.utils.randomFloat(this.maxAge._value,this.maxAge._spread)),SPE.utils.randomFloat(this.wiggle._value,this.wiggle._spread))},SPE.Emitter.prototype._assignRotationValue=function(e){"use strict";this.attributes.rotation.typedArray.setVec3Components(e,SPE.utils.getPackedRotationAxis(this.rotation._axis,this.rotation._axisSpread),SPE.utils.randomFloat(this.rotation._angle,this.rotation._angleSpread),this.rotation._static?0:1),this.attributes.rotationCenter.typedArray.setVec3(e,this.rotation._center)},SPE.Emitter.prototype._assignColorValue=function(e){"use strict";SPE.utils.randomColorAsHex(this.attributes.color,e,this.color._value,this.color._spread)},SPE.Emitter.prototype._resetParticle=function(e){"use strict";for(var t,r,i=this.resetFlags,n=this.updateFlags,o=this.updateCounts,a=this.attributeKeys,s=this.attributeCount-1;s>=0;--s)r=n[t=a[s]],!0!==i[t]&&!0!==r||(this._assignValue(t,e),this._updateAttributeUpdateRange(t,e),!0===r&&o[t]===this.particleCount?(n[t]=!1,o[t]=0):1==r&&++o[t])},SPE.Emitter.prototype._updateAttributeUpdateRange=function(e,t){"use strict";var r=this.bufferUpdateRanges[e];r.min=Math.min(t,r.min),r.max=Math.max(t,r.max)},SPE.Emitter.prototype._resetBufferRanges=function(){"use strict";var e,t=this.bufferUpdateRanges,r=this.bufferUpdateKeys,i=this.bufferUpdateCount-1;for(i;i>=0;--i)t[e=r[i]].min=Number.POSITIVE_INFINITY,t[e].max=Number.NEGATIVE_INFINITY},SPE.Emitter.prototype._onRemove=function(){"use strict";this.particlesPerSecond=0,this.attributeOffset=0,this.activationIndex=0,this.activeParticleCount=0,this.group=null,this.attributes=null,this.paramsArray=null,this.age=0},SPE.Emitter.prototype._decrementParticleCount=function(){"use strict";--this.activeParticleCount},SPE.Emitter.prototype._incrementParticleCount=function(){"use strict";++this.activeParticleCount},SPE.Emitter.prototype._checkParticleAges=function(e,t,r,i){"use strict";for(var n,o,a,s,l=t-1;l>=e;--l)0!==(s=r[n=4*l])&&(a=r[n+1],o=r[n+2],1===this.direction?(a+=i)>=o&&(a=0,s=0,this._decrementParticleCount()):(a-=i)<=0&&(a=o,s=0,this._decrementParticleCount()),r[n]=s,r[n+1]=a,this._updateAttributeUpdateRange("params",l))},SPE.Emitter.prototype._activateParticles=function(e,t,r,i){"use strict";for(var n,o,a=this.direction,s=e;s<t;++s)0!=r[n=4*s]&&1!==this.particleCount||(this._incrementParticleCount(),r[n]=1,this._resetParticle(s),o=i*(s-e),r[n+1]=-1===a?r[n+2]-o:o,this._updateAttributeUpdateRange("params",s))},SPE.Emitter.prototype.tick=function(e){"use strict";if(!this.isStatic){null===this.paramsArray&&(this.paramsArray=this.attributes.params.typedArray.array);var t=this.attributeOffset,r=t+this.particleCount,i=this.paramsArray,n=this.particlesPerSecond*this.activeMultiplier*e,o=this.activationIndex;if(this._resetBufferRanges(),this._checkParticleAges(t,r,i,e),!1!==this.alive){if(null!==this.duration&&this.age>this.duration)return this.alive=!1,void(this.age=0);var a=1===this.particleCount?o:0|o,s=Math.min(a+n,this.activationEnd),l=s-this.activationIndex|0,c=l>0?e/l:0;this._activateParticles(a,s,i,c),this.activationIndex+=n,this.activationIndex>r&&(this.activationIndex=t),this.age+=e}else this.age=0}},SPE.Emitter.prototype.reset=function(e){"use strict";if(this.age=0,this.alive=!1,!0===e){for(var t,r=this.attributeOffset,i=r+this.particleCount,n=this.paramsArray,o=this.attributes.params.bufferAttribute,a=i-1;a>=r;--a)n[t=4*a]=0,n[t+1]=0;o.updateRange.offset=0,o.updateRange.count=-1,o.needsUpdate=!0}return this},SPE.Emitter.prototype.enable=function(){"use strict";return this.alive=!0,this},SPE.Emitter.prototype.disable=function(){"use strict";return this.alive=!1,this},SPE.Emitter.prototype.remove=function(){"use strict";return null!==this.group?this.group.removeEmitter(this):console.error("Emitter does not belong to a group, cannot remove."),this},function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.Stats=t()}(this,function(){var e=function(){function t(e){return n.appendChild(e.dom),e}function r(e){for(var t=0;t<n.children.length;t++)n.children[t].style.display=t===e?"block":"none";i=e}var i=0,n=document.createElement("div");n.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",n.addEventListener("click",function(e){e.preventDefault(),r(++i%n.children.length)},!1);var o=(performance||Date).now(),a=o,s=0,l=t(new e.Panel("FPS","#0ff","#002")),c=t(new e.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var u=t(new e.Panel("MB","#f08","#201"));return r(0),{REVISION:16,dom:n,addPanel:t,showPanel:r,begin:function(){o=(performance||Date).now()},end:function(){s++;var e=(performance||Date).now();if(c.update(e-o,200),e>a+1e3&&(l.update(1e3*s/(e-a),100),a=e,s=0,u)){var t=performance.memory;u.update(t.usedJSHeapSize/1048576,t.jsHeapSizeLimit/1048576)}return e},update:function(){o=this.end()},domElement:n,setMode:r}};return e.Panel=function(e,t,r){var i=1/0,n=0,o=Math.round,a=o(window.devicePixelRatio||1),s=80*a,l=48*a,c=3*a,u=2*a,h=3*a,p=15*a,d=74*a,f=30*a,m=document.createElement("canvas");m.width=s,m.height=l,m.style.cssText="width:80px;height:48px";var g=m.getContext("2d");return g.font="bold "+9*a+"px Helvetica,Arial,sans-serif",g.textBaseline="top",g.fillStyle=r,g.fillRect(0,0,s,l),g.fillStyle=t,g.fillText(e,c,u),g.fillRect(h,p,d,f),g.fillStyle=r,g.globalAlpha=.9,g.fillRect(h,p,d,f),{dom:m,update:function(l,v){i=Math.min(i,l),n=Math.max(n,l),g.fillStyle=r,g.globalAlpha=1,g.fillRect(0,0,s,p),g.fillStyle=t,g.fillText(o(l)+" "+e+" ("+o(i)+"-"+o(n)+")",c,u),g.drawImage(m,h+a,p,d-a,f,h,p,d-a,f),g.fillRect(h+d-a,p,a,f),g.fillStyle=r,g.globalAlpha=.9,g.fillRect(h+d-a,p,a,o((1-l/v)*f))}}},e}),function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.thingjs={})}(this,function(e){"use strict";function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function n(e,t,r){return t&&i(e.prototype,t),r&&i(e,r),e}function o(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager,this.dracoLoader=null}function a(e){this.name=T.KHR_LIGHTS_PUNCTUAL;var t=e.extensions&&e.extensions[T.KHR_LIGHTS_PUNCTUAL]||{};this.lightDefs=t.lights||[]}function s(e){this.name=T.KHR_MATERIALS_UNLIT}function l(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=T.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,THREE.DRACOLoader.getDecoderModule()}function c(e){this.name=T.KHR_TEXTURE_TRANSFORM}function u(e,t,r,i){THREE.Interpolant.call(this,e,t,r,i)}function h(e,t){return"string"!=typeof e||""===e?"":/^(https?:)?\/\//i.test(e)?e:/^data:.*,.*$/i.test(e)?e:/^blob:.*$/i.test(e)?e:t+e}function p(){return new THREE.MeshStandardMaterial({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:THREE.FrontSide})}function d(e,t,r){for(var i in r.extensions)void 0===e[i]&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[i]=r.extensions[i])}function f(e,r){void 0!==r.extras&&("object"===t(r.extras)?e.userData=r.extras:console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+r.extras))}function m(e,t,r){for(var i=!1,n=!1,o=0,a=t.length;o<a;o++){if(void 0!==(c=t[o]).POSITION&&(i=!0),void 0!==c.NORMAL&&(n=!0),i&&n)break}if(!i&&!n)return Promise.resolve(e);for(var s=[],l=[],o=0,a=t.length;o<a;o++){var c=t[o];if(i){u=void 0!==c.POSITION?r.getDependency("accessor",c.POSITION).then(function(e){return x(e)}):e.attributes.position;s.push(u)}if(n){var u=void 0!==c.NORMAL?r.getDependency("accessor",c.NORMAL).then(function(e){return x(e)}):e.attributes.normal;l.push(u)}}return Promise.all([Promise.all(s),Promise.all(l)]).then(function(r){for(var o=r[0],a=r[1],s=0,l=t.length;s<l;s++){var c=t[s],u="morphTarget"+s;if(i&&void 0!==c.POSITION){var h=o[s];h.name=u;for(var p=e.attributes.position,d=0,f=h.count;d<f;d++)h.setXYZ(d,h.getX(d)+p.getX(d),h.getY(d)+p.getY(d),h.getZ(d)+p.getZ(d))}if(n&&void 0!==c.NORMAL){var m=a[s];m.name=u;for(var g=e.attributes.normal,d=0,f=m.count;d<f;d++)m.setXYZ(d,m.getX(d)+g.getX(d),m.getY(d)+g.getY(d),m.getZ(d)+g.getZ(d))}}return i&&(e.morphAttributes.position=o),n&&(e.morphAttributes.normal=a),e})}function g(e,t){if(e.updateMorphTargets(),void 0!==t.weights)for(var r=0,i=t.weights.length;r<i;r++)e.morphTargetInfluences[r]=t.weights[r];if(t.extras&&Array.isArray(t.extras.targetNames)){var n=t.extras.targetNames;if(e.morphTargetInfluences.length===n.length){e.morphTargetDictionary={};for(var r=0,i=n.length;r<i;r++)e.morphTargetDictionary[n[r]]=r}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function v(e,t){var r=e.extensions?e.extensions[T.KHR_DRACO_MESH_COMPRESSION]:void 0,i=t.extensions?t.extensions[T.KHR_DRACO_MESH_COMPRESSION]:void 0;return r&&i?r.bufferView===i.bufferView&&y(r.attributes,i.attributes):e.indices===t.indices&&y(e.attributes,t.attributes)}function y(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(var r in e)if(e[r]!==t[r])return!1;return!0}function E(e,t){if(e.length!==t.length)return!1;for(var r=0,i=e.length;r<i;r++)if(e[r]!==t[r])return!1;return!0}function b(e,t){for(var r=0,i=e.length;r<i;r++){var n=e[r];if(v(n.primitive,t))return n.promise}return null}function x(e){if(e.isInterleavedBufferAttribute){for(var t=e.count,r=e.itemSize,i=e.array.slice(0,t*r),n=0;n<t;++n)i[n]=e.getX(n),r>=2&&(i[n+1]=e.getY(n)),r>=3&&(i[n+2]=e.getZ(n)),r>=4&&(i[n+3]=e.getW(n));return new THREE.BufferAttribute(i,r,e.normalized)}return e.clone()}function _(e,t,r){this.json=e||{},this.extensions=t||{},this.options=r||{},this.cache=new function(){var e={};return{get:function(t){return e[t]},add:function(t,r){e[t]=r},remove:function(t){delete e[t]},removeAll:function(){e={}}}},this.primitiveCache=[],this.multiplePrimitivesCache=[],this.multiPassGeometryCache=[],this.textureLoader=new THREE.TextureLoader(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.fileLoader=new THREE.FileLoader(this.options.manager),this.fileLoader.setResponseType("arraybuffer")}function w(e,t,r){function i(t,i){return r.getDependency("accessor",t).then(function(t){e.addAttribute(i,t)})}var n=t.attributes,o=[];for(var a in n){var s=H[a];s&&(s in e.attributes||o.push(i(n[a],s)))}if(void 0!==t.indices&&!e.index){var l=r.getDependency("accessor",t.indices).then(function(t){e.setIndex(t)});o.push(l)}return f(e,t),Promise.all(o).then(function(){return void 0!==t.targets?m(e,t.targets,r):e})}o.prototype={constructor:o,crossOrigin:"anonymous",load:function(e,t,r,i){var n,o=this;n=void 0!==this.resourcePath?this.resourcePath:void 0!==this.path?this.path:THREE.LoaderUtils.extractUrlBase(e),o.manager.itemStart(e);var a=function(t){i?i(t):console.error(t),o.manager.itemError(e),o.manager.itemEnd(e)},s=new THREE.FileLoader(o.manager);s.setPath(this.path),s.setResponseType("arraybuffer"),s.load(e,function(r){try{o.parse(r,n,function(r){t(r),o.manager.itemEnd(e)},a)}catch(e){a(e)}},r,a)},setCrossOrigin:function(e){return this.crossOrigin=e,this},setPath:function(e){return this.path=e,this},setResourcePath:function(e){return this.resourcePath=e,this},setDRACOLoader:function(e){return this.dracoLoader=e,this},parse:function(e,t,r,i){var n,o={};if("string"==typeof e)n=e;else{if(THREE.LoaderUtils.decodeText(new Uint8Array(e,0,4))===M){try{o[T.KHR_BINARY_GLTF]=new function(e){this.name=T.KHR_BINARY_GLTF,this.content=null,this.body=null;var t=new DataView(e,0,R);if(this.header={magic:THREE.LoaderUtils.decodeText(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==M)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected. Use LegacyGLTFLoader instead.");for(var r=new DataView(e,R),i=0;i<r.byteLength;){var n=r.getUint32(i,!0);i+=4;var o=r.getUint32(i,!0);if(i+=4,o===S.JSON){var a=new Uint8Array(e,R+i,n);this.content=THREE.LoaderUtils.decodeText(a)}else if(o===S.BIN){var s=R+i;this.body=e.slice(s,s+n)}i+=n}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}(e)}catch(e){return void(i&&i(e))}n=o[T.KHR_BINARY_GLTF].content}else n=THREE.LoaderUtils.decodeText(new Uint8Array(e))}var u=JSON.parseX(n,this);if(void 0===u.asset||u.asset.version[0]<2)i&&i(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported. Use LegacyGLTFLoader instead."));else{if(u.extensionsUsed)for(var h=0;h<u.extensionsUsed.length;++h){var p=u.extensionsUsed[h],f=u.extensionsRequired||[];switch(p){case T.KHR_LIGHTS_PUNCTUAL:o[p]=new a(u);break;case T.KHR_MATERIALS_UNLIT:o[p]=new s(u);break;case T.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:o[p]=new function(){return{name:T.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,specularGlossinessParams:["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity","refractionRatio"],getMaterialType:function(){return THREE.ShaderMaterial},extendParams:function(e,t,r){var i=t.extensions[this.name],n=THREE.ShaderLib.standard,o=THREE.UniformsUtils.clone(n.uniforms),a=["#ifdef USE_SPECULARMAP","\tuniform sampler2D specularMap;","#endif"].join("\n"),s=["#ifdef USE_GLOSSINESSMAP","\tuniform sampler2D glossinessMap;","#endif"].join("\n"),l=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","\tvec4 texelSpecular = texture2D( specularMap, vUv );","\ttexelSpecular = sRGBToLinear( texelSpecular );","\t// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","\tspecularFactor *= texelSpecular.rgb;","#endif"].join("\n"),c=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","\tvec4 texelGlossiness = texture2D( glossinessMap, vUv );","\t// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","\tglossinessFactor *= texelGlossiness.a;","#endif"].join("\n"),u=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb;","material.specularRoughness = clamp( 1.0 - glossinessFactor, 0.04, 1.0 );","material.specularColor = specularFactor.rgb;"].join("\n"),h=n.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",a).replace("#include <metalnessmap_pars_fragment>",s).replace("#include <roughnessmap_fragment>",l).replace("#include <metalnessmap_fragment>",c).replace("#include <lights_physical_fragment>",u);delete o.roughness,delete o.metalness,delete o.roughnessMap,delete o.metalnessMap,o.specular={value:(new THREE.Color).setHex(1118481)},o.glossiness={value:.5},o.specularMap={value:null},o.glossinessMap={value:null},e.vertexShader=n.vertexShader,e.fragmentShader=h,e.uniforms=o,e.defines={STANDARD:""},e.color=new THREE.Color(1,1,1),e.opacity=1;var p=[];if(Array.isArray(i.diffuseFactor)){var d=i.diffuseFactor;e.color.fromArray(d),e.opacity=d[3]}if(void 0!==i.diffuseTexture&&p.push(r.assignTexture(e,"map",i.diffuseTexture)),e.emissive=new THREE.Color(0,0,0),e.glossiness=void 0!==i.glossinessFactor?i.glossinessFactor:1,e.specular=new THREE.Color(1,1,1),Array.isArray(i.specularFactor)&&e.specular.fromArray(i.specularFactor),void 0!==i.specularGlossinessTexture){var f=i.specularGlossinessTexture;p.push(r.assignTexture(e,"glossinessMap",f)),p.push(r.assignTexture(e,"specularMap",f))}return Promise.all(p)},createMaterial:function(e){var t=new THREE.ShaderMaterial({defines:e.defines,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader,uniforms:e.uniforms,fog:!0,lights:!0,opacity:e.opacity,transparent:e.transparent});return t.isGLTFSpecularGlossinessMaterial=!0,t.color=e.color,t.map=void 0===e.map?null:e.map,t.lightMap=null,t.lightMapIntensity=1,t.aoMap=void 0===e.aoMap?null:e.aoMap,t.aoMapIntensity=1,t.emissive=e.emissive,t.emissiveIntensity=1,t.emissiveMap=void 0===e.emissiveMap?null:e.emissiveMap,t.bumpMap=void 0===e.bumpMap?null:e.bumpMap,t.bumpScale=1,t.normalMap=void 0===e.normalMap?null:e.normalMap,e.normalScale&&(t.normalScale=e.normalScale),t.displacementMap=null,t.displacementScale=1,t.displacementBias=0,t.specularMap=void 0===e.specularMap?null:e.specularMap,t.specular=e.specular,t.glossinessMap=void 0===e.glossinessMap?null:e.glossinessMap,t.glossiness=e.glossiness,t.alphaMap=null,t.envMap=void 0===e.envMap?null:e.envMap,t.envMapIntensity=1,t.refractionRatio=.98,t.extensions.derivatives=!0,t},cloneMaterial:function(e){var t=e.clone();t.isGLTFSpecularGlossinessMaterial=!0;for(var r=this.specularGlossinessParams,i=0,n=r.length;i<n;i++)t[r[i]]=e[r[i]];return t},refreshUniforms:function(e,t,r,i,n,o){if(!0===n.isGLTFSpecularGlossinessMaterial){var a=n.uniforms,s=n.defines;a.opacity.value=n.opacity,a.diffuse.value.copy(n.color),a.emissive.value.copy(n.emissive).multiplyScalar(n.emissiveIntensity),a.map.value=n.map,a.specularMap.value=n.specularMap,a.alphaMap.value=n.alphaMap,a.lightMap.value=n.lightMap,a.lightMapIntensity.value=n.lightMapIntensity,a.aoMap.value=n.aoMap,a.aoMapIntensity.value=n.aoMapIntensity;var l;n.map?l=n.map:n.specularMap?l=n.specularMap:n.displacementMap?l=n.displacementMap:n.normalMap?l=n.normalMap:n.bumpMap?l=n.bumpMap:n.glossinessMap?l=n.glossinessMap:n.alphaMap?l=n.alphaMap:n.emissiveMap&&(l=n.emissiveMap),void 0!==l&&(l.isWebGLRenderTarget&&(l=l.texture),!0===l.matrixAutoUpdate&&l.updateMatrix(),a.uvTransform.value.copy(l.matrix)),n.envMap&&(a.envMap.value=n.envMap,a.envMapIntensity.value=n.envMapIntensity,a.flipEnvMap.value=n.envMap.isCubeTexture?-1:1,a.reflectivity.value=n.reflectivity,a.refractionRatio.value=n.refractionRatio,a.maxMipLevel.value=e.properties.get(n.envMap).__maxMipLevel),a.specular.value.copy(n.specular),a.glossiness.value=n.glossiness,a.glossinessMap.value=n.glossinessMap,a.emissiveMap.value=n.emissiveMap,a.bumpMap.value=n.bumpMap,a.normalMap.value=n.normalMap,a.displacementMap.value=n.displacementMap,a.displacementScale.value=n.displacementScale,a.displacementBias.value=n.displacementBias,null!==a.glossinessMap.value&&void 0===s.USE_GLOSSINESSMAP&&(s.USE_GLOSSINESSMAP="",s.USE_ROUGHNESSMAP=""),null===a.glossinessMap.value&&void 0!==s.USE_GLOSSINESSMAP&&(delete s.USE_GLOSSINESSMAP,delete s.USE_ROUGHNESSMAP)}}}}(u);break;case T.KHR_DRACO_MESH_COMPRESSION:o[p]=new l(u,this.dracoLoader);break;case T.MSFT_TEXTURE_DDS:o[T.MSFT_TEXTURE_DDS]=new function(){if(!THREE.DDSLoader)throw new Error("THREE.GLTFLoader: Attempting to load .dds texture without importing THREE.DDSLoader");this.name=T.MSFT_TEXTURE_DDS,this.ddsLoader=new THREE.DDSLoader}(u);break;case T.KHR_TEXTURE_TRANSFORM:o[T.KHR_TEXTURE_TRANSFORM]=new c(u);break;default:f.indexOf(p)>=0&&console.warn('THREE.GLTFLoader: Unknown extension "'+p+'".')}}var m=new _(u,o,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,manager:this.manager});m.parse(function(e,t,i,n,a){m.getDependencies("material").then(function(s){var l={scene:e,scenes:t,cameras:i,animations:n,asset:a.asset,parser:m,userData:{},materials:s};d(o,l,a),r(l)})},i)}}};var T={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",MSFT_TEXTURE_DDS:"MSFT_texture_dds"};a.prototype.loadLight=function(e){var t,r=this.lightDefs[e],i=new THREE.Color(16777215);void 0!==r.color&&i.fromArray(r.color);var n=void 0!==r.range?r.range:0;switch(r.type){case"directional":(t=new THREE.DirectionalLight(i)).target.position.set(0,0,-1),t.add(t.target);break;case"point":(t=new THREE.PointLight(i)).distance=n;break;case"spot":(t=new THREE.SpotLight(i)).distance=n,r.spot=r.spot||{},r.spot.innerConeAngle=void 0!==r.spot.innerConeAngle?r.spot.innerConeAngle:0,r.spot.outerConeAngle=void 0!==r.spot.outerConeAngle?r.spot.outerConeAngle:Math.PI/4,t.angle=r.spot.outerConeAngle,t.penumbra=1-r.spot.innerConeAngle/r.spot.outerConeAngle,t.target.position.set(0,0,-1),t.add(t.target);break;default:throw new Error('THREE.GLTFLoader: Unexpected light type, "'+r.type+'".')}return t.decay=2,void 0!==r.intensity&&(t.intensity=r.intensity),t.name=r.name||"light_"+e,Promise.resolve(t)},s.prototype.getMaterialType=function(e){return THREE.MeshBasicMaterial},s.prototype.extendParams=function(e,t,r){var i=[];e.color=new THREE.Color(1,1,1),e.opacity=1;var n=t.pbrMetallicRoughness;if(n){if(Array.isArray(n.baseColorFactor)){var o=n.baseColorFactor;e.color.fromArray(o),e.opacity=o[3]}void 0!==n.baseColorTexture&&i.push(r.assignTexture(e,"map",n.baseColorTexture))}return Promise.all(i)};var M="glTF",R=12,S={JSON:1313821514,BIN:5130562};l.prototype.decodePrimitive=function(e,t){var r=this.json,i=this.dracoLoader,n=e.extensions[this.name].bufferView,o=e.extensions[this.name].attributes,a={},s={},l={};for(var c in o)c in H&&(a[H[c]]=o[c]);for(c in e.attributes)if(void 0!==H[c]&&void 0!==o[c]){var u=r.accessors[e.attributes[c]],h=A[u.componentType];l[H[c]]=h,s[H[c]]=!0===u.normalized}return t.getDependency("bufferView",n).then(function(e){return new Promise(function(t){i.decodeDracoFile(e,function(e){for(var r in e.attributes){var i=e.attributes[r],n=s[r];void 0!==n&&(i.normalized=n)}t(e)},a,l)})})},c.prototype.extendTexture=function(e,t){return e=e.clone(),void 0!==t.offset&&e.offset.fromArray(t.offset),void 0!==t.rotation&&(e.rotation=t.rotation),void 0!==t.scale&&e.repeat.fromArray(t.scale),void 0!==t.texCoord&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),e.needsUpdate=!0,e},(u.prototype=Object.create(THREE.Interpolant.prototype)).constructor=u,u.prototype.copySampleValue_=function(e){for(var t=this.resultBuffer,r=this.sampleValues,i=this.valueSize,n=e*i*3+i,o=0;o!==i;o++)t[o]=r[n+o];return t},u.prototype.beforeStart_=u.prototype.copySampleValue_,u.prototype.afterEnd_=u.prototype.copySampleValue_,u.prototype.interpolate_=function(e,t,r,i){for(var n=this.resultBuffer,o=this.sampleValues,a=this.valueSize,s=2*a,l=3*a,c=i-t,u=(r-t)/c,h=u*u,p=h*u,d=e*l,f=d-l,m=-2*p+3*h,g=p-h,v=1-m,y=g-h+u,E=0;E!==a;E++){var b=o[f+E+a],x=o[f+E+s]*c,_=o[d+E+a],w=o[d+E]*c;n[E]=v*b+y*x+m*_+g*w}return n};var P={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},A=(Number,THREE.Matrix3,THREE.Matrix4,THREE.Vector2,THREE.Vector3,THREE.Vector4,THREE.Texture,{5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array}),C={9728:THREE.NearestFilter,9729:THREE.LinearFilter,9984:THREE.NearestMipMapNearestFilter,9985:THREE.LinearMipMapNearestFilter,9986:THREE.NearestMipMapLinearFilter,9987:THREE.LinearMipMapLinearFilter},L={33071:THREE.ClampToEdgeWrapping,33648:THREE.MirroredRepeatWrapping,10497:THREE.RepeatWrapping},O=(THREE.BackSide,THREE.FrontSide,THREE.NeverDepth,THREE.LessDepth,THREE.EqualDepth,THREE.LessEqualDepth,THREE.GreaterEqualDepth,THREE.NotEqualDepth,THREE.GreaterEqualDepth,THREE.AlwaysDepth,THREE.AddEquation,THREE.SubtractEquation,THREE.ReverseSubtractEquation,THREE.ZeroFactor,THREE.OneFactor,THREE.SrcColorFactor,THREE.OneMinusSrcColorFactor,THREE.SrcAlphaFactor,THREE.OneMinusSrcAlphaFactor,THREE.DstAlphaFactor,THREE.OneMinusDstAlphaFactor,THREE.DstColorFactor,THREE.OneMinusDstColorFactor,THREE.SrcAlphaSaturateFactor,{SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16}),H={POSITION:"position",NORMAL:"normal",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",TEXCOORD_2:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},F={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},I={CUBICSPLINE:THREE.InterpolateSmooth,LINEAR:THREE.InterpolateLinear,STEP:THREE.InterpolateDiscrete},k={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"},D={"image/png":THREE.RGBAFormat,"image/jpeg":THREE.RGBFormat};_.prototype.parse=function(e,t){var r=this.json;this.cache.removeAll(),this.markDefs(),this.getMultiDependencies(["scene","animation","camera"]).then(function(t){var i=t.scenes||[],n=i[r.scene||0],o=t.animations||[],a=t.cameras||[];e(n,i,a,o,r)}).catch(t)},_.prototype.markDefs=function(){for(var e=this.json.nodes||[],t=this.json.skins||[],r=this.json.meshes||[],i={},n={},o=0,a=t.length;o<a;o++)for(var s=t[o].joints,l=0,c=s.length;l<c;l++)e[s[l]].isBone=!0;for(var u=0,h=e.length;u<h;u++){var p=e[u];void 0!==p.mesh&&(void 0===i[p.mesh]&&(i[p.mesh]=n[p.mesh]=0),i[p.mesh]++,void 0!==p.skin&&(r[p.mesh].isSkinnedMesh=!0))}this.json.meshReferences=i,this.json.meshUses=n},_.prototype.getDependency=function(e,t){var r=e+":"+t,i=this.cache.get(r);if(!i){switch(e){case"scene":i=this.loadScene(t);break;case"node":i=this.loadNode(t);break;case"mesh":i=this.loadMesh(t);break;case"accessor":i=this.loadAccessor(t);break;case"bufferView":i=this.loadBufferView(t);break;case"buffer":i=this.loadBuffer(t);break;case"material":i=this.loadMaterial(t);break;case"texture":i=this.loadTexture(t);break;case"skin":i=this.loadSkin(t);break;case"animation":i=this.loadAnimation(t);break;case"camera":i=this.loadCamera(t);break;case"light":i=this.extensions[T.KHR_LIGHTS_PUNCTUAL].loadLight(t);break;default:throw new Error("Unknown type: "+e)}this.cache.add(r,i)}return i},_.prototype.getDependencies=function(e){var t=this.cache.get(e);if(!t){var r=this,i=this.json[e+("mesh"===e?"es":"s")]||[];t=Promise.all(i.map(function(t,i){return r.getDependency(e,i)})),this.cache.add(e,t)}return t},_.prototype.getMultiDependencies=function(e){for(var t={},r=[],i=0,n=e.length;i<n;i++){var o=e[i],a=this.getDependencies(o);a=a.then(function(e,r){t[e]=r}.bind(this,o+("mesh"===o?"es":"s"))),r.push(a)}return Promise.all(r).then(function(){return t})},_.prototype.loadBuffer=function(e){var t=this.json.buffers[e],r=this.fileLoader;if(t.type&&"arraybuffer"!==t.type)throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(void 0===t.uri&&0===e)return Promise.resolve(this.extensions[T.KHR_BINARY_GLTF].body);var i=this.options;return new Promise(function(e,n){r.load(h(t.uri,i.path),e,void 0,function(){n(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})},_.prototype.loadBufferView=function(e){var t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(e){var r=t.byteLength||0,i=t.byteOffset||0;return e.slice(i,i+r)})},_.prototype.loadAccessor=function(e){var t=this,r=this.json,i=this.json.accessors[e];if(void 0===i.bufferView&&void 0===i.sparse)return Promise.resolve(null);var n=[];return void 0!==i.bufferView?n.push(this.getDependency("bufferView",i.bufferView)):n.push(null),void 0!==i.sparse&&(n.push(this.getDependency("bufferView",i.sparse.indices.bufferView)),n.push(this.getDependency("bufferView",i.sparse.values.bufferView))),Promise.all(n).then(function(e){var n,o,a=e[0],s=O[i.type],l=A[i.componentType],c=l.BYTES_PER_ELEMENT,u=c*s,h=i.byteOffset||0,p=void 0!==i.bufferView?r.bufferViews[i.bufferView].byteStride:void 0,d=!0===i.normalized;if(p&&p!==u){var f="InterleavedBuffer:"+i.bufferView+":"+i.componentType,m=t.cache.get(f);m||(n=new l(a),m=new THREE.InterleavedBuffer(n,p/c),t.cache.add(f,m)),o=new THREE.InterleavedBufferAttribute(m,s,h/c,d)}else n=null===a?new l(i.count*s):new l(a,h,i.count*s),o=new THREE.BufferAttribute(n,s,d);if(void 0!==i.sparse){var g=O.SCALAR,v=A[i.sparse.indices.componentType],y=i.sparse.indices.byteOffset||0,E=i.sparse.values.byteOffset||0,b=new v(e[1],y,i.sparse.count*g),x=new l(e[2],E,i.sparse.count*s);null!==a&&o.setArray(o.array.slice());for(var _=0,w=b.length;_<w;_++){var T=b[_];if(o.setX(T,x[_*s]),s>=2&&o.setY(T,x[_*s+1]),s>=3&&o.setZ(T,x[_*s+2]),s>=4&&o.setW(T,x[_*s+3]),s>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return o})},_.prototype.loadTexture=function(e){var t,r=this,i=this.json,n=this.options,o=this.textureLoader,a=window.URL||window.webkitURL,s=i.textures[e],l=s.extensions||{},c=(t=l[T.MSFT_TEXTURE_DDS]?i.images[l[T.MSFT_TEXTURE_DDS].source]:i.images[s.source]).uri,u=!1;return void 0!==t.bufferView&&(c=r.getDependency("bufferView",t.bufferView).then(function(e){u=!0;var r=new Blob([e],{type:t.mimeType});return c=a.createObjectURL(r)})),Promise.resolve(c).then(function(e){var t=THREE.Loader.Handlers.get(e);return t||(t=l[T.MSFT_TEXTURE_DDS]?r.extensions[T.MSFT_TEXTURE_DDS].ddsLoader:o),new Promise(function(r,i){t.load(h(e,n.path),r,void 0,i)})}).then(function(e){!0===u&&a.revokeObjectURL(c),e.flipY=!1,void 0!==s.name&&(e.name=s.name),t.mimeType in D&&(e.format=D[t.mimeType]);var r=(i.samplers||{})[s.sampler]||{};return e.magFilter=C[r.magFilter]||THREE.LinearFilter,e.minFilter=C[r.minFilter]||THREE.LinearMipMapLinearFilter,e.wrapS=L[r.wrapS]||THREE.RepeatWrapping,e.wrapT=L[r.wrapT]||THREE.RepeatWrapping,e})},_.prototype.assignTexture=function(e,t,r){var i=this;return this.getDependency("texture",r.index).then(function(n){if(i.extensions[T.KHR_TEXTURE_TRANSFORM]){var o=void 0!==r.extensions?r.extensions[T.KHR_TEXTURE_TRANSFORM]:void 0;o&&(n=i.extensions[T.KHR_TEXTURE_TRANSFORM].extendTexture(n,o))}e[t]=n})},_.prototype.loadMaterial=function(e){var t,r=this.json,i=this.extensions,n=r.materials[e],o={},a=n.extensions||{},s=[];if(a[T.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){var l=i[T.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];t=l.getMaterialType(n),s.push(l.extendParams(o,n,this))}else if(a[T.KHR_MATERIALS_UNLIT]){var c=i[T.KHR_MATERIALS_UNLIT];t=c.getMaterialType(n),s.push(c.extendParams(o,n,this))}else{t=THREE.MeshStandardMaterial;var u=n.pbrMetallicRoughness||{};if(o.color=new THREE.Color(1,1,1),o.opacity=1,Array.isArray(u.baseColorFactor)){var h=u.baseColorFactor;o.color.fromArray(h),o.opacity=h[3]}void 0!==u.baseColorTexture&&(s.push(this.assignTexture(o,"map",u.baseColorTexture)),1==u.baseColorTexture.texCoord&&(o.__useDiffuseUV2=!0)),o.metalness=void 0!==u.metallicFactor?u.metallicFactor:1,o.roughness=void 0!==u.roughnessFactor?u.roughnessFactor:1,void 0!==u.metallicRoughnessTexture&&(s.push(this.assignTexture(o,"metalnessMap",u.metallicRoughnessTexture)),s.push(this.assignTexture(o,"roughnessMap",u.metallicRoughnessTexture)))}!0===n.doubleSided&&(o.side=THREE.DoubleSide);var p=n.alphaMode||k.OPAQUE;p===k.BLEND?o.transparent=!0:(o.transparent=!1,p===k.MASK&&(o.alphaTest=void 0!==n.alphaCutoff?n.alphaCutoff:.5)),void 0!==n.normalTexture&&t!==THREE.MeshBasicMaterial&&(s.push(this.assignTexture(o,"normalMap",n.normalTexture)),o.normalScale=new THREE.Vector2(1,1),void 0!==n.normalTexture.scale&&o.normalScale.set(n.normalTexture.scale,n.normalTexture.scale)),void 0!==n.occlusionTexture&&t!==THREE.MeshBasicMaterial&&(s.push(this.assignTexture(o,"aoMap",n.occlusionTexture)),void 0!==n.occlusionTexture.strength&&(o.aoMapIntensity=n.occlusionTexture.strength)),void 0!==n.emissiveFactor&&t!==THREE.MeshBasicMaterial&&(o.emissive=(new THREE.Color).fromArray(n.emissiveFactor)),void 0!==n.emissiveTexture&&t!==THREE.MeshBasicMaterial&&s.push(this.assignTexture(o,"emissiveMap",n.emissiveTexture));var m=[],g=a.blend;if(g)for(var v=0;v<g.length;v++)g[v].maskTexture&&s.push(this.assignTexture(m,v,g[v].maskTexture));return Promise.all(s).then(function(){var e,r=o.__useDiffuseUV2;r&&delete o.__useDiffuseUV2,e=t===THREE.ShaderMaterial?i[T.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(o):new t(o),void 0!==n.name&&(e.name=n.name),e.normalScale&&(e.normalScale.y=-e.normalScale.y),e.map&&(e.map.encoding=THREE.sRGBEncoding),e.emissiveMap&&(e.emissiveMap.encoding=THREE.sRGBEncoding),e.specularMap&&(e.specularMap.encoding=THREE.sRGBEncoding),f(e,n),n.extensions&&d(i,e,n);for(var s in a)void 0===i[s]&&("sceneBlend"===s?(e.transparent=!0,e.blending=void 0===THREE[a[s]+"Blending"]?1:THREE[a[s]+"Blending"]):"blend"===s&&(e.__texture=m));var l=n.pbrMetallicRoughness.baseColorTexture,c=n.emissiveTexture,u=n.normalTexture;return void 0===e.userData.gltfExtensions&&(e.userData.gltfExtensions={}),l&&l.extensions&&(e.userData.gltfExtensions.baseColorTexture=l.extensions),c&&c.extensions&&(e.userData.gltfExtensions.emissiveTexture=c.extensions),u&&u.extensions&&(e.userData.gltfExtensions.normalTexture=u.extensions),r&&(e.userData.gltfExtensions.useDiffuseUV2=!0),e})},_.prototype.loadGeometries=function(e){function t(e){return n[T.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(e,i).then(function(t){return w(t,e,i)})}var r,i=this,n=this.extensions,o=this.primitiveCache,a=function(e){if(e.length<2)return!1;var t=e[0],r=t.targets||[];if(void 0===t.indices)return!1;for(var i=1,n=e.length;i<n;i++){var o=e[i];if(t.mode!==o.mode)return!1;if(void 0===o.indices)return!1;if(o.extensions&&o.extensions[T.KHR_DRACO_MESH_COMPRESSION])return!1;if(!y(t.attributes,o.attributes))return!1;var a=o.targets||[];if(r.length!==a.length)return!1;for(var s=0,l=r.length;s<l;s++)if(!y(r[s],a[s]))return!1}return!0}(e);a&&(r=e,e=[e[0]]);for(var s=[],l=0,c=e.length;l<c;l++){var u=e[l],h=b(o,u);if(h)s.push(h);else{var p;p=u.extensions&&u.extensions[T.KHR_DRACO_MESH_COMPRESSION]?t(u):w(new THREE.BufferGeometry,u,i),o.push({primitive:u,promise:p}),s.push(p)}}return Promise.all(s).then(function(t){if(t.forEach(function(e){var t=e.attributes.color;if(t&&4===t.itemSize){for(var r=t.count,i=new Float32Array(r),n=0;n<r;n++)i.set([t.getW(n)],n);var o=new THREE.BufferAttribute(i,1);e.addAttribute("alphaIndex",o)}}),a){var n=t[0];if(null!==(h=function(e,t,r){for(var i=0,n=e.length;i<n;i++){var o=e[i];if(t===o.baseGeometry&&E(r,o.primitives))return o.geometry}return null}(u=i.multiPassGeometryCache,n,r)))return[h.geometry];(p=new THREE.BufferGeometry).name=n.name,p.userData=n.userData;for(var o in n.attributes)p.addAttribute(o,n.attributes[o]);for(var o in n.morphAttributes)p.morphAttributes[o]=n.morphAttributes[o];for(var s=[],l=0,c=r.length;l<c;l++)s.push(i.getDependency("accessor",r[l].indices));return Promise.all(s).then(function(e){for(var t=[],i=0,o=0,a=r.length;o<a;o++){for(var s=e[o],l=0,c=s.count;l<c;l++)t.push(s.array[l]);p.addGroup(i,s.count,o),i+=s.count}return p.setIndex(t),u.push({geometry:p,baseGeometry:n,primitives:r}),[p]})}if(t.length>1&&void 0!==THREE.BufferGeometryUtils){for(var l=1,c=e.length;l<c;l++)if(e[0].mode!==e[l].mode)return t;var u=i.multiplePrimitivesCache,h=function(e,t){for(var r=0,i=e.length;r<i;r++){var n=e[r];if(E(t,n.baseGeometries))return n.geometry}return null}(u,t);if(h){if(null!==h.geometry)return[h.geometry]}else{var p=THREE.BufferGeometryUtils.mergeBufferGeometries(t,!0);if(u.push({geometry:p,baseGeometries:t}),null!==p)return[p]}}return t})},_.prototype.loadMesh=function(e){for(var t=this,r=this.json,i=this.extensions,n=r.meshes[e],o=n.primitives,a=[],s=0,l=o.length;s<l;s++){var c=void 0===o[s].material?p():this.getDependency("material",o[s].material);a.push(c)}return Promise.all(a).then(function(r){return t.loadGeometries(o).then(function(a){for(var s=1===a.length&&a[0].groups.length>0,l=[],c=0,u=a.length;c<u;c++){var h,p=a[c],d=o[c],m=s?r:r[c];if(d.mode===P.TRIANGLES||d.mode===P.TRIANGLE_STRIP||d.mode===P.TRIANGLE_FAN||void 0===d.mode)!0===(h=!0===n.isSkinnedMesh?new THREE.SkinnedMesh(p,m):new THREE.Mesh(p,m)).isSkinnedMesh&&h.normalizeSkinWeights(),d.mode===P.TRIANGLE_STRIP?h.drawMode=THREE.TriangleStripDrawMode:d.mode===P.TRIANGLE_FAN&&(h.drawMode=THREE.TriangleFanDrawMode);else if(d.mode===P.LINES)h=new THREE.LineSegments(p,m);else if(d.mode===P.LINE_STRIP)h=new THREE.Line(p,m);else if(d.mode===P.LINE_LOOP)h=new THREE.LineLoop(p,m);else{if(d.mode!==P.POINTS)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+d.mode);h=new THREE.Points(p,m)}Object.keys(h.geometry.morphAttributes).length>0&&g(h,n),h.name=n.name||"mesh_"+e,a.length>1&&(h.name+="_"+c),f(h,n),l.push(h);for(var v=s?h.material:[h.material],y=void 0!==p.attributes.color,E=void 0!==p.attributes.alphaIndex,b=void 0===p.attributes.normal,x=!0===h.isSkinnedMesh,_=Object.keys(p.morphAttributes).length>0,w=_&&void 0!==p.morphAttributes.normal,M=0,R=v.length;M<R;M++){m=v[M];if(h.isPoints){var S="PointsMaterial:"+m.uuid,A=t.cache.get(S);A||(A=new THREE.PointsMaterial,THREE.Material.prototype.copy.call(A,m),A.color.copy(m.color),A.map=m.map,A.lights=!1,t.cache.add(S,A)),m=A}else if(h.isLine){var S="LineBasicMaterial:"+m.uuid,C=t.cache.get(S);C||(C=new THREE.LineBasicMaterial,THREE.Material.prototype.copy.call(C,m),C.color.copy(m.color),C.lights=!1,t.cache.add(S,C)),m=C}if(y||E||b||x||_){S="ClonedMaterial:"+m.uuid+":";m.isGLTFSpecularGlossinessMaterial&&(S+="specular-glossiness:"),x&&(S+="skinning:"),y&&(S+="vertex-colors:"),E&&(S+="vertex-alpha:"),b&&(S+="flat-shading:"),_&&(S+="morph-targets:"),w&&(S+="morph-normals:");var L=t.cache.get(S);L||(L=m.isGLTFSpecularGlossinessMaterial?i[T.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].cloneMaterial(m):m.clone(),x&&(L.skinning=!0),y&&(L.vertexColors=THREE.VertexColors),E&&(L.defines=L.defines||{},L.defines.USE_ALPHAINDEX=!0),b&&(L.flatShading=!0),_&&(L.morphTargets=!0),w&&(L.morphNormals=!0),t.cache.add(S,L)),m=L}v[M]=m,m.aoMap&&void 0===p.attributes.uv2&&void 0!==p.attributes.uv&&(console.log("THREE.GLTFLoader: Duplicating UVs to support aoMap."),p.addAttribute("uv2",new THREE.BufferAttribute(p.attributes.uv.array,2))),m.isGLTFSpecularGlossinessMaterial&&(h.onBeforeRender=i[T.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].refreshUniforms)}h.material=s?v:v[0]}if(1===l.length)return l[0];for(var O=new THREE.Group,c=0,u=l.length;c<u;c++)O.add(l[c]);return O})})},_.prototype.loadCamera=function(e){var t,r=this.json.cameras[e],i=r[r.type];if(i)return"perspective"===r.type?t=new THREE.PerspectiveCamera(THREE.Math.radToDeg(i.yfov),i.aspectRatio||1,i.znear||1,i.zfar||2e6):"orthographic"===r.type&&(t=new THREE.OrthographicCamera(i.xmag/-2,i.xmag/2,i.ymag/2,i.ymag/-2,i.znear,i.zfar)),void 0!==r.name&&(t.name=r.name),f(t,r),Promise.resolve(t);console.warn("THREE.GLTFLoader: Missing camera parameters.")},_.prototype.loadSkin=function(e){var t=this.json.skins[e],r={joints:t.joints};return void 0===t.inverseBindMatrices?Promise.resolve(r):this.getDependency("accessor",t.inverseBindMatrices).then(function(e){return r.inverseBindMatrices=e,r})},_.prototype.loadAnimation=function(e){for(var t=this.json.animations[e],r=[],i=[],n=[],o=[],a=[],s=0,l=t.channels.length;s<l;s++){var c=t.channels[s],h=t.samplers[c.sampler],p=c.target,d=void 0!==p.node?p.node:p.id,f=void 0!==t.parameters?t.parameters[h.input]:h.input,m=void 0!==t.parameters?t.parameters[h.output]:h.output;r.push(this.getDependency("node",d)),i.push(this.getDependency("accessor",f)),n.push(this.getDependency("accessor",m)),o.push(h),a.push(p)}return Promise.all([Promise.all(r),Promise.all(i),Promise.all(n),Promise.all(o),Promise.all(a)]).then(function(r){for(var i=r[0],n=r[1],o=r[2],a=r[3],s=r[4],l=[],c=0,h=i.length;c<h;c++){var p=i[c],d=n[c],f=o[c],m=a[c],g=s[c];if(void 0!==p){p.updateMatrix(),p.matrixAutoUpdate=!0;var v;switch(F[g.path]){case F.weights:v=THREE.NumberKeyframeTrack;break;case F.rotation:v=THREE.QuaternionKeyframeTrack;break;case F.position:case F.scale:default:v=THREE.VectorKeyframeTrack}var y=p.name?p.name:p.uuid,E=void 0!==m.interpolation?I[m.interpolation]:THREE.InterpolateLinear,b=[];F[g.path]===F.weights?p.traverse(function(e){!0===e.isMesh&&e.morphTargetInfluences&&b.push(e.name?e.name:e.uuid)}):b.push(y);for(var x=0,_=b.length;x<_;x++){var w=new v(b[x]+"."+F[g.path],THREE.AnimationUtils.arraySlice(d.array,0),THREE.AnimationUtils.arraySlice(f.array,0),E);"CUBICSPLINE"===m.interpolation&&(w.createInterpolant=function(e){return new u(this.times,this.values,this.getValueSize()/3,e)},w.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),l.push(w)}}}var T=void 0!==t.name?t.name:"animation_"+e;return new THREE.AnimationClip(T,void 0,l)})},_.prototype.loadNode=function(e){var t=this.json,r=this.extensions,i=this,n=t.meshReferences,o=t.meshUses,a=t.nodes[e];return new Promise(function(e){!0===a.isBone?e(new THREE.Bone):void 0!==a.mesh?i.getDependency("mesh",a.mesh).then(function(t){var r;if(n[a.mesh]>1){var i=o[a.mesh]++;(r=t.clone()).name+="_instance_"+i,r.onBeforeRender=t.onBeforeRender;for(var s=0,l=r.children.length;s<l;s++)r.children[s].name+="_instance_"+i,r.children[s].onBeforeRender=t.children[s].onBeforeRender}else r=t;e(r)}):void 0!==a.camera?i.getDependency("camera",a.camera).then(e):a.extensions&&a.extensions[T.KHR_LIGHTS_PUNCTUAL]&&void 0!==a.extensions[T.KHR_LIGHTS_PUNCTUAL].light?i.getDependency("light",a.extensions[T.KHR_LIGHTS_PUNCTUAL].light).then(e):e(new THREE.Object3D)}).then(function(e){if(void 0!==a.name&&(e.name=THREE.PropertyBinding.sanitizeNodeName(a.name)),f(e,a),a.extensions&&d(r,e,a),void 0!==a.matrix){var t=new THREE.Matrix4;t.fromArray(a.matrix),e.applyMatrix(t)}else void 0!==a.translation&&e.position.fromArray(a.translation),void 0!==a.rotation&&e.quaternion.fromArray(a.rotation),void 0!==a.scale&&e.scale.fromArray(a.scale);return e})},_.prototype.loadScene=function(){function e(t,r,i,n){var o=i.nodes[t];return n.getDependency("node",t).then(function(e){if(void 0===o.skin)return e;var t;return n.getDependency("skin",o.skin).then(function(e){for(var r=[],i=0,o=(t=e).joints.length;i<o;i++)r.push(n.getDependency("node",t.joints[i]));return Promise.all(r)}).then(function(r){for(var i=!0===e.isGroup?e.children:[e],n=0,o=i.length;n<o;n++){for(var a=i[n],s=[],l=[],c=0,u=r.length;c<u;c++){var h=r[c];if(h){s.push(h);var p=new THREE.Matrix4;void 0!==t.inverseBindMatrices&&p.fromArray(t.inverseBindMatrices.array,16*c),l.push(p)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[c])}a.bind(new THREE.Skeleton(s,l),a.matrixWorld)}return e})}).then(function(t){r.add(t);var a=[];if(o.children)for(var s=o.children,l=0,c=s.length;l<c;l++){var u=s[l];a.push(e(u,t,i,n))}return Promise.all(a)})}return function(t){var r=this.json,i=this.extensions,n=this.json.scenes[t],o=new THREE.Scene;void 0!==n.name&&(o.name=n.name),f(o,n),n.extensions&&d(i,o,n);for(var a=n.nodes||[],s=[],l=0,c=a.length;l<c;l++)s.push(e(a[l],o,r,this));return Promise.all(s).then(function(){return o})}}();var N=Object.prototype.toString,j=function(e){return function(t){return N.call(t)=="[object "+e+"]"}},U={isType:j,isArray:j("Array"),isObject:j("Object"),isString:j("String"),isNumber:j("Number"),isFunction:j("Function"),isRegExp:j("RegExp"),isUndefined:j("Undefined"),objectKeysToLowerCase:function(e,r,i){var n,o,a,s,l,c,u,h;if(c=U.objectKeysToLowerCase,"undefined"===(u=t(r))||null===r||0===r||!1===r)r=0;else if("object"===u){if(!(r instanceof c))throw new TypeError('Expected "deep" to be a special object')}else if(!0===r)r=1/0;else{if("number"!==u)throw new TypeError('Expected "deep" to be a boolean, number or object, got "'+u+'"');if(isNaN(r)||r<0)throw new RangeError('Expected "deep" to be a positive number, got '+r)}if(null===e||"object"!==t(e))throw new TypeError('Expected "input" to be an object');if(u=t(i),null!==i&&"undefined"!==u&&"function"!==u)throw new TypeError('Expected "filter" to be a function');if(i=i||null,a=Object.keys(e),s=a.length-1,l={},r){if("number"==typeof r)r=Object.seal(Object.create(c.prototype,{input:{value:[]},output:{value:[]},level:{value:-1,writable:!0},max:{value:r,writable:!1}}));else if(~(n=r.input.indexOf(e)))return r.output[n];for(r.level+=1,r.input.push(e),r.output.push(l),n=s+1;n--;)"object"===t(h=e[o=a[s-n]])&&h&&r.level<r.max&&(i?i(h):h.constructor===Object)&&(h=c(h,r,i)),l[o.toLowerCase()]=h;r.level-=1}else for(n=s+1;n--;)l[(o=a[s-n]).toLowerCase()]=e[o];return l},getBrowserInfo:function(){if(void 0!==U._browserInfo)return U._browserInfo;U._browserInfo={};var e=function(){var e={},t=navigator.userAgent.toLowerCase().match(/(msie|firefox|chrome|opera|version).*?([\d.]+)/);return e.browser=t[1].replace(/version/,"safari"),e.ver=t[2],e}();return U._browserInfo.type=e.browser,U._browserInfo.version=e.ver,U._browserInfo}};String.prototype.removeAt=function(e){var t=this.substring(0);return e>=this.length?t:t.slice(0,e)+t.slice(e+1)},String.prototype.getExtension=function(){var e=this.split(".");return e.length>1?e.pop():""},String.prototype.getFileName=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=this.indexOf("\\")>=0?this.lastIndexOf("\\"):this.lastIndexOf("/");if(-1===t)return e?this:this.split(".")[0];var r=this.substring(t);return 0!==r.indexOf("\\")&&0!==r.indexOf("/")||(r=r.substring(1)),e?r:r.split(".")[0]},String.prototype._trimLeft=function(e){return void 0===e&&(e="s"),this.replace(new RegExp("^["+e+"]+"),"")},String.prototype._trimRight=function(e){return void 0===e&&(e="s"),this.replace(new RegExp("["+e+"]+$"),"")},String.prototype.trimBoth=function(e){return this._trimLeft(e)._trimRight(e)},String.prototype.appendPath=function(e){return this._trimRight("/")+"/"+e._trimLeft("/")._trimRight("/")},String.prototype.replaceAll=function(e,t){if(!this.length)return"";for(var r=this.substring(0);-1!==r.indexOf(e);)r=r.replace(e,t);return r};var B=function(){function e(t){r(this,e),this._major=0,this._minor=0,this._modified=0;var i=t.split(".");this._major=parseInt(i.length>=1?i[0]:0),this._minor=parseInt(i.length>=2?i[1]:0),this._modified=parseInt(i.length>=3?i[2]:0)}return n(e,[{key:"compare",value:function(t){return U.isString(t)&&(t=new e(t)),this._major!=t._major?this._major>t._major?1:-1:this._minor!=t._minor?this._minor>t._minor?1:-1:this._modified!=t._modified?this._modified>t._modified?1:-1:0}},{key:"major",get:function(){return this._major}},{key:"minor",get:function(){return this._minor}},{key:"modified",get:function(){return this._modified}}]),e}(),V=function(){function e(){r(this,e)}return n(e,[{key:"GLTF_decoder_1_count",value:function(e,t,r,i){return 0==e?i-t:e%2?r%2?i+t:i:i-t}},{key:"GLTF_decoder_1_offset",value:function(e,t,r,i){return t*=r,0==e?i:e%2?i-t:i}},{key:"GLTF_decoder_1_length",value:function(e,t,r,i,n){return t*=r,0==e?n-t:e%2?i%2?n+t:n:n-t}},{key:"GLTF_decoder_2_offset",value:function(e,t,r,i){return t*=r,e%2?i-t:i}},{key:"GLTF_decoder_2_length",value:function(e,t,r,i,n){return t*=r,e%2?i%2?n+t:n:n-t}},{key:"GLTF_decoder_3_offset",value:function(e,t,r,i){return t*=r,e%2?i-t:i}},{key:"GLTF_decoder_3_length",value:function(e,t,r,i,n){return t*=r,e%2?i%2?n+t:n:n-t}}]),e}(),z=function(){function e(t,i){r(this,e),this._decoder={},this._nameDecoder={},i?(i.data=U.objectKeysToLowerCase(t),this._init(i.data)):this._init(t)}return n(e,[{key:"_initDecoder",value:function(e){var t=e.createtime;if(t){"safari"==U.getBrowserInfo().type&&(t=t.replace(/ /g,"T"));var r=new Date(t),i=r.getSeconds();this._decoder.version=Math.floor(i/10);for(var n=e.size,o=1,a=0;a<n.length;a++){var s=n[a].toString();-1!==s.indexOf(".")&&(o+=Math.floor(s.substring(s.length-1)))}this._decoder.randomWeight=o,this._decoder.randomRanges=[r.getHours()+1,r.getDate()+1,r.getSeconds()%13+1,r.getMinutes()%13+1,o%5*(o%5)+1,e.verts%13+1,e.faces%13+1,e.nodes%13+1]}}},{key:"_decode21_name",value:function(e,t){var r=["F7WD3HNR2OPYV6AUS5TKM018ZBJL4EQXIGC9F","A0JQM9PSLXF18647URV3DNHOCY52TEZBWIGKA","B0IE6Q4S3C7OA28UHTPXDW9NYMGLF1K5VJRZB","EQ72MKL3DYNF5RU1PWBT64X9CIZVJHS8G0OAE"],i=e.charAt(0),n=r[1].indexOf(i);if(-1!==n){n++,n=Math.floor(n/2)+1;var o=(e=e.removeAt(n)).getExtension();e=e.getFileName(!1);for(var a="",s=0;s<e.length;s++){var l=e[s],c=r[(s+1+t)%4],u=c.indexOf(l);0===u?u=35:u--,a+=c[u]}return o?a+"."+o:a}}},{key:"_initResourceDecoder",value:function(e,t){var r=t.texfiles;if(r){var i=new B(e),n=null;2==i.major&&1==i.minor&&(n=this._decode21_name);var o=Object.keys(r).length,a=t.gltffiles;if(a)for(c=0;c<a.length;c++)a[c]=n(a[c],o);var s=t.lod;if(s)for(var l=Object.keys(s),c=0;c<l.length;c++){var u=l[c];s[n(u,o)]=s[u],delete s[u]}this._nameDecoder.version=i,this._nameDecoder.decodeFunc=n}}},{key:"_init",value:function(e){if(e){var t=e.version;if(t){new B(t).compare("2.0")<=0||(this._initDecoder(e),this._initResourceDecoder(t,e))}}}},{key:"decode",value:function(e,t,r){var i=new V;switch(this._decoder.version){case 0:case 3:p=this._decoder.randomWeight;if("_accessors"==t)for(l=0;l<r.length;l++){h=r[l];(n=e.bufferViews[h.bufferView]).factor=Math.floor(n.byteLength/h.count),n.opFactor=h.byteType,h.count=i.GLTF_decoder_1_count(l,p,h.byteType,h.count),delete h.byteType}else if("_bufferViews"==t)for(l=0;l<r.length;l++){a=(n=r[l]).factor;n.byteOffset=i.GLTF_decoder_1_offset(l,p,a,n.byteOffset),n.byteLength=i.GLTF_decoder_1_length(l,p,a,n.opFactor,n.byteLength),delete n.factor,delete n.opFactor}break;case 1:case 4:u=this._decoder.randomRanges;if("_accessors"==t)for(l=0;l<r.length;l++){h=r[l];(n=e.bufferViews[h.bufferView]).factor=Math.floor(n.byteLength/h.count),n.opFactor=h.byteType;p=u[d=Math.floor(l/2)%8]+(l+1)%7;h.count=i.GLTF_decoder_1_count(l,p,h.byteType,h.count),delete h.byteType}else if("_bufferViews"==t)for(l=0;l<r.length;l++){var n=r[l],o=u[d=Math.floor(l/2)%8]+(l+1)%7,a=n.factor;n.byteOffset=i.GLTF_decoder_2_offset(l,o,a,n.byteOffset),n.byteLength=i.GLTF_decoder_2_length(l,o,a,n.opFactor,n.byteLength),delete n.factor,delete n.opFactor}break;case 2:case 5:this._decoder.randomRanges3=[this._decoder.randomRanges[7],7*e.materials.length%10];for(var s=(e.buffers[0].byteLength-999).toString(),l=0;l<s.length;l++){var c=10-Math.floor(s[l]);this._decoder.randomRanges3.push(c)}this._decoder.randomRanges3.push(this._decoder.randomRanges[3]);var u=this._decoder.randomRanges3;if("_accessors"==t)for(l=0;l<r.length;l++){var h=r[l],n=e.bufferViews[h.bufferView],p=u[d=Math.floor(l/2)%u.length]+Math.floor(l+1)%7;n.factor=Math.floor(n.byteLength/h.count),n.opFactor=h.byteType,h.count=i.GLTF_decoder_1_count(l,p,h.byteType,h.count),delete h.byteType}else if("_bufferViews"==t)for(l=0;l<r.length;l++){var n=r[l],d=Math.floor(l/2)%u.length,o=u[d]+Math.floor(l+1)%7,a=n.factor;n.byteOffset=i.GLTF_decoder_3_offset(l,o,a,n.byteOffset),n.byteLength=i.GLTF_decoder_3_length(l,o,a,n.opFactor,n.byteLength),delete n.factor,delete n.opFactor}}var f=this._nameDecoder.decodeFunc;if(f&&("_buffers"==t||"_images"==t))for(var m=e.buffers.length+e.images.length,l=0;l<r.length;l++)r[l].uri=f(r[l].uri,m)}},{key:"decodeDracoFile",value:function(e,t,r){}}]),e}(),q={process:function(e,t){e.traverse(function(e){!function(e,t){if(e.material&&e.material.userData&&e.material.userData.gltfExtensions){var r=e.material.userData.gltfExtensions.blend;if(r){var i,n,o,a=e.material.__texture,s=e.geometry.index.count,l=[{materialIndex:0,start:0,count:s}],c=[e.material];for(i=0;i<r.length;i++)(n=t[r[i].subMaterial].clone())&&(n.transparent=!0,r[i].maskTexture&&(1===(o=r[i].maskTexture.texCoord||0)&&(n.defines.USE_ALPHA_UV2=""),2===o&&(n.defines.USE_ALPHA_UV3=""),r[i].maskTexture.extensions&&(n.userData.gltfExtensions.alphaTexture=r[i].maskTexture.extensions),n.alphaMap=a[i],n.needsUpdate=!0),c.push(n),l.push({materialIndex:c.length-1,start:0,count:s}));delete e.material.__texture,e.material=c,e.geometry.groups=l}}}(e,t),function(e){e.isMesh&&(e.castShadow=!0,e.receiveShadow=!0)}(e),function(e){e.material&&(Array.isArray(e.material)?e.material.forEach(function(e){e.map&&(e.userData.gltfExtensions.useDiffuseUV2&&(e.defines=e.defines||{},e.defines.USE_DIFFUSE_UV2=""),e.map.anisotropy=16,e.map.needsUpdate=!0)}):e.material.map&&(e.material.userData.gltfExtensions.useDiffuseUV2&&(e.material.defines=e.material.defines||{},e.material.defines.USE_DIFFUSE_UV2=""),e.material.map.anisotropy=16,e.material.map.needsUpdate=!0))}(e)})}},G=function(){function e(t){r(this,e),this._manager=t,this._loader=new o(t)}return n(e,[{key:"_ProcessProgressCallback",value:function(e,t,r){var i=0;t.lengthComputable&&t.total>0?t.target.readyState>1&&(i=t.loaded/t.total):i=1,r&&1==(i*=(r.cur+1)/r.total)&&r.cur++,e({progress:i})}},{key:"_loadGLTFs",value:function(e,t,r,i,n,o,a,s,l){var c=this,u=this._loader;u.loadingIndex=i,u.setDRACOLoader(e),u.setCrossOrigin("anonymous");var h=r.gltffiles[i],p=t.appendPath(h),d=r.lod;this.load(p,function(e){if(d){var t=h.getFileName(!1),r=d[t];U.isNumber(r)||(console.error("The '"+t+"' distance is invalid, please check name is existing in index.json"),r=1e4),n.addLevel(e.scene,r)}else n.add(e.scene);o.loadedNumber++,o.loadedNumber===o.totalNumber&&s&&s({url:p.getPath(),node:n,animations:e.animations,materials:e.materials})},function(e){a&&c._ProcessProgressCallback(a,e,o)},function(e){console.error(e),l&&l()})}},{key:"loadGLTFs",value:function(e,t,r,i,n,o){t&&null!=r&&r(t);var a;a=t.lod?new THREE.LOD:new THREE.Group;for(var s=t.gltffiles,l={loadedNumber:0,totalNumber:s.length,cur:0,total:s.length},c={},u=new z(t,c),h=0;h<s.length;h++)this._loadGLTFs(u,e,c.data,h,a,l,n,i,o)}},{key:"loadGLTF",value:function(e,t,r,i,n,o){t=t||{};var a={},s=this._loader;s.setDRACOLoader(new z(t,a)),s.setCrossOrigin("anonymous"),t=a.data,null!=r&&r(t);var l,c=t.gltffiles;l=c&&c.length?e.appendPath(c[0]):e.appendPath("scene.gltf");var u=this;this.load(l,function(e){null!=i&&i({url:l.getPath(),node:e.scene,animations:e.animations,materials:e.materials})},function(e){n&&u._ProcessProgressCallback(n,e)},function(e){console.error(e),o&&o()})}},{key:"downloadGLTF",value:function(e,t,r,i,n){var o=e.appendPath("index.json"),a=this;new THREE.FileLoader(this._manager).load(o,function(o){if(o){o=o.replaceAll("\\","/");var s=U.objectKeysToLowerCase(JSON.parse(o)),l=s.gltffiles;l&&0!==l.length?1===l.length?a.loadGLTF(e,s,t,r,i,n):a.loadGLTFs(e,s,t,r,i,n):a.loadGLTF(e,s,t,r,i,n)}},function(){},function(){a.loadGLTF(e,null,t,r,i,n)})}},{key:"downloadJSON",value:function(e,t){(new THREE.JSONLoader).load(e,function(r,i){for(var n in i)i[n].skinning=!0;null!=t&&t({url:e,geometry:r,materials:i})})}},{key:"loadFromURL",value:function(e){var t=e.url,r=e.jsonCallback,i=e.modelCallback,n=e.progressCallback,o=e.errorCallback;"js"==t.getExtension()?this.downloadJSON(t,i):this.downloadGLTF(t,r,i,n,o)}},{key:"load",value:function(e,t,r,i){this._loader.load(e,function(e){q.process(e.scene,e.materials),t&&t(e)},r,i);var n=this;return{then:function(o,a){return n._loader.load(e,function(e){q.process(e.scene,e.materials),t&&t(e),o(e)},r,function(e){i&&i(e),a(e)}),this}}}}]),e}(),W=function(){function e(t,i){r(this,e);var n=JSON.parse(t);this._asset=n.asset,this._scene=n.scene,this._scenes=n.scenes,this._extensionsUsed=n.extensionsUsed,this._extensions=n.extensions,this._nodes=n.nodes,this._accessors=n.accessors,this._images=n.images,this._skins=n.skins,this._meshes=n.meshes,this._textures=n.textures,this._samplers=n.samplers,this._materials=n.materials,this._cameras=n.cameras,this._animations=n.animations,this._buffers=n.buffers,this._bufferViews=n.bufferViews,this._meshReferences=n.meshReferences,this._meshUses=n.meshUses,this._init(i)}return n(e,[{key:"_init",value:function(e){var t=e.dracoLoader;if(t)for(var r=Object.keys(this),i=0;i<r.length;i++){var n=r[i],o=this[n];o&&t.decode(this,n,o)}}},{key:"asset",get:function(){return this._asset}},{key:"scene",get:function(){return this._scene}},{key:"scenes",get:function(){return this._scenes}},{key:"extensionsUsed",get:function(){return this._extensionsUsed}},{key:"extensions",get:function(){return this._extensions}},{key:"nodes",get:function(){return this._nodes}},{key:"accessors",get:function(){return this._accessors}},{key:"images",get:function(){return this._images}},{key:"skins",get:function(){return this._skins}},{key:"meshes",get:function(){return this._meshes}},{key:"textures",get:function(){return this._textures}},{key:"samplers",get:function(){return this._samplers}},{key:"materials",get:function(){return this._materials}},{key:"cameras",get:function(){return this._cameras}},{key:"animations",get:function(){return this._animations}},{key:"buffers",get:function(){return this._buffers}},{key:"bufferViews",get:function(){return this._bufferViews}},{key:"meshReferences",set:function(e){this._meshReferences=e},get:function(){return this._meshReferences}},{key:"meshUses",set:function(e){this._meshUses=e},get:function(){return this._meshUses}}]),e}();JSON.parseX=function(e,t){return new W(e,t)},W.prototype.toJSON=function(){},e.GLTFLoader=G,e.JSONXLoader=W,Object.defineProperty(e,"__esModule",{value:!0})}),function(){"use strict";function e(){this.positions=[],this.previous=[],this.next=[],this.side=[],this.width=[],this.indices_array=[],this.uvs=[],this.counters=[],this.geometry=new n.BufferGeometry,this.widthCallback=null}function t(e,t,r,i,n){var o;if(e=e.subarray||e.slice?e:e.buffer,r=r.subarray||r.slice?r:r.buffer,e=t?e.subarray?e.subarray(t,n&&t+n):e.slice(t,n&&t+n):e,r.set)r.set(e,i);else for(o=0;o<e.length;o++)r[o+i]=e[o];return r}function r(e){function t(e,t){return void 0===e?t:e}n.Material.call(this),e=e||{},this.lineWidth=t(e.lineWidth,1),this.map=t(e.map,null),this.useMap=t(e.useMap,0),this.alphaMap=t(e.alphaMap,null),this.useAlphaMap=t(e.useAlphaMap,0),this.color=t(e.color,new n.Color(16777215)),this.opacity=t(e.opacity,1),this.resolution=t(e.resolution,new n.Vector2(1,1)),this.sizeAttenuation=t(e.sizeAttenuation,1),this.near=t(e.near,1),this.far=t(e.far,1),this.dashArray=t(e.dashArray,[]),this.useDash=this.dashArray!==[]?1:0,this.visibility=t(e.visibility,1),this.alphaTest=t(e.alphaTest,0),this.repeat=t(e.repeat,new n.Vector2(1,1));var r=new n.RawShaderMaterial({uniforms:{lineWidth:{type:"f",value:this.lineWidth},map:{type:"t",value:this.map},useMap:{type:"f",value:this.useMap},alphaMap:{type:"t",value:this.alphaMap},useAlphaMap:{type:"f",value:this.useAlphaMap},color:{type:"c",value:this.color},opacity:{type:"f",value:this.opacity},resolution:{type:"v2",value:this.resolution},sizeAttenuation:{type:"f",value:this.sizeAttenuation},near:{type:"f",value:this.near},far:{type:"f",value:this.far},dashArray:{type:"v2",value:new n.Vector2(this.dashArray[0],this.dashArray[1])},useDash:{type:"f",value:this.useDash},visibility:{type:"f",value:this.visibility},alphaTest:{type:"f",value:this.alphaTest},repeat:{type:"v2",value:this.repeat},uvTransform:{type:"m3",value:this.map?this.map.matrix:new n.Matrix3}},vertexShader:["precision highp float;","","attribute vec3 position;","attribute vec3 previous;","attribute vec3 next;","attribute float side;","attribute float width;","attribute vec2 uv;","attribute float counters;","","uniform mat4 projectionMatrix;","uniform mat4 modelViewMatrix;","uniform vec2 resolution;","uniform float lineWidth;","uniform vec3 color;","uniform float opacity;","uniform float near;","uniform float far;","uniform float sizeAttenuation;","uniform mat3 uvTransform;","#ifdef USE_GPUPICKER","uniform float baseId;","varying vec4 worldId;","#endif","","varying vec2 vUV;","varying vec4 vColor;","varying float vCounters;","","vec2 fix( vec4 i, float aspect ) {","","    vec2 res = i.xy / i.w;","    res.x *= aspect;","\t vCounters = counters;","    return res;","","}","","void main() {","","    float aspect = resolution.x / resolution.y;","\t float pixelWidthRatio = 1. / (resolution.x * projectionMatrix[0][0]);","","    vColor = vec4( color, opacity );","    //vUV = uv;","    vUV = ( uvTransform * vec3( uv, 1 ) ).xy;","","    mat4 m = projectionMatrix * modelViewMatrix;","    vec4 finalPosition = m * vec4( position, 1.0 );","    vec4 prevPos = m * vec4( previous, 1.0 );","    vec4 nextPos = m * vec4( next, 1.0 );","","    vec2 currentP = fix( finalPosition, aspect );","    vec2 prevP = fix( prevPos, aspect );","    vec2 nextP = fix( nextPos, aspect );","","\t float pixelWidth = finalPosition.w * pixelWidthRatio;","    float w = 1.8 * pixelWidth * lineWidth * width;","","    if( sizeAttenuation == 1. ) {","        w = 1.8 * lineWidth * width;","    }","","    vec2 dir;","    if( nextP == currentP ) dir = normalize( currentP - prevP );","    else if( prevP == currentP ) dir = normalize( nextP - currentP );","    else {","        vec2 dir1 = normalize( currentP - prevP );","        vec2 dir2 = normalize( nextP - currentP );","        dir = normalize( dir1 + dir2 );","","        vec2 perp = vec2( -dir1.y, dir1.x );","        vec2 miter = vec2( -dir.y, dir.x );","        //w = clamp( w / dot( miter, perp ), 0., 4. * lineWidth * width );","        w = w / max(dot( miter, perp ), 0.2);","","    }","","    //vec2 normal = ( cross( vec3( dir, 0. ), vec3( 0., 0., 1. ) ) ).xy;","    vec2 normal = vec2( -dir.y, dir.x );","    normal.x /= aspect;","    normal *= .5 * w;","","    vec4 offset = vec4( normal * side, 0.0, 1.0 );","    finalPosition.xy += offset.xy;","","    gl_Position = finalPosition;","#ifdef USE_GPUPICKER","vec3 a = fract(vec3(1.0/255.0, 1.0/(255.0*255.0), 1.0/(255.0*255.0*255.0)) * baseId);","a -= a.xxy * vec3(0.0, 1.0/255.0, 1.0/255.0);","worldId = vec4(a,1);","#endif","","}"].join("\r\n"),fragmentShader:["precision mediump float;","","uniform sampler2D map;","uniform sampler2D alphaMap;","uniform float useMap;","uniform float useAlphaMap;","uniform float useDash;","uniform vec2 dashArray;","uniform float visibility;","uniform float alphaTest;","uniform vec2 repeat;","","varying vec2 vUV;","varying vec4 vColor;","varying float vCounters;","#ifdef USE_GPUPICKER","varying vec4 worldId;","#endif","","void main() {","","    vec4 c = vColor;","    if( useMap == 1. ) c *= texture2D( map, vUV * repeat );","    if( useAlphaMap == 1. ) c.a *= texture2D( alphaMap, vUV * repeat ).a;","\t if( c.a < alphaTest ) discard;","\t if( useDash == 1. ){","\t \t ","\t }","    gl_FragColor = c;","\t gl_FragColor.a *= step(vCounters,visibility);","\t #ifdef USE_GPUPICKER","\t \tgl_FragColor = worldId;","\t #endif","}"].join("\r\n")});return delete e.lineWidth,delete e.map,delete e.useMap,delete e.alphaMap,delete e.useAlphaMap,delete e.color,delete e.opacity,delete e.resolution,delete e.sizeAttenuation,delete e.near,delete e.far,delete e.dashArray,delete e.visibility,delete e.alphaTest,delete e.repeat,r.type="MeshLineMaterial",r.setValues(e),r}var i="undefined"!=typeof require,n=this.THREE||i&&require("three");if(!n)throw new Error("MeshLine requires three.js");var o=o||n;e.prototype.setGeometry=function(e,t){if(this.widthCallback=t,this.positions=[],this.counters=[],e instanceof n.Geometry)for(i=0;i<e.vertices.length;i++){var r=e.vertices[i],t=i/e.vertices.length;this.positions.push(r.x,r.y,r.z),this.positions.push(r.x,r.y,r.z),this.counters.push(t),this.counters.push(t)}if(n.BufferGeometry,e instanceof Float32Array||e instanceof Array)for(var i=0;i<e.length;i+=3){t=i/e.length;this.positions.push(e[i],e[i+1],e[i+2]),this.positions.push(e[i],e[i+1],e[i+2]),this.counters.push(t),this.counters.push(t)}this.process()},e.prototype.compareV3=function(e,t){var r=6*e,i=6*t;return this.positions[r]===this.positions[i]&&this.positions[r+1]===this.positions[i+1]&&this.positions[r+2]===this.positions[i+2]},e.prototype.copyV3=function(e){var t=6*e;return[this.positions[t],this.positions[t+1],this.positions[t+2]]},e.prototype.process=function(){var e=this.positions.length/6;this.previous=[],this.next=[],this.side=[],this.width=[],this.indices_array=[],this.uvs=[];for(r=0;r<e;r++)this.side.push(1),this.side.push(-1);for(var t,r=0;r<e;r++)t=this.widthCallback?this.widthCallback(r/(e-1)):1,this.width.push(t),this.width.push(t);for(r=0;r<e;r++)this.uvs.push(r/(e-1),0),this.uvs.push(r/(e-1),1);var i;i=this.compareV3(0,e-1)?this.copyV3(e-2):this.copyV3(0),this.previous.push(i[0],i[1],i[2]),this.previous.push(i[0],i[1],i[2]);for(r=0;r<e-1;r++)i=this.copyV3(r),this.previous.push(i[0],i[1],i[2]),this.previous.push(i[0],i[1],i[2]);for(r=1;r<e;r++)i=this.copyV3(r),this.next.push(i[0],i[1],i[2]),this.next.push(i[0],i[1],i[2]);i=this.compareV3(e-1,0)?this.copyV3(1):this.copyV3(e-1),this.next.push(i[0],i[1],i[2]),this.next.push(i[0],i[1],i[2]);for(r=0;r<e-1;r++){var o=2*r;this.indices_array.push(o,o+1,o+2),this.indices_array.push(o+2,o+1,o+3)}this.attributes?(this.attributes.position.copyArray(new Float32Array(this.positions)),this.attributes.position.needsUpdate=!0,this.attributes.previous.copyArray(new Float32Array(this.previous)),this.attributes.previous.needsUpdate=!0,this.attributes.next.copyArray(new Float32Array(this.next)),this.attributes.next.needsUpdate=!0,this.attributes.side.copyArray(new Float32Array(this.side)),this.attributes.side.needsUpdate=!0,this.attributes.width.copyArray(new Float32Array(this.width)),this.attributes.width.needsUpdate=!0,this.attributes.uv.copyArray(new Float32Array(this.uvs)),this.attributes.uv.needsUpdate=!0,this.attributes.index.copyArray(new Uint16Array(this.indices_array)),this.attributes.index.needsUpdate=!0):this.attributes={position:new n.BufferAttribute(new Float32Array(this.positions),3),previous:new n.BufferAttribute(new Float32Array(this.previous),3),next:new n.BufferAttribute(new Float32Array(this.next),3),side:new n.BufferAttribute(new Float32Array(this.side),1),width:new n.BufferAttribute(new Float32Array(this.width),1),uv:new n.BufferAttribute(new Float32Array(this.uvs),2),index:new n.BufferAttribute(new Uint16Array(this.indices_array),1),counters:new n.BufferAttribute(new Float32Array(this.counters),1)},this.geometry.addAttribute("position",this.attributes.position),this.geometry.addAttribute("previous",this.attributes.previous),this.geometry.addAttribute("next",this.attributes.next),this.geometry.addAttribute("side",this.attributes.side),this.geometry.addAttribute("width",this.attributes.width),this.geometry.addAttribute("uv",this.attributes.uv),this.geometry.addAttribute("counters",this.attributes.counters),this.geometry.setIndex(this.attributes.index)},e.prototype.advance=function(e){var r=this.attributes.position.array,i=this.attributes.previous.array,n=this.attributes.next.array,o=r.length;t(r,0,i,0,o),t(r,6,r,0,o-6),r[o-6]=e.x,r[o-5]=e.y,r[o-4]=e.z,r[o-3]=e.x,r[o-2]=e.y,r[o-1]=e.z,t(r,6,n,0,o-6),n[o-6]=e.x,n[o-5]=e.y,n[o-4]=e.z,n[o-3]=e.x,n[o-2]=e.y,n[o-1]=e.z,this.attributes.position.needsUpdate=!0,this.attributes.previous.needsUpdate=!0,this.attributes.next.needsUpdate=!0},(r.prototype=Object.create(n.Material.prototype)).constructor=r,r.prototype.copy=function(e){return n.Material.prototype.copy.call(this,e),this.lineWidth=e.lineWidth,this.map=e.map,this.useMap=e.useMap,this.alphaMap=e.alphaMap,this.useAlphaMap=e.useAlphaMap,this.color.copy(e.color),this.opacity=e.opacity,this.resolution.copy(e.resolution),this.sizeAttenuation=e.sizeAttenuation,this.near=e.near,this.far=e.far,this.dashArray.copy(e.dashArray),this.useDash=e.useDash,this.visibility=e.visibility,this.alphaTest=e.alphaTest,this.repeat.copy(e.repeat),this},void 0!==o?("undefined"!=typeof module&&module.exports&&(o=module.exports={MeshLine:e,MeshLineMaterial:r}),o.MeshLine=e,o.MeshLineMaterial=r):(this.MeshLine=e,this.MeshLineMaterial=r)}.call(this),TrailRenderHelper=function(){var e="[TrailRenderHelper.js] : ";this.fTimeLong=0,this.fTimeStart=0,this.iStep=0,this.iCount=0,this.fWidthStart=.5,this.fWidthEnd=.5,this.fWidthOffset=0,this.arrayPosHistory=new Array,this.shaderColor=null,this.shaderTexture=null,this.shaderTexMode=null,this.blending=null,this.transparent=null,this.alphaTest=null,this.depthWrite=null,this.depthTest=null,this.arrayUuid=new Array,this.arrayCfg=new Array,this.bAllStable=!1,this.bStable=!1,this.iMaxArrayPosHistoryNo=0,this.iMaxArrayPosHistoryNo_last=0,this.iCurrentIndex=0,this.iSumArrayPosHistoryCount=0,this.instanceBuffer=null,this.bufferGeometry=null,this.attributesVertices=null,this.material=null,this.mesh=null,this.vertices=null,this.indices=null,this.uvs=null,this.onTriggerMeshInited=null;var t=this,r={vertex:["precision highp float;","uniform sampler2D texture;","uniform vec4 color;","varying vec2 vUv;","varying vec4 varyColor;","void main()","{","\tvaryColor = color;","   vUv = vec2( uv.x, uv.y );","\tvec3 positionEye = ( modelViewMatrix * vec4( position, 1.0 ) ).xyz;","\tgl_Position = projectionMatrix * vec4( positionEye, 1.0 );","}"].join("\n"),fragment:["precision highp float;","uniform sampler2D texture;","varying vec2 vUv;","varying vec4 varyColor;","void main() {","    gl_FragColor = varyColor * texture2D(texture, vUv);","}"].join("\n")};this.init=function(i,n){if(null!=n&&void 0!=n){if(null==i||void 0==i||"object"!=typeof i)return console.error(e+"[init] : options == null;"),void n();if(null==i.fTimeLong||void 0==i.fTimeLong||"number"!=typeof i.fTimeLong)return console.error(e+"[init] : options.fTimeLong == null;"),void n();if(null==i.fTimeStart||void 0==i.fTimeStart||"number"!=typeof i.fTimeStart)return console.error(e+"[init] : options.fTimeStart == null;"),void n();if(null==i.iStep||void 0==i.iStep||"number"!=typeof i.iStep)return console.error(e+"[init] : options.iStep == null;"),void n();if(null==i.fWidthStart||void 0==i.fWidthStart||"number"!=typeof i.fWidthStart)return console.error(e+"[init] : options.fWidthStart == null;"),void n();if(null==i.fWidthEnd||void 0==i.fWidthEnd||"number"!=typeof i.fWidthEnd)return console.error(e+"[init] : options.fWidthStart == null;"),void n();null!=i.shaderColor&&void 0!=i.shaderColor&&i.shaderColor instanceof THREE.Vector4?t.shaderColor=new THREE.Vector4(i.shaderColor.x,i.shaderColor.y,i.shaderColor.z,i.shaderColor.w):(console.warn(e+"[init] : options.shaderColor == null; set shader color as default;"),t.shaderColor=new THREE.Vector4(.5,.5,1,1)),null!=i.shaderTexture&&void 0!=i.shaderTexture&&i.shaderTexture instanceof THREE.Texture?t.shaderTexture=i.shaderTexture:(console.warn(e+"[init] : options.shaderColor == null; set shader texture as default;"),t.shaderTexture=null),null==i.shaderTexMode||void 0==i.shaderTexMode||"string"!=typeof i.shaderTexMode?(console.warn(e+"[init] : options.shaderTexMode == null; set shader mode as default;"),t.shaderTexMode="Stretch"):t.shaderTexMode="Stretch"==i.shaderTexMode?"Stretch":"Tile",null==i.shaderBlending||void 0==i.shaderBlending||"number"!=typeof i.shaderBlending?(console.warn(e+"[init] : options.shaderBlending == null; set shader blending as default;"),t.blending=THREE.AdditiveBlending):t.blending=i.shaderBlending,null==i.shaderTransparent||void 0==i.shaderTransparent||"boolean"!=typeof i.shaderTransparent?(console.warn(e+"[init] : options.shaderTransparent == null; set shader transparent as default;"),t.transparent=!1):t.transparent=i.shaderTransparent,null==i.shaderAlphaTest||void 0==i.shaderAlphaTest||"number"!=typeof i.shaderAlphaTest?(console.warn(e+"[init] : options.shaderAlphaTest == null; set shader alphaTest as default;"),t.alphaTest=0):t.alphaTest=i.shaderAlphaTest,null==i.shaderDepthWrite||void 0==i.shaderDepthWrite||"boolean"!=typeof i.shaderDepthWrite?(console.warn(e+"[init] : options.shaderDepthWrite == null; set shader depthWrite as default;"),t.depthWrite=!0):t.depthWrite=i.shaderDepthWrite,null==i.shaderDepthTest||void 0==i.shaderDepthTest||"boolean"!=typeof i.shaderDepthTest?(console.warn(e+"[init] : options.shaderDepthTest == null; set shader depthTest as default;"),t.depthTest=!0):t.depthTest=i.shaderDepthTest,t.uniforms={texture:{type:"t",value:t.shaderTexture},color:{type:"v4",value:new THREE.Vector4(0,0,0,0)}},t.material=new THREE.ShaderMaterial({uniforms:t.uniforms,vertexShader:r.vertex,fragmentShader:r.fragment,blending:t.blending,transparent:t.transparent,alphaTest:t.alphaTest,depthWrite:t.depthWrite,depthTest:t.depthTest}),t.fTimeLong=i.fTimeLong,t.fTimeStart=i.fTimeStart,t.iStep=i.iStep,t.iCount=0,t.fWidthStart=i.fWidthStart,t.fWidthEnd=i.fWidthEnd,t.fWidthOffset=-t.fWidthStart+t.fWidthEnd,n()}else console.error(e+"[init] : onFinished == null;")},this.attach=function(r){if(null==r||void 0==r)return console.error(e+"[attach] : onFinished == null;"),null;var i=THREE.Math.generateUUID();t.arrayPosHistory[i]=new Array;return t.arrayCfg[i]={bActived:!0,bStable:!1,iMaxArrayPosHistoryNo_last:0,iMaxArrayPosHistoryNo:0,iStartIndex:0},t.arrayUuid.push(i),r(i),i},this.detach=function(r){null!=r&&void 0!=r&&"string"==typeof r?(t.arrayUuid.includes(r)&&delete t.arrayUuid[r],t.arrayCfg.includes(r)&&(t.iCurrentIndex-=t.arrayCfg[r].iMaxArrayPosHistoryNo,delete t.arrayCfg[r]),t.arrayPosHistory.includes(r)&&delete t.arrayPosHistory[r]):console.error(e+"[detach] : uuid == null;")},this.dispose=function(){t.instanceBuffer&&t.instanceBuffer.dispose(),t.bufferGeometry&&t.bufferGeometry.dispose(),GlobalsVariables.scene.remove(t.mesh),t.material.dispose(),t.arrayUuid.forEach(function(e){0}),t.arrayCfg.forEach(function(e){0}),t.arrayPosHistory.forEach(function(e){0}),t.arrayUuid=[],t.arrayCfg=[],t.arrayPosHistory=[]},this.setActive=function(r,i,n){if(null!=n&&void 0!=n){if(null==r||void 0==r||"string"!=typeof r)return console.error(e+"[setActive] : uuid == null;"),void n(!1);if(!t.arrayUuid.includes(r))return console.error(e+"[setActive] : uuid do not includes;"),void n(!1);if(null==i||void 0==i||"boolean"!=typeof i)return console.error(e+"[setActive] : bActived == null;"),void n(!1);t.arrayCfg[r].bActived=i,n(!0)}else console.error(e+"[setActive] : onFinished == null;")},this.tick=function(e){if(t.bAllStable)for(var r=t.arrayUuid.length,i=0;i<r;i++)t.arrayCfg[t.arrayUuid[i]].bActived&&t.updateMesh(t.arrayUuid[i]);if(t.arrayCfg[e.uuid].bActived&&(t.arrayPosHistory[e.uuid].push({time:e.timeNow,pos:new THREE.Vector3(e.position.x,e.position.y,e.position.z),rot:new THREE.Vector3(e.rotation.x,e.rotation.y,e.rotation.z)}),t.checkPosHistory(e.uuid,e.timeNow)),!t.bAllStable&&!t.arrayCfg[e.uuid].bStable){r=t.arrayPosHistory[e.uuid].length;t.arrayCfg[e.uuid].iMaxArrayPosHistoryNo<=r&&(t.arrayCfg[e.uuid].iMaxArrayPosHistoryNo_last=t.arrayCfg[e.uuid].iMaxArrayPosHistoryNo,t.arrayCfg[e.uuid].iMaxArrayPosHistoryNo=r,t.arrayCfg[e.uuid].bStable||t.arrayCfg[e.uuid].iMaxArrayPosHistoryNo_last!=t.arrayCfg[e.uuid].iMaxArrayPosHistoryNo||(t.arrayCfg[e.uuid].bStable=!0,t.checkAllPosHistory()))}},this.checkPosHistory=function(e,r){for(var i=t.arrayPosHistory[e].length,n=0;n<i&&r-t.arrayPosHistory[e][n].time>t.fTimeLong;n++)t.arrayPosHistory[e].splice(n,1),i=t.arrayPosHistory[e].length,n--},this.checkAllPosHistory=function(){var e=t.arrayUuid.length,r=!0;t.iSumArrayPosHistoryCount=0;for(i=0;i<e;i++){if(!t.arrayCfg[t.arrayUuid[i]].bStable)return void(r=!1);t.iSumArrayPosHistoryCount+=t.arrayCfg[t.arrayUuid[i]].iMaxArrayPosHistoryNo}if(r){t.bAllStable=!0;for(var i=0;i<e;i++)0==i?1==e?t.initMesh(t.arrayUuid[i],"start|end"):t.initMesh(t.arrayUuid[i],"start"):i+1==e?t.initMesh(t.arrayUuid[i],"end"):t.initMesh(t.arrayUuid[i],"default")}},this.initMesh=function(e,r){if(null!=t.mesh&&GlobalsVariables.scene.remove(t.mesh),null==t.bufferGeometry&&(t.bufferGeometry=new THREE.BufferGeometry),t.arrayCfg[e].iStartIndex=t.iCurrentIndex,r.indexOf("start")>=0){var i=2*t.iSumArrayPosHistoryCount;t.iSumArrayPosHistoryCount;t.vertices=new Float32Array(3*i),t.indices=new Uint32Array(2*(t.iSumArrayPosHistoryCount-t.arrayCfg.length)*2*3),t.uvs=new Float32Array(2*i)}for(var n=new THREE.Quaternion,o=t.arrayCfg[e].iStartIndex,a=t.arrayCfg[e].iStartIndex+t.arrayCfg[e].iMaxArrayPosHistoryNo;o<a;o++){var s=t.fWidthEnd+(o-t.arrayCfg[e].iStartIndex)/t.arrayCfg[e].iMaxArrayPosHistoryNo*t.fWidthOffset,l=t.arrayPosHistory[e][o-t.arrayCfg[e].iStartIndex].pos.clone(),c=l.clone(),u=t.arrayPosHistory[e][o-t.arrayCfg[e].iStartIndex].rot.clone();u=u.normalize(),n.setFromEuler(new THREE.Euler(u.x,u.y,u.z));var h=new THREE.Vector3(s,0,0);h.applyQuaternion(n);var p=a-1-o,d=l.add(h);t.vertices[6*(t.arrayCfg[e].iStartIndex+p)+0]=d.x,t.vertices[6*(t.arrayCfg[e].iStartIndex+p)+1]=d.y,t.vertices[6*(t.arrayCfg[e].iStartIndex+p)+2]=d.z;var f=c.sub(h);t.vertices[6*(t.arrayCfg[e].iStartIndex+p)+3]=f.x,t.vertices[6*(t.arrayCfg[e].iStartIndex+p)+4]=f.y,t.vertices[6*(t.arrayCfg[e].iStartIndex+p)+5]=f.z}for(var m=t.arrayCfg[e].iStartIndex+t.arrayCfg[e].iMaxArrayPosHistoryNo-1,o=t.arrayCfg[e].iStartIndex;o<m;o++)t.indices[12*o+0]=2*o+0,t.indices[12*o+1]=2*o+1,t.indices[12*o+2]=2*o+2,t.indices[12*o+3]=2*o+2,t.indices[12*o+4]=2*o+1,t.indices[12*o+5]=2*o+3,t.indices[12*o+6]=2*o+0,t.indices[12*o+7]=2*o+2,t.indices[12*o+8]=2*o+1,t.indices[12*o+9]=2*o+2,t.indices[12*o+10]=2*o+3,t.indices[12*o+11]=2*o+1;var g=1/t.arrayCfg[e].iMaxArrayPosHistoryNo;if("Stretch"==t.shaderTexMode)for(var o=t.arrayCfg[e].iStartIndex,a=t.arrayCfg[e].iStartIndex+t.arrayCfg[e].iMaxArrayPosHistoryNo;o<a;o++)t.uvs[4*o+0]=(o-t.arrayCfg[e].iStartIndex)*g,t.uvs[4*o+1]=0,t.uvs[4*o+2]=(o-t.arrayCfg[e].iStartIndex)*g,t.uvs[4*o+3]=1;else for(var o=t.arrayCfg[e].iStartIndex,a=t.arrayCfg[e].iStartIndex+t.arrayCfg[e].iMaxArrayPosHistoryNo;o<a;o++)t.uvs[4*o+0]=(o-t.arrayCfg[e].iStartIndex)%2,t.uvs[4*o+1]=0,t.uvs[4*o+2]=(o-t.arrayCfg[e].iStartIndex)%2,t.uvs[4*o+3]=1;t.iCurrentIndex+=t.arrayCfg[e].iMaxArrayPosHistoryNo,r.indexOf("end")>=0&&(t.bufferGeometry.addAttribute("position",new THREE.BufferAttribute(t.vertices,3)),t.attributesVertices=this.bufferGeometry.attributes.position.array,t.bufferGeometry.addAttribute("uv",new THREE.BufferAttribute(t.uvs,2)),t.bufferGeometry.setIndex(new THREE.BufferAttribute(t.indices,1)),t.mesh=new THREE.Mesh(t.bufferGeometry,t.material),GlobalsVariables.scene.add(t.mesh),null!=t.onTriggerMeshInited&&void 0!=t.onTriggerMeshInited&&t.onTriggerMeshInited(t.mesh))},this.updateColor=function(e){null!=t.material&&void 0!=t.material&&(t.material.uniforms.color.value.x=e.r,t.material.uniforms.color.value.y=e.g,t.material.uniforms.color.value.z=e.b,t.material.uniforms.color.value.w=e.a,t.material.needsUpdate=!0)},this.updateMesh=function(e){for(var r=t.arrayPosHistory[e].length,i=new THREE.Quaternion,n=t.arrayCfg[e].iStartIndex,o=t.arrayCfg[e].iStartIndex+r;n<o;n++){var a=t.fWidthEnd+(n-t.arrayCfg[e].iStartIndex)/r*t.fWidthOffset,s=(l=t.arrayPosHistory[e][n-t.arrayCfg[e].iStartIndex].pos.clone()).clone();c=(c=t.arrayPosHistory[e][n-t.arrayCfg[e].iStartIndex].rot.clone()).normalize(),i.setFromEuler(new THREE.Euler(c.x,c.y,c.z));(u=new THREE.Vector3(a,0,0)).applyQuaternion(i);h=o-1-n;h=6*(t.arrayCfg[e].iStartIndex+h);p=l.add(u);t.attributesVertices[h+0]=p.x,t.attributesVertices[h+1]=p.y,t.attributesVertices[h+2]=p.z;d=s.sub(u);t.attributesVertices[h+3]=d.x,t.attributesVertices[h+4]=d.y,t.attributesVertices[h+5]=d.z}if(r<t.arrayCfg[e].iMaxArrayPosHistoryNo)for(var n=t.arrayCfg[e].iStartIndex+r,o=t.arrayCfg[e].iStartIndex+t.arrayCfg[e].iMaxArrayPosHistoryNo;n<o;n++){var l=t.arrayPosHistory[e][r-1].pos.clone(),s=l.clone(),c=t.arrayPosHistory[e][r-1].rot.clone();c=c.normalize(),i.setFromEuler(new THREE.Euler(c.x,c.y,c.z));var u=new THREE.Vector3(0,0,0);u.applyQuaternion(i);var h=6*(t.arrayCfg[e].iStartIndex+n),p=l.add(u);t.attributesVertices[h+0]=p.x,t.attributesVertices[h+1]=p.y,t.attributesVertices[h+2]=p.z;var d=s.sub(u);t.attributesVertices[h+3]=d.x,t.attributesVertices[h+4]=d.y,t.attributesVertices[h+5]=d.z}t.bufferGeometry.attributes.position.needsUpdate=!0}}(function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t():"function"==typeof define&&define.amd?define(t):t()}(0,function(){"use strict";var e=function(){this.pos=new THREE.Vector3,this.dir=new THREE.Vector3,this.right=new THREE.Vector3,this.up=new THREE.Vector3,this.dist=0,this.widthScale=1};e.prototype.lerpPathPoints=function(e,t,r){this.pos.lerpVectors(e.pos,t.pos,r),this.dir.lerpVectors(e.dir,t.dir,r),this.up.lerpVectors(e.up,t.up,r),this.right.lerpVectors(e.right,t.right,r),this.dist=(t.dist-e.dist)*r+e.dist,this.widthScale=(t.widthScale-e.widthScale)*r+e.widthScale};var t=function(){this.array=[],this.count=0};t.prototype.set=function(e,t,r,i){if(e.length<2)this.count=0;else{t=void 0!==t?t:.1,r=void 0!==r?r:10;for(var n=0,o=e.length;n<o;n++)0===n?this._start(e[n],e[n+1],i):n===o-1?this._end(e[n]):this._corner(e[n],e[n+1],t,r,i)}},t.prototype.distance=function(){return 0==this.count?0:this.array[this.count-1].dist},t.prototype._start=function(e,t,r){this.count=0;var i=this._getByIndex(this.count);if(i.pos.copy(e),i.dir.subVectors(t,e),r)i.up.copy(r);else{var n=Number.MAX_VALUE,o=Math.abs(i.dir.x),a=Math.abs(i.dir.y),s=Math.abs(i.dir.z);o<n&&(n=o,i.up.set(1,0,0)),a<n&&(n=a,i.up.set(0,1,0)),s<n&&i.up.set(0,0,1)}i.right.crossVectors(i.dir,i.up).normalize(),i.up.crossVectors(i.right,i.dir).normalize(),i.dist=0,i.widthScale=1,i.dir.normalize(),this.count++};var r=new THREE.Vector3,i=new THREE.Vector3,n=new THREE.Vector3,o=new THREE.Matrix4,a=new THREE.QuadraticBezierCurve3;t.prototype._corner=function(e,t,r,i,n){if(r>0&&i>0){for(var o=this.array[this.count-1],s=this._getCornerBezierCurve(o.pos,e,t,r,a).getPoints(i),l=0;l<i;l+=1)this._hardCorner(s[l],s[l+1],n);s[i].equals(t)||this._hardCorner(s[i],t,n)}else this._hardCorner(e,t,n)},t.prototype._hardCorner=function(e,t,a){var s=this.array[this.count-1],l=this._getByIndex(this.count),c=r.subVectors(e,s.pos),u=i.subVectors(t,e),h=c.length();if(c.normalize(),u.normalize(),l.pos.copy(e),l.dir.addVectors(c,u),l.dir.normalize(),a)1===l.dir.dot(a)?l.right.crossVectors(u,a).normalize():l.right.crossVectors(l.dir,a).normalize(),l.up.crossVectors(l.right,l.dir).normalize();else{l.up.copy(s.up);var p=n.crossVectors(s.dir,l.dir);if(p.length()>Number.EPSILON){p.normalize();var d=Math.acos(Math.min(Math.max(s.dir.dot(l.dir),-1),1));l.up.applyMatrix4(o.makeRotationAxis(p,d))}l.right.crossVectors(l.dir,l.up).normalize()}l.dist=s.dist+h;var f=c.dot(u);l.widthScale=Math.min(1/Math.sqrt((1+f)/2),1.414213562373)||1,this.count++},t.prototype._end=function(e){var t=this.array[this.count-1],i=this._getByIndex(this.count);i.pos.copy(e),i.dir.subVectors(e,t.pos);var n=i.dir.length();i.dir.normalize(),i.up.copy(t.up);var a=r.crossVectors(t.dir,i.dir);if(a.length()>Number.EPSILON){a.normalize();var s=Math.acos(Math.min(Math.max(t.dir.dot(i.dir),-1),1));i.up.applyMatrix4(o.makeRotationAxis(a,s))}i.right.crossVectors(i.dir,i.up).normalize(),i.dist=t.dist+n,i.widthScale=1,this.count++},t.prototype._getByIndex=function(t){return this.array[t]||(this.array[t]=new e),this.array[t]},t.prototype._getCornerBezierCurve=function(e,t,n,o,a){var s=r.subVectors(t,e),l=i.subVectors(n,t),c=s.length(),u=l.length();return s.normalize(),l.normalize(),c>o?a.v0.copy(t).sub(s.multiplyScalar(o)):a.v0.copy(e),a.v1.copy(t),u>o?a.v2.copy(t).add(l.multiplyScalar(o)):a.v2.copy(n),a};var s=function(){this._drawing=!1,this._includeDrawingPoint=!1,this._points=[],this._lastPoint=new THREE.Vector3,this._lastFixedPoint=new THREE.Vector3,this.fixRadius=.5,this.height=.1,this._cornerRadius=.2,this._cornerSplit=10,this._pathPointList=new t,this._dirty=!0,this.up=new THREE.Vector3(0,1,0)};Object.defineProperty(s.prototype,"cornerRadius",{set:function(e){this._cornerRadius=e,this._dirty=!0},get:function(){return this._cornerRadius}}),Object.defineProperty(s.prototype,"cornerSplit",{set:function(e){this._cornerSplit=e,this._dirty=!0},get:function(){return this._cornerSplit}}),s.prototype.getPoints=function(){if(this._includeDrawingPoint&&(this._points.pop(),this._includeDrawingPoint=!1),this._drawing&&this._points.length>0){var e=this._getLastFixedPoint();e&&(this._points.push(e),this._includeDrawingPoint=!0)}return this._points},s.prototype.getPathPointList=function(){return(this._drawing||this._dirty)&&(this._pathPointList.set(this.getPoints(),this._cornerRadius,this._cornerSplit,this.up),this._dirty=!1),this._pathPointList},s.prototype.update=function(e){this._lastPoint.copy(e),this._lastPoint.y+=this.height},s.prototype.confirm=function(){this._drawing=!0;var e=this._getLastFixedPoint();e&&(this._includeDrawingPoint&&(this._points.pop(),this._includeDrawingPoint=!1),this._points.push(e.clone())),this._dirty=!0},s.prototype.start=function(){this._drawing=!0,this._dirty=!0},s.prototype.stop=function(){this._drawing=!1,this._dirty=!0},s.prototype.clear=function(){this._drawing=!1,this._includeDrawingPoint=!1,this._points=[],this._dirty=!0};var l=new THREE.Vector3,c=new THREE.Vector3,u=new THREE.Vector3;s.prototype._getLastFixedPoint=function(){if(this._lastFixedPoint.copy(this._lastPoint),this._points.length>0){var e=this._includeDrawingPoint?this._points[this._points.length-2]:this._points[this._points.length-1];(function(e,t){return l.copy(t).sub(e).length()})(e,this._lastFixedPoint)<this.fixRadius&&(l.normalize().multiplyScalar(this.fixRadius),this._lastFixedPoint.copy(e).add(l));if(this._includeDrawingPoint?this._points.length>2:this._points.length>1){var t=this._includeDrawingPoint?this._points[this._points.length-3]:this._points[this._points.length-2];c.subVectors(e,t),u.subVectors(this._lastFixedPoint,e),c.normalize(),u.normalize();if(c.multiplyScalar(-1).dot(u)>.99)return null}}return this._lastFixedPoint};var h=function(e){THREE.BufferGeometry.call(this),e=e||3e3,this.addAttribute("position",new THREE.BufferAttribute(new Float32Array(3*e),3).setDynamic(!0)),this.addAttribute("normal",new THREE.BufferAttribute(new Float32Array(3*e),3).setDynamic(!0)),this.addAttribute("uv",new THREE.BufferAttribute(new Float32Array(2*e),2).setDynamic(!0)),this.drawRange.start=0,this.drawRange.count=0};h.prototype=Object.assign(Object.create(THREE.BufferGeometry.prototype),{constructor:h,update:function(e,t){t=t||{};var r=this._updateAttributes(e,t);this.drawRange.count=r},_resizeAttribute:function(e,t,r){for(;t.array.length<r;){var i=t.array.length;(t=t.clone()).setArray(new Float32Array(2*i)),this.addAttribute(e,t)}},_updateAttributes:function(t,r){function i(e,t,r){e.dir;var i=e.up,n=e.right;h.copy(n).multiplyScalar(t*e.widthScale),p.copy(n).multiplyScalar(-t*e.widthScale),h.add(e.pos),p.add(e.pos),l.push(p.x,p.y,p.z,h.x,h.y,h.z),c.push(i.x,i.y,i.z,i.x,i.y,i.z),u.push(r,0,r,1),s+=2}var n=r.width||.1,o=void 0!==r.progress?r.progress:1,a=void 0===r.arrow||r.arrow,s=0,l=[],c=[],u=[],h=new THREE.Vector3,p=new THREE.Vector3,d=new THREE.Vector3,f=t.distance();if(0==f)return 0;var m,g=o*f;if(g>0)for(var v=0;v<t.count;v++){var y=t.array[v];if(y.dist>g){var E=t.array[v-1];m=new e;var b=(g-E.dist)/(y.dist-E.dist);m.lerpPathPoints(E,y,b),i(m,n/2,m.dist/n);break}i(y,n/2,y.dist/n)}else m=t.array[0];a&&function(e,t,r){var i=e.dir,n=e.up,o=e.right;h.copy(o).multiplyScalar(2*t),p.copy(o).multiplyScalar(2*-t),d.copy(i).setLength(3*t),h.add(e.pos),p.add(e.pos),d.add(e.pos),l.push(p.x,p.y,p.z,h.x,h.y,h.z,d.x,d.y,d.z),c.push(n.x,n.y,n.z,n.x,n.y,n.z,n.x,n.y,n.z),u.push(r,-.5,r,1.5,r+3*t/(2*t),.5),s+=3}(m=m||t.array[t.count-1],n/2,m.dist/n);var x=this.getAttribute("position"),_=this.getAttribute("normal"),w=this.getAttribute("uv");return this._resizeAttribute("position",x,l.length),this._resizeAttribute("normal",_,c.length),this._resizeAttribute("uv",w,u.length),x=this.getAttribute("position"),_=this.getAttribute("normal"),w=this.getAttribute("uv"),x.array.set(l,0),_.array.set(c,0),w.array.set(u,0),x.updateRange.count=l.length,_.updateRange.count=c.length,w.updateRange.count=u.length,x.needsUpdate=!0,_.needsUpdate=!0,w.needsUpdate=!0,s}});var p=function(e){h.call(this,e||1e3),this.setIndex(new Array(2*(e||1e3)))};p.prototype=Object.assign(Object.create(h.prototype),{constructor:p,_resizeIndex:function(e,t){for(;e.array.length<t;){var r=e.array.length;(e=e.clone()).setArray(2*r>65535?new Uint32Array(2*r):new Uint16Array(2*r)),this.setIndex(e)}},_updateAttributes:function(t,r){function i(e,t,r,i){for(var n=0===l.length,o=0;o<=r;o++){var a=o;a==r&&(a=0),d.copy(e.up).applyAxisAngle(e.dir,2*Math.PI*a/r).normalize(),l.push(e.pos.x+d.x*t*e.widthScale,e.pos.y+d.y*t*e.widthScale,e.pos.z+d.z*t*e.widthScale),c.push(d.x,d.y,d.z),u.push(i,o/r),p++}if(!n)for(var f=p-2*(r+1),m=p-(r+1),g=0;g<r;g++)h.push(f+g+1,f+g,m+g,m+g+1,f+g+1,m+g),s+=6}var n=r.radius||.1,o=r.radialSegments||8;o=Math.max(2,o);var a=void 0!==r.progress?r.progress:1,s=0,l=[],c=[],u=[],h=[],p=0,d=new THREE.Vector3,f=a*t.distance();if(0==f)return 0;if(f>0)for(var m=0;m<t.count;m++){var g=t.array[m];if(g.dist>f){var v=t.array[m-1],y=new e,E=(f-v.dist)/(g.dist-v.dist);y.lerpPathPoints(v,g,E),i(y,n,o,y.dist/(2*n*Math.PI));break}i(g,n,o,g.dist/(2*n*Math.PI))}var b=this.getAttribute("position"),x=this.getAttribute("normal"),_=this.getAttribute("uv"),w=this.getIndex();return this._resizeAttribute("position",b,l.length),this._resizeAttribute("normal",x,c.length),this._resizeAttribute("uv",_,u.length),this._resizeIndex(w,h.length),b=this.getAttribute("position"),x=this.getAttribute("normal"),_=this.getAttribute("uv"),w=this.getIndex(),b.array.set(l,0),x.array.set(c,0),_.array.set(u,0),w.set(h,0),b.updateRange.count=l.length,x.updateRange.count=c.length,_.updateRange.count=u.length,w.updateRange.count=h.length,b.needsUpdate=!0,x.needsUpdate=!0,_.needsUpdate=!0,w.needsUpdate=!0,s}}),THREE.Path3D=s,THREE.PathPointList=t,THREE.PathGeometry=h,THREE.PathTubeGeometry=p})),function(e){function t(e,t){for(var r=-1,i=0;i<t.length;i++)t[i].equals(e)&&(r=i);return r}function r(e){var t={};for(key in e)t[key]=Object.assign({},e[key]);return t}var i=function(e){this._navigations=e,this._map=null,this._connectNavMap=null,this._connectPoints=[],this._init()};Object.assign(i.prototype,{_init:function(){this._map={},this._connectNavMap={};for(var e=0;e<this._navigations.length;e++){for(var r=this._navigations[e],i=r.getExtraPoints(),n=0;n<i.length;n++){var o=i[n],a=t(o,this._connectPoints);a<0?(a=this._connectPoints.length,o._index=a,this._connectPoints.push(o)):o._index=this._connectPoints[a]._index}if(i.length>1)for(n=0;n<i.length;n++)for(var s=0;s<i.length;s++)if(s!==n){var l=r.getDistance(i[s],i[n]),c=i[s]._index,u=i[n]._index;this._map[c]=this._map[c]||{},this._map[u]=this._map[u]||{},this._map[c][u]=l,this._map[u][c]=l,this._connectNavMap[c]=this._connectNavMap[c]||{},this._connectNavMap[u]=this._connectNavMap[u]||{},this._connectNavMap[c][u]=r,this._connectNavMap[u][c]=r}}},findPath:function(e,i,n,o){function a(e,r,i){for(var n=r.getExtraPoints(),o=0;o<n.length;o++){var a=t(n[o],i),c=r.getDistance(e,n[o]);s[f]=s[f]||{},s[a]=s[a]||{},s[f][a]=c,s[a][f]=c,l[f]=l[f]||{},l[a]=l[a]||{},l[f][a]=r,l[a][f]=r}}if(e==n)return this._navigations[e].findPath(i,o);if(0==this._navigations[e].getExtraPoints().length||0==this._navigations[n].getExtraPoints().length)return console.info("closed space: "+e+" or "+n),[];var s=r(this._map),l=r(this._connectNavMap),c=0,u=0,h=this._connectPoints.length,p=0,d=this._navigations[e];if(i=d.findNearestPathPoint(i).clone(),t(i,this._connectPoints)<0){f=h+p;p++,a(i,d,this._connectPoints),this._connectPoints.push(i),c=f}else c=t(i,this._connectPoints);if(o=(d=this._navigations[n]).findNearestPathPoint(o).clone(),t(o,this._connectPoints)<0){var f=h+p;p++,a(o,d,this._connectPoints),this._connectPoints.push(o),u=f}else u=t(o,this._connectPoints);for(var m=Graph.findShortestPath(s,c,u),g=[],v=0;v<m.length-1;v++){var y=+m[v],E=+m[v+1],b=(d=l[y][E]).findPath(this._connectPoints[y],this._connectPoints[E]);0!==v&&b.shift(),g=g.concat(b)}return this._connectPoints.length=h,g}}),e.GroupNavigation=i}(window),function(e){function t(e,t){for(var r=1/0,i=0,n=0,o=t.length;n<o;n++){var a=e.distanceTo(t[n]);a<r&&(r=a,i=n)}return i}function r(e,t,r){return n.copy(t).sub(e),o.copy(t).sub(r),n.angleTo(o)}var i=function(e,t,r){this._delaunayTriangles=null,this._rebuiltTriangles=null,this._points=[],this._indices=[],this._graph=null,this._extraIds=[],this._init(e,t,r||40)};Object.assign(i.prototype,{_init:function(e,r,i){var n=new THREE.Geometry;n.fromBufferGeometry(e),n.mergeVertices();var o=n.vertices[0].y,a=function(e,t){function r(e){for(var t=1/0,r=0;r<e.length;r++)e[r].x<t&&(t=e[r].x),e[r].y<1/0&&(t=e[r].y);return{x:t,y:1/0}}function i(t,r){for(var i=[],n=0,o=t.length;n<o;n++){var a=e.vertices[t[n]];if(void 0!==r&&0!==i.length){for(var s=i[i.length-1],l=new poly2tri.Point(a.x,a.z),c=Math.ceil(l.clone().sub(s).length()/r),u=l.clone().sub(s).length()/c,h=l.clone().sub(s),p=1;p<c;p++)h.normalize(),i.push(s.clone().add(h.mul(u*p)));i.push(l.clone())}else i.push(new poly2tri.Point(a.x,a.z))}if(void 0!==r)for(var s=i[i.length-1],l=i[0],c=Math.ceil(l.clone().sub(s).length()/r),u=l.clone().sub(s).length()/c,h=l.clone().sub(s),p=1;p<c;p++)h.normalize(),i.push(s.clone().add(h.mul(u*p)));return i}for(var n={},o=0,a=e.faces,s=a.length;o<s;o++)for(var l=[a[o].a,a[o].b,a[o].c].sort(function(e,t){return e-t}),c=[[0,1],[1,2],[0,2]],u=0;u<c.length;u++){var h=l[c[u][0]],p=l[c[u][1]];n[h+"_"+p]?n[h+"_"+p].count++:n[h+"_"+p]={start:h,end:p,count:1}}var d=[];for(var f in n)1===n[f].count&&d.push(n[f]);for(var m=[];d.length>0;){var g=[],v=d[0].start,y=d[0].end;for(g.push(d[0].end),d.splice(0,1);y!==v;)for(var o=0,s=d.length;o<s;o++){if(d[o].start==y){g.push(d[o].end),y=d[o].end,d.splice(o,1);break}if(d[o].end==y){g.push(d[o].start),y=d[o].start,d.splice(o,1);break}}m.push(g)}for(var E=1/0,b=1/0,x=0,_=[],o=0,s=m.length;o<s;o++){var w=i(m[o],t);_.push(w);var T=r(w);(T.x<E||T.y<b)&&(E=T.x,b=T.y,x=o)}var M=_[x];return _.splice(x,1),{contour:M,holes:_}}(n,i),s=new poly2tri.SweepContext(a.contour);if(s.addHoles(a.holes),s.triangulate(),this._delaunayTriangles=s.getTriangles(),this._rebuiltTriangles=function(e,t){for(var r=[],i=0;i<e.length;i++){var n=e[i].getPoints(),o=new THREE.Triangle;o.a.set(n[0].x,t,n[0].y),o.b.set(n[1].x,t,n[1].y),o.c.set(n[2].x,t,n[2].y),r.push(o)}return r}(this._delaunayTriangles,o),function(e,t,r,i){var n=0;e.forEach(function(e){for(var t=0;t<e.points_.length;t++)void 0===e.points_[t]._id&&(e.points_[t]._id=n++)});var o=[[1,2],[0,2],[0,1]],a={},s=[],l=0;e.forEach(function(e){s.length=0;for(var n=0;n<3;n++)if(!e.constrained_edge[n]){var c=e.getPoint(o[n][0]),u=e.getPoint(o[n][1]);if(!a[c._id+"_"+u._id]){var h=new THREE.Vector3((c.x+u.x)/2,i,(c.y+u.y)/2);h._index=l++,t.push(h),a[c._id+"_"+u._id]=h,a[u._id+"_"+c._id]=h}s.push(a[c._id+"_"+u._id])}2===s.length&&r.push(s[0]._index,s[1]._index),3===s.length&&(r.push(s[0]._index,s[1]._index),r.push(s[1]._index,s[2]._index),r.push(s[2]._index,s[0]._index))})}(this._delaunayTriangles,this._points,this._indices,o),r&&r.length>0)for(var l=0;l<r.length;l++){var c=r[l],u=this._points.length,h=t(c,this._points);this._points.push(c.clone()),this._indices.push(u,h),this._extraIds.push(u)}this._graph=function(e,t){for(var r={},i=0,n=t.length;i<n;i+=2){var o=t[i+0],a=t[i+1],s=e[o],l=e[a];r[o]=r[o]||{},r[a]=r[a]||{},r[o][a]=r[a][o]=s.distanceTo(l)}return new Graph(r)}(this._points,this._indices)},findPath:function(e,i,n){for(var n=void 0!==n&&n,o=t(e,this._points),a=t(i,this._points),s=this._graph.findShortestPath(o,a),l=n?[e.clone()]:[],c=0,u=s.length;c<u;c++)l.push(this._points[+s[c]].clone());if(n&&l.push(i.clone()),n&&(l.length>3&&r(l[0],l[1],l[2])<.25*Math.PI&&l.splice(1,1),l.length>3)){var h=l.length-1,p=l.length-2,d=l.length-3;r(l[h],l[p],l[d])<.25*Math.PI&&l.splice(p,1)}return l},getExtraPoints:function(){var e=[],t=this;return this._extraIds.forEach(function(r){e.push(t._points[r])}),e},getDistance:function(e,r){for(var i=t(e,this._points),n=t(r,this._points),o=this._graph.findShortestPath(i,n),a=0,s=0,l=o.length;s<l-1;s++){var c=o[s],u=o[s+1];a+=this._graph.map[c][u]}return a},findNearestPathPoint:function(e){var r=t(e,this._points);return this._points[r]},getPoints:function(){return this._points},getIndices:function(){return this._indices},getRebuiltTriangles:function(){return this._rebuiltTriangles}}),e.MeshNavigation=i;var n=new THREE.Vector3,o=new THREE.Vector3}(window),function(e){var t=function(e){this._navigation=e};Object.assign(t.prototype,{createPathPointsMesh:function(){for(var e=this._navigation.getPoints(),t=[],r=0,i=e.length;r<i;r++){e[r].toArray(t,3*r)}var n=new THREE.BufferGeometry;n.addAttribute("position",new THREE.BufferAttribute(new Float32Array(t),3));return new THREE.Points(n)},createPathLineSegmentsMesh:function(){for(var e=this._navigation,t=e.getPoints(),r=[],i=e.getIndices(),n=0,o=t.length;n<o;n++){t[n].toArray(r,3*n)}var a=new THREE.BufferGeometry;a.addAttribute("position",new THREE.BufferAttribute(new Float32Array(r),3)),a.setIndex(i);return new THREE.LineSegments(a)},createRebuiltTrianglesMesh:function(){for(var e=this._navigation.getRebuiltTriangles(),t=[],r=0,i=e.length;r<i;r++){var n=e[r];n.a.toArray(t,18*r+0),n.b.toArray(t,18*r+3),n.b.toArray(t,18*r+6),n.c.toArray(t,18*r+9),n.c.toArray(t,18*r+12),n.a.toArray(t,18*r+15)}var o=new THREE.BufferGeometry;o.addAttribute("position",new THREE.BufferAttribute(new Float32Array(t),3));return new THREE.LineSegments(o)},createPathNodeByPoints:function(e){for(var t=[],r=0,i=e.length;r<i;r++){e[r].toArray(t,3*r)}for(var n=[],r=0,i=e.length;r<i;r++)r!==i-1&&n.push(r,r+1);var o=new THREE.Group,a=new THREE.BufferGeometry;a.addAttribute("position",new THREE.BufferAttribute(new Float32Array(t),3));var s=new THREE.Points(a);o.add(s);var l=new THREE.BufferGeometry;l.addAttribute("position",new THREE.BufferAttribute(new Float32Array(t),3)),l.setIndex(n);var c=new THREE.LineSegments(l);return o.add(c),o}}),e.MeshNavigationHelper=t}(window),function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t():"function"==typeof define&&define.amd?define(t):t()}(0,function(){"use strict";function e(e,t){this.id=++u,this._renderTarget=new THREE.WebGLRenderTarget(e,t,{minFilter:THREE.NearestFilter,magFilter:THREE.NearestFilter,format:THREE.RGBAFormat,type:THREE.HalfFloat}),this._renderTarget.depthTexture=new THREE.DepthTexture(e,t),this._renderTarget.depthTexture.format=THREE.DepthStencilFormat,this._renderTarget.depthTexture.type=THREE.UnsignedInt248Type,this._normalMaterial=new THREE.MeshNormalMaterial,this.ignoreTransparent=!0;var r=this;THREE.MaterialManager.addStrategy("NormalDepthPrePass"+this.id,function(e,t,i,n,o,a){return r.ignoreTransparent&&o.transparent?null:r.ignoreTransparent&&o.alphaTest>0?null:r._normalMaterial})}function t(e){for(var t=new Uint8Array(e*e*4),r=0,i=new THREE.Vector3,n=0;n<e;n++)for(var o=0;o<e;o++)i.set(2*Math.random()-1,2*Math.random()-1,0).normalize(),t[r++]=255*(.5*i.x+.5),t[r++]=255*(.5*i.y+.5),t[r++]=0,t[r++]=255;return t}function r(e,t){for(var r=0,i=1/t,n=e;n>0;)r+=i*(n%t),n=Math.floor(n/t),i/=t;return r}function i(e,t){this._tempRenderTarget=new THREE.WebGLRenderTarget(e,t,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat}),this._tempRenderTarget2=new THREE.WebGLRenderTarget(e,t,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat}),this.ssaoMaterial=new THREE.ShaderMaterial({defines:Object.assign({},h.defines),fragmentShader:h.fragmentShader,vertexShader:h.vertexShader,uniforms:THREE.UniformsUtils.clone(h.uniforms),depthTest:!1,depthWrite:!1}),this.blurMaterial=new THREE.ShaderMaterial({defines:Object.assign({},THREE.SuperSSAOBlurShader.defines),fragmentShader:THREE.SuperSSAOBlurShader.fragmentShader,vertexShader:THREE.SuperSSAOBlurShader.vertexShader,uniforms:THREE.UniformsUtils.clone(THREE.SuperSSAOBlurShader.uniforms),depthTest:!1,depthWrite:!1,transparent:!0,blending:THREE.CustomBlending,blendSrc:THREE.ZeroFactor,blendDst:THREE.SrcColorFactor,blendEquation:THREE.AddEquation,blendSrcAlpha:THREE.ZeroFactor,blendDstAlpha:THREE.SrcColorFactor,blendEquationAlpha:THREE.AddEquation}),this.quadCamera=new THREE.OrthographicCamera(-1,1,1,-1,0,1),this.quadScene=new THREE.Scene,this.quad=new THREE.Mesh(new THREE.PlaneGeometry(2,2),null),this.quadScene.add(this.quadCamera),this.quadScene.add(this.quad),this._kernels={},this.setNoiseSize(4),this.setKernelSize(12),this.setParameter("radius",.2),this.setParameter("bias",.004),this.setParameter("power",1),this.setParameter("intensity",.8),this.ssaoMaterial.uniforms.texSize.value.set(e,t),this.blurMaterial.uniforms.textureSize.value.set(e,t)}function n(e,t,r){this._samplingSize=r||30;for(var i=[],n=0;n<this._samplingSize;n++)i.push([p(n,2),p(n,3)]);this._haltonSequence=i,this._prevFrame=new THREE.WebGLRenderTarget(e,t,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat}),this._output=new THREE.WebGLRenderTarget(e,t,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat}),this._frame=0,this.quadCamera=new THREE.OrthographicCamera(-1,1,1,-1,0,1),this.quadScene=new THREE.Scene,this.quad=new THREE.Mesh(new THREE.PlaneGeometry(2,2),new THREE.ShaderMaterial({uniforms:THREE.UniformsUtils.clone(THREE.BlendShader.uniforms),vertexShader:THREE.BlendShader.vertexShader,fragmentShader:THREE.BlendShader.fragmentShader,depthTest:!1,depthWrite:!1})),this.quadScene.add(this.quadCamera),this.quadScene.add(this.quad)}function o(e,t){this.id=++v,this.selectedObjects=new Set,this.edgeColor=new THREE.Color(1,1,1),this.edgeGlow=0,this.edgeThickness=1,this.edgeStrength=1.5,this.downSampleRatio=2;var r={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat},i=Math.round(e/this.downSampleRatio),n=Math.round(t/this.downSampleRatio);this.renderTargetMaskBuffer0=new THREE.WebGLRenderTarget(e,t,r),this.renderTargetMaskBuffer0.texture.name="OutlinePass.mask0",this.renderTargetMaskBuffer0.multipleSampling=5,this.renderTargetMaskBuffer0.texture.generateMipmaps=!1,this.renderTargetMaskBuffer=new THREE.WebGLRenderTarget(e,t,r),this.renderTargetMaskBuffer.texture.name="OutlinePass.mask",this.renderTargetMaskBuffer.texture.generateMipmaps=!1,this.renderTargetMaskDownSampleBuffer=new THREE.WebGLRenderTarget(i,n,r),this.renderTargetMaskDownSampleBuffer.texture.name="OutlinePass.depthDownSample",this.renderTargetMaskDownSampleBuffer.texture.generateMipmaps=!1,this.renderTargetBlurBuffer1=new THREE.WebGLRenderTarget(i,n,r),this.renderTargetBlurBuffer1.texture.name="OutlinePass.blur1",this.renderTargetBlurBuffer1.texture.generateMipmaps=!1,this.renderTargetBlurBuffer2=new THREE.WebGLRenderTarget(Math.round(i/2),Math.round(n/2),r),this.renderTargetBlurBuffer2.texture.name="OutlinePass.blur2",this.renderTargetBlurBuffer2.texture.generateMipmaps=!1,this.renderTargetEdgeBuffer1=new THREE.WebGLRenderTarget(i,n,r),this.renderTargetEdgeBuffer1.texture.name="OutlinePass.edge1",this.renderTargetEdgeBuffer1.texture.generateMipmaps=!1,this.renderTargetEdgeBuffer2=new THREE.WebGLRenderTarget(Math.round(i/2),Math.round(n/2),r),this.renderTargetEdgeBuffer2.texture.name="OutlinePass.edge2",this.renderTargetEdgeBuffer2.texture.generateMipmaps=!1,this.prepareMaskMaterial=new THREE.ShaderMaterial(d),this.prepareMaskMaterial.side=THREE.DoubleSide,this.prepareMaskMaterial.renderingOutline=!0,this.prepareMaskSkinningMaterial=new THREE.ShaderMaterial(d),this.prepareMaskSkinningMaterial.side=THREE.DoubleSide,this.prepareMaskSkinningMaterial.skinning=!0;var o=this;THREE.MaterialManager.addStrategy("OutlinePass"+this.id,function(e,t,r,i,n,a){return this.userData.outline!=o.id||this.userData.skipOutline?null:this.isSkinnedMesh?o.prepareMaskSkinningMaterial:o.prepareMaskMaterial}),this.edgeDetectionMaterial=new THREE.ShaderMaterial({uniforms:THREE.UniformsUtils.clone(f.uniforms),vertexShader:f.vertexShader,fragmentShader:f.fragmentShader});this.separableBlurMaterial1=new THREE.ShaderMaterial({defines:Object.assign({},m.defines),uniforms:THREE.UniformsUtils.clone(m.uniforms),vertexShader:m.vertexShader,fragmentShader:m.fragmentShader}),this.separableBlurMaterial1.defines.MAX_RADIUS=4,this.separableBlurMaterial1.uniforms.texSize.value=new THREE.Vector2(i,n),this.separableBlurMaterial1.uniforms.kernelRadius.value=1,this.separableBlurMaterial2=new THREE.ShaderMaterial({defines:Object.assign({},m.defines),uniforms:THREE.UniformsUtils.clone(m.uniforms),vertexShader:m.vertexShader,fragmentShader:m.fragmentShader}),this.separableBlurMaterial2.defines.MAX_RADIUS=4,this.separableBlurMaterial2.uniforms.texSize.value=new THREE.Vector2(Math.round(i/2),Math.round(n/2)),this.separableBlurMaterial2.uniforms.kernelRadius.value=4,this.overlayMaterial=new THREE.ShaderMaterial({uniforms:THREE.UniformsUtils.clone(g.uniforms),vertexShader:g.vertexShader,fragmentShader:g.fragmentShader,blending:THREE.NormalBlending,depthTest:!1,depthWrite:!1,transparent:!0});var a=THREE.CopyShader;this.copyUniforms=THREE.UniformsUtils.clone(a.uniforms),this.copyUniforms.opacity.value=1,this.materialCopy=new THREE.ShaderMaterial({uniforms:this.copyUniforms,vertexShader:a.vertexShader,fragmentShader:a.fragmentShader,blending:THREE.NoBlending,depthTest:!1,depthWrite:!1,transparent:!0}),this.camera=new THREE.OrthographicCamera(-1,1,1,-1,0,1),this.scene=new THREE.Scene,this.quad=new THREE.Mesh(new THREE.PlaneBufferGeometry(2,2),null),this.quad.frustumCulled=!1,this.scene.add(this.quad),this.tempPulseColor1=new THREE.Color,this.tempPulseColor2=new THREE.Color,this.textureMatrix=new THREE.Matrix4,this.oldClearColor=new THREE.Color,this.oldClearAlpha=1,this._dirty=!0}function a(e,t){THREE.Pass.call(this),this.textureID=void 0!==t?t:"tDiffuse",e instanceof THREE.ShaderMaterial?(this.uniforms=e.uniforms,this.material=e):e&&(this.uniforms=THREE.UniformsUtils.clone(e.uniforms),this.material=new THREE.ShaderMaterial({defines:Object.assign({},e.defines),uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),this.camera=new THREE.OrthographicCamera(-1,1,1,-1,0,1),this.scene=new THREE.Scene,this.quad=new THREE.Mesh(new THREE.PlaneBufferGeometry(2,2),null),this.quad.frustumCulled=!1,this.scene.add(this.quad)}function s(e,t){if("[object Object]"!==t.toString())return t;for(var r in t)t.hasOwnProperty(r)&&(e||(e={}),e[r]=s(e[r],t[r]));return e}function l(t,r){this._superSampler=new n(t,r,30),this._tempRenderTarget0=new THREE.WebGLRenderTarget(t,r,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat}),this._tempRenderTarget0.multipleSampling=5,this._tempRenderTarget=new THREE.WebGLRenderTarget(t,r,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat}),this._tempRenderTarget2=new THREE.WebGLRenderTarget(t,r,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat}),this._ssaoPrePass=new i(t,r),this._ssaoKernalSize=12,this._normalDepthPrePass=new e(t,r),this._bloomPass=new THREE.UnrealBloomPass({x:t,y:r},.14,.4,.6),this._colorPass=new a(c),this._colorPass.clear=!0,this._fxaaPass=new a(THREE.FXAAShader),this._fxaaPass.uniforms.resolution.value.set(1/t,1/r),this._fxaaPass.clear=!0,this._copyPass=new a(THREE.CopyShader),this._copyPass.clear=!0,this._copyPass2=new a(THREE.CopyShader),this._copyPass2.clear=!1,this._copyPass2.material.transparent=!0,this._outlinePasses=new Map,this._config=s({},y),this.setConfig({}),this.width=t,this.height=r,this.enableOutline=!0,this.ignoreSkyBox=!1,this.onlyAO=!1}var c={uniforms:{tDiffuse:{value:null},brightness:{value:0},contrast:{value:1},exposure:{value:0},gamma:{value:1},saturation:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","varying vec2 vUv;","uniform float brightness;","uniform float contrast;","uniform float exposure;","uniform float gamma;","uniform float saturation;","const vec3 w = vec3(0.2125, 0.7154, 0.0721);","void main() {","vec4 tex = texture2D( tDiffuse, vUv );","vec3 color = clamp(tex.rgb + vec3(brightness), 0.0, 1.0);","color = clamp( (color-vec3(0.5))*contrast+vec3(0.5), 0.0, 1.0);","color = clamp( color * pow(2.0, exposure), 0.0, 1.0);","color = clamp( pow(color, vec3(gamma)), 0.0, 1.0);","float luminance = dot( color, w );","color = mix(vec3(luminance), color, saturation);","gl_FragColor = vec4(color, tex.a);","}"].join("\n")},u=0;e.prototype=Object.assign(e.prototype,{setSize:function(e,t){this._renderTarget.setSize(e,t)},render:function(e,t,r,i){this.ignoreTransparent=i;var n=e.getClearColor().getHex(),o=e.getClearAlpha();e.setClearColor(7829503,1),THREE.MaterialManager.mode="NormalDepthPrePass"+this.id,t.autoUpdate=!1,e.render(t,r,this._renderTarget,!0),t.autoUpdate=!0,THREE.MaterialManager.mode=0,e.setClearColor(n,o)},getNormalTexture:function(){return this._renderTarget.texture},getDepthTexture:function(){return this._renderTarget.depthTexture}});var h={defines:{DEPTH_PACKING:1,KERNEL_SIZE:64,EPSILON:1e-6},uniforms:{normalTex:{value:null},depthTex:{value:null},noiseTex:{value:null},texSize:{value:new THREE.Vector2},noiseTexSize:{value:new THREE.Vector2(4,4)},projection:{value:new THREE.Matrix4},projectionInv:{value:new THREE.Matrix4},kernel:{value:null},radius:{value:.2},power:{value:1},bias:{value:.004},intensity:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["precision highp sampler2D;","#include <packing>","varying vec2 vUv;","uniform sampler2D normalTex;","uniform sampler2D depthTex;","uniform vec2 texSize;","uniform sampler2D noiseTex;","uniform vec2 noiseTexSize;","uniform mat4 projection;","uniform mat4 projectionInv;","uniform vec3 kernel[KERNEL_SIZE];","uniform float radius;","uniform float power;","uniform float bias;","uniform float intensity;","float getDepth( const in vec2 screenPosition ) {","#if DEPTH_PACKING == 1","return unpackRGBAToDepth( texture2D( depthTex, screenPosition ) );","#elif DEPTH_PACKING == 2","return texture2D( depthTex, screenPosition ).w;","#else","return texture2D( depthTex, screenPosition ).x;","#endif","}","vec3 getViewNormal( const in vec2 screenPosition ) {","return unpackRGBToNormal( texture2D( normalTex, screenPosition ).xyz );","}","float ssaoEstimator(in mat3 kernelBasis, in vec3 originPos, in vec3 N) {","float occlusion = 0.0;","for (int i = 0; i < KERNEL_SIZE; i++) {","vec3 samplePos = kernel[i];","samplePos = kernelBasis * samplePos;","samplePos = samplePos * radius + originPos;","vec4 texCoord = projection * vec4(samplePos, 1.0);","texCoord.xy /= texCoord.w;","texCoord.xy = texCoord.xy * 0.5 + 0.5;","float sampleDepth = getDepth(texCoord.xy);","float z = sampleDepth * 2.0 - 1.0;","#ifdef ALCHEMY","vec4 projectedPos = vec4(texCoord.xy * 2.0 - 1.0, z, 1.0);","vec4 p4 = projectionInv * projectedPos;","p4.xyz /= p4.w;","vec3 cDir = p4.xyz - originPos;","float vv = dot(cDir, cDir);","float vn = dot(cDir, N);","float radius2 = radius * radius;","vn = max(vn + p4.z * bias, 0.0);","float f = max(radius2 - vv, 0.0) / radius2;","occlusion += f * f * f * max(vn / (0.01 + vv), 0.0);","#else","if (projection[3][3] == 0.0) {","z = projection[3][2] / (z * projection[2][3] - projection[2][2]);","} else {","z = (z - projection[3][2]) / projection[2][2];","}","float factor = step(samplePos.z, z - bias);","float rangeCheck = smoothstep(0.0, 1.0, radius / abs(originPos.z - z));","occlusion += rangeCheck * factor;","#endif","}","occlusion = 1.0 - occlusion / float(KERNEL_SIZE);","return pow(occlusion, power);","}","void main() {","float centerDepth = getDepth( vUv );","if( centerDepth >= ( 1.0 - EPSILON ) ) {","\tdiscard;","}","vec3 N = getViewNormal( vUv );","vec2 noiseTexCoord = texSize / vec2(noiseTexSize) * vUv;","vec3 rvec = texture2D(noiseTex, noiseTexCoord).rgb * 2.0 - 1.0;","vec3 T = normalize(rvec - N * dot(rvec, N));","vec3 BT = normalize(cross(N, T));","mat3 kernelBasis = mat3(T, BT, N);","float z = centerDepth * 2.0 - 1.0;","vec4 projectedPos = vec4(vUv * 2.0 - 1.0, z, 1.0);","vec4 p4 = projectionInv * projectedPos;","vec3 position = p4.xyz / p4.w;","float ao = ssaoEstimator(kernelBasis, position, N);","ao = clamp(1.0 - (1.0 - ao) * intensity, 0.0, 1.0);","gl_FragColor = vec4(vec3(ao), 1.0);","}"].join("\n")};THREE.SuperSSAOBlurShader={defines:{NORMALTEX_ENABLED:1,DEPTHTEX_ENABLED:1,DEPTH_PACKING:1},uniforms:{tDiffuse:{value:null},textureSize:{value:new THREE.Vector2},direction:{value:0},blurSize:{value:1},depthTex:{value:null},normalTex:{value:null},projection:{value:new THREE.Matrix4},depthRange:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["#include <packing>","varying vec2 vUv;","uniform vec2 textureSize;","uniform float blurSize;","uniform sampler2D tDiffuse;","uniform int direction;","#if NORMALTEX_ENABLED == 1","uniform sampler2D normalTex;","vec3 getViewNormal( const in vec2 screenPosition ) {","return unpackRGBToNormal( texture2D( normalTex, screenPosition ).xyz );","}","#endif","#if DEPTHTEX_ENABLED == 1","uniform sampler2D depthTex;","uniform mat4 projection;","uniform float depthRange;","float getDepth( const in vec2 screenPosition ) {","#if DEPTH_PACKING == 1","return unpackRGBAToDepth( texture2D( depthTex, screenPosition ) );","#elif DEPTH_PACKING == 2","return texture2D( depthTex, screenPosition ).w;","#else","return texture2D( depthTex, screenPosition ).x;","#endif","}","float getLinearDepth(vec2 coord) {","float depth = getDepth(coord) * 2.0 - 1.0;","return projection[3][2] / (depth * projection[2][3] - projection[2][2]);","}","#endif","void main() {","float kernel[5];","kernel[0] = 0.122581;","kernel[1] = 0.233062;","kernel[2] = 0.288713;","kernel[3] = 0.233062;","kernel[4] = 0.122581;","vec2 off = vec2(0.0);","if (direction == 0) {","off[0] = blurSize / textureSize.x;","}","else {","off[1] = blurSize / textureSize.y;","}","float sum = 0.0;","float weightAll = 0.0;","#if NORMALTEX_ENABLED == 1","vec3 centerNormal = getViewNormal(vUv);","#endif","#if DEPTHTEX_ENABLED == 1","float centerDepth = getLinearDepth(vUv);","#endif","for (int i = 0; i < 5; i++) {","vec2 coord = clamp(vUv + vec2(float(i) - 2.0) * off, vec2(0.0), vec2(1.0));","float w = kernel[i];","#if NORMALTEX_ENABLED == 1","vec3 normal = getViewNormal(coord);","w *= clamp(dot(normal, centerNormal), 0.0, 1.0);","#endif","#if DEPTHTEX_ENABLED == 1","float d = getLinearDepth(coord);","w *= (1.0 - smoothstep(0.0, 1.0, abs(centerDepth - d) / depthRange));","#endif","weightAll += w;","sum += w * texture2D(tDiffuse, coord).r;","}","gl_FragColor = vec4(vec3(sum / weightAll), 1.0);","}"].join("\n")},i.prototype=Object.assign(i.prototype,{constructor:i,setSize:function(e,t){this._tempRenderTarget.setSize(e,t),this._tempRenderTarget2.setSize(e,t),this.ssaoMaterial.uniforms.texSize.value.set(e,t),this.blurMaterial.uniforms.textureSize.value.set(e,t)},render:function(e,t,r,i,n,o){this.ssaoMaterial.uniforms.normalTex.value=e,this.ssaoMaterial.uniforms.depthTex.value=t,this.ssaoMaterial.uniforms.projection.value.copy(i.projectionMatrix),this.ssaoMaterial.uniforms.projectionInv.value.getInverse(i.projectionMatrix),this.blurMaterial.uniforms.normalTex.value=e,this.blurMaterial.uniforms.depthTex.value=t,this.blurMaterial.uniforms.projection.value.copy(i.projectionMatrix),t===e?(this.ssaoMaterial.defines.DEPTH_PACKING=2,this.blurMaterial.defines.DEPTH_PACKING=2):t.isDepthTexture?(this.ssaoMaterial.defines.DEPTH_PACKING=0,this.blurMaterial.defines.DEPTH_PACKING=0):(this.ssaoMaterial.defines.DEPTH_PACKING=1,this.blurMaterial.defines.DEPTH_PACKING=1);var a=r.getClearColor().getHex(),s=r.getClearAlpha(),l=r.autoClear;r.autoClear=!1,this.quad.material=this.ssaoMaterial,r.setClearColor(16777215,1),r.render(this.quadScene,this.quadCamera,this._tempRenderTarget,!0),this.quad.material=this.blurMaterial,this.blurMaterial.uniforms.tDiffuse.value=this._tempRenderTarget.texture,this.blurMaterial.uniforms.direction.value=0,this.blurMaterial.uniforms.blurSize.value=1,this.blurMaterial.transparent=!1,r.setClearColor(16777215,1),r.render(this.quadScene,this.quadCamera,this._tempRenderTarget2,!0),this.blurMaterial.uniforms.tDiffuse.value=this._tempRenderTarget2.texture,this.blurMaterial.uniforms.direction.value=1,this.blurMaterial.uniforms.blurSize.value=1,this.blurMaterial.transparent=!o,this.blurMaterial.blending=o?THREE.NoBlending:THREE.CustomBlending,o&&r.setClearColor(0,0),r.render(this.quadScene,this.quadCamera,n,o),r.setClearColor(a,s),r.autoClear=l},setKernelSize:function(e,t){t=void 0!==t?t:0,this._kernels[e+"_"+t]||(this._kernels[e+"_"+t]=function(e,t,i){var n=new Float32Array(3*e);t=t||0;for(var o=0;o<e;o++){var a=r(o+t,2)*(i?1:2)*Math.PI,s=r(o+t,3)*Math.PI,l=Math.random(),c=Math.cos(a)*Math.sin(s)*l,u=Math.cos(s)*l,h=Math.sin(a)*Math.sin(s)*l;n[3*o]=c,n[3*o+1]=u,n[3*o+2]=h}return n}(e,e*t,!0)),this.ssaoMaterial.defines.KERNEL_SIZE=e,this.ssaoMaterial.uniforms.kernel.value=this._kernels[e+"_"+t]},setNoiseSize:function(e){var r=this.ssaoMaterial.uniforms.noiseTex.value;r?(r.image.data=t(e),r.image.width=e,r.image.height=e,r.needsUpdate=!0):(r=function(e){var r=new THREE.DataTexture(t(e),e,e,THREE.RGBAFormat,THREE.UnsignedByteType,THREE.UVMapping,THREE.RepeatWrapping,THREE.RepeatWrapping);return r.needsUpdate=!0,r}(e),this.ssaoMaterial.uniforms.noiseTex.value=r),this.ssaoMaterial.uniforms.noiseTexSize.value.set(e,e)},setParameter:function(e,t){"noiseTexSize"===e?this.setNoiseSize(t):"kernelSize"===e?this.setKernelSize(t):"blurSize"===e?this.blurMaterial.uniforms.blurSize.value=1:this.ssaoMaterial.uniforms[e].value=t}});var p=function(e,t){for(var r=0,i=1/t,n=e;n>0;)r+=i*(n%t),n=Math.floor(n/t),i/=t;return r};n.prototype=Object.assign(n.prototype,{constructor:n,setSize:function(e,t){this._prevFrame.setSize(e,t),this._output.setSize(e,t)},setSamplingSize:function(e){this._samplingSize=e||30;for(var t=[],r=0;r<this._samplingSize;r++)t.push([p(r,2),p(r,3)]);this._haltonSequence=t,this._frame=0},start:function(){this._frame=0},finished:function(){return this._frame>=this._samplingSize},frame:function(){return this._frame},jitterProjection:function(e,t,r){var i=this._haltonSequence[this._frame];i||console.error("THREE.SuperSampler: try to jitter camera after finished!",this._frame,this._haltonSequence.length),e.setViewOffset&&e.setViewOffset(t,r,.5*(2*i[0]-1),.5*(2*i[1]-1),t,r)},sample:function(e,t){var r=0===this._frame;this.quad.material.uniforms.tDiffuse1.value=t,this.quad.material.uniforms.tDiffuse2.value=this._prevFrame.texture,this.quad.material.uniforms.mixRatio.value=r?0:.9,this.quad.material.uniforms.opacity.value=1;var i=e.getClearColor().getHex(),n=e.getClearAlpha();e.setClearColor(0,0),e.render(this.quadScene,this.quadCamera,this._output,!0),e.setClearColor(i,n);var o=this._prevFrame;return this._prevFrame=this._output,this._output=o,this._frame++,this._prevFrame},output:function(){return this._prevFrame}});var d={vertexShader:"#include <skinning_pars_vertex>\n    void main() {\n        #include <skinbase_vertex>\n        #include <begin_vertex>\n        #include <skinning_vertex>\n        #include <project_vertex>\n    }",fragmentShader:"void main() {        gl_FragColor = vec4(0.0, 1.0, 1.0, 1.0);    }"},f={uniforms:{maskTexture:{value:null},texSize:{value:new THREE.Vector2(.5,.5)},edgeColor:{value:new THREE.Vector3(1,1,1)}},vertexShader:"#include <skinning_pars_vertex>\n    varying vec2 vUv;\n    void main() {\n        vUv = uv;\n        #include <skinbase_vertex>\n        #include <begin_vertex>\n        #include <skinning_vertex>\n        #include <project_vertex>\n    }",fragmentShader:"varying vec2 vUv;    uniform sampler2D maskTexture;    uniform vec2 texSize;    uniform vec3 edgeColor;        void main() {\n        vec2 invSize = 1.0 / texSize;        vec4 uvOffset = vec4(1.0, 0.0, 0.0, 1.0) * vec4(invSize, invSize);        vec4 c1 = texture2D( maskTexture, vUv + uvOffset.xy);        vec4 c2 = texture2D( maskTexture, vUv - uvOffset.xy);        vec4 c3 = texture2D( maskTexture, vUv + uvOffset.yw);        vec4 c4 = texture2D( maskTexture, vUv - uvOffset.yw);        float b1 = max(c1.b, c2.b);        float b2 = max(c3.b, c4.b);        float a = max(b1, b2);        gl_FragColor = vec4(edgeColor, a);    }"},m={defines:{MAX_RADIUS:4},uniforms:{colorTexture:{value:null},texSize:{value:new THREE.Vector2(.5,.5)},direction:{value:new THREE.Vector2(.5,.5)},kernelRadius:{value:1}},vertexShader:"#include <skinning_pars_vertex>\n    varying vec2 vUv;\n    void main() {\n        vUv = uv;\n        #include <skinbase_vertex>\n        #include <begin_vertex>\n        #include <skinning_vertex>\n        #include <project_vertex>\n    }",fragmentShader:"#include <common>    varying vec2 vUv;    uniform sampler2D colorTexture;    uniform vec2 texSize;    uniform vec2 direction;    uniform float kernelRadius;        float gaussianPdf(in float x, in float sigma) {        return 0.39894 * exp( -0.5 * x * x/( sigma * sigma))/sigma;    }    void main() {        vec2 invSize = 1.0 / texSize;        float weightSum = gaussianPdf(0.0, kernelRadius);        vec4 diffuseColor = texture2D( colorTexture, vUv);        vec4 diffuseSum = diffuseColor * weightSum;        vec2 delta = direction * invSize * kernelRadius/float(MAX_RADIUS);        vec2 uvOffset = delta;        for( int i = 1; i <= MAX_RADIUS; i ++ ) {            float w = gaussianPdf(uvOffset.x, kernelRadius);            vec4 sample1 = texture2D( colorTexture, vUv + uvOffset);            vec4 sample2 = texture2D( colorTexture, vUv - uvOffset);            diffuseSum += ((sample1 + sample2) * w);            weightSum += (2.0 * w);            uvOffset += delta;        }        vec4 color = diffuseSum/weightSum;         gl_FragColor = color;    }"},g={uniforms:{maskTexture:{value:null},edgeTexture1:{value:null},edgeTexture2:{value:null},edgeStrength:{value:1},edgeGlow:{value:1}},vertexShader:"#include <skinning_pars_vertex>\n    varying vec2 vUv;\n    void main() {\n        vUv = uv;\n        #include <skinbase_vertex>\n        #include <begin_vertex>\n        #include <skinning_vertex>\n        #include <project_vertex>\n    }",fragmentShader:"varying vec2 vUv;    uniform sampler2D maskTexture;    uniform sampler2D edgeTexture1;    uniform sampler2D edgeTexture2;    uniform float edgeStrength;    uniform float edgeGlow;        void main() {        vec4 edgeValue1 = texture2D(edgeTexture1, vUv);        vec4 edgeValue2 = texture2D(edgeTexture2, vUv);        vec4 maskColor = texture2D(maskTexture, vUv);        vec4 edgeValue = edgeValue1 + edgeValue2 * edgeGlow;        vec4 finalColor = edgeStrength * edgeValue;        float a = finalColor.a * (1.0 - maskColor.b);        gl_FragColor = vec4(finalColor.rgb, a);    }"},v=0;Object.assign(o.prototype,{dispose:function(){this.renderTargetMaskBuffer.dispose(),this.renderTargetMaskDownSampleBuffer.dispose(),this.renderTargetBlurBuffer1.dispose(),this.renderTargetBlurBuffer2.dispose(),this.renderTargetEdgeBuffer1.dispose(),this.renderTargetEdgeBuffer2.dispose()},setSize:function(e,t){this.renderTargetMaskBuffer.setSize(e,t),this.renderTargetMaskBuffer0.setSize(e,t);var r=Math.round(e/this.downSampleRatio),i=Math.round(t/this.downSampleRatio);this.renderTargetMaskDownSampleBuffer.setSize(r,i),this.renderTargetBlurBuffer1.setSize(r,i),this.renderTargetEdgeBuffer1.setSize(r,i),this.separableBlurMaterial1.uniforms.texSize.value.set(r,i),r=Math.round(r/2),i=Math.round(i/2),this.renderTargetBlurBuffer2.setSize(r,i),this.renderTargetEdgeBuffer2.setSize(r,i),this.separableBlurMaterial2.uniforms.texSize.value.set(r,i)},addObject:function(e){var t=this;e.traverse(function(e){(e.isLine||e.isMesh||e.isSprite)&&(e.userData.outline||(e.userData.outline=t.id))}),this.selectedObjects.add(e)},deleteObject:function(e){var t=this;e.traverse(function(e){(e.isLine||e.isMesh||e.isSprite)&&e.userData.outline==t.id&&delete e.userData.outline}),this.selectedObjects.delete(e)},clearObject:function(){this.selectedObjects.forEach(function(e){e.traverse(function(e){(e.isLine||e.isMesh||e.isSprite)&&delete e.userData.outline})}),this.selectedObjects.clear()},render:function(e,t,r,i){if(0!==this.selectedObjects.size){this.oldClearColor.copy(e.getClearColor()),this.oldClearAlpha=e.getClearAlpha();var n=e.autoClear;if(e.autoClear=!1,this._dirty){var a=e.capabilities.isWebGL2;e.setClearColor(0,0);var s=t.background;t.background=null,THREE.MaterialManager.mode="OutlinePass"+this.id,t.autoUpdate=!1,r.layers.enable(1),e.render(t,r,a?this.renderTargetMaskBuffer0:this.renderTargetMaskBuffer,!0),r.layers.disable(1),t.autoUpdate=!0,THREE.MaterialManager.mode=0,a&&(e.setRenderTarget(this.renderTargetMaskBuffer),e.blitRenderTarget(this.renderTargetMaskBuffer0,this.renderTargetMaskBuffer)),t.background=s,this.quad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=this.renderTargetMaskBuffer.texture,e.render(this.scene,this.camera,this.renderTargetMaskDownSampleBuffer,!0),this.quad.material=this.edgeDetectionMaterial,this.edgeDetectionMaterial.uniforms.maskTexture.value=this.renderTargetMaskDownSampleBuffer.texture,this.edgeDetectionMaterial.uniforms.texSize.value.set(this.renderTargetMaskDownSampleBuffer.width,this.renderTargetMaskDownSampleBuffer.height),this.edgeDetectionMaterial.uniforms.edgeColor.value=this.edgeColor,e.render(this.scene,this.camera,this.renderTargetEdgeBuffer1,!0),this.quad.material=this.separableBlurMaterial1,this.separableBlurMaterial1.uniforms.colorTexture.value=this.renderTargetEdgeBuffer1.texture,this.separableBlurMaterial1.uniforms.direction.value=o.BlurDirectionX,this.separableBlurMaterial1.uniforms.kernelRadius.value=this.edgeThickness,e.render(this.scene,this.camera,this.renderTargetBlurBuffer1,!0),this.separableBlurMaterial1.uniforms.colorTexture.value=this.renderTargetBlurBuffer1.texture,this.separableBlurMaterial1.uniforms.direction.value=o.BlurDirectionY,e.render(this.scene,this.camera,this.renderTargetEdgeBuffer1,!0),this.quad.material=this.separableBlurMaterial2,this.separableBlurMaterial2.uniforms.colorTexture.value=this.renderTargetEdgeBuffer1.texture,this.separableBlurMaterial2.uniforms.direction.value=o.BlurDirectionX,e.render(this.scene,this.camera,this.renderTargetBlurBuffer2,!0),this.separableBlurMaterial2.uniforms.colorTexture.value=this.renderTargetBlurBuffer2.texture,this.separableBlurMaterial2.uniforms.direction.value=o.BlurDirectionY,e.render(this.scene,this.camera,this.renderTargetEdgeBuffer2,!0),this.quad.material=this.overlayMaterial,this.overlayMaterial.uniforms.maskTexture.value=this.renderTargetMaskBuffer.texture,this.overlayMaterial.uniforms.edgeTexture1.value=this.renderTargetEdgeBuffer1.texture,this.overlayMaterial.uniforms.edgeTexture2.value=this.renderTargetEdgeBuffer2.texture,this.overlayMaterial.uniforms.edgeStrength.value=this.edgeStrength,this.overlayMaterial.uniforms.edgeGlow.value=this.edgeGlow,this._dirty=!1}e.render(this.scene,this.camera,i,!1),e.setClearColor(this.oldClearColor,this.oldClearAlpha),e.autoClear=n}},dirty:function(){this._dirty=!0}}),o.BlurDirectionX=new THREE.Vector2(1,0),o.BlurDirectionY=new THREE.Vector2(0,1),a.prototype=Object.assign(Object.create(THREE.Pass.prototype),{constructor:a,render:function(e,t,r,i,n){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=r.texture),this.quad.material=this.material,this.renderToScreen?e.render(this.scene,this.camera,void 0,this.clear):e.render(this.scene,this.camera,t,this.clear)}});var y={temporalSuperSampling:{enable:!0,size:30},postEffect:{enable:!0,bloom:{enable:!0,strength:.14,radius:.4,threshold:.7},screenSpaceAmbientOcclusion:{enable:!0,radius:.2,quality:"medium",intensity:.8,temporalFilter:!0,ignoreTransparent:!1},colorCorrection:{enable:!0,exposure:0,brightness:0,contrast:1,saturation:1,gamma:1},FXAA:{enable:!0}}},E=new THREE.Color,b=0,x=new THREE.Scene;l.prototype=Object.assign(l.prototype,{constructor:l,setConfig:function(e){this._config=s(this._config,e),this._superSampler.setSamplingSize(this._config.temporalSuperSampling.size);t=this._config.postEffect.bloom;this._bloomPass.strength=t.strength,this._bloomPass.radius=t.radius,this._bloomPass.threshold=t.threshold;t=this._config.postEffect.screenSpaceAmbientOcclusion;this._ssaoPrePass.setParameter("radius",t.radius),this._ssaoPrePass.setParameter("bias",t.radius/50),this._ssaoPrePass.setParameter("intensity",t.intensity),this._ssaoKernalSize={low:6,medium:12,high:32,ultra:64}[t.quality]||12,this._ssaoPrePass.setKernelSize(this._ssaoKernalSize);var t=this._config.postEffect.colorCorrection;this._colorPass.uniforms.exposure.value=t.exposure,this._colorPass.uniforms.brightness.value=t.brightness,this._colorPass.uniforms.contrast.value=t.contrast,this._colorPass.uniforms.saturation.value=t.saturation,this._colorPass.uniforms.gamma.value=t.gamma,this.dirty()},addOutline:function(e,t){var r=t.toHexString();if(!this._outlinePasses.has(r)){var i=new o(this.width,this.height);i.edgeColor.copy(t),this._outlinePasses.set(r,i)}var n=this._outlinePasses.get(r);n.addObject(e),n.dirty()},removeOutline:function(e,t){if(t){var r=t.toHexString(),i=this._outlinePasses.get(r);i.deleteObject(e),i.dirty()}else this._outlinePasses.forEach(function(t){t.deleteObject(e),t.dirty()})},clearOutline:function(){this._outlinePasses.forEach(function(e){e.clearObject(),e.dirty()}),this._outlinePasses.clear()},setSize:function(e,t){this._superSampler.setSize(e,t),this._tempRenderTarget0.setSize(e,t),this._tempRenderTarget.setSize(e,t),this._tempRenderTarget2.setSize(e,t),this._ssaoPrePass.setSize(e,t),this._bloomPass.setSize(e,t),this._colorPass.setSize(e,t),this._fxaaPass.setSize(e,t),this._fxaaPass.uniforms.resolution.value.set(1/e,1/t),this._copyPass.setSize(e,t),this._outlinePasses.forEach(function(r){r.setSize(e,t)}),this.width=e,this.height=t,this.dirty()},render:function(e,t,r){var i=this._config.temporalSuperSampling.enable,n=this._config.postEffect.enable,o=!1;if(n||i){this.ignoreSkyBox&&(function(e,t){E.copy(e.getClearColor()),b=e.getClearAlpha(),x.background=t.background,e.setClearColor(0,0,0),e.setClearAlpha(0),t.background=null}(e,t),function(e){e.__thingSky&&x.add(e.__thingSky)}(t));var a;i?this._superSampler.finished()?a=this._superSampler.output():(this._superSampler.jitterProjection(r,this._tempRenderTarget.width,this._tempRenderTarget.height),o=!0,e.capabilities.isWebGL2?(e.render(t,r,this._tempRenderTarget0),e.setRenderTarget(this._tempRenderTarget),e.blitRenderTarget(this._tempRenderTarget0,this._tempRenderTarget)):e.render(t,r,this._tempRenderTarget),n&&this._config.postEffect.screenSpaceAmbientOcclusion.enable&&(this._normalDepthPrePass.render(e,t,r,this._config.postEffect.screenSpaceAmbientOcclusion.ignoreTransparent),this._config.postEffect.screenSpaceAmbientOcclusion.temporalFilter&&this._ssaoPrePass.setKernelSize(this._ssaoKernalSize,this._superSampler.frame()),this._ssaoPrePass.render(this._normalDepthPrePass.getNormalTexture(),this._normalDepthPrePass.getDepthTexture(),e,r,this._tempRenderTarget,this.onlyAO)),a=this._superSampler.sample(e,this._tempRenderTarget.texture)):(e.capabilities.isWebGL2?(e.render(t,r,this._tempRenderTarget0),e.setRenderTarget(this._tempRenderTarget),e.blitRenderTarget(this._tempRenderTarget0,this._tempRenderTarget)):e.render(t,r,this._tempRenderTarget),n&&this._config.postEffect.screenSpaceAmbientOcclusion.enable&&(this._normalDepthPrePass.render(e,t,r,this._config.postEffect.screenSpaceAmbientOcclusion.ignoreTransparent),this._ssaoPrePass.render(this._normalDepthPrePass.getNormalTexture(),this._normalDepthPrePass.getDepthTexture(),e,r,this._tempRenderTarget,this.onlyAO)),a=this._tempRenderTarget),this._copyPass.renderToScreen=!1,this._copyPass.render(e,this._tempRenderTarget2,a);var s=this._tempRenderTarget2,l=this._tempRenderTarget;if(n&&this._config.postEffect.colorCorrection.enable){this._colorPass.render(e,l,s);c=s;s=l,l=c}if(n&&this._config.postEffect.bloom.enable&&this._bloomPass.render(e,l,s),this.enableOutline&&this._outlinePasses.forEach(function(i){i.render(e,t,r,s)}),n&&this._config.postEffect.FXAA.enable){this._fxaaPass.render(e,l,s);var c=s;s=l,l=c}this.ignoreSkyBox&&(function(e,t){e.setClearColor(E),e.setClearAlpha(b),t.background=x.background}(e,t),e.render(x,r),function(e){e.__thingSky&&e.add(e.__thingSky)}(t));var u=e.autoClear;e.autoClear=!1,this.ignoreSkyBox?(this._copyPass2.renderToScreen=!0,this._copyPass2.render(e,l,s)):(this._copyPass.renderToScreen=!0,this._copyPass.render(e,l,s)),e.autoClear=u,o&&r.clearViewOffset()}else e.capabilities.isWebGL2?(e.render(t,r,this._tempRenderTarget0),e.setRenderTarget(this._tempRenderTarget),e.blitRenderTarget(this._tempRenderTarget0,this._tempRenderTarget),this._copyPass.renderToScreen=!0,this._copyPass.render(e,void 0,this._tempRenderTarget)):e.render(t,r),this.enableOutline&&this._outlinePasses.forEach(function(i){i.render(e,t,r)})},dirty:function(){this._config.temporalSuperSampling.enable&&this._superSampler.start(),this._outlinePasses.forEach(function(e){e.dirty()})}}),THREE.AdvancedRenderer=l}),function(){"use strict";function e(e,t){t=t||1/0;for(var r,i=e.length,n=null,o=[],a=0;a<i;a++){if(55295<(r=e.charCodeAt(a))&&57344>r){if(!n){if(56319<r){-1<(t-=3)&&o.push(239,191,189);continue}if(a+1===i){-1<(t-=3)&&o.push(239,191,189);continue}n=r;continue}if(56320>r){-1<(t-=3)&&o.push(239,191,189),n=r;continue}r=n-55296<<10|r-56320|65536,n=null}else n&&(-1<(t-=3)&&o.push(239,191,189),n=null);if(128>r){if(0>(t-=1))break;o.push(r)}else if(2048>r){if(0>(t-=2))break;o.push(192|r>>6,128|63&r)}else if(65536>r){if(0>(t-=3))break;o.push(224|r>>12,128|63&r>>6,128|63&r)}else{if(!(2097152>r))throw new Error("Invalid code point");if(0>(t-=4))break;o.push(240|r>>18,128|63&r>>12,128|63&r>>6,128|63&r)}}return o}function t(e){try{return decodeURIComponent(e)}catch(e){return String.fromCharCode(65533)}}TextEncoderLite.prototype.encode=function(t){return"undefined"==typeof Uint8Array?e(t):new Uint8Array(e(t))},TextDecoderLite.prototype.decode=function(e){return function(e,r,i){var n="",o="";i=Math.min(e.length,i||1/0);for(var a=r=r||0;a<i;a++)127>=e[a]?(n+=t(o)+String.fromCharCode(e[a]),o=""):o+="%"+e[a].toString(16);return n+t(o)}(e,0,e.length)}}();var _Group=function(){this._tweens={},this._tweensAddedDuringUpdate={}};_Group.prototype={getAll:function(){return Object.keys(this._tweens).map(function(e){return this._tweens[e]}.bind(this))},removeAll:function(){this._tweens={}},add:function(e){this._tweens[e.getId()]=e,this._tweensAddedDuringUpdate[e.getId()]=e},remove:function(e){delete this._tweens[e.getId()],delete this._tweensAddedDuringUpdate[e.getId()]},update:function(e,t){var r=Object.keys(this._tweens);if(0===r.length)return!1;for(e=void 0!==e?e:TWEEN.now();r.length>0;){this._tweensAddedDuringUpdate={};for(var i=0;i<r.length;i++){var n=this._tweens[r[i]];n&&!1===n.update(e)&&(n._isPlaying=!1,t||delete this._tweens[r[i]])}r=Object.keys(this._tweensAddedDuringUpdate)}return!0}};var TWEEN=new _Group;TWEEN.Group=_Group,TWEEN._nextId=0,TWEEN.nextId=function(){return TWEEN._nextId++},"undefined"==typeof window&&"undefined"!=typeof process?TWEEN.now=function(){var e=process.hrtime();return 1e3*e[0]+e[1]/1e6}:"undefined"!=typeof window&&void 0!==window.performance&&void 0!==window.performance.now?TWEEN.now=window.performance.now.bind(window.performance):void 0!==Date.now?TWEEN.now=Date.now:TWEEN.now=function(){return(new Date).getTime()},TWEEN.Tween=function(e,t){this._object=e,this._valuesStart={},this._valuesEnd={},this._valuesStartRepeat={},this._duration=1e3,this._repeat=0,this._repeatDelayTime=void 0,this._yoyo=!1,this._isPlaying=!1,this._reversed=!1,this._delayTime=0,this._startTime=null,this._easingFunction=TWEEN.Easing.Linear.None,this._interpolationFunction=TWEEN.Interpolation.Linear,this._chainedTweens=[],this._onStartCallback=null,this._onStartCallbackFired=!1,this._onUpdateCallback=null,this._onCompleteCallback=null,this._onStopCallback=null,this._group=t||TWEEN,this._id=TWEEN.nextId()},TWEEN.Tween.prototype={getId:function(){return this._id},isPlaying:function(){return this._isPlaying},to:function(e,t){return this._valuesEnd=e,void 0!==t&&(this._duration=t),this},start:function(e){this._group.add(this),this._isPlaying=!0,this._onStartCallbackFired=!1,this._startTime=void 0!==e?"string"==typeof e?TWEEN.now()+parseFloat(e):e:TWEEN.now(),this._startTime+=this._delayTime;for(var t in this._valuesEnd){if(this._valuesEnd[t]instanceof Array){if(0===this._valuesEnd[t].length)continue;this._valuesEnd[t]=[this._object[t]].concat(this._valuesEnd[t])}void 0!==this._object[t]&&(this._valuesStart[t]=this._object[t],this._valuesStart[t]instanceof Array==0&&(this._valuesStart[t]*=1),this._valuesStartRepeat[t]=this._valuesStart[t]||0)}return this},stop:function(){return this._isPlaying?(this._group.remove(this),this._isPlaying=!1,null!==this._onStopCallback&&this._onStopCallback(this._object),this.stopChainedTweens(),this):this},end:function(){return this.update(this._startTime+this._duration),this},stopChainedTweens:function(){for(var e=0,t=this._chainedTweens.length;e<t;e++)this._chainedTweens[e].stop()},group:function(e){return this._group=e,this},delay:function(e){return this._delayTime=e,this},repeat:function(e){return this._repeat=e,this},repeatDelay:function(e){return this._repeatDelayTime=e,this},yoyo:function(e){return this._yoyo=e,this},easing:function(e){return this._easingFunction=e,this},interpolation:function(e){return this._interpolationFunction=e,this},chain:function(){return this._chainedTweens=arguments,this},onStart:function(e){return this._onStartCallback=e,this},onUpdate:function(e){return this._onUpdateCallback=e,this},onComplete:function(e){return this._onCompleteCallback=e,this},onStop:function(e){return this._onStopCallback=e,this},update:function(e){var t,r,i;if(e<this._startTime)return!0;!1===this._onStartCallbackFired&&(null!==this._onStartCallback&&this._onStartCallback(this._object),this._onStartCallbackFired=!0),r=(e-this._startTime)/this._duration,r=0===this._duration||r>1?1:r,i=this._easingFunction(r);for(t in this._valuesEnd)if(void 0!==this._valuesStart[t]){var n=this._valuesStart[t]||0,o=this._valuesEnd[t];o instanceof Array?this._object[t]=this._interpolationFunction(o,i):("string"==typeof o&&(o="+"===o.charAt(0)||"-"===o.charAt(0)?n+parseFloat(o):parseFloat(o)),"number"==typeof o&&(this._object[t]=n+(o-n)*i))}if(null!==this._onUpdateCallback&&this._onUpdateCallback(this._object),1===r){if(this._repeat>0){isFinite(this._repeat)&&this._repeat--;for(t in this._valuesStartRepeat){if("string"==typeof this._valuesEnd[t]&&(this._valuesStartRepeat[t]=this._valuesStartRepeat[t]+parseFloat(this._valuesEnd[t])),this._yoyo){var a=this._valuesStartRepeat[t];this._valuesStartRepeat[t]=this._valuesEnd[t],this._valuesEnd[t]=a}this._valuesStart[t]=this._valuesStartRepeat[t]}return this._yoyo&&(this._reversed=!this._reversed),void 0!==this._repeatDelayTime?this._startTime=e+this._repeatDelayTime:this._startTime=e+this._delayTime,!0}null!==this._onCompleteCallback&&this._onCompleteCallback(this._object);for(var s=0,l=this._chainedTweens.length;s<l;s++)this._chainedTweens[s].start(this._startTime+this._duration);return!1}return!0}},TWEEN.Easing={Linear:{None:function(e){return e}},Quadratic:{In:function(e){return e*e},Out:function(e){return e*(2-e)},InOut:function(e){return(e*=2)<1?.5*e*e:-.5*(--e*(e-2)-1)}},Cubic:{In:function(e){return e*e*e},Out:function(e){return--e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e:.5*((e-=2)*e*e+2)}},Quartic:{In:function(e){return e*e*e*e},Out:function(e){return 1- --e*e*e*e},InOut:function(e){return(e*=2)<1?.5*e*e*e*e:-.5*((e-=2)*e*e*e-2)}},Quintic:{In:function(e){return e*e*e*e*e},Out:function(e){return--e*e*e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e*e*e:.5*((e-=2)*e*e*e*e+2)}},Sinusoidal:{In:function(e){return 1-Math.cos(e*Math.PI/2)},Out:function(e){return Math.sin(e*Math.PI/2)},InOut:function(e){return.5*(1-Math.cos(Math.PI*e))}},Exponential:{In:function(e){return 0===e?0:Math.pow(1024,e-1)},Out:function(e){return 1===e?1:1-Math.pow(2,-10*e)},InOut:function(e){return 0===e?0:1===e?1:(e*=2)<1?.5*Math.pow(1024,e-1):.5*(2-Math.pow(2,-10*(e-1)))}},Circular:{In:function(e){return 1-Math.sqrt(1-e*e)},Out:function(e){return Math.sqrt(1- --e*e)},InOut:function(e){return(e*=2)<1?-.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1)}},Elastic:{In:function(e){return 0===e?0:1===e?1:-Math.pow(2,10*(e-1))*Math.sin(5*(e-1.1)*Math.PI)},Out:function(e){return 0===e?0:1===e?1:Math.pow(2,-10*e)*Math.sin(5*(e-.1)*Math.PI)+1},InOut:function(e){return 0===e?0:1===e?1:(e*=2)<1?-.5*Math.pow(2,10*(e-1))*Math.sin(5*(e-1.1)*Math.PI):.5*Math.pow(2,-10*(e-1))*Math.sin(5*(e-1.1)*Math.PI)+1}},Back:{In:function(e){return e*e*(2.70158*e-1.70158)},Out:function(e){return--e*e*(2.70158*e+1.70158)+1},InOut:function(e){var t=2.5949095;return(e*=2)<1?e*e*((t+1)*e-t)*.5:.5*((e-=2)*e*((t+1)*e+t)+2)}},Bounce:{In:function(e){return 1-TWEEN.Easing.Bounce.Out(1-e)},Out:function(e){return e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375},InOut:function(e){return e<.5?.5*TWEEN.Easing.Bounce.In(2*e):.5*TWEEN.Easing.Bounce.Out(2*e-1)+.5}}},TWEEN.Interpolation={Linear:function(e,t){var r=e.length-1,i=r*t,n=Math.floor(i),o=TWEEN.Interpolation.Utils.Linear;return t<0?o(e[0],e[1],i):t>1?o(e[r],e[r-1],r-i):o(e[n],e[n+1>r?r:n+1],i-n)},Bezier:function(e,t){for(var r=0,i=e.length-1,n=Math.pow,o=TWEEN.Interpolation.Utils.Bernstein,a=0;a<=i;a++)r+=n(1-t,i-a)*n(t,a)*e[a]*o(i,a);return r},CatmullRom:function(e,t){var r=e.length-1,i=r*t,n=Math.floor(i),o=TWEEN.Interpolation.Utils.CatmullRom;return e[0]===e[r]?(t<0&&(n=Math.floor(i=r*(1+t))),o(e[(n-1+r)%r],e[n],e[(n+1)%r],e[(n+2)%r],i-n)):t<0?e[0]-(o(e[0],e[0],e[1],e[1],-i)-e[0]):t>1?e[r]-(o(e[r],e[r],e[r-1],e[r-1],i-r)-e[r]):o(e[n?n-1:0],e[n],e[r<n+1?r:n+1],e[r<n+2?r:n+2],i-n)},Utils:{Linear:function(e,t,r){return(t-e)*r+e},Bernstein:function(e,t){var r=TWEEN.Interpolation.Utils.Factorial;return r(e)/r(t)/r(e-t)},Factorial:function(){var e=[1];return function(t){var r=1;if(e[t])return e[t];for(var i=t;i>1;i--)r*=i;return e[t]=r,r}}(),CatmullRom:function(e,t,r,i,n){var o=.5*(r-e),a=.5*(i-t),s=n*n;return(2*t-2*r+o+a)*(n*s)+(-3*t+3*r-2*o-a)*s+o*n+t}}},function(e){"function"==typeof define&&define.amd?define([],function(){return TWEEN}):"undefined"!=typeof module&&"object"==typeof exports?module.exports=TWEEN:void 0!==e&&(e.TWEEN=TWEEN)}(this),THREE.GLTFLoader=function(){function e(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager,this.dracoLoader=null}function t(e){this.name=E.KHR_LIGHTS_PUNCTUAL;var t=e.extensions&&e.extensions[E.KHR_LIGHTS_PUNCTUAL]||{};this.lightDefs=t.lights||[]}function r(e){this.name=E.KHR_MATERIALS_UNLIT}function i(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=E.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,THREE.DRACOLoader.getDecoderModule()}function n(e){this.name=E.KHR_TEXTURE_TRANSFORM}function o(e,t,r,i){THREE.Interpolant.call(this,e,t,r,i)}function a(e,t){return"string"!=typeof e||""===e?"":/^(https?:)?\/\//i.test(e)?e:/^data:.*,.*$/i.test(e)?e:/^blob:.*$/i.test(e)?e:t+e}function s(){return new THREE.MeshStandardMaterial({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:THREE.FrontSide})}function l(e,t,r){for(var i in r.extensions)void 0===e[i]&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[i]=r.extensions[i])}function c(e,t){void 0!==t.extras&&("object"==typeof t.extras?e.userData=t.extras:console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+t.extras))}function u(e,t,r){for(var i=!1,n=!1,o=0,a=t.length;o<a;o++){if(void 0!==(c=t[o]).POSITION&&(i=!0),void 0!==c.NORMAL&&(n=!0),i&&n)break}if(!i&&!n)return Promise.resolve(e);for(var s=[],l=[],o=0,a=t.length;o<a;o++){var c=t[o];if(i){u=void 0!==c.POSITION?r.getDependency("accessor",c.POSITION).then(function(e){return g(e)}):e.attributes.position;s.push(u)}if(n){var u=void 0!==c.NORMAL?r.getDependency("accessor",c.NORMAL).then(function(e){return g(e)}):e.attributes.normal;l.push(u)}}return Promise.all([Promise.all(s),Promise.all(l)]).then(function(r){for(var o=r[0],a=r[1],s=0,l=t.length;s<l;s++){var c=t[s],u="morphTarget"+s;if(i&&void 0!==c.POSITION){var h=o[s];h.name=u;for(var p=e.attributes.position,d=0,f=h.count;d<f;d++)h.setXYZ(d,h.getX(d)+p.getX(d),h.getY(d)+p.getY(d),h.getZ(d)+p.getZ(d))}if(n&&void 0!==c.NORMAL){var m=a[s];m.name=u;for(var g=e.attributes.normal,d=0,f=m.count;d<f;d++)m.setXYZ(d,m.getX(d)+g.getX(d),m.getY(d)+g.getY(d),m.getZ(d)+g.getZ(d))}}return i&&(e.morphAttributes.position=o),n&&(e.morphAttributes.normal=a),e})}function h(e,t){if(e.updateMorphTargets(),void 0!==t.weights)for(var r=0,i=t.weights.length;r<i;r++)e.morphTargetInfluences[r]=t.weights[r];if(t.extras&&Array.isArray(t.extras.targetNames)){var n=t.extras.targetNames;if(e.morphTargetInfluences.length===n.length){e.morphTargetDictionary={};for(var r=0,i=n.length;r<i;r++)e.morphTargetDictionary[n[r]]=r}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function p(e,t){var r=e.extensions?e.extensions[E.KHR_DRACO_MESH_COMPRESSION]:void 0,i=t.extensions?t.extensions[E.KHR_DRACO_MESH_COMPRESSION]:void 0;return r&&i?r.bufferView===i.bufferView&&d(r.attributes,i.attributes):e.indices===t.indices&&d(e.attributes,t.attributes)}function d(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(var r in e)if(e[r]!==t[r])return!1;return!0}function f(e,t){if(e.length!==t.length)return!1;for(var r=0,i=e.length;r<i;r++)if(e[r]!==t[r])return!1;return!0}function m(e,t){for(var r=0,i=e.length;r<i;r++){var n=e[r];if(p(n.primitive,t))return n.promise}return null}function g(e){if(e.isInterleavedBufferAttribute){for(var t=e.count,r=e.itemSize,i=e.array.slice(0,t*r),n=0;n<t;++n)i[n]=e.getX(n),r>=2&&(i[n+1]=e.getY(n)),r>=3&&(i[n+2]=e.getZ(n)),r>=4&&(i[n+3]=e.getW(n));return new THREE.BufferAttribute(i,r,e.normalized)}return e.clone()}function v(e,t,r){this.json=e||{},this.extensions=t||{},this.options=r||{},this.cache=new function(){var e={};return{get:function(t){return e[t]},add:function(t,r){e[t]=r},remove:function(t){delete e[t]},removeAll:function(){e={}}}},this.primitiveCache=[],this.multiplePrimitivesCache=[],this.multiPassGeometryCache=[],this.textureLoader=new THREE.TextureLoader(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.fileLoader=new THREE.FileLoader(this.options.manager),this.fileLoader.setResponseType("arraybuffer")}function y(e,t,r){function i(t,i){return r.getDependency("accessor",t).then(function(t){e.addAttribute(i,t)})}var n=t.attributes,o=[];for(var a in n){var s=P[a];s&&(s in e.attributes||o.push(i(n[a],s)))}if(void 0!==t.indices&&!e.index){var l=r.getDependency("accessor",t.indices).then(function(t){e.setIndex(t)});o.push(l)}return c(e,t),Promise.all(o).then(function(){return void 0!==t.targets?u(e,t.targets,r):e})}e.prototype={constructor:e,crossOrigin:"anonymous",load:function(e,t,r,i){var n,o=this;n=void 0!==this.resourcePath?this.resourcePath:void 0!==this.path?this.path:THREE.LoaderUtils.extractUrlBase(e),o.manager.itemStart(e);var a=function(t){i?i(t):console.error(t),o.manager.itemError(e),o.manager.itemEnd(e)},s=new THREE.FileLoader(o.manager);s.setPath(this.path),s.setResponseType("arraybuffer"),s.load(e,function(r){try{o.parse(r,n,function(r){t(r),o.manager.itemEnd(e)},a)}catch(e){a(e)}},r,a)},setCrossOrigin:function(e){return this.crossOrigin=e,this},setPath:function(e){return this.path=e,this},setResourcePath:function(e){return this.resourcePath=e,this},setDRACOLoader:function(e){return this.dracoLoader=e,this},parse:function(e,o,a,s){var c,u={};if("string"==typeof e)c=e;else{if(THREE.LoaderUtils.decodeText(new Uint8Array(e,0,4))===b){try{u[E.KHR_BINARY_GLTF]=new function(e){this.name=E.KHR_BINARY_GLTF,this.content=null,this.body=null;var t=new DataView(e,0,x);if(this.header={magic:THREE.LoaderUtils.decodeText(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==b)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected. Use LegacyGLTFLoader instead.");for(var r=new DataView(e,x),i=0;i<r.byteLength;){var n=r.getUint32(i,!0);i+=4;var o=r.getUint32(i,!0);if(i+=4,o===_.JSON){var a=new Uint8Array(e,x+i,n);this.content=THREE.LoaderUtils.decodeText(a)}else if(o===_.BIN){var s=x+i;this.body=e.slice(s,s+n)}i+=n}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}(e)}catch(e){return void(s&&s(e))}c=u[E.KHR_BINARY_GLTF].content}else c=THREE.LoaderUtils.decodeText(new Uint8Array(e))}var h=JSON.parseX(c,this);if(void 0===h.asset||h.asset.version[0]<2)s&&s(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported. Use LegacyGLTFLoader instead."));else{if(h.extensionsUsed)for(var p=0;p<h.extensionsUsed.length;++p){var d=h.extensionsUsed[p],f=h.extensionsRequired||[];switch(d){case E.KHR_LIGHTS_PUNCTUAL:u[d]=new t(h);break;case E.KHR_MATERIALS_UNLIT:u[d]=new r(h);break;case E.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:u[d]=new function(){return{name:E.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,specularGlossinessParams:["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity","refractionRatio"],getMaterialType:function(){return THREE.ShaderMaterial},extendParams:function(e,t,r){var i=t.extensions[this.name],n=THREE.ShaderLib.standard,o=THREE.UniformsUtils.clone(n.uniforms),a=["#ifdef USE_SPECULARMAP","\tuniform sampler2D specularMap;","#endif"].join("\n"),s=["#ifdef USE_GLOSSINESSMAP","\tuniform sampler2D glossinessMap;","#endif"].join("\n"),l=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","\tvec4 texelSpecular = texture2D( specularMap, vUv );","\ttexelSpecular = sRGBToLinear( texelSpecular );","\t// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","\tspecularFactor *= texelSpecular.rgb;","#endif"].join("\n"),c=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","\tvec4 texelGlossiness = texture2D( glossinessMap, vUv );","\t// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","\tglossinessFactor *= texelGlossiness.a;","#endif"].join("\n"),u=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb;","material.specularRoughness = clamp( 1.0 - glossinessFactor, 0.04, 1.0 );","material.specularColor = specularFactor.rgb;"].join("\n"),h=n.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",a).replace("#include <metalnessmap_pars_fragment>",s).replace("#include <roughnessmap_fragment>",l).replace("#include <metalnessmap_fragment>",c).replace("#include <lights_physical_fragment>",u);delete o.roughness,delete o.metalness,delete o.roughnessMap,delete o.metalnessMap,o.specular={value:(new THREE.Color).setHex(1118481)},o.glossiness={value:.5},o.specularMap={value:null},o.glossinessMap={value:null},e.vertexShader=n.vertexShader,e.fragmentShader=h,e.uniforms=o,e.defines={STANDARD:""},e.color=new THREE.Color(1,1,1),e.opacity=1;var p=[];if(Array.isArray(i.diffuseFactor)){var d=i.diffuseFactor;e.color.fromArray(d),e.opacity=d[3]}if(void 0!==i.diffuseTexture&&p.push(r.assignTexture(e,"map",i.diffuseTexture)),e.emissive=new THREE.Color(0,0,0),e.glossiness=void 0!==i.glossinessFactor?i.glossinessFactor:1,e.specular=new THREE.Color(1,1,1),Array.isArray(i.specularFactor)&&e.specular.fromArray(i.specularFactor),void 0!==i.specularGlossinessTexture){var f=i.specularGlossinessTexture;p.push(r.assignTexture(e,"glossinessMap",f)),p.push(r.assignTexture(e,"specularMap",f))}return Promise.all(p)},createMaterial:function(e){var t=new THREE.ShaderMaterial({defines:e.defines,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader,uniforms:e.uniforms,fog:!0,lights:!0,opacity:e.opacity,transparent:e.transparent});return t.isGLTFSpecularGlossinessMaterial=!0,t.color=e.color,t.map=void 0===e.map?null:e.map,t.lightMap=null,t.lightMapIntensity=1,t.aoMap=void 0===e.aoMap?null:e.aoMap,t.aoMapIntensity=1,t.emissive=e.emissive,t.emissiveIntensity=1,t.emissiveMap=void 0===e.emissiveMap?null:e.emissiveMap,t.bumpMap=void 0===e.bumpMap?null:e.bumpMap,t.bumpScale=1,t.normalMap=void 0===e.normalMap?null:e.normalMap,e.normalScale&&(t.normalScale=e.normalScale),t.displacementMap=null,t.displacementScale=1,t.displacementBias=0,t.specularMap=void 0===e.specularMap?null:e.specularMap,t.specular=e.specular,t.glossinessMap=void 0===e.glossinessMap?null:e.glossinessMap,t.glossiness=e.glossiness,t.alphaMap=null,t.envMap=void 0===e.envMap?null:e.envMap,t.envMapIntensity=1,t.refractionRatio=.98,t.extensions.derivatives=!0,t},cloneMaterial:function(e){var t=e.clone();t.isGLTFSpecularGlossinessMaterial=!0;for(var r=this.specularGlossinessParams,i=0,n=r.length;i<n;i++)t[r[i]]=e[r[i]];return t},refreshUniforms:function(e,t,r,i,n,o){if(!0===n.isGLTFSpecularGlossinessMaterial){var a=n.uniforms,s=n.defines;a.opacity.value=n.opacity,a.diffuse.value.copy(n.color),a.emissive.value.copy(n.emissive).multiplyScalar(n.emissiveIntensity),a.map.value=n.map,a.specularMap.value=n.specularMap,a.alphaMap.value=n.alphaMap,a.lightMap.value=n.lightMap,a.lightMapIntensity.value=n.lightMapIntensity,a.aoMap.value=n.aoMap,a.aoMapIntensity.value=n.aoMapIntensity;var l;n.map?l=n.map:n.specularMap?l=n.specularMap:n.displacementMap?l=n.displacementMap:n.normalMap?l=n.normalMap:n.bumpMap?l=n.bumpMap:n.glossinessMap?l=n.glossinessMap:n.alphaMap?l=n.alphaMap:n.emissiveMap&&(l=n.emissiveMap),void 0!==l&&(l.isWebGLRenderTarget&&(l=l.texture),!0===l.matrixAutoUpdate&&l.updateMatrix(),a.uvTransform.value.copy(l.matrix)),n.envMap&&(a.envMap.value=n.envMap,a.envMapIntensity.value=n.envMapIntensity,a.flipEnvMap.value=n.envMap.isCubeTexture?-1:1,a.reflectivity.value=n.reflectivity,a.refractionRatio.value=n.refractionRatio,a.maxMipLevel.value=e.properties.get(n.envMap).__maxMipLevel),a.specular.value.copy(n.specular),a.glossiness.value=n.glossiness,a.glossinessMap.value=n.glossinessMap,a.emissiveMap.value=n.emissiveMap,a.bumpMap.value=n.bumpMap,a.normalMap.value=n.normalMap,a.displacementMap.value=n.displacementMap,a.displacementScale.value=n.displacementScale,a.displacementBias.value=n.displacementBias,null!==a.glossinessMap.value&&void 0===s.USE_GLOSSINESSMAP&&(s.USE_GLOSSINESSMAP="",s.USE_ROUGHNESSMAP=""),null===a.glossinessMap.value&&void 0!==s.USE_GLOSSINESSMAP&&(delete s.USE_GLOSSINESSMAP,delete s.USE_ROUGHNESSMAP)}}}}(h);break;case E.KHR_DRACO_MESH_COMPRESSION:u[d]=new i(h,this.dracoLoader);break;case E.MSFT_TEXTURE_DDS:u[E.MSFT_TEXTURE_DDS]=new function(){if(!THREE.DDSLoader)throw new Error("THREE.GLTFLoader: Attempting to load .dds texture without importing THREE.DDSLoader");this.name=E.MSFT_TEXTURE_DDS,this.ddsLoader=new THREE.DDSLoader}(h);break;case E.KHR_TEXTURE_TRANSFORM:u[E.KHR_TEXTURE_TRANSFORM]=new n(h);break;default:f.indexOf(d)>=0&&console.warn('THREE.GLTFLoader: Unknown extension "'+d+'".')}}var m=new v(h,u,{path:o||this.resourcePath||"",crossOrigin:this.crossOrigin,manager:this.manager});m.parse(function(e,t,r,i,n){m.getDependencies("material").then(function(o){var s={scene:e,scenes:t,cameras:r,animations:i,asset:n.asset,parser:m,userData:{},materials:o};l(u,s,n),a(s)})},s)}}};var E={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",MSFT_TEXTURE_DDS:"MSFT_texture_dds"};t.prototype.loadLight=function(e){var t,r=this.lightDefs[e],i=new THREE.Color(16777215);void 0!==r.color&&i.fromArray(r.color);var n=void 0!==r.range?r.range:0;switch(r.type){case"directional":(t=new THREE.DirectionalLight(i)).target.position.set(0,0,-1),t.add(t.target);break;case"point":(t=new THREE.PointLight(i)).distance=n;break;case"spot":(t=new THREE.SpotLight(i)).distance=n,r.spot=r.spot||{},r.spot.innerConeAngle=void 0!==r.spot.innerConeAngle?r.spot.innerConeAngle:0,r.spot.outerConeAngle=void 0!==r.spot.outerConeAngle?r.spot.outerConeAngle:Math.PI/4,t.angle=r.spot.outerConeAngle,t.penumbra=1-r.spot.innerConeAngle/r.spot.outerConeAngle,t.target.position.set(0,0,-1),t.add(t.target);break;default:throw new Error('THREE.GLTFLoader: Unexpected light type, "'+r.type+'".')}return t.decay=2,void 0!==r.intensity&&(t.intensity=r.intensity),t.name=r.name||"light_"+e,Promise.resolve(t)},r.prototype.getMaterialType=function(e){return THREE.MeshBasicMaterial},r.prototype.extendParams=function(e,t,r){var i=[];e.color=new THREE.Color(1,1,1),e.opacity=1;var n=t.pbrMetallicRoughness;if(n){if(Array.isArray(n.baseColorFactor)){var o=n.baseColorFactor;e.color.fromArray(o),e.opacity=o[3]}void 0!==n.baseColorTexture&&i.push(r.assignTexture(e,"map",n.baseColorTexture))}return Promise.all(i)};var b="glTF",x=12,_={JSON:1313821514,BIN:5130562};i.prototype.decodePrimitive=function(e,t){var r=this.json,i=this.dracoLoader,n=e.extensions[this.name].bufferView,o=e.extensions[this.name].attributes,a={},s={},l={};for(var c in o)c in P&&(a[P[c]]=o[c]);for(c in e.attributes)if(void 0!==P[c]&&void 0!==o[c]){var u=r.accessors[e.attributes[c]],h=T[u.componentType];l[P[c]]=h,s[P[c]]=!0===u.normalized}return t.getDependency("bufferView",n).then(function(e){return new Promise(function(t){i.decodeDracoFile(e,function(e){for(var r in e.attributes){var i=e.attributes[r],n=s[r];void 0!==n&&(i.normalized=n)}t(e)},a,l)})})},n.prototype.extendTexture=function(e,t){return e=e.clone(),void 0!==t.offset&&e.offset.fromArray(t.offset),void 0!==t.rotation&&(e.rotation=t.rotation),void 0!==t.scale&&e.repeat.fromArray(t.scale),void 0!==t.texCoord&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),e.needsUpdate=!0,e},(o.prototype=Object.create(THREE.Interpolant.prototype)).constructor=o,o.prototype.copySampleValue_=function(e){for(var t=this.resultBuffer,r=this.sampleValues,i=this.valueSize,n=e*i*3+i,o=0;o!==i;o++)t[o]=r[n+o];return t},o.prototype.beforeStart_=o.prototype.copySampleValue_,o.prototype.afterEnd_=o.prototype.copySampleValue_,o.prototype.interpolate_=function(e,t,r,i){for(var n=this.resultBuffer,o=this.sampleValues,a=this.valueSize,s=2*a,l=3*a,c=i-t,u=(r-t)/c,h=u*u,p=h*u,d=e*l,f=d-l,m=-2*p+3*h,g=p-h,v=1-m,y=g-h+u,E=0;E!==a;E++){var b=o[f+E+a],x=o[f+E+s]*c,_=o[d+E+a],w=o[d+E]*c;n[E]=v*b+y*x+m*_+g*w}return n};var w={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},T=(Number,THREE.Matrix3,THREE.Matrix4,THREE.Vector2,THREE.Vector3,THREE.Vector4,THREE.Texture,{5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array}),M={9728:THREE.NearestFilter,9729:THREE.LinearFilter,9984:THREE.NearestMipMapNearestFilter,9985:THREE.LinearMipMapNearestFilter,9986:THREE.NearestMipMapLinearFilter,9987:THREE.LinearMipMapLinearFilter},R={33071:THREE.ClampToEdgeWrapping,33648:THREE.MirroredRepeatWrapping,10497:THREE.RepeatWrapping},S=(THREE.BackSide,THREE.FrontSide,THREE.NeverDepth,THREE.LessDepth,THREE.EqualDepth,THREE.LessEqualDepth,THREE.GreaterEqualDepth,THREE.NotEqualDepth,THREE.GreaterEqualDepth,THREE.AlwaysDepth,THREE.AddEquation,THREE.SubtractEquation,THREE.ReverseSubtractEquation,THREE.ZeroFactor,THREE.OneFactor,THREE.SrcColorFactor,THREE.OneMinusSrcColorFactor,THREE.SrcAlphaFactor,THREE.OneMinusSrcAlphaFactor,THREE.DstAlphaFactor,THREE.OneMinusDstAlphaFactor,THREE.DstColorFactor,THREE.OneMinusDstColorFactor,THREE.SrcAlphaSaturateFactor,{SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16}),P={POSITION:"position",NORMAL:"normal",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",TEXCOORD_2:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},A={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},C={CUBICSPLINE:THREE.InterpolateSmooth,LINEAR:THREE.InterpolateLinear,STEP:THREE.InterpolateDiscrete},L={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"},O={"image/png":THREE.RGBAFormat,"image/jpeg":THREE.RGBFormat};return v.prototype.parse=function(e,t){var r=this.json;this.cache.removeAll(),this.markDefs(),this.getMultiDependencies(["scene","animation","camera"]).then(function(t){var i=t.scenes||[],n=i[r.scene||0],o=t.animations||[],a=t.cameras||[];e(n,i,a,o,r)}).catch(t)},v.prototype.markDefs=function(){for(var e=this.json.nodes||[],t=this.json.skins||[],r=this.json.meshes||[],i={},n={},o=0,a=t.length;o<a;o++)for(var s=t[o].joints,l=0,c=s.length;l<c;l++)e[s[l]].isBone=!0;for(var u=0,h=e.length;u<h;u++){var p=e[u];void 0!==p.mesh&&(void 0===i[p.mesh]&&(i[p.mesh]=n[p.mesh]=0),i[p.mesh]++,void 0!==p.skin&&(r[p.mesh].isSkinnedMesh=!0))}this.json.meshReferences=i,this.json.meshUses=n},v.prototype.getDependency=function(e,t){var r=e+":"+t,i=this.cache.get(r);if(!i){switch(e){case"scene":i=this.loadScene(t);break;case"node":i=this.loadNode(t);break;case"mesh":i=this.loadMesh(t);break;case"accessor":i=this.loadAccessor(t);break;case"bufferView":i=this.loadBufferView(t);break;case"buffer":i=this.loadBuffer(t);break;case"material":i=this.loadMaterial(t);break;case"texture":i=this.loadTexture(t);break;case"skin":i=this.loadSkin(t);break;case"animation":i=this.loadAnimation(t);break;case"camera":i=this.loadCamera(t);break;case"light":i=this.extensions[E.KHR_LIGHTS_PUNCTUAL].loadLight(t);break;default:throw new Error("Unknown type: "+e)}this.cache.add(r,i)}return i},v.prototype.getDependencies=function(e){var t=this.cache.get(e);if(!t){var r=this,i=this.json[e+("mesh"===e?"es":"s")]||[];t=Promise.all(i.map(function(t,i){return r.getDependency(e,i)})),this.cache.add(e,t)}return t},v.prototype.getMultiDependencies=function(e){for(var t={},r=[],i=0,n=e.length;i<n;i++){var o=e[i],a=this.getDependencies(o);a=a.then(function(e,r){t[e]=r}.bind(this,o+("mesh"===o?"es":"s"))),r.push(a)}return Promise.all(r).then(function(){return t})},v.prototype.loadBuffer=function(e){var t=this.json.buffers[e],r=this.fileLoader;if(t.type&&"arraybuffer"!==t.type)throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(void 0===t.uri&&0===e)return Promise.resolve(this.extensions[E.KHR_BINARY_GLTF].body);var i=this.options;return new Promise(function(e,n){r.load(a(t.uri,i.path),e,void 0,function(){n(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})},v.prototype.loadBufferView=function(e){var t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(e){var r=t.byteLength||0,i=t.byteOffset||0;return e.slice(i,i+r)})},v.prototype.loadAccessor=function(e){var t=this,r=this.json,i=this.json.accessors[e];if(void 0===i.bufferView&&void 0===i.sparse)return Promise.resolve(null);var n=[];return void 0!==i.bufferView?n.push(this.getDependency("bufferView",i.bufferView)):n.push(null),void 0!==i.sparse&&(n.push(this.getDependency("bufferView",i.sparse.indices.bufferView)),n.push(this.getDependency("bufferView",i.sparse.values.bufferView))),Promise.all(n).then(function(e){var n,o,a=e[0],s=S[i.type],l=T[i.componentType],c=l.BYTES_PER_ELEMENT,u=c*s,h=i.byteOffset||0,p=void 0!==i.bufferView?r.bufferViews[i.bufferView].byteStride:void 0,d=!0===i.normalized;if(p&&p!==u){var f="InterleavedBuffer:"+i.bufferView+":"+i.componentType,m=t.cache.get(f);m||(n=new l(a),m=new THREE.InterleavedBuffer(n,p/c),t.cache.add(f,m)),o=new THREE.InterleavedBufferAttribute(m,s,h/c,d)}else n=null===a?new l(i.count*s):new l(a,h,i.count*s),o=new THREE.BufferAttribute(n,s,d);if(void 0!==i.sparse){var g=S.SCALAR,v=T[i.sparse.indices.componentType],y=i.sparse.indices.byteOffset||0,E=i.sparse.values.byteOffset||0,b=new v(e[1],y,i.sparse.count*g),x=new l(e[2],E,i.sparse.count*s);null!==a&&o.setArray(o.array.slice());for(var _=0,w=b.length;_<w;_++){var M=b[_];if(o.setX(M,x[_*s]),s>=2&&o.setY(M,x[_*s+1]),s>=3&&o.setZ(M,x[_*s+2]),s>=4&&o.setW(M,x[_*s+3]),s>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return o})},v.prototype.loadTexture=function(e){var t,r=this,i=this.json,n=this.options,o=this.textureLoader,s=window.URL||window.webkitURL,l=i.textures[e],c=l.extensions||{},u=(t=c[E.MSFT_TEXTURE_DDS]?i.images[c[E.MSFT_TEXTURE_DDS].source]:i.images[l.source]).uri,h=!1;return void 0!==t.bufferView&&(u=r.getDependency("bufferView",t.bufferView).then(function(e){h=!0;var r=new Blob([e],{type:t.mimeType});return u=s.createObjectURL(r)})),Promise.resolve(u).then(function(e){var t=THREE.Loader.Handlers.get(e);return t||(t=c[E.MSFT_TEXTURE_DDS]?r.extensions[E.MSFT_TEXTURE_DDS].ddsLoader:o),new Promise(function(r,i){t.load(a(e,n.path),r,void 0,i)})}).then(function(e){!0===h&&s.revokeObjectURL(u),e.flipY=!1,void 0!==l.name&&(e.name=l.name),t.mimeType in O&&(e.format=O[t.mimeType]);var r=(i.samplers||{})[l.sampler]||{};return e.magFilter=M[r.magFilter]||THREE.LinearFilter,e.minFilter=M[r.minFilter]||THREE.LinearMipMapLinearFilter,e.wrapS=R[r.wrapS]||THREE.RepeatWrapping,e.wrapT=R[r.wrapT]||THREE.RepeatWrapping,e})},v.prototype.assignTexture=function(e,t,r){var i=this;return this.getDependency("texture",r.index).then(function(n){if(i.extensions[E.KHR_TEXTURE_TRANSFORM]){var o=void 0!==r.extensions?r.extensions[E.KHR_TEXTURE_TRANSFORM]:void 0;o&&(n=i.extensions[E.KHR_TEXTURE_TRANSFORM].extendTexture(n,o))}e[t]=n})},v.prototype.loadMaterial=function(e){var t,r=this.json,i=this.extensions,n=r.materials[e],o={},a=n.extensions||{},s=[];if(a[E.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){var u=i[E.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];t=u.getMaterialType(n),s.push(u.extendParams(o,n,this))}else if(a[E.KHR_MATERIALS_UNLIT]){var h=i[E.KHR_MATERIALS_UNLIT];t=h.getMaterialType(n),s.push(h.extendParams(o,n,this))}else{t=THREE.MeshStandardMaterial;var p=n.pbrMetallicRoughness||{};if(o.color=new THREE.Color(1,1,1),o.opacity=1,Array.isArray(p.baseColorFactor)){var d=p.baseColorFactor;o.color.fromArray(d),o.opacity=d[3]}void 0!==p.baseColorTexture&&(s.push(this.assignTexture(o,"map",p.baseColorTexture)),1==p.baseColorTexture.texCoord&&(o.__useDiffuseUV2=!0)),o.metalness=void 0!==p.metallicFactor?p.metallicFactor:1,o.roughness=void 0!==p.roughnessFactor?p.roughnessFactor:1,void 0!==p.metallicRoughnessTexture&&(s.push(this.assignTexture(o,"metalnessMap",p.metallicRoughnessTexture)),s.push(this.assignTexture(o,"roughnessMap",p.metallicRoughnessTexture)))}!0===n.doubleSided&&(o.side=THREE.DoubleSide);var f=n.alphaMode||L.OPAQUE;f===L.BLEND?o.transparent=!0:(o.transparent=!1,f===L.MASK&&(o.alphaTest=void 0!==n.alphaCutoff?n.alphaCutoff:.5)),void 0!==n.normalTexture&&t!==THREE.MeshBasicMaterial&&(s.push(this.assignTexture(o,"normalMap",n.normalTexture)),o.normalScale=new THREE.Vector2(1,1),void 0!==n.normalTexture.scale&&o.normalScale.set(n.normalTexture.scale,n.normalTexture.scale)),void 0!==n.occlusionTexture&&t!==THREE.MeshBasicMaterial&&(s.push(this.assignTexture(o,"aoMap",n.occlusionTexture)),void 0!==n.occlusionTexture.strength&&(o.aoMapIntensity=n.occlusionTexture.strength)),void 0!==n.emissiveFactor&&t!==THREE.MeshBasicMaterial&&(o.emissive=(new THREE.Color).fromArray(n.emissiveFactor)),void 0!==n.emissiveTexture&&t!==THREE.MeshBasicMaterial&&s.push(this.assignTexture(o,"emissiveMap",n.emissiveTexture));var m=[],g=a.blend;if(g)for(var v=0;v<g.length;v++)g[v].maskTexture&&s.push(this.assignTexture(m,v,g[v].maskTexture));return Promise.all(s).then(function(){var e,r=o.__useDiffuseUV2;r&&delete o.__useDiffuseUV2,e=t===THREE.ShaderMaterial?i[E.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(o):new t(o),void 0!==n.name&&(e.name=n.name),e.normalScale&&(e.normalScale.y=-e.normalScale.y),e.map&&(e.map.encoding=THREE.sRGBEncoding),e.emissiveMap&&(e.emissiveMap.encoding=THREE.sRGBEncoding),e.specularMap&&(e.specularMap.encoding=THREE.sRGBEncoding),c(e,n),n.extensions&&l(i,e,n);for(var s in a)void 0===i[s]&&("sceneBlend"===s?(e.transparent=!0,e.blending=void 0===THREE[a[s]+"Blending"]?1:THREE[a[s]+"Blending"]):"blend"===s&&(e.__texture=m));var u=n.pbrMetallicRoughness.baseColorTexture,h=n.emissiveTexture,p=n.normalTexture;return void 0===e.userData.gltfExtensions&&(e.userData.gltfExtensions={}),u&&u.extensions&&(e.userData.gltfExtensions.baseColorTexture=u.extensions),h&&h.extensions&&(e.userData.gltfExtensions.emissiveTexture=h.extensions),p&&p.extensions&&(e.userData.gltfExtensions.normalTexture=p.extensions),r&&(e.userData.gltfExtensions.useDiffuseUV2=!0),e})},v.prototype.loadGeometries=function(e){function t(e){return n[E.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(e,i).then(function(t){return y(t,e,i)})}var r,i=this,n=this.extensions,o=this.primitiveCache,a=function(e){if(e.length<2)return!1;var t=e[0],r=t.targets||[];if(void 0===t.indices)return!1;for(var i=1,n=e.length;i<n;i++){var o=e[i];if(t.mode!==o.mode)return!1;if(void 0===o.indices)return!1;if(o.extensions&&o.extensions[E.KHR_DRACO_MESH_COMPRESSION])return!1;if(!d(t.attributes,o.attributes))return!1;var a=o.targets||[];if(r.length!==a.length)return!1;for(var s=0,l=r.length;s<l;s++)if(!d(r[s],a[s]))return!1}return!0}(e);a&&(r=e,e=[e[0]]);for(var s=[],l=0,c=e.length;l<c;l++){var u=e[l],h=m(o,u);if(h)s.push(h);else{var p;p=u.extensions&&u.extensions[E.KHR_DRACO_MESH_COMPRESSION]?t(u):y(new THREE.BufferGeometry,u,i),o.push({primitive:u,promise:p}),s.push(p)}}return Promise.all(s).then(function(t){if(a){var n=t[0];if(null!==(h=function(e,t,r){for(var i=0,n=e.length;i<n;i++){var o=e[i];if(t===o.baseGeometry&&f(r,o.primitives))return o.geometry}return null}(u=i.multiPassGeometryCache,n,r)))return[h.geometry];(p=new THREE.BufferGeometry).name=n.name,p.userData=n.userData;for(var o in n.attributes)p.addAttribute(o,n.attributes[o]);for(var o in n.morphAttributes)p.morphAttributes[o]=n.morphAttributes[o];for(var s=[],l=0,c=r.length;l<c;l++)s.push(i.getDependency("accessor",r[l].indices));return Promise.all(s).then(function(e){for(var t=[],i=0,o=0,a=r.length;o<a;o++){for(var s=e[o],l=0,c=s.count;l<c;l++)t.push(s.array[l]);p.addGroup(i,s.count,o),i+=s.count}return p.setIndex(t),u.push({geometry:p,baseGeometry:n,primitives:r}),[p]})}if(t.length>1&&void 0!==THREE.BufferGeometryUtils){for(var l=1,c=e.length;l<c;l++)if(e[0].mode!==e[l].mode)return t;var u=i.multiplePrimitivesCache,h=function(e,t){for(var r=0,i=e.length;r<i;r++){var n=e[r];if(f(t,n.baseGeometries))return n.geometry}return null}(u,t);if(h){if(null!==h.geometry)return[h.geometry]}else{var p=THREE.BufferGeometryUtils.mergeBufferGeometries(t,!0);if(u.push({geometry:p,baseGeometries:t}),null!==p)return[p]}}return t})},v.prototype.loadMesh=function(e){for(var t=this,r=this.json,i=this.extensions,n=r.meshes[e],o=n.primitives,a=[],l=0,u=o.length;l<u;l++){var p=void 0===o[l].material?s():this.getDependency("material",o[l].material);a.push(p)}return Promise.all(a).then(function(r){return t.loadGeometries(o).then(function(a){for(var s=1===a.length&&a[0].groups.length>0,l=[],u=0,p=a.length;u<p;u++){var d,f=a[u],m=o[u],g=s?r:r[u];if(m.mode===w.TRIANGLES||m.mode===w.TRIANGLE_STRIP||m.mode===w.TRIANGLE_FAN||void 0===m.mode)!0===(d=!0===n.isSkinnedMesh?new THREE.SkinnedMesh(f,g):new THREE.Mesh(f,g)).isSkinnedMesh&&d.normalizeSkinWeights(),m.mode===w.TRIANGLE_STRIP?d.drawMode=THREE.TriangleStripDrawMode:m.mode===w.TRIANGLE_FAN&&(d.drawMode=THREE.TriangleFanDrawMode);else if(m.mode===w.LINES)d=new THREE.LineSegments(f,g);else if(m.mode===w.LINE_STRIP)d=new THREE.Line(f,g);else if(m.mode===w.LINE_LOOP)d=new THREE.LineLoop(f,g);else{if(m.mode!==w.POINTS)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+m.mode);d=new THREE.Points(f,g)}Object.keys(d.geometry.morphAttributes).length>0&&h(d,n),d.name=n.name||"mesh_"+e,a.length>1&&(d.name+="_"+u),c(d,n),l.push(d);for(var v=s?d.material:[d.material],y=void 0!==f.attributes.color,b=void 0===f.attributes.normal,x=!0===d.isSkinnedMesh,_=Object.keys(f.morphAttributes).length>0,T=_&&void 0!==f.morphAttributes.normal,M=0,R=v.length;M<R;M++){g=v[M];if(d.isPoints){var S="PointsMaterial:"+g.uuid,P=t.cache.get(S);P||(P=new THREE.PointsMaterial,THREE.Material.prototype.copy.call(P,g),P.color.copy(g.color),P.map=g.map,P.lights=!1,t.cache.add(S,P)),g=P}else if(d.isLine){var S="LineBasicMaterial:"+g.uuid,A=t.cache.get(S);A||(A=new THREE.LineBasicMaterial,THREE.Material.prototype.copy.call(A,g),A.color.copy(g.color),A.lights=!1,t.cache.add(S,A)),g=A}if(y||b||x||_){S="ClonedMaterial:"+g.uuid+":";g.isGLTFSpecularGlossinessMaterial&&(S+="specular-glossiness:"),x&&(S+="skinning:"),y&&(S+="vertex-colors:"),b&&(S+="flat-shading:"),_&&(S+="morph-targets:"),T&&(S+="morph-normals:");var C=t.cache.get(S);C||(C=g.isGLTFSpecularGlossinessMaterial?i[E.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].cloneMaterial(g):g.clone(),x&&(C.skinning=!0),y&&(C.vertexColors=THREE.VertexColors),b&&(C.flatShading=!0),_&&(C.morphTargets=!0),T&&(C.morphNormals=!0),t.cache.add(S,C)),g=C}v[M]=g,g.aoMap&&void 0===f.attributes.uv2&&void 0!==f.attributes.uv&&(console.log("THREE.GLTFLoader: Duplicating UVs to support aoMap."),f.addAttribute("uv2",new THREE.BufferAttribute(f.attributes.uv.array,2))),g.isGLTFSpecularGlossinessMaterial&&(d.onBeforeRender=i[E.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].refreshUniforms)}d.material=s?v:v[0]}if(1===l.length)return l[0];for(var L=new THREE.Group,u=0,p=l.length;u<p;u++)L.add(l[u]);return L})})},v.prototype.loadCamera=function(e){var t,r=this.json.cameras[e],i=r[r.type];if(i)return"perspective"===r.type?t=new THREE.PerspectiveCamera(THREE.Math.radToDeg(i.yfov),i.aspectRatio||1,i.znear||1,i.zfar||2e6):"orthographic"===r.type&&(t=new THREE.OrthographicCamera(i.xmag/-2,i.xmag/2,i.ymag/2,i.ymag/-2,i.znear,i.zfar)),void 0!==r.name&&(t.name=r.name),c(t,r),Promise.resolve(t);console.warn("THREE.GLTFLoader: Missing camera parameters.")},v.prototype.loadSkin=function(e){var t=this.json.skins[e],r={joints:t.joints};return void 0===t.inverseBindMatrices?Promise.resolve(r):this.getDependency("accessor",t.inverseBindMatrices).then(function(e){return r.inverseBindMatrices=e,r})},v.prototype.loadAnimation=function(e){for(var t=this.json.animations[e],r=[],i=[],n=[],a=[],s=[],l=0,c=t.channels.length;l<c;l++){var u=t.channels[l],h=t.samplers[u.sampler],p=u.target,d=void 0!==p.node?p.node:p.id,f=void 0!==t.parameters?t.parameters[h.input]:h.input,m=void 0!==t.parameters?t.parameters[h.output]:h.output;r.push(this.getDependency("node",d)),i.push(this.getDependency("accessor",f)),n.push(this.getDependency("accessor",m)),a.push(h),s.push(p)}return Promise.all([Promise.all(r),Promise.all(i),Promise.all(n),Promise.all(a),Promise.all(s)]).then(function(r){for(var i=r[0],n=r[1],a=r[2],s=r[3],l=r[4],c=[],u=0,h=i.length;u<h;u++){var p=i[u],d=n[u],f=a[u],m=s[u],g=l[u];if(void 0!==p){p.updateMatrix(),p.matrixAutoUpdate=!0;var v;switch(A[g.path]){case A.weights:v=THREE.NumberKeyframeTrack;break;case A.rotation:v=THREE.QuaternionKeyframeTrack;break;case A.position:case A.scale:default:v=THREE.VectorKeyframeTrack}var y=p.name?p.name:p.uuid,E=void 0!==m.interpolation?C[m.interpolation]:THREE.InterpolateLinear,b=[];A[g.path]===A.weights?p.traverse(function(e){!0===e.isMesh&&e.morphTargetInfluences&&b.push(e.name?e.name:e.uuid)}):b.push(y);for(var x=0,_=b.length;x<_;x++){var w=new v(b[x]+"."+A[g.path],THREE.AnimationUtils.arraySlice(d.array,0),THREE.AnimationUtils.arraySlice(f.array,0),E);"CUBICSPLINE"===m.interpolation&&(w.createInterpolant=function(e){return new o(this.times,this.values,this.getValueSize()/3,e)},w.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),c.push(w)}}}var T=void 0!==t.name?t.name:"animation_"+e;return new THREE.AnimationClip(T,void 0,c)})},v.prototype.loadNode=function(e){var t=this.json,r=this.extensions,i=this,n=t.meshReferences,o=t.meshUses,a=t.nodes[e];return new Promise(function(e){!0===a.isBone?e(new THREE.Bone):void 0!==a.mesh?i.getDependency("mesh",a.mesh).then(function(t){var r;if(n[a.mesh]>1){var i=o[a.mesh]++;(r=t.clone()).name+="_instance_"+i,r.onBeforeRender=t.onBeforeRender;for(var s=0,l=r.children.length;s<l;s++)r.children[s].name+="_instance_"+i,r.children[s].onBeforeRender=t.children[s].onBeforeRender}else r=t;e(r)}):void 0!==a.camera?i.getDependency("camera",a.camera).then(e):a.extensions&&a.extensions[E.KHR_LIGHTS_PUNCTUAL]&&void 0!==a.extensions[E.KHR_LIGHTS_PUNCTUAL].light?i.getDependency("light",a.extensions[E.KHR_LIGHTS_PUNCTUAL].light).then(e):e(new THREE.Object3D)}).then(function(e){if(void 0!==a.name&&(e.name=THREE.PropertyBinding.sanitizeNodeName(a.name)),c(e,a),a.extensions&&l(r,e,a),void 0!==a.matrix){var t=new THREE.Matrix4;t.fromArray(a.matrix),e.applyMatrix(t)}else void 0!==a.translation&&e.position.fromArray(a.translation),void 0!==a.rotation&&e.quaternion.fromArray(a.rotation),void 0!==a.scale&&e.scale.fromArray(a.scale);return e})},v.prototype.loadScene=function(){function e(t,r,i,n){var o=i.nodes[t];return n.getDependency("node",t).then(function(e){if(void 0===o.skin)return e;var t;return n.getDependency("skin",o.skin).then(function(e){for(var r=[],i=0,o=(t=e).joints.length;i<o;i++)r.push(n.getDependency("node",t.joints[i]));return Promise.all(r)}).then(function(r){for(var i=!0===e.isGroup?e.children:[e],n=0,o=i.length;n<o;n++){for(var a=i[n],s=[],l=[],c=0,u=r.length;c<u;c++){var h=r[c];if(h){s.push(h);var p=new THREE.Matrix4;void 0!==t.inverseBindMatrices&&p.fromArray(t.inverseBindMatrices.array,16*c),l.push(p)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[c])}a.bind(new THREE.Skeleton(s,l),a.matrixWorld)}return e})}).then(function(t){r.add(t);var a=[];if(o.children)for(var s=o.children,l=0,c=s.length;l<c;l++){var u=s[l];a.push(e(u,t,i,n))}return Promise.all(a)})}return function(t){var r=this.json,i=this.extensions,n=this.json.scenes[t],o=new THREE.Scene;void 0!==n.name&&(o.name=n.name),c(o,n),n.extensions&&l(i,o,n);for(var a=n.nodes||[],s=[],u=0,h=a.length;u<h;u++)s.push(e(a[u],o,r,this));return Promise.all(s).then(function(){return o})}}(),e}(),function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.encryptmodel={})}(this,function(e){"use strict";function t(e,t){return t={exports:{}},e(t,t.exports),t.exports}function r(e,t){var i,n,o=arguments.length<3?e:arguments[2];return c(e)===o?e[t]:(i=gt.f(e,t))?_(i,"value")?i.value:void 0!==i.get?i.get.call(o):void 0:l(n=Ge(e))?r(n,t,o):void 0}function i(e,t,r){var n,o,a=arguments.length<4?e:arguments[3],s=gt.f(c(e),t);if(!s){if(l(o=Ge(e)))return i(o,t,r,a);s=E(0)}if(_(s,"value")){if(!1===s.writable||!l(a))return!1;if(n=gt.f(a,t)){if(n.get||n.set||!1===n.writable)return!1;n.value=r,y.f(a,t,n)}else y.f(a,t,E(0,r));return!0}return void 0!==s.set&&(s.set.call(a,r),!0)}function n(e){return isFinite(e=+e)&&0!=e?e<0?-n(-e):Math.log(e+Math.sqrt(e*e+1)):e}var o="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},a=t(function(e){var t=e.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=t)}),s=t(function(e){var t=e.exports={version:"2.5.7"};"number"==typeof __e&&(__e=t)}),l=function(e){return"object"==typeof e?null!==e:"function"==typeof e},c=function(e){if(!l(e))throw TypeError(e+" is not an object!");return e},u=function(e){try{return!!e()}catch(e){return!0}},h=!u(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a}),p=a.document,d=l(p)&&l(p.createElement),f=function(e){return d?p.createElement(e):{}},m=!h&&!u(function(){return 7!=Object.defineProperty(f("div"),"a",{get:function(){return 7}}).a}),g=function(e,t){if(!l(e))return e;var r,i;if(t&&"function"==typeof(r=e.toString)&&!l(i=r.call(e)))return i;if("function"==typeof(r=e.valueOf)&&!l(i=r.call(e)))return i;if(!t&&"function"==typeof(r=e.toString)&&!l(i=r.call(e)))return i;throw TypeError("Can't convert object to primitive value")},v=Object.defineProperty,y={f:h?Object.defineProperty:function(e,t,r){if(c(e),t=g(t,!0),c(r),m)try{return v(e,t,r)}catch(e){}if("get"in r||"set"in r)throw TypeError("Accessors not supported!");return"value"in r&&(e[t]=r.value),e}},E=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},b=h?function(e,t,r){return y.f(e,t,E(1,r))}:function(e,t,r){return e[t]=r,e},x={}.hasOwnProperty,_=function(e,t){return x.call(e,t)},w=0,T=Math.random(),M=function(e){return"Symbol(".concat(void 0===e?"":e,")_",(++w+T).toString(36))},R=t(function(e){var t=M("src"),r=Function.toString,i=(""+r).split("toString");s.inspectSource=function(e){return r.call(e)},(e.exports=function(e,r,n,o){var s="function"==typeof n;s&&(_(n,"name")||b(n,"name",r)),e[r]!==n&&(s&&(_(n,t)||b(n,t,e[r]?""+e[r]:i.join(String(r)))),e===a?e[r]=n:o?e[r]?e[r]=n:b(e,r,n):(delete e[r],b(e,r,n)))})(Function.prototype,"toString",function(){return"function"==typeof this&&this[t]||r.call(this)})}),S=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e},P=function(e,t,r){if(S(e),void 0===t)return e;switch(r){case 1:return function(r){return e.call(t,r)};case 2:return function(r,i){return e.call(t,r,i)};case 3:return function(r,i,n){return e.call(t,r,i,n)}}return function(){return e.apply(t,arguments)}},A=function(e,t,r){var i,n,o,l,c=e&A.F,u=e&A.G,h=e&A.S,p=e&A.P,d=e&A.B,f=u?a:h?a[t]||(a[t]={}):(a[t]||{}).prototype,m=u?s:s[t]||(s[t]={}),g=m.prototype||(m.prototype={});u&&(r=t);for(i in r)o=((n=!c&&f&&void 0!==f[i])?f:r)[i],l=d&&n?P(o,a):p&&"function"==typeof o?P(Function.call,o):o,f&&R(f,i,o,e&A.U),m[i]!=o&&b(m,i,l),p&&g[i]!=o&&(g[i]=o)};a.core=s,A.F=1,A.G=2,A.S=4,A.P=8,A.B=16,A.W=32,A.U=64,A.R=128;for(var C,L=A,O=M("typed_array"),H=M("view"),F=!(!a.ArrayBuffer||!a.DataView),I=F,k=0,D="Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array".split(",");k<9;)(C=a[D[k++]])?(b(C.prototype,O,!0),b(C.prototype,H,!0)):I=!1;var N={ABV:F,CONSTR:I,TYPED:O,VIEW:H},j=function(e,t,r){for(var i in t)R(e,i,t[i],r);return e},U=function(e,t,r,i){if(!(e instanceof t)||void 0!==i&&i in e)throw TypeError(r+": incorrect invocation!");return e},B=Math.ceil,V=Math.floor,z=function(e){return isNaN(e=+e)?0:(e>0?V:B)(e)},q=Math.min,G=function(e){return e>0?q(z(e),9007199254740991):0},W=function(e){if(void 0===e)return 0;var t=z(e),r=G(t);if(t!==r)throw RangeError("Wrong length!");return r},X={}.toString,Y=function(e){return X.call(e).slice(8,-1)},Q=Object("z").propertyIsEnumerable(0)?Object:function(e){return"String"==Y(e)?e.split(""):Object(e)},J=function(e){if(void 0==e)throw TypeError("Can't call method on  "+e);return e},K=function(e){return Q(J(e))},Z=Math.max,$=Math.min,ee=function(e,t){return(e=z(e))<0?Z(e+t,0):$(e,t)},te=function(e){return function(t,r,i){var n,o=K(t),a=G(o.length),s=ee(i,a);if(e&&r!=r){for(;a>s;)if((n=o[s++])!=n)return!0}else for(;a>s;s++)if((e||s in o)&&o[s]===r)return e||s||0;return!e&&-1}},re=t(function(e){var t=a["__core-js_shared__"]||(a["__core-js_shared__"]={});(e.exports=function(e,r){return t[e]||(t[e]=void 0!==r?r:{})})("versions",[]).push({version:s.version,mode:"global",copyright:" 2018 Denis Pushkarev (zloirock.ru)"})}),ie=re("keys"),ne=function(e){return ie[e]||(ie[e]=M(e))},oe=te(!1),ae=ne("IE_PROTO"),se=function(e,t){var r,i=K(e),n=0,o=[];for(r in i)r!=ae&&_(i,r)&&o.push(r);for(;t.length>n;)_(i,r=t[n++])&&(~oe(o,r)||o.push(r));return o},le="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(","),ce=le.concat("length","prototype"),ue={f:Object.getOwnPropertyNames||function(e){return se(e,ce)}},he=function(e){return Object(J(e))},pe=function(e){for(var t=he(this),r=G(t.length),i=arguments.length,n=ee(i>1?arguments[1]:void 0,r),o=i>2?arguments[2]:void 0,a=void 0===o?r:ee(o,r);a>n;)t[n++]=e;return t},de=t(function(e){var t=re("wks"),r=a.Symbol,i="function"==typeof r;(e.exports=function(e){return t[e]||(t[e]=i&&r[e]||(i?r:M)("Symbol."+e))}).store=t}),fe=y.f,me=de("toStringTag"),ge=function(e,t,r){e&&!_(e=r?e:e.prototype,me)&&fe(e,me,{configurable:!0,value:t})},ve=t(function(e,t){function r(e,t,r){var i,n,o,a=new Array(r),s=8*r-t-1,l=(1<<s)-1,c=l>>1,u=23===t?A(2,-24)-A(2,-77):0,h=0,p=e<0||0===e&&1/e<0?1:0;for((e=P(e))!=e||e===R?(n=e!=e?1:0,i=l):(i=C(L(e)/O),e*(o=A(2,-i))<1&&(i--,o*=2),(e+=i+c>=1?u/o:u*A(2,1-c))*o>=2&&(i++,o/=2),i+c>=l?(n=0,i=l):i+c>=1?(n=(e*o-1)*A(2,t),i+=c):(n=e*A(2,c-1)*A(2,t),i=0));t>=8;a[h++]=255&n,n/=256,t-=8);for(i=i<<t|n,s+=t;s>0;a[h++]=255&i,i/=256,s-=8);return a[--h]|=128*p,a}function i(e,t,r){var i,n=8*r-t-1,o=(1<<n)-1,a=o>>1,s=n-7,l=r-1,c=e[l--],u=127&c;for(c>>=7;s>0;u=256*u+e[l],l--,s-=8);for(i=u&(1<<-s)-1,u>>=-s,s+=t;s>0;i=256*i+e[l],l--,s-=8);if(0===u)u=1-a;else{if(u===o)return i?NaN:c?-R:R;i+=A(2,t),u-=a}return(c?-1:1)*i*A(2,u-t)}function n(e){return e[3]<<24|e[2]<<16|e[1]<<8|e[0]}function o(e){return[255&e]}function s(e){return[255&e,e>>8&255]}function l(e){return[255&e,e>>8&255,e>>16&255,e>>24&255]}function c(e){return r(e,52,8)}function p(e){return r(e,23,4)}function d(e,t,r){v(e[E],t,{get:function(){return this[r]}})}function f(e,t,r,i){var n=W(+r);if(n+t>e[F])throw M(x);var o=e[H]._b,a=n+e[I],s=o.slice(a,a+t);return i?s:s.reverse()}function m(e,t,r,i,n,o){var a=W(+r);if(a+t>e[F])throw M(x);for(var s=e[H]._b,l=a+e[I],c=i(+n),u=0;u<t;u++)s[l+u]=c[o?u:t-u-1]}var g=ue.f,v=y.f,E="prototype",x="Wrong index!",_=a.ArrayBuffer,w=a.DataView,T=a.Math,M=a.RangeError,R=a.Infinity,S=_,P=T.abs,A=T.pow,C=T.floor,L=T.log,O=T.LN2,H=h?"_b":"buffer",F=h?"_l":"byteLength",I=h?"_o":"byteOffset";if(N.ABV){if(!u(function(){_(1)})||!u(function(){new _(-1)})||u(function(){return new _,new _(1.5),new _(NaN),"ArrayBuffer"!=_.name})){for(var k,D=(_=function(e){return U(this,_),new S(W(e))})[E]=S[E],B=g(S),V=0;B.length>V;)(k=B[V++])in _||b(_,k,S[k]);D.constructor=_}var q=new w(new _(2)),X=w[E].setInt8;q.setInt8(0,2147483648),q.setInt8(1,2147483649),!q.getInt8(0)&&q.getInt8(1)||j(w[E],{setInt8:function(e,t){X.call(this,e,t<<24>>24)},setUint8:function(e,t){X.call(this,e,t<<24>>24)}},!0)}else _=function(e){U(this,_,"ArrayBuffer");var t=W(e);this._b=pe.call(new Array(t),0),this[F]=t},w=function(e,t,r){U(this,w,"DataView"),U(e,_,"DataView");var i=e[F],n=z(t);if(n<0||n>i)throw M("Wrong offset!");if(r=void 0===r?i-n:G(r),n+r>i)throw M("Wrong length!");this[H]=e,this[I]=n,this[F]=r},h&&(d(_,"byteLength","_l"),d(w,"buffer","_b"),d(w,"byteLength","_l"),d(w,"byteOffset","_o")),j(w[E],{getInt8:function(e){return f(this,1,e)[0]<<24>>24},getUint8:function(e){return f(this,1,e)[0]},getInt16:function(e){var t=f(this,2,e,arguments[1]);return(t[1]<<8|t[0])<<16>>16},getUint16:function(e){var t=f(this,2,e,arguments[1]);return t[1]<<8|t[0]},getInt32:function(e){return n(f(this,4,e,arguments[1]))},getUint32:function(e){return n(f(this,4,e,arguments[1]))>>>0},getFloat32:function(e){return i(f(this,4,e,arguments[1]),23,4)},getFloat64:function(e){return i(f(this,8,e,arguments[1]),52,8)},setInt8:function(e,t){m(this,1,e,o,t)},setUint8:function(e,t){m(this,1,e,o,t)},setInt16:function(e,t){m(this,2,e,s,t,arguments[2])},setUint16:function(e,t){m(this,2,e,s,t,arguments[2])},setInt32:function(e,t){m(this,4,e,l,t,arguments[2])},setUint32:function(e,t){m(this,4,e,l,t,arguments[2])},setFloat32:function(e,t){m(this,4,e,p,t,arguments[2])},setFloat64:function(e,t){m(this,8,e,c,t,arguments[2])}});ge(_,"ArrayBuffer"),ge(w,"DataView"),b(w[E],N.VIEW,!0),t.ArrayBuffer=_,t.DataView=w}),ye=de("species"),Ee=function(e,t){var r,i=c(e).constructor;return void 0===i||void 0==(r=c(i)[ye])?t:S(r)},be=de("species"),xe=function(e){var t=a[e];h&&t&&!t[be]&&y.f(t,be,{configurable:!0,get:function(){return this}})},_e=a.ArrayBuffer,we=ve.ArrayBuffer,Te=ve.DataView,Me=N.ABV&&_e.isView,Re=we.prototype.slice,Se=N.VIEW;L(L.G+L.W+L.F*(_e!==we),{ArrayBuffer:we}),L(L.S+L.F*!N.CONSTR,"ArrayBuffer",{isView:function(e){return Me&&Me(e)||l(e)&&Se in e}}),L(L.P+L.U+L.F*u(function(){return!new we(2).slice(1,void 0).byteLength}),"ArrayBuffer",{slice:function(e,t){if(void 0!==Re&&void 0===t)return Re.call(c(this),e);for(var r=c(this).byteLength,i=ee(e,r),n=ee(void 0===t?r:t,r),o=new(Ee(this,we))(G(n-i)),a=new Te(this),s=new Te(o),l=0;i<n;)s.setUint8(l++,a.getUint8(i++));return o}}),xe("ArrayBuffer");var Pe=de("toStringTag"),Ae="Arguments"==Y(function(){return arguments}()),Ce=function(e){var t,r,i;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(r=function(e,t){try{return e[t]}catch(e){}}(t=Object(e),Pe))?r:Ae?Y(t):"Object"==(i=Y(t))&&"function"==typeof t.callee?"Arguments":i},Le={},Oe=de("iterator"),He=Array.prototype,Fe=function(e){return void 0!==e&&(Le.Array===e||He[Oe]===e)},Ie=Object.keys||function(e){return se(e,le)},ke=h?Object.defineProperties:function(e,t){c(e);for(var r,i=Ie(t),n=i.length,o=0;n>o;)y.f(e,r=i[o++],t[r]);return e},De=a.document,Ne=De&&De.documentElement,je=ne("IE_PROTO"),Ue=function(){},Be=function(){var e,t=f("iframe"),r=le.length;for(t.style.display="none",Ne.appendChild(t),t.src="javascript:",(e=t.contentWindow.document).open(),e.write("<script>document.F=Object<\/script>"),e.close(),Be=e.F;r--;)delete Be.prototype[le[r]];return Be()},Ve=Object.create||function(e,t){var r;return null!==e?(Ue.prototype=c(e),r=new Ue,Ue.prototype=null,r[je]=e):r=Be(),void 0===t?r:ke(r,t)},ze=ne("IE_PROTO"),qe=Object.prototype,Ge=Object.getPrototypeOf||function(e){return e=he(e),_(e,ze)?e[ze]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?qe:null},We=de("iterator"),Xe=s.getIteratorMethod=function(e){if(void 0!=e)return e[We]||e["@@iterator"]||Le[Ce(e)]},Ye=Array.isArray||function(e){return"Array"==Y(e)},Qe=de("species"),Je=function(e,t){return new(function(e){var t;return Ye(e)&&("function"!=typeof(t=e.constructor)||t!==Array&&!Ye(t.prototype)||(t=void 0),l(t)&&null===(t=t[Qe])&&(t=void 0)),void 0===t?Array:t}(e))(t)},Ke=function(e,t){var r=1==e,i=2==e,n=3==e,o=4==e,a=6==e,s=5==e||a,l=t||Je;return function(t,c,u){for(var h,p,d=he(t),f=Q(d),m=P(c,u,3),g=G(f.length),v=0,y=r?l(t,g):i?l(t,0):void 0;g>v;v++)if((s||v in f)&&(h=f[v],p=m(h,v,d),e))if(r)y[v]=p;else if(p)switch(e){case 3:return!0;case 5:return h;case 6:return v;case 2:y.push(h)}else if(o)return!1;return a?-1:n||o?o:y}},Ze=de("unscopables"),$e=Array.prototype;void 0==$e[Ze]&&b($e,Ze,{});var et=function(e){$e[Ze][e]=!0},tt=function(e,t){return{value:t,done:!!e}},rt={};b(rt,de("iterator"),function(){return this});var it=function(e,t,r){e.prototype=Ve(rt,{next:E(1,r)}),ge(e,t+" Iterator")},nt=de("iterator"),ot=!([].keys&&"next"in[].keys()),at=function(){return this},st=function(e,t,r,i,n,o,a){it(r,t,i);var s,l,c,u=function(e){if(!ot&&e in f)return f[e];switch(e){case"keys":case"values":return function(){return new r(this,e)}}return function(){return new r(this,e)}},h=t+" Iterator",p="values"==n,d=!1,f=e.prototype,m=f[nt]||f["@@iterator"]||n&&f[n],g=m||u(n),v=n?p?u("entries"):g:void 0,y="Array"==t?f.entries||m:m;if(y&&(c=Ge(y.call(new e)))!==Object.prototype&&c.next&&(ge(c,h,!0),"function"!=typeof c[nt]&&b(c,nt,at)),p&&m&&"values"!==m.name&&(d=!0,g=function(){return m.call(this)}),(ot||d||!f[nt])&&b(f,nt,g),Le[t]=g,Le[h]=at,n)if(s={values:p?g:u("values"),keys:o?g:u("keys"),entries:v},a)for(l in s)l in f||R(f,l,s[l]);else L(L.P+L.F*(ot||d),t,s);return s},lt=st(Array,"Array",function(e,t){this._t=K(e),this._i=0,this._k=t},function(){var e=this._t,t=this._k,r=this._i++;return!e||r>=e.length?(this._t=void 0,tt(1)):"keys"==t?tt(0,r):"values"==t?tt(0,e[r]):tt(0,[r,e[r]])},"values");Le.Arguments=Le.Array,et("keys"),et("values"),et("entries");var ct=de("iterator"),ut=!1;try{var ht=[7][ct]();ht.return=function(){ut=!0},Array.from(ht,function(){throw 2})}catch(e){}var pt=function(e,t){if(!t&&!ut)return!1;var r=!1;try{var i=[7],n=i[ct]();n.next=function(){return{done:r=!0}},i[ct]=function(){return n},e(i)}catch(e){}return r},dt=[].copyWithin||function(e,t){var r=he(this),i=G(r.length),n=ee(e,i),o=ee(t,i),a=arguments.length>2?arguments[2]:void 0,s=Math.min((void 0===a?i:ee(a,i))-o,i-n),l=1;for(o<n&&n<o+s&&(l=-1,o+=s-1,n+=s-1);s-- >0;)o in r?r[n]=r[o]:delete r[n],n+=l,o+=l;return r},ft={f:{}.propertyIsEnumerable},mt=Object.getOwnPropertyDescriptor,gt={f:h?mt:function(e,t){if(e=K(e),t=g(t,!0),m)try{return mt(e,t)}catch(e){}if(_(e,t))return E(!ft.f.call(e,t),e[t])}},vt=t(function(e){if(h){var t=a,r=u,i=L,n=N,o=ve,s=P,c=U,p=E,d=b,f=j,m=z,v=G,x=W,w=ee,T=g,R=_,S=Ce,A=l,C=he,O=Fe,H=Ve,F=Ge,I=ue.f,k=Xe,D=M,B=de,V=Ke,q=te,X=Ee,Y=lt,Q=Le,J=pt,K=xe,Z=pe,$=dt,re=y,ie=gt,ne=re.f,oe=ie.f,ae=t.RangeError,se=t.TypeError,le=t.Uint8Array,ce=Array.prototype,fe=o.ArrayBuffer,me=o.DataView,ge=V(0),ye=V(2),be=V(3),_e=V(4),we=V(5),Te=V(6),Me=q(!0),Re=q(!1),Se=Y.values,Pe=Y.keys,Ae=Y.entries,Oe=ce.lastIndexOf,He=ce.reduce,Ie=ce.reduceRight,ke=ce.join,De=ce.sort,Ne=ce.slice,je=ce.toString,Ue=ce.toLocaleString,Be=B("iterator"),ze=B("toStringTag"),qe=D("typed_constructor"),We=D("def_constructor"),Ye=n.CONSTR,Qe=n.TYPED,Je=n.VIEW,Ze=V(1,function(e,t){return it(X(e,e[We]),t)}),$e=r(function(){return 1===new le(new Uint16Array([1]).buffer)[0]}),et=!!le&&!!le.prototype.set&&r(function(){new le(1).set({})}),tt=function(e,t){var r=m(e);if(r<0||r%t)throw ae("Wrong offset!");return r},rt=function(e){if(A(e)&&Qe in e)return e;throw se(e+" is not a typed array!")},it=function(e,t){if(!(A(e)&&qe in e))throw se("It is not a typed array constructor!");return new e(t)},nt=function(e,t){return ot(X(e,e[We]),t)},ot=function(e,t){for(var r=0,i=t.length,n=it(e,i);i>r;)n[r]=t[r++];return n},at=function(e,t,r){ne(e,t,{get:function(){return this._d[r]}})},st=function(e){var t,r,i,n,o,a,l=C(e),c=arguments.length,u=c>1?arguments[1]:void 0,h=void 0!==u,p=k(l);if(void 0!=p&&!O(p)){for(a=p.call(l),i=[],t=0;!(o=a.next()).done;t++)i.push(o.value);l=i}for(h&&c>2&&(u=s(u,arguments[2],2)),t=0,r=v(l.length),n=it(this,r);r>t;t++)n[t]=h?u(l[t],t):l[t];return n},ct=function(){for(var e=0,t=arguments.length,r=it(this,t);t>e;)r[e]=arguments[e++];return r},ut=!!le&&r(function(){Ue.call(new le(1))}),ht=function(){return Ue.apply(ut?Ne.call(rt(this)):rt(this),arguments)},ft={copyWithin:function(e,t){return $.call(rt(this),e,t,arguments.length>2?arguments[2]:void 0)},every:function(e){return _e(rt(this),e,arguments.length>1?arguments[1]:void 0)},fill:function(e){return Z.apply(rt(this),arguments)},filter:function(e){return nt(this,ye(rt(this),e,arguments.length>1?arguments[1]:void 0))},find:function(e){return we(rt(this),e,arguments.length>1?arguments[1]:void 0)},findIndex:function(e){return Te(rt(this),e,arguments.length>1?arguments[1]:void 0)},forEach:function(e){ge(rt(this),e,arguments.length>1?arguments[1]:void 0)},indexOf:function(e){return Re(rt(this),e,arguments.length>1?arguments[1]:void 0)},includes:function(e){return Me(rt(this),e,arguments.length>1?arguments[1]:void 0)},join:function(e){return ke.apply(rt(this),arguments)},lastIndexOf:function(e){return Oe.apply(rt(this),arguments)},map:function(e){return Ze(rt(this),e,arguments.length>1?arguments[1]:void 0)},reduce:function(e){return He.apply(rt(this),arguments)},reduceRight:function(e){return Ie.apply(rt(this),arguments)},reverse:function(){for(var e,t=rt(this).length,r=Math.floor(t/2),i=0;i<r;)e=this[i],this[i++]=this[--t],this[t]=e;return this},some:function(e){return be(rt(this),e,arguments.length>1?arguments[1]:void 0)},sort:function(e){return De.call(rt(this),e)},subarray:function(e,t){var r=rt(this),i=r.length,n=w(e,i);return new(X(r,r[We]))(r.buffer,r.byteOffset+n*r.BYTES_PER_ELEMENT,v((void 0===t?i:w(t,i))-n))}},mt=function(e,t){return nt(this,Ne.call(rt(this),e,t))},vt=function(e){rt(this);var t=tt(arguments[1],1),r=this.length,i=C(e),n=v(i.length),o=0;if(n+t>r)throw ae("Wrong length!");for(;o<n;)this[t+o]=i[o++]},yt={entries:function(){return Ae.call(rt(this))},keys:function(){return Pe.call(rt(this))},values:function(){return Se.call(rt(this))}},Et=function(e,t){return A(e)&&e[Qe]&&"symbol"!=typeof t&&t in e&&String(+t)==String(t)},bt=function(e,t){return Et(e,t=T(t,!0))?p(2,e[t]):oe(e,t)},xt=function(e,t,r){return!(Et(e,t=T(t,!0))&&A(r)&&R(r,"value"))||R(r,"get")||R(r,"set")||r.configurable||R(r,"writable")&&!r.writable||R(r,"enumerable")&&!r.enumerable?ne(e,t,r):(e[t]=r.value,e)};Ye||(ie.f=bt,re.f=xt),i(i.S+i.F*!Ye,"Object",{getOwnPropertyDescriptor:bt,defineProperty:xt}),r(function(){je.call({})})&&(je=Ue=function(){return ke.call(this)});var _t=f({},ft);f(_t,yt),d(_t,Be,yt.values),f(_t,{slice:mt,set:vt,constructor:function(){},toString:je,toLocaleString:ht}),at(_t,"buffer","b"),at(_t,"byteOffset","o"),at(_t,"byteLength","l"),at(_t,"length","e"),ne(_t,ze,{get:function(){return this[Qe]}}),e.exports=function(e,o,a,s){var l=e+((s=!!s)?"Clamped":"")+"Array",u="get"+e,h="set"+e,p=t[l],f=p||{},m=p&&F(p),g=!p||!n.ABV,y={},E=p&&p.prototype,b=function(e,t){ne(e,t,{get:function(){return function(e,t){var r=e._d;return r.v[u](t*o+r.o,$e)}(this,t)},set:function(e){return function(e,t,r){var i=e._d;s&&(r=(r=Math.round(r))<0?0:r>255?255:255&r),i.v[h](t*o+i.o,r,$e)}(this,t,e)},enumerable:!0})};g?(p=a(function(e,t,r,i){c(e,p,l,"_d");var n,a,s,u,h=0,f=0;if(A(t)){if(!(t instanceof fe||"ArrayBuffer"==(u=S(t))||"SharedArrayBuffer"==u))return Qe in t?ot(p,t):st.call(p,t);n=t,f=tt(r,o);var m=t.byteLength;if(void 0===i){if(m%o)throw ae("Wrong length!");if((a=m-f)<0)throw ae("Wrong length!")}else if((a=v(i)*o)+f>m)throw ae("Wrong length!");s=a/o}else s=x(t),n=new fe(a=s*o);for(d(e,"_d",{b:n,o:f,l:a,e:s,v:new me(n)});h<s;)b(e,h++)}),E=p.prototype=H(_t),d(E,"constructor",p)):r(function(){p(1)})&&r(function(){new p(-1)})&&J(function(e){new p,new p(null),new p(1.5),new p(e)},!0)||(p=a(function(e,t,r,i){c(e,p,l);var n;return A(t)?t instanceof fe||"ArrayBuffer"==(n=S(t))||"SharedArrayBuffer"==n?void 0!==i?new f(t,tt(r,o),i):void 0!==r?new f(t,tt(r,o)):new f(t):Qe in t?ot(p,t):st.call(p,t):new f(x(t))}),ge(m!==Function.prototype?I(f).concat(I(m)):I(f),function(e){e in p||d(p,e,f[e])}),p.prototype=E,E.constructor=p);var _=E[Be],w=!!_&&("values"==_.name||void 0==_.name),T=yt.values;d(p,qe,!0),d(E,Qe,l),d(E,Je,!0),d(E,We,p),(s?new p(1)[ze]==l:ze in E)||ne(E,ze,{get:function(){return l}}),y[l]=p,i(i.G+i.W+i.F*(p!=f),y),i(i.S,l,{BYTES_PER_ELEMENT:o}),i(i.S+i.F*r(function(){f.of.call(p,1)}),l,{from:st,of:ct}),"BYTES_PER_ELEMENT"in E||d(E,"BYTES_PER_ELEMENT",o),i(i.P,l,ft),K(l),i(i.P+i.F*et,l,{set:vt}),i(i.P+i.F*!w,l,yt),E.toString!=je&&(E.toString=je),i(i.P+i.F*r(function(){new p(1).slice()}),l,{slice:mt}),i(i.P+i.F*(r(function(){return[1,2].toLocaleString()!=new p([1,2]).toLocaleString()})||!r(function(){E.toLocaleString.call([1,2])})),l,{toLocaleString:ht}),Q[l]=w?_:T,w||d(E,Be,T)}}else e.exports=function(){}});vt("Int8",1,function(e){return function(t,r,i){return e(this,t,r,i)}}),vt("Uint8",1,function(e){return function(t,r,i){return e(this,t,r,i)}}),vt("Uint8",1,function(e){return function(t,r,i){return e(this,t,r,i)}},!0),vt("Int16",2,function(e){return function(t,r,i){return e(this,t,r,i)}}),vt("Uint16",2,function(e){return function(t,r,i){return e(this,t,r,i)}}),vt("Int32",4,function(e){return function(t,r,i){return e(this,t,r,i)}}),vt("Uint32",4,function(e){return function(t,r,i){return e(this,t,r,i)}}),vt("Float32",4,function(e){return function(t,r,i){return e(this,t,r,i)}}),vt("Float64",8,function(e){return function(t,r,i){return e(this,t,r,i)}});var yt=function(e,t,r,i){try{return i?t(c(r)[0],r[1]):t(r)}catch(t){var n=e.return;throw void 0!==n&&c(n.call(e)),t}},Et=t(function(e){var t={},r={},i=e.exports=function(e,i,n,o,a){var s,l,u,h,p=a?function(){return e}:Xe(e),d=P(n,o,i?2:1),f=0;if("function"!=typeof p)throw TypeError(e+" is not iterable!");if(Fe(p)){for(s=G(e.length);s>f;f++)if((h=i?d(c(l=e[f])[0],l[1]):d(e[f]))===t||h===r)return h}else for(u=p.call(e);!(l=u.next()).done;)if((h=yt(u,d,l.value,i))===t||h===r)return h};i.BREAK=t,i.RETURN=r}),bt=t(function(e){var t=M("meta"),r=y.f,i=0,n=Object.isExtensible||function(){return!0},o=!u(function(){return n(Object.preventExtensions({}))}),a=function(e){r(e,t,{value:{i:"O"+ ++i,w:{}}})},s=e.exports={KEY:t,NEED:!1,fastKey:function(e,r){if(!l(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!_(e,t)){if(!n(e))return"F";if(!r)return"E";a(e)}return e[t].i},getWeak:function(e,r){if(!_(e,t)){if(!n(e))return!0;if(!r)return!1;a(e)}return e[t].w},onFreeze:function(e){return o&&s.NEED&&n(e)&&!_(e,t)&&a(e),e}}}),xt=function(e,t){if(!l(e)||e._t!==t)throw TypeError("Incompatible receiver, "+t+" required!");return e},_t=y.f,wt=bt.fastKey,Tt=h?"_s":"size",Mt=function(e,t){var r,i=wt(t);if("F"!==i)return e._i[i];for(r=e._f;r;r=r.n)if(r.k==t)return r},Rt={getConstructor:function(e,t,r,i){var n=e(function(e,o){U(e,n,t,"_i"),e._t=t,e._i=Ve(null),e._f=void 0,e._l=void 0,e[Tt]=0,void 0!=o&&Et(o,r,e[i],e)});return j(n.prototype,{clear:function(){for(var e=xt(this,t),r=e._i,i=e._f;i;i=i.n)i.r=!0,i.p&&(i.p=i.p.n=void 0),delete r[i.i];e._f=e._l=void 0,e[Tt]=0},delete:function(e){var r=xt(this,t),i=Mt(r,e);if(i){var n=i.n,o=i.p;delete r._i[i.i],i.r=!0,o&&(o.n=n),n&&(n.p=o),r._f==i&&(r._f=n),r._l==i&&(r._l=o),r[Tt]--}return!!i},forEach:function(e){xt(this,t);for(var r,i=P(e,arguments.length>1?arguments[1]:void 0,3);r=r?r.n:this._f;)for(i(r.v,r.k,this);r&&r.r;)r=r.p},has:function(e){return!!Mt(xt(this,t),e)}}),h&&_t(n.prototype,"size",{get:function(){return xt(this,t)[Tt]}}),n},def:function(e,t,r){var i,n,o=Mt(e,t);return o?o.v=r:(e._l=o={i:n=wt(t,!0),k:t,v:r,p:i=e._l,n:void 0,r:!1},e._f||(e._f=o),i&&(i.n=o),e[Tt]++,"F"!==n&&(e._i[n]=o)),e},getEntry:Mt,setStrong:function(e,t,r){st(e,t,function(e,r){this._t=xt(e,t),this._k=r,this._l=void 0},function(){for(var e=this._k,t=this._l;t&&t.r;)t=t.p;return this._t&&(this._l=t=t?t.n:this._t._f)?"keys"==e?tt(0,t.k):"values"==e?tt(0,t.v):tt(0,[t.k,t.v]):(this._t=void 0,tt(1))},r?"entries":"values",!r,!0),xe(t)}},St=function(e,t){if(c(e),!l(t)&&null!==t)throw TypeError(t+": can't set as prototype!")},Pt={set:Object.setPrototypeOf||("__proto__"in{}?function(e,t,r){try{(r=P(Function.call,gt.f(Object.prototype,"__proto__").set,2))(e,[]),t=!(e instanceof Array)}catch(e){t=!0}return function(e,i){return St(e,i),t?e.__proto__=i:r(e,i),e}}({},!1):void 0),check:St},At=Pt.set,Ct=function(e,t,r,i,n,o){var s=a[e],c=s,h=n?"set":"add",p=c&&c.prototype,d={},f=function(e){var t=p[e];R(p,e,"delete"==e?function(e){return!(o&&!l(e))&&t.call(this,0===e?0:e)}:"has"==e?function(e){return!(o&&!l(e))&&t.call(this,0===e?0:e)}:"get"==e?function(e){return o&&!l(e)?void 0:t.call(this,0===e?0:e)}:"add"==e?function(e){return t.call(this,0===e?0:e),this}:function(e,r){return t.call(this,0===e?0:e,r),this})};if("function"==typeof c&&(o||p.forEach&&!u(function(){(new c).entries().next()}))){var m=new c,g=m[h](o?{}:-0,1)!=m,v=u(function(){m.has(1)}),y=pt(function(e){new c(e)}),E=!o&&u(function(){for(var e=new c,t=5;t--;)e[h](t,t);return!e.has(-0)});y||((c=t(function(t,r){U(t,c,e);var i=function(e,t,r){var i,n=t.constructor;return n!==r&&"function"==typeof n&&(i=n.prototype)!==r.prototype&&l(i)&&At&&At(e,i),e}(new s,t,c);return void 0!=r&&Et(r,n,i[h],i),i})).prototype=p,p.constructor=c),(v||E)&&(f("delete"),f("has"),n&&f("get")),(E||g)&&f(h),o&&p.clear&&delete p.clear}else c=i.getConstructor(t,e,n,h),j(c.prototype,r),bt.NEED=!0;return ge(c,e),d[e]=c,L(L.G+L.W+L.F*(c!=s),d),o||i.setStrong(c,e,n),c},Lt=(Ct("Map",function(e){return function(){return e(this,arguments.length>0?arguments[0]:void 0)}},{get:function(e){var t=Rt.getEntry(xt(this,"Map"),e);return t&&t.v},set:function(e,t){return Rt.def(xt(this,"Map"),0===e?0:e,t)}},Rt,!0),Ct("Set",function(e){return function(){return e(this,arguments.length>0?arguments[0]:void 0)}},{add:function(e){return Rt.def(xt(this,"Set"),e=0===e?0:e,e)}},Rt),{f:Object.getOwnPropertySymbols}),Ot=Object.assign,Ht=!Ot||u(function(){var e={},t={},r=Symbol(),i="abcdefghijklmnopqrst";return e[r]=7,i.split("").forEach(function(e){t[e]=e}),7!=Ot({},e)[r]||Object.keys(Ot({},t)).join("")!=i})?function(e,t){for(var r=he(e),i=arguments.length,n=1,o=Lt.f,a=ft.f;i>n;)for(var s,l=Q(arguments[n++]),c=o?Ie(l).concat(o(l)):Ie(l),u=c.length,h=0;u>h;)a.call(l,s=c[h++])&&(r[s]=l[s]);return r}:Ot,Ft=bt.getWeak,It=Ke(5),kt=Ke(6),Dt=0,Nt=function(e){return e._l||(e._l=new jt)},jt=function(){this.a=[]},Ut=function(e,t){return It(e.a,function(e){return e[0]===t})};jt.prototype={get:function(e){var t=Ut(this,e);if(t)return t[1]},has:function(e){return!!Ut(this,e)},set:function(e,t){var r=Ut(this,e);r?r[1]=t:this.a.push([e,t])},delete:function(e){var t=kt(this.a,function(t){return t[0]===e});return~t&&this.a.splice(t,1),!!~t}};var Bt={getConstructor:function(e,t,r,i){var n=e(function(e,o){U(e,n,t,"_i"),e._t=t,e._i=Dt++,e._l=void 0,void 0!=o&&Et(o,r,e[i],e)});return j(n.prototype,{delete:function(e){if(!l(e))return!1;var r=Ft(e);return!0===r?Nt(xt(this,t)).delete(e):r&&_(r,this._i)&&delete r[this._i]},has:function(e){if(!l(e))return!1;var r=Ft(e);return!0===r?Nt(xt(this,t)).has(e):r&&_(r,this._i)}}),n},def:function(e,t,r){var i=Ft(c(t),!0);return!0===i?Nt(e).set(t,r):i[e._i]=r,e},ufstore:Nt};t(function(e){var t,r=Ke(0),i=bt.getWeak,n=Object.isExtensible,o=Bt.ufstore,a={},s=function(e){return function(){return e(this,arguments.length>0?arguments[0]:void 0)}},c={get:function(e){if(l(e)){var t=i(e);return!0===t?o(xt(this,"WeakMap")).get(e):t?t[this._i]:void 0}},set:function(e,t){return Bt.def(xt(this,"WeakMap"),e,t)}},h=e.exports=Ct("WeakMap",s,c,Bt,!0,!0);u(function(){return 7!=(new h).set((Object.freeze||Object)(a),7).get(a)})&&(t=Bt.getConstructor(s,"WeakMap"),Ht(t.prototype,c),bt.NEED=!0,r(["delete","has","get","set"],function(e){var r=h.prototype,i=r[e];R(r,e,function(r,o){if(l(r)&&!n(r)){this._f||(this._f=new t);var a=this._f[e](r,o);return"set"==e?this:a}return i.call(this,r,o)})}))});Ct("WeakSet",function(e){return function(){return e(this,arguments.length>0?arguments[0]:void 0)}},{add:function(e){return Bt.def(xt(this,"WeakSet"),e,!0)}},Bt,!1,!0);var Vt=(a.Reflect||{}).apply,zt=Function.apply;L(L.S+L.F*!u(function(){Vt(function(){})}),"Reflect",{apply:function(e,t,r){var i=S(e),n=c(r);return Vt?Vt(i,t,n):zt.call(i,t,n)}});var qt=function(e,t,r){var i=void 0===r;switch(t.length){case 0:return i?e():e.call(r);case 1:return i?e(t[0]):e.call(r,t[0]);case 2:return i?e(t[0],t[1]):e.call(r,t[0],t[1]);case 3:return i?e(t[0],t[1],t[2]):e.call(r,t[0],t[1],t[2]);case 4:return i?e(t[0],t[1],t[2],t[3]):e.call(r,t[0],t[1],t[2],t[3])}return e.apply(r,t)},Gt=[].slice,Wt={},Xt=Function.bind||function(e){var t=S(this),r=Gt.call(arguments,1),i=function(){var n=r.concat(Gt.call(arguments));return this instanceof i?function(e,t,r){if(!(t in Wt)){for(var i=[],n=0;n<t;n++)i[n]="a["+n+"]";Wt[t]=Function("F,a","return new F("+i.join(",")+")")}return Wt[t](e,r)}(t,n.length,n):qt(t,n,e)};return l(t.prototype)&&(i.prototype=t.prototype),i},Yt=(a.Reflect||{}).construct,Qt=u(function(){function e(){}return!(Yt(function(){},[],e)instanceof e)}),Jt=!u(function(){Yt(function(){})});L(L.S+L.F*(Qt||Jt),"Reflect",{construct:function(e,t){S(e),c(t);var r=arguments.length<3?e:S(arguments[2]);if(Jt&&!Qt)return Yt(e,t,r);if(e==r){switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3])}var i=[null];return i.push.apply(i,t),new(Xt.apply(e,i))}var n=r.prototype,o=Ve(l(n)?n:Object.prototype),a=Function.apply.call(e,o,t);return l(a)?a:o}}),L(L.S+L.F*u(function(){Reflect.defineProperty(y.f({},1,{value:1}),1,{value:2})}),"Reflect",{defineProperty:function(e,t,r){c(e),t=g(t,!0),c(r);try{return y.f(e,t,r),!0}catch(e){return!1}}});var Kt=gt.f;L(L.S,"Reflect",{deleteProperty:function(e,t){var r=Kt(c(e),t);return!(r&&!r.configurable)&&delete e[t]}}),L(L.S,"Reflect",{get:r}),L(L.S,"Reflect",{getOwnPropertyDescriptor:function(e,t){return gt.f(c(e),t)}}),L(L.S,"Reflect",{getPrototypeOf:function(e){return Ge(c(e))}}),L(L.S,"Reflect",{has:function(e,t){return t in e}});var Zt=Object.isExtensible;L(L.S,"Reflect",{isExtensible:function(e){return c(e),!Zt||Zt(e)}});var $t=a.Reflect,er=$t&&$t.ownKeys||function(e){var t=ue.f(c(e)),r=Lt.f;return r?t.concat(r(e)):t};L(L.S,"Reflect",{ownKeys:er});var tr=Object.preventExtensions;L(L.S,"Reflect",{preventExtensions:function(e){c(e);try{return tr&&tr(e),!0}catch(e){return!1}}}),L(L.S,"Reflect",{set:i}),Pt&&L(L.S,"Reflect",{setPrototypeOf:function(e,t){Pt.check(e,t);try{return Pt.set(e,t),!0}catch(e){return!1}}});var rr,ir,nr,or=a.process,ar=a.setImmediate,sr=a.clearImmediate,lr=a.MessageChannel,cr=a.Dispatch,ur=0,hr={},pr=function(){var e=+this;if(hr.hasOwnProperty(e)){var t=hr[e];delete hr[e],t()}},dr=function(e){pr.call(e.data)};ar&&sr||(ar=function(e){for(var t=[],r=1;arguments.length>r;)t.push(arguments[r++]);return hr[++ur]=function(){qt("function"==typeof e?e:Function(e),t)},rr(ur),ur},sr=function(e){delete hr[e]},"process"==Y(or)?rr=function(e){or.nextTick(P(pr,e,1))}:cr&&cr.now?rr=function(e){cr.now(P(pr,e,1))}:lr?(nr=(ir=new lr).port2,ir.port1.onmessage=dr,rr=P(nr.postMessage,nr,1)):a.addEventListener&&"function"==typeof postMessage&&!a.importScripts?(rr=function(e){a.postMessage(e+"","*")},a.addEventListener("message",dr,!1)):rr="onreadystatechange"in f("script")?function(e){Ne.appendChild(f("script")).onreadystatechange=function(){Ne.removeChild(this),pr.call(e)}}:function(e){setTimeout(P(pr,e,1),0)});var fr,mr,gr,vr,yr={set:ar,clear:sr},Er=yr.set,br=a.MutationObserver||a.WebKitMutationObserver,xr=a.process,_r=a.Promise,wr="process"==Y(xr),Tr={f:function(e){return new function(e){var t,r;this.promise=new e(function(e,i){if(void 0!==t||void 0!==r)throw TypeError("Bad Promise constructor");t=e,r=i}),this.resolve=S(t),this.reject=S(r)}(e)}},Mr=function(e){try{return{e:!1,v:e()}}catch(e){return{e:!0,v:e}}},Rr=a.navigator,Sr=Rr&&Rr.userAgent||"",Pr=yr.set,Ar=function(){var e,t,r,i=function(){var i,n;for(wr&&(i=xr.domain)&&i.exit();e;){n=e.fn,e=e.next;try{n()}catch(i){throw e?r():t=void 0,i}}t=void 0,i&&i.enter()};if(wr)r=function(){xr.nextTick(i)};else if(!br||a.navigator&&a.navigator.standalone)if(_r&&_r.resolve){var n=_r.resolve(void 0);r=function(){n.then(i)}}else r=function(){Er.call(a,i)};else{var o=!0,s=document.createTextNode("");new br(i).observe(s,{characterData:!0}),r=function(){s.data=o=!o}}return function(i){var n={fn:i,next:void 0};t&&(t.next=n),e||(e=n,r()),t=n}}(),Cr=a.TypeError,Lr=a.process,Or=Lr&&Lr.versions,Hr=Or&&Or.v8||"",Fr=a.Promise,Ir="process"==Ce(Lr),kr=function(){},Dr=mr=Tr.f,Nr=!!function(){try{var e=Fr.resolve(1),t=(e.constructor={})[de("species")]=function(e){e(kr,kr)};return(Ir||"function"==typeof PromiseRejectionEvent)&&e.then(kr)instanceof t&&0!==Hr.indexOf("6.6")&&-1===Sr.indexOf("Chrome/66")}catch(e){}}(),jr=function(e){var t;return!(!l(e)||"function"!=typeof(t=e.then))&&t},Ur=function(e,t){if(!e._n){e._n=!0;var r=e._c;Ar(function(){for(var i=e._v,n=1==e._s,o=0,a=function(t){var r,o,a,s=n?t.ok:t.fail,l=t.resolve,c=t.reject,u=t.domain;try{s?(n||(2==e._h&&zr(e),e._h=1),!0===s?r=i:(u&&u.enter(),r=s(i),u&&(u.exit(),a=!0)),r===t.promise?c(Cr("Promise-chain cycle")):(o=jr(r))?o.call(r,l,c):l(r)):c(i)}catch(e){u&&!a&&u.exit(),c(e)}};r.length>o;)a(r[o++]);e._c=[],e._n=!1,t&&!e._h&&Br(e)})}},Br=function(e){Pr.call(a,function(){var t,r,i,n=e._v,o=Vr(e);if(o&&(t=Mr(function(){Ir?Lr.emit("unhandledRejection",n,e):(r=a.onunhandledrejection)?r({promise:e,reason:n}):(i=a.console)&&i.error&&i.error("Unhandled promise rejection",n)}),e._h=Ir||Vr(e)?2:1),e._a=void 0,o&&t.e)throw t.v})},Vr=function(e){return 1!==e._h&&0===(e._a||e._c).length},zr=function(e){Pr.call(a,function(){var t;Ir?Lr.emit("rejectionHandled",e):(t=a.onrejectionhandled)&&t({promise:e,reason:e._v})})},qr=function(e){var t=this;t._d||(t._d=!0,(t=t._w||t)._v=e,t._s=2,t._a||(t._a=t._c.slice()),Ur(t,!0))},Gr=function(e){var t,r=this;if(!r._d){r._d=!0,r=r._w||r;try{if(r===e)throw Cr("Promise can't be resolved itself");(t=jr(e))?Ar(function(){var i={_w:r,_d:!1};try{t.call(e,P(Gr,i,1),P(qr,i,1))}catch(e){qr.call(i,e)}}):(r._v=e,r._s=1,Ur(r,!1))}catch(e){qr.call({_w:r,_d:!1},e)}}};Nr||(Fr=function(e){U(this,Fr,"Promise","_h"),S(e),fr.call(this);try{e(P(Gr,this,1),P(qr,this,1))}catch(e){qr.call(this,e)}},(fr=function(e){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1}).prototype=j(Fr.prototype,{then:function(e,t){var r=Dr(Ee(this,Fr));return r.ok="function"!=typeof e||e,r.fail="function"==typeof t&&t,r.domain=Ir?Lr.domain:void 0,this._c.push(r),this._a&&this._a.push(r),this._s&&Ur(this,!1),r.promise},catch:function(e){return this.then(void 0,e)}}),gr=function(){var e=new fr;this.promise=e,this.resolve=P(Gr,e,1),this.reject=P(qr,e,1)},Tr.f=Dr=function(e){return e===Fr||e===vr?new gr(e):mr(e)}),L(L.G+L.W+L.F*!Nr,{Promise:Fr}),ge(Fr,"Promise"),xe("Promise"),vr=s.Promise,L(L.S+L.F*!Nr,"Promise",{reject:function(e){var t=Dr(this);return(0,t.reject)(e),t.promise}}),L(L.S+L.F*!Nr,"Promise",{resolve:function(e){return function(e,t){if(c(e),l(t)&&t.constructor===e)return t;var r=Tr.f(e);return(0,r.resolve)(t),r.promise}(this,e)}}),L(L.S+L.F*!(Nr&&pt(function(e){Fr.all(e).catch(kr)})),"Promise",{all:function(e){var t=this,r=Dr(t),i=r.resolve,n=r.reject,o=Mr(function(){var r=[],o=0,a=1;Et(e,!1,function(e){var s=o++,l=!1;r.push(void 0),a++,t.resolve(e).then(function(e){l||(l=!0,r[s]=e,--a||i(r))},n)}),--a||i(r)});return o.e&&n(o.v),r.promise},race:function(e){var t=this,r=Dr(t),i=r.reject,n=Mr(function(){Et(e,!1,function(e){t.resolve(e).then(r.resolve,i)})});return n.e&&i(n.v),r.promise}});var Wr={f:de},Xr=y.f,Yr=function(e){var t=s.Symbol||(s.Symbol=a.Symbol||{});"_"==e.charAt(0)||e in t||Xr(t,e,{value:Wr.f(e)})},Qr=ue.f,Jr={}.toString,Kr="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],Zr={f:function(e){return Kr&&"[object Window]"==Jr.call(e)?function(e){try{return Qr(e)}catch(e){return Kr.slice()}}(e):Qr(K(e))}},$r=bt.KEY,ei=gt.f,ti=y.f,ri=Zr.f,ii=a.Symbol,ni=a.JSON,oi=ni&&ni.stringify,ai=de("_hidden"),si=de("toPrimitive"),li={}.propertyIsEnumerable,ci=re("symbol-registry"),ui=re("symbols"),hi=re("op-symbols"),pi=Object.prototype,di="function"==typeof ii,fi=a.QObject,mi=!fi||!fi.prototype||!fi.prototype.findChild,gi=h&&u(function(){return 7!=Ve(ti({},"a",{get:function(){return ti(this,"a",{value:7}).a}})).a})?function(e,t,r){var i=ei(pi,t);i&&delete pi[t],ti(e,t,r),i&&e!==pi&&ti(pi,t,i)}:ti,vi=function(e){var t=ui[e]=Ve(ii.prototype);return t._k=e,t},yi=di&&"symbol"==typeof ii.iterator?function(e){return"symbol"==typeof e}:function(e){return e instanceof ii},Ei=function(e,t,r){return e===pi&&Ei(hi,t,r),c(e),t=g(t,!0),c(r),_(ui,t)?(r.enumerable?(_(e,ai)&&e[ai][t]&&(e[ai][t]=!1),r=Ve(r,{enumerable:E(0,!1)})):(_(e,ai)||ti(e,ai,E(1,{})),e[ai][t]=!0),gi(e,t,r)):ti(e,t,r)},bi=function(e,t){c(e);for(var r,i=function(e){var t=Ie(e),r=Lt.f;if(r)for(var i,n=r(e),o=ft.f,a=0;n.length>a;)o.call(e,i=n[a++])&&t.push(i);return t}(t=K(t)),n=0,o=i.length;o>n;)Ei(e,r=i[n++],t[r]);return e},xi=function(e){var t=li.call(this,e=g(e,!0));return!(this===pi&&_(ui,e)&&!_(hi,e))&&(!(t||!_(this,e)||!_(ui,e)||_(this,ai)&&this[ai][e])||t)},_i=function(e,t){if(e=K(e),t=g(t,!0),e!==pi||!_(ui,t)||_(hi,t)){var r=ei(e,t);return!r||!_(ui,t)||_(e,ai)&&e[ai][t]||(r.enumerable=!0),r}},wi=function(e){for(var t,r=ri(K(e)),i=[],n=0;r.length>n;)_(ui,t=r[n++])||t==ai||t==$r||i.push(t);return i},Ti=function(e){for(var t,r=e===pi,i=ri(r?hi:K(e)),n=[],o=0;i.length>o;)!_(ui,t=i[o++])||r&&!_(pi,t)||n.push(ui[t]);return n};di||(R((ii=function(){if(this instanceof ii)throw TypeError("Symbol is not a constructor!");var e=M(arguments.length>0?arguments[0]:void 0),t=function(r){this===pi&&t.call(hi,r),_(this,ai)&&_(this[ai],e)&&(this[ai][e]=!1),gi(this,e,E(1,r))};return h&&mi&&gi(pi,e,{configurable:!0,set:t}),vi(e)}).prototype,"toString",function(){return this._k}),gt.f=_i,y.f=Ei,ue.f=Zr.f=wi,ft.f=xi,Lt.f=Ti,h&&R(pi,"propertyIsEnumerable",xi,!0),Wr.f=function(e){return vi(de(e))}),L(L.G+L.W+L.F*!di,{Symbol:ii});for(var Mi="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),Ri=0;Mi.length>Ri;)de(Mi[Ri++]);for(var Si=Ie(de.store),Pi=0;Si.length>Pi;)Yr(Si[Pi++]);L(L.S+L.F*!di,"Symbol",{for:function(e){return _(ci,e+="")?ci[e]:ci[e]=ii(e)},keyFor:function(e){if(!yi(e))throw TypeError(e+" is not a symbol!");for(var t in ci)if(ci[t]===e)return t},useSetter:function(){mi=!0},useSimple:function(){mi=!1}}),L(L.S+L.F*!di,"Object",{create:function(e,t){return void 0===t?Ve(e):bi(Ve(e),t)},defineProperty:Ei,defineProperties:bi,getOwnPropertyDescriptor:_i,getOwnPropertyNames:wi,getOwnPropertySymbols:Ti}),ni&&L(L.S+L.F*(!di||u(function(){var e=ii();return"[null]"!=oi([e])||"{}"!=oi({a:e})||"{}"!=oi(Object(e))})),"JSON",{stringify:function(e){for(var t,r,i=[e],n=1;arguments.length>n;)i.push(arguments[n++]);if(r=t=i[1],(l(t)||void 0!==e)&&!yi(e))return Ye(t)||(t=function(e,t){if("function"==typeof r&&(t=r.call(this,e,t)),!yi(t))return t}),i[1]=t,oi.apply(ni,i)}}),ii.prototype[si]||b(ii.prototype,si,ii.prototype.valueOf),ge(ii,"Symbol"),ge(Math,"Math",!0),ge(a.JSON,"JSON",!0);var Ai=function(e,t){var r=(s.Object||{})[e]||Object[e],i={};i[e]=t(r),L(L.S+L.F*u(function(){r(1)}),"Object",i)},Ci=bt.onFreeze;Ai("freeze",function(e){return function(t){return e&&l(t)?e(Ci(t)):t}});var Li=bt.onFreeze;Ai("seal",function(e){return function(t){return e&&l(t)?e(Li(t)):t}});var Oi=bt.onFreeze;Ai("preventExtensions",function(e){return function(t){return e&&l(t)?e(Oi(t)):t}}),Ai("isFrozen",function(e){return function(t){return!l(t)||!!e&&e(t)}}),Ai("isSealed",function(e){return function(t){return!l(t)||!!e&&e(t)}}),Ai("isExtensible",function(e){return function(t){return!!l(t)&&(!e||e(t))}});var Hi=gt.f;Ai("getOwnPropertyDescriptor",function(){return function(e,t){return Hi(K(e),t)}}),Ai("getPrototypeOf",function(){return function(e){return Ge(he(e))}}),Ai("keys",function(){return function(e){return Ie(he(e))}}),Ai("getOwnPropertyNames",function(){return Zr.f}),L(L.S+L.F,"Object",{assign:Ht});var Fi=Object.is||function(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t};L(L.S,"Object",{is:Fi}),L(L.S,"Object",{setPrototypeOf:Pt.set});var Ii=y.f,ki=Function.prototype,Di=/^\s*function ([^ (]*)/;"name"in ki||h&&Ii(ki,"name",{configurable:!0,get:function(){try{return(""+this).match(Di)[1]}catch(e){return""}}}),L(L.S,"String",{raw:function(e){for(var t=K(e.raw),r=G(t.length),i=arguments.length,n=[],o=0;r>o;)n.push(String(t[o++])),o<i&&n.push(String(arguments[o]));return n.join("")}});var Ni=String.fromCharCode,ji=String.fromCodePoint;L(L.S+L.F*(!!ji&&1!=ji.length),"String",{fromCodePoint:function(e){for(var t,r=[],i=arguments.length,n=0;i>n;){if(t=+arguments[n++],ee(t,1114111)!==t)throw RangeError(t+" is not a valid code point");r.push(t<65536?Ni(t):Ni(55296+((t-=65536)>>10),t%1024+56320))}return r.join("")}});var Ui=function(e){return function(t,r){var i,n,o=String(J(t)),a=z(r),s=o.length;return a<0||a>=s?e?"":void 0:(i=o.charCodeAt(a))<55296||i>56319||a+1===s||(n=o.charCodeAt(a+1))<56320||n>57343?e?o.charAt(a):i:e?o.slice(a,a+2):n-56320+(i-55296<<10)+65536}}(!1);L(L.P,"String",{codePointAt:function(e){return Ui(this,e)}});var Bi=function(e){var t=String(J(this)),r="",i=z(e);if(i<0||i==1/0)throw RangeError("Count can't be negative");for(;i>0;(i>>>=1)&&(t+=t))1&i&&(r+=t);return r};L(L.P,"String",{repeat:Bi});var Vi=de("match"),zi=function(e){var t;return l(e)&&(void 0!==(t=e[Vi])?!!t:"RegExp"==Y(e))},qi=function(e,t,r){if(zi(t))throw TypeError("String#"+r+" doesn't accept regex!");return String(J(e))},Gi=de("match"),Wi=function(e){var t=/./;try{"/./"[e](t)}catch(r){try{return t[Gi]=!1,!"/./"[e](t)}catch(e){}}return!0},Xi="".startsWith;L(L.P+L.F*Wi("startsWith"),"String",{startsWith:function(e){var t=qi(this,e,"startsWith"),r=G(Math.min(arguments.length>1?arguments[1]:void 0,t.length)),i=String(e);return Xi?Xi.call(t,i,r):t.slice(r,r+i.length)===i}});var Yi="".endsWith;L(L.P+L.F*Wi("endsWith"),"String",{endsWith:function(e){var t=qi(this,e,"endsWith"),r=arguments.length>1?arguments[1]:void 0,i=G(t.length),n=void 0===r?i:Math.min(G(r),i),o=String(e);return Yi?Yi.call(t,o,n):t.slice(n-o.length,n)===o}});L(L.P+L.F*Wi("includes"),"String",{includes:function(e){return!!~qi(this,e,"includes").indexOf(e,arguments.length>1?arguments[1]:void 0)}});h&&"g"!=/./g.flags&&y.f(RegExp.prototype,"flags",{configurable:!0,get:function(){var e=c(this),t="";return e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.unicode&&(t+="u"),e.sticky&&(t+="y"),t}});var Qi=function(e,t,r){var i=de(e),n=r(J,i,""[e]),o=n[0],a=n[1];u(function(){var t={};return t[i]=function(){return 7},7!=""[e](t)})&&(R(String.prototype,e,o),b(RegExp.prototype,i,2==t?function(e,t){return a.call(e,this,t)}:function(e){return a.call(e,this)}))};Qi("match",1,function(e,t,r){return[function(r){var i=e(this),n=void 0==r?void 0:r[t];return void 0!==n?n.call(r,i):new RegExp(r)[t](String(i))},r]}),Qi("replace",2,function(e,t,r){return[function(i,n){var o=e(this),a=void 0==i?void 0:i[t];return void 0!==a?a.call(i,o,n):r.call(String(o),i,n)},r]}),Qi("split",2,function(e,t,r){var i=zi,n=r,o=[].push;if("c"=="abbc".split(/(b)*/)[1]||4!="test".split(/(?:)/,-1).length||2!="ab".split(/(?:ab)*/).length||4!=".".split(/(.?)(.?)/).length||".".split(/()()/).length>1||"".split(/.?/).length){var a=void 0===/()??/.exec("")[1];r=function(e,t){var r=String(this);if(void 0===e&&0===t)return[];if(!i(e))return n.call(r,e,t);var s,l,c,u,h,p=[],d=(e.ignoreCase?"i":"")+(e.multiline?"m":"")+(e.unicode?"u":"")+(e.sticky?"y":""),f=0,m=void 0===t?4294967295:t>>>0,g=new RegExp(e.source,d+"g");for(a||(s=new RegExp("^"+g.source+"$(?!\\s)",d));(l=g.exec(r))&&!((c=l.index+l[0].length)>f&&(p.push(r.slice(f,l.index)),!a&&l.length>1&&l[0].replace(s,function(){for(h=1;h<arguments.length-2;h++)void 0===arguments[h]&&(l[h]=void 0)}),l.length>1&&l.index<r.length&&o.apply(p,l.slice(1)),u=l[0].length,f=c,p.length>=m));)g.lastIndex===l.index&&g.lastIndex++;return f===r.length?!u&&g.test("")||p.push(""):p.push(r.slice(f)),p.length>m?p.slice(0,m):p}}else"0".split(void 0,0).length&&(r=function(e,t){return void 0===e&&0===t?[]:n.call(this,e,t)});return[function(i,n){var o=e(this),a=void 0==i?void 0:i[t];return void 0!==a?a.call(i,o,n):r.call(String(o),i,n)},r]}),Qi("search",1,function(e,t,r){return[function(r){var i=e(this),n=void 0==r?void 0:r[t];return void 0!==n?n.call(r,i):new RegExp(r)[t](String(i))},r]});var Ji=function(e,t,r){t in e?y.f(e,t,E(0,r)):e[t]=r};L(L.S+L.F*!pt(function(e){Array.from(e)}),"Array",{from:function(e){var t,r,i,n,o=he(e),a="function"==typeof this?this:Array,s=arguments.length,l=s>1?arguments[1]:void 0,c=void 0!==l,u=0,h=Xe(o);if(c&&(l=P(l,s>2?arguments[2]:void 0,2)),void 0==h||a==Array&&Fe(h))for(r=new a(t=G(o.length));t>u;u++)Ji(r,u,c?l(o[u],u):o[u]);else for(n=h.call(o),r=new a;!(i=n.next()).done;u++)Ji(r,u,c?yt(n,l,[i.value,u],!0):i.value);return r.length=u,r}}),L(L.S+L.F*u(function(){function e(){}return!(Array.of.call(e)instanceof e)}),"Array",{of:function(){for(var e=0,t=arguments.length,r=new("function"==typeof this?this:Array)(t);t>e;)Ji(r,e,arguments[e++]);return r.length=t,r}}),L(L.P,"Array",{copyWithin:dt}),et("copyWithin");var Ki=Ke(5),Zi=!0;"find"in[]&&Array(1).find(function(){Zi=!1}),L(L.P+L.F*Zi,"Array",{find:function(e){return Ki(this,e,arguments.length>1?arguments[1]:void 0)}}),et("find");var $i=Ke(6),en=!0;"findIndex"in[]&&Array(1).findIndex(function(){en=!1}),L(L.P+L.F*en,"Array",{findIndex:function(e){return $i(this,e,arguments.length>1?arguments[1]:void 0)}}),et("findIndex"),L(L.P,"Array",{fill:pe}),et("fill");var tn=a.isFinite;L(L.S,"Number",{isFinite:function(e){return"number"==typeof e&&tn(e)}});var rn=Math.floor,nn=function(e){return!l(e)&&isFinite(e)&&rn(e)===e};L(L.S,"Number",{isInteger:nn});var on=Math.abs;L(L.S,"Number",{isSafeInteger:function(e){return nn(e)&&on(e)<=9007199254740991}}),L(L.S,"Number",{isNaN:function(e){return e!=e}}),L(L.S,"Number",{EPSILON:Math.pow(2,-52)}),L(L.S,"Number",{MIN_SAFE_INTEGER:-9007199254740991}),L(L.S,"Number",{MAX_SAFE_INTEGER:9007199254740991});var an=Math.log1p||function(e){return(e=+e)>-1e-8&&e<1e-8?e-e*e/2:Math.log(1+e)},sn=Math.sqrt,ln=Math.acosh;L(L.S+L.F*!(ln&&710==Math.floor(ln(Number.MAX_VALUE))&&ln(1/0)==1/0),"Math",{acosh:function(e){return(e=+e)<1?NaN:e>94906265.62425156?Math.log(e)+Math.LN2:an(e-1+sn(e-1)*sn(e+1))}});var cn=Math.asinh;L(L.S+L.F*!(cn&&1/cn(0)>0),"Math",{asinh:n});var un=Math.atanh;L(L.S+L.F*!(un&&1/un(-0)<0),"Math",{atanh:function(e){return 0==(e=+e)?e:Math.log((1+e)/(1-e))/2}});var hn=Math.sign||function(e){return 0==(e=+e)||e!=e?e:e<0?-1:1};L(L.S,"Math",{cbrt:function(e){return hn(e=+e)*Math.pow(Math.abs(e),1/3)}}),L(L.S,"Math",{clz32:function(e){return(e>>>=0)?31-Math.floor(Math.log(e+.5)*Math.LOG2E):32}});var pn=Math.exp;L(L.S,"Math",{cosh:function(e){return(pn(e=+e)+pn(-e))/2}});var dn=Math.expm1,fn=!dn||dn(10)>22025.465794806718||dn(10)<22025.465794806718||-2e-17!=dn(-2e-17)?function(e){return 0==(e=+e)?e:e>-1e-6&&e<1e-6?e+e*e/2:Math.exp(e)-1}:dn;L(L.S+L.F*(fn!=Math.expm1),"Math",{expm1:fn});var mn=Math.pow,gn=mn(2,-52),vn=mn(2,-23),yn=mn(2,127)*(2-vn),En=mn(2,-126),bn=Math.fround||function(e){var t,r,i=Math.abs(e),n=hn(e);return i<En?n*function(e){return e+1/gn-1/gn}(i/En/vn)*En*vn:(t=(1+vn/gn)*i,(r=t-(t-i))>yn||r!=r?n*(1/0):n*r)};L(L.S,"Math",{fround:bn});var xn=Math.abs;L(L.S,"Math",{hypot:function(e,t){for(var r,i,n=0,o=0,a=arguments.length,s=0;o<a;)s<(r=xn(arguments[o++]))?(n=n*(i=s/r)*i+1,s=r):n+=r>0?(i=r/s)*i:r;return s===1/0?1/0:s*Math.sqrt(n)}});var _n=Math.imul;L(L.S+L.F*u(function(){return-5!=_n(4294967295,5)||2!=_n.length}),"Math",{imul:function(e,t){var r=+e,i=+t,n=65535&r,o=65535&i;return 0|n*o+((65535&r>>>16)*o+n*(65535&i>>>16)<<16>>>0)}}),L(L.S,"Math",{log1p:an}),L(L.S,"Math",{log10:function(e){return Math.log(e)*Math.LOG10E}}),L(L.S,"Math",{log2:function(e){return Math.log(e)/Math.LN2}}),L(L.S,"Math",{sign:hn});var wn=Math.exp;L(L.S+L.F*u(function(){return-2e-17!=!Math.sinh(-2e-17)}),"Math",{sinh:function(e){return Math.abs(e=+e)<1?(fn(e)-fn(-e))/2:(wn(e-1)-wn(-e-1))*(Math.E/2)}});var Tn=Math.exp;L(L.S,"Math",{tanh:function(e){var t=fn(e=+e),r=fn(-e);return t==1/0?1:r==1/0?-1:(t-r)/(Tn(e)+Tn(-e))}}),L(L.S,"Math",{trunc:function(e){return(e>0?Math.floor:Math.ceil)(e)}});var Mn=te(!0);L(L.P,"Array",{includes:function(e){return Mn(this,e,arguments.length>1?arguments[1]:void 0)}}),et("includes");var Rn=ft.f,Sn=function(e){return function(t){for(var r,i=K(t),n=Ie(i),o=n.length,a=0,s=[];o>a;)Rn.call(i,r=n[a++])&&s.push(e?[r,i[r]]:i[r]);return s}},Pn=Sn(!1);L(L.S,"Object",{values:function(e){return Pn(e)}});var An=Sn(!0);L(L.S,"Object",{entries:function(e){return An(e)}}),L(L.S,"Object",{getOwnPropertyDescriptors:function(e){for(var t,r,i=K(e),n=gt.f,o=er(i),a={},s=0;o.length>s;)void 0!==(r=n(i,t=o[s++]))&&Ji(a,t,r);return a}});var Cn=function(e,t,r,i){var n=String(J(e)),o=n.length,a=void 0===r?" ":String(r),s=G(t);if(s<=o||""==a)return n;var l=s-o,c=Bi.call(a,Math.ceil(l/a.length));return c.length>l&&(c=c.slice(0,l)),i?c+n:n+c};L(L.P+L.F*/Version\/10\.\d+(\.\d+)? Safari\//.test(Sr),"String",{padStart:function(e){return Cn(this,e,arguments.length>1?arguments[1]:void 0,!0)}}),L(L.P+L.F*/Version\/10\.\d+(\.\d+)? Safari\//.test(Sr),"String",{padEnd:function(e){return Cn(this,e,arguments.length>1?arguments[1]:void 0,!1)}});var Ln=[].slice,On=/MSIE .\./.test(Sr),Hn=function(e){return function(t,r){var i=arguments.length>2,n=!!i&&Ln.call(arguments,2);return e(i?function(){("function"==typeof t?t:Function(t)).apply(this,n)}:t,r)}};L(L.G+L.B+L.F*On,{setTimeout:Hn(a.setTimeout),setInterval:Hn(a.setInterval)}),L(L.G+L.B,{setImmediate:yr.set,clearImmediate:yr.clear});for(var Fn=de("iterator"),In=de("toStringTag"),kn=Le.Array,Dn={CSSRuleList:!0,CSSStyleDeclaration:!1,CSSValueList:!1,ClientRectList:!1,DOMRectList:!1,DOMStringList:!1,DOMTokenList:!0,DataTransferItemList:!1,FileList:!1,HTMLAllCollection:!1,HTMLCollection:!1,HTMLFormElement:!1,HTMLSelectElement:!1,MediaList:!0,MimeTypeArray:!1,NamedNodeMap:!1,NodeList:!0,PaintRequestList:!1,Plugin:!1,PluginArray:!1,SVGLengthList:!1,SVGNumberList:!1,SVGPathSegList:!1,SVGPointList:!1,SVGStringList:!1,SVGTransformList:!1,SourceBufferList:!1,StyleSheetList:!0,TextTrackCueList:!1,TextTrackList:!1,TouchList:!1},Nn=Ie(Dn),jn=0;jn<Nn.length;jn++){var Un,Bn=Nn[jn],Vn=Dn[Bn],zn=a[Bn],qn=zn&&zn.prototype;if(qn&&(qn[Fn]||b(qn,Fn,kn),qn[In]||b(qn,In,Bn),Le[Bn]=kn,Vn))for(Un in lt)qn[Un]||R(qn,Un,lt[Un],!0)}t(function(e){!function(t){function r(e,t,r,o){var a=t&&t.prototype instanceof n?t:n,s=Object.create(a.prototype),l=new p(o||[]);return s._invoke=function(e,t,r){var n=w;return function(o,a){if(n===M)throw new Error("Generator is already running");if(n===R){if("throw"===o)throw a;return f()}for(r.method=o,r.arg=a;;){var s=r.delegate;if(s){var l=c(s,r);if(l){if(l===S)continue;return l}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(n===w)throw n=R,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n=M;var u=i(e,t,r);if("normal"===u.type){if(n=r.done?R:T,u.arg===S)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(n=R,r.method="throw",r.arg=u.arg)}}}(e,r,l),s}function i(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}function n(){}function o(){}function a(){}function s(e){["next","throw","return"].forEach(function(t){e[t]=function(e){return this._invoke(t,e)}})}function l(e){function r(t,n,o,a){var s=i(e[t],e,n);if("throw"!==s.type){var l=s.arg,c=l.value;return c&&"object"==typeof c&&v.call(c,"__await")?Promise.resolve(c.__await).then(function(e){r("next",e,o,a)},function(e){r("throw",e,o,a)}):Promise.resolve(c).then(function(e){l.value=e,o(l)},a)}a(s.arg)}"object"==typeof t.process&&t.process.domain&&(r=t.process.domain.bind(r));var n;this._invoke=function(e,t){function i(){return new Promise(function(i,n){r(e,t,i,n)})}return n=n?n.then(i,i):i()}}function c(e,t){var r=e.iterator[t.method];if(r===m){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=m,c(e,t),"throw"===t.method))return S;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return S}var n=i(r,e.iterator,t.arg);if("throw"===n.type)return t.method="throw",t.arg=n.arg,t.delegate=null,S;var o=n.arg;return o?o.done?(t[e.resultName]=o.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=m),t.delegate=null,S):o:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,S)}function u(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function h(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function p(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(u,this),this.reset(!0)}function d(e){if(e){var t=e[E];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,i=function t(){for(;++r<e.length;)if(v.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=m,t.done=!0,t};return i.next=i}}return{next:f}}function f(){return{value:m,done:!0}}var m,g=Object.prototype,v=g.hasOwnProperty,y="function"==typeof Symbol?Symbol:{},E=y.iterator||"@@iterator",b=y.asyncIterator||"@@asyncIterator",x=y.toStringTag||"@@toStringTag",_=t.regeneratorRuntime;if(_)e.exports=_;else{(_=t.regeneratorRuntime=e.exports).wrap=r;var w="suspendedStart",T="suspendedYield",M="executing",R="completed",S={},P={};P[E]=function(){return this};var A=Object.getPrototypeOf,C=A&&A(A(d([])));C&&C!==g&&v.call(C,E)&&(P=C);var L=a.prototype=n.prototype=Object.create(P);o.prototype=L.constructor=a,a.constructor=o,a[x]=o.displayName="GeneratorFunction",_.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===o||"GeneratorFunction"===(t.displayName||t.name))},_.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,a):(e.__proto__=a,x in e||(e[x]="GeneratorFunction")),e.prototype=Object.create(L),e},_.awrap=function(e){return{__await:e}},s(l.prototype),l.prototype[b]=function(){return this},_.AsyncIterator=l,_.async=function(e,t,i,n){var o=new l(r(e,t,i,n));return _.isGeneratorFunction(t)?o:o.next().then(function(e){return e.done?e.value:o.next()})},s(L),L[x]="Generator",L[E]=function(){return this},L.toString=function(){return"[object Generator]"},_.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var i=t.pop();if(i in e)return r.value=i,r.done=!1,r}return r.done=!0,r}},_.values=d,p.prototype={constructor:p,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=m,this.done=!1,this.delegate=null,this.method="next",this.arg=m,this.tryEntries.forEach(h),!e)for(var t in this)"t"===t.charAt(0)&&v.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=m)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){function t(t,i){return o.type="throw",o.arg=e,r.next=t,i&&(r.method="next",r.arg=m),!!i}if(this.done)throw e;for(var r=this,i=this.tryEntries.length-1;i>=0;--i){var n=this.tryEntries[i],o=n.completion;if("root"===n.tryLoc)return t("end");if(n.tryLoc<=this.prev){var a=v.call(n,"catchLoc"),s=v.call(n,"finallyLoc");if(a&&s){if(this.prev<n.catchLoc)return t(n.catchLoc,!0);if(this.prev<n.finallyLoc)return t(n.finallyLoc)}else if(a){if(this.prev<n.catchLoc)return t(n.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<n.finallyLoc)return t(n.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&v.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var n=i;break}}n&&("break"===e||"continue"===e)&&n.tryLoc<=t&&t<=n.finallyLoc&&(n=null);var o=n?n.completion:{};return o.type=e,o.arg=t,n?(this.method="next",this.next=n.finallyLoc,S):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),S},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),h(r),S}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var i=r.completion;if("throw"===i.type){var n=i.arg;h(r)}return n}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:d(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=m),S}}}}("object"==typeof o?o:"object"==typeof window?window:"object"==typeof self?self:o)});var Gn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Wn=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},Xn=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),Yn=function(){function e(t,r){Wn(this,e);var i=JSON.parse(t);this._asset=i.asset,this._scene=i.scene,this._scenes=i.scenes,this._extensionsUsed=i.extensionsUsed,this._extensions=i.extensions,this._nodes=i.nodes,this._accessors=i.accessors,this._images=i.images,this._skins=i.skins,this._meshes=i.meshes,this._textures=i.textures,this._samplers=i.samplers,this._materials=i.materials,this._cameras=i.cameras,this._animations=i.animations,this._buffers=i.buffers,this._bufferViews=i.bufferViews,this._meshReferences=i.meshReferences,this._meshUses=i.meshUses,this._init(r)}return e.prototype._init=function(e){var t=e.dracoLoader;if(t)for(var r=Object.keys(this),i=0;i<r.length;i++){var n=r[i],o=this[n];o&&t.decode(this,n,o)}},Xn(e,[{key:"asset",get:function(){return this._asset}},{key:"scene",get:function(){return this._scene}},{key:"scenes",get:function(){return this._scenes}},{key:"extensionsUsed",get:function(){return this._extensionsUsed}},{key:"extensions",get:function(){return this._extensions}},{key:"nodes",get:function(){return this._nodes}},{key:"accessors",get:function(){return this._accessors}},{key:"images",get:function(){return this._images}},{key:"skins",get:function(){return this._skins}},{key:"meshes",get:function(){return this._meshes}},{key:"textures",get:function(){return this._textures}},{key:"samplers",get:function(){return this._samplers}},{key:"materials",get:function(){return this._materials}},{key:"cameras",get:function(){return this._cameras}},{key:"animations",get:function(){return this._animations}},{key:"buffers",get:function(){return this._buffers}},{key:"bufferViews",get:function(){return this._bufferViews}},{key:"meshReferences",set:function(e){this._meshReferences=e},get:function(){return this._meshReferences}},{key:"meshUses",set:function(e){this._meshUses=e},get:function(){return this._meshUses}}]),e}();JSON.parseX=function(e,t){return new Yn(e,t)},Yn.prototype.toJSON=function(){};var Qn=Object.prototype.toString,Jn=function(e){return function(t){return Qn.call(t)=="[object "+e+"]"}},Kn=function(e){if(null===e)return"null";if(void 0===e)return"undefined";return Object.prototype.toString.call(e).slice(8,-1)},Zn=null,$n={RegExp:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(e){var t="";return t+=e.global?"g":"",t+=e.multiline?"m":"",t+=e.ignoreCase?"i":"",new RegExp(e.source,t)}),Date:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(e){return new Date(+e)}),Array:function(e,t){var r,i=[];for(r=0;r<e.length;r++)if(t)i[r]=e[r];else{if(-1!==Zn.indexOf(e[r]))continue;var n=$n[Kn(e[r])];n?(Zn.push(e[r]),i[r]=n(e[r],!1)):i[r]=e[r]}return i},Object:function(e,t){var r,i,n={};for(r in e)if(e.hasOwnProperty(r))if(t)n[r]=e[r];else{if(-1!==Zn.indexOf(e[r]))continue;(i=$n[Kn(e[r])])?(Zn.push(e[r]),n[r]=i(e[r],!1)):n[r]=e[r]}return n}},eo={consoleWarnFunc:console.warn,consoleTimeFunc:console.time,consoleTimeEndFunc:console.timeEnd,isType:Jn,isArray:Jn("Array"),isObject:Jn("Object"),isString:Jn("String"),isNumber:Jn("Number"),isFunction:Jn("Function"),isRegExp:Jn("RegExp"),isUndefined:Jn("Undefined"),isBoolean:function(e){return"boolean"==typeof e},isDom:function(e){return"object"===(void 0===e?"undefined":Gn(e))&&"number"==typeof e.nodeType&&"object"===Gn(e.ownerDocument)},isNull:function(e){return void 0===e||null===e},isBlank:function(e){if(!eo.isNull(e)&&eo.isString(e))for(var t=0;t<e.length;t++)if(" "!=e[t]&&"\t"!=e[t])return!1;return!0},isEmptyObj:function(e){return"{}"==JSON.stringify(e)},isEmptyArray:function(e){return Jn("Array")(e)&&0==e.length},toLowerCase:function(e){return e?e.toLowerCase():""},objectKeysToLowerCase:function(e,t,r){var i,n,o,a,s,l,c,u;if(l=eo.objectKeysToLowerCase,"undefined"===(c=void 0===t?"undefined":Gn(t))||null===t||0===t||!1===t)t=0;else if("object"===c){if(!(t instanceof l))throw new TypeError('Expected "deep" to be a special object')}else if(!0===t)t=1/0;else{if("number"!==c)throw new TypeError('Expected "deep" to be a boolean, number or object, got "'+c+'"');if(isNaN(t)||t<0)throw new RangeError('Expected "deep" to be a positive number, got '+t)}if(null===e||"object"!==(void 0===e?"undefined":Gn(e)))throw new TypeError('Expected "input" to be an object');if(c=void 0===r?"undefined":Gn(r),null!==r&&"undefined"!==c&&"function"!==c)throw new TypeError('Expected "filter" to be a function');if(r=r||null,o=Object.keys(e),a=o.length-1,s={},t){if("number"==typeof t)t=Object.seal(Object.create(l.prototype,{input:{value:[]},output:{value:[]},level:{value:-1,writable:!0},max:{value:t,writable:!1}}));else if(~(i=t.input.indexOf(e)))return t.output[i];for(t.level+=1,t.input.push(e),t.output.push(s),i=a+1;i--;)"object"===(void 0===(u=e[n=o[a-i]])?"undefined":Gn(u))&&u&&t.level<t.max&&(r?r(u):u.constructor===Object)&&(u=l(u,t,r)),s[n.toLowerCase()]=u;t.level-=1}else for(i=a+1;i--;)s[(n=o[a-i]).toLowerCase()]=e[n];return s},cloneObject:function(e,t){Zn=[],t=void 0===t;var r=$n[Kn(e)];return r?r(e,t):e}};String.prototype.removeAt=function(e){var t=this.substring(0);return e>=this.length?t:t.slice(0,e)+t.slice(e+1)},String.prototype.getExtension=function(){var e=this.split(".");return e.length>1?e.pop():""},String.prototype.getFileName=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=this.indexOf("\\")>=0?this.lastIndexOf("\\"):this.lastIndexOf("/");if(-1===t)return e?this:this.split(".")[0];var r=this.substring(t);return 0!==r.indexOf("\\")&&0!==r.indexOf("/")||(r=r.substring(1)),e?r:r.split(".")[0]};var to=function(){function e(t){Wn(this,e),this._major=0,this._minor=0,this._modified=0;var r=t.split(".");this._major=parseInt(r.length>=1?r[0]:0),this._minor=parseInt(r.length>=2?r[1]:0),this._modified=parseInt(r.length>=3?r[2]:0)}return e.prototype.compare=function(t){return eo.isString(t)&&(t=new e(t)),this._major!=t._major?this._major>t._major?1:-1:this._minor!=t._minor?this._minor>t._minor?1:-1:this._modified!=t._modified?this._modified>t._modified?1:-1:0},Xn(e,[{key:"major",get:function(){return this._major}},{key:"minor",get:function(){return this._minor}},{key:"modified",get:function(){return this._modified}}]),e}(),ro=function(){function e(){Wn(this,e)}return e.prototype.GLTF_decoder_1_count=function(e,t,r,i){return 0==e?i-t:e%2?r%2?i+t:i:i-t},e.prototype.GLTF_decoder_1_offset=function(e,t,r,i){return t*=r,0==e?i:e%2?i-t:i},e.prototype.GLTF_decoder_1_length=function(e,t,r,i,n){return t*=r,0==e?n-t:e%2?i%2?n+t:n:n-t},e.prototype.GLTF_decoder_2_offset=function(e,t,r,i){return t*=r,e%2?i-t:i},e.prototype.GLTF_decoder_2_length=function(e,t,r,i,n){return t*=r,e%2?i%2?n+t:n:n-t},e.prototype.GLTF_decoder_3_offset=function(e,t,r,i){return t*=r,e%2?i-t:i},e.prototype.GLTF_decoder_3_length=function(e,t,r,i,n){return t*=r,e%2?i%2?n+t:n:n-t},e}(),io=function(){function e(t,r,i){Wn(this,e),this.app=t,this._decoder={},this._nameDecoder={},i?(i.data=eo.objectKeysToLowerCase(eo.cloneObject(r,!1)),this._init(i.data)):this._init(r)}return e.prototype._initDecoder=function(e){var t=e.createtime;if(t){var r=new Date(t),i=r.getSeconds();this._decoder.version=Math.floor(i/10);for(var n=e.size,o=1,a=0;a<n.length;a++){var s=n[a].toString();-1!==s.indexOf(".")&&(o+=Math.floor(s.substring(s.length-1)))}this._decoder.randomWeight=o,this._decoder.randomRanges=[r.getHours()+1,r.getDate()+1,r.getSeconds()%13+1,r.getMinutes()%13+1,o%5*(o%5)+1,e.verts%13+1,e.faces%13+1,e.nodes%13+1]}},e.prototype._decode21_name=function(e,t){var r=["F7WD3HNR2OPYV6AUS5TKM018ZBJL4EQXIGC9F","A0JQM9PSLXF18647URV3DNHOCY52TEZBWIGKA","B0IE6Q4S3C7OA28UHTPXDW9NYMGLF1K5VJRZB","EQ72MKL3DYNF5RU1PWBT64X9CIZVJHS8G0OAE"],i=e.charAt(0),n=r[1].indexOf(i);if(-1!==n){n++,n=Math.floor(n/2)+1;var o=(e=e.removeAt(n)).getExtension();e=e.getFileName(!1);for(var a="",s=0;s<e.length;s++){var l=e[s],c=r[(s+1+t)%4],u=c.indexOf(l);0===u?u=35:u--,a+=c[u]}return o?a+"."+o:a}},e.prototype._initResourceDecoder=function(e,t){var r=t.texfiles;if(r){var i=new to(e),n=null;2==i.major&&1==i.minor&&(n=this._decode21_name);var o=Object.keys(r).length,a=t.gltffiles;if(a)for(c=0;c<a.length;c++)a[c]=n(a[c],o);var s=t.lod;if(s)for(var l=Object.keys(s),c=0;c<l.length;c++){var u=l[c];s[n(u,o)]=s[u],delete s[u]}this._nameDecoder.version=i,this._nameDecoder.decodeFunc=n}},e.prototype._init=function(e){if(e){var t=e.version;if(t){new to(t).compare("2.0")<=0||(this._initDecoder(e),this._initResourceDecoder(t,e))}}},e.prototype.decode=function(e,t,r){var i=new ro;switch(this._decoder.version){case 0:case 3:p=this._decoder.randomWeight;if("_accessors"==t)for(l=0;l<r.length;l++){h=r[l];(n=e.bufferViews[h.bufferView]).factor=Math.floor(n.byteLength/h.count),n.opFactor=h.byteType,h.count=i.GLTF_decoder_1_count(l,p,h.byteType,h.count),delete h.byteType}else if("_bufferViews"==t)for(l=0;l<r.length;l++){a=(n=r[l]).factor;n.byteOffset=i.GLTF_decoder_1_offset(l,p,a,n.byteOffset),n.byteLength=i.GLTF_decoder_1_length(l,p,a,n.opFactor,n.byteLength),delete n.factor,delete n.opFactor}break;case 1:case 4:u=this._decoder.randomRanges;if("_accessors"==t)for(l=0;l<r.length;l++){h=r[l];(n=e.bufferViews[h.bufferView]).factor=Math.floor(n.byteLength/h.count),n.opFactor=h.byteType;p=u[d=Math.floor(l/2)%8]+(l+1)%7;h.count=i.GLTF_decoder_1_count(l,p,h.byteType,h.count),delete h.byteType}else if("_bufferViews"==t)for(l=0;l<r.length;l++){var n=r[l],o=u[d=Math.floor(l/2)%8]+(l+1)%7,a=n.factor;n.byteOffset=i.GLTF_decoder_2_offset(l,o,a,n.byteOffset),n.byteLength=i.GLTF_decoder_2_length(l,o,a,n.opFactor,n.byteLength),delete n.factor,delete n.opFactor}break;case 2:case 5:this._decoder.randomRanges3=[this._decoder.randomRanges[7],7*e.materials.length%10];for(var s=(e.buffers[0].byteLength-999).toString(),l=0;l<s.length;l++){var c=10-Math.floor(s[l]);this._decoder.randomRanges3.push(c)}this._decoder.randomRanges3.push(this._decoder.randomRanges[3]);var u=this._decoder.randomRanges3;if("_accessors"==t)for(l=0;l<r.length;l++){var h=r[l],n=e.bufferViews[h.bufferView],p=u[d=Math.floor(l/2)%u.length]+Math.floor(l+1)%7;n.factor=Math.floor(n.byteLength/h.count),n.opFactor=h.byteType,h.count=i.GLTF_decoder_1_count(l,p,h.byteType,h.count),delete h.byteType}else if("_bufferViews"==t)for(l=0;l<r.length;l++){var n=r[l],d=Math.floor(l/2)%u.length,o=u[d]+Math.floor(l+1)%7,a=n.factor;n.byteOffset=i.GLTF_decoder_3_offset(l,o,a,n.byteOffset),n.byteLength=i.GLTF_decoder_3_length(l,o,a,n.opFactor,n.byteLength),delete n.factor,delete n.opFactor}}var f=this._nameDecoder.decodeFunc;if(f&&("_buffers"==t||"_images"==t))for(var m=e.buffers.length+e.images.length,l=0;l<r.length;l++)r[l].uri=f(r[l].uri,m)},e.prototype.decodeDracoFile=function(e,t,r){},e}(),no=function(){function e(){Wn(this,e),this.url=null,this.fileLoader=new THREE.FileLoader,this.gltfLoader=new THREE.GLTFLoader}return e.prototype.load=function(e,t,r,i){this.url=e;var n=this;this.fileLoader.setResponseType("json"),this.fileLoader.load(e+"index.json",function(r){if(r&&r.gltfFiles){var o={};n.gltfLoader.setDRACOLoader(new io(null,r,o)),n.gltfLoader.setCrossOrigin("anonymous");var a=o.data.gltffiles[0];n.gltfLoader.load(e+a,function(e){t&&t(e)},function(){},function(e){i&&i(e)})}else i&&i()},function(e){},function(e){i&&i(e)})},e}();e.JSONXLoader=Yn,e.DracoXLoader=io,e.ModelLoader=no,Object.defineProperty(e,"__esModule",{value:!0})}),function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.json2mesh={})}(this,function(e){"use strict";function t(e,t){return t={exports:{}},e(t,t.exports),t.exports}function r(e,t){var i,n,o=arguments.length<3?e:arguments[2];return c(e)===o?e[t]:(i=vt.f(e,t))?_(i,"value")?i.value:void 0!==i.get?i.get.call(o):void 0:l(n=We(e))?r(n,t,o):void 0}function i(e,t,r){var n,o,a=arguments.length<4?e:arguments[3],s=vt.f(c(e),t);if(!s){if(l(o=We(e)))return i(o,t,r,a);s=E(0)}return _(s,"value")?!(!1===s.writable||!l(a))&&(n=vt.f(a,t)||E(0),n.value=r,y.f(a,t,n),!0):void 0!==s.set&&(s.set.call(a,r),!0)}function n(e){return isFinite(e=+e)&&0!=e?e<0?-n(-e):Math.log(e+Math.sqrt(e*e+1)):e}var o="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},a=t(function(e){var t=e.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=t)}),s=t(function(e){var t=e.exports={version:"2.5.3"};"number"==typeof __e&&(__e=t)}),l=function(e){return"object"==typeof e?null!==e:"function"==typeof e},c=function(e){if(!l(e))throw TypeError(e+" is not an object!");return e},u=function(e){try{return!!e()}catch(e){return!0}},h=!u(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a}),p=a.document,d=l(p)&&l(p.createElement),f=function(e){return d?p.createElement(e):{}},m=!h&&!u(function(){return 7!=Object.defineProperty(f("div"),"a",{get:function(){return 7}}).a}),g=function(e,t){if(!l(e))return e;var r,i;if(t&&"function"==typeof(r=e.toString)&&!l(i=r.call(e)))return i;if("function"==typeof(r=e.valueOf)&&!l(i=r.call(e)))return i;if(!t&&"function"==typeof(r=e.toString)&&!l(i=r.call(e)))return i;throw TypeError("Can't convert object to primitive value")},v=Object.defineProperty,y={f:h?Object.defineProperty:function(e,t,r){if(c(e),t=g(t,!0),c(r),m)try{return v(e,t,r)}catch(e){}if("get"in r||"set"in r)throw TypeError("Accessors not supported!");return"value"in r&&(e[t]=r.value),e}},E=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},b=h?function(e,t,r){return y.f(e,t,E(1,r))}:function(e,t,r){return e[t]=r,e},x={}.hasOwnProperty,_=function(e,t){return x.call(e,t)},w=0,T=Math.random(),M=function(e){return"Symbol(".concat(void 0===e?"":e,")_",(++w+T).toString(36))},R=t(function(e){var t=M("src"),r=Function.toString,i=(""+r).split("toString");s.inspectSource=function(e){return r.call(e)},(e.exports=function(e,r,n,o){var s="function"==typeof n;s&&(_(n,"name")||b(n,"name",r)),e[r]!==n&&(s&&(_(n,t)||b(n,t,e[r]?""+e[r]:i.join(String(r)))),e===a?e[r]=n:o?e[r]?e[r]=n:b(e,r,n):(delete e[r],b(e,r,n)))})(Function.prototype,"toString",function(){return"function"==typeof this&&this[t]||r.call(this)})}),S=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e},P=function(e,t,r){if(S(e),void 0===t)return e;switch(r){case 1:return function(r){return e.call(t,r)};case 2:return function(r,i){return e.call(t,r,i)};case 3:return function(r,i,n){return e.call(t,r,i,n)}}return function(){return e.apply(t,arguments)}},A=function(e,t,r){var i,n,o,l,c=e&A.F,u=e&A.G,h=e&A.S,p=e&A.P,d=e&A.B,f=u?a:h?a[t]||(a[t]={}):(a[t]||{}).prototype,m=u?s:s[t]||(s[t]={}),g=m.prototype||(m.prototype={});u&&(r=t);for(i in r)o=((n=!c&&f&&void 0!==f[i])?f:r)[i],l=d&&n?P(o,a):p&&"function"==typeof o?P(Function.call,o):o,f&&R(f,i,o,e&A.U),m[i]!=o&&b(m,i,l),p&&g[i]!=o&&(g[i]=o)};a.core=s,A.F=1,A.G=2,A.S=4,A.P=8,A.B=16,A.W=32,A.U=64,A.R=128;for(var C,L=A,O=M("typed_array"),H=M("view"),F=!(!a.ArrayBuffer||!a.DataView),I=F,k=0,D="Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array".split(",");k<9;)(C=a[D[k++]])?(b(C.prototype,O,!0),b(C.prototype,H,!0)):I=!1;var N={ABV:F,CONSTR:I,TYPED:O,VIEW:H},j=function(e,t,r){for(var i in t)R(e,i,t[i],r);return e},U=function(e,t,r,i){if(!(e instanceof t)||void 0!==i&&i in e)throw TypeError(r+": incorrect invocation!");return e},B=Math.ceil,V=Math.floor,z=function(e){return isNaN(e=+e)?0:(e>0?V:B)(e)},q=Math.min,G=function(e){return e>0?q(z(e),9007199254740991):0},W=function(e){if(void 0===e)return 0;var t=z(e),r=G(t);if(t!==r)throw RangeError("Wrong length!");return r},X={}.toString,Y=function(e){return X.call(e).slice(8,-1)},Q=Object("z").propertyIsEnumerable(0)?Object:function(e){return"String"==Y(e)?e.split(""):Object(e)},J=function(e){if(void 0==e)throw TypeError("Can't call method on  "+e);return e},K=function(e){return Q(J(e))},Z=Math.max,$=Math.min,ee=function(e,t){return(e=z(e))<0?Z(e+t,0):$(e,t)},te=function(e){return function(t,r,i){var n,o=K(t),a=G(o.length),s=ee(i,a);if(e&&r!=r){for(;a>s;)if((n=o[s++])!=n)return!0}else for(;a>s;s++)if((e||s in o)&&o[s]===r)return e||s||0;return!e&&-1}},re=a["__core-js_shared__"]||(a["__core-js_shared__"]={}),ie=function(e){return re[e]||(re[e]={})},ne=ie("keys"),oe=function(e){return ne[e]||(ne[e]=M(e))},ae=te(!1),se=oe("IE_PROTO"),le=function(e,t){var r,i=K(e),n=0,o=[];for(r in i)r!=se&&_(i,r)&&o.push(r);for(;t.length>n;)_(i,r=t[n++])&&(~ae(o,r)||o.push(r));return o},ce="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(","),ue=ce.concat("length","prototype"),he={f:Object.getOwnPropertyNames||function(e){return le(e,ue)}},pe=function(e){return Object(J(e))},de=function(e){for(var t=pe(this),r=G(t.length),i=arguments.length,n=ee(i>1?arguments[1]:void 0,r),o=i>2?arguments[2]:void 0,a=void 0===o?r:ee(o,r);a>n;)t[n++]=e;return t},fe=t(function(e){var t=ie("wks"),r=a.Symbol,i="function"==typeof r;(e.exports=function(e){return t[e]||(t[e]=i&&r[e]||(i?r:M)("Symbol."+e))}).store=t}),me=y.f,ge=fe("toStringTag"),ve=function(e,t,r){e&&!_(e=r?e:e.prototype,ge)&&me(e,ge,{configurable:!0,value:t})},ye=t(function(e,t){function r(e,t,r){var i,n,o,a=new Array(r),s=8*r-t-1,l=(1<<s)-1,c=l>>1,u=23===t?A(2,-24)-A(2,-77):0,h=0,p=e<0||0===e&&1/e<0?1:0;for((e=P(e))!=e||e===R?(n=e!=e?1:0,i=l):(i=C(L(e)/O),e*(o=A(2,-i))<1&&(i--,o*=2),(e+=i+c>=1?u/o:u*A(2,1-c))*o>=2&&(i++,o/=2),i+c>=l?(n=0,i=l):i+c>=1?(n=(e*o-1)*A(2,t),i+=c):(n=e*A(2,c-1)*A(2,t),i=0));t>=8;a[h++]=255&n,n/=256,t-=8);for(i=i<<t|n,s+=t;s>0;a[h++]=255&i,i/=256,s-=8);return a[--h]|=128*p,a}function i(e,t,r){var i,n=8*r-t-1,o=(1<<n)-1,a=o>>1,s=n-7,l=r-1,c=e[l--],u=127&c;for(c>>=7;s>0;u=256*u+e[l],l--,s-=8);for(i=u&(1<<-s)-1,u>>=-s,s+=t;s>0;i=256*i+e[l],l--,s-=8);if(0===u)u=1-a;else{if(u===o)return i?NaN:c?-R:R;i+=A(2,t),u-=a}return(c?-1:1)*i*A(2,u-t)}function n(e){return e[3]<<24|e[2]<<16|e[1]<<8|e[0]}function o(e){return[255&e]}function s(e){return[255&e,e>>8&255]}function l(e){return[255&e,e>>8&255,e>>16&255,e>>24&255]}function c(e){return r(e,52,8)}function p(e){return r(e,23,4)}function d(e,t,r){v(e[E],t,{get:function(){return this[r]}})}function f(e,t,r,i){var n=W(+r);if(n+t>e[F])throw M(x);var o=e[H]._b,a=n+e[I],s=o.slice(a,a+t);return i?s:s.reverse()}function m(e,t,r,i,n,o){var a=W(+r);if(a+t>e[F])throw M(x);for(var s=e[H]._b,l=a+e[I],c=i(+n),u=0;u<t;u++)s[l+u]=c[o?u:t-u-1]}var g=he.f,v=y.f,E="prototype",x="Wrong index!",_=a.ArrayBuffer,w=a.DataView,T=a.Math,M=a.RangeError,R=a.Infinity,S=_,P=T.abs,A=T.pow,C=T.floor,L=T.log,O=T.LN2,H=h?"_b":"buffer",F=h?"_l":"byteLength",I=h?"_o":"byteOffset";if(N.ABV){if(!u(function(){_(1)})||!u(function(){new _(-1)})||u(function(){return new _,new _(1.5),new _(NaN),"ArrayBuffer"!=_.name})){for(var k,D=(_=function(e){return U(this,_),new S(W(e))})[E]=S[E],B=g(S),V=0;B.length>V;)(k=B[V++])in _||b(_,k,S[k]);D.constructor=_}var q=new w(new _(2)),X=w[E].setInt8;q.setInt8(0,2147483648),q.setInt8(1,2147483649),!q.getInt8(0)&&q.getInt8(1)||j(w[E],{setInt8:function(e,t){X.call(this,e,t<<24>>24)},setUint8:function(e,t){X.call(this,e,t<<24>>24)}},!0)}else _=function(e){U(this,_,"ArrayBuffer");var t=W(e);this._b=de.call(new Array(t),0),this[F]=t},w=function(e,t,r){U(this,w,"DataView"),U(e,_,"DataView");var i=e[F],n=z(t);if(n<0||n>i)throw M("Wrong offset!");if(r=void 0===r?i-n:G(r),n+r>i)throw M("Wrong length!");this[H]=e,this[I]=n,this[F]=r},h&&(d(_,"byteLength","_l"),d(w,"buffer","_b"),d(w,"byteLength","_l"),d(w,"byteOffset","_o")),j(w[E],{getInt8:function(e){return f(this,1,e)[0]<<24>>24},getUint8:function(e){return f(this,1,e)[0]},getInt16:function(e){var t=f(this,2,e,arguments[1]);return(t[1]<<8|t[0])<<16>>16},getUint16:function(e){var t=f(this,2,e,arguments[1]);return t[1]<<8|t[0]},getInt32:function(e){return n(f(this,4,e,arguments[1]))},getUint32:function(e){return n(f(this,4,e,arguments[1]))>>>0},getFloat32:function(e){return i(f(this,4,e,arguments[1]),23,4)},getFloat64:function(e){return i(f(this,8,e,arguments[1]),52,8)},setInt8:function(e,t){m(this,1,e,o,t)},setUint8:function(e,t){m(this,1,e,o,t)},setInt16:function(e,t){m(this,2,e,s,t,arguments[2])},setUint16:function(e,t){m(this,2,e,s,t,arguments[2])},setInt32:function(e,t){m(this,4,e,l,t,arguments[2])},setUint32:function(e,t){m(this,4,e,l,t,arguments[2])},setFloat32:function(e,t){m(this,4,e,p,t,arguments[2])},setFloat64:function(e,t){m(this,8,e,c,t,arguments[2])}});ve(_,"ArrayBuffer"),ve(w,"DataView"),b(w[E],N.VIEW,!0),t.ArrayBuffer=_,t.DataView=w}),Ee=fe("species"),be=function(e,t){var r,i=c(e).constructor;return void 0===i||void 0==(r=c(i)[Ee])?t:S(r)},xe=fe("species"),_e=function(e){var t=a[e];h&&t&&!t[xe]&&y.f(t,xe,{configurable:!0,get:function(){return this}})},we=a.ArrayBuffer,Te=ye.ArrayBuffer,Me=ye.DataView,Re=N.ABV&&we.isView,Se=Te.prototype.slice,Pe=N.VIEW;L(L.G+L.W+L.F*(we!==Te),{ArrayBuffer:Te}),L(L.S+L.F*!N.CONSTR,"ArrayBuffer",{isView:function(e){return Re&&Re(e)||l(e)&&Pe in e}}),L(L.P+L.U+L.F*u(function(){return!new Te(2).slice(1,void 0).byteLength}),"ArrayBuffer",{slice:function(e,t){if(void 0!==Se&&void 0===t)return Se.call(c(this),e);for(var r=c(this).byteLength,i=ee(e,r),n=ee(void 0===t?r:t,r),o=new(be(this,Te))(G(n-i)),a=new Me(this),s=new Me(o),l=0;i<n;)s.setUint8(l++,a.getUint8(i++));return o}}),_e("ArrayBuffer");var Ae=fe("toStringTag"),Ce="Arguments"==Y(function(){return arguments}()),Le=function(e){var t,r,i;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(r=function(e,t){try{return e[t]}catch(e){}}(t=Object(e),Ae))?r:Ce?Y(t):"Object"==(i=Y(t))&&"function"==typeof t.callee?"Arguments":i},Oe={},He=fe("iterator"),Fe=Array.prototype,Ie=function(e){return void 0!==e&&(Oe.Array===e||Fe[He]===e)},ke=Object.keys||function(e){return le(e,ce)},De=h?Object.defineProperties:function(e,t){c(e);for(var r,i=ke(t),n=i.length,o=0;n>o;)y.f(e,r=i[o++],t[r]);return e},Ne=a.document,je=Ne&&Ne.documentElement,Ue=oe("IE_PROTO"),Be=function(){},Ve=function(){var e,t=f("iframe"),r=ce.length;for(t.style.display="none",je.appendChild(t),t.src="javascript:",(e=t.contentWindow.document).open(),e.write("<script>document.F=Object<\/script>"),e.close(),Ve=e.F;r--;)delete Ve.prototype[ce[r]];return Ve()},ze=Object.create||function(e,t){var r;return null!==e?(Be.prototype=c(e),r=new Be,Be.prototype=null,r[Ue]=e):r=Ve(),void 0===t?r:De(r,t)},qe=oe("IE_PROTO"),Ge=Object.prototype,We=Object.getPrototypeOf||function(e){return e=pe(e),_(e,qe)?e[qe]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?Ge:null},Xe=fe("iterator"),Ye=s.getIteratorMethod=function(e){if(void 0!=e)return e[Xe]||e["@@iterator"]||Oe[Le(e)]},Qe=Array.isArray||function(e){return"Array"==Y(e)},Je=fe("species"),Ke=function(e,t){return new(function(e){var t;return Qe(e)&&("function"!=typeof(t=e.constructor)||t!==Array&&!Qe(t.prototype)||(t=void 0),l(t)&&null===(t=t[Je])&&(t=void 0)),void 0===t?Array:t}(e))(t)},Ze=function(e,t){var r=1==e,i=2==e,n=3==e,o=4==e,a=6==e,s=5==e||a,l=t||Ke;return function(t,c,u){for(var h,p,d=pe(t),f=Q(d),m=P(c,u,3),g=G(f.length),v=0,y=r?l(t,g):i?l(t,0):void 0;g>v;v++)if((s||v in f)&&(h=f[v],p=m(h,v,d),e))if(r)y[v]=p;else if(p)switch(e){case 3:return!0;case 5:return h;case 6:return v;case 2:y.push(h)}else if(o)return!1;return a?-1:n||o?o:y}},$e=fe("unscopables"),et=Array.prototype;void 0==et[$e]&&b(et,$e,{});var tt=function(e){et[$e][e]=!0},rt=function(e,t){return{value:t,done:!!e}},it={};b(it,fe("iterator"),function(){return this});var nt=function(e,t,r){e.prototype=ze(it,{next:E(1,r)}),ve(e,t+" Iterator")},ot=fe("iterator"),at=!([].keys&&"next"in[].keys()),st=function(){return this},lt=function(e,t,r,i,n,o,a){nt(r,t,i);var s,l,c,u=function(e){if(!at&&e in f)return f[e];switch(e){case"keys":case"values":return function(){return new r(this,e)}}return function(){return new r(this,e)}},h=t+" Iterator",p="values"==n,d=!1,f=e.prototype,m=f[ot]||f["@@iterator"]||n&&f[n],g=!at&&m||u(n),v=n?p?u("entries"):g:void 0,y="Array"==t?f.entries||m:m;if(y&&(c=We(y.call(new e)))!==Object.prototype&&c.next&&(ve(c,h,!0),_(c,ot)||b(c,ot,st)),p&&m&&"values"!==m.name&&(d=!0,g=function(){return m.call(this)}),(at||d||!f[ot])&&b(f,ot,g),Oe[t]=g,Oe[h]=st,n)if(s={values:p?g:u("values"),keys:o?g:u("keys"),entries:v},a)for(l in s)l in f||R(f,l,s[l]);else L(L.P+L.F*(at||d),t,s);return s},ct=lt(Array,"Array",function(e,t){this._t=K(e),this._i=0,this._k=t},function(){var e=this._t,t=this._k,r=this._i++;return!e||r>=e.length?(this._t=void 0,rt(1)):"keys"==t?rt(0,r):"values"==t?rt(0,e[r]):rt(0,[r,e[r]])},"values");Oe.Arguments=Oe.Array,tt("keys"),tt("values"),tt("entries");var ut=fe("iterator"),ht=!1;try{var pt=[7][ut]();pt.return=function(){ht=!0},Array.from(pt,function(){throw 2})}catch(e){}var dt=function(e,t){if(!t&&!ht)return!1;var r=!1;try{var i=[7],n=i[ut]();n.next=function(){return{done:r=!0}},i[ut]=function(){return n},e(i)}catch(e){}return r},ft=[].copyWithin||function(e,t){var r=pe(this),i=G(r.length),n=ee(e,i),o=ee(t,i),a=arguments.length>2?arguments[2]:void 0,s=Math.min((void 0===a?i:ee(a,i))-o,i-n),l=1;for(o<n&&n<o+s&&(l=-1,o+=s-1,n+=s-1);s-- >0;)o in r?r[n]=r[o]:delete r[n],n+=l,o+=l;return r},mt={f:{}.propertyIsEnumerable},gt=Object.getOwnPropertyDescriptor,vt={f:h?gt:function(e,t){if(e=K(e),t=g(t,!0),m)try{return gt(e,t)}catch(e){}if(_(e,t))return E(!mt.f.call(e,t),e[t])}},yt=t(function(e){if(h){var t=a,r=u,i=L,n=N,o=ye,s=P,c=U,p=E,d=b,f=j,m=z,v=G,x=W,w=ee,T=g,R=_,S=Le,A=l,C=pe,O=Ie,H=ze,F=We,I=he.f,k=Ye,D=M,B=fe,V=Ze,q=te,X=be,Y=ct,Q=Oe,J=dt,K=_e,Z=de,$=ft,re=y,ie=vt,ne=re.f,oe=ie.f,ae=t.RangeError,se=t.TypeError,le=t.Uint8Array,ce=Array.prototype,ue=o.ArrayBuffer,me=o.DataView,ge=V(0),ve=V(2),Ee=V(3),xe=V(4),we=V(5),Te=V(6),Me=q(!0),Re=q(!1),Se=Y.values,Pe=Y.keys,Ae=Y.entries,Ce=ce.lastIndexOf,He=ce.reduce,Fe=ce.reduceRight,ke=ce.join,De=ce.sort,Ne=ce.slice,je=ce.toString,Ue=ce.toLocaleString,Be=B("iterator"),Ve=B("toStringTag"),qe=D("typed_constructor"),Ge=D("def_constructor"),Xe=n.CONSTR,Qe=n.TYPED,Je=n.VIEW,Ke=V(1,function(e,t){return it(X(e,e[Ge]),t)}),$e=r(function(){return 1===new le(new Uint16Array([1]).buffer)[0]}),et=!!le&&!!le.prototype.set&&r(function(){new le(1).set({})}),tt=function(e,t){var r=m(e);if(r<0||r%t)throw ae("Wrong offset!");return r},rt=function(e){if(A(e)&&Qe in e)return e;throw se(e+" is not a typed array!")},it=function(e,t){if(!(A(e)&&qe in e))throw se("It is not a typed array constructor!");return new e(t)},nt=function(e,t){return ot(X(e,e[Ge]),t)},ot=function(e,t){for(var r=0,i=t.length,n=it(e,i);i>r;)n[r]=t[r++];return n},at=function(e,t,r){ne(e,t,{get:function(){return this._d[r]}})},st=function(e){var t,r,i,n,o,a,l=C(e),c=arguments.length,u=c>1?arguments[1]:void 0,h=void 0!==u,p=k(l);if(void 0!=p&&!O(p)){for(a=p.call(l),i=[],t=0;!(o=a.next()).done;t++)i.push(o.value);l=i}for(h&&c>2&&(u=s(u,arguments[2],2)),t=0,r=v(l.length),n=it(this,r);r>t;t++)n[t]=h?u(l[t],t):l[t];return n},lt=function(){for(var e=0,t=arguments.length,r=it(this,t);t>e;)r[e]=arguments[e++];return r},ut=!!le&&r(function(){Ue.call(new le(1))}),ht=function(){return Ue.apply(ut?Ne.call(rt(this)):rt(this),arguments)},pt={copyWithin:function(e,t){return $.call(rt(this),e,t,arguments.length>2?arguments[2]:void 0)},every:function(e){return xe(rt(this),e,arguments.length>1?arguments[1]:void 0)},fill:function(e){return Z.apply(rt(this),arguments)},filter:function(e){return nt(this,ve(rt(this),e,arguments.length>1?arguments[1]:void 0))},find:function(e){return we(rt(this),e,arguments.length>1?arguments[1]:void 0)},findIndex:function(e){return Te(rt(this),e,arguments.length>1?arguments[1]:void 0)},forEach:function(e){ge(rt(this),e,arguments.length>1?arguments[1]:void 0)},indexOf:function(e){return Re(rt(this),e,arguments.length>1?arguments[1]:void 0)},includes:function(e){return Me(rt(this),e,arguments.length>1?arguments[1]:void 0)},join:function(e){return ke.apply(rt(this),arguments)},lastIndexOf:function(e){return Ce.apply(rt(this),arguments)},map:function(e){return Ke(rt(this),e,arguments.length>1?arguments[1]:void 0)},reduce:function(e){return He.apply(rt(this),arguments)},reduceRight:function(e){return Fe.apply(rt(this),arguments)},reverse:function(){for(var e,t=rt(this).length,r=Math.floor(t/2),i=0;i<r;)e=this[i],this[i++]=this[--t],this[t]=e;return this},some:function(e){return Ee(rt(this),e,arguments.length>1?arguments[1]:void 0)},sort:function(e){return De.call(rt(this),e)},subarray:function(e,t){var r=rt(this),i=r.length,n=w(e,i);return new(X(r,r[Ge]))(r.buffer,r.byteOffset+n*r.BYTES_PER_ELEMENT,v((void 0===t?i:w(t,i))-n))}},mt=function(e,t){return nt(this,Ne.call(rt(this),e,t))},gt=function(e){rt(this);var t=tt(arguments[1],1),r=this.length,i=C(e),n=v(i.length),o=0;if(n+t>r)throw ae("Wrong length!");for(;o<n;)this[t+o]=i[o++]},yt={entries:function(){return Ae.call(rt(this))},keys:function(){return Pe.call(rt(this))},values:function(){return Se.call(rt(this))}},Et=function(e,t){return A(e)&&e[Qe]&&"symbol"!=typeof t&&t in e&&String(+t)==String(t)},bt=function(e,t){return Et(e,t=T(t,!0))?p(2,e[t]):oe(e,t)},xt=function(e,t,r){return!(Et(e,t=T(t,!0))&&A(r)&&R(r,"value"))||R(r,"get")||R(r,"set")||r.configurable||R(r,"writable")&&!r.writable||R(r,"enumerable")&&!r.enumerable?ne(e,t,r):(e[t]=r.value,e)};Xe||(ie.f=bt,re.f=xt),i(i.S+i.F*!Xe,"Object",{getOwnPropertyDescriptor:bt,defineProperty:xt}),r(function(){je.call({})})&&(je=Ue=function(){return ke.call(this)});var _t=f({},pt);f(_t,yt),d(_t,Be,yt.values),f(_t,{slice:mt,set:gt,constructor:function(){},toString:je,toLocaleString:ht}),at(_t,"buffer","b"),at(_t,"byteOffset","o"),at(_t,"byteLength","l"),at(_t,"length","e"),ne(_t,Ve,{get:function(){return this[Qe]}}),e.exports=function(e,o,a,s){var l=e+((s=!!s)?"Clamped":"")+"Array",u="get"+e,h="set"+e,p=t[l],f=p||{},m=p&&F(p),g=!p||!n.ABV,y={},E=p&&p.prototype,b=function(e,t){ne(e,t,{get:function(){return function(e,t){var r=e._d;return r.v[u](t*o+r.o,$e)}(this,t)},set:function(e){return function(e,t,r){var i=e._d;s&&(r=(r=Math.round(r))<0?0:r>255?255:255&r),i.v[h](t*o+i.o,r,$e)}(this,t,e)},enumerable:!0})};g?(p=a(function(e,t,r,i){c(e,p,l,"_d");var n,a,s,u,h=0,f=0;if(A(t)){if(!(t instanceof ue||"ArrayBuffer"==(u=S(t))||"SharedArrayBuffer"==u))return Qe in t?ot(p,t):st.call(p,t);n=t,f=tt(r,o);var m=t.byteLength;if(void 0===i){if(m%o)throw ae("Wrong length!");if((a=m-f)<0)throw ae("Wrong length!")}else if((a=v(i)*o)+f>m)throw ae("Wrong length!");s=a/o}else s=x(t),n=new ue(a=s*o);for(d(e,"_d",{b:n,o:f,l:a,e:s,v:new me(n)});h<s;)b(e,h++)}),E=p.prototype=H(_t),d(E,"constructor",p)):r(function(){p(1)})&&r(function(){new p(-1)})&&J(function(e){new p,new p(null),new p(1.5),new p(e)},!0)||(p=a(function(e,t,r,i){c(e,p,l);var n;return A(t)?t instanceof ue||"ArrayBuffer"==(n=S(t))||"SharedArrayBuffer"==n?void 0!==i?new f(t,tt(r,o),i):void 0!==r?new f(t,tt(r,o)):new f(t):Qe in t?ot(p,t):st.call(p,t):new f(x(t))}),ge(m!==Function.prototype?I(f).concat(I(m)):I(f),function(e){e in p||d(p,e,f[e])}),p.prototype=E,E.constructor=p);var _=E[Be],w=!!_&&("values"==_.name||void 0==_.name),T=yt.values;d(p,qe,!0),d(E,Qe,l),d(E,Je,!0),d(E,Ge,p),(s?new p(1)[Ve]==l:Ve in E)||ne(E,Ve,{get:function(){return l}}),y[l]=p,i(i.G+i.W+i.F*(p!=f),y),i(i.S,l,{BYTES_PER_ELEMENT:o}),i(i.S+i.F*r(function(){f.of.call(p,1)}),l,{from:st,of:lt}),"BYTES_PER_ELEMENT"in E||d(E,"BYTES_PER_ELEMENT",o),i(i.P,l,pt),K(l),i(i.P+i.F*et,l,{set:gt}),i(i.P+i.F*!w,l,yt),E.toString!=je&&(E.toString=je),i(i.P+i.F*r(function(){new p(1).slice()}),l,{slice:mt}),i(i.P+i.F*(r(function(){return[1,2].toLocaleString()!=new p([1,2]).toLocaleString()})||!r(function(){E.toLocaleString.call([1,2])})),l,{toLocaleString:ht}),Q[l]=w?_:T,w||d(E,Be,T)}}else e.exports=function(){}});yt("Int8",1,function(e){return function(t,r,i){return e(this,t,r,i)}}),yt("Uint8",1,function(e){return function(t,r,i){return e(this,t,r,i)}}),yt("Uint8",1,function(e){return function(t,r,i){return e(this,t,r,i)}},!0),yt("Int16",2,function(e){return function(t,r,i){return e(this,t,r,i)}}),yt("Uint16",2,function(e){return function(t,r,i){return e(this,t,r,i)}}),yt("Int32",4,function(e){return function(t,r,i){return e(this,t,r,i)}}),yt("Uint32",4,function(e){return function(t,r,i){return e(this,t,r,i)}}),yt("Float32",4,function(e){return function(t,r,i){return e(this,t,r,i)}}),yt("Float64",8,function(e){return function(t,r,i){return e(this,t,r,i)}});var Et=function(e,t,r,i){try{return i?t(c(r)[0],r[1]):t(r)}catch(t){var n=e.return;throw void 0!==n&&c(n.call(e)),t}},bt=t(function(e){var t={},r={},i=e.exports=function(e,i,n,o,a){var s,l,u,h,p=a?function(){return e}:Ye(e),d=P(n,o,i?2:1),f=0;if("function"!=typeof p)throw TypeError(e+" is not iterable!");if(Ie(p)){for(s=G(e.length);s>f;f++)if((h=i?d(c(l=e[f])[0],l[1]):d(e[f]))===t||h===r)return h}else for(u=p.call(e);!(l=u.next()).done;)if((h=Et(u,d,l.value,i))===t||h===r)return h};i.BREAK=t,i.RETURN=r}),xt=t(function(e){var t=M("meta"),r=y.f,i=0,n=Object.isExtensible||function(){return!0},o=!u(function(){return n(Object.preventExtensions({}))}),a=function(e){r(e,t,{value:{i:"O"+ ++i,w:{}}})},s=e.exports={KEY:t,NEED:!1,fastKey:function(e,r){if(!l(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!_(e,t)){if(!n(e))return"F";if(!r)return"E";a(e)}return e[t].i},getWeak:function(e,r){if(!_(e,t)){if(!n(e))return!0;if(!r)return!1;a(e)}return e[t].w},onFreeze:function(e){return o&&s.NEED&&n(e)&&!_(e,t)&&a(e),e}}}),_t=function(e,t){if(!l(e)||e._t!==t)throw TypeError("Incompatible receiver, "+t+" required!");return e},wt=y.f,Tt=xt.fastKey,Mt=h?"_s":"size",Rt=function(e,t){var r,i=Tt(t);if("F"!==i)return e._i[i];for(r=e._f;r;r=r.n)if(r.k==t)return r},St={getConstructor:function(e,t,r,i){var n=e(function(e,o){U(e,n,t,"_i"),e._t=t,e._i=ze(null),e._f=void 0,e._l=void 0,e[Mt]=0,void 0!=o&&bt(o,r,e[i],e)});return j(n.prototype,{clear:function(){for(var e=_t(this,t),r=e._i,i=e._f;i;i=i.n)i.r=!0,i.p&&(i.p=i.p.n=void 0),delete r[i.i];e._f=e._l=void 0,e[Mt]=0},delete:function(e){var r=_t(this,t),i=Rt(r,e);if(i){var n=i.n,o=i.p;delete r._i[i.i],i.r=!0,o&&(o.n=n),n&&(n.p=o),r._f==i&&(r._f=n),r._l==i&&(r._l=o),r[Mt]--}return!!i},forEach:function(e){_t(this,t);for(var r,i=P(e,arguments.length>1?arguments[1]:void 0,3);r=r?r.n:this._f;)for(i(r.v,r.k,this);r&&r.r;)r=r.p},has:function(e){return!!Rt(_t(this,t),e)}}),h&&wt(n.prototype,"size",{get:function(){return _t(this,t)[Mt]}}),n},def:function(e,t,r){var i,n,o=Rt(e,t);return o?o.v=r:(e._l=o={i:n=Tt(t,!0),k:t,v:r,p:i=e._l,n:void 0,r:!1},e._f||(e._f=o),i&&(i.n=o),e[Mt]++,"F"!==n&&(e._i[n]=o)),e},getEntry:Rt,setStrong:function(e,t,r){lt(e,t,function(e,r){this._t=_t(e,t),this._k=r,this._l=void 0},function(){for(var e=this._k,t=this._l;t&&t.r;)t=t.p;return this._t&&(this._l=t=t?t.n:this._t._f)?"keys"==e?rt(0,t.k):"values"==e?rt(0,t.v):rt(0,[t.k,t.v]):(this._t=void 0,rt(1))},r?"entries":"values",!r,!0),_e(t)}},Pt=function(e,t){if(c(e),!l(t)&&null!==t)throw TypeError(t+": can't set as prototype!")},At={set:Object.setPrototypeOf||("__proto__"in{}?function(e,t,r){try{(r=P(Function.call,vt.f(Object.prototype,"__proto__").set,2))(e,[]),t=!(e instanceof Array)}catch(e){t=!0}return function(e,i){return Pt(e,i),t?e.__proto__=i:r(e,i),e}}({},!1):void 0),check:Pt},Ct=At.set,Lt=function(e,t,r,i,n,o){var s=a[e],c=s,h=n?"set":"add",p=c&&c.prototype,d={},f=function(e){var t=p[e];R(p,e,"delete"==e?function(e){return!(o&&!l(e))&&t.call(this,0===e?0:e)}:"has"==e?function(e){return!(o&&!l(e))&&t.call(this,0===e?0:e)}:"get"==e?function(e){return o&&!l(e)?void 0:t.call(this,0===e?0:e)}:"add"==e?function(e){return t.call(this,0===e?0:e),this}:function(e,r){return t.call(this,0===e?0:e,r),this})};if("function"==typeof c&&(o||p.forEach&&!u(function(){(new c).entries().next()}))){var m=new c,g=m[h](o?{}:-0,1)!=m,v=u(function(){m.has(1)}),y=dt(function(e){new c(e)}),E=!o&&u(function(){for(var e=new c,t=5;t--;)e[h](t,t);return!e.has(-0)});y||((c=t(function(t,r){U(t,c,e);var i=function(e,t,r){var i,n=t.constructor;return n!==r&&"function"==typeof n&&(i=n.prototype)!==r.prototype&&l(i)&&Ct&&Ct(e,i),e}(new s,t,c);return void 0!=r&&bt(r,n,i[h],i),i})).prototype=p,p.constructor=c),(v||E)&&(f("delete"),f("has"),n&&f("get")),(E||g)&&f(h),o&&p.clear&&delete p.clear}else c=i.getConstructor(t,e,n,h),j(c.prototype,r),xt.NEED=!0;return ve(c,e),d[e]=c,L(L.G+L.W+L.F*(c!=s),d),o||i.setStrong(c,e,n),c},Ot=(Lt("Map",function(e){return function(){return e(this,arguments.length>0?arguments[0]:void 0)}},{get:function(e){var t=St.getEntry(_t(this,"Map"),e);return t&&t.v},set:function(e,t){return St.def(_t(this,"Map"),0===e?0:e,t)}},St,!0),Lt("Set",function(e){return function(){return e(this,arguments.length>0?arguments[0]:void 0)}},{add:function(e){return St.def(_t(this,"Set"),e=0===e?0:e,e)}},St),{f:Object.getOwnPropertySymbols}),Ht=Object.assign,Ft=!Ht||u(function(){var e={},t={},r=Symbol(),i="abcdefghijklmnopqrst";return e[r]=7,i.split("").forEach(function(e){t[e]=e}),7!=Ht({},e)[r]||Object.keys(Ht({},t)).join("")!=i})?function(e,t){for(var r=pe(e),i=arguments.length,n=1,o=Ot.f,a=mt.f;i>n;)for(var s,l=Q(arguments[n++]),c=o?ke(l).concat(o(l)):ke(l),u=c.length,h=0;u>h;)a.call(l,s=c[h++])&&(r[s]=l[s]);return r}:Ht,It=xt.getWeak,kt=Ze(5),Dt=Ze(6),Nt=0,jt=function(e){return e._l||(e._l=new Ut)},Ut=function(){this.a=[]},Bt=function(e,t){return kt(e.a,function(e){return e[0]===t})};Ut.prototype={get:function(e){var t=Bt(this,e);if(t)return t[1]},has:function(e){return!!Bt(this,e)},set:function(e,t){var r=Bt(this,e);r?r[1]=t:this.a.push([e,t])},delete:function(e){var t=Dt(this.a,function(t){return t[0]===e});return~t&&this.a.splice(t,1),!!~t}};var Vt={getConstructor:function(e,t,r,i){var n=e(function(e,o){U(e,n,t,"_i"),e._t=t,e._i=Nt++,e._l=void 0,void 0!=o&&bt(o,r,e[i],e)});return j(n.prototype,{delete:function(e){if(!l(e))return!1;var r=It(e);return!0===r?jt(_t(this,t)).delete(e):r&&_(r,this._i)&&delete r[this._i]},has:function(e){if(!l(e))return!1;var r=It(e);return!0===r?jt(_t(this,t)).has(e):r&&_(r,this._i)}}),n},def:function(e,t,r){var i=It(c(t),!0);return!0===i?jt(e).set(t,r):i[e._i]=r,e},ufstore:jt};t(function(e){var t,r=Ze(0),i=xt.getWeak,n=Object.isExtensible,o=Vt.ufstore,a={},s=function(e){return function(){return e(this,arguments.length>0?arguments[0]:void 0)}},c={get:function(e){if(l(e)){var t=i(e);return!0===t?o(_t(this,"WeakMap")).get(e):t?t[this._i]:void 0}},set:function(e,t){return Vt.def(_t(this,"WeakMap"),e,t)}},h=e.exports=Lt("WeakMap",s,c,Vt,!0,!0);u(function(){return 7!=(new h).set((Object.freeze||Object)(a),7).get(a)})&&(t=Vt.getConstructor(s,"WeakMap"),Ft(t.prototype,c),xt.NEED=!0,r(["delete","has","get","set"],function(e){var r=h.prototype,i=r[e];R(r,e,function(r,o){if(l(r)&&!n(r)){this._f||(this._f=new t);var a=this._f[e](r,o);return"set"==e?this:a}return i.call(this,r,o)})}))});Lt("WeakSet",function(e){return function(){return e(this,arguments.length>0?arguments[0]:void 0)}},{add:function(e){return Vt.def(_t(this,"WeakSet"),e,!0)}},Vt,!1,!0);var zt=(a.Reflect||{}).apply,qt=Function.apply;L(L.S+L.F*!u(function(){zt(function(){})}),"Reflect",{apply:function(e,t,r){var i=S(e),n=c(r);return zt?zt(i,t,n):qt.call(i,t,n)}});var Gt=function(e,t,r){var i=void 0===r;switch(t.length){case 0:return i?e():e.call(r);case 1:return i?e(t[0]):e.call(r,t[0]);case 2:return i?e(t[0],t[1]):e.call(r,t[0],t[1]);case 3:return i?e(t[0],t[1],t[2]):e.call(r,t[0],t[1],t[2]);case 4:return i?e(t[0],t[1],t[2],t[3]):e.call(r,t[0],t[1],t[2],t[3])}return e.apply(r,t)},Wt=[].slice,Xt={},Yt=Function.bind||function(e){var t=S(this),r=Wt.call(arguments,1),i=function(){var n=r.concat(Wt.call(arguments));return this instanceof i?function(e,t,r){if(!(t in Xt)){for(var i=[],n=0;n<t;n++)i[n]="a["+n+"]";Xt[t]=Function("F,a","return new F("+i.join(",")+")")}return Xt[t](e,r)}(t,n.length,n):Gt(t,n,e)};return l(t.prototype)&&(i.prototype=t.prototype),i},Qt=(a.Reflect||{}).construct,Jt=u(function(){function e(){}return!(Qt(function(){},[],e)instanceof e)}),Kt=!u(function(){Qt(function(){})});L(L.S+L.F*(Jt||Kt),"Reflect",{construct:function(e,t){S(e),c(t);var r=arguments.length<3?e:S(arguments[2]);if(Kt&&!Jt)return Qt(e,t,r);if(e==r){switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3])}var i=[null];return i.push.apply(i,t),new(Yt.apply(e,i))}var n=r.prototype,o=ze(l(n)?n:Object.prototype),a=Function.apply.call(e,o,t);return l(a)?a:o}}),L(L.S+L.F*u(function(){Reflect.defineProperty(y.f({},1,{value:1}),1,{value:2})}),"Reflect",{defineProperty:function(e,t,r){c(e),t=g(t,!0),c(r);try{return y.f(e,t,r),!0}catch(e){return!1}}});var Zt=vt.f;L(L.S,"Reflect",{deleteProperty:function(e,t){var r=Zt(c(e),t);return!(r&&!r.configurable)&&delete e[t]}}),L(L.S,"Reflect",{get:r}),L(L.S,"Reflect",{getOwnPropertyDescriptor:function(e,t){return vt.f(c(e),t)}}),L(L.S,"Reflect",{getPrototypeOf:function(e){return We(c(e))}}),L(L.S,"Reflect",{has:function(e,t){return t in e}});var $t=Object.isExtensible;L(L.S,"Reflect",{isExtensible:function(e){return c(e),!$t||$t(e)}});var er=a.Reflect,tr=er&&er.ownKeys||function(e){var t=he.f(c(e)),r=Ot.f;return r?t.concat(r(e)):t};L(L.S,"Reflect",{ownKeys:tr});var rr=Object.preventExtensions;L(L.S,"Reflect",{preventExtensions:function(e){c(e);try{return rr&&rr(e),!0}catch(e){return!1}}}),L(L.S,"Reflect",{set:i}),At&&L(L.S,"Reflect",{setPrototypeOf:function(e,t){At.check(e,t);try{return At.set(e,t),!0}catch(e){return!1}}});var ir,nr,or,ar=a.process,sr=a.setImmediate,lr=a.clearImmediate,cr=a.MessageChannel,ur=a.Dispatch,hr=0,pr={},dr=function(){var e=+this;if(pr.hasOwnProperty(e)){var t=pr[e];delete pr[e],t()}},fr=function(e){dr.call(e.data)};sr&&lr||(sr=function(e){for(var t=[],r=1;arguments.length>r;)t.push(arguments[r++]);return pr[++hr]=function(){Gt("function"==typeof e?e:Function(e),t)},ir(hr),hr},lr=function(e){delete pr[e]},"process"==Y(ar)?ir=function(e){ar.nextTick(P(dr,e,1))}:ur&&ur.now?ir=function(e){ur.now(P(dr,e,1))}:cr?(or=(nr=new cr).port2,nr.port1.onmessage=fr,ir=P(or.postMessage,or,1)):a.addEventListener&&"function"==typeof postMessage&&!a.importScripts?(ir=function(e){a.postMessage(e+"","*")},a.addEventListener("message",fr,!1)):ir="onreadystatechange"in f("script")?function(e){je.appendChild(f("script")).onreadystatechange=function(){je.removeChild(this),dr.call(e)}}:function(e){setTimeout(P(dr,e,1),0)});var mr,gr,vr,yr,Er={set:sr,clear:lr},br=Er.set,xr=a.MutationObserver||a.WebKitMutationObserver,_r=a.process,wr=a.Promise,Tr="process"==Y(_r),Mr={f:function(e){return new function(e){var t,r;this.promise=new e(function(e,i){if(void 0!==t||void 0!==r)throw TypeError("Bad Promise constructor");t=e,r=i}),this.resolve=S(t),this.reject=S(r)}(e)}},Rr=function(e){try{return{e:!1,v:e()}}catch(e){return{e:!0,v:e}}},Sr=Er.set,Pr=function(){var e,t,r,i=function(){var i,n;for(Tr&&(i=_r.domain)&&i.exit();e;){n=e.fn,e=e.next;try{n()}catch(i){throw e?r():t=void 0,i}}t=void 0,i&&i.enter()};if(Tr)r=function(){_r.nextTick(i)};else if(!xr||a.navigator&&a.navigator.standalone)if(wr&&wr.resolve){var n=wr.resolve();r=function(){n.then(i)}}else r=function(){br.call(a,i)};else{var o=!0,s=document.createTextNode("");new xr(i).observe(s,{characterData:!0}),r=function(){s.data=o=!o}}return function(i){var n={fn:i,next:void 0};t&&(t.next=n),e||(e=n,r()),t=n}}(),Ar=a.TypeError,Cr=a.process,Lr=a.Promise,Or="process"==Le(Cr),Hr=function(){},Fr=gr=Mr.f,Ir=!!function(){try{var e=Lr.resolve(1),t=(e.constructor={})[fe("species")]=function(e){e(Hr,Hr)};return(Or||"function"==typeof PromiseRejectionEvent)&&e.then(Hr)instanceof t}catch(e){}}(),kr=function(e){var t;return!(!l(e)||"function"!=typeof(t=e.then))&&t},Dr=function(e,t){if(!e._n){e._n=!0;var r=e._c;Pr(function(){for(var i=e._v,n=1==e._s,o=0,a=function(t){var r,o,a=n?t.ok:t.fail,s=t.resolve,l=t.reject,c=t.domain;try{a?(n||(2==e._h&&Ur(e),e._h=1),!0===a?r=i:(c&&c.enter(),r=a(i),c&&c.exit()),r===t.promise?l(Ar("Promise-chain cycle")):(o=kr(r))?o.call(r,s,l):s(r)):l(i)}catch(e){l(e)}};r.length>o;)a(r[o++]);e._c=[],e._n=!1,t&&!e._h&&Nr(e)})}},Nr=function(e){Sr.call(a,function(){var t,r,i,n=e._v,o=jr(e);if(o&&(t=Rr(function(){Or?Cr.emit("unhandledRejection",n,e):(r=a.onunhandledrejection)?r({promise:e,reason:n}):(i=a.console)&&i.error&&i.error("Unhandled promise rejection",n)}),e._h=Or||jr(e)?2:1),e._a=void 0,o&&t.e)throw t.v})},jr=function(e){return 1!==e._h&&0===(e._a||e._c).length},Ur=function(e){Sr.call(a,function(){var t;Or?Cr.emit("rejectionHandled",e):(t=a.onrejectionhandled)&&t({promise:e,reason:e._v})})},Br=function(e){var t=this;t._d||(t._d=!0,(t=t._w||t)._v=e,t._s=2,t._a||(t._a=t._c.slice()),Dr(t,!0))},Vr=function(e){var t,r=this;if(!r._d){r._d=!0,r=r._w||r;try{if(r===e)throw Ar("Promise can't be resolved itself");(t=kr(e))?Pr(function(){var i={_w:r,_d:!1};try{t.call(e,P(Vr,i,1),P(Br,i,1))}catch(e){Br.call(i,e)}}):(r._v=e,r._s=1,Dr(r,!1))}catch(e){Br.call({_w:r,_d:!1},e)}}};Ir||(Lr=function(e){U(this,Lr,"Promise","_h"),S(e),mr.call(this);try{e(P(Vr,this,1),P(Br,this,1))}catch(e){Br.call(this,e)}},(mr=function(e){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1}).prototype=j(Lr.prototype,{then:function(e,t){var r=Fr(be(this,Lr));return r.ok="function"!=typeof e||e,r.fail="function"==typeof t&&t,r.domain=Or?Cr.domain:void 0,this._c.push(r),this._a&&this._a.push(r),this._s&&Dr(this,!1),r.promise},catch:function(e){return this.then(void 0,e)}}),vr=function(){var e=new mr;this.promise=e,this.resolve=P(Vr,e,1),this.reject=P(Br,e,1)},Mr.f=Fr=function(e){return e===Lr||e===yr?new vr(e):gr(e)}),L(L.G+L.W+L.F*!Ir,{Promise:Lr}),ve(Lr,"Promise"),_e("Promise"),yr=s.Promise,L(L.S+L.F*!Ir,"Promise",{reject:function(e){var t=Fr(this);return(0,t.reject)(e),t.promise}}),L(L.S+L.F*!Ir,"Promise",{resolve:function(e){return function(e,t){if(c(e),l(t)&&t.constructor===e)return t;var r=Mr.f(e);return(0,r.resolve)(t),r.promise}(this,e)}}),L(L.S+L.F*!(Ir&&dt(function(e){Lr.all(e).catch(Hr)})),"Promise",{all:function(e){var t=this,r=Fr(t),i=r.resolve,n=r.reject,o=Rr(function(){var r=[],o=0,a=1;bt(e,!1,function(e){var s=o++,l=!1;r.push(void 0),a++,t.resolve(e).then(function(e){l||(l=!0,r[s]=e,--a||i(r))},n)}),--a||i(r)});return o.e&&n(o.v),r.promise},race:function(e){var t=this,r=Fr(t),i=r.reject,n=Rr(function(){bt(e,!1,function(e){t.resolve(e).then(r.resolve,i)})});return n.e&&i(n.v),r.promise}});var zr={f:fe},qr=y.f,Gr=function(e){var t=s.Symbol||(s.Symbol=a.Symbol||{});"_"==e.charAt(0)||e in t||qr(t,e,{value:zr.f(e)})},Wr=he.f,Xr={}.toString,Yr="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],Qr={f:function(e){return Yr&&"[object Window]"==Xr.call(e)?function(e){try{return Wr(e)}catch(e){return Yr.slice()}}(e):Wr(K(e))}},Jr=xt.KEY,Kr=vt.f,Zr=y.f,$r=Qr.f,ei=a.Symbol,ti=a.JSON,ri=ti&&ti.stringify,ii=fe("_hidden"),ni=fe("toPrimitive"),oi={}.propertyIsEnumerable,ai=ie("symbol-registry"),si=ie("symbols"),li=ie("op-symbols"),ci=Object.prototype,ui="function"==typeof ei,hi=a.QObject,pi=!hi||!hi.prototype||!hi.prototype.findChild,di=h&&u(function(){return 7!=ze(Zr({},"a",{get:function(){return Zr(this,"a",{value:7}).a}})).a})?function(e,t,r){var i=Kr(ci,t);i&&delete ci[t],Zr(e,t,r),i&&e!==ci&&Zr(ci,t,i)}:Zr,fi=function(e){var t=si[e]=ze(ei.prototype);return t._k=e,t},mi=ui&&"symbol"==typeof ei.iterator?function(e){return"symbol"==typeof e}:function(e){return e instanceof ei},gi=function(e,t,r){return e===ci&&gi(li,t,r),c(e),t=g(t,!0),c(r),_(si,t)?(r.enumerable?(_(e,ii)&&e[ii][t]&&(e[ii][t]=!1),r=ze(r,{enumerable:E(0,!1)})):(_(e,ii)||Zr(e,ii,E(1,{})),e[ii][t]=!0),di(e,t,r)):Zr(e,t,r)},vi=function(e,t){c(e);for(var r,i=function(e){var t=ke(e),r=Ot.f;if(r)for(var i,n=r(e),o=mt.f,a=0;n.length>a;)o.call(e,i=n[a++])&&t.push(i);return t}(t=K(t)),n=0,o=i.length;o>n;)gi(e,r=i[n++],t[r]);return e},yi=function(e){var t=oi.call(this,e=g(e,!0));return!(this===ci&&_(si,e)&&!_(li,e))&&(!(t||!_(this,e)||!_(si,e)||_(this,ii)&&this[ii][e])||t)},Ei=function(e,t){if(e=K(e),t=g(t,!0),e!==ci||!_(si,t)||_(li,t)){var r=Kr(e,t);return!r||!_(si,t)||_(e,ii)&&e[ii][t]||(r.enumerable=!0),r}},bi=function(e){for(var t,r=$r(K(e)),i=[],n=0;r.length>n;)_(si,t=r[n++])||t==ii||t==Jr||i.push(t);return i},xi=function(e){for(var t,r=e===ci,i=$r(r?li:K(e)),n=[],o=0;i.length>o;)!_(si,t=i[o++])||r&&!_(ci,t)||n.push(si[t]);return n};ui||(R((ei=function(){if(this instanceof ei)throw TypeError("Symbol is not a constructor!");var e=M(arguments.length>0?arguments[0]:void 0),t=function(r){this===ci&&t.call(li,r),_(this,ii)&&_(this[ii],e)&&(this[ii][e]=!1),di(this,e,E(1,r))};return h&&pi&&di(ci,e,{configurable:!0,set:t}),fi(e)}).prototype,"toString",function(){return this._k}),vt.f=Ei,y.f=gi,he.f=Qr.f=bi,mt.f=yi,Ot.f=xi,h&&R(ci,"propertyIsEnumerable",yi,!0),zr.f=function(e){return fi(fe(e))}),L(L.G+L.W+L.F*!ui,{Symbol:ei});for(var _i="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),wi=0;_i.length>wi;)fe(_i[wi++]);for(var Ti=ke(fe.store),Mi=0;Ti.length>Mi;)Gr(Ti[Mi++]);L(L.S+L.F*!ui,"Symbol",{for:function(e){return _(ai,e+="")?ai[e]:ai[e]=ei(e)},keyFor:function(e){if(!mi(e))throw TypeError(e+" is not a symbol!");for(var t in ai)if(ai[t]===e)return t},useSetter:function(){pi=!0},useSimple:function(){pi=!1}}),L(L.S+L.F*!ui,"Object",{create:function(e,t){return void 0===t?ze(e):vi(ze(e),t)},defineProperty:gi,defineProperties:vi,getOwnPropertyDescriptor:Ei,getOwnPropertyNames:bi,getOwnPropertySymbols:xi}),ti&&L(L.S+L.F*(!ui||u(function(){var e=ei();return"[null]"!=ri([e])||"{}"!=ri({a:e})||"{}"!=ri(Object(e))})),"JSON",{stringify:function(e){for(var t,r,i=[e],n=1;arguments.length>n;)i.push(arguments[n++]);if(r=t=i[1],(l(t)||void 0!==e)&&!mi(e))return Qe(t)||(t=function(e,t){if("function"==typeof r&&(t=r.call(this,e,t)),!mi(t))return t}),i[1]=t,ri.apply(ti,i)}}),ei.prototype[ni]||b(ei.prototype,ni,ei.prototype.valueOf),ve(ei,"Symbol"),ve(Math,"Math",!0),ve(a.JSON,"JSON",!0);var Ri=function(e,t){var r=(s.Object||{})[e]||Object[e],i={};i[e]=t(r),L(L.S+L.F*u(function(){r(1)}),"Object",i)},Si=xt.onFreeze;Ri("freeze",function(e){return function(t){return e&&l(t)?e(Si(t)):t}});var Pi=xt.onFreeze;Ri("seal",function(e){return function(t){return e&&l(t)?e(Pi(t)):t}});var Ai=xt.onFreeze;Ri("preventExtensions",function(e){return function(t){return e&&l(t)?e(Ai(t)):t}}),Ri("isFrozen",function(e){return function(t){return!l(t)||!!e&&e(t)}}),Ri("isSealed",function(e){return function(t){return!l(t)||!!e&&e(t)}}),Ri("isExtensible",function(e){return function(t){return!!l(t)&&(!e||e(t))}});var Ci=vt.f;Ri("getOwnPropertyDescriptor",function(){return function(e,t){return Ci(K(e),t)}}),Ri("getPrototypeOf",function(){return function(e){return We(pe(e))}}),Ri("keys",function(){return function(e){return ke(pe(e))}}),Ri("getOwnPropertyNames",function(){return Qr.f}),L(L.S+L.F,"Object",{assign:Ft});var Li=Object.is||function(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t};L(L.S,"Object",{is:Li}),L(L.S,"Object",{setPrototypeOf:At.set});var Oi=y.f,Hi=Function.prototype,Fi=/^\s*function ([^ (]*)/;"name"in Hi||h&&Oi(Hi,"name",{configurable:!0,get:function(){try{return(""+this).match(Fi)[1]}catch(e){return""}}}),L(L.S,"String",{raw:function(e){for(var t=K(e.raw),r=G(t.length),i=arguments.length,n=[],o=0;r>o;)n.push(String(t[o++])),o<i&&n.push(String(arguments[o]));return n.join("")}});var Ii=String.fromCharCode,ki=String.fromCodePoint;L(L.S+L.F*(!!ki&&1!=ki.length),"String",{fromCodePoint:function(e){for(var t,r=[],i=arguments.length,n=0;i>n;){if(t=+arguments[n++],ee(t,1114111)!==t)throw RangeError(t+" is not a valid code point");r.push(t<65536?Ii(t):Ii(55296+((t-=65536)>>10),t%1024+56320))}return r.join("")}});var Di=function(e){return function(t,r){var i,n,o=String(J(t)),a=z(r),s=o.length;return a<0||a>=s?e?"":void 0:(i=o.charCodeAt(a))<55296||i>56319||a+1===s||(n=o.charCodeAt(a+1))<56320||n>57343?e?o.charAt(a):i:e?o.slice(a,a+2):n-56320+(i-55296<<10)+65536}}(!1);L(L.P,"String",{codePointAt:function(e){return Di(this,e)}});var Ni=function(e){var t=String(J(this)),r="",i=z(e);if(i<0||i==1/0)throw RangeError("Count can't be negative");for(;i>0;(i>>>=1)&&(t+=t))1&i&&(r+=t);return r};L(L.P,"String",{repeat:Ni});var ji=fe("match"),Ui=function(e){var t;return l(e)&&(void 0!==(t=e[ji])?!!t:"RegExp"==Y(e))},Bi=function(e,t,r){if(Ui(t))throw TypeError("String#"+r+" doesn't accept regex!");return String(J(e))},Vi=fe("match"),zi=function(e){var t=/./;try{"/./"[e](t)}catch(r){try{return t[Vi]=!1,!"/./"[e](t)}catch(e){}}return!0},qi="".startsWith;L(L.P+L.F*zi("startsWith"),"String",{startsWith:function(e){var t=Bi(this,e,"startsWith"),r=G(Math.min(arguments.length>1?arguments[1]:void 0,t.length)),i=String(e);return qi?qi.call(t,i,r):t.slice(r,r+i.length)===i}});var Gi="".endsWith;L(L.P+L.F*zi("endsWith"),"String",{endsWith:function(e){var t=Bi(this,e,"endsWith"),r=arguments.length>1?arguments[1]:void 0,i=G(t.length),n=void 0===r?i:Math.min(G(r),i),o=String(e);return Gi?Gi.call(t,o,n):t.slice(n-o.length,n)===o}});L(L.P+L.F*zi("includes"),"String",{includes:function(e){return!!~Bi(this,e,"includes").indexOf(e,arguments.length>1?arguments[1]:void 0)}});h&&"g"!=/./g.flags&&y.f(RegExp.prototype,"flags",{configurable:!0,get:function(){var e=c(this),t="";return e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.unicode&&(t+="u"),e.sticky&&(t+="y"),t}});var Wi=function(e,t,r){var i=fe(e),n=r(J,i,""[e]),o=n[0],a=n[1];u(function(){var t={};return t[i]=function(){return 7},7!=""[e](t)})&&(R(String.prototype,e,o),b(RegExp.prototype,i,2==t?function(e,t){return a.call(e,this,t)}:function(e){return a.call(e,this)}))};Wi("match",1,function(e,t,r){return[function(r){var i=e(this),n=void 0==r?void 0:r[t];return void 0!==n?n.call(r,i):new RegExp(r)[t](String(i))},r]}),Wi("replace",2,function(e,t,r){return[function(i,n){var o=e(this),a=void 0==i?void 0:i[t];return void 0!==a?a.call(i,o,n):r.call(String(o),i,n)},r]}),Wi("split",2,function(e,t,r){var i=Ui,n=r,o=[].push;if("c"=="abbc".split(/(b)*/)[1]||4!="test".split(/(?:)/,-1).length||2!="ab".split(/(?:ab)*/).length||4!=".".split(/(.?)(.?)/).length||".".split(/()()/).length>1||"".split(/.?/).length){var a=void 0===/()??/.exec("")[1];r=function(e,t){var r=String(this);if(void 0===e&&0===t)return[];if(!i(e))return n.call(r,e,t);var s,l,c,u,h,p=[],d=(e.ignoreCase?"i":"")+(e.multiline?"m":"")+(e.unicode?"u":"")+(e.sticky?"y":""),f=0,m=void 0===t?4294967295:t>>>0,g=new RegExp(e.source,d+"g");for(a||(s=new RegExp("^"+g.source+"$(?!\\s)",d));(l=g.exec(r))&&!((c=l.index+l[0].length)>f&&(p.push(r.slice(f,l.index)),!a&&l.length>1&&l[0].replace(s,function(){for(h=1;h<arguments.length-2;h++)void 0===arguments[h]&&(l[h]=void 0)}),l.length>1&&l.index<r.length&&o.apply(p,l.slice(1)),u=l[0].length,f=c,p.length>=m));)g.lastIndex===l.index&&g.lastIndex++;return f===r.length?!u&&g.test("")||p.push(""):p.push(r.slice(f)),p.length>m?p.slice(0,m):p}}else"0".split(void 0,0).length&&(r=function(e,t){return void 0===e&&0===t?[]:n.call(this,e,t)});return[function(i,n){var o=e(this),a=void 0==i?void 0:i[t];return void 0!==a?a.call(i,o,n):r.call(String(o),i,n)},r]}),Wi("search",1,function(e,t,r){return[function(r){var i=e(this),n=void 0==r?void 0:r[t];return void 0!==n?n.call(r,i):new RegExp(r)[t](String(i))},r]});var Xi=function(e,t,r){t in e?y.f(e,t,E(0,r)):e[t]=r};L(L.S+L.F*!dt(function(e){Array.from(e)}),"Array",{from:function(e){var t,r,i,n,o=pe(e),a="function"==typeof this?this:Array,s=arguments.length,l=s>1?arguments[1]:void 0,c=void 0!==l,u=0,h=Ye(o);if(c&&(l=P(l,s>2?arguments[2]:void 0,2)),void 0==h||a==Array&&Ie(h))for(r=new a(t=G(o.length));t>u;u++)Xi(r,u,c?l(o[u],u):o[u]);else for(n=h.call(o),r=new a;!(i=n.next()).done;u++)Xi(r,u,c?Et(n,l,[i.value,u],!0):i.value);return r.length=u,r}}),L(L.S+L.F*u(function(){function e(){}return!(Array.of.call(e)instanceof e)}),"Array",{of:function(){for(var e=0,t=arguments.length,r=new("function"==typeof this?this:Array)(t);t>e;)Xi(r,e,arguments[e++]);return r.length=t,r}}),L(L.P,"Array",{copyWithin:ft}),tt("copyWithin");var Yi=Ze(5),Qi=!0;"find"in[]&&Array(1).find(function(){Qi=!1}),L(L.P+L.F*Qi,"Array",{find:function(e){return Yi(this,e,arguments.length>1?arguments[1]:void 0)}}),tt("find");var Ji=Ze(6),Ki=!0;"findIndex"in[]&&Array(1).findIndex(function(){Ki=!1}),L(L.P+L.F*Ki,"Array",{findIndex:function(e){return Ji(this,e,arguments.length>1?arguments[1]:void 0)}}),tt("findIndex"),L(L.P,"Array",{fill:de}),tt("fill");var Zi=a.isFinite;L(L.S,"Number",{isFinite:function(e){return"number"==typeof e&&Zi(e)}});var $i=Math.floor,en=function(e){return!l(e)&&isFinite(e)&&$i(e)===e};L(L.S,"Number",{isInteger:en});var tn=Math.abs;L(L.S,"Number",{isSafeInteger:function(e){return en(e)&&tn(e)<=9007199254740991}}),L(L.S,"Number",{isNaN:function(e){return e!=e}}),L(L.S,"Number",{EPSILON:Math.pow(2,-52)}),L(L.S,"Number",{MIN_SAFE_INTEGER:-9007199254740991}),L(L.S,"Number",{MAX_SAFE_INTEGER:9007199254740991});var rn=Math.log1p||function(e){return(e=+e)>-1e-8&&e<1e-8?e-e*e/2:Math.log(1+e)},nn=Math.sqrt,on=Math.acosh;L(L.S+L.F*!(on&&710==Math.floor(on(Number.MAX_VALUE))&&on(1/0)==1/0),"Math",{acosh:function(e){return(e=+e)<1?NaN:e>94906265.62425156?Math.log(e)+Math.LN2:rn(e-1+nn(e-1)*nn(e+1))}});var an=Math.asinh;L(L.S+L.F*!(an&&1/an(0)>0),"Math",{asinh:n});var sn=Math.atanh;L(L.S+L.F*!(sn&&1/sn(-0)<0),"Math",{atanh:function(e){return 0==(e=+e)?e:Math.log((1+e)/(1-e))/2}});var ln=Math.sign||function(e){return 0==(e=+e)||e!=e?e:e<0?-1:1};L(L.S,"Math",{cbrt:function(e){return ln(e=+e)*Math.pow(Math.abs(e),1/3)}}),L(L.S,"Math",{clz32:function(e){return(e>>>=0)?31-Math.floor(Math.log(e+.5)*Math.LOG2E):32}});var cn=Math.exp;L(L.S,"Math",{cosh:function(e){return(cn(e=+e)+cn(-e))/2}});var un=Math.expm1,hn=!un||un(10)>22025.465794806718||un(10)<22025.465794806718||-2e-17!=un(-2e-17)?function(e){return 0==(e=+e)?e:e>-1e-6&&e<1e-6?e+e*e/2:Math.exp(e)-1}:un;L(L.S+L.F*(hn!=Math.expm1),"Math",{expm1:hn});var pn=Math.pow,dn=pn(2,-52),fn=pn(2,-23),mn=pn(2,127)*(2-fn),gn=pn(2,-126),vn=Math.fround||function(e){var t,r,i=Math.abs(e),n=ln(e);return i<gn?n*function(e){return e+1/dn-1/dn}(i/gn/fn)*gn*fn:(t=(1+fn/dn)*i,(r=t-(t-i))>mn||r!=r?n*(1/0):n*r)};L(L.S,"Math",{fround:vn});var yn=Math.abs;L(L.S,"Math",{hypot:function(e,t){for(var r,i,n=0,o=0,a=arguments.length,s=0;o<a;)s<(r=yn(arguments[o++]))?(n=n*(i=s/r)*i+1,s=r):n+=r>0?(i=r/s)*i:r;return s===1/0?1/0:s*Math.sqrt(n)}});var En=Math.imul;L(L.S+L.F*u(function(){return-5!=En(4294967295,5)||2!=En.length}),"Math",{imul:function(e,t){var r=+e,i=+t,n=65535&r,o=65535&i;return 0|n*o+((65535&r>>>16)*o+n*(65535&i>>>16)<<16>>>0)}}),L(L.S,"Math",{log1p:rn}),L(L.S,"Math",{log10:function(e){return Math.log(e)*Math.LOG10E}}),L(L.S,"Math",{log2:function(e){return Math.log(e)/Math.LN2}}),L(L.S,"Math",{sign:ln});var bn=Math.exp;L(L.S+L.F*u(function(){return-2e-17!=!Math.sinh(-2e-17)}),"Math",{sinh:function(e){return Math.abs(e=+e)<1?(hn(e)-hn(-e))/2:(bn(e-1)-bn(-e-1))*(Math.E/2)}});var xn=Math.exp;L(L.S,"Math",{tanh:function(e){var t=hn(e=+e),r=hn(-e);return t==1/0?1:r==1/0?-1:(t-r)/(xn(e)+xn(-e))}}),L(L.S,"Math",{trunc:function(e){return(e>0?Math.floor:Math.ceil)(e)}});var _n=te(!0);L(L.P,"Array",{includes:function(e){return _n(this,e,arguments.length>1?arguments[1]:void 0)}}),tt("includes");var wn=mt.f,Tn=function(e){return function(t){for(var r,i=K(t),n=ke(i),o=n.length,a=0,s=[];o>a;)wn.call(i,r=n[a++])&&s.push(e?[r,i[r]]:i[r]);return s}},Mn=Tn(!1);L(L.S,"Object",{values:function(e){return Mn(e)}});var Rn=Tn(!0);L(L.S,"Object",{entries:function(e){return Rn(e)}}),L(L.S,"Object",{getOwnPropertyDescriptors:function(e){for(var t,r,i=K(e),n=vt.f,o=tr(i),a={},s=0;o.length>s;)void 0!==(r=n(i,t=o[s++]))&&Xi(a,t,r);return a}});var Sn=function(e,t,r,i){var n=String(J(e)),o=n.length,a=void 0===r?" ":String(r),s=G(t);if(s<=o||""==a)return n;var l=s-o,c=Ni.call(a,Math.ceil(l/a.length));return c.length>l&&(c=c.slice(0,l)),i?c+n:n+c},Pn=a.navigator,An=Pn&&Pn.userAgent||"";L(L.P+L.F*/Version\/10\.\d+(\.\d+)? Safari\//.test(An),"String",{padStart:function(e){return Sn(this,e,arguments.length>1?arguments[1]:void 0,!0)}}),L(L.P+L.F*/Version\/10\.\d+(\.\d+)? Safari\//.test(An),"String",{padEnd:function(e){return Sn(this,e,arguments.length>1?arguments[1]:void 0,!1)}});var Cn=[].slice,Ln=/MSIE .\./.test(An),On=function(e){return function(t,r){var i=arguments.length>2,n=!!i&&Cn.call(arguments,2);return e(i?function(){("function"==typeof t?t:Function(t)).apply(this,n)}:t,r)}};L(L.G+L.B+L.F*Ln,{setTimeout:On(a.setTimeout),setInterval:On(a.setInterval)}),L(L.G+L.B,{setImmediate:Er.set,clearImmediate:Er.clear});for(var Hn=fe("iterator"),Fn=fe("toStringTag"),In=Oe.Array,kn={CSSRuleList:!0,CSSStyleDeclaration:!1,CSSValueList:!1,ClientRectList:!1,DOMRectList:!1,DOMStringList:!1,DOMTokenList:!0,DataTransferItemList:!1,FileList:!1,HTMLAllCollection:!1,HTMLCollection:!1,HTMLFormElement:!1,HTMLSelectElement:!1,MediaList:!0,MimeTypeArray:!1,NamedNodeMap:!1,NodeList:!0,PaintRequestList:!1,Plugin:!1,PluginArray:!1,SVGLengthList:!1,SVGNumberList:!1,SVGPathSegList:!1,SVGPointList:!1,SVGStringList:!1,SVGTransformList:!1,SourceBufferList:!1,StyleSheetList:!0,TextTrackCueList:!1,TextTrackList:!1,TouchList:!1},Dn=ke(kn),Nn=0;Nn<Dn.length;Nn++){var jn,Un=Dn[Nn],Bn=kn[Un],Vn=a[Un],zn=Vn&&Vn.prototype;if(zn&&(zn[Hn]||b(zn,Hn,In),zn[Fn]||b(zn,Fn,Un),Oe[Un]=In,Bn))for(jn in ct)zn[jn]||R(zn,jn,ct[jn],!0)}t(function(e){!function(t){function r(e,t,r,o){var a=t&&t.prototype instanceof n?t:n,s=Object.create(a.prototype),l=new p(o||[]);return s._invoke=function(e,t,r){var n=w;return function(o,a){if(n===M)throw new Error("Generator is already running");if(n===R){if("throw"===o)throw a;return f()}for(r.method=o,r.arg=a;;){var s=r.delegate;if(s){var l=c(s,r);if(l){if(l===S)continue;return l}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(n===w)throw n=R,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n=M;var u=i(e,t,r);if("normal"===u.type){if(n=r.done?R:T,u.arg===S)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(n=R,r.method="throw",r.arg=u.arg)}}}(e,r,l),s}function i(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}function n(){}function o(){}function a(){}function s(e){["next","throw","return"].forEach(function(t){e[t]=function(e){return this._invoke(t,e)}})}function l(e){function r(t,n,o,a){var s=i(e[t],e,n);if("throw"!==s.type){var l=s.arg,c=l.value;return c&&"object"==typeof c&&v.call(c,"__await")?Promise.resolve(c.__await).then(function(e){r("next",e,o,a)},function(e){r("throw",e,o,a)}):Promise.resolve(c).then(function(e){l.value=e,o(l)},a)}a(s.arg)}"object"==typeof t.process&&t.process.domain&&(r=t.process.domain.bind(r));var n;this._invoke=function(e,t){function i(){return new Promise(function(i,n){r(e,t,i,n)})}return n=n?n.then(i,i):i()}}function c(e,t){var r=e.iterator[t.method];if(r===m){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=m,c(e,t),"throw"===t.method))return S;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return S}var n=i(r,e.iterator,t.arg);if("throw"===n.type)return t.method="throw",t.arg=n.arg,t.delegate=null,S;var o=n.arg;return o?o.done?(t[e.resultName]=o.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=m),t.delegate=null,S):o:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,S)}function u(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function h(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function p(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(u,this),this.reset(!0)}function d(e){if(e){var t=e[E];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,i=function t(){for(;++r<e.length;)if(v.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=m,t.done=!0,t};return i.next=i}}return{next:f}}function f(){return{value:m,done:!0}}var m,g=Object.prototype,v=g.hasOwnProperty,y="function"==typeof Symbol?Symbol:{},E=y.iterator||"@@iterator",b=y.asyncIterator||"@@asyncIterator",x=y.toStringTag||"@@toStringTag",_=t.regeneratorRuntime;if(_)e.exports=_;else{(_=t.regeneratorRuntime=e.exports).wrap=r;var w="suspendedStart",T="suspendedYield",M="executing",R="completed",S={},P={};P[E]=function(){return this};var A=Object.getPrototypeOf,C=A&&A(A(d([])));C&&C!==g&&v.call(C,E)&&(P=C);var L=a.prototype=n.prototype=Object.create(P);o.prototype=L.constructor=a,a.constructor=o,a[x]=o.displayName="GeneratorFunction",_.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===o||"GeneratorFunction"===(t.displayName||t.name))},_.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,a):(e.__proto__=a,x in e||(e[x]="GeneratorFunction")),e.prototype=Object.create(L),e},_.awrap=function(e){return{__await:e}},s(l.prototype),l.prototype[b]=function(){return this},_.AsyncIterator=l,_.async=function(e,t,i,n){var o=new l(r(e,t,i,n));return _.isGeneratorFunction(t)?o:o.next().then(function(e){return e.done?e.value:o.next()})},s(L),L[x]="Generator",L[E]=function(){return this},L.toString=function(){return"[object Generator]"},_.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var i=t.pop();if(i in e)return r.value=i,r.done=!1,r}return r.done=!0,r}},_.values=d,p.prototype={constructor:p,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=m,this.done=!1,this.delegate=null,this.method="next",this.arg=m,this.tryEntries.forEach(h),!e)for(var t in this)"t"===t.charAt(0)&&v.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=m)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){function t(t,i){return o.type="throw",o.arg=e,r.next=t,i&&(r.method="next",r.arg=m),!!i}if(this.done)throw e;for(var r=this,i=this.tryEntries.length-1;i>=0;--i){var n=this.tryEntries[i],o=n.completion;if("root"===n.tryLoc)return t("end");if(n.tryLoc<=this.prev){var a=v.call(n,"catchLoc"),s=v.call(n,"finallyLoc");if(a&&s){if(this.prev<n.catchLoc)return t(n.catchLoc,!0);if(this.prev<n.finallyLoc)return t(n.finallyLoc)}else if(a){if(this.prev<n.catchLoc)return t(n.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<n.finallyLoc)return t(n.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&v.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var n=i;break}}n&&("break"===e||"continue"===e)&&n.tryLoc<=t&&t<=n.finallyLoc&&(n=null);var o=n?n.completion:{};return o.type=e,o.arg=t,n?(this.method="next",this.next=n.finallyLoc,S):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),S},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),h(r),S}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var i=r.completion;if("throw"===i.type){var n=i.arg;h(r)}return n}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:d(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=m),S}}}}("object"==typeof o?o:"object"==typeof window?window:"object"==typeof self?self:o)});var qn=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},Gn=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),Wn=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},Xn=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},Yn=function e(){qn(this,e),this.positionArray=null,this.normalArray=null,this.uvArray=null,this.colorArray=null,this.uv2Array=null,this.indexArray=null,this.material=null,this.resource=null},Qn=function e(){qn(this,e)};Qn.wallTexture=null,Qn.wallEdgeTexture=null,Qn.floorTexture=null,Qn.ceilingTexture=null,Qn.roofTexture=null,Qn.wallLigthMapTexture=null,Qn.floorLightMapTexture=null,Qn.wallMaterial=null,Qn.wallEdgeMaterial=null,Qn.floorMaterial=null,Qn.ceilingMaterial=null,Qn.roofMaterial=null;var Jn=function e(){qn(this,e)};Jn.StraightManualWallHeight=3,Jn.StraightManualWallThick=.15,Jn.enableDelayLoadMode=!0,Jn.enableManaulWallLightMap=!0,Jn.enableFloorLightMap=!0,Jn.wallLightMapIntensity=3.8,Jn.enableUseHighestVersionResource=!0,Jn.enableCombine=!0;var Kn=function(){function e(){qn(this,e),this.id=null,this.name=null,this.userID=null,this.position=new THREE.Vector3,this.rotation=new THREE.Quaternion(0,0,0,1),this.scale=new THREE.Vector3(1,1,1),this.enableDelayLoadMode=Jn.enableDelayLoadMode,this.parent=null,this.properties=null,this.isShow=!0}return Gn(e,[{key:"worldPosition",get:function(){if(this.parent){var e=new THREE.Vector3;return e.addVectors(this.parent.worldPosition,this.position),e}return this.position}}]),e}(),Zn=function(e){function t(){qn(this,t);var r=Xn(this,e.call(this));return r.startCorner=null,r.endCorner=null,r.thick=-1,r.height=-1,r.length=-1,r.pathPoints=[],r.direction=new THREE.Vector3,r.doorOrWindows=[],r.subWalls=[],r.subCorners=[],r.suspend=0,r.mesh=null,r.isShow=!0,r}return Wn(t,e),t.prototype.baseBuild=function(){this.direction=new THREE.Vector3,this.direction.subVectors(this.endCorner.position,this.startCorner.position),this.length=this.direction.length(),this.direction.normalize(),this.pathPoints.push(this.startCorner.position),this.pathPoints.push(this.endCorner.position),this.position.addVectors(this.endCorner.position,this.startCorner.position),this.position.divideScalar(2)},t.prototype.build=function(){},t.prototype.getWallOtherCorner=function(e){return this.startCorner===e?this.endCorner:this.endCorner===e?this.startCorner:null},t.prototype.sortDoorOrWins=function(){var e=this.startCorner.position,t=this.endCorner.position,r=t.x-e.x>0?1:-1,i=t.z-e.z>0?1:-1,n=!0;Math.abs(t.x-e.x)<.001&&(n=!1);for(var o=[],a=0;a<this.doorOrWindows.length;a++){for(var s=this.doorOrWindows[a],l=0;l<o.length;l++){var c=o[l];if((n?(c.position.x-s.position.x)*r:(c.position.z-s.position.z)*i)>=0){o.splice(l,0,s);break}if(l==o.length-1){o.push(s);break}}0===o.length&&o.push(s)}return o},t.prototype.getWallCornerByPos=function(e){for(var t=null,r=-1,i=this.subCorners,n=0;n<i.length;n++){var o=e.distanceTo(i[n].position);o<.01&&(null===t?(t=i[n],r=o):o<r&&(r=o,t=i[n]))}return t},t.prototype.getDoorOrWinStartAndEndPos=function(e){var t=e.size,r=this.direction,i=e.position.clone();i.y=0;var n=i.clone(),o=i.clone(),a=t.x/2;n.subVectors(n,r.clone().multiplyScalar(a)),o.addVectors(o,r.clone().multiplyScalar(a));return[n,o]},t.prototype.addSubWallCorner=function(e){for(var t=0;t<this.subCorners.length;t++){if(this.subCorners[t]===e)return}this.subCorners.push(e)},Gn(t,[{key:"worldPosition",get:function(){var e=this.startCorner.worldPosition,t=this.endCorner.worldPosition,r=new THREE.Vector3;return r.addVectors(e,t),r.divideScalar(2),r}}]),t}(Kn),$n=function(){function e(){qn(this,e)}return e.equalVectorZero=function(e){return 0===e.x&&0===e.y&&0===e.z},e.clone=function(e){var t=e.clone(),r={};e.traverse(function(e){e.isSkinnedMesh&&(r[e.name]=e)});var i={},n={};t.traverse(function(e){e.isBone&&(i[e.name]=e),e.isSkinnedMesh&&(n[e.name]=e)});var o=!1;for(var a in r){o=!0;for(var s=r[a].skeleton,l=n[a],c=[],u=0;u<s.bones.length;++u){var h=i[s.bones[u].name];c.push(h)}l.bind(new THREE.Skeleton(c,s.boneInverses),l.matrixWorld)}return t.hasSkin=!!o,t},e}(),eo=function(e){function t(){qn(this,t);var r=Xn(this,e.call(this));return r.startCorner=null,r.endCorner=null,r.thick=Jn.StraightManualWallThick,r.height=Jn.StraightManualWallHeight,r.cornersVertices=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3],r.direction=null,r.pathPoints=[],r.selfPathPoints=[],r.upDirection=new THREE.Vector3(0,1,0),r.basePoints=null,r.repeatUV=[],r.uvMultiple=[1,1],r.rightSideLength=null,r.leftSideLength=null,r.floorPlanHeight=3,r.rightSideMeshInfo=new Yn,r.leftSideMeshInfo=new Yn,r.edgeSideMeshInfo=new Yn,r.defaultWallTexture=null,r.rightWallTexture=null,r.leftWallTexture=null,r.startUVPercent=[0,0,0,0],r.endUVPercent=[1,1,1,1],r.wallGroup=null,r.leftResource=null,r.rightResource=null,r.edgeResource=null,r.lightMapResource=null,r.isBuilded=!1,r.vectorUp=new THREE.Vector3(0,1,0),r.onlyBuildMeshInfo=!1,r.downDirection=new THREE.Vector3(0,-1,0),r.enableLightMap=Jn.enableManaulWallLightMap,r.aoMapIntensity=Jn.wallLightMapIntensity,r}return Wn(t,e),t.prototype.leftResourceCallback=function(e){},t.prototype.rightResourceCallback=function(e){this.rigthWallTexture=e,this.isBuilded&&(this.wallGroup[0].material.texture=this.rigthWallTexture)},t.prototype.resourceCallback=function(e){e===this.leftResource?(this.leftWallTexture=e.texture,this.initLightMap(),this.isBuilded&&this.wallGroup&&(this.enableLightMap?this.wallGroup.children[1].material=this.leftResource.wallLightMaterial:this.wallGroup.children[1].material=this.leftResource.material,this.wallGroup.children[1].material.needsUpdate=!0)):e===this.rightResource&&(this.rigthWallTexture=e.texture,this.initLightMap(),this.isBuilded&&this.wallGroup&&(this.enableLightMap?this.wallGroup.children[0].material=this.leftResource.wallLightMaterial:this.wallGroup.children[0].material=this.leftResource.material))},t.prototype.initMaterial=function(){this.leftResource?this.leftResource.ready?this.leftWallTexture=this.leftResource.texture:this.leftResource.callbackObjects.push(this):this.leftWallTexture||(this.leftWallTexture=Qn.wallTexture),this.rightResource?this.rightResource.ready?this.rightWallTexture=this.rightResource.texture:this.rightResource.callbackObjects.push(this):this.rightWallTexture||(this.rightWallTexture=Qn.wallTexture),this.leftResource?(this.leftSideMeshInfo.resource=this.leftResource,this.leftSideMeshInfo.material=this.leftResource.material):this.leftSideMeshInfo.material=new THREE.MeshStandardMaterial({map:null}),this.rightResource?(this.rightSideMeshInfo.resource=this.rightResource,this.rightSideMeshInfo.material=this.rightResource.material):this.rightSideMeshInfo.material=new THREE.MeshStandardMaterial({map:null}),this.edgeResource?(this.edgeSideMeshInfo.resource=this.edgeResource,this.edgeSideMeshInfo.material=this.edgeResource.material):this.edgeSideMeshInfo.material=new THREE.MeshStandardMaterial({map:null}),this.initLightMap()},t.prototype.initLightMap=function(){this.lightMapResource&&this.enableLightMap&&(this.rightResource.ready&&(void 0===this.rightResource.wallLightMaterial&&(this.rightResource.wallLightMaterial=this.rightResource.wallMaterial.clone(),this.rightResource.wallLightMaterial.onBeforeCompile=function(e){e.fragmentShader=e.fragmentShader.replace("#include <aomap_fragment>",["#ifdef USE_AOMAP","float ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity * 0. + 1.6;","#if defined( USE_ENVMAP ) && defined( PHYSICAL )","float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );","reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );","#endif","#endif"].join("\n"))}),this.rightSideMeshInfo.material=this.rightResource.wallLightMaterial,this.rightSideMeshInfo.material.aoMap=this.lightMapResource.texture),this.leftResource.ready&&(void 0===this.leftResource.wallLightMaterial&&(this.leftResource.wallLightMaterial=this.leftResource.wallMaterial.clone(),this.leftResource.wallLightMaterial.onBeforeCompile=function(e){e.fragmentShader=e.fragmentShader.replace("#include <aomap_fragment>",["#ifdef USE_AOMAP","float ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity * 1. + 2.3;","#if defined( USE_ENVMAP ) && defined( PHYSICAL )","float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );","reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );","#endif","#endif"].join("\n"))}),this.leftSideMeshInfo.material=this.leftResource.wallLightMaterial,this.leftSideMeshInfo.material.aoMap=this.lightMapResource.texture))},t.prototype.build=function(){if(this.baseBuild(),this.calPosInfo(),this.calEachSideLen(),this.calRepeatUV(),this.calBasePoints(),this.fillMesh(),this.initMaterial(),!this.onlyBuildMeshInfo){var e=this.position,t=new THREE.Group("wall");t.add(this.createMesh(this.leftSideMeshInfo)),t.add(this.createMesh(this.rightSideMeshInfo)),t.add(this.createMesh(this.edgeSideMeshInfo)),t.position.set(e.x,e.y,e.z),this.wallGroup=t,this.mesh=this.wallGroup}this.isBuilded=!0},t.prototype.baseBuild=function(){this.direction=new THREE.Vector3,this.direction.subVectors(this.endCorner.position,this.startCorner.position),this.direction.normalize(),this.pathPoints.push(this.startCorner.position),this.pathPoints.push(this.endCorner.position)},t.prototype.calEachSideLen=function(){var e=new THREE.Vector3;e.subVectors(this.endCorner.position,this.startCorner.position),e.normalize();var t=this.thick/2,r=new THREE.Vector3;r.crossVectors(this.upDirection,e),r.normalize();var i=r.clone();i.negate();var n=r.clone();n.multiplyScalar(t);var o=i.clone();o.multiplyScalar(t);var a=new THREE.Vector3,s=new THREE.Vector3,l=new THREE.Vector3,c=new THREE.Vector3;$n.equalVectorZero(this.cornersVertices[0])?a.addVectors(this.selfPathPoints[0],n):a.copy(this.cornersVertices[0]),$n.equalVectorZero(this.cornersVertices[3])?s.addVectors(this.selfPathPoints[1],n):s.copy(this.cornersVertices[3]),$n.equalVectorZero(this.cornersVertices[1])?l.addVectors(this.selfPathPoints[0],o):l.copy(this.cornersVertices[1]),$n.equalVectorZero(this.cornersVertices[2])?c.addVectors(this.selfPathPoints[1],o):c.copy(this.cornersVertices[2]),this.rightSideLength=new THREE.Vector3,this.leftSideLength=new THREE.Vector3,this.rightSideLength.subVectors(a,s),this.leftSideLength.subVectors(l,c),this.rightSideLength=this.rightSideLength.length(),this.leftSideLength=this.leftSideLength.length()},t.prototype.calRepeatUV=function(){this.repeatUV[0]=this.uvMultiple[0]*this.rightSideLength/this.floorPlanHeight,this.repeatUV[1]=this.uvMultiple[1]*this.height/this.floorPlanHeight,this.repeatUV[2]=this.uvMultiple[0]*this.leftSideLength/this.floorPlanHeight,this.repeatUV[3]=this.uvMultiple[1]*this.height/this.floorPlanHeight},t.prototype.calPosInfo=function(){var e=new THREE.Vector3;this.selfPathPoints.push(e.subVectors(this.startCorner.position,this.position)),e=new THREE.Vector3,this.selfPathPoints.push(e.subVectors(this.endCorner.position,this.position)),this.selfPathPoints[0].y=0,this.selfPathPoints[1].y=0},t.prototype.calBasePoints=function(){if(null===this.basePoints){this.basePoints=[];for(var e=0;e<12;e++)this.basePoints.push(new THREE.Vector3)}var t=this.thick/2,r=new THREE.Vector3;r.crossVectors(this.upDirection,this.direction),r.normalize();var i=r.clone();i.negate();var n=r.multiplyScalar(t);$n.equalVectorZero(this.cornersVertices[0])?(this.basePoints[4].x=this.selfPathPoints[0].x+n.x,this.basePoints[4].y=0,this.basePoints[4].z=this.selfPathPoints[0].z+n.z):(this.basePoints[4].x=this.cornersVertices[0].x,this.basePoints[4].y=0,this.basePoints[4].z=this.cornersVertices[0].z),$n.equalVectorZero(this.cornersVertices[1])?(n=i.multiplyScalar(t),this.basePoints[5].x=this.selfPathPoints[0].x+n.x,this.basePoints[5].y=0,this.basePoints[5].z=this.selfPathPoints[0].z+n.z):(this.basePoints[5].x=this.cornersVertices[1].x,this.basePoints[5].y=0,this.basePoints[5].z=this.cornersVertices[1].z);var o=this.direction.clone();r.crossVectors(this.upDirection,o.negate()),r.normalize(),(i=r.clone()).negate(),$n.equalVectorZero(this.cornersVertices[2])?((n=r.clone()).multiplyScalar(t),this.basePoints[6].x=this.selfPathPoints[1].x+n.x,this.basePoints[6].y=0,this.basePoints[6].z=this.selfPathPoints[1].z+n.z):(this.basePoints[6].x=this.cornersVertices[2].x,this.basePoints[6].y=0,this.basePoints[6].z=this.cornersVertices[2].z),$n.equalVectorZero(this.cornersVertices[3])?((n=i.clone()).multiplyScalar(t),this.basePoints[7].x=this.selfPathPoints[1].x+n.x,this.basePoints[7].y=0,this.basePoints[7].z=this.selfPathPoints[1].z+n.z):(this.basePoints[7].x=this.cornersVertices[3].x,this.basePoints[7].y=0,this.basePoints[7].z=this.cornersVertices[3].z),this.basePoints[0].x=this.basePoints[4].x,this.basePoints[0].y=this.basePoints[4].y+this.height,this.basePoints[0].z=this.basePoints[4].z,this.basePoints[1].x=this.basePoints[5].x,this.basePoints[1].y=this.basePoints[5].y+this.height,this.basePoints[1].z=this.basePoints[5].z,this.basePoints[2].x=this.basePoints[6].x,this.basePoints[2].y=this.basePoints[6].y+this.height,this.basePoints[2].z=this.basePoints[6].z,this.basePoints[3].x=this.basePoints[7].x,this.basePoints[3].y=this.basePoints[7].y+this.height,this.basePoints[3].z=this.basePoints[7].z,this.basePoints[8].x=this.selfPathPoints[0].x,this.basePoints[8].y=this.selfPathPoints[0].y+this.height,this.basePoints[8].z=this.selfPathPoints[0].z,this.basePoints[9].x=this.selfPathPoints[1].x,this.basePoints[9].y=this.selfPathPoints[1].y+this.height,this.basePoints[9].z=this.selfPathPoints[1].z},t.prototype.fillMesh=function(){this.leftSideMeshInfo.positionArray=new Float32Array(18),this.leftSideMeshInfo.normalArray=new Float32Array(18),this.leftSideMeshInfo.uvArray=new Float32Array(12),this.leftSideMeshInfo.indexArray=new Float32Array(6),this.rightSideMeshInfo.positionArray=new Float32Array(18),this.rightSideMeshInfo.normalArray=new Float32Array(18),this.rightSideMeshInfo.uvArray=new Float32Array(12),this.rightSideMeshInfo.indexArray=new Float32Array(6),this.edgeSideMeshInfo.positionArray=new Float32Array(72),this.edgeSideMeshInfo.normalArray=new Float32Array(72),this.edgeSideMeshInfo.uvArray=new Float32Array(48),this.edgeSideMeshInfo.indexArray=new Float32Array(24),this.lightMapResource&&(this.leftSideMeshInfo.uv2Array=new Float32Array(12),this.rightSideMeshInfo.uv2Array=new Float32Array(12),this.leftSideMeshInfo.uv2Array=new Float32Array(12));for(u=0;u<6;u++)this.leftSideMeshInfo.indexArray[u]=u,this.rightSideMeshInfo.indexArray[u]=u;for(u=0;u<24;u++)this.edgeSideMeshInfo.indexArray[u]=u;var e=this.basePoints,t=0,r=new THREE.Vector3;r.crossVectors(this.upDirection,this.direction),r.normalize();var i=new THREE.Vector3;i.crossVectors(this.direction,this.upDirection),i.normalize();var n=this.direction,o=n.clone();o.negate();var a=new Array;a[t++]=e[0],a[t++]=e[3],a[t++]=e[7],a[t++]=e[0],a[t++]=e[7],a[t++]=e[4],a[t++]=e[2],a[t++]=e[1],a[t++]=e[5],a[t++]=e[2],a[t++]=e[5],a[t++]=e[6],a[t++]=e[0],a[t++]=e[1],a[t++]=e[2],a[t++]=e[0],a[t++]=e[2],a[t++]=e[3],0!==this.suspend&&(a[t++]=e[4],a[t++]=e[6],a[t++]=e[5],a[t++]=e[4],a[t++]=e[7],a[t++]=e[6]),a[t++]=e[1],a[t++]=e[0],a[t++]=e[4],a[t++]=e[1],a[t++]=e[4],a[t++]=e[5],a[t++]=e[3],a[t++]=e[2],a[t++]=e[7],a[t++]=e[2],a[t++]=e[6],a[t++]=e[7],a[t++]=e[1],a[t++]=e[0],a[t++]=e[8],a[t++]=e[3],a[t++]=e[2],a[t++]=e[9],t=0;var s=new Array;s[t++]=r,s[t++]=r,s[t++]=r,s[t++]=r,s[t++]=r,s[t++]=r;for(u=0;u<s.length;u++){var l=s[u],c=3*u;this.rightSideMeshInfo.normalArray[c]=l.x,this.rightSideMeshInfo.normalArray[c+1]=l.y,this.rightSideMeshInfo.normalArray[c+2]=l.z}s[t++]=i,s[t++]=i,s[t++]=i,s[t++]=i,s[t++]=i,s[t++]=i;for(var u=6,h=0;u<s.length;u++,h++){var l=s[u],c=3*h;this.leftSideMeshInfo.normalArray[c]=l.x,this.leftSideMeshInfo.normalArray[c+1]=l.y,this.leftSideMeshInfo.normalArray[c+2]=l.z}s[t++]=this.upDirection,s[t++]=this.upDirection,s[t++]=this.upDirection,s[t++]=this.upDirection,s[t++]=this.upDirection,s[t++]=this.upDirection,0!==this.suspend&&(s[t++]=this.downDirection,s[t++]=this.downDirection,s[t++]=this.downDirection,s[t++]=this.downDirection,s[t++]=this.downDirection,s[t++]=this.downDirection),s[t++]=o,s[t++]=o,s[t++]=o,s[t++]=o,s[t++]=o,s[t++]=o,s[t++]=n,s[t++]=n,s[t++]=n,s[t++]=n,s[t++]=n,s[t++]=n,s[t++]=this.upDirection,s[t++]=this.upDirection,s[t++]=this.upDirection,s[t++]=this.upDirection,s[t++]=this.upDirection,s[t++]=this.upDirection;for(u=0;u<6;u++){var l=a[u],c=3*u;this.rightSideMeshInfo.positionArray[c]=l.x,this.rightSideMeshInfo.positionArray[c+1]=l.y+this.suspend,this.rightSideMeshInfo.positionArray[c+2]=l.z}for(var u=6,h=0;u<12;u++,h++){var l=a[u],c=3*h;this.leftSideMeshInfo.positionArray[c]=l.x,this.leftSideMeshInfo.positionArray[c+1]=l.y+this.suspend,this.leftSideMeshInfo.positionArray[c+2]=l.z}for(var u=12,h=0;u<a.length;u++,h++){var l=a[u],c=3*h;this.edgeSideMeshInfo.positionArray[c]=l.x,this.edgeSideMeshInfo.positionArray[c+1]=l.y+this.suspend,this.edgeSideMeshInfo.positionArray[c+2]=l.z}for(var u=12,h=0;u<s.length;u++,h++){var l=s[u],c=3*h;this.edgeSideMeshInfo.normalArray[c]=l.x,this.edgeSideMeshInfo.normalArray[c+1]=l.y,this.edgeSideMeshInfo.normalArray[c+2]=l.z}this.fillUV()},t.prototype.fillUV=function(){var e,t,r,i,n=0;this.rightResource.isDefault?(e=this.startUVPercent[0],t=this.startUVPercent[1],r=this.endUVPercent[0],i=this.endUVPercent[1]):(e=this.startUVPercent[0]*this.repeatUV[0],t=this.startUVPercent[1]*this.repeatUV[1],r=this.endUVPercent[0]*this.repeatUV[0],i=this.endUVPercent[1]*this.repeatUV[1]);o=this.rightSideMeshInfo.uvArray;o[n++]=e,o[n++]=i,o[n++]=r,o[n++]=i,o[n++]=r,o[n++]=t,o[n++]=e,o[n++]=i,o[n++]=r,o[n++]=t,o[n++]=e,o[n++]=t,this.leftResource.isDefault?(e=this.startUVPercent[2],t=this.startUVPercent[3],r=this.endUVPercent[2],i=this.endUVPercent[3]):(e=this.startUVPercent[2]*this.repeatUV[2],t=this.startUVPercent[3]*this.repeatUV[3],r=this.endUVPercent[2]*this.repeatUV[2],i=this.endUVPercent[3]*this.repeatUV[3]),n=0;(o=this.leftSideMeshInfo.uvArray)[n++]=r,o[n++]=i,o[n++]=e,o[n++]=i,o[n++]=e,o[n++]=t,o[n++]=r,o[n++]=i,o[n++]=e,o[n++]=t,o[n++]=r,o[n++]=t,n=0;var o;(o=this.edgeSideMeshInfo.uvArray)[n++]=0,o[n++]=1,o[n++]=1,o[n++]=1,o[n++]=1,o[n++]=0,o[n++]=0,o[n++]=1,o[n++]=1,o[n++]=0,o[n++]=0,o[n++]=0,o[n++]=0,o[n++]=1,o[n++]=1,o[n++]=1,o[n++]=1,o[n++]=0,o[n++]=0,o[n++]=1,o[n++]=1,o[n++]=0,o[n++]=0,o[n++]=0,o[n++]=0,o[n++]=1,o[n++]=1,o[n++]=1,o[n++]=0,o[n++]=0,o[n++]=1,o[n++]=1,o[n++]=1,o[n++]=0,o[n++]=0,o[n++]=0,o[n++]=0,o[n++]=1,o[n++]=1,o[n++]=1,o[n++]=0,o[n++]=0,o[n++]=0,o[n++]=1,o[n++]=1,o[n++]=1,o[n++]=0,o[n++]=0,this.lightMapResource&&(e=this.startUVPercent[0],t=this.startUVPercent[1],r=this.endUVPercent[0],i=this.endUVPercent[1],n=0,(o=this.rightSideMeshInfo.uv2Array)[n++]=e,o[n++]=i,o[n++]=r,o[n++]=i,o[n++]=r,o[n++]=t,o[n++]=e,o[n++]=i,o[n++]=r,o[n++]=t,o[n++]=e,o[n++]=t,n=0,(o=this.leftSideMeshInfo.uv2Array)[n++]=r,o[n++]=i,o[n++]=e,o[n++]=i,o[n++]=e,o[n++]=t,o[n++]=r,o[n++]=i,o[n++]=e,o[n++]=t,o[n++]=r,o[n++]=t)},t.prototype.getWallOtherCorner=function(e){return this.startCorner===e?this.endCorner:this.endCorner===e?this.startCorner:null},t.prototype.createMesh=function(e){var t=new THREE.BufferGeometry;t.addAttribute("position",new THREE.BufferAttribute(e.positionArray,3)),t.addAttribute("normal",new THREE.BufferAttribute(e.normalArray,3)),t.addAttribute("uv",new THREE.BufferAttribute(e.uvArray,2));var r=e.material;this.lightMapResource&&e.uv2Array&&this.enableLightMap&&t.addAttribute("uv2",new THREE.BufferAttribute(e.uv2Array,2)),e.material=r;return new THREE.Mesh(t,r)},Gn(t,[{key:"position",get:function(){var e=this.startCorner.position,t=this.endCorner.position,r=new THREE.Vector3;return r.addVectors(e,t),r.divideScalar(2),r},set:function(e){}}]),t}(Zn),to=function(e){function t(){return qn(this,t),Xn(this,e.call(this))}return Wn(t,e),t.prototype.build=function(){if(this.baseBuild(),this.calPosInfo(),this.calBasePoints(),this.fillMesh(),this.initMaterial(),!this.enableDelayLoadMode){var e=this.position,t=new THREE.Group("wall");t.add(this.createMesh(this.leftSideMeshInfo)),t.add(this.createMesh(this.rightSideMeshInfo)),t.add(this.createMesh(this.edgeSideMeshInfo)),t.position.set(e.x,e.y,e.z),this.wallGroup=t,this.mesh=this.wallGroup}this.isBuilded=!0},t}(eo),ro=function(e){function t(r,i,n){qn(this,t);var o=Xn(this,e.call(this));return o.walls=[],o.position=new THREE.Vector3(r,i,n),o}return Wn(t,e),t.prototype.addWall=function(e){for(var t=0,r=this.walls.length;t<r;t++)if(this.walls[t]===e)return void console.error("repeat wall"+e);this.walls.push(e)},t.prototype.build=function(){this.calVertices()},t.prototype.isFirstWallShouldNotCal=function(e){return!(e instanceof no)||e instanceof to},t.prototype.isSecondWallShouldNotCal=function(e){return null!=e&&(e.resource&&e.resource.isModel||e instanceof to)},t.prototype.calVertices=function(){var e=this.walls,t=new THREE.Vector3(0,1,0);if(1===e.length){var r=e[0];r instanceof no&&this.setDefaultCornerVertices(r)}else{this.sortWalls();for(var i=0;i<e.length;i++){var n=e[i];if(!this.isFirstWallShouldNotCal(n)){for(var o=null,a=i;null==o&&(a===e.length-1?a=0:a+=1,e[a]!==n);)o=e[a],this.isSecondWallShouldNotCal(o)&&(o=null);if(o){var s=n.getWallOtherCorner(this).position,l=new THREE.Vector3;l.subVectors(s,this.position),s=o.getWallOtherCorner(this).position;var c=new THREE.Vector3;if(c.subVectors(s,this.position),l.normalize(),c.normalize(),0!==l.length()&&0!==c.length()){var u=n.thick/2,h=new THREE.Vector3;h.crossVectors(t,l),h.normalize();var p=h.clone();p.multiplyScalar(u),p.add(this.position),u=o.thick/2;var d=c.clone();d.cross(t),d.normalize();var f=d.clone();f.multiplyScalar(u),f.add(this.position),this.setCornersVertices(n,p,!0),this.setCornersVertices(o,f,!1),l.normalize(),c.normalize();if(this.calAngle(l,c)>30){var m;if(1===Math.abs(l.dot(c))){var g=l.clone();g.cross(t),g.normalize(),this.setDefaultCornerVertices(n,!0),this.setDefaultCornerVertices(o,!0);continue}if(0!==(m=this.getIntersectPosition(p,l,f,c)).x||0!==m.y||0!==m.z){m.clone().y=this.position.y+this.getWallHeight(),this.setCornersVertices(n,m,!0),this.setCornersVertices(o,m,!1)}}else this.setCornersVertices(n,p,!0),this.setCornersVertices(o,f,!1)}else this.setDefaultCornerVertices(n,!0),this.setDefaultCornerVertices(o,!1)}else this.setDefaultCornerVertices(n)}}}},t.prototype.sortWalls=function(){var e=this.walls;if(e.length>1)for(var t,r,i=e[0],n=0,o=e.length-1;n<o;){for(r=n;r<o;++r)this.angleBetween(i,e[r])>this.angleBetween(i,e[r+1])&&(t=e[r],e[r]=e[r+1],e[r+1]=t);for(r=--o;r>n;--r)this.angleBetween(i,e[r])<this.angleBetween(i,e[r-1])&&(t=e[r],e[r]=e[r-1],e[r-1]=t);++n}},t.prototype.angleBetween=function(e,t){var r=e.getWallOtherCorner(this).position.clone();r.sub(this.position);var i=t.getWallOtherCorner(this).position.clone();return i.sub(this.position),this.calAngle(r,i)},t.prototype.calAngle=function(e,t){e.normalize(),t.normalize();var r=e.angleTo(t);r*=180/Math.PI;var i=e.clone();return i.cross(t),i.y<0&&(r=360-r),r},t.prototype.getWallHeight=function(){for(var e=99999,t=0;t<this.walls.length;t++){var r=this.walls[t];e>r.height&&(e=r.height)}return e},t.prototype.setCornersVertices=function(e,t,r){var i=new THREE.Vector3(0,0,0);i.x=t.x-e.position.x,i.y=t.y-e.position.y,i.z=t.z-e.position.z,e.startCorner===this?r?(e.cornersVertices[0].x=i.x,e.cornersVertices[0].y=i.y,e.cornersVertices[0].z=i.z):(e.cornersVertices[1].x=i.x,e.cornersVertices[1].y=i.y,e.cornersVertices[1].z=i.z):r?(e.cornersVertices[2].x=i.x,e.cornersVertices[2].y=i.y,e.cornersVertices[2].z=i.z):(e.cornersVertices[3].x=i.x,e.cornersVertices[3].y=i.y,e.cornersVertices[3].z=i.z)},t.prototype.setDefaultCornerVertices=function(e,t){var r=new THREE.Vector3(0,1,0),i=e.getWallOtherCorner(this).position.clone();i.sub(this.position),i.normalize();var n=e.thick/2,o=r.clone();o.cross(i),o.normalize(),o.multiplyScalar(n);var a=new THREE.Vector3;a.addVectors(this.position,o);var s=new THREE.Vector3;s.subVectors(this.position,o),void 0===t?(this.setCornersVertices(e,a,!0),this.setCornersVertices(e,s,!1)):t?this.setCornersVertices(e,a,!0):this.setCornersVertices(e,s,!1)},t.prototype.getIntersectPosition=function(e,t,r,i){if(e.x===r.x&&e.y===r.y&&e.z===r.z)return e;var n=e.y;if(1===t.dot(i))throw"two line in same direction ,can not cal intersected position!";var o=new THREE.Vector3,a=new THREE.Vector3;o.addVectors(e,t),a.addVectors(r,i);var s=new THREE.Vector2(e.x,e.z),l=new THREE.Vector2(o.x,o.z),c=new THREE.Vector2(r.x,r.z),u=new THREE.Vector2(a.x,a.z),h=(l.y-s.y)*(u.x-c.x)-(s.x-l.x)*(c.y-u.y);if(0==h)return new THREE.Vector3;var p=((l.x-s.x)*(u.x-c.x)*(c.y-s.y)+(l.y-s.y)*(u.x-c.x)*s.x-(u.y-c.y)*(l.x-s.x)*c.x)/h,d=-((l.y-s.y)*(u.y-c.y)*(c.x-s.x)+(l.x-s.x)*(u.y-c.y)*s.y-(u.x-c.x)*(l.y-s.y)*c.y)/h;return new THREE.Vector3(p,n,d)},t}(Kn),io=function(e){function t(){return qn(this,t),Xn(this,e.call(this))}return Wn(t,e),t.createSubWallCorner=function(e,r,i){var n=new t;return n.id=e,n.position=r,n.parent=i.parent,n},t.prototype.isFirstWallShouldNotCal=function(e){return!(e instanceof to)},t.prototype.isSecondWallShouldNotCal=function(e){return e&&!(e instanceof to)},t}(ro),no=function(e){function t(){return qn(this,t),Xn(this,e.call(this))}return Wn(t,e),t.prototype.initSimpleCornersAndWalls=function(){var e=this.position;(new THREE.Vector3).crossVectors(this.direction,this.vectorUp);for(var t=this.sortDoorOrWins(),r=0;r<t.length;r++){var i=t[r],n=this.getDoorOrWinStartAndEndPos(i),o=this.getDoorOrWinRectPoints(i),a=io.createSubWallCorner(this.id+"_"+r+"_1",n[0],this),s=io.createSubWallCorner(this.id+"_"+r+"_2",n[1],this);if(this.addSubWallCorner(a),this.addSubWallCorner(s),0===r){var l=new to;this.subWalls.push(l),l.startCorner=this.startCorner,l.endCorner=a,l.startCorner.build(),l.endCorner.build(),this.setCornerVertices(l,!0),l.calPosInfo(),l.calEachSideLen(),l.endUVPercent[0]=l.rightSideLength/this.rightSideLength,l.endUVPercent[2]=l.leftSideLength/this.leftSideLength,l.repeatUV=this.repeatUV,l.leftResource=this.leftResource,l.rightResource=this.rightResource,l.edgeResource=this.edgeResource,l.lightMapResource=this.lightMapResource,l.height=this.height,l.parentWall=this}else{var c=t[r-1],u=this.getDoorOrWinStartAndEndPos(c),h=this.getDoorOrWinRectPoints(c),p=this.getWallCornerByPos(u[1]),d=new to;this.subWalls.push(d),d.startCorner=p,d.endCorner=a;var f=new THREE.Vector3;f.subVectors(p.position,a.position);var m=f.length();d.startCorner.build(),d.endCorner.build(),d.calPosInfo(),d.calEachSideLen();var g=h[3].distanceTo(e.clone().addVectors(this.cornersVertices[0],e)),v=h[2].distanceTo(e.clone().addVectors(this.cornersVertices[1],e));d.startUVPercent[0]=g/this.rightSideLength,d.startUVPercent[2]=v/this.leftSideLength,d.endUVPercent[0]=(g+m)/this.rightSideLength,d.endUVPercent[2]=(v+m)/this.leftSideLength,d.repeatUV=this.repeatUV,d.leftResource=this.leftResource,d.rightResource=this.rightResource,d.edgeResource=this.edgeResource,d.lightMapResource=this.lightMapResource,d.height=this.height,d.parentWall=this}if(r==t.length-1){var y=new to;this.subWalls.push(y),y.startCorner=s,y.endCorner=this.endCorner,y.startCorner.build(),this.setCornerVertices(y,!1),y.calPosInfo(),y.calEachSideLen();var g=o[3].distanceTo(e.clone().addVectors(this.cornersVertices[0],e)),v=o[2].distanceTo(e.clone().addVectors(this.cornersVertices[1],e));y.startUVPercent[0]=g/this.rightSideLength,y.startUVPercent[2]=v/this.leftSideLength,y.repeatUV=this.repeatUV,y.leftResource=this.leftResource,y.rightResource=this.rightResource,y.edgeResource=this.edgeResource,y.lightMapResource=this.lightMapResource,y.height=this.height,y.parentWall=this}this.buildHeadAndFootWall(i,a,s)}},t.prototype.buildSimpleCornersAndWalls=function(){this.enableDelayLoadMode||(this.wallGroup=new THREE.Object3D);for(e=0;e<this.subCorners.length;e++){this.subCorners[e].build()}for(var e=0;e<this.subWalls.length;e++){var t=this.subWalls[e];t.build(),this.enableDelayLoadMode||this.wallGroup.add(t.wallGroup)}this.mesh=this.wallGroup},t.prototype.buildHeadAndFootWall=function(e,t,r){var i=this.position,n=this.getDoorOrWinRectPoints(e),o=n[0].distanceTo(i.clone().addVectors(this.cornersVertices[0],i)),a=n[1].distanceTo(i.clone().addVectors(this.cornersVertices[1],i)),s=e.suspendPercent;(new THREE.Vector3).crossVectors(this.direction,this.vectorUp);var l=e.size.y+this.height*s;if(0!==e.suspendPercent){var c=new to;this.subWalls.push(c),c.parent=this.parent,c.startCorner=t,c.endCorner=r;(h=new THREE.Vector3).subVectors(r.position,t.position);p=h.length();c.height=this.height*s,c.startUVPercent=[o/this.rightSideLength,0,a/this.leftSideLength,0],c.endUVPercent[0]=(o+p)/this.rightSideLength,c.endUVPercent[1]=c.height/this.height,c.endUVPercent[2]=(a+p)/this.leftSideLength,c.endUVPercent[3]=c.height/this.height,c.uvMultiple=this.uvMultiple,c.repeatUV=this.repeatUV,c.leftResource=this.leftResource,c.rightResource=this.rightResource,c.edgeResource=this.edgeResource,c.lightMapResource=this.lightMapResource,c.parentWall=this}if(l<this.height){var u=new to;this.subWalls.push(u),u.parent=this.parent,u.startCorner=t,u.endCorner=r;var h=new THREE.Vector3;h.subVectors(r.position,t.position);var p=h.length();u.suspend=l,u.height=this.height-l,u.startUVPercent=[o/this.rightSideLength,l/this.height,a/this.leftSideLength,l/this.height],u.endUVPercent[0]=(o+p)/this.rightSideLength,u.endUVPercent[2]=(a+p)/this.leftSideLength,u.uvMultiple=this.uvMultiple,u.repeatUV=this.repeatUV,u.leftResource=this.leftResource,u.rightResource=this.rightResource,u.edgeResource=this.edgeResource,u.lightMapResource=this.lightMapResource,u.parentWall=this}},t.prototype.setCornerVertices=function(e,t){if(t){(r=new THREE.Vector3).addVectors(this.cornersVertices[0],this.position),r.sub(e.position);(i=new THREE.Vector3).addVectors(this.cornersVertices[1],this.position),i.sub(e.position),e.cornersVertices[0]=r,e.cornersVertices[1]=i}else{var r=new THREE.Vector3;r.addVectors(this.cornersVertices[2],this.position),r.sub(e.position);var i=new THREE.Vector3;i.addVectors(this.cornersVertices[3],this.position),i.sub(e.position),e.cornersVertices[2]=r,e.cornersVertices[3]=i}},t.prototype.getDoorOrWinRectPoints=function(e){var t=this.thick/2,r=new THREE.Vector3;r.crossVectors(this.vectorUp,this.direction),r.normalize();var i=r.clone();i.negate();this.vectorUp.clone().multiplyScalar(t);var n=e.size,o=this.direction,a=e.position,s=n.x/2,l=new THREE.Vector3,c=new THREE.Vector3;l.subVectors(a,o.clone().multiplyScalar(s)),c.addVectors(a,o.clone().multiplyScalar(s));return[l.clone().addVectors(l,r.clone().multiplyScalar(t)),l.clone().addVectors(l,i.clone().multiplyScalar(t)),c.clone().addVectors(c,i.clone().multiplyScalar(t)),c.clone().addVectors(c,r.clone().multiplyScalar(t))]},t}(eo),oo=function(e){function t(r){qn(this,t);var i=Xn(this,e.call(this));return i.mesh=null,i.shapePath=null,i.holePaths=null,i.room=r,i.isDoubleSide=!1,i.texture=Qn.floorTexture,i.enableLightMap=Jn.enableFloorLightMap,i.material=null,i.geometry=null,i.resource=null,i.height=null,i.blockSize=null,i}return Wn(t,e),t.prototype.resourceCallback=function(e){this.texture=e.texture,this.mesh&&(this.mesh.material.map=this.texture,this.mesh.material.needsUpdate=!0)},t.prototype.initResource=function(){var e=this.room.floorResource;e&&(e.ready?(this.texture=e.texture,this.material=e.material):(!Jn.enableCombine||this.room.userID||this.room.name||this.room.properties)&&e.registerListener(this)),this.room.lightMapResource&&this.enableLightMap&&(this.material=e,this.material.aoMap=this.room.lightMapResource.texture)},t.prototype.build=function(){this.enableDelayLoadMode||this.initResource(),4===this.shapePath.length&&0===this.holePaths.length||(this.enableLightMap=!1);for(var e=new THREE.Vector3,t=0;t<this.shapePath.length;t++){var r=this.shapePath[t];e.x+=r.x,e.z+=r.y}e.x/=this.shapePath.length,e.z/=this.shapePath.length;var i=new THREE.Shape(this.shapePath);if(this.holePaths)for(t=0;t<this.holePaths.length;t++){var n=this.holePaths[t];i.holes.push(new THREE.Path(n))}var o=new THREE.ShapeGeometry(i);if(this.blockSize)for(t=0;t<o.faceVertexUvs.length;t++)for(var a=o.faceVertexUvs[t],s=0;s<a.length;s++)for(var l=a[s],c=0;c<l.length;c++){var u=l[c];u.set(u.x/this.blockSize.x,u.y/this.blockSize.y)}o.uvsNeedUpdate=!0,this.geometry=o;var h=null;if(this.room.lightMapResource&&this.enableLightMap){var p=this.room.floorResource;void 0===p.floorLightMaterial&&(p.floorLightMaterial=new THREE.MeshBasicMaterial({map:p.texture})),this.material=p.floorLightMaterial,this.material.aoMap=this.room.lightMapResource.texture,this.calLightMapUV(o),h=this.material,null===this.height&&(this.height=.01)}else h=this.room.floorResource.roomMaterial;var d=0;if(this.height&&(d=this.height),this.height=d,h.side=THREE.DoubleSide,void 0===h&&console.error("floor material is null"),this.mesh=new THREE.Mesh(o,h),this.mesh.name="floor",this.mesh.position.y=d,this.mesh.rotateX(-Math.PI/2),this.room.center){e=this.room.center;this.mesh.position.set(e.x,0,e.z)}this.mesh.visible=this.isShow},t.prototype.calLightMapUV=function(e){var t=e.faceVertexUvs;t[1]=[];for(var r,i,n,o,a=0;a<t.length;a++)for(var s=t[a],l=0;l<s.length;l++)for(var c=s[l],u=0;u<c.length;u++){f=c[u];void 0!==r?(f.x>r&&(r=f.x),f.x<n&&(n=f.x),f.y>i&&(i=f.y),f.y<o&&(o=f.y)):(r=f.x,i=f.y,n=f.x,o=f.y)}for(var h=t[0],p=[],l=0;l<h.length;l++){for(var c=h[l],d=[],u=0;u<c.length;u++){var f=c[u],m=new THREE.Vector2,g=f.x===r?1:0,v=f.y===i?1:0;m.set(g,v),d.push(m)}p.push(d)}t[1]=p},t.prototype.reCalUV=function(e){for(var t,r,i,n,o=e.faceVertexUvs,a=0;a<o.length;a++)for(var s=o[a],l=0;l<s.length;l++)for(var c=s[l],u=0;u<c.length;u++){v=c[u];void 0!==t?(v.x>t&&(t=v.x),v.x<i&&(i=v.x),v.y>r&&(r=v.y),v.y<n&&(n=v.y)):(t=v.x,r=v.y,i=v.x,n=v.y)}var h=Math.abs(i),p=Math.abs(n);t+=h,r+=p;for(var d=[],a=0;a<o.length;a++){for(var f=o[a],m=[],l=0;l<f.length;l++){for(var c=f[l],g=[],u=0;u<c.length;u++){var v=c[u],y=new THREE.Vector2;y.set((v.x+h)/t,(v.y+p)/r),g.push(y)}m.push(g)}d.push(m)}return d},t}(Kn),ao=function(e){function t(r){qn(this,t);var i=Xn(this,e.call(this));return i.mesh=null,i.shapePath=[],i.holePaths=null,i.center=null,i.room=r,i.material=null,i.geometry=null,i.resource=null,i.height=null,i.blockSize=null,i}return Wn(t,e),t.prototype.initResource=function(){var e=this.room.floorResource;e&&(e.ready?(this.texture=e.texture,this.material=e.material):(!Jn.enableCombine||this.room.userID||this.room.name||this.room.properties)&&e.registerListener(this))},t.prototype.resourceCallback=function(e){this.texture=e.texture,this.mesh&&(this.mesh.material.map=this.texture,this.mesh.material.needsUpdate=!0)},t.prototype.build=function(){this.enableDelayLoadMode||this.initResource();var e=new THREE.Shape(this.shapePath);if(this.holePaths)for(i=0;i<this.holePaths.length;i++){var t=this.holePaths[i];e.holes.push(new THREE.Path(t))}var r=new THREE.ShapeGeometry(e);if(this.material=this.room.ceilingResource.roomMaterial,this.geometry=r,this.blockSize)for(var i=0;i<r.faceVertexUvs.length;i++)for(var n=r.faceVertexUvs[i],o=0;o<n.length;o++)for(var a=n[o],s=0;s<a.length;s++){var l=a[s];l.set(l.x/this.blockSize.x,l.y/this.blockSize.y)}r.uvsNeedUpdate=!0;var c=null;c=this.room.ceilingResource.roomMaterial,this.mesh=new THREE.Mesh(r,c),this.mesh.name="ceiling",this.mesh.rotateX(Math.PI/2);var u=3;if(this.room.parent&&(u=this.room.parent.height),this.heigth&&(u=this.heigth),this.height=u,this.mesh.position.y=u,this.mesh.updateMatrixWorld(),this.room.center){var h=this.room.center;this.mesh.position.set(h.x,3,h.z)}this.mesh.visible=this.isShow},t}(Kn),so=function(e){function t(r){qn(this,t);var i=Xn(this,e.call(this));return i.mesh=null,i.shapePath=[],i.holePaths=null,i.center=null,i.room=r,i.material=null,i.geometry=null,i.resource=null,i.height=null,i.blockSize=null,i}return Wn(t,e),t.prototype.resourceCallback=function(e){this.texture=e.texture,this.mesh&&(this.mesh.material.map=this.texture,this.mesh.material.needsUpdate=!0)},t.prototype.initResource=function(){var e=this.room.floorResource;e&&(e.ready?(this.texture=e.texture,this.material=e.material):(!Jn.enableCombine||this.room.userID||this.room.name||this.room.properties)&&e.registerListener(this))},t.prototype.build=function(){this.enableDelayLoadMode||this.initResource();var e=new THREE.Shape(this.shapePath);if(this.holePaths)for(i=0;i<this.holePaths.length;i++){var t=this.holePaths[i];e.holes.push(new THREE.Path(t))}var r=new THREE.ShapeGeometry(e);if(this.geometry=r,this.material=this.room.roofResource.roomMaterial,this.blockSize)for(var i=0;i<r.faceVertexUvs.length;i++)for(var n=r.faceVertexUvs[i],o=0;o<n.length;o++)for(var a=n[o],s=0;s<a.length;s++){var l=a[s];l.set(l.x/this.blockSize.x,l.y/this.blockSize.y)}r.uvsNeedUpdate=!0;var c=null;c=this.room.roofResource.roomMaterial,this.mesh=new THREE.Mesh(r,c);var u=3;if(this.room.parent&&(u=this.room.parent.height),this.height&&(u=this.height),this.height=u,this.mesh.position.y=u+.01,this.mesh.name="roof",this.mesh.rotateX(-Math.PI/2),this.room.center){var h=this.room.center;this.mesh.position.set(h.x,this.height,h.z)}this.mesh.updateMatrixWorld(),this.mesh.visible=this.isShow,this.mesh.name="roof"+this.id},t}(Kn),lo=function(e){function t(r){qn(this,t);var i=Xn(this,e.call(this));return i.dataJson=r,i.shapePath=[],i.reverseZShapPath=[],i.holePaths=[],i.reverseZHolePaths=[],i._points=[],i._holes=[],i.center=null,i.meshGroup=null,i.mesh=null,i.offset=null,i.parentPosition=null,i.position=null,i.floor=new oo(i),i.roof=new so(i),i.ceiling=new ao(i),i.floorResource=null,i.ceilingResource=null,i.roofResource=null,i.lightMapResource=null,i.isOnlyFloor=!1,i}return Wn(t,e),t.prototype.build=function(){if(this.floor.shapePath=this.reverseZShapPath,this.ceiling.shapePath=this.shapePath,this.roof.shapePath=this.reverseZShapPath,this.floor.holePaths=this.reverseZHolePaths,this.ceiling.holePaths=this.holePaths,this.roof.holePaths=this.reverseZHolePaths,this.parentPosition&&this.offset){var e=new THREE.Vector3;e.add(this.parentPosition),e.add(this.offset),this.center=e}else this.center=null;this.isOnlyFloor?(this.floor.build(),this.meshGroup=new THREE.Object3D("room"),this.meshGroup.add(this.floor.mesh)):(this.floor.build(),this.ceiling.build(),this.roof.build(),this.meshGroup=new THREE.Object3D("room"),this.meshGroup.add(this.floor.mesh),this.meshGroup.add(this.ceiling.mesh),this.meshGroup.add(this.roof.mesh)),this.mesh=this.meshGroup},Gn(t,[{key:"points",set:function(e){this.shapePath=[],this._points=[];for(var t=0,r=0,i=0,n=e.length,o=0;o<n;o++){var a=e[o],s=a.clone();t+=a.x,r+=a.y,i+=a.z,this._points.push(s),this.shapePath.push(new THREE.Vector2(s.x,s.z)),this.reverseZShapPath.push(new THREE.Vector2(s.x,-s.z))}this.position=new THREE.Vector3(t/n,r/n,i/n)},get:function(){return this._points}},{key:"holes",set:function(e){this._holes=[],this.holePaths=[],this.reverseZHolePaths=[];for(var t=e.length,r=0;r<t;r++){for(var i=e[r],n=i.length,o=[],a=[],s=[],l=0;l<n;l++){var c=i[l],u=c.clone();c.x,c.y,c.z,o.push(u),a.push(new THREE.Vector2(u.x,u.z)),s.push(new THREE.Vector2(u.x,-u.z))}this.holePaths.push(a),this.reverseZHolePaths.push(s),this._holes.push(o)}},get:function(){return this._holes}}]),t}(Kn),co=function(e){function t(){qn(this,t);var r=Xn(this,e.call(this));return r.walls=[],r.corners=[],r.rooms=[],r.placements=[],r.videoprobes=[],r.curvelines=[],r.pipelines=[],r.text3Ds=[],r.groups=[],r.height=3,r.uncombineWithHeigthRooms=[],r.combinePlacements=[],r.combineStraightManualWalls=[],r.combineModelWalls=[],r.combineRoofs=[],r.combineCeilings=[],r.combineFloors=[],r.combineDoorOrWins=[],r.curPlacementCombineProcessorMap=new Map,r.curStraightManualWallCombineProcessorMap=new Map,r.curModelWallCombineProcessorMap=new Map,r.curFloorCombineProcessorMap=new Map,r.curCeilingCombineProcessorMap=new Map,r.curRoofCombineProcessorMap=new Map,r.curDoorOrWinCombineProcessorMap=new Map,r.curGroupCombineProcessorMap=new Map,r.groupCombineProcessors=[],r.placementCombineProcessors=[],r.straightManualWallCombineProcessors=[],r.modelWallCombineProcessors=[],r.floorCombineProcessors=[],r.ceilingCombineProcessors=[],r.roofCombineProcessors=[],r.doorOrWindowCombineProcessors=[],r}return Wn(t,e),t.prototype.build=function(){for(i=0;i<this.corners.length;i++){this.corners[i].build()}for(i=0;i<this.walls.length;i++){(t=this.walls[i]).build();for(var e=0;e<t.doorOrWindows.length;e++){t.doorOrWindows[e].build()}}for(i=0;i<this.walls.length;i++){var t=this.walls[i];t.doorOrWindows.length>0&&(t.initSimpleCornersAndWalls(),t.buildSimpleCornersAndWalls())}for(i=0;i<this.rooms.length;i++){this.rooms[i].build()}for(i=0;i<this.placements.length;i++){(r=this.placements[i]).build()}for(i=0;i<this.videoprobes.length;i++){var r=this.videoprobes[i];r.build()}for(i=0;i<this.groups.length;i++){this.groups[i].build()}for(var i=0;i<this.text3Ds.length;i++){this.text3Ds[i].build()}},t.prototype.existsCorner=function(e,t,r){for(var i=0,n=this.corners.length;i<n;i++){var o=this.corners[i].position;if(o.x===e&&o.y===t&&o.z===r)return!0}return!1},t.prototype.addCorner=function(e,t,r){var i=new ro(e,t,r);return this.corners.push(i),i.parent=this,i},t.prototype.addWall=function(e){this.walls.push(e)},t.prototype.getCorner=function(e,t,r){for(var i=0,n=this.corners.length;i<n;i++){var o=this.corners[i].position;if(o.x===e&&o.y===t&&o.z===r)return this.corners[i]}return null},t.prototype.exportTestXS=function(){for(var e={points:[],edges:[]},t=[],r=[],i=0;i<this.corners.length;i++){var n=this.corners[i];t.push([n.position.x,n.position.z])}for(i=0;i<this.walls.length;i++){var o=this.walls[i];r.push([this.corners.indexOf(o.startCorner),this.corners.indexOf(o.endCorner)])}return e.points=t,e.edges=r,e},t}(Kn),uo=function(e){function t(){qn(this,t);var r=Xn(this,e.call(this));return r.resource=null,r.mesh=null,r.model=null,r.customColor=null,r.opacity=null,r.renderMode=null,r.delayObject=new THREE.Object3D,r.initCompleteCallback=null,r.customTextureResource=null,r.hasSkin=!1,r.isPlayAnim=!1,r.animClip=null,r}return Wn(t,e),t.prototype.build=function(){this.enableDelayLoadMode||(this.initResource(),null!==this.model&&this.instanceModel())},t.prototype.initResource=function(){this.resource&&(this.resource.ready?this.model=this.resource.model:this.resource.registerListener(this))},t.prototype.resourceCallback=function(e){this.mesh||(this.model=e.model,this.instanceModel(),this.initCompleteCallback&&this.initCompleteCallback(this))},t.prototype.instanceModel=function(){null!==this.model&&(this.mesh=$n.clone(this.model),this.hasSkin=this.mesh.hasSkin,this.mesh.name="placement",this.mesh.position.set(this.position.x,this.position.y,this.position.z),this.mesh.quaternion.set(this.rotation.x,this.rotation.y,this.rotation.z,this.rotation.w),this.mesh.scale.set(this.scale.x,this.scale.y,this.scale.z),this.mesh.visible=this.isShow,this.mesh.name="plc"+this.id,null!==this.renderMode&&this.changeRenderMode(this.mesh),this.customTextureResource&&this.changeWithCustomTexture(this.mesh),this.customColor&&this.changeWithCustomColor(this.mesh),this.delayObject.add(this.mesh))},t.prototype.changeRenderMode=function(e){if(e instanceof THREE.Mesh&&(e.material.color=this.customColor,null!==this.renderMode))switch(this.renderMode){case 1:e.material.transparent=!1,e.material.alphaTest=.5;break;case 3:case 2:e.material.transparent=!0;break;default:console.error("can not find renderMode "+this.renderMode)}for(var t=0;t<e.children.length;t++){var r=e.children[t];this.changeRenderMode(r)}},t.prototype.changeWithCustomColor=function(e){e instanceof THREE.Mesh&&(e.material.color=this.customColor,null!==this.opacity&&(e.material.opacity=this.opacity,e.material.transparent=!0));for(var t=0;t<e.children.length;t++){var r=e.children[t];this.changeWithCustomColor(r)}},t.prototype.changeWithCustomTexture=function(e){e instanceof THREE.Mesh&&(e.material.map=this.customTextureResource.texture);for(var t=0;t<e.children.length;t++){var r=e.children[t];this.changeWithCustomTexture(r)}},t}(Kn),ho=function(e){function t(){qn(this,t);var r=Xn(this,e.call(this));return r.suspendPercent=0,r.size=new THREE.Vector3(1,1,1),r.attachWall=null,r.isOpen=!1,r.modelSize=null,r}return Wn(t,e),t.prototype.build=function(){if(this.attachWall){var t=this.attachWall.direction;this.rotation.setFromUnitVectors(new THREE.Vector3(1,0,0),t),this.position.y=this.attachWall.height*this.suspendPercent}if(e.prototype.build.call(this),this.model){var r=new THREE.Box3;r.makeEmpty(),r=r.setFromObject(this.model),this.modelSize=r.getSize()}else this.resource&&(this.modelSize=this.resource.modelSize);(this.model||this.resource)&&this.size.set(this.modelSize.x*this.scale.x,this.modelSize.y*this.scale.y,this.modelSize.z*this.scale.z)},t}(uo),po=function(){function e(t){qn(this,e),this.bundeObj=t,this.materialMap=new Map,this.combineBundleMeshs=[],this.vertexCount=0}return e.prototype.combine=function(){this._combine(this.bundeObj,[],[],[])},e.prototype._combine=function(e,t,r,i){if(t.push(e.scale),i.push(e.position),r.push(e.quaternion),e instanceof THREE.Mesh){var n=new function e(t,r,i,n){qn(this,e),this.positionArray=t.geometry.getAttribute("position").array.slice();var o=t.geometry.getAttribute("normal");o?this.normalArray=o.array.slice():console.warn("not has normal");var a=t.geometry.getAttribute("uv");a&&(this.uvArray=a.array);var s=t.geometry.getAttribute("uv2");s&&(this.uv2Array=s.array);var l=t.geometry.getAttribute("uv3");l&&(this.uv3Array=l.array);var c=t.geometry.getAttribute("color");c&&(this.colorArray=c.array),this.indexArray=t.geometry.index.array,this.material=t.material;for(var u=this.positionArray,h=this.normalArray,p=0;p<u.length;){for(var d=n.length-1;d>-1;d--){var f=r[d],m=i[d],g=n[d];u[p]*=f.x,u[p+1]*=f.y,u[p+2]*=f.z;var v=new THREE.Vector3(u[p],u[p+1],u[p+2]);if(v=v.applyQuaternion(m),v.x+=g.x,v.y+=g.y,v.z+=g.z,u[p]=v.x,u[p+1]=v.y,u[p+2]=v.z,h){var y=new THREE.Vector3(h[p],h[p+1],h[p+2]);y=y.applyQuaternion(m),h[p]=y.x,h[p+1]=y.y,h[p+2]=y.z}}p+=3}this.vertexCount=this.positionArray.length/3,this.indexCount=this.indexArray.length,this.groups=t.geometry.groups}(e,t,r,i);0!==n.vertexCount&&(this.combineBundleMeshs.push(n),void 0===this.materialMap.get(n.material)&&this.materialMap.set(n.material,[]),this.materialMap.get(n.material).push(n)),this.vertexCount+=n.vertexCount}if(0!==e.children.length)for(var o=0;o<e.children.length;o++){var a=r.slice(),s=t.slice(),l=i.slice();this._combine(e.children[o],s,a,l)}},e}(),fo=function(){function e(t){qn(this,e),this.url=null,this.isEmpty=!1,this.callbackObjects=[],this.ready=!1,this.texture=null,this.model=null,this.modelName=null,this.modelID=null,this.material=new THREE.MeshStandardMaterial,this.wallMaterial=new THREE.MeshStandardMaterial({color:16777215}),this.roomMaterial=new THREE.MeshLambertMaterial({color:15658734}),this.id=null,this.ext=null,this.baseUrl=null,this.version=null,this.isDefault=!1,this.animations=null,this.isCombine=!1,this.combineBundleObj=null,this.manager=t,this.modelSize=null,this.hasAnim=!1,this.animations=null,this.tryHightedtVersion=!1,this.debug=!1,this.gltfRoot=null}return e.prototype.registerListener=function(e){this.callbackObjects.push(e)},e.prototype.combine=function(){this.model&&(this.combineBundleObj=new po(this.model),this.combineBundleObj.combine(),this.combineBundleObj.vertexCount>=6e4?(this.isCombine=!1,console.error("combine "+this.id+" exceed max vectex")):this.isCombine=!0)},e.prototype.getTextureUrl=function(){return this.baseUrl+this.id+"."+(null===this.ext?"jpg":this.ext)},e.prototype.getModelUrl=function(){return this.baseUrl+this.id+"/"+this.version+"/gltf/"},e.prototype.downloadTexture=function(e){var t=this,r=new THREE.TextureLoader;r.setCrossOrigin("anonymous");var i=null;i=this.url?this.url:this.baseUrl+this.id+"."+(null===this.ext?"jpg":this.ext),r.load(i,function(r){r.wrapS=THREE.RepeatWrapping,r.wrapT=THREE.RepeatWrapping,r.flipY=!0,t.texture=r,t.material.map=r,t.wallMaterial.map=r,t.roomMaterial.map=r,t.ready=!0,t.material.roughness=1,t.debug&&console.log(t.id+" download complete"),t.downloadCallback(e)},function(e){console.log(i+" "+e.loaded/e.total*100+"% loaded")},function(r){t.ready=!0,console.error("download error "+i),t.downloadCallback(e)})},e.prototype.downloadModel=function(e){var t=this,r=new thingjs.GLTFLoader,i=null,n=0;this.manager.enableUserHighestVersionResource||(n=this.version),i=this.url?this.url:this.baseUrl+this.id+"/"+n+"/gltf/",r.loadFromURL({url:i,modelCallback:function(r){t.animations=r.animations,t.model=r.node,t.ready=!0,t.downloadCallback(e),t.debug&&console.log(t.id+" download complete")},errorCallback:function(){console.error("download error "+i),t.ready=!0,t.isEmpty=!0,t.downloadCallback(e)}})},e.prototype.downloadCallback=function(e){try{for(var t=0;t<this.callbackObjects.length;t++){this.callbackObjects[t].resourceCallback(this)}e&&e()}catch(e){console.error(e)}},e.prototype.dispose=function(){this.texture&&this.texture.dispose(),this.model&&this._disposeModel(this.model)},e.prototype._disposeModel=function(e){for(var t=0;t<e.children.length;t++){var r=e.children[t];this._disposeModel(r)}if(e instanceof THREE.Mesh){var i=e.material,n=e.geometry,o=e.material.texture;i&&i.dispose(),n&&n.dispose(),o&&o.dispose()}},Gn(e,[{key:"isModel",get:function(){return null===this.ext}}]),e}(),mo=function(){function e(){qn(this,e),this.sceneJson=null,this.scale=1,this.curFloorPlan=null,this.defaultWallTextureUri="Textures/RoomWall.jpg",this.defaultWallEdgeTextureUri="Textures/WallEdge.jpg",this.defaultFloorTextureUri="Textures/FloorDefault.jpg",this.defaultCeilingTextureUri="Textures/CeilingDefault.jpg",this.defaultRoofTextureUri="Textures/RoofDefault.jpg",this.defaultWallLightMapUri="Textures/WallLighting.PNG",this.defaultFloorLightMapUri="Textures/FloorLighting.jpg",this.pointInLineDeviation=.1,Jn.enableDelayLoadMode=!1,Jn.enableManaulWallLightMap=!0,Jn.enableFloorLightMap=!0}return e.prototype.load=function(e){var t=this;return e?(e.url&&(this.sceneURL=e.url),e.json&&(this.sceneJson=e.json),new Promise(function(e,r){t.loadDefaultTexture().then(function(){return t.loadSceneJson()}).then(function(){t.curFloorPlan=new co,t.parseSceneJson(),t.curFloorPlan.build();var r=t.createWalls(),i=t.createRooms();e({walls:r,rooms:i})}).catch(function(e){console.error(e)})})):(console.error("load param can not be null"),null)},e.prototype.loadSceneJson=function(){var e=this;return new Promise(function(t,r){if(e.sceneJson)t(e.sceneJson);else if(e.sceneURL){(new THREE.FileLoader).load(e.sceneURL,function(r){e.sceneJson=JSON.parse(r),t()},function(){},function(t){r("can not load "+e.sceneURL)})}else r("load scene json error")})},e.prototype.createTextureLoaderPromise=function(e){return new Promise(function(t,r){(new THREE.TextureLoader).load(e,function(e){e.wrapS=THREE.RepeatWrapping,e.wrapT=THREE.RepeatWrapping,t(e)},function(t){console.log(e+" "+t.loaded/t.total*100+"% loaded")},function(r){t(null),console.log(e+"load error")})})},e.prototype.loadDefaultTexture=function(){var e=this;return new Promise(function(t,r){var i=[],n=e.createTextureLoaderPromise(e.defaultWallTextureUri).then(function(t){Qn.wallTexture=t;var r=e.createDefaultResource(t);Qn.wallResource=r});i.push(n);var o=e.createTextureLoaderPromise(e.defaultWallEdgeTextureUri).then(function(t){Qn.wallEdgeTexture=t;var r=e.createDefaultResource(t);Qn.edgeResource=r});i.push(o);var a=e.createTextureLoaderPromise(e.defaultFloorTextureUri).then(function(t){Qn.floorTexture=t;var r=e.createDefaultResource(t);Qn.floorResource=r});i.push(a);var s=e.createTextureLoaderPromise(e.defaultRoofTextureUri).then(function(t){Qn.roofTexture=t;var r=e.createDefaultResource(t);Qn.rooflResource=r});i.push(s);var l=e.createTextureLoaderPromise(e.defaultCeilingTextureUri).then(function(t){Qn.ceilingTexture=t;var r=e.createDefaultResource(t);Qn.ceilingResource=r});if(i.push(l),Jn.enableManaulWallLightMap){var c=e.createTextureLoaderPromise(e.defaultWallLightMapUri).then(function(t){Qn.wallLigthMapTexture=t;var r=e.createDefaultResource(t);Qn.wallLightMapResource=r});i.push(c)}if(Jn.enableFloorLightMap){var u=e.createTextureLoaderPromise(e.defaultFloorLightMapUri).then(function(t){Qn.floorLightMapTexture=t;var r=e.createDefaultResource(t);Qn.floorLightMapResource=r});i.push(u)}Promise.all(i).then(function(){t()})})},e.prototype.createDefaultResource=function(e){var t=new fo;return t.ready=!0,t.isDefault=!0,t.texture=e,t.material.map=e,t.roomMaterial.map=e,t},e.prototype.parseSceneJson=function(){var e=this.sceneJson;e.unit&&(this.scale=.01*e.unit),e.walls&&this.parseWallJson(e.walls),e.rooms&&this.parseRoomJson(e.rooms),e.doors&&this.parseDoorJson(e.doors)},e.prototype.parseWallJson=function(e){for(var t=0,r=e.length;t<r;t++){var i=e[t],n=i.start[0]*this.scale,o=i.start[1]*this.scale,a=null,s=null;a=this.curFloorPlan.existsCorner(n,0,o)?this.curFloorPlan.getCorner(n,0,o):this.curFloorPlan.addCorner(n,0,o),n=i.end[0]*this.scale,o=i.end[1]*this.scale,s=this.curFloorPlan.existsCorner(n,0,o)?this.curFloorPlan.getCorner(n,0,o):this.curFloorPlan.addCorner(n,0,o);var l=new no;l.leftResource=Qn.wallResource,l.rightResource=Qn.wallResource,l.edgeResource=Qn.edgeResource,l.lightMapResource=Qn.wallLightMapResource,l.startCorner=a,l.endCorner=s,l.startCorner.addWall(l),l.endCorner.addWall(l),this.curFloorPlan.addWall(l)}},e.prototype.parseRoomJson=function(e){for(var t=0;t<e.length;t++){for(var r=e[t],i=[],n=0;n<r.points.length;n++){var o=r.points[n];i.push(new THREE.Vector3(o[0]*this.scale,0,o[1]*this.scale))}var a=new lo;if(a.floorResource=Qn.floorResource,a.ceilingResource=Qn.ceilingResource,a.roofResource=Qn.rooflResource,a.lightMapResource=Qn.floorLightMapResource,a.points=i,r.center){var s=new THREE.Vector3;s.x=r.center[0],s.y=0,s.z=r.center[1],a.center=s}if(r.offset){var l=new THREE.Vector3;l.x=r.offset[0],l.y=r.offset[1],l.z=r.offset[2],a.offset=l}if(r.parentPosition){var c=new THREE.Vector3;c.x=r.parentPosition[0],c.y=r.parentPosition[1],c.z=r.parentPosition[2],a.parentPosition=c}this.curFloorPlan.rooms.push(a)}},e.prototype.parseDoorJson=function(e){for(var t=0,r=e.length;t<r;t++){var i=e[t],n=i.height*this.scale,o=i.width*this.scale,a=i.pos[0]*this.scale,s=i.pos[1]*this.scale,l=new THREE.Vector3(a,0,s),c=this.getPointOnWhichWall(this.curFloorPlan,l);if(null!==c){var u=new ho;i.suspendpercent&&(u.suspendPercent=i.suspendpercent),u.size.x=o,u.size.y=n,u.position=l,c.doorOrWindows.push(u)}else console.warn("can not find door on which wall!")}},e.prototype.createRooms=function(){for(var e=[],t=0;t<this.curFloorPlan.rooms.length;t++){var r=this.curFloorPlan.rooms[t];e.push(r.meshGroup)}return e},e.prototype.createWalls=function(){for(var e=this.curFloorPlan.walls,t=[],r=0;r<e.length;r++){var i=e[r];t.push(i.wallGroup)}return t},e.prototype.createWallMesh=function(e){var t=new THREE.BufferGeometry;t.addAttribute("position",new THREE.BufferAttribute(e.positionArray,3)),t.addAttribute("normal",new THREE.BufferAttribute(e.normalArray,3)),t.addAttribute("uv",new THREE.BufferAttribute(e.uvArray,2));var r=e.material;return new THREE.Mesh(t,r)},e.prototype.getPointOnWhichWall=function(e,t){for(var r=e.walls,i=0;i<r.length;i++){var n=r[i];if(this.isPointOnLineAndBetweenPoints(n.startCorner.position,n.endCorner.position,t))return n}return null},e.prototype.isPointOnLine=function(e,t,r){var i=new THREE.Vector3;return i.crossVectors(e.clone().sub(r),t.clone().sub(r)),i.length()<this.pointInLineDeviation},e.prototype.isPointOnLineAndBetweenPoints=function(e,t,r){if(!this.isPointOnLine(e,t,r))return!1;var i=t.x-e.x,n=t.z-e.z;return Math.abs(i)>=Math.abs(n)?i>0?e.x<=r.x&&r.x<=t.x:t.x<=r.x&&r.x<=e.x:n>0?e.z<=r.z&&r.z<=t.z:t.z<=r.z&&r.z<=e.z},e}(),go=function(e){function t(){qn(this,t);var r=Xn(this,e.call(this));return r.outdoors=null,r.buildings=[],r}return Wn(t,e),t.prototype.build=function(){for(var e=0;e<this.buildings.length;e++){this.buildings[e].build()}this.outdoors&&this.outdoors.build()},t}(Kn),vo=function(e){function t(){qn(this,t);var r=Xn(this,e.call(this));return r.floorplans=[],r.facades=[],r.facadeGroups=[],r}return Wn(t,e),t.prototype.build=function(){for(e=0;e<this.floorplans.length;e++){this.floorplans[e].build()}for(e=0;e<this.facades.length;e++){(t=this.facades[e]).build()}for(var e=0;e<this.facadeGroups.length;e++){var t=this.facadeGroups[e];t.build()}},t}(Kn),yo={id:"id",name:"name",position:"position",rotation:"rotation",scale:"scale",properties:"properties",plans:"plans",walls:"walls",placements:"placements",groups:"groups",corners:"corners",doorOrWindows:"doororwindows",rooms:"rooms",height:"height",thick:"thick",texture:"texture",type:"type",model:"model",suspendPercent:"suspendpercent",leftTexture:"lefttexture",rightTexture:"righttexture",edgeTexture:"edgetexture",floorTexture:"floortexture",ceilingTexture:"ceilingtexture",roofTexture:"rooftexture",wallType:"type"},Eo=function(){function e(){qn(this,e),this.sceneJson=null,this.scale=1,this.curFloorPlan=null,this.defaultWallTextureUri="Textures/RoomWall.jpg",this.defaultWallEdgeTextureUri="Textures/WallEdge.jpg",this.defaultFloorTextureUri="Textures/FloorDefault.jpg",this.defaultCeilingTextureUri="Textures/CeilingDefault.jpg",this.defaultRoofTextureUri="Textures/RoofDefault.jpg",this.defaultWallLightMapUri="Textures/WallLighting.PNG",this.defaultFloorLightMapUri="Textures/FloorLighting.jpg",this.world=null,Jn.enableDelayLoadMode=!1,Jn.enableManaulWallLightMap=!0,Jn.enableFloorLightMap=!0}return e.prototype.load=function(e){var t=this;return e?(e.url&&(this.sceneURL=e.url),e.json&&(this.sceneJson=e.json),new Promise(function(e,r){t.loadDefaultTexture().then(function(){return t.loadSceneJson()}).then(function(){t.parseWorld(t.sceneJson),t.world.build(),e(t.world)}).catch(function(e){console.error(e)})})):(console.error("load param can not be null"),null)},e.prototype.loadSceneJson=function(){var e=this;return new Promise(function(t,r){if(e.sceneJson)t(e.sceneJson);else if(e.sceneURL){(new THREE.FileLoader).load(e.sceneURL,function(r){e.sceneJson=JSON.parse(r),t()},function(){},function(t){r("can not load "+e.sceneURL)})}else r("load scene json error")})},e.prototype.createTextureLoaderPromise=function(e){return new Promise(function(t,r){(new THREE.TextureLoader).load(e,function(e){e.wrapS=THREE.RepeatWrapping,e.wrapT=THREE.RepeatWrapping,t(e)},function(t){console.log(e+" "+t.loaded/t.total*100+"% loaded")},function(r){t(null),console.log(e+"load error")})})},e.prototype.loadDefaultTexture=function(){var e=this;return new Promise(function(t,r){var i=[],n=e.createTextureLoaderPromise(e.defaultWallTextureUri).then(function(t){Qn.wallTexture=t;var r=e.createDefaultResource(t);Qn.wallResource=r});i.push(n);var o=e.createTextureLoaderPromise(e.defaultWallEdgeTextureUri).then(function(t){Qn.wallEdgeTexture=t;var r=e.createDefaultResource(t);Qn.edgeResource=r});i.push(o);var a=e.createTextureLoaderPromise(e.defaultFloorTextureUri).then(function(t){Qn.floorTexture=t;var r=e.createDefaultResource(t);Qn.floorResource=r});i.push(a);var s=e.createTextureLoaderPromise(e.defaultRoofTextureUri).then(function(t){Qn.roofTexture=t;var r=e.createDefaultResource(t);Qn.rooflResource=r});i.push(s);var l=e.createTextureLoaderPromise(e.defaultCeilingTextureUri).then(function(t){Qn.ceilingTexture=t;var r=e.createDefaultResource(t);Qn.ceilingResource=r});if(i.push(l),Jn.enableManaulWallLightMap){var c=e.createTextureLoaderPromise(e.defaultWallLightMapUri).then(function(t){Qn.wallLigthMapTexture=t;var r=e.createDefaultResource(t);Qn.wallLightMapResource=r});i.push(c)}if(Jn.enableFloorLightMap){var u=e.createTextureLoaderPromise(e.defaultFloorLightMapUri).then(function(t){Qn.floorLightMapTexture=t;var r=e.createDefaultResource(t);Qn.floorLightMapResource=r});i.push(u)}Promise.all(i).then(function(){t()})})},e.prototype.createDefaultResource=function(e){var t=new fo;return t.ready=!0,t.isDefault=!0,t.texture=e,t.material.map=e,t.roomMaterial.map=e,t},e.prototype.parseWorld=function(e){var t=new go;if(this.world=t,e.buildings)for(var r=e.buildings,i=0;i<r.length;i++){var n=r[i],o=this.parseBuilding(n);t.buildings.push(o)}},e.prototype.parseBuilding=function(e,t){var r=e,i=new vo;e.id&&(i.id=e.id);for(var n=r[yo.plans],o=0;o<n.length;o++){var a=n[o],s=new co;a.id&&(s.id=a.id),this.parseFloorPlan(a,s,i),a.height?s.position.set(0,a.height*o,0):s.position.set(0,s.height*o,0),i.floorplans.push(s)}return i},e.prototype.parseFloorPlan=function(e,t){var r=e;r.unit&&(this.scale=.01*r.unit),r.walls&&this.parseWallJson(r.walls,t),r.rooms&&this.parseRoomJson(r.rooms,t),r.doors&&this.parseDoorJson(r.doors,t)},e.prototype.parseWallJson=function(e,t){for(var r=0,i=e.length;r<i;r++){var n=e[r],o=n.start[0]*this.scale,a=n.start[1]*this.scale,s=null,l=null;s=t.existsCorner(o,0,a)?t.getCorner(o,0,a):t.addCorner(o,0,a),o=n.end[0]*this.scale,a=n.end[1]*this.scale,l=t.existsCorner(o,0,a)?t.getCorner(o,0,a):t.addCorner(o,0,a);var c=new no;n.id&&(c.id=n.id),c.leftResource=Qn.wallResource,c.rightResource=Qn.wallResource,c.edgeResource=Qn.edgeResource,c.lightMapResource=Qn.wallLightMapResource,c.startCorner=s,c.endCorner=l,c.startCorner.addWall(c),c.endCorner.addWall(c),t.addWall(c)}},e.prototype.parseRoomJson=function(e,t){for(var r=0;r<e.length;r++){for(var i=e[r],n=[],o=0;o<i.points.length;o++){var a=i.points[o];n.push(new THREE.Vector3(a[0]*this.scale,0,a[1]*this.scale))}var s=new lo;if(i.id&&(s.id=i.id),s.floorResource=Qn.floorResource,s.ceilingResource=Qn.ceilingResource,s.roofResource=Qn.rooflResource,s.lightMapResource=Qn.floorLightMapResource,s.points=n,i.center){var l=new THREE.Vector3;l.x=i.center[0],l.y=0,l.z=i.center[1],s.center=l}if(i.offset){var c=new THREE.Vector3;c.x=i.offset[0],c.y=i.offset[1],c.z=i.offset[2],s.offset=c}if(i.parentPosition){var u=new THREE.Vector3;u.x=i.parentPosition[0],u.y=i.parentPosition[1],u.z=i.parentPosition[2],s.parentPosition=u}void 0!==i.enableLightMap?s.floor.enableLightMap=i.enableLightMap:s.floor.enableLightMap=!1,s.parent=t,t.rooms.push(s)}},e.prototype.parseDoorJson=function(e,t){for(var r=0,i=e.length;r<i;r++){var n=e[r],o=n.height*this.scale,a=n.width*this.scale,s=n.pos[0]*this.scale,l=n.pos[1]*this.scale,c=new THREE.Vector3(s,0,l),u=this.getPointOnWhichWall(t,c);if(null!==u){var h=new ho;h.size.x=a,h.size.y=o,h.position=c,u.doorOrWindows.push(h)}else console.warn("can not find door on which wall!")}},e.prototype.createWallMesh=function(e){var t=new THREE.BufferGeometry;t.addAttribute("position",new THREE.BufferAttribute(e.positionArray,3)),t.addAttribute("normal",new THREE.BufferAttribute(e.normalArray,3)),t.addAttribute("uv",new THREE.BufferAttribute(e.uvArray,2));var r=e.material;return new THREE.Mesh(t,r)},e.prototype.getPointOnWhichWall=function(e,t){for(var r=e.walls,i=0;i<r.length;i++){var n=r[i];if(this.isPointOnLineAndBetweenPoints(n.startCorner.position,n.endCorner.position,t))return n}return null},e.prototype.isPointOnLine=function(e,t,r){var i=new THREE.Vector3;return i.crossVectors(e.clone().sub(r),t.clone().sub(r)),!i.length()},e.prototype.isPointOnLineAndBetweenPoints=function(e,t,r){if(!this.isPointOnLine(e,t,r))return!1;var i=t.x-e.x,n=t.z-e.z;return Math.abs(i)>=Math.abs(n)?i>0?e.x<=r.x&&r.x<=t.x:t.x<=r.x&&r.x<=e.x:n>0?e.z<=r.z&&r.z<=t.z:t.z<=r.z&&r.z<=e.z},e}(),bo=function(){function e(){qn(this,e),this.sceneJson=null,this.scale=1,this.curFloorPlan=null,this.defaultWallTextureUri="Textures/RoomWall.jpg",this.defaultWallEdgeTextureUri="Textures/WallEdge.jpg",this.defaultFloorTextureUri="Textures/FloorDefault.jpg",this.defaultCeilingTextureUri="Textures/CeilingDefault.jpg",this.defaultRoofTextureUri="Textures/RoofDefault.jpg",this.defaultWallLightMapUri="Textures/WallLighting.PNG",this.defaultFloorLightMapUri="Textures/FloorLighting.jpg",Jn.enableDelayLoadMode=!1,Jn.enableManaulWallLightMap=!0,Jn.enableFloorLightMap=!0}return e.prototype.load=function(e){var t=this,t=this;return e?(e.url&&(this.sceneURL=e.url),e.json&&(this.sceneJson=e.json),new Promise(function(e,r){t.loadDefaultTexture().then(function(){return t.loadSceneJson()}).then(function(){t.curFloorPlan=new co,t.parseSceneJson(),t.curFloorPlan.build();var r=t.createWalls(),i=t.createRooms();e({walls:r,rooms:i})}).catch(function(e){console.error(e)})})):(console.error("load param can not be null"),null)},e.prototype.loadSceneJson=function(){var e=this;return new Promise(function(t,r){if(e.sceneJson)t(e.sceneJson);else if(e.sceneURL){(new THREE.FileLoader).load(e.sceneURL,function(r){e.sceneJson=JSON.parse(r),t()},function(){},function(t){r("can not load "+e.sceneURL)})}else r("load scene json error")})},e.prototype.createTextureLoaderPromise=function(e){return new Promise(function(t,r){(new THREE.TextureLoader).load(e,function(e){e.wrapS=THREE.RepeatWrapping,e.wrapT=THREE.RepeatWrapping,t(e)},function(t){console.log(e+" "+t.loaded/t.total*100+"% loaded")},function(r){t(null),console.log(e+"load error")})})},e.prototype.loadDefaultTexture=function(){var e=this;return new Promise(function(t,r){var i=[],n=e.createTextureLoaderPromise(e.defaultWallTextureUri).then(function(t){Qn.wallTexture=t;var r=e.createDefaultResource(t);Qn.wallResource=r});i.push(n);var o=e.createTextureLoaderPromise(e.defaultWallEdgeTextureUri).then(function(t){Qn.wallEdgeTexture=t;var r=e.createDefaultResource(t);Qn.edgeResource=r});i.push(o);var a=e.createTextureLoaderPromise(e.defaultFloorTextureUri).then(function(t){Qn.floorTexture=t;var r=e.createDefaultResource(t);Qn.floorResource=r});i.push(a);var s=e.createTextureLoaderPromise(e.defaultRoofTextureUri).then(function(t){Qn.roofTexture=t;var r=e.createDefaultResource(t);Qn.rooflResource=r});i.push(s);var l=e.createTextureLoaderPromise(e.defaultCeilingTextureUri).then(function(t){Qn.ceilingTexture=t;var r=e.createDefaultResource(t);Qn.ceilingResource=r});if(i.push(l),Jn.enableManaulWallLightMap){var c=e.createTextureLoaderPromise(e.defaultWallLightMapUri).then(function(t){Qn.wallLigthMapTexture=t;var r=e.createDefaultResource(t);Qn.wallLightMapResource=r});i.push(c)}if(Jn.enableFloorLightMap){var u=e.createTextureLoaderPromise(e.defaultFloorLightMapUri).then(function(t){Qn.floorLightMapTexture=t;var r=e.createDefaultResource(t);Qn.floorLightMapResource=r});i.push(u)}Promise.all(i).then(function(){t()})})},e.prototype.createDefaultResource=function(e){var t=new fo;return t.ready=!0,t.isDefault=!0,t.texture=e,t.material.map=e,t.roomMaterial.map=e,t},e.prototype.parseSceneJson=function(){var e=this.sceneJson;for(var t in e){var r=e[t];if(!r)return console.error("load param can not be null"),null;this.sceneJson=r;break}(e=this.sceneJson).id&&(this.curFloorPlan.id=e.id),e.unit&&(this.scale=.01*e.unit),e.walls&&this.parseWallJson(e.walls),e.rooms&&this.parseRoomJson(e.rooms),e.doors&&this.parseDoorJson(e.doors)},e.prototype.parseWallJson=function(e){for(var t=0,r=e.length;t<r;t++){var i=e[t],n=i.start[0]*this.scale,o=i.start[1]*this.scale,a=null,s=null;a=this.curFloorPlan.existsCorner(n,0,o)?this.curFloorPlan.getCorner(n,0,o):this.curFloorPlan.addCorner(n,0,o),n=i.end[0]*this.scale,o=i.end[1]*this.scale,s=this.curFloorPlan.existsCorner(n,0,o)?this.curFloorPlan.getCorner(n,0,o):this.curFloorPlan.addCorner(n,0,o);var l=new no;l.leftResource=Qn.wallResource,l.rightResource=Qn.wallResource,l.edgeResource=Qn.edgeResource,l.lightMapResource=Qn.wallLightMapResource,l.startCorner=a,l.endCorner=s,l.startCorner.addWall(l),l.endCorner.addWall(l),this.curFloorPlan.addWall(l)}},e.prototype.parseRoomJson=function(e){for(var t=0;t<e.length;t++){for(var r=e[t],i=[],n=0;n<r.points.length;n++){var o=r.points[n];i.push(new THREE.Vector3(o[0]*this.scale,0,o[1]*this.scale))}var a=new lo;if(a.floorResource=Qn.floorResource,a.ceilingResource=Qn.ceilingResource,a.roofResource=Qn.rooflResource,a.lightMapResource=Qn.floorLightMapResource,a.points=i,r.center){var s=new THREE.Vector3;s.x=r.center[0],s.y=0,s.z=r.center[1],a.center=s}if(r.offset){var l=new THREE.Vector3;l.x=r.offset[0],l.y=r.offset[1],l.z=r.offset[2],a.offset=l}if(r.parentPosition){var c=new THREE.Vector3;c.x=r.parentPosition[0],c.y=r.parentPosition[1],c.z=r.parentPosition[2],a.parentPosition=c}void 0!==r.enableLightMap?a.floor.enableLightMap=r.enableLightMap:a.floor.enableLightMap=!1,this.curFloorPlan.rooms.push(a)}},e.prototype.parseDoorJson=function(e){for(var t=0,r=e.length;t<r;t++){var i=e[t],n=i.height*this.scale,o=i.width*this.scale,a=i.pos[0]*this.scale,s=i.pos[1]*this.scale,l=new THREE.Vector3(a,0,s),c=this.getPointOnWhichWall(this.curFloorPlan,l);if(null!==c){var u=new ho;i.suspendpercent&&(u.suspendPercent=i.suspendpercent),u.size.x=o,u.size.y=n,u.position=l,c.doorOrWindows.push(u)}else console.warn("can not find door on which wall!")}},e.prototype.createRooms=function(){for(var e=[],t=0;t<this.curFloorPlan.rooms.length;t++){var r=this.curFloorPlan.rooms[t];e.push(r.meshGroup)}return e},e.prototype.createWalls=function(){for(var e=this.curFloorPlan.walls,t=[],r=0;r<e.length;r++){var i=e[r];t.push(i.wallGroup)}return t},e.prototype.createWallMesh=function(e){var t=new THREE.BufferGeometry;t.addAttribute("position",new THREE.BufferAttribute(e.positionArray,3)),t.addAttribute("normal",new THREE.BufferAttribute(e.normalArray,3)),t.addAttribute("uv",new THREE.BufferAttribute(e.uvArray,2));var r=e.material;return new THREE.Mesh(t,r)},e.prototype.getPointOnWhichWall=function(e,t){for(var r=e.walls,i=0;i<r.length;i++){var n=r[i];if(this.isPointOnLineAndBetweenPoints(n.startCorner.position,n.endCorner.position,t))return n}return null},e.prototype.isPointOnLine=function(e,t,r){var i=new THREE.Vector3;return i.crossVectors(e.clone().sub(r),t.clone().sub(r)),!i.length()},e.prototype.isPointOnLineAndBetweenPoints=function(e,t,r){if(!this.isPointOnLine(e,t,r))return!1;var i=t.x-e.x,n=t.z-e.z;return Math.abs(i)>=Math.abs(n)?i>0?e.x<=r.x&&r.x<=t.x:t.x<=r.x&&r.x<=e.x:n>0?e.z<=r.z&&r.z<=t.z:t.z<=r.z&&r.z<=e.z},e}(),xo=function(){function e(){qn(this,e),this.sceneJson=null,this.scale=1,this.curFloorPlan=null,this.defaultWallTextureUri="Textures/RoomWall.jpg",this.defaultWallEdgeTextureUri="Textures/WallEdge.jpg",this.defaultFloorTextureUri="Textures/FloorDefault.jpg",this.defaultCeilingTextureUri="Textures/CeilingDefault.jpg",this.defaultRoofTextureUri="Textures/RoofDefault.jpg",this.wallLines=[],this.roomLines=[]}return e.prototype.load=function(e){var t=this;return e?(e.url&&(this.sceneURL=e.url),e.json&&(this.sceneJson=e.json),new Promise(function(e,r){t.loadDefaultTexture().then(function(){return t.loadSceneJson()}).then(function(){t.curFloorPlan=new co,t.parseSceneJson(),t.curFloorPlan.build();var r={walls:t.createWalls(),rooms:t.createRooms(),wallLines:t.wallLines,roomLines:t.roomLines};e(r)}).catch(function(e){console.error(e)})})):(console.error("load param can not be null"),null)},e.prototype.loadSceneJson=function(){var e=this;return new Promise(function(t,r){if(e.sceneJson)t(e.sceneJson);else if(e.sceneURL){(new THREE.FileLoader).load(e.sceneURL,function(r){e.sceneJson=JSON.parse(r),t()},function(){},function(t){r("can not load "+e.sceneURL)})}else r("load scene json error")})},e.prototype.createTextureLoaderPromise=function(e){return new Promise(function(t,r){(new THREE.TextureLoader).load(e,function(e){e.wrapS=THREE.RepeatWrapping,e.wrapT=THREE.RepeatWrapping,t(e)},function(t){console.log(e+" "+t.loaded/t.total*100+"% loaded")},function(r){t(null),console.log(e+"load error")})})},e.prototype.loadDefaultTexture=function(){var e=this;return new Promise(function(t,r){var i=e.createTextureLoaderPromise(e.defaultWallTextureUri),n=e.createTextureLoaderPromise(e.defaultWallEdgeTextureUri),o=e.createTextureLoaderPromise(e.defaultFloorTextureUri),a=e.createTextureLoaderPromise(e.defaultRoofTextureUri),s=e.createTextureLoaderPromise(e.defaultCeilingTextureUri);Promise.all([i,n,o,a,s]).then(function(e){Qn.wallTexture=e[0],Qn.wallEdgeTexture=e[1],Qn.floorTexture=e[2],Qn.roofTexture=e[3],Qn.ceilingTexture=e[4],t()})})},e.prototype.createLine=function(e,t){for(var r=new THREE.LineBasicMaterial({color:t}),i=new THREE.Geometry,n=0;n<e.length;n++){var o=e[n];i.vertices.push(o)}return new THREE.Line(i,r)},e.prototype.parseSceneJson=function(){var e=this.sceneJson;e.unit&&(this.scale=.01*e.unit),e.walls&&this.parseWallJson(e.walls),e.rooms&&this.parseRoomJson(e.rooms)},e.prototype.parseWallJson=function(e){for(var t=0,r=e.length;t<r;t++){var i=e[t],n=i.start[0]*this.scale,o=i.start[1]*this.scale,a=null,s=null;a=this.curFloorPlan.existsCorner(n,0,o)?this.curFloorPlan.getCorner(n,0,o):this.curFloorPlan.addCorner(n,0,o),n=i.end[0]*this.scale,o=i.end[1]*this.scale,s=this.curFloorPlan.existsCorner(n,0,o)?this.curFloorPlan.getCorner(n,0,o):this.curFloorPlan.addCorner(n,0,o);var l=new no;i.height&&(l.height=i.height),l.startCorner=a,l.endCorner=s,l.startCorner.addWall(l),l.endCorner.addWall(l);var c=[];c.push(l.startCorner.position),c.push(l.endCorner.position);var u=this.createLine(c,new THREE.Color(1,0,0));this.wallLines.push(u),this.curFloorPlan.addWall(l)}},e.prototype.parseRoomJson=function(e){for(var t=0;t<e.length;t++){for(var r=e[t],i=[],n=0;n<r.points.length;n++){var o=r.points[n];i.push(new THREE.Vector3(o[0]*this.scale,0,o[1]*this.scale))}var a=new lo,s=this.createLine(i,new THREE.Color(0,1,0));if(this.roomLines.push(s),a.points=i,r.center){var l=new THREE.Vector3;l.x=r.center[0],l.y=0,l.z=r.center[1],a.center=l}if(r.offset){var c=new THREE.Vector3;c.x=r.offset[0],c.y=r.offset[1],c.z=r.offset[2],a.offset=c}if(r.parentPosition){var u=new THREE.Vector3;u.x=r.parentPosition[0],u.y=r.parentPosition[1],u.z=r.parentPosition[2],a.parentPosition=u}this.curFloorPlan.rooms.push(a)}},e.prototype.createRooms=function(){for(var e=[],t=0;t<this.curFloorPlan.rooms.length;t++){var r=this.curFloorPlan.rooms[t];e.push(r.meshGroup)}return e},e.prototype.createWalls=function(){for(var e=this.curFloorPlan.walls,t=[],r=0;r<e.length;r++){var i=e[r],n=i.position,o=new THREE.Group("wall");o.add(this.createWallMesh(i.rightSideMeshInfo)),o.add(this.createWallMesh(i.leftSideMeshInfo)),o.add(this.createWallMesh(i.edgeSideMeshInfo)),o.position.set(n.x,n.y,n.z),t.push(o)}return t},e.prototype.createWallMesh=function(e){var t=new THREE.BufferGeometry;t.addAttribute("position",new THREE.BufferAttribute(e.positionArray,3)),t.addAttribute("normal",new THREE.BufferAttribute(e.normalArray,3)),t.addAttribute("uv",new THREE.BufferAttribute(e.uvArray,2));var r=e.material;return new THREE.Mesh(t,r)},e}(),_o=function(e){function t(){return qn(this,t),Xn(this,e.call(this))}return Wn(t,e),t.prototype.build=function(){for(var t=0;t<this.rooms.length;t++){this.rooms[t].isOnlyFloor=!0}e.prototype.build.call(this)},t}(co),wo=function(e){function t(r){qn(this,t);var i=Xn(this,e.call(this,r));return i.customTexture=null,i.color=null,i.renderMode=null,i.modelID=null,i}return Wn(t,e),t.prototype.combine=function(){this.model&&(null!==this.customTexture&&this.changeWithCustomTexture(this.model),null!==this.color&&this.changeWithCustomColor(this.model),null!==this.renderMode&&this.changeRenderMode(this.model),this.combineBundleObj=new po(this.model),this.combineBundleObj.combine(),this.isCombine=!0)},t.prototype.changeRenderMode=function(e){if(e instanceof THREE.Mesh&&(e.material.color=this.color,null!==this.renderMode))switch(this.renderMode){case 1:e.material.transparent=!1,e.material.alphaTest=.5;break;case 3:case 2:e.material.transparent=!0;break;default:console.error("can not find renderMode "+this.renderMode)}for(var t=0;t<e.children.length;t++){var r=e.children[t];this.changeRenderMode(r)}},t.prototype.changeWithCustomColor=function(e){e instanceof THREE.Mesh&&(e.material.color=this.color,null!==this.opacity&&(e.material.opacity=this.opacity,e.material.transparent=!0));for(var t=0;t<e.children.length;t++){var r=e.children[t];this.changeWithCustomColor(r)}},t.prototype.changeWithCustomTexture=function(e){e instanceof THREE.Mesh&&(this.customTexture&&this.customTexture.texture&&(this.customTexture.texture.flipY=!1),e.material.map=this.customTexture.texture);for(var t=0;t<e.children.length;t++){var r=e.children[t];this.changeWithCustomTexture(r)}},t.prototype.downloadModel=function(e){var t=this,r=new thingjs.GLTFLoader,i=null,n=0;this.manager.enableUserHighestVersionResource||(n=this.version),i=this.url?this.url:this.baseUrl+this.modelID+"/"+n+"/gltf/",r.loadFromURL({url:i,modelCallback:function(r){t.model=r.node.children[0],t.animations=r.animations,t.ready=!0,null!==t.customTexture?t.customTexture.downloadTexture(function(){null!==t.customTexture&&t.changeWithCustomTexture(t.model),null!==t.color&&t.changeWithCustomColor(t.model),null!==t.renderMode&&t.changeRenderMode(t.model),t.downloadCallback(e)}):(null!==t.color&&t.changeWithCustomColor(t.model),null!==t.renderMode&&t.changeRenderMode(t.model),t.downloadCallback(e))},errorCallback:function(){console.error("download error "+i),t.ready=!0,t.isEmpty=!0,t.downloadCallback(e)}})},t}(fo),To=function(e){function t(r){qn(this,t);var i=Xn(this,e.call(this,r));return i.customTexture=null,i.color=null,i.renderMode=null,i.modelID=null,i.localBaseUrl=null,i.localUrl=null,i}return Wn(t,e),t.prototype.combine=function(){this.model&&(null!==this.customTexture&&this.changeWithCustomTexture(this.model),null!==this.color&&this.changeWithCustomColor(this.model),null!==this.renderMode&&this.changeRenderMode(this.model),this.combineBundleObj=new po(this.model),this.combineBundleObj.combine(),this.isCombine=!0)},t.prototype.changeRenderMode=function(e){if(e instanceof THREE.Mesh&&(e.material.color=this.color,null!==this.renderMode))switch(this.renderMode){case 1:e.material.transparent=!1,e.material.alphaTest=.5;break;case 3:case 2:e.material.transparent=!0;break;default:console.error("can not find renderMode "+this.renderMode)}for(var t=0;t<e.children.length;t++){var r=e.children[t];this.changeRenderMode(r)}},t.prototype.changeWithCustomColor=function(e){e instanceof THREE.Mesh&&(e.material.color=this.color,null!==this.opacity&&(e.material.opacity=this.opacity,e.material.transparent=!0));for(var t=0;t<e.children.length;t++){var r=e.children[t];this.changeWithCustomColor(r)}},t.prototype.changeWithCustomTexture=function(e){e instanceof THREE.Mesh&&(this.customTexture&&this.customTexture.texture&&(this.customTexture.texture.flipY=!1),e.material.map=this.customTexture.texture);for(var t=0;t<e.children.length;t++){var r=e.children[t];this.changeWithCustomTexture(r)}},t.prototype.downloadModel=function(e){var t=this,r=(new THREE.FileLoader,null);if(this.localUrl){r=this.localBaseUrl+this.localUrl;(new thingjs.GLTFLoader).load(r,function(r){t.model=r.scene,t.animations=r.animations,t.ready=!0,null!==t.customTexture?t.customTexture.downloadTexture(function(){t.downloadCallback(e)}):t.downloadCallback(e)},void 0,function(i){console.error("download error "+r+"  "+i),t.ready=!0,t.isEmpty=!0,t.downloadCallback(e)})}else console.error("can not find url")},t}(fo),Mo=function(){function e(){qn(this,e),this.textures=[],this.models=[],this.baseTextureUrl="https://static.3dmomoda.com/textures/",this.baseModelUrl="https://model.3dmomoda.com/models/",this.localCustomModelBaseUrl=null,this.wallTextures=[],this.wallModels=[],this.roomTextures=[],this.commonTextures=[],this.doorOrWindowModels=[],this.placementModels=[],this.isStartedDonwloadResouces=!1,this.allResouces=[],this.curDonwloadResIndex=-1,this.alreadyResouceCount=0,this.downloadResMaxCount=10,this.downloadResCompleteCallback=null,this.delayDownload=!1,this.resourceMap={},this.downloadResProgess=0,this.opacity=null,this.currentDownloadResMap=new Map,this.enableUserHighestVersionResource=Jn.enableUseHighestVersionResource}return e.prototype.addCommonTextureResource=function(e){this._addResource(e,this.commonTextures)},e.prototype.addWallTextureResource=function(e){for(var t=0;t<this.wallTextures.length;t++){if(this.wallTextures[t].id===e.id)return}this.wallTextures.push(e)},e.prototype.addWallModelResource=function(e){for(var t=0;t<this.wallModels.length;t++){if(this.wallModels[t].id===e.id)return}this.wallModels.push(e)},e.prototype.addPlacementResource=function(e){this._addResource(e,this.placementModels)},e.prototype.addRoomResource=function(e){this._addResource(e,this.roomTextures)},e.prototype._addResource=function(e,t){for(var r=0;r<t.length;r++){if(t[r].id===e.id)return}t.push(e)},e.prototype.checkAllResourcesIsReady=function(){for(t=0;t<this.textures.length;t++){var e=this.textures[t];if(!e.ready)return console.log(e.url),!1}for(var t=0;t<this.models.length;t++){var r=this.models[t];if(!r.ready)return console.log(r.url),!1}return!0},e.prototype.resourceCallback=function(){this.alreadyResouceCount++,this.alreadyResouceCount===this.downloadResMaxCount&&this.downloadResources()},e.prototype.initLightMaps=function(e){var t=null,r=[];if(Jn.enableManaulWallLightMap){(t=new fo(this)).baseUrl=this.baseTextureUrl,t.id="18091219l1g1hnjt",t.ext="png",Qn.wallLightMapResource=t;i=new Promise(function(e,t){Qn.wallLightMapResource.downloadTexture(function(){e()})});r.push(i)}if(Jn.enableFloorLightMap){(t=new fo(this)).baseUrl=this.baseTextureUrl,t.id="18091216vjlgtwbh",t.ext="jpg",Qn.floorLightMapResource=t;var i=new Promise(function(e,t){Qn.floorLightMapResource.downloadTexture(function(){e()})});r.push(i)}Promise.all(r).then(function(){e&&e()})},e.prototype.downloadResources=function(e){var t=this;if(this.isStartedDonwloadResouces){if(this.curDonwloadResIndex===this.allResouces.length-1)return this.downloadResProgess=1,void e()}else{var r=[];this.downloadResProgess=0,r=r.concat(this.wallTextures).concat(this.wallModels).concat(this.roomTextures).concat(this.doorOrWindowModels).concat(this.placementModels).concat(this.commonTextures),this.allResouces=r,this.isStartedDonwloadResouces=!0,this.curDonwloadResIndex=0}if(0===this.allResouces.length)return this.downloadResProgess=1,void e();for(var i=0,n=[],o=this.curDonwloadResIndex;o<this.allResouces.length;o++,i++){var a=this.allResouces[o];if(null===a.ext){s=new Promise(function(e,t){a.downloadModel(function(){e()})});n.push(s)}else{var s=new Promise(function(e,t){a.downloadTexture(function(){e()})});n.push(s)}if(this.curDonwloadResIndex++,i===this.downloadResMaxCount){this.curDonwloadResIndex=o;break}o===this.allResouces.length-1&&(this.curDonwloadResIndex=o)}Promise.all(n).then(function(){t.downloadResProgess=t.curDonwloadResIndex/(t.allResouces.length-1),t.downloadResources(e)}).catch(function(e){console.log(e)})},e.prototype.downloadResourcesWithQueue=function(e){var t=this;if(0!==t.allResouces.length&&(this.downloadResProgess=(this.curDonwloadResIndex-this.currentDownloadResMap.size)/t.allResouces.length),this.isStartedDonwloadResouces){if(this.curDonwloadResIndex===this.allResouces.length&&0===this.currentDownloadResMap.size)return this.downloadResProgess=1,void e()}else{var r=[];this.downloadResProgess=0,r=Jn.enableCombine?r.concat(this.wallTextures).concat(this.wallModels).concat(this.roomTextures).concat(this.doorOrWindowModels).concat(this.placementModels).concat(this.commonTextures):r.concat(this.textures).concat(this.models),this.allResouces=r,this.isStartedDonwloadResouces=!0,this.curDonwloadResIndex=0,this.currentDownloadResMap=new Map}if(0===this.allResouces.length)return this.downloadResProgess=1,void e();if(!(this.curDonwloadResIndex>this.allResouces.length-1)){if(0!==this.downloadResMaxCount-this.currentDownloadResMap.size){var i=this.allResouces[this.curDonwloadResIndex];if(null===i.ext){(n=new Promise(function(e,t){i.downloadModel(function(){e(i)})})).then(function(r){t.currentDownloadResMap.delete(r.id),t.downloadResourcesWithQueue(e)}),this.currentDownloadResMap.set(i.id,i)}else{var n=new Promise(function(e,t){i.downloadTexture(function(){e(i)})});n.then(function(r){t.currentDownloadResMap.delete(r.id),t.downloadResourcesWithQueue(e)}),this.currentDownloadResMap.set(i.id,i)}this.curDonwloadResIndex++,this.downloadResourcesWithQueue(e)}}},e.prototype.loadTextures=function(e){for(var t=null,r=0;r<e.length;r++){var i=e[r];(t=new fo(this)).baseUrl=this.baseTextureUrl,i.url?t.url=i.url:i.id&&(t.id=i.id,t.ext=i.ext),i.isDefault&&(t.isDefault=i.isDefault),this.textures.push(t),this.delayDownload||t.downloadTexture()}},e.prototype.loadModels=function(e){for(var t=null,r=0;r<e.length;r++){var i=e[r];if(t=i.model?new wo(this):i.localurl?new To(this):new fo(this),t.baseUrl=this.baseModelUrl,i.localurl)t.localUrl=i.localurl,t.id=i.id,t.localBaseUrl=this.localCustomModelBaseUrl,i.title&&(t.modelName=i.title),t.modelID=i.id;else if(i.id){if(t.id=i.id,t.modelID=i.id,t.version=i.version,null!==i.texture&&void 0!==i.texture&&(t.customTexture=this.textures[i.texture]),i.rendermode&&(t.renderMode=i.rendermode),i.model&&(t.modelID=i.model),i.title&&(t.modelName=i.title),i.color){var n=i.color;t.color=new THREE.Color(n[0],n[1],n[2]),4===n.length&&(t.opacity=n[3])}if(i.size){var o=i.size;t.modelSize=new THREE.Vector3(o[0],o[1],o[2])}i.hasanimation&&(t.hasAnim=i.hasanimation)}this.models.push(t),this.delayDownload||t.downloadModel()}},e.prototype.disposeModels=function(){for(var e=0;e<this.models.length;e++){this.models[e].dispose()}},e.prototype.disposeTextures=function(){for(var e=0;e<this.textures.length;e++){this.textures[e].dispose()}},e}(),Ro=function(){function e(){qn(this,e),this.id=null,this.name=null,this.userID=null,this.position=new THREE.Vector3,this.rotation=new THREE.Quaternion(0,0,0,1),this.scale=new THREE.Vector3(1,1,1),this.enableDelayLoadMode=Jn.enableDelayLoadMode,this.parent=null,this.properties=null,this.isShow=!0}return Gn(e,[{key:"worldPosition",get:function(){if(this.parent){var e=new THREE.Vector3;return e.addVectors(this.parent.worldPosition,this.position),e}return this.position}}]),e}(),So=function(e){function t(){qn(this,t);var r=Xn(this,e.call(this));return r.startCorner=null,r.endCorner=null,r.thick=-1,r.height=-1,r.length=-1,r.pathPoints=[],r.direction=new THREE.Vector3,r.doorOrWindows=[],r.subWalls=[],r.subCorners=[],r.suspend=0,r.mesh=null,r.isShow=!0,r}return Wn(t,e),t.prototype.baseBuild=function(){this.direction=new THREE.Vector3,this.direction.subVectors(this.endCorner.position,this.startCorner.position),this.length=this.direction.length(),this.direction.normalize(),this.pathPoints.push(this.startCorner.position),this.pathPoints.push(this.endCorner.position),this.position.addVectors(this.endCorner.position,this.startCorner.position),this.position.divideScalar(2)},t.prototype.build=function(){},t.prototype.getWallOtherCorner=function(e){return this.startCorner===e?this.endCorner:this.endCorner===e?this.startCorner:null},t.prototype.sortDoorOrWins=function(){var e=this.startCorner.position,t=this.endCorner.position,r=t.x-e.x>0?1:-1,i=t.z-e.z>0?1:-1,n=!0;Math.abs(t.x-e.x)<.001&&(n=!1);for(var o=[],a=0;a<this.doorOrWindows.length;a++){for(var s=this.doorOrWindows[a],l=0;l<o.length;l++){var c=o[l];if((n?(c.position.x-s.position.x)*r:(c.position.z-s.position.z)*i)>=0){o.splice(l,0,s);break}if(l==o.length-1){o.push(s);break}}0===o.length&&o.push(s)}return o},t.prototype.getWallCornerByPos=function(e){for(var t=null,r=-1,i=this.subCorners,n=0;n<i.length;n++){var o=e.distanceTo(i[n].position);o<.01&&(null===t?(t=i[n],r=o):o<r&&(r=o,t=i[n]))}return t},t.prototype.getDoorOrWinStartAndEndPos=function(e){var t=e.size,r=this.direction,i=e.position.clone();i.y=0;var n=i.clone(),o=i.clone(),a=t.x/2;n.subVectors(n,r.clone().multiplyScalar(a)),o.addVectors(o,r.clone().multiplyScalar(a));return[n,o]},t.prototype.addSubWallCorner=function(e){for(var t=0;t<this.subCorners.length;t++){if(this.subCorners[t]===e)return}this.subCorners.push(e)},Gn(t,[{key:"worldPosition",get:function(){var e=this.startCorner.worldPosition,t=this.endCorner.worldPosition,r=new THREE.Vector3;return r.addVectors(e,t),r.divideScalar(2),r}}]),t}(Ro),Po=function e(){qn(this,e),this.positionArray=null,this.normalArray=null,this.uvArray=null,this.colorArray=null,this.uv2Array=null,this.indexArray=null,this.material=null,this.resource=null},Ao=function(e){function t(){qn(this,t);var r=Xn(this,e.call(this));return r.startCorner=null,r.endCorner=null,r.thick=Jn.StraightManualWallThick,r.height=Jn.StraightManualWallHeight,r.cornersVertices=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3],r.direction=null,r.pathPoints=[],r.selfPathPoints=[],r.upDirection=new THREE.Vector3(0,1,0),r.basePoints=null,r.repeatUV=[],r.uvMultiple=[1,1],r.rightSideLength=null,r.leftSideLength=null,r.floorPlanHeight=3,r.rightSideMeshInfo=new Po,r.leftSideMeshInfo=new Po,r.edgeSideMeshInfo=new Po,r.defaultWallTexture=null,r.rightWallTexture=null,r.leftWallTexture=null,r.startUVPercent=[0,0,0,0],r.endUVPercent=[1,1,1,1],r.wallGroup=null,r.leftResource=null,r.rightResource=null,r.edgeResource=null,r.lightMapResource=null,r.isBuilded=!1,r.vectorUp=new THREE.Vector3(0,1,0),r.onlyBuildMeshInfo=!1,r.downDirection=new THREE.Vector3(0,-1,0),r.enableLightMap=Jn.enableManaulWallLightMap,r.aoMapIntensity=Jn.wallLightMapIntensity,r}return Wn(t,e),t.prototype.leftResourceCallback=function(e){},t.prototype.rightResourceCallback=function(e){this.rigthWallTexture=e,this.isBuilded&&(this.wallGroup[0].material.texture=this.rigthWallTexture)},t.prototype.resourceCallback=function(e){e===this.leftResource?(this.leftWallTexture=e.texture,this.initLightMap(),this.isBuilded&&this.wallGroup&&(this.enableLightMap?this.wallGroup.children[1].material=this.leftResource.wallLightMaterial:this.wallGroup.children[1].material=this.leftResource.material,this.wallGroup.children[1].material.needsUpdate=!0)):e===this.rightResource&&(this.rigthWallTexture=e.texture,this.initLightMap(),this.isBuilded&&this.wallGroup&&(this.enableLightMap?this.wallGroup.children[0].material=this.leftResource.wallLightMaterial:this.wallGroup.children[0].material=this.leftResource.material))},t.prototype.initMaterial=function(){this.leftResource?this.leftResource.ready?this.leftWallTexture=this.leftResource.texture:this.leftResource.callbackObjects.push(this):this.leftWallTexture||(this.leftWallTexture=Qn.wallTexture),this.rightResource?this.rightResource.ready?this.rightWallTexture=this.rightResource.texture:this.rightResource.callbackObjects.push(this):this.rightWallTexture||(this.rightWallTexture=Qn.wallTexture),this.leftResource?(this.leftSideMeshInfo.resource=this.leftResource,this.leftSideMeshInfo.material=this.leftResource.material):this.leftSideMeshInfo.material=new THREE.MeshStandardMaterial({map:null}),this.rightResource?(this.rightSideMeshInfo.resource=this.rightResource,this.rightSideMeshInfo.material=this.rightResource.material):this.rightSideMeshInfo.material=new THREE.MeshStandardMaterial({map:null}),this.edgeResource?(this.edgeSideMeshInfo.resource=this.edgeResource,this.edgeSideMeshInfo.material=this.edgeResource.material):this.edgeSideMeshInfo.material=new THREE.MeshStandardMaterial({map:null}),this.initLightMap()},t.prototype.initLightMap=function(){this.lightMapResource&&this.enableLightMap&&(this.rightResource.ready&&(void 0===this.rightResource.wallLightMaterial&&(this.rightResource.wallLightMaterial=this.rightResource.wallMaterial.clone(),this.rightResource.wallLightMaterial.onBeforeCompile=function(e){e.fragmentShader=e.fragmentShader.replace("#include <aomap_fragment>",["#ifdef USE_AOMAP","float ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity * 0. + 1.6;","#if defined( USE_ENVMAP ) && defined( PHYSICAL )","float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );","reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );","#endif","#endif"].join("\n"))}),this.rightSideMeshInfo.material=this.rightResource.wallLightMaterial,this.rightSideMeshInfo.material.aoMap=this.lightMapResource.texture),this.leftResource.ready&&(void 0===this.leftResource.wallLightMaterial&&(this.leftResource.wallLightMaterial=this.leftResource.wallMaterial.clone(),this.leftResource.wallLightMaterial.onBeforeCompile=function(e){e.fragmentShader=e.fragmentShader.replace("#include <aomap_fragment>",["#ifdef USE_AOMAP","float ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity * 1. + 2.3;","#if defined( USE_ENVMAP ) && defined( PHYSICAL )","float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );","reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );","#endif","#endif"].join("\n"))}),this.leftSideMeshInfo.material=this.leftResource.wallLightMaterial,this.leftSideMeshInfo.material.aoMap=this.lightMapResource.texture))},t.prototype.build=function(){if(this.baseBuild(),this.calPosInfo(),this.calEachSideLen(),this.calRepeatUV(),this.calBasePoints(),this.fillMesh(),this.initMaterial(),!this.onlyBuildMeshInfo){var e=this.position,t=new THREE.Group("wall");t.add(this.createMesh(this.leftSideMeshInfo)),t.add(this.createMesh(this.rightSideMeshInfo)),t.add(this.createMesh(this.edgeSideMeshInfo)),t.position.set(e.x,e.y,e.z),this.wallGroup=t,this.mesh=this.wallGroup}this.isBuilded=!0},t.prototype.baseBuild=function(){this.direction=new THREE.Vector3,this.direction.subVectors(this.endCorner.position,this.startCorner.position),this.direction.normalize(),this.pathPoints.push(this.startCorner.position),this.pathPoints.push(this.endCorner.position)},t.prototype.calEachSideLen=function(){var e=new THREE.Vector3;e.subVectors(this.endCorner.position,this.startCorner.position),e.normalize();var t=this.thick/2,r=new THREE.Vector3;r.crossVectors(this.upDirection,e),r.normalize();var i=r.clone();i.negate();var n=r.clone();n.multiplyScalar(t);var o=i.clone();o.multiplyScalar(t);var a=new THREE.Vector3,s=new THREE.Vector3,l=new THREE.Vector3,c=new THREE.Vector3;$n.equalVectorZero(this.cornersVertices[0])?a.addVectors(this.selfPathPoints[0],n):a.copy(this.cornersVertices[0]),$n.equalVectorZero(this.cornersVertices[3])?s.addVectors(this.selfPathPoints[1],n):s.copy(this.cornersVertices[3]),$n.equalVectorZero(this.cornersVertices[1])?l.addVectors(this.selfPathPoints[0],o):l.copy(this.cornersVertices[1]),$n.equalVectorZero(this.cornersVertices[2])?c.addVectors(this.selfPathPoints[1],o):c.copy(this.cornersVertices[2]),this.rightSideLength=new THREE.Vector3,this.leftSideLength=new THREE.Vector3,this.rightSideLength.subVectors(a,s),this.leftSideLength.subVectors(l,c),this.rightSideLength=this.rightSideLength.length(),this.leftSideLength=this.leftSideLength.length()},t.prototype.calRepeatUV=function(){this.repeatUV[0]=this.uvMultiple[0]*this.rightSideLength/this.floorPlanHeight,this.repeatUV[1]=this.uvMultiple[1]*this.height/this.floorPlanHeight,this.repeatUV[2]=this.uvMultiple[0]*this.leftSideLength/this.floorPlanHeight,this.repeatUV[3]=this.uvMultiple[1]*this.height/this.floorPlanHeight},t.prototype.calPosInfo=function(){var e=new THREE.Vector3;this.selfPathPoints.push(e.subVectors(this.startCorner.position,this.position)),e=new THREE.Vector3,this.selfPathPoints.push(e.subVectors(this.endCorner.position,this.position)),this.selfPathPoints[0].y=0,this.selfPathPoints[1].y=0},t.prototype.calBasePoints=function(){if(null===this.basePoints){this.basePoints=[];for(var e=0;e<12;e++)this.basePoints.push(new THREE.Vector3)}var t=this.thick/2,r=new THREE.Vector3;r.crossVectors(this.upDirection,this.direction),r.normalize();var i=r.clone();i.negate();var n=r.multiplyScalar(t);$n.equalVectorZero(this.cornersVertices[0])?(this.basePoints[4].x=this.selfPathPoints[0].x+n.x,this.basePoints[4].y=0,this.basePoints[4].z=this.selfPathPoints[0].z+n.z):(this.basePoints[4].x=this.cornersVertices[0].x,this.basePoints[4].y=0,this.basePoints[4].z=this.cornersVertices[0].z),$n.equalVectorZero(this.cornersVertices[1])?(n=i.multiplyScalar(t),this.basePoints[5].x=this.selfPathPoints[0].x+n.x,this.basePoints[5].y=0,this.basePoints[5].z=this.selfPathPoints[0].z+n.z):(this.basePoints[5].x=this.cornersVertices[1].x,this.basePoints[5].y=0,this.basePoints[5].z=this.cornersVertices[1].z);var o=this.direction.clone();r.crossVectors(this.upDirection,o.negate()),r.normalize(),(i=r.clone()).negate(),$n.equalVectorZero(this.cornersVertices[2])?((n=r.clone()).multiplyScalar(t),this.basePoints[6].x=this.selfPathPoints[1].x+n.x,this.basePoints[6].y=0,this.basePoints[6].z=this.selfPathPoints[1].z+n.z):(this.basePoints[6].x=this.cornersVertices[2].x,this.basePoints[6].y=0,this.basePoints[6].z=this.cornersVertices[2].z),$n.equalVectorZero(this.cornersVertices[3])?((n=i.clone()).multiplyScalar(t),this.basePoints[7].x=this.selfPathPoints[1].x+n.x,this.basePoints[7].y=0,this.basePoints[7].z=this.selfPathPoints[1].z+n.z):(this.basePoints[7].x=this.cornersVertices[3].x,this.basePoints[7].y=0,this.basePoints[7].z=this.cornersVertices[3].z),this.basePoints[0].x=this.basePoints[4].x,this.basePoints[0].y=this.basePoints[4].y+this.height,this.basePoints[0].z=this.basePoints[4].z,this.basePoints[1].x=this.basePoints[5].x,this.basePoints[1].y=this.basePoints[5].y+this.height,this.basePoints[1].z=this.basePoints[5].z,this.basePoints[2].x=this.basePoints[6].x,this.basePoints[2].y=this.basePoints[6].y+this.height,this.basePoints[2].z=this.basePoints[6].z,this.basePoints[3].x=this.basePoints[7].x,this.basePoints[3].y=this.basePoints[7].y+this.height,this.basePoints[3].z=this.basePoints[7].z,this.basePoints[8].x=this.selfPathPoints[0].x,this.basePoints[8].y=this.selfPathPoints[0].y+this.height,this.basePoints[8].z=this.selfPathPoints[0].z,this.basePoints[9].x=this.selfPathPoints[1].x,this.basePoints[9].y=this.selfPathPoints[1].y+this.height,this.basePoints[9].z=this.selfPathPoints[1].z},t.prototype.fillMesh=function(){this.leftSideMeshInfo.positionArray=new Float32Array(18),this.leftSideMeshInfo.normalArray=new Float32Array(18),this.leftSideMeshInfo.uvArray=new Float32Array(12),this.leftSideMeshInfo.indexArray=new Float32Array(6),this.rightSideMeshInfo.positionArray=new Float32Array(18),this.rightSideMeshInfo.normalArray=new Float32Array(18),this.rightSideMeshInfo.uvArray=new Float32Array(12),this.rightSideMeshInfo.indexArray=new Float32Array(6),this.edgeSideMeshInfo.positionArray=new Float32Array(72),this.edgeSideMeshInfo.normalArray=new Float32Array(72),this.edgeSideMeshInfo.uvArray=new Float32Array(48),this.edgeSideMeshInfo.indexArray=new Float32Array(24),this.lightMapResource&&(this.leftSideMeshInfo.uv2Array=new Float32Array(12),this.rightSideMeshInfo.uv2Array=new Float32Array(12),this.leftSideMeshInfo.uv2Array=new Float32Array(12));for(u=0;u<6;u++)this.leftSideMeshInfo.indexArray[u]=u,this.rightSideMeshInfo.indexArray[u]=u;for(u=0;u<24;u++)this.edgeSideMeshInfo.indexArray[u]=u;var e=this.basePoints,t=0,r=new THREE.Vector3;r.crossVectors(this.upDirection,this.direction),r.normalize();var i=new THREE.Vector3;i.crossVectors(this.direction,this.upDirection),i.normalize();var n=this.direction,o=n.clone();o.negate();var a=new Array;a[t++]=e[0],a[t++]=e[3],a[t++]=e[7],a[t++]=e[0],a[t++]=e[7],a[t++]=e[4],a[t++]=e[2],a[t++]=e[1],a[t++]=e[5],a[t++]=e[2],a[t++]=e[5],a[t++]=e[6],a[t++]=e[0],a[t++]=e[1],a[t++]=e[2],a[t++]=e[0],a[t++]=e[2],a[t++]=e[3],0!==this.suspend&&(a[t++]=e[4],a[t++]=e[6],a[t++]=e[5],a[t++]=e[4],a[t++]=e[7],a[t++]=e[6]),a[t++]=e[1],a[t++]=e[0],a[t++]=e[4],a[t++]=e[1],a[t++]=e[4],a[t++]=e[5],a[t++]=e[3],a[t++]=e[2],a[t++]=e[7],a[t++]=e[2],a[t++]=e[6],a[t++]=e[7],a[t++]=e[1],a[t++]=e[0],a[t++]=e[8],a[t++]=e[3],a[t++]=e[2],a[t++]=e[9],t=0;var s=new Array;s[t++]=r,s[t++]=r,s[t++]=r,s[t++]=r,s[t++]=r,s[t++]=r;for(u=0;u<s.length;u++){var l=s[u],c=3*u;this.rightSideMeshInfo.normalArray[c]=l.x,this.rightSideMeshInfo.normalArray[c+1]=l.y,this.rightSideMeshInfo.normalArray[c+2]=l.z}s[t++]=i,s[t++]=i,s[t++]=i,s[t++]=i,s[t++]=i,s[t++]=i;for(var u=6,h=0;u<s.length;u++,h++){var l=s[u],c=3*h;this.leftSideMeshInfo.normalArray[c]=l.x,this.leftSideMeshInfo.normalArray[c+1]=l.y,this.leftSideMeshInfo.normalArray[c+2]=l.z}s[t++]=this.upDirection,s[t++]=this.upDirection,s[t++]=this.upDirection,s[t++]=this.upDirection,s[t++]=this.upDirection,s[t++]=this.upDirection,0!==this.suspend&&(s[t++]=this.downDirection,s[t++]=this.downDirection,s[t++]=this.downDirection,s[t++]=this.downDirection,s[t++]=this.downDirection,s[t++]=this.downDirection),s[t++]=o,s[t++]=o,s[t++]=o,s[t++]=o,s[t++]=o,s[t++]=o,s[t++]=n,s[t++]=n,s[t++]=n,s[t++]=n,s[t++]=n,s[t++]=n,s[t++]=this.upDirection,s[t++]=this.upDirection,s[t++]=this.upDirection,s[t++]=this.upDirection,s[t++]=this.upDirection,s[t++]=this.upDirection;for(u=0;u<6;u++){var l=a[u],c=3*u;this.rightSideMeshInfo.positionArray[c]=l.x,this.rightSideMeshInfo.positionArray[c+1]=l.y+this.suspend,this.rightSideMeshInfo.positionArray[c+2]=l.z}for(var u=6,h=0;u<12;u++,h++){var l=a[u],c=3*h;this.leftSideMeshInfo.positionArray[c]=l.x,this.leftSideMeshInfo.positionArray[c+1]=l.y+this.suspend,this.leftSideMeshInfo.positionArray[c+2]=l.z}for(var u=12,h=0;u<a.length;u++,h++){var l=a[u],c=3*h;this.edgeSideMeshInfo.positionArray[c]=l.x,this.edgeSideMeshInfo.positionArray[c+1]=l.y+this.suspend,this.edgeSideMeshInfo.positionArray[c+2]=l.z}for(var u=12,h=0;u<s.length;u++,h++){var l=s[u],c=3*h;this.edgeSideMeshInfo.normalArray[c]=l.x,this.edgeSideMeshInfo.normalArray[c+1]=l.y,this.edgeSideMeshInfo.normalArray[c+2]=l.z}this.fillUV()},t.prototype.fillUV=function(){var e,t,r,i,n=0;this.rightResource.isDefault?(e=this.startUVPercent[0],t=this.startUVPercent[1],r=this.endUVPercent[0],i=this.endUVPercent[1]):(e=this.startUVPercent[0]*this.repeatUV[0],t=this.startUVPercent[1]*this.repeatUV[1],r=this.endUVPercent[0]*this.repeatUV[0],i=this.endUVPercent[1]*this.repeatUV[1]);o=this.rightSideMeshInfo.uvArray;o[n++]=e,o[n++]=i,o[n++]=r,o[n++]=i,o[n++]=r,o[n++]=t,o[n++]=e,o[n++]=i,o[n++]=r,o[n++]=t,o[n++]=e,o[n++]=t,this.leftResource.isDefault?(e=this.startUVPercent[2],t=this.startUVPercent[3],r=this.endUVPercent[2],i=this.endUVPercent[3]):(e=this.startUVPercent[2]*this.repeatUV[2],t=this.startUVPercent[3]*this.repeatUV[3],r=this.endUVPercent[2]*this.repeatUV[2],i=this.endUVPercent[3]*this.repeatUV[3]),n=0;(o=this.leftSideMeshInfo.uvArray)[n++]=r,o[n++]=i,o[n++]=e,o[n++]=i,o[n++]=e,o[n++]=t,o[n++]=r,o[n++]=i,o[n++]=e,o[n++]=t,o[n++]=r,o[n++]=t,n=0;var o;(o=this.edgeSideMeshInfo.uvArray)[n++]=0,o[n++]=1,o[n++]=1,o[n++]=1,o[n++]=1,o[n++]=0,o[n++]=0,o[n++]=1,o[n++]=1,o[n++]=0,o[n++]=0,o[n++]=0,o[n++]=0,o[n++]=1,o[n++]=1,o[n++]=1,o[n++]=1,o[n++]=0,o[n++]=0,o[n++]=1,o[n++]=1,o[n++]=0,o[n++]=0,o[n++]=0,o[n++]=0,o[n++]=1,o[n++]=1,o[n++]=1,o[n++]=0,o[n++]=0,o[n++]=1,o[n++]=1,o[n++]=1,o[n++]=0,o[n++]=0,o[n++]=0,o[n++]=0,o[n++]=1,o[n++]=1,o[n++]=1,o[n++]=0,o[n++]=0,o[n++]=0,o[n++]=1,o[n++]=1,o[n++]=1,o[n++]=0,o[n++]=0,this.lightMapResource&&(e=this.startUVPercent[0],t=this.startUVPercent[1],r=this.endUVPercent[0],i=this.endUVPercent[1],n=0,(o=this.rightSideMeshInfo.uv2Array)[n++]=e,o[n++]=i,o[n++]=r,o[n++]=i,o[n++]=r,o[n++]=t,o[n++]=e,o[n++]=i,o[n++]=r,o[n++]=t,o[n++]=e,o[n++]=t,n=0,(o=this.leftSideMeshInfo.uv2Array)[n++]=r,o[n++]=i,o[n++]=e,o[n++]=i,o[n++]=e,o[n++]=t,o[n++]=r,o[n++]=i,o[n++]=e,o[n++]=t,o[n++]=r,o[n++]=t)},t.prototype.getWallOtherCorner=function(e){return this.startCorner===e?this.endCorner:this.endCorner===e?this.startCorner:null},t.prototype.createMesh=function(e){var t=new THREE.BufferGeometry;t.addAttribute("position",new THREE.BufferAttribute(e.positionArray,3)),t.addAttribute("normal",new THREE.BufferAttribute(e.normalArray,3)),t.addAttribute("uv",new THREE.BufferAttribute(e.uvArray,2));var r=e.material;this.lightMapResource&&e.uv2Array&&this.enableLightMap&&t.addAttribute("uv2",new THREE.BufferAttribute(e.uv2Array,2)),e.material=r;return new THREE.Mesh(t,r)},Gn(t,[{key:"position",get:function(){var e=this.startCorner.position,t=this.endCorner.position,r=new THREE.Vector3;return r.addVectors(e,t),r.divideScalar(2),r},set:function(e){}}]),t}(So),Co=function(e){function t(){return qn(this,t),Xn(this,e.call(this))}return Wn(t,e),t.prototype.build=function(){if(this.baseBuild(),this.calPosInfo(),this.calBasePoints(),this.fillMesh(),this.initMaterial(),!this.enableDelayLoadMode){var e=this.position,t=new THREE.Group("wall");t.add(this.createMesh(this.leftSideMeshInfo)),t.add(this.createMesh(this.rightSideMeshInfo)),t.add(this.createMesh(this.edgeSideMeshInfo)),t.position.set(e.x,e.y,e.z),this.wallGroup=t,this.mesh=this.wallGroup}this.isBuilded=!0},t}(Ao),Lo=function(e){function t(){return qn(this,t),Xn(this,e.call(this))}return Wn(t,e),t.prototype.initSimpleCornersAndWalls=function(){var e=this.position;(new THREE.Vector3).crossVectors(this.direction,this.vectorUp);for(var t=this.sortDoorOrWins(),r=0;r<t.length;r++){var i=t[r],n=this.getDoorOrWinStartAndEndPos(i),o=this.getDoorOrWinRectPoints(i),a=Oo.createSubWallCorner(this.id+"_"+r+"_1",n[0],this),s=Oo.createSubWallCorner(this.id+"_"+r+"_2",n[1],this);if(this.addSubWallCorner(a),this.addSubWallCorner(s),0===r){var l=new Co;this.subWalls.push(l),l.startCorner=this.startCorner,l.endCorner=a,l.startCorner.build(),l.endCorner.build(),this.setCornerVertices(l,!0),l.calPosInfo(),l.calEachSideLen(),l.endUVPercent[0]=l.rightSideLength/this.rightSideLength,l.endUVPercent[2]=l.leftSideLength/this.leftSideLength,l.repeatUV=this.repeatUV,l.leftResource=this.leftResource,l.rightResource=this.rightResource,l.edgeResource=this.edgeResource,l.lightMapResource=this.lightMapResource,l.height=this.height,l.parentWall=this}else{var c=t[r-1],u=this.getDoorOrWinStartAndEndPos(c),h=this.getDoorOrWinRectPoints(c),p=this.getWallCornerByPos(u[1]),d=new Co;this.subWalls.push(d),d.startCorner=p,d.endCorner=a;var f=new THREE.Vector3;f.subVectors(p.position,a.position);var m=f.length();d.startCorner.build(),d.endCorner.build(),d.calPosInfo(),d.calEachSideLen();var g=h[3].distanceTo(e.clone().addVectors(this.cornersVertices[0],e)),v=h[2].distanceTo(e.clone().addVectors(this.cornersVertices[1],e));d.startUVPercent[0]=g/this.rightSideLength,d.startUVPercent[2]=v/this.leftSideLength,d.endUVPercent[0]=(g+m)/this.rightSideLength,d.endUVPercent[2]=(v+m)/this.leftSideLength,d.repeatUV=this.repeatUV,d.leftResource=this.leftResource,d.rightResource=this.rightResource,d.edgeResource=this.edgeResource,d.lightMapResource=this.lightMapResource,d.height=this.height,d.parentWall=this}if(r==t.length-1){var y=new Co;this.subWalls.push(y),y.startCorner=s,y.endCorner=this.endCorner,y.startCorner.build(),this.setCornerVertices(y,!1),y.calPosInfo(),y.calEachSideLen();var g=o[3].distanceTo(e.clone().addVectors(this.cornersVertices[0],e)),v=o[2].distanceTo(e.clone().addVectors(this.cornersVertices[1],e));y.startUVPercent[0]=g/this.rightSideLength,y.startUVPercent[2]=v/this.leftSideLength,y.repeatUV=this.repeatUV,y.leftResource=this.leftResource,y.rightResource=this.rightResource,y.edgeResource=this.edgeResource,y.lightMapResource=this.lightMapResource,y.height=this.height,y.parentWall=this}this.buildHeadAndFootWall(i,a,s)}},t.prototype.buildSimpleCornersAndWalls=function(){this.enableDelayLoadMode||(this.wallGroup=new THREE.Object3D);for(e=0;e<this.subCorners.length;e++){this.subCorners[e].build()}for(var e=0;e<this.subWalls.length;e++){var t=this.subWalls[e];t.build(),this.enableDelayLoadMode||this.wallGroup.add(t.wallGroup)}this.mesh=this.wallGroup},t.prototype.buildHeadAndFootWall=function(e,t,r){var i=this.position,n=this.getDoorOrWinRectPoints(e),o=n[0].distanceTo(i.clone().addVectors(this.cornersVertices[0],i)),a=n[1].distanceTo(i.clone().addVectors(this.cornersVertices[1],i)),s=e.suspendPercent;(new THREE.Vector3).crossVectors(this.direction,this.vectorUp);var l=e.size.y+this.height*s;if(0!==e.suspendPercent){var c=new Co;this.subWalls.push(c),c.parent=this.parent,c.startCorner=t,c.endCorner=r;(h=new THREE.Vector3).subVectors(r.position,t.position);p=h.length();c.height=this.height*s,c.startUVPercent=[o/this.rightSideLength,0,a/this.leftSideLength,0],c.endUVPercent[0]=(o+p)/this.rightSideLength,c.endUVPercent[1]=c.height/this.height,c.endUVPercent[2]=(a+p)/this.leftSideLength,c.endUVPercent[3]=c.height/this.height,c.uvMultiple=this.uvMultiple,c.repeatUV=this.repeatUV,c.leftResource=this.leftResource,c.rightResource=this.rightResource,c.edgeResource=this.edgeResource,c.lightMapResource=this.lightMapResource,c.parentWall=this}if(l<this.height){var u=new Co;this.subWalls.push(u),u.parent=this.parent,u.startCorner=t,u.endCorner=r;var h=new THREE.Vector3;h.subVectors(r.position,t.position);var p=h.length();u.suspend=l,u.height=this.height-l,u.startUVPercent=[o/this.rightSideLength,l/this.height,a/this.leftSideLength,l/this.height],u.endUVPercent[0]=(o+p)/this.rightSideLength,u.endUVPercent[2]=(a+p)/this.leftSideLength,u.uvMultiple=this.uvMultiple,u.repeatUV=this.repeatUV,u.leftResource=this.leftResource,u.rightResource=this.rightResource,u.edgeResource=this.edgeResource,u.lightMapResource=this.lightMapResource,u.parentWall=this}},t.prototype.setCornerVertices=function(e,t){if(t){(r=new THREE.Vector3).addVectors(this.cornersVertices[0],this.position),r.sub(e.position);(i=new THREE.Vector3).addVectors(this.cornersVertices[1],this.position),i.sub(e.position),e.cornersVertices[0]=r,e.cornersVertices[1]=i}else{var r=new THREE.Vector3;r.addVectors(this.cornersVertices[2],this.position),r.sub(e.position);var i=new THREE.Vector3;i.addVectors(this.cornersVertices[3],this.position),i.sub(e.position),e.cornersVertices[2]=r,e.cornersVertices[3]=i}},t.prototype.getDoorOrWinRectPoints=function(e){var t=this.thick/2,r=new THREE.Vector3;r.crossVectors(this.vectorUp,this.direction),r.normalize();var i=r.clone();i.negate();this.vectorUp.clone().multiplyScalar(t);var n=e.size,o=this.direction,a=e.position,s=n.x/2,l=new THREE.Vector3,c=new THREE.Vector3;l.subVectors(a,o.clone().multiplyScalar(s)),c.addVectors(a,o.clone().multiplyScalar(s));return[l.clone().addVectors(l,r.clone().multiplyScalar(t)),l.clone().addVectors(l,i.clone().multiplyScalar(t)),c.clone().addVectors(c,i.clone().multiplyScalar(t)),c.clone().addVectors(c,r.clone().multiplyScalar(t))]},t}(Ao),Oo=function(e){function t(){return qn(this,t),Xn(this,e.call(this))}return Wn(t,e),t.createSubWallCorner=function(e,r,i){var n=new t;return n.id=e,n.position=r,n.parent=i.parent,n},t.prototype.isFirstWallShouldNotCal=function(e){return!(e instanceof Co)},t.prototype.isSecondWallShouldNotCal=function(e){return e&&!(e instanceof Co)},t}(function(e){function t(r,i,n){qn(this,t);var o=Xn(this,e.call(this));return o.walls=[],o.position=new THREE.Vector3(r,i,n),o}return Wn(t,e),t.prototype.addWall=function(e){for(var t=0,r=this.walls.length;t<r;t++)if(this.walls[t]===e)return void console.error("repeat wall"+e);this.walls.push(e)},t.prototype.build=function(){this.calVertices()},t.prototype.isFirstWallShouldNotCal=function(e){return!(e instanceof Lo)||e instanceof Co},t.prototype.isSecondWallShouldNotCal=function(e){return null!=e&&(e.resource&&e.resource.isModel||e instanceof Co)},t.prototype.calVertices=function(){var e=this.walls,t=new THREE.Vector3(0,1,0);if(1===e.length){var r=e[0];r instanceof Lo&&this.setDefaultCornerVertices(r)}else{this.sortWalls();for(var i=0;i<e.length;i++){var n=e[i];if(!this.isFirstWallShouldNotCal(n)){for(var o=null,a=i;null==o&&(a===e.length-1?a=0:a+=1,e[a]!==n);)o=e[a],this.isSecondWallShouldNotCal(o)&&(o=null);if(o){var s=n.getWallOtherCorner(this).position,l=new THREE.Vector3;l.subVectors(s,this.position),s=o.getWallOtherCorner(this).position;var c=new THREE.Vector3;if(c.subVectors(s,this.position),l.normalize(),c.normalize(),0!==l.length()&&0!==c.length()){var u=n.thick/2,h=new THREE.Vector3;h.crossVectors(t,l),h.normalize();var p=h.clone();p.multiplyScalar(u),p.add(this.position),u=o.thick/2;var d=c.clone();d.cross(t),d.normalize();var f=d.clone();f.multiplyScalar(u),f.add(this.position),this.setCornersVertices(n,p,!0),this.setCornersVertices(o,f,!1),l.normalize(),c.normalize();if(this.calAngle(l,c)>30){var m;if(1===Math.abs(l.dot(c))){var g=l.clone();g.cross(t),g.normalize(),this.setDefaultCornerVertices(n,!0),this.setDefaultCornerVertices(o,!0);continue}if(0!==(m=this.getIntersectPosition(p,l,f,c)).x||0!==m.y||0!==m.z){m.clone().y=this.position.y+this.getWallHeight(),this.setCornersVertices(n,m,!0),this.setCornersVertices(o,m,!1)}}else this.setCornersVertices(n,p,!0),this.setCornersVertices(o,f,!1)}else this.setDefaultCornerVertices(n,!0),this.setDefaultCornerVertices(o,!1)}else this.setDefaultCornerVertices(n)}}}},t.prototype.sortWalls=function(){var e=this.walls;if(e.length>1)for(var t,r,i=e[0],n=0,o=e.length-1;n<o;){for(r=n;r<o;++r)this.angleBetween(i,e[r])>this.angleBetween(i,e[r+1])&&(t=e[r],e[r]=e[r+1],e[r+1]=t);for(r=--o;r>n;--r)this.angleBetween(i,e[r])<this.angleBetween(i,e[r-1])&&(t=e[r],e[r]=e[r-1],e[r-1]=t);++n}},t.prototype.angleBetween=function(e,t){var r=e.getWallOtherCorner(this).position.clone();r.sub(this.position);var i=t.getWallOtherCorner(this).position.clone();return i.sub(this.position),this.calAngle(r,i)},t.prototype.calAngle=function(e,t){e.normalize(),t.normalize();var r=e.angleTo(t);r*=180/Math.PI;var i=e.clone();return i.cross(t),i.y<0&&(r=360-r),r},t.prototype.getWallHeight=function(){for(var e=99999,t=0;t<this.walls.length;t++){var r=this.walls[t];e>r.height&&(e=r.height)}return e},t.prototype.setCornersVertices=function(e,t,r){var i=new THREE.Vector3(0,0,0);i.x=t.x-e.position.x,i.y=t.y-e.position.y,i.z=t.z-e.position.z,e.startCorner===this?r?(e.cornersVertices[0].x=i.x,e.cornersVertices[0].y=i.y,e.cornersVertices[0].z=i.z):(e.cornersVertices[1].x=i.x,e.cornersVertices[1].y=i.y,e.cornersVertices[1].z=i.z):r?(e.cornersVertices[2].x=i.x,e.cornersVertices[2].y=i.y,e.cornersVertices[2].z=i.z):(e.cornersVertices[3].x=i.x,e.cornersVertices[3].y=i.y,e.cornersVertices[3].z=i.z)},t.prototype.setDefaultCornerVertices=function(e,t){var r=new THREE.Vector3(0,1,0),i=e.getWallOtherCorner(this).position.clone();i.sub(this.position),i.normalize();var n=e.thick/2,o=r.clone();o.cross(i),o.normalize(),o.multiplyScalar(n);var a=new THREE.Vector3;a.addVectors(this.position,o);var s=new THREE.Vector3;s.subVectors(this.position,o),void 0===t?(this.setCornersVertices(e,a,!0),this.setCornersVertices(e,s,!1)):t?this.setCornersVertices(e,a,!0):this.setCornersVertices(e,s,!1)},t.prototype.getIntersectPosition=function(e,t,r,i){if(e.x===r.x&&e.y===r.y&&e.z===r.z)return e;var n=e.y;if(1===t.dot(i))throw"two line in same direction ,can not cal intersected position!";var o=new THREE.Vector3,a=new THREE.Vector3;o.addVectors(e,t),a.addVectors(r,i);var s=new THREE.Vector2(e.x,e.z),l=new THREE.Vector2(o.x,o.z),c=new THREE.Vector2(r.x,r.z),u=new THREE.Vector2(a.x,a.z),h=(l.y-s.y)*(u.x-c.x)-(s.x-l.x)*(c.y-u.y);if(0==h)return new THREE.Vector3;var p=((l.x-s.x)*(u.x-c.x)*(c.y-s.y)+(l.y-s.y)*(u.x-c.x)*s.x-(u.y-c.y)*(l.x-s.x)*c.x)/h,d=-((l.y-s.y)*(u.y-c.y)*(c.x-s.x)+(l.x-s.x)*(u.y-c.y)*s.y-(u.x-c.x)*(l.y-s.y)*c.y)/h;return new THREE.Vector3(p,n,d)},t}(Ro)),Ho=function(e){function t(){qn(this,t);var r=Xn(this,e.call(this));return r.resource=null,r.model=null,r.objPositions=[],r.objLocalPositions=[],r.objRotations=[],r.objScales=[],r.modelSize=new THREE.Vector3,r.box=new THREE.Box3,r.heightRatio=1,r.modelNumber=-1,r.models=[],r.mesh=new THREE.Object3D,r.wallGroup=r.mesh,r.subWalls=[],r.subCorners=[],r}return Wn(t,e),t.prototype.build=function(){this.baseBuild(),this.resource&&(this.resource.ready||Jn.enableCombine?this.model=this.resource.model:this.resource.registerListener(this)),null!==this.model&&(this.calObjInfo(),this.enableBuildMesh&&this.instanceModels())},t.prototype.resourceCallback=function(e){this.model=e.model,this.calObjInfo(),this.instanceModels()},t.prototype.instanceModels=function(){if(null!==this.model){this.models=[];for(var e=this.modelNumber,t=0;t<e;t++){var r=this.model.clone(),i=this.objPositions[t],n=this.objRotations[t],o=this.objScales[t];r.position.set(i.x,i.y,i.z),r.quaternion.set(n.x,n.y,n.z,n.w),r.scale.set(o.x,o.y,o.z),this.mesh.add(r),this.models.push(r)}}},t.prototype.calObjInfo=function(){if(this.objPositions=[],this.objRotations=[],this.objScales=[],null!==this.model){this.box.makeEmpty(),this.box=this.box.setFromObject(this.model),this.modelSize=this.box.getSize(new THREE.Vector3(0,0,0)),this.height=this.modelSize.y,-1===this.height?this.height=this.modelSize.y:0!==this.modelSize.y?this.heightRatio=this.height/this.modelSize.y:(console.warn("model size is zero "+this.resource.id),this.height=3);var e=new THREE.Vector3(0,1,0),t=this.modelSize.x,r=(this.modelSize.z,this.modelSize.y),i=this.length/t,n=parseInt(i),o=Math.ceil(i);this.modelNumber=o;var a=o*t,s=new THREE.Vector3,l=this.direction.clone();s.addVectors(this.startCorner.position,l.multiplyScalar(a));var c=new THREE.Vector3;c.crossVectors(this.direction,e),c.normalize();var u=new THREE.Quaternion;0===c.x&&0===c.y&&0===c.z||u.setFromUnitVectors(new THREE.Vector3(0,0,1),c);var h=.5*t,p=new THREE.Vector3(h,0,0);this.position;p.applyQuaternion(u);for(var d=0;d<o;d++){var f=d/o,m=new THREE.Vector3;m.lerpVectors(this.startCorner.position,s,f);var g=new THREE.Vector3;g.addVectors(p,m),this.objPositions.push(g),this.objRotations.push(u);var v=new THREE.Vector3(1,this.height/r,1);this.objScales.push(v)}var y=(i-n)*t,E=y/t;if(o>0&&y>0){this.objScales[o-1]=new THREE.Vector3(E,this.height/r,1);var b=h,x=new THREE.Vector3(-b*(1-E),0,0);x.applyQuaternion(u),this.objPositions[o-1].add(x)}}},t}(So),Fo=function(e){function t(){qn(this,t);var r=Xn(this,e.call(this));return r.resource=null,r.model=null,r.objPositions=[],r.objLocalPositions=[],r.objRotations=[],r.objScales=[],r.modelSize=new THREE.Vector3,r.box=new THREE.Box3,r.heightRatio=1,r.modelNumber=-1,r.models=[],r.mesh=new THREE.Object3D,r.wallGroup=r.mesh,r.subWalls=[],r.subCorners=[],r}return Wn(t,e),t.prototype.build=function(){this.baseBuild(),this.resource&&(this.resource.ready||Jn.enableCombine?this.model=this.resource.model:this.resource.registerListener(this)),null===this.model&&Jn.enableCombine||(this.calObjInfo(),this.enableBuildMesh&&this.instanceModels())},t.prototype.resourceCallback=function(e){this.model=e.model,this.calObjInfo(),this.instanceModels()},t.prototype.instanceModels=function(){if(null!==this.model){this.models=[];for(var e=this.modelNumber,t=0;t<e;t++){var r=this.model.clone(),i=this.objPositions[t],n=this.objRotations[t],o=this.objScales[t];r.position.set(i.x,i.y,i.z),r.quaternion.set(n.x,n.y,n.z,n.w),r.scale.set(o.x,o.y,o.z),this.mesh.add(r),this.models.push(r)}}},t.prototype.calObjInfo=function(){if(this.objPositions=[],this.objRotations=[],this.objScales=[],null!==this.model)if(this.box.makeEmpty(),this.box=this.box.setFromObject(this.model),this.modelSize=this.box.getSize(new THREE.Vector3(0,0,0)),-1===this.height?this.height=this.modelSize.y:0!==this.modelSize.y?this.heightRatio=this.height/this.modelSize.y:(console.warn("model size is zero "+this.resource.id),this.height=3),0!==this.height){var e=new THREE.Vector3(0,1,0),t=this.modelSize.x,r=(this.modelSize.z,this.modelSize.y),i=this.length/t,n=parseInt(i),o=Math.ceil(i);this.modelNumber=o;var a=o*t,s=new THREE.Vector3,l=this.direction.clone();s.addVectors(this.startCorner.position,l.multiplyScalar(a));var c=new THREE.Vector3;c.crossVectors(this.direction,e),c.normalize();var u=new THREE.Quaternion;0===c.x&&0===c.y&&0===c.z||u.setFromUnitVectors(new THREE.Vector3(0,0,1),c);var h=.5*t,p=new THREE.Vector3(h,0,0);this.position;p.applyQuaternion(u);for(var d=0;d<o;d++){var f=d/o,m=new THREE.Vector3;m.lerpVectors(this.startCorner.position,s,f);var g=new THREE.Vector3;g.addVectors(p,m),this.objPositions.push(g),this.objRotations.push(u);var v=new THREE.Vector3(1,this.height/r,1);this.objScales.push(v)}var y=(i-n)*t,E=y/t;if(o>0&&y>0){this.objScales[o-1]=new THREE.Vector3(E,this.height/r,1);var b=h,x=new THREE.Vector3(-b*(1-E),0,0);x.applyQuaternion(u),this.objPositions[o-1].add(x)}}else console.error("size is zero")},t.prototype.initSimpleCornersAndWalls=function(){for(var e=this.sortDoorOrWins(),t=0;t<e.length;t++){var r=e[t],i=this.getDoorOrWinStartAndEndPos(r),n=Oo.createSubWallCorner(this.id+"_"+t+"_1",i[0],this),o=Oo.createSubWallCorner(this.id+"_"+t+"_2",i[1],this);if(this.addSubWallCorner(n),this.addSubWallCorner(o),0===t){var a=new Ho;a.resource=this.resource,this.subWalls.push(a),a.startCorner=this.startCorner,a.endCorner=n,a.startCorner.build(),a.endCorner.build(),a.parentWall=this,a.height=this.height}else{var s=e[t-1],l=this.getDoorOrWinStartAndEndPos(s),c=this.getWallCornerByPos(l[1]),u=new Ho;u.resource=this.resource,this.subWalls.push(u),u.startCorner=c,u.endCorner=n,u.startCorner.build(),u.endCorner.build(),u.parentWall=this,u.height=this.height}if(t==e.length-1){var h=new Ho;h.resource=this.resource,this.subWalls.push(h),h.startCorner=o,h.endCorner=this.endCorner,h.startCorner.build(),h.parentWall=this,h.height=this.height}}},t.prototype.buildSimpleCornersAndWalls=function(){this.wallGroup=new THREE.Object3D;for(e=0;e<this.subCorners.length;e++){this.subCorners[e].build()}for(var e=0;e<this.subWalls.length;e++){var t=this.subWalls[e];t.build(),this.wallGroup.add(t.wallGroup)}},t}(So),Io=function(e){function t(){qn(this,t);var r=Xn(this,e.call(this));return r.resource=null,r.mesh=new THREE.Object3D,r.groups=[],r.placements=[],r.delayObject=new THREE.Object3D,r}return Wn(t,e),t.prototype.build=function(){for(t=0;t<this.groups.length;t++){var e=this.groups[t];e.build(),this.mesh.add(e.delayObject)}for(var t=0;t<this.placements.length;t++){var r=this.placements[t];r.build(),this.mesh.add(r.delayObject)}this.mesh.position.set(this.position.x,this.position.y,this.position.z),this.mesh.quaternion.set(this.rotation.x,this.rotation.y,this.rotation.z,this.rotation.w),this.mesh.scale.set(this.scale.x,this.scale.y,this.scale.z),this.delayObject.add(this.mesh)},t}(Kn),ko=function(){function e(t,r){qn(this,e),this.vertexCount=0,this.indexCount=0,this.material=t,this.bundeMeshs=[],this.groups=[],this.transformations=[],this.maxCount=65534,this.combineMesh=null,this.combineManager=r}return e.prototype.isExceed=function(e){return this.vertexCount+e>this.maxCount},e.prototype.build=function(){for(var e=this.bundeMeshs,t=this.indexCount,r=this.vertexCount,i=new Float32Array(3*r),n=new Float32Array(3*r),o=new Float32Array(2*r),a=new Float32Array(4*r),s=new Float32Array(2*r),l=new Uint16Array(t),c=0,u=0,h=0,p=0,d=0,f=new THREE.BufferGeometry,m=0;m<e.length;m++){for(var g=e[m],v=this.transformations[m],y=v.positions,E=v.scales,b=v.quaternions,x=g.indexArray,_=0;_<x.length;_++)l[_+p]=c/3+x[_];p+=x.length;for(var w=g.positionArray,_=0;_<w.length;){for(var T=new THREE.Vector3(w[_],w[_+1],w[_+2]),M=y.length-1;M>-1;M--){var R=y[M],S=E[M],P=b[M];T.x*=S.x,T.y*=S.y,T.z*=S.z,(T=T.applyQuaternion(P)).x+=R.x,T.y+=R.y,T.z+=R.z}i[_+c]=T.x,i[_+c+1]=T.y,i[_+c+2]=T.z,_+=3}c+=w.length;for(var A=g.normalArray,_=0;_<A.length;){for(var C=new THREE.Vector3(A[_],A[_+1],A[_+2]),M=b.length-1;M>-1;M--){P=b[M];C=C.applyQuaternion(P)}n[_+u]=C.x,n[_+u+1]=C.y,n[_+u+2]=C.z,_+=3}u+=A.length;var L=g.uvArray;if(L)for(_=0;_<L.length;_++)o[_+h]=L[_];var O=g.uv2Array;if(O)for(_=0;_<O.length;_++)s[_+h]=O[_];L&&(h+=L.length);var H=g.colorArray;if(H){for(_=0;_<H.length;_++)a[_+d]=H[_];d+=H.length}}f.addAttribute("position",new THREE.BufferAttribute(i,3)),f.addAttribute("normal",new THREE.BufferAttribute(n,3)),f.addAttribute("uv",new THREE.BufferAttribute(o,2)),0!==s.length&&f.addAttribute("uv2",new THREE.BufferAttribute(s,2)),0!==a.length&&f.addAttribute("color",new THREE.BufferAttribute(a,4)),f.setIndex(new THREE.BufferAttribute(l,1));var F=new THREE.Mesh(f,this.material);this.material.defines&&this.material.defines.USE_ALPHAINDEX&&delete this.material.defines.USE_ALPHAINDEX,F.name="combine",this.combineMesh=F},e}(),Do=function(e){function t(r,i){return qn(this,t),Xn(this,e.call(this,r,i))}return Wn(t,e),t.prototype.add=function(e,t){if(this.isExceed(e.vertexCount))return console.error("combine exceed vertex count "),!1;this.vertexCount+=e.vertexCount,this.indexCount+=e.indexCount,this.bundeMeshs.push(e),this.transformations.push(t)},t.prototype.build=function(){for(var e=this.bundeMeshs,t=this.indexCount,r=this.vertexCount,i=[],n=new Float32Array(3*r),o=new Float32Array(3*r),a=new Float32Array(2*r),s=new Float32Array(4*r),l=new Float32Array(1*r),c=new Float32Array(2*r),u=new Float32Array(2*r),h=new Uint16Array(t),p=0,d=0,f=0,m=0,g=0,v=0,y=new THREE.BufferGeometry,E=0,b=0;b<e.length;b++){var x=e[b],_=this.transformations[b],w=_.positions,T=_.scales,M=_.quaternions,R=x.indexArray;if(x.groups.length>0){var S=x.groups.slice(0);S.forEach(function(e){e.start+=E}),i=i.concat(S)}E+=R.length;for(A=0;A<R.length;A++)h[A+m]=p/3+R[A];m+=R.length;for(var P=x.positionArray,A=0;A<P.length;){for(var C=new THREE.Vector3(P[A],P[A+1],P[A+2]),L=w.length-1;L>-1;L--){var O=w[L],H=T[L],F=M[L];C.x*=H.x,C.y*=H.y,C.z*=H.z,(C=C.applyQuaternion(F)).x+=O.x,C.y+=O.y,C.z+=O.z}n[A+p]=C.x,n[A+p+1]=C.y,n[A+p+2]=C.z,A+=3}p+=P.length;for(var I=x.normalArray,A=0;A<I.length;){for(var k=new THREE.Vector3(I[A],I[A+1],I[A+2]),L=M.length-1;L>-1;L--){F=M[L];k=k.applyQuaternion(F)}o[A+d]=k.x,o[A+d+1]=k.y,o[A+d+2]=k.z,A+=3}d+=I.length;var D=x.uvArray;if(D)for(A=0;A<D.length;A++)a[A+f]=D[A];var N=x.uv2Array;if(N)for(A=0;A<N.length;A++)c[A+f]=N[A];var j=x.uv3Array;if(j)for(A=0;A<j.length;A++)u[A+f]=j[A];D&&(f+=D.length);var U=x.colorArray;if(U){for(A=0;A<U.length;A++)s[A+g]=U[A];g+=U.length;for(A=3;A<U.length;A+=4)l[(A-3)/4+v]=U[A];v+=U.length/4}}y.addAttribute("position",new THREE.BufferAttribute(n,3)),y.addAttribute("normal",new THREE.BufferAttribute(o,3)),y.addAttribute("uv",new THREE.BufferAttribute(a,2)),0!==c.length&&y.addAttribute("uv2",new THREE.BufferAttribute(c,2)),0!==u.length&&y.addAttribute("uv3",new THREE.BufferAttribute(u,2)),0!==s.length&&y.addAttribute("color",new THREE.BufferAttribute(s,4)),0!==l.length&&y.addAttribute("alphaIndex",new THREE.BufferAttribute(l,1)),y.setIndex(new THREE.BufferAttribute(h,1)),y.groups=i;var B=new THREE.Mesh(y,this.material);B.name="combine",this.combineMesh=B,this.combineMesh.name="mesh"},t}(ko),No=function(){function e(){qn(this,e),this.positions=[],this.scales=[],this.quaternions=[]}return e.prototype.clone=function(){var t=new e;return t.positions=this.positions.slice(),t.scales=this.scales.slice(),t.quaternions=this.quaternions.slice(),t},e}(),jo=function(e){function t(r,i){qn(this,t);var n=Xn(this,e.call(this,r,i));return n.meshInfos=[],n}return Wn(t,e),t.prototype.add=function(e){if(this.isExceed(e.indexArray.length))return console.error("combine exceed vertex count "),!1;this.vertexCount+=e.indexArray.length,this.indexCount+=e.indexArray.length,this.meshInfos.push(e)},t.prototype.build=function(){for(var e=this.meshInfos,t=this.indexCount,r=this.vertexCount,i=new Float32Array(3*r),n=new Float32Array(3*r),o=new Float32Array(2*r),a=new Float32Array(4*r),s=new Float32Array(2*r),l=new Uint16Array(t),c=0,u=0,h=0,p=0,d=0,f=new THREE.BufferGeometry,m=0;m<e.length;m++){for(var g=e[m],v=g.parentPosition,y=g.indexArray,E=0;E<y.length;E++)l[E+p]=c/3+y[E];p+=y.length;for(var b=g.positionArray,E=0;E<b.length;){var x=new THREE.Vector3(b[E]+v.x,b[E+1]+v.y,b[E+2]+v.z);i[E+c]=x.x,i[E+c+1]=x.y,i[E+c+2]=x.z,E+=3}c+=b.length;for(var _=g.normalArray,E=0;E<_.length;){var w=new THREE.Vector3(_[E],_[E+1],_[E+2]);n[E+u]=w.x,n[E+u+1]=w.y,n[E+u+2]=w.z,E+=3}u+=_.length;var T=g.uvArray;if(T)for(E=0;E<T.length;E++)o[E+h]=T[E];var M=g.uv2Array;if(M)for(E=0;E<M.length;E++)s[E+h]=M[E];T&&(h+=T.length);var R=g.colorArray;if(R){for(E=0;E<R.length;E++)a[E+d]=R[E];d+=R.length}}f.addAttribute("position",new THREE.BufferAttribute(i,3)),f.addAttribute("normal",new THREE.BufferAttribute(n,3)),f.addAttribute("uv",new THREE.BufferAttribute(o,2)),0!==s.length&&f.addAttribute("uv2",new THREE.BufferAttribute(s,2)),0!==a.length&&f.addAttribute("color",new THREE.BufferAttribute(a,4)),f.setIndex(new THREE.BufferAttribute(l,1));var S=new THREE.Mesh(f,this.material);this.material.defines&&this.material.defines.USE_ALPHAINDEX&&delete this.material.defines.USE_ALPHAINDEX,S.name="combine",this.combineMesh=S,this.combineMesh.name="manualWall"},t}(ko),Uo=function(e){function t(r,i){qn(this,t);var n=Xn(this,e.call(this,r,i));return n.meshInfos=[],n.geometrys=[],n}return Wn(t,e),t.prototype.add=function(e){this.geometrys.push(e)},t.prototype.build=function(){for(var e=new THREE.Geometry,t=0;t<this.geometrys.length;t++){var r=this.geometrys[t];e.merge(r)}var i=new THREE.Mesh(e,this.material);this.material.defines&&this.material.defines.USE_ALPHAINDEX&&delete this.material.defines.USE_ALPHAINDEX,i.name="combine",i.rotateX(-Math.PI/2),i.position.y=.1,this.combineMesh=i,this.combineMesh.name="floor"},t}(ko),Bo=function(e){function t(r,i){qn(this,t);var n=Xn(this,e.call(this,r,i));return n.meshInfos=[],n.geometrys=[],n.height=3,n}return Wn(t,e),t.prototype.add=function(e){this.geometrys.push(e)},t.prototype.build=function(){for(var e=new THREE.Geometry,t=0;t<this.geometrys.length;t++){var r=this.geometrys[t];e.merge(r)}var i=new THREE.Mesh(e,this.material);this.material.defines&&this.material.defines.USE_ALPHAINDEX&&delete this.material.defines.USE_ALPHAINDEX,i.name="combine",i.rotateX(Math.PI/2),i.position.y=this.height,this.combineMesh=i,this.combineMesh.name="ceiling"},t}(ko),Vo=function(e){function t(r,i){qn(this,t);var n=Xn(this,e.call(this,r,i));return n.meshInfos=[],n.geometrys=[],n}return Wn(t,e),t.prototype.add=function(e){this.geometrys.push(e)},t.prototype.build=function(){for(var e=new THREE.Geometry,t=0;t<this.geometrys.length;t++){var r=this.geometrys[t];e.merge(r)}var i=new THREE.Mesh(e,this.material);this.material.defines&&this.material.defines.USE_ALPHAINDEX&&delete this.material.defines.USE_ALPHAINDEX,i.name="combine",i.rotateX(-Math.PI/2),i.position.y=3.1,this.combineMesh=i,this.combineMesh.name="roof"},t}(ko),zo=function(){function e(t){qn(this,e),this.resourceManager=t,this.combineBundleObjectMap={},this.processors=[]}return e.prototype.combineModels=function(){var e=this.resourceManager.models,t=[],r=this;for(var i in e)t.push(new Promise(function(t,n){var o=performance.now(),a=e[i],s=new po(a.model);r.combineBundleObjectMap[a.id]=s,s.combine();performance.now()-o>.1?setTimeout(function(){t()},10):t()}));return Promise.all(t)},e.prototype.getModelObject=function(e){var t=this.combineBundleObjectMap[e];return t||null},e.prototype.addGroup=function(e,t,r){t.curPlacementCombineProcessorMap,t.placementCombineProcessors;r||(r=new No),r.positions.push(e.position),r.scales.push(e.scale),r.quaternions.push(e.rotation);for(n=0;n<e.placements.length;n++){var i=e.placements[n];i.isShow&&this.addPlacement(i,t,r.clone())}for(var n=0;n<e.groups.length;n++){var o=e.groups[n];o.isShow&&this.addGroup(o,t,r.clone())}},e.prototype.addDoorOrWindow=function(e,t,r){var i=t.curDoorOrWinCombineProcessorMap,n=t.doorOrWindowCombineProcessors;r||(r=new No),r.positions.push(e.position),r.scales.push(e.scale),r.quaternions.push(e.rotation);this.combineBundleObjectMap[e.resource.id].materialMap.forEach(function(e,t,o){for(var a=e,s=t,l=0;l<a.length;l++){var c=a[l],u=i.get(s);u&&!u.isExceed(c.vertexCount)||(u=new Do(s,this),i.set(s,u),n.push(u)),u.add(c,r)}})},e.prototype.addPlacement=function(e,t,r){var i=t.curPlacementCombineProcessorMap,n=t.placementCombineProcessors;r||(r=new No),r.positions.push(e.position),r.scales.push(e.scale),r.quaternions.push(e.rotation);this.combineBundleObjectMap[e.resource.id].materialMap.forEach(function(e,t,o){for(var a=e,s=t,l=0;l<a.length;l++){var c=a[l],u=i.get(s);u&&!u.isExceed(c.vertexCount)||(u=new Do(s,this),i.set(s,u),n.push(u)),u.add(c,r)}})},e.prototype.addStraightManualWall=function(e,t){var r=t.curStraightManualWallCombineProcessorMap,i=t.straightManualWallCombineProcessors;e.build();var n=e.rightSideMeshInfo,o=e.leftSideMeshInfo,a=e.edgeSideMeshInfo;this.addWallMeshInfo(n,e.position,r,i),this.addWallMeshInfo(o,e.position,r,i),this.addWallMeshInfo(a,e.position,r,i)},e.prototype.addModelWall=function(e,t){for(var r=t.curModelWallCombineProcessorMap,i=t.modelWallCombineProcessors,n=this.combineBundleObjectMap[e.resource.id],o=0;o<e.modelNumber;o++){var a=e.objPositions[o],s=e.objRotations[o],l=e.objScales[o],c=new No;c.positions.push(a),c.scales.push(l),c.quaternions.push(s);n.materialMap.forEach(function(e,t,n){for(var o=e,a=t,s=0;s<o.length;s++){var l=o[s],u=r.get(a);u&&!u.isExceed(l.vertexCount)||(u=new Do(a,this),r.set(a,u),i.push(u)),u.add(l,c)}})}},e.prototype.addRoom=function(e,t){this.addRoomShapeGeometry(e.floor.material,e.floor.geometry,t.height,Uo,t.curFloorCombineProcessorMap,t.floorCombineProcessors),e.isOnlyFloor||(this.addRoomShapeGeometry(e.ceiling.material,e.ceiling.geometry,t.height,Bo,t.curCeilingCombineProcessorMap,t.ceilingCombineProcessors),this.addRoomShapeGeometry(e.roof.material,e.roof.geometry,t.height,Vo,t.curRoofCombineProcessorMap,t.roofCombineProcessors))},e.prototype.addWallMeshInfo=function(e,t,r,i){var n=e.material;e.parentPosition=t;var o=r.get(n);o||((o=new jo(n,this)).height=i.push(o),r.set(n,o)),o.add(e)},e.prototype.addRoomShapeGeometry=function(e,t,r,i,n,o){var a=e,s=n.get(a);s||(s=new i(a,this),o.push(s),s.height=r,n.set(a,s)),s.add(t)},e.prototype.getCombineProcessors=function(e,t,r,i){var n=[],o=new Map;for(var a in e){var s=e[a];if(!s.uid&&!s.name){var l=this.app.modelResource.bundleIDArray[s.bIdx],c=(this.app.modelResource.get(l).node,new THREE.Vector3(0,0,0)),u=new No;if(s.pos){var h=s.pos.split(" ");c.x=parseFloat(h[0]),c.y=parseFloat(h[1]),c.z=-parseFloat(h[2])}var p=new THREE.Vector3(1,1,1);if(s.scl){var d=s.scl.split(" ");p.x=parseFloat(d[0]),p.y=parseFloat(d[1]),p.z=parseFloat(d[2])}var f=new THREE.Quaternion(0,0,0,1);if(s.rot){var m=s.rot.split(" ");f.x=parseFloat(m[0]),f.y=parseFloat(m[1]),f.z=-parseFloat(m[2]),f.w=-parseFloat(m[3])}var g=t.slice(),v=r.slice(),y=i.slice();y.push(f),v.push(p),g.push(c),u.positions=g,u.scales=v,u.quaternions=y;this.combineBundleObjectMap[l].materialMap.forEach(function(e,t,r){for(var i=e,a=t,s=0;s<i.length;s++){var l=i[s],c=o.get(a);c&&!c.isExceed(l.vertexCount)||(c=new Do(a),o.set(a,c),n.push(c)),c.add(l,u)}})}}return n},e}(),qo=t(function(e){!function(t){function r(e,t,r,o){var a=t&&t.prototype instanceof n?t:n,s=Object.create(a.prototype),l=new p(o||[]);return s._invoke=function(e,t,r){var n=w;return function(o,a){if(n===M)throw new Error("Generator is already running");if(n===R){if("throw"===o)throw a;return f()}for(r.method=o,r.arg=a;;){var s=r.delegate;if(s){var l=c(s,r);if(l){if(l===S)continue;return l}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(n===w)throw n=R,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n=M;var u=i(e,t,r);if("normal"===u.type){if(n=r.done?R:T,u.arg===S)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(n=R,r.method="throw",r.arg=u.arg)}}}(e,r,l),s}function i(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}function n(){}function o(){}function a(){}function s(e){["next","throw","return"].forEach(function(t){e[t]=function(e){return this._invoke(t,e)}})}function l(e){function t(r,n,o,a){var s=i(e[r],e,n);if("throw"!==s.type){var l=s.arg,c=l.value;return c&&"object"==typeof c&&v.call(c,"__await")?Promise.resolve(c.__await).then(function(e){t("next",e,o,a)},function(e){t("throw",e,o,a)}):Promise.resolve(c).then(function(e){l.value=e,o(l)},a)}a(s.arg)}var r;this._invoke=function(e,i){function n(){return new Promise(function(r,n){t(e,i,r,n)})}return r=r?r.then(n,n):n()}}function c(e,t){var r=e.iterator[t.method];if(r===m){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=m,c(e,t),"throw"===t.method))return S;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return S}var n=i(r,e.iterator,t.arg);if("throw"===n.type)return t.method="throw",t.arg=n.arg,t.delegate=null,S;var o=n.arg;return o?o.done?(t[e.resultName]=o.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=m),t.delegate=null,S):o:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,S)}function u(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function h(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function p(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(u,this),this.reset(!0)}function d(e){if(e){var t=e[E];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,i=function t(){for(;++r<e.length;)if(v.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=m,t.done=!0,t};return i.next=i}}return{next:f}}function f(){return{value:m,done:!0}}var m,g=Object.prototype,v=g.hasOwnProperty,y="function"==typeof Symbol?Symbol:{},E=y.iterator||"@@iterator",b=y.asyncIterator||"@@asyncIterator",x=y.toStringTag||"@@toStringTag",_=t.regeneratorRuntime;if(_)e.exports=_;else{(_=t.regeneratorRuntime=e.exports).wrap=r;var w="suspendedStart",T="suspendedYield",M="executing",R="completed",S={},P={};P[E]=function(){return this};var A=Object.getPrototypeOf,C=A&&A(A(d([])));C&&C!==g&&v.call(C,E)&&(P=C);var L=a.prototype=n.prototype=Object.create(P);o.prototype=L.constructor=a,a.constructor=o,a[x]=o.displayName="GeneratorFunction",_.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===o||"GeneratorFunction"===(t.displayName||t.name))},_.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,a):(e.__proto__=a,x in e||(e[x]="GeneratorFunction")),e.prototype=Object.create(L),e},_.awrap=function(e){return{__await:e}},s(l.prototype),l.prototype[b]=function(){return this},_.AsyncIterator=l,_.async=function(e,t,i,n){var o=new l(r(e,t,i,n));return _.isGeneratorFunction(t)?o:o.next().then(function(e){return e.done?e.value:o.next()})},s(L),L[x]="Generator",L[E]=function(){return this},L.toString=function(){return"[object Generator]"},_.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var i=t.pop();if(i in e)return r.value=i,r.done=!1,r}return r.done=!0,r}},_.values=d,p.prototype={constructor:p,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=m,this.done=!1,this.delegate=null,this.method="next",this.arg=m,this.tryEntries.forEach(h),!e)for(var t in this)"t"===t.charAt(0)&&v.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=m)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){function t(t,i){return o.type="throw",o.arg=e,r.next=t,i&&(r.method="next",r.arg=m),!!i}if(this.done)throw e;for(var r=this,i=this.tryEntries.length-1;i>=0;--i){var n=this.tryEntries[i],o=n.completion;if("root"===n.tryLoc)return t("end");if(n.tryLoc<=this.prev){var a=v.call(n,"catchLoc"),s=v.call(n,"finallyLoc");if(a&&s){if(this.prev<n.catchLoc)return t(n.catchLoc,!0);if(this.prev<n.finallyLoc)return t(n.finallyLoc)}else if(a){if(this.prev<n.catchLoc)return t(n.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<n.finallyLoc)return t(n.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&v.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var n=i;break}}n&&("break"===e||"continue"===e)&&n.tryLoc<=t&&t<=n.finallyLoc&&(n=null);var o=n?n.completion:{};return o.type=e,o.arg=t,n?(this.method="next",this.next=n.finallyLoc,S):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),S},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),h(r),S}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var i=r.completion;if("throw"===i.type){var n=i.arg;h(r)}return n}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:d(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=m),S}}}}(function(){return this}()||Function("return this")())}),Go=function(){return this}()||Function("return this")(),Wo=Go.regeneratorRuntime&&Object.getOwnPropertyNames(Go).indexOf("regeneratorRuntime")>=0,Xo=Wo&&Go.regeneratorRuntime;Go.regeneratorRuntime=void 0;var Yo=qo;if(Wo)Go.regeneratorRuntime=Xo;else try{delete Go.regeneratorRuntime}catch(e){Go.regeneratorRuntime=void 0}var Qo=Yo,Jo=function(){function e(t){qn(this,e),this.combineManager=t.combineManager}return e.prototype.parseWorld=function(e){function t(e){var t,i,n,o,a,s,l,c,u,h,p,d;return Qo.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:t=.1,i=10,n=0;case 3:if(!(n<e.length)){r.next=64;break}o=e[n],a=o.placementCombineProcessors,s=o.straightManualWallCombineProcessors,l=o.modelWallCombineProcessors,c=o.floorCombineProcessors,u=o.ceilingCombineProcessors,h=o.roofCombineProcessors,p=o.doorOrWindowCombineProcessors,d=0;case 13:if(!(d<u.length)){r.next=19;break}return r.next=16,new Promise(function(e,r){var n=performance.now(),a=u[d];a.build();var s=a.combineMesh;o.combineCeilings.push(s);performance.now()-n>t?setTimeout(function(){e()},i):e()});case 16:d++,r.next=13;break;case 19:d=0;case 20:if(!(d<h.length)){r.next=26;break}return r.next=23,new Promise(function(e,r){var n=performance.now(),a=h[d];a.build();var s=a.combineMesh;o.combineRoofs.push(s);performance.now()-n>t?setTimeout(function(){e()},i):e()});case 23:d++,r.next=20;break;case 26:d=0;case 27:if(!(d<c.length)){r.next=33;break}return r.next=30,new Promise(function(e,r){var n=performance.now(),a=c[d];a.build();var s=a.combineMesh;o.combineFloors.push(s);performance.now()-n>t?setTimeout(function(){e()},i):e()});case 30:d++,r.next=27;break;case 33:d=0;case 34:if(!(d<a.length)){r.next=40;break}return r.next=37,new Promise(function(e,r){var n=performance.now(),s=a[d];s.build();var l=s.combineMesh;o.combinePlacements.push(l);performance.now()-n>t?setTimeout(function(){e()},i):e()});case 37:d++,r.next=34;break;case 40:d=0;case 41:if(!(d<p.length)){r.next=47;break}return r.next=44,new Promise(function(e,r){var n=performance.now(),a=p[d];a.build();var s=a.combineMesh;o.combineDoorOrWins.push(s);performance.now()-n>t?setTimeout(function(){e()},i):e()});case 44:d++,r.next=41;break;case 47:d=0;case 48:if(!(d<s.length)){r.next=54;break}return r.next=51,new Promise(function(e,r){var n=performance.now(),a=s[d];a.build();var l=a.combineMesh;o.combineStraightManualWalls.push(l);performance.now()-n>t?setTimeout(function(){e()},i):e()});case 51:d++,r.next=48;break;case 54:d=0;case 55:if(!(d<l.length)){r.next=61;break}return r.next=58,new Promise(function(e,r){var n=performance.now(),a=l[d];a.build();var s=a.combineMesh;o.combineModelWalls.push(s);performance.now()-n>t?setTimeout(function(){e()},i):e()});case 58:d++,r.next=55;break;case 61:n++,r.next=3;break;case 64:case"end":return r.stop()}},r,this)}var r=Qo.mark(t),i=e.outdoors;this.parsePlan(i);for(var n=e.buildings,o=0;o<n.length;o++){s=n[o];this.parseBuilding(s)}for(var a=[],o=0;o<e.buildings.length;o++)for(var s=e.buildings[o],l=0;l<s.floorplans.length;l++){var c=s.floorplans[l];a.push(c)}return a.push(e.outdoors),t(a)},e.prototype.parseBuilding=function(e){for(var t=e.floorplans,r=0;r<t.length;r++){var i=t[r];this.parsePlan(i)}},e.prototype.parsePlan=function(e){for(var t=e.placements,r=e.walls,i=e.rooms,n=[],o=[],a=0;a<t.length;a++){var s=t[a];s.properties||s.name?n.push(s):this.combineManager.addPlacement(s,e)}e.placements=n;for(a=0;a<e.groups.length;a++){var l=e.groups[a];l.properties||l.name?o.push(l):this.combineManager.addGroup(l,e)}e.groups=o;for(a=0;a<r.length;a++){var c=r[a];if(c.isShow){if(0!==c.subWalls.length)for(h=0;h<c.subWalls.length;h++){var u=c.subWalls[h];u instanceof to?this.combineManager.addStraightManualWall(u,e):this.combineManager.addModelWall(u,e)}else c instanceof no?this.combineManager.addStraightManualWall(c,e):this.combineManager.addModelWall(c,e);if(c.doorOrWindows.length>0)for(var h=0;h<c.doorOrWindows.length;h++){var p=c.doorOrWindows[h];this.combineManager.addDoorOrWindow(p,e)}}}for(a=0;a<i.length;a++){var d=i[a];d.properties||d.name||this.combineManager.addRoom(d,e)}},e}(),Ko={id:"id",name:"name",position:"position",rotation:"rotation",scale:"scale",properties:"properties",plans:"plans",walls:"walls",placements:"placements",groups:"groups",corners:"corners",doorOrWindows:"doororwindows",rooms:"rooms",height:"height",thick:"thick",texture:"texture",type:"type",model:"model",suspendPercent:"suspendpercent",leftTexture:"lefttexture",rightTexture:"righttexture",edgeTexture:"edgetexture",floorTexture:"floortexture",ceilingTexture:"ceilingtexture",roofTexture:"rooftexture",wallType:"type"},Zo=function(){function e(){qn(this,e),this.sceneJson=null,this.scale=1,this.curFloorPlan=null,this.enableCombine=!0,this.defaultWallEdgeTextureUri="Textures/WallEdge.jpg",this.defaultWallTextureUri="Textures/RoomWall.jpg",this.defaultFloorTextureUri="Textures/FloorDefault.jpg",this.defaultCeilingTextureUri="Textures/CeilingDefault.jpg",this.defaultRoofTextureUri="Textures/RoofDefault.jpg",this.world=null,this.resourceManager=new Mo,this.combineManager=new zo(this.resourceManager),this.combineParser=new Jo(this)}return e.prototype._nestingLoopYield=function(e,t,r){var i=this,n=e.next();if(n.done)return t&&t(),n.value;var o=n.value;n.done;o instanceof Promise?o.then(function(n){return i._nestingLoopYield(e,t,r)}).catch(function(e){r(e)}):this._nestingLoopYield(e,t,r)},e.prototype.load=function(e){var t=this;return e?(e.url&&(this.sceneURL=e.url),e.json&&(this.sceneJson=e.json),new Promise(function(e,r){t.loadSceneJson().then(function(){t.parseSceneJson().then(function(){t.world.build(),t.combineManager.combineModels().then(function(){return console.log("finish combine models"),new Promise(function(e,r){var i=t.combineParser.parseWorld(t.world);i?t._nestingLoopYield(i,function(){e()},function(e){r(e)}):e()})}).then(function(){e(t.world)})})}).catch(function(e){console.error(e)})})):(console.error("load param can not be null"),null)},e.prototype.loadSceneJson=function(){var e=this;return new Promise(function(t,r){if(e.sceneJson)t(e.sceneJson);else if(e.sceneURL){(new THREE.FileLoader).load(e.sceneURL,function(r){e.sceneJson=JSON.parse(r),t()},function(){},function(t){r("can not load "+e.sceneURL)})}else r("load scene json error")})},e.prototype.createTextureLoaderPromise=function(e){return new Promise(function(t,r){(new THREE.TextureLoader).load(e,function(e){e.wrapS=THREE.RepeatWrapping,e.wrapT=THREE.RepeatWrapping,t(e)},function(t){console.log(e+" "+t.loaded/t.total*100+"% loaded")},function(r){t(null),console.log(e+"load error")})})},e.prototype.loadResources=function(){var e=this;return new Promise(function(t,r){var i=e.createTextureLoaderPromise(e.defaultWallTextureUri),n=e.createTextureLoaderPromise(e.defaultWallEdgeTextureUri),o=e.createTextureLoaderPromise(e.defaultFloorTextureUri),a=e.createTextureLoaderPromise(e.defaultRoofTextureUri),s=e.createTextureLoaderPromise(e.defaultCeilingTextureUri);Promise.all([i,n,o,a,s]).then(function(e){Qn.wallTexture=e[0],Qn.wallEdgeTexture=e[1],Qn.floorTexture=e[2],Qn.roofTexture=e[3],Qn.ceilingTexture=e[4],t()})})},e.prototype.loadDefaultTexture=function(){var e=this;return new Promise(function(t,r){var i=e.createTextureLoaderPromise(e.defaultWallTextureUri),n=e.createTextureLoaderPromise(e.defaultWallEdgeTextureUri),o=e.createTextureLoaderPromise(e.defaultFloorTextureUri),a=e.createTextureLoaderPromise(e.defaultRoofTextureUri),s=e.createTextureLoaderPromise(e.defaultCeilingTextureUri);Promise.all([i,n,o,a,s]).then(function(e){Qn.wallTexture=e[0],Qn.wallEdgeTexture=e[1],Qn.floorTexture=e[2],Qn.roofTexture=e[3],Qn.ceilingTexture=e[4],Qn.wallMaterial=new THREE.MeshStandardMaterial({color:16777215,map:e[0]}),Qn.wallEdgeMaterial=new THREE.MeshStandardMaterial({color:16777215,map:e[1]}),Qn.floorMaterial=new THREE.MeshStandardMaterial({color:16777215,map:e[2]}),Qn.ceilingMaterial=new THREE.MeshStandardMaterial({color:16777215,map:e[3]}),Qn.roofMaterial=new THREE.MeshStandardMaterial({color:16777215,map:e[4]}),t()})})},e.prototype.parseSceneJson=function(){var e=this;return new Promise(function(t,r){e.resourceManager.loadTextures(e.sceneJson.textures),e.resourceManager.loadModels(e.sceneJson.models);var i=setInterval(function(){e.resourceManager.checkAllResourcesIsReady()&&(clearInterval(i),e.parseWorld(e.sceneJson),t())},10)})},e.prototype.parseWorld=function(e){var t=new go;if(this.world=t,this.parseBaseObject(e,t),e.buildings)for(var r=e.buildings,i=0;i<r.length;i++){var n=r[i],o=this.parseBuilding(n);t.buildings.push(o)}if(e.outdoors){var a=new _o;this.parseFloorPlan(e.outdoors,a),t.outdoors=a}},e.prototype.parseBuilding=function(e,t){var r=e,i=new vo;this.parseBaseObject(e,i,t);var n=r[Ko.plans];if(n)for(var o=0;o<n.length;o++){var a=n[o],s=new co;this.parseFloorPlan(a,s,i),i.floorplans.push(s)}return i},e.prototype.parseFloorPlan=function(e,t,r){if(this.parseBaseObject(e,t,r),e[Ko.height]&&(t.height=e[Ko.height]),e[Ko.corners])for(var i=e[Ko.corners],n=0;n<i.length;n++){var o=i[n],a=o[0],s=o[1],l=-o[2];t.existsCorner(a,s,l)?console.error("repeat corner"):t.addCorner(a,s,l)}if(e[Ko.walls])for(var c=e[Ko.walls],n=0;n<c.length;n++){var u=c[n];this.parseWall(u,t)}if(e[Ko.rooms])for(var h=e[Ko.rooms],n=0;n<h.length;n++){var p=h[n];this.parseRoom(p,t)}if(e[Ko.placements])for(var d=e[Ko.placements],n=0;n<d.length;n++){var f=d[n];this.parsePlacement(f,t)}if(e[Ko.groups])for(var m=e[Ko.groups],n=0;n<m.length;n++){var g=m[n];this.parseGroup(g,t)}if(e[Ko.doorOrWindows])for(var v=e[Ko.doorOrWindows],n=0;n<v.length;n++){var y=v[n];this.parseDoorOrWindow(y,t)}return t},e.prototype.parseDoorOrWindow=function(e,t){var r=new ho;this.parseBaseObject(e,r,t.parent),r.resource=this.resourceManager.models[e[Ko.model]],t.doorOrWindows.push(r),e[Ko.suspendPercent]&&(r.suspendPercent=e[Ko.suspendPercent]),r.attachWall=t},e.prototype.parsePlacement=function(e,t){var r=new uo;if(this.parseBaseObject(e,r,t),r.resource=this.resourceManager.models[e[Ko.model]],void 0!==e.texture&&null!==e.texture&&(r.customTextureResource=this.resourceManager.textures[e.texture]),e.color){var i=e.color;r.customColor=new THREE.Color(i[0],i[1],i[2]),4==i.length&&(r.opacity=i[3])}e.rendermode&&(r.renderMode=e.rendermode),t.placements.push(r)},e.prototype.parseGroup=function(e,t){var r=new Io;if(this.parseBaseObject(e,r,t),t.groups.push(r),e[Ko.placements])for(var i=e[Ko.placements],n=0;n<i.length;n++){var o=i[n];this.parsePlacement(o,r)}if(e[Ko.groups])for(var a=e[Ko.groups],n=0;n<a.length;n++){var s=a[n];this.parseGroup(s,r)}},e.prototype.parseWall=function(e,t){var r=null;r=0==e[Ko.wallType]?new no:new Fo,this.parseBaseObject(e,r,t);var i=e[Ko.corners];if(r.startCorner=t.corners[i[0]],r.endCorner=t.corners[i[1]],void 0!==e[Ko.leftTexture]&&(r.rightResource=this.resourceManager.textures[e[Ko.leftTexture]]),void 0!==e[Ko.rightTexture]&&(r.leftResource=this.resourceManager.textures[e[Ko.rightTexture]]),void 0!==e[Ko.edgeTexture]&&(r.edgeResource=this.resourceManager.textures[e[Ko.edgeTexture]]),void 0!==e[Ko.model]&&(r.resource=this.resourceManager.models[e[Ko.model]]),e[Ko.doorOrWindows])for(var n=e[Ko.doorOrWindows],o=0;o<n.length;o++){var a=n[o];this.parseDoorOrWindow(a,r,t)}r.startCorner.addWall(r),r.endCorner.addWall(r),t.addWall(r)},e.prototype.parseRoom=function(e,t){var r=new lo;this.parseBaseObject(e,r,t);for(var i=e[Ko.corners],n=[],o=0;o<i.length;o++){var a=i[o];n.push(t.corners[a].position)}void 0!==e[Ko.floorTexture]&&(r.floorResource=this.resourceManager.textures[e[Ko.floorTexture]]),void 0!==e[Ko.ceilingTexture]&&(r.ceilingResource=this.resourceManager.textures[e[Ko.ceilingTexture]]),void 0!==e[Ko.roofTexture]&&(r.roofResource=this.resourceManager.textures[e[Ko.roofTexture]]),r.points=n,t.rooms.push(r)},e.prototype.parseBaseObject=function(e,t,r){var i,n;if(t.parent=r,e[Ko.id]&&(i=e[Ko.id],t.id=i),e[Ko.name]&&(n=e[Ko.name],t.name=n),e[Ko.position]){var o=e[Ko.position];t.position.set(o[0],o[1],-o[2])}if(e[Ko.scale]){var a=e[Ko.scale];t.scale.set(a[0],a[1],a[2])}if(e[Ko.rotation]){var s=e[Ko.rotation];t.rotation.set(s[0],s[1],-s[2],-s[3])}e[Ko.properties]&&(t.properties=e[Ko.properties])},e.prototype.createRooms=function(){for(var e=[],t=0;t<this.curFloorPlan.rooms.length;t++){var r=this.curFloorPlan.rooms[t];e.push(r.meshGroup)}return e},e.prototype.createWalls=function(){for(var e=[],t=0;t<this.world.buildings.length;t++)for(var r=this.world.buildings[t],i=0;i<r.floorplans.length;i++)for(var n=r.floorplans[i],o=0;o<n.walls.length;o++){var a=n.walls[o];e.push(a.wallGroup)}return e},e.prototype.createWallMesh=function(e){var t=new THREE.BufferGeometry;t.addAttribute("position",new THREE.BufferAttribute(e.positionArray,3)),t.addAttribute("normal",new THREE.BufferAttribute(e.normalArray,3)),t.addAttribute("uv",new THREE.BufferAttribute(e.uvArray,2));var r=e.material;return new THREE.Mesh(t,r)},e}(),$o=function(){function e(t){qn(this,e),this.combineManager=t.combineManager}return e.prototype.parseWorld=function(e){var t=e.outdoors;this.parsePlan(t);for(var r=e.buildings,i=0;i<r.length;i++){o=r[i];this.parseBuilding(o)}for(var n=[],i=0;i<e.buildings.length;i++)for(var o=e.buildings[i],a=0;a<o.floorplans.length;a++){var s=o.floorplans[a];n.push(s)}n.push(e.outdoors)},e.prototype.parseBuilding=function(e){for(var t=e.floorplans,r=0;r<t.length;r++){var i=t[r];this.parsePlan(i)}for(r=0;r<e.facades.length;r++){n=e.facades[r];this.addUncombinePlacementResource(n)}for(r=0;r<e.facadeGroups.length;r++){var n=e.facadeGroups[r];this.addUncombineGroupResource(n)}},e.prototype.parsePlan=function(e){for(var t=e.placements,r=e.walls,i=e.rooms,n=[],o=[],a=[],s=[],l=[],c=0;c<e.curvelines.length;c++){u=e.curvelines[c];this.addCommoneTextureResource(u)}for(c=0;c<e.pipelines.length;c++){var u=e.pipelines[c];this.addCommoneTextureResource(u)}for(c=0;c<t.length;c++){var h=t[c];h.properties||h.userID||h.name||h.resource.hasAnim||!h.isShow?(n.push(h),this.addUncombinePlacementResource(h)):this.combineManager.addPlacement(h,e)}e.placements=n;for(c=0;c<e.groups.length;c++){var p=e.groups[c];p.properties||p.userID||p.name||!p.isShow?(o.push(p),this.addUncombineGroupResource(p)):this.combineManager.addGroup(p,e)}e.groups=o;for(c=0;c<r.length;c++){var d=r[c];if(d.isShow){if(0!==d.subWalls.length)for(m=0;m<d.subWalls.length;m++){var f=d.subWalls[m];f instanceof to?this.combineManager.addStraightManualWall(f,e):this.combineManager.addModelWall(f,e)}else d instanceof no?this.combineManager.addStraightManualWall(d,e):this.combineManager.addModelWall(d,e);if(d.doorOrWindows.length>0)for(var m=0;m<d.doorOrWindows.length;m++){var g=d.doorOrWindows[m];g.resource&&(g.properties||g.userID||g.name||g.resource.hasAnim?(l.push(g),this.addUncombinePlacementResource(g)):this.combineManager.addDoorOrWindow(g,e))}d.doorOrWindows=l}}for(c=0;c<i.length;c++){var v=i[c];v.properties||v.userID||v.name||v.floor.height?(this.addUncombineRoomResource(v),v.properties||v.userID||v.name?a.push(v):s.push(v)):this.combineManager.addRoom(v,e)}e.rooms=a,e.uncombineWithHeigthRooms=s},e.prototype.addUncombineRoomResource=function(e){this.combineManager.resourceManager.addRoomResource(e.floorResource),this.combineManager.resourceManager.addRoomResource(e.ceilingResource),this.combineManager.resourceManager.addRoomResource(e.roofResource),e.floor.initResource(),e.ceiling.initResource(),e.roof.initResource()},e.prototype.addCommoneTextureResource=function(e){e.resource&&(e.initResource(),this.combineManager.resourceManager.addCommonTextureResource(e.resource))},e.prototype.addUncombinePlacementResource=function(e){this.combineManager.resourceManager.addPlacementResource(e.resource),e.initResource()},e.prototype.addUncombineGroupResource=function(e){for(r=0;r<e.placements.length;r++){var t=e.placements[r];this.addUncombinePlacementResource(t)}for(var r=0;r<e.groups.length;r++){var i=e.groups[r];this.addUncombineGroupResource(i)}},e.prototype.buildWorld=function(e){this.buildPlan(e.outdoors);for(var t=e.buildings,r=0;r<t.length;r++){var i=t[r];this.buildBuilding(i)}},e.prototype.buildBuilding=function(e){for(var t=e.floorplans,r=0;r<t.length;r++){var i=t[r];this.buildPlan(i)}},e.prototype.buildPlan=function(e){for(var t=e.placementCombineProcessors,r=e.straightManualWallCombineProcessors,i=e.modelWallCombineProcessors,n=e.floorCombineProcessors,o=e.ceilingCombineProcessors,a=e.roofCombineProcessors,s=(e.doorOrWindowCombineProcessors,e.uncombineWithHeigthRooms),l=0;l<o.length;l++){(h=o[l]).build();p=h.combineMesh;e.combineCeilings.push(p)}for(l=0;l<a.length;l++){(h=a[l]).build();p=h.combineMesh;e.combineRoofs.push(p)}for(var c=0;c<s.length;c++){var u=s[c];e.combineFloors.push(u.floor.mesh),u.ceiling.mesh&&e.combineCeilings.push(u.ceiling.mesh),u.roof.mesh&&e.combineRoofs.push(u.roof.mesh)}for(l=0;l<n.length;l++){(h=n[l]).build();p=h.combineMesh;e.combineFloors.push(p)}for(l=0;l<t.length;l++){(h=t[l]).build(),e.combinePlacements.push(h.combineMesh)}for(l=0;l<r.length;l++){(h=r[l]).build();p=h.combineMesh;e.combineStraightManualWalls.push(p)}for(l=0;l<i.length;l++){var h=i[l];h.build();var p=h.combineMesh;e.combineModelWalls.push(p)}},e}(),ea=function(){function e(t,r,i){qn(this,e),this.vertexCount=0,this.indexCount=0,this.resource=t,this.bundeMeshs=[],this.transformations=[],this.maxCount=65534,this.combineMesh=new THREE.Object3D,this.combineManager=r,this.plan=i}return e.prototype.isExceed=function(e){return this.vertexCount+e>this.maxCount},e.prototype.build=function(){},e.prototype.resourceCallback=function(e){this.combineMesh.material=e.material},e}(),ta=function(e){function t(r,i){qn(this,t);var n=Xn(this,e.call(this,r,i));return n.meshInfos=[],n.geometrys=[],n}return Wn(t,e),t.prototype.add=function(e){this.geometrys.push(e)},t.prototype.resourceCallback=function(e){this.combineMesh.material=e.roomMaterial,this.combineMesh.material.side=THREE.DoubleSide},t.prototype.build=function(){var e=null;this.resource.ready?e=this.resource.roomMaterial:(e=new THREE.MeshBasicMaterial,this.resource.registerListener(this)),e.side=THREE.DoubleSide;for(var t=new THREE.Geometry,r=0;r<this.geometrys.length;r++){var i=this.geometrys[r];t.merge(i)}var n=new THREE.Mesh(t,e);n.name="combine",n.rotateX(-Math.PI/2),this.combineMesh=n,this.combineMesh.name="floor"},t}(ea),ra=function(e){function t(r,i){qn(this,t);var n=Xn(this,e.call(this,r,i));return n.meshInfos=[],n.geometrys=[],n.height=3,n}return Wn(t,e),t.prototype.add=function(e){this.geometrys.push(e)},t.prototype.resourceCallback=function(e){this.combineMesh.material=e.roomMaterial},t.prototype.build=function(){var e=null;this.resource.ready?e=this.resource.roomMaterial:(e=new THREE.MeshBasicMaterial({color:16777215}),this.resource.registerListener(this));for(var t=new THREE.Geometry,r=0;r<this.geometrys.length;r++){var i=this.geometrys[r];t.merge(i)}var n=new THREE.Mesh(t,e);n.name="combine",n.rotateX(Math.PI/2),n.position.y=this.height,this.combineMesh=n,this.combineMesh.name="ceiling"},t}(ea),ia=function(e){function t(r,i){qn(this,t);var n=Xn(this,e.call(this,r,i));return n.meshInfos=[],n.geometrys=[],n.height=3,n}return Wn(t,e),t.prototype.add=function(e){this.geometrys.push(e)},t.prototype.resourceCallback=function(e){this.combineMesh.material=e.roomMaterial},t.prototype.build=function(){var e=null;this.resource.ready?e=this.resource.roomMaterial:(e=new THREE.MeshBasicMaterial,this.resource.registerListener(this));for(var t=new THREE.Geometry,r=0;r<this.geometrys.length;r++){var i=this.geometrys[r];t.merge(i)}var n=new THREE.Mesh(t,e);n.name="combine",n.rotateX(-Math.PI/2),n.position.y=this.height+.01,this.combineMesh=n,this.combineMesh.name="roof"},t}(ea),na=function(e){function t(r,i,n){qn(this,t);var o=Xn(this,e.call(this,r,i,n));return o.meshInfos=[],o}return Wn(t,e),t.prototype.add=function(e){if(this.isExceed(e.indexArray.length))return console.error("combine exceed vertex count "),!1;this.vertexCount+=e.indexArray.length,this.indexCount+=e.indexArray.length,this.meshInfos.push(e)},t.prototype.build=function(){var e=null;this.resource.ready?e=this.resource.material:(e=new THREE.MeshBasicMaterial({color:16777215}),this.resource.registerListener(this));for(var t=this.meshInfos,r=this.indexCount,i=this.vertexCount,n=new Float32Array(3*i),o=new Float32Array(3*i),a=new Float32Array(2*i),s=new Float32Array(4*i),l=new Float32Array(2*i),c=new Uint16Array(r),u=0,h=0,p=0,d=0,f=0,m=new THREE.BufferGeometry,g=0;g<t.length;g++){for(var v=t[g],y=v.parentPosition,E=v.indexArray,b=0;b<E.length;b++)c[b+d]=u/3+E[b];d+=E.length;for(var x=v.positionArray,b=0;b<x.length;){var _=new THREE.Vector3(x[b]+y.x,x[b+1]+y.y,x[b+2]+y.z);n[b+u]=_.x,n[b+u+1]=_.y,n[b+u+2]=_.z,b+=3}u+=x.length;for(var w=v.normalArray,b=0;b<w.length;){var T=new THREE.Vector3(w[b],w[b+1],w[b+2]);o[b+h]=T.x,o[b+h+1]=T.y,o[b+h+2]=T.z,b+=3}h+=w.length;var M=v.uvArray;if(M)for(b=0;b<M.length;b++)a[b+p]=M[b];var R=v.uv2Array;if(R)for(b=0;b<R.length;b++)l[b+p]=R[b];M&&(p+=M.length);var S=v.colorArray;if(S){for(b=0;b<S.length;b++)s[b+f]=S[b];f+=S.length}}m.addAttribute("position",new THREE.BufferAttribute(n,3)),m.addAttribute("normal",new THREE.BufferAttribute(o,3)),m.addAttribute("uv",new THREE.BufferAttribute(a,2)),0!==l.length&&m.addAttribute("uv2",new THREE.BufferAttribute(l,2)),0!==s.length&&m.addAttribute("color",new THREE.BufferAttribute(s,4)),m.setIndex(new THREE.BufferAttribute(c,1));var P=new THREE.Mesh(m,e);P.name="combine",this.combineMesh=P,this.combineMesh.name="manualWall"},t.prototype.resourceCallback=function(e){var t=null;t=Jn.enableManaulWallLightMap&&e.wallLightMaterial?e.wallLightMaterial:e.material,this.combineMesh.material=t},t}(ea),oa=function(e){function t(r,i,n){qn(this,t);var o=Xn(this,e.call(this,r,i,n));return o.meshInfos=[],o.walls=[],o.combineProcessorMap=new Map,o.combineProcessors=[],o}return Wn(t,e),t.prototype.add=function(e){this.walls.push(e)},t.prototype.build=function(){if(this.resource.ready){this.resource.isCombine||this.resource.combine();for(var e=0;e<this.walls.length;e++){var t=this.walls[e];t.build();for(var r=this.combineProcessorMap,i=this.combineProcessors,n=this.resource.combineBundleObj,o=0;o<t.modelNumber;o++){var a=t.objPositions[o],s=t.objRotations[o],l=t.objScales[o],c=new No;c.positions.push(a),c.scales.push(l),c.quaternions.push(s);n.materialMap.forEach(function(e,t,n){for(var o=e,a=t,s=0;s<o.length;s++){var l=o[s],u=r.get(a);u&&!u.isExceed(l.vertexCount)||(u=new Do(a,this),r.set(a,u),i.push(u)),u.add(l,c)}})}}for(o=0;o<this.combineProcessors.length;o++){var u=this.combineProcessors[o];u.build(),this.combineMesh.add(u.combineMesh)}}else this.resource.registerListener(this)},t.prototype.resourceCallback=function(e){this.build()},t}(ea),aa=function(e){function t(r,i,n){qn(this,t);var o=Xn(this,e.call(this,r,i,n));return o.placements=[],o.transformations=[],o.combineProcessorMap=new Map,o.combineProcessors=[],o.combineMeshs=[],o}return Wn(t,e),t.prototype.add=function(e,t){this.placements.push(e),this.transformations.push(t)},t.prototype.build=function(){this.resource.ready?(this.resource.isCombine||this.resource.combine(),!this.resource.combineBundleObj&&this.resource.isCombine||(this.resource.isCombine?this.combinePlacements():this.resource.model&&this.instancePlacements())):this.resource.registerListener(this)},t.prototype.instancePlacements=function(){for(var e=0;e<this.placements.length;e++){var t=this.placements[e];t.initResource(),t.instanceModel();var r=this.transformations[e],i=null;if(r)for(var n=r.positions.length-1;n>-1;n--){var o=new THREE.Object3D,a=r.positions[n],s=r.scales[n],l=r.quaternions[n];o.position.set(a.x,a.y,a.z),o.scale.set(s.x,s.y,s.z),o.quaternion.set(l.x,l.y,l.z,l.w),null!==i?o.add(i):o.add(t.mesh),i=o}else i=t.mesh;this.combineMesh.add(i)}},t.prototype.combinePlacements=function(){for(var e=0;e<this.placements.length;e++){var t=this.placements[e],r=this.transformations[e];void 0===r&&(r=new No);var i=this.combineProcessorMap,n=this.combineProcessors,o=this.resource.combineBundleObj;r.positions.push(t.position),r.scales.push(t.scale),r.quaternions.push(t.rotation);o.materialMap.forEach(function(e,t,o){for(var a=e,s=t,l=0;l<a.length;l++){var c=a[l],u=i.get(s);u&&!u.isExceed(c.vertexCount)||(u=new Do(s,this),i.set(s,u),n.push(u)),u.add(c,r)}})}for(var a=0;a<this.combineProcessors.length;a++){var s=this.combineProcessors[a];s.build(),this.combineMesh.add(s.combineMesh)}},t.prototype.resourceCallback=function(e){this.build()},t}(ea),sa=function(){function e(t){qn(this,e),this.resourceManager=t,this.combineBundleObjectMap={},this.processors=[]}return e.prototype.combineModels=function(){var e=this.resourceManager.models,t=[],r=this;for(var i in e)t.push(new Promise(function(t,n){var o=performance.now(),a=e[i],s=new CombineBundleObject(a.model);r.combineBundleObjectMap[a.id]=s,s.combine();performance.now()-o>.1?setTimeout(function(){t()},10):t()}));return Promise.all(t)},e.prototype.getModelObject=function(e){var t=this.combineBundleObjectMap[e];return t||null},e.prototype.addDoorOrWindow=function(e,t,r){var i=t.curPlacementCombineProcessorMap,n=t.placementCombineProcessors,o=e.resource;this.resourceManager.addPlacementResource(o);var a=i.get(o);a||(a=new aa(o,this,t),n.push(a),i.set(o,a)),a.add(e,r)},e.prototype.addStraightManualWall=function(e,t){var r=t.curStraightManualWallCombineProcessorMap,i=t.straightManualWallCombineProcessors;e.build();var n=e.rightSideMeshInfo,o=e.leftSideMeshInfo,a=e.edgeSideMeshInfo;this.addWallMeshInfo(n,e.position,r,i,t),this.addWallMeshInfo(o,e.position,r,i,t),this.addWallMeshInfo(a,e.position,r,i,t)},e.prototype.addModelWall=function(e,t){var r=t.curModelWallCombineProcessorMap,i=t.modelWallCombineProcessors,n=e.resource;this.resourceManager.addWallModelResource(n);var o=r.get(n);o||(o=new oa(n,this,t),i.push(o),r.set(n,o)),o.add(e)},e.prototype.addRoom=function(e,t){e.floor.isShow&&this.addRoomShapeGeometry(e.floorResource,e.floor.geometry,e.floor.height,ta,t.curFloorCombineProcessorMap,t.floorCombineProcessors),e.isOnlyFloor||(e.ceiling.isShow&&this.addRoomShapeGeometry(e.ceilingResource,e.ceiling.geometry,e.ceiling.height,ra,t.curCeilingCombineProcessorMap,t.ceilingCombineProcessors),e.roof.isShow&&this.addRoomShapeGeometry(e.roofResource,e.roof.geometry,e.roof.height,ia,t.curRoofCombineProcessorMap,t.roofCombineProcessors))},e.prototype.addPlacement=function(e,t,r){var i=t.curPlacementCombineProcessorMap,n=t.placementCombineProcessors,o=e.resource;this.resourceManager.addPlacementResource(o);var a=i.get(o);a||(a=new aa(o,this,t),n.push(a),i.set(o,a)),a.add(e,r)},e.prototype.addGroup=function(e,t,r){r||(r=new No),r.positions.push(e.position),r.scales.push(e.scale),r.quaternions.push(e.rotation);for(n=0;n<e.placements.length;n++){var i=e.placements[n];i.isShow&&this.addPlacement(i,t,r.clone())}for(var n=0;n<e.groups.length;n++){var o=e.groups[n];o.isShow&&this.addGroup(o,t,r.clone())}},e.prototype.addWallMeshInfo=function(e,t,r,i,n){var o=e.resource;this.resourceManager.addWallTextureResource(o),e.parentPosition=t;var a=r.get(o);a||(a=new na(o,this,n),i.push(a),r.set(o,a)),a.add(e)},e.prototype.addRoomShapeGeometry=function(e,t,r,i,n,o){this.resourceManager.addRoomResource(e);var a=e.id+r,s=n.get(a);s||(s=new i(e,this),o.push(s),s.height=r,n.set(a,s)),s.add(t)},e.prototype.getCombineProcessors=function(e,t,r,i){var n=[],o=new Map;for(var a in e){var s=e[a];if(!s.uid&&!s.name){var l=this.app.modelResource.bundleIDArray[s.bIdx],c=(this.app.modelResource.get(l).node,new THREE.Vector3(0,0,0)),u=new No;if(s.pos){var h=s.pos.split(" ");c.x=parseFloat(h[0]),c.y=parseFloat(h[1]),c.z=-parseFloat(h[2])}var p=new THREE.Vector3(1,1,1);if(s.scl){var d=s.scl.split(" ");p.x=parseFloat(d[0]),p.y=parseFloat(d[1]),p.z=parseFloat(d[2])}var f=new THREE.Quaternion(0,0,0,1);if(s.rot){var m=s.rot.split(" ");f.x=parseFloat(m[0]),f.y=parseFloat(m[1]),f.z=-parseFloat(m[2]),f.w=-parseFloat(m[3])}var g=t.slice(),v=r.slice(),y=i.slice();y.push(f),v.push(p),g.push(c),u.positions=g,u.scales=v,u.quaternions=y;this.combineBundleObjectMap[l].materialMap.forEach(function(e,t,r){for(var i=e,a=t,s=0;s<i.length;s++){var l=i[s],c=o.get(a);c&&!c.isExceed(l.vertexCount)||(c=new CombineMeshProcessor(a),o.set(a,c),n.push(c)),c.add(l,u)}})}}return n},e}(),la=function(e){function t(){return qn(this,t),Xn(this,e.call(this))}return Wn(t,e),t.prototype.build=function(){e.prototype.build.call(this)},t}(uo),ca=function(e){function t(){qn(this,t);var r=Xn(this,e.call(this));return r.points=[],r.resource=null,r.color=null,r.mesh=null,r.texture=null,r.initCompleteCallback=null,r.width=null,r}return Wn(t,e),t.prototype.build=function(){},t.prototype.initResource=function(){this.resource&&(this.resource.ready?this.texture=this.resource.texture:this.resource.registerListener(this))},t.prototype.resourceCallback=function(e){this.mesh||(this.texture=e.texture,this.initCompleteCallback&&this.initCompleteCallback(this))},t}(Kn),ua=function(e){function t(){qn(this,t);var r=Xn(this,e.call(this));return r.points=[],r.resource=null,r.color=new THREE.Color(0,0,1),r.mesh=null,r.texture=null,r.initCompleteCallback=null,r.renderMode=null,r.opacity=null,r.radius=null,r.sectionType=null,r}return Wn(t,e),t.prototype.build=function(){},t.prototype.initResource=function(){this.resource&&(this.resource.ready?this.texture=this.resource.texture:this.resource.registerListener(this))},t.prototype.resourceCallback=function(e){this.mesh||(this.texture=e.texture,this.initCompleteCallback&&this.initCompleteCallback(this))},t}(Kn),ha=function(e){function t(){return qn(this,t),Xn(this,e.call(this))}return Wn(t,e),t.prototype.build=function(){e.prototype.build.call(this)},t}(Io),pa=function(e){function t(){qn(this,t);var r=Xn(this,e.call(this));return r.text=null,r.color=null,r.font=null,r.opacity=null,r.mesh=null,r}return Wn(t,e),t.prototype.build=function(){var e=new THREE.TextGeometry(this.text,{font:t.getFont(),size:80,height:1,curveSegments:2});e.computeBoundingBox();var r=-.5*(e.boundingBox.max.x-e.boundingBox.min.x),i=[new THREE.MeshBasicMaterial({color:16777215*Math.random(),overdraw:.5}),new THREE.MeshBasicMaterial({color:0,overdraw:.5})],n=new THREE.Mesh(e,i);n.position.x=r,n.position.y=100,n.position.z=0,n.rotation.x=0,n.rotation.y=2*Math.PI,this.mesh=n},t.getFont=function(){return t.font?t.font:new THREE.Font({glyphs:{"":{x_min:0,x_max:712,ha:815,o:"m 356 -25 q 96 88 192 -25 q 0 368 0 201 q 92 642 0 533 q 356 761 192 761 q 617 644 517 761 q 712 368 712 533 q 619 91 712 201 q 356 -25 520 -25 m 356 85 q 527 175 465 85 q 583 369 583 255 q 528 562 583 484 q 356 651 466 651 q 189 560 250 651 q 135 369 135 481 q 187 177 135 257 q 356 85 250 85 "},S:{x_min:0,x_max:788,ha:890,o:"m 788 291 q 662 54 788 144 q 397 -26 550 -26 q 116 68 226 -26 q 0 337 0 168 l 131 337 q 200 152 131 220 q 384 85 269 85 q 557 129 479 85 q 650 270 650 183 q 490 429 650 379 q 194 513 341 470 q 33 739 33 584 q 142 964 33 881 q 388 1041 242 1041 q 644 957 543 1041 q 756 716 756 867 l 625 716 q 561 874 625 816 q 395 933 497 933 q 243 891 309 933 q 164 759 164 841 q 325 609 164 656 q 625 526 475 568 q 788 291 788 454 "},"":{x_min:343,x_max:449,ha:792,o:"m 449 462 l 343 462 l 343 986 l 449 986 l 449 462 m 449 -242 l 343 -242 l 343 280 l 449 280 l 449 -242 "},"/":{x_min:183.25,x_max:608.328125,ha:792,o:"m 608 1041 l 266 -129 l 183 -129 l 520 1041 l 608 1041 "},"":{x_min:-.4375,x_max:777.453125,ha:839,o:"m 777 893 l 458 893 l 458 0 l 319 0 l 319 892 l 0 892 l 0 1013 l 777 1013 l 777 893 "},y:{x_min:0,x_max:684.78125,ha:771,o:"m 684 738 l 388 -83 q 311 -216 356 -167 q 173 -279 252 -279 q 97 -266 133 -279 l 97 -149 q 132 -155 109 -151 q 168 -160 155 -160 q 240 -114 213 -160 q 274 -26 248 -98 l 0 738 l 137 737 l 341 139 l 548 737 l 684 738 "},"":{x_min:0,x_max:803,ha:917,o:"m 803 0 l 667 0 l 667 886 l 140 886 l 140 0 l 0 0 l 0 1012 l 803 1012 l 803 0 "},"":{x_min:-111,x_max:339,ha:361,o:"m 339 800 l 229 800 l 229 925 l 339 925 l 339 800 m -1 800 l -111 800 l -111 925 l -1 925 l -1 800 m 284 3 q 233 -10 258 -5 q 182 -15 207 -15 q 85 26 119 -15 q 42 200 42 79 l 42 737 l 167 737 l 168 215 q 172 141 168 157 q 226 101 183 101 q 248 103 239 101 q 284 112 257 104 l 284 3 m 302 1040 l 113 819 l 30 819 l 165 1040 l 302 1040 "},g:{x_min:0,x_max:686,ha:838,o:"m 686 34 q 586 -213 686 -121 q 331 -306 487 -306 q 131 -252 216 -306 q 31 -84 31 -190 l 155 -84 q 228 -174 166 -138 q 345 -207 284 -207 q 514 -109 454 -207 q 564 89 564 -27 q 461 6 521 36 q 335 -23 401 -23 q 88 100 184 -23 q 0 370 0 215 q 87 634 0 522 q 330 758 183 758 q 457 728 398 758 q 564 644 515 699 l 564 737 l 686 737 l 686 34 m 582 367 q 529 560 582 481 q 358 652 468 652 q 189 561 250 652 q 135 369 135 482 q 189 176 135 255 q 361 85 251 85 q 529 176 468 85 q 582 367 582 255 "},"":{x_min:0,x_max:442,ha:539,o:"m 442 383 l 0 383 q 91 566 0 492 q 260 668 176 617 q 354 798 354 727 q 315 875 354 845 q 227 905 277 905 q 136 869 173 905 q 99 761 99 833 l 14 761 q 82 922 14 864 q 232 974 141 974 q 379 926 316 974 q 442 797 442 878 q 351 635 442 704 q 183 539 321 611 q 92 455 92 491 l 442 455 l 442 383 "},"":{x_min:0,x_max:705.5625,ha:803,o:"m 705 334 l 0 334 l 0 410 l 705 410 l 705 334 "},"":{x_min:0,x_max:819.5625,ha:893,o:"m 819 0 l 650 0 l 294 509 l 139 356 l 139 0 l 0 0 l 0 1013 l 139 1013 l 139 526 l 626 1013 l 809 1013 l 395 600 l 819 0 "},"":{x_min:-46.265625,x_max:392,ha:513,o:"m 392 651 l 259 651 l 79 -279 l -46 -278 l 134 651 l 14 651 l 14 751 l 135 751 q 151 948 135 900 q 304 1041 185 1041 q 334 1040 319 1041 q 392 1034 348 1039 l 392 922 q 337 931 360 931 q 271 883 287 931 q 260 793 260 853 l 260 751 l 392 751 l 392 651 "},e:{x_min:0,x_max:714,ha:813,o:"m 714 326 l 140 326 q 200 157 140 227 q 359 87 260 87 q 488 130 431 87 q 561 245 545 174 l 697 245 q 577 48 670 123 q 358 -26 484 -26 q 97 85 195 -26 q 0 363 0 197 q 94 642 0 529 q 358 765 195 765 q 626 627 529 765 q 714 326 714 503 m 576 429 q 507 583 564 522 q 355 650 445 650 q 206 583 266 650 q 140 429 152 522 l 576 429 "},"":{x_min:0,x_max:712,ha:815,o:"m 356 -25 q 94 91 194 -25 q 0 368 0 202 q 92 642 0 533 q 356 761 192 761 q 617 644 517 761 q 712 368 712 533 q 619 91 712 201 q 356 -25 520 -25 m 356 85 q 527 175 465 85 q 583 369 583 255 q 528 562 583 484 q 356 651 466 651 q 189 560 250 651 q 135 369 135 481 q 187 177 135 257 q 356 85 250 85 m 576 1040 l 387 819 l 303 819 l 438 1040 l 576 1040 "},J:{x_min:0,x_max:588,ha:699,o:"m 588 279 q 287 -26 588 -26 q 58 73 126 -26 q 0 327 0 158 l 133 327 q 160 172 133 227 q 288 96 198 96 q 426 171 391 96 q 449 336 449 219 l 449 1013 l 588 1013 l 588 279 "},"":{x_min:-1,x_max:503,ha:601,o:"m 503 302 l 280 136 l 281 256 l 429 373 l 281 486 l 280 608 l 503 440 l 503 302 m 221 302 l 0 136 l 0 255 l 145 372 l 0 486 l -1 608 l 221 440 l 221 302 "},"":{x_min:-3,x_max:1008,ha:1106,o:"m 502 -7 q 123 151 263 -7 q -3 501 -3 294 q 123 851 -3 706 q 502 1011 263 1011 q 881 851 739 1011 q 1008 501 1008 708 q 883 151 1008 292 q 502 -7 744 -7 m 502 60 q 830 197 709 60 q 940 501 940 322 q 831 805 940 681 q 502 944 709 944 q 174 805 296 944 q 65 501 65 680 q 173 197 65 320 q 502 60 294 60 m 741 394 q 661 246 731 302 q 496 190 591 190 q 294 285 369 190 q 228 497 228 370 q 295 714 228 625 q 499 813 370 813 q 656 762 588 813 q 733 625 724 711 l 634 625 q 589 704 629 673 q 498 735 550 735 q 377 666 421 735 q 334 504 334 597 q 374 340 334 408 q 490 272 415 272 q 589 304 549 272 q 638 394 628 337 l 741 394 "},"":{x_min:0,x_max:922,ha:1030,o:"m 687 1040 l 498 819 l 415 819 l 549 1040 l 687 1040 m 922 339 q 856 97 922 203 q 650 -26 780 -26 q 538 9 587 -26 q 461 103 489 44 q 387 12 436 46 q 277 -22 339 -22 q 69 97 147 -22 q 0 338 0 202 q 45 551 0 444 q 161 737 84 643 l 302 737 q 175 552 219 647 q 124 336 124 446 q 155 179 124 248 q 275 88 197 88 q 375 163 341 88 q 400 294 400 219 l 400 572 l 524 572 l 524 294 q 561 135 524 192 q 643 88 591 88 q 762 182 719 88 q 797 341 797 257 q 745 555 797 450 q 619 737 705 637 l 760 737 q 874 551 835 640 q 922 339 922 444 "},"^":{x_min:193.0625,x_max:598.609375,ha:792,o:"m 598 772 l 515 772 l 395 931 l 277 772 l 193 772 l 326 1013 l 462 1013 l 598 772 "},"":{x_min:0,x_max:507.203125,ha:604,o:"m 506 136 l 284 302 l 284 440 l 506 608 l 507 485 l 360 371 l 506 255 l 506 136 m 222 136 l 0 302 l 0 440 l 222 608 l 221 486 l 73 373 l 222 256 l 222 136 "},D:{x_min:0,x_max:828,ha:935,o:"m 389 1013 q 714 867 593 1013 q 828 521 828 729 q 712 161 828 309 q 382 0 587 0 l 0 0 l 0 1013 l 389 1013 m 376 124 q 607 247 523 124 q 681 510 681 355 q 607 771 681 662 q 376 896 522 896 l 139 896 l 139 124 l 376 124 "},"":{x_min:0,x_max:142,ha:239,o:"m 142 585 l 0 585 l 0 738 l 142 738 l 142 585 "},"":{x_min:0,x_max:47,ha:125,o:"m 47 3 q 37 -7 47 -7 q 28 0 30 -7 q 39 -4 32 -4 q 45 3 45 -1 l 37 0 q 28 9 28 0 q 39 19 28 19 l 47 16 l 47 19 l 47 3 m 37 1 q 44 8 44 1 q 37 16 44 16 q 30 8 30 16 q 37 1 30 1 m 26 1 l 23 22 l 14 0 l 3 22 l 3 3 l 0 25 l 13 1 l 22 25 l 26 1 "},w:{x_min:0,x_max:1009.71875,ha:1100,o:"m 1009 738 l 783 0 l 658 0 l 501 567 l 345 0 l 222 0 l 0 738 l 130 738 l 284 174 l 432 737 l 576 738 l 721 173 l 881 737 l 1009 738 "},$:{x_min:0,x_max:700,ha:793,o:"m 664 717 l 542 717 q 490 825 531 785 q 381 872 450 865 l 381 551 q 620 446 540 522 q 700 241 700 370 q 618 45 700 116 q 381 -25 536 -25 l 381 -152 l 307 -152 l 307 -25 q 81 62 162 -25 q 0 297 0 149 l 124 297 q 169 146 124 204 q 307 81 215 89 l 307 441 q 80 536 148 469 q 13 725 13 603 q 96 910 13 839 q 307 982 180 982 l 307 1077 l 381 1077 l 381 982 q 574 917 494 982 q 664 717 664 845 m 307 565 l 307 872 q 187 831 233 872 q 142 724 142 791 q 180 618 142 656 q 307 565 218 580 m 381 76 q 562 237 562 96 q 517 361 562 313 q 381 423 472 409 l 381 76 "},"\\":{x_min:-.015625,x_max:425.0625,ha:522,o:"m 425 -129 l 337 -129 l 0 1041 l 83 1041 l 425 -129 "},"":{x_min:0,x_max:697.21875,ha:747,o:"m 697 -4 q 629 -14 658 -14 q 498 97 513 -14 q 422 9 470 41 q 313 -23 374 -23 q 207 4 258 -23 q 119 81 156 32 l 119 -278 l 0 -278 l 0 738 l 124 738 l 124 343 q 165 173 124 246 q 308 83 216 83 q 452 178 402 83 q 493 359 493 255 l 493 738 l 617 738 l 617 214 q 623 136 617 160 q 673 92 637 92 q 697 96 684 92 l 697 -4 "},"":{x_min:42,x_max:181,ha:297,o:"m 181 0 l 42 0 l 42 1013 l 181 1013 l 181 0 "},"":{x_min:0,x_max:1144.5,ha:1214,o:"m 1144 1012 l 807 416 l 807 0 l 667 0 l 667 416 l 325 1012 l 465 1012 l 736 533 l 1004 1012 l 1144 1012 m 277 1040 l 83 799 l 0 799 l 140 1040 l 277 1040 "},"":{x_min:0,x_max:139,ha:236,o:"m 139 851 q 102 737 139 784 q 0 669 65 690 l 0 734 q 59 787 42 741 q 72 873 72 821 l 0 873 l 0 1013 l 139 1013 l 139 851 "},"":{x_min:0,x_max:801,ha:915,o:"m 801 0 l 651 0 l 131 822 l 131 0 l 0 0 l 0 1013 l 151 1013 l 670 191 l 670 1013 l 801 1013 l 801 0 "},"-":{x_min:8.71875,x_max:350.390625,ha:478,o:"m 350 317 l 8 317 l 8 428 l 350 428 l 350 317 "},Q:{x_min:0,x_max:968,ha:1072,o:"m 954 5 l 887 -79 l 744 35 q 622 -11 687 2 q 483 -26 556 -26 q 127 130 262 -26 q 0 504 0 279 q 127 880 0 728 q 484 1041 262 1041 q 841 884 708 1041 q 968 507 968 735 q 933 293 968 398 q 832 104 899 188 l 954 5 m 723 191 q 802 330 777 248 q 828 499 828 412 q 744 790 828 673 q 483 922 650 922 q 228 791 322 922 q 142 505 142 673 q 227 221 142 337 q 487 91 323 91 q 632 123 566 91 l 520 215 l 587 301 l 723 191 "},"":{x_min:1,x_max:676.28125,ha:740,o:"m 676 460 l 551 460 q 498 595 542 546 q 365 651 448 651 q 199 578 263 651 q 136 401 136 505 q 266 178 136 241 q 508 106 387 142 q 640 -50 640 62 q 625 -158 640 -105 q 583 -278 611 -211 l 465 -278 q 498 -182 490 -211 q 515 -80 515 -126 q 381 12 515 -15 q 134 91 197 51 q 1 388 1 179 q 100 651 1 542 q 354 761 199 761 q 587 680 498 761 q 676 460 676 599 "},M:{x_min:0,x_max:954,ha:1067,o:"m 954 0 l 819 0 l 819 869 l 537 0 l 405 0 l 128 866 l 128 0 l 0 0 l 0 1013 l 200 1013 l 472 160 l 757 1013 l 954 1013 l 954 0 "},"":{x_min:0,x_max:1006,ha:1094,o:"m 1006 678 q 914 319 1006 429 q 571 200 814 200 l 571 0 l 433 0 l 433 200 q 92 319 194 200 q 0 678 0 429 l 0 1013 l 139 1013 l 139 679 q 191 417 139 492 q 433 326 255 326 l 433 1013 l 571 1013 l 571 326 l 580 326 q 813 423 747 326 q 868 679 868 502 l 868 1013 l 1006 1013 l 1006 678 "},C:{x_min:0,x_max:886,ha:944,o:"m 886 379 q 760 87 886 201 q 455 -26 634 -26 q 112 136 236 -26 q 0 509 0 283 q 118 882 0 737 q 469 1041 245 1041 q 748 955 630 1041 q 879 708 879 859 l 745 708 q 649 862 724 805 q 473 920 573 920 q 219 791 312 920 q 136 509 136 675 q 217 229 136 344 q 470 99 311 99 q 672 179 591 99 q 753 379 753 259 l 886 379 "},"!":{x_min:0,x_max:138,ha:236,o:"m 138 684 q 116 409 138 629 q 105 244 105 299 l 33 244 q 16 465 33 313 q 0 684 0 616 l 0 1013 l 138 1013 l 138 684 m 138 0 l 0 0 l 0 151 l 138 151 l 138 0 "},"{":{x_min:0,x_max:480.5625,ha:578,o:"m 480 -286 q 237 -213 303 -286 q 187 -45 187 -159 q 194 48 187 -15 q 201 141 201 112 q 164 264 201 225 q 0 314 118 314 l 0 417 q 164 471 119 417 q 201 605 201 514 q 199 665 201 644 q 193 772 193 769 q 241 941 193 887 q 480 1015 308 1015 l 480 915 q 336 866 375 915 q 306 742 306 828 q 310 662 306 717 q 314 577 314 606 q 288 452 314 500 q 176 365 256 391 q 289 275 257 337 q 314 143 314 226 q 313 84 314 107 q 310 -11 310 -5 q 339 -131 310 -94 q 480 -182 377 -182 l 480 -286 "},X:{x_min:-.015625,x_max:854.15625,ha:940,o:"m 854 0 l 683 0 l 423 409 l 166 0 l 0 0 l 347 519 l 18 1013 l 186 1013 l 428 637 l 675 1013 l 836 1013 l 504 520 l 854 0 "},"#":{x_min:0,x_max:963.890625,ha:1061,o:"m 963 690 l 927 590 l 719 590 l 655 410 l 876 410 l 840 310 l 618 310 l 508 -3 l 393 -2 l 506 309 l 329 310 l 215 -2 l 102 -3 l 212 310 l 0 310 l 36 410 l 248 409 l 312 590 l 86 590 l 120 690 l 347 690 l 459 1006 l 573 1006 l 462 690 l 640 690 l 751 1006 l 865 1006 l 754 690 l 963 690 m 606 590 l 425 590 l 362 410 l 543 410 l 606 590 "},"":{x_min:42,x_max:284,ha:361,o:"m 284 3 q 233 -10 258 -5 q 182 -15 207 -15 q 85 26 119 -15 q 42 200 42 79 l 42 738 l 167 738 l 168 215 q 172 141 168 157 q 226 101 183 101 q 248 103 239 101 q 284 112 257 104 l 284 3 "},"":{x_min:0,x_max:906.953125,ha:982,o:"m 283 1040 l 88 799 l 5 799 l 145 1040 l 283 1040 m 906 0 l 756 0 l 650 303 l 251 303 l 143 0 l 0 0 l 376 1012 l 529 1012 l 906 0 m 609 421 l 452 866 l 293 421 l 609 421 "},")":{x_min:0,x_max:318,ha:415,o:"m 318 365 q 257 25 318 191 q 87 -290 197 -141 l 0 -290 q 140 21 93 -128 q 193 360 193 189 q 141 704 193 537 q 0 1024 97 850 l 87 1024 q 257 706 197 871 q 318 365 318 542 "},"":{x_min:0,x_max:634.71875,ha:714,o:"m 634 234 q 527 38 634 110 q 300 -25 433 -25 q 98 29 183 -25 q 0 204 0 93 q 37 314 0 265 q 128 390 67 353 q 56 460 82 419 q 26 555 26 505 q 114 712 26 654 q 295 763 191 763 q 499 700 416 763 q 589 515 589 631 l 478 515 q 419 618 464 580 q 307 657 374 657 q 207 630 253 657 q 151 547 151 598 q 238 445 151 469 q 389 434 280 434 l 389 331 l 349 331 q 206 315 255 331 q 125 210 125 287 q 183 107 125 145 q 302 76 233 76 q 436 117 379 76 q 509 234 493 159 l 634 234 "},"":{x_min:0,x_max:952.78125,ha:1028,o:"m 952 0 l 0 0 l 400 1013 l 551 1013 l 952 0 m 762 124 l 476 867 l 187 124 l 762 124 "},"}":{x_min:0,x_max:481,ha:578,o:"m 481 314 q 318 262 364 314 q 282 136 282 222 q 284 65 282 97 q 293 -58 293 -48 q 241 -217 293 -166 q 0 -286 174 -286 l 0 -182 q 143 -130 105 -182 q 171 -2 171 -93 q 168 81 171 22 q 165 144 165 140 q 188 275 165 229 q 306 365 220 339 q 191 455 224 391 q 165 588 165 505 q 168 681 165 624 q 171 742 171 737 q 141 865 171 827 q 0 915 102 915 l 0 1015 q 243 942 176 1015 q 293 773 293 888 q 287 675 293 741 q 282 590 282 608 q 318 466 282 505 q 481 417 364 417 l 481 314 "},"":{x_min:-3,x_max:1672,ha:1821,o:"m 846 0 q 664 76 732 0 q 603 244 603 145 q 662 412 603 344 q 846 489 729 489 q 1027 412 959 489 q 1089 244 1089 343 q 1029 76 1089 144 q 846 0 962 0 m 845 103 q 945 143 910 103 q 981 243 981 184 q 947 340 981 301 q 845 385 910 385 q 745 342 782 385 q 709 243 709 300 q 742 147 709 186 q 845 103 781 103 m 888 986 l 284 -25 l 199 -25 l 803 986 l 888 986 m 241 468 q 58 545 126 468 q -3 715 -3 615 q 56 881 -3 813 q 238 958 124 958 q 421 881 353 958 q 483 712 483 813 q 423 544 483 612 q 241 468 356 468 m 241 855 q 137 811 175 855 q 100 710 100 768 q 136 612 100 653 q 240 572 172 572 q 344 614 306 572 q 382 713 382 656 q 347 810 382 771 q 241 855 308 855 m 1428 0 q 1246 76 1314 0 q 1185 244 1185 145 q 1244 412 1185 344 q 1428 489 1311 489 q 1610 412 1542 489 q 1672 244 1672 343 q 1612 76 1672 144 q 1428 0 1545 0 m 1427 103 q 1528 143 1492 103 q 1564 243 1564 184 q 1530 340 1564 301 q 1427 385 1492 385 q 1327 342 1364 385 q 1291 243 1291 300 q 1324 147 1291 186 q 1427 103 1363 103 "},a:{x_min:0,x_max:698.609375,ha:794,o:"m 698 0 q 661 -12 679 -7 q 615 -17 643 -17 q 536 12 564 -17 q 500 96 508 41 q 384 6 456 37 q 236 -25 312 -25 q 65 31 130 -25 q 0 194 0 88 q 118 390 0 334 q 328 435 180 420 q 488 483 476 451 q 495 523 495 504 q 442 619 495 584 q 325 654 389 654 q 209 617 257 654 q 152 513 161 580 l 33 513 q 123 705 33 633 q 332 772 207 772 q 528 712 448 772 q 617 531 617 645 l 617 163 q 624 108 617 126 q 664 90 632 90 l 698 94 l 698 0 m 491 262 l 491 372 q 272 329 350 347 q 128 201 128 294 q 166 113 128 144 q 264 83 205 83 q 414 130 346 83 q 491 262 491 183 "},"":{x_min:0,x_max:941.671875,ha:1039,o:"m 941 334 l 0 334 l 0 410 l 941 410 l 941 334 "},"=":{x_min:8.71875,x_max:780.953125,ha:792,o:"m 780 510 l 8 510 l 8 606 l 780 606 l 780 510 m 780 235 l 8 235 l 8 332 l 780 332 l 780 235 "},N:{x_min:0,x_max:801,ha:914,o:"m 801 0 l 651 0 l 131 823 l 131 0 l 0 0 l 0 1013 l 151 1013 l 670 193 l 670 1013 l 801 1013 l 801 0 "},"":{x_min:0,x_max:712,ha:797,o:"m 712 369 q 620 94 712 207 q 362 -26 521 -26 q 230 2 292 -26 q 119 83 167 30 l 119 -278 l 0 -278 l 0 362 q 91 643 0 531 q 355 764 190 764 q 617 647 517 764 q 712 369 712 536 m 583 366 q 530 559 583 480 q 359 651 469 651 q 190 562 252 651 q 135 370 135 483 q 189 176 135 257 q 359 85 250 85 q 528 175 466 85 q 583 366 583 254 "},2:{x_min:59,x_max:731,ha:792,o:"m 731 0 l 59 0 q 197 314 59 188 q 457 487 199 315 q 598 691 598 580 q 543 819 598 772 q 411 867 488 867 q 272 811 328 867 q 209 630 209 747 l 81 630 q 182 901 81 805 q 408 986 271 986 q 629 909 536 986 q 731 694 731 826 q 613 449 731 541 q 378 316 495 383 q 201 122 235 234 l 731 122 l 731 0 "},"":{x_min:0,x_max:941.671875,ha:938,o:"m 941 1033 l 0 1033 l 0 1109 l 941 1109 l 941 1033 "},Z:{x_min:0,x_max:779,ha:849,o:"m 779 0 l 0 0 l 0 113 l 621 896 l 40 896 l 40 1013 l 779 1013 l 778 887 l 171 124 l 779 124 l 779 0 "},u:{x_min:0,x_max:617,ha:729,o:"m 617 0 l 499 0 l 499 110 q 391 10 460 45 q 246 -25 322 -25 q 61 58 127 -25 q 0 258 0 136 l 0 738 l 125 738 l 125 284 q 156 148 125 202 q 273 82 197 82 q 433 165 369 82 q 493 340 493 243 l 493 738 l 617 738 l 617 0 "},k:{x_min:0,x_max:612.484375,ha:697,o:"m 612 738 l 338 465 l 608 0 l 469 0 l 251 382 l 121 251 l 121 0 l 0 0 l 0 1013 l 121 1013 l 121 402 l 456 738 l 612 738 "},"":{x_min:0,x_max:803,ha:917,o:"m 803 0 l 667 0 l 667 475 l 140 475 l 140 0 l 0 0 l 0 1013 l 140 1013 l 140 599 l 667 599 l 667 1013 l 803 1013 l 803 0 "},"":{x_min:0,x_max:906.953125,ha:985,o:"m 906 0 l 756 0 l 650 303 l 251 303 l 143 0 l 0 0 l 376 1013 l 529 1013 l 906 0 m 609 421 l 452 866 l 293 421 l 609 421 "},s:{x_min:0,x_max:604,ha:697,o:"m 604 217 q 501 36 604 104 q 292 -23 411 -23 q 86 43 166 -23 q 0 238 0 114 l 121 237 q 175 122 121 164 q 300 85 223 85 q 415 112 363 85 q 479 207 479 147 q 361 309 479 276 q 140 372 141 370 q 21 544 21 426 q 111 708 21 647 q 298 761 190 761 q 492 705 413 761 q 583 531 583 643 l 462 531 q 412 625 462 594 q 298 657 363 657 q 199 636 242 657 q 143 558 143 608 q 262 454 143 486 q 484 394 479 397 q 604 217 604 341 "},B:{x_min:0,x_max:778,ha:876,o:"m 580 546 q 724 469 670 535 q 778 311 778 403 q 673 83 778 171 q 432 0 575 0 l 0 0 l 0 1013 l 411 1013 q 629 957 541 1013 q 732 768 732 892 q 691 633 732 693 q 580 546 650 572 m 393 899 l 139 899 l 139 588 l 379 588 q 521 624 462 588 q 592 744 592 667 q 531 859 592 819 q 393 899 471 899 m 419 124 q 566 169 504 124 q 635 303 635 219 q 559 436 635 389 q 402 477 494 477 l 139 477 l 139 124 l 419 124 "},"":{x_min:0,x_max:614,ha:708,o:"m 142 0 l 0 0 l 0 151 l 142 151 l 142 0 m 378 0 l 236 0 l 236 151 l 378 151 l 378 0 m 614 0 l 472 0 l 472 151 l 614 151 l 614 0 "},"?":{x_min:0,x_max:607,ha:704,o:"m 607 777 q 543 599 607 674 q 422 474 482 537 q 357 272 357 391 l 236 272 q 297 487 236 395 q 411 619 298 490 q 474 762 474 691 q 422 885 474 838 q 301 933 371 933 q 179 880 228 933 q 124 706 124 819 l 0 706 q 94 963 0 872 q 302 1044 177 1044 q 511 973 423 1044 q 607 777 607 895 m 370 0 l 230 0 l 230 151 l 370 151 l 370 0 "},H:{x_min:0,x_max:803,ha:915,o:"m 803 0 l 667 0 l 667 475 l 140 475 l 140 0 l 0 0 l 0 1013 l 140 1013 l 140 599 l 667 599 l 667 1013 l 803 1013 l 803 0 "},"":{x_min:0,x_max:675,ha:761,o:"m 675 738 l 404 0 l 272 0 l 0 738 l 133 738 l 340 147 l 541 738 l 675 738 "},c:{x_min:1,x_max:701.390625,ha:775,o:"m 701 264 q 584 53 681 133 q 353 -26 487 -26 q 91 91 188 -26 q 1 370 1 201 q 92 645 1 537 q 353 761 190 761 q 572 688 479 761 q 690 493 666 615 l 556 493 q 487 606 545 562 q 356 650 428 650 q 186 563 246 650 q 134 372 134 487 q 188 179 134 258 q 359 88 250 88 q 492 136 437 88 q 566 264 548 185 l 701 264 "},"":{x_min:0,x_max:566.671875,ha:678,o:"m 21 892 l 52 892 l 98 761 l 145 892 l 176 892 l 178 741 l 157 741 l 157 867 l 108 741 l 88 741 l 40 871 l 40 741 l 21 741 l 21 892 m 308 854 l 308 731 q 252 691 308 691 q 227 691 240 691 q 207 696 213 695 l 207 712 l 253 706 q 288 733 288 706 l 288 763 q 244 741 279 741 q 193 797 193 741 q 261 860 193 860 q 287 860 273 860 q 308 854 302 855 m 288 842 l 263 843 q 213 796 213 843 q 248 756 213 756 q 288 796 288 756 l 288 842 m 566 988 l 502 988 l 502 -1 l 439 -1 l 439 988 l 317 988 l 317 -1 l 252 -1 l 252 602 q 81 653 155 602 q 0 805 0 711 q 101 989 0 918 q 309 1053 194 1053 l 566 1053 l 566 988 "},"":{x_min:0,x_max:660,ha:745,o:"m 471 550 q 610 450 561 522 q 660 280 660 378 q 578 64 660 151 q 367 -22 497 -22 q 239 5 299 -22 q 126 82 178 32 l 126 -278 l 0 -278 l 0 593 q 54 903 0 801 q 318 1042 127 1042 q 519 964 436 1042 q 603 771 603 887 q 567 644 603 701 q 471 550 532 586 m 337 79 q 476 138 418 79 q 535 279 535 198 q 427 437 535 386 q 226 477 344 477 l 226 583 q 398 620 329 583 q 486 762 486 668 q 435 884 486 833 q 312 935 384 935 q 169 861 219 935 q 126 698 126 797 l 126 362 q 170 169 126 242 q 337 79 224 79 "},"":{x_min:0,x_max:954,ha:1068,o:"m 954 0 l 819 0 l 819 868 l 537 0 l 405 0 l 128 865 l 128 0 l 0 0 l 0 1013 l 199 1013 l 472 158 l 758 1013 l 954 1013 l 954 0 "},"":{x_min:.109375,x_max:1120,ha:1217,o:"m 1120 505 q 994 132 1120 282 q 642 -29 861 -29 q 290 130 422 -29 q 167 505 167 280 q 294 883 167 730 q 650 1046 430 1046 q 999 882 868 1046 q 1120 505 1120 730 m 977 504 q 896 784 977 669 q 644 915 804 915 q 391 785 484 915 q 307 504 307 669 q 391 224 307 339 q 644 95 486 95 q 894 224 803 95 q 977 504 977 339 m 277 1040 l 83 799 l 0 799 l 140 1040 l 277 1040 "},"":{x_min:0,x_max:1158,ha:1275,o:"m 1158 0 l 1022 0 l 1022 475 l 496 475 l 496 0 l 356 0 l 356 1012 l 496 1012 l 496 599 l 1022 599 l 1022 1012 l 1158 1012 l 1158 0 m 277 1040 l 83 799 l 0 799 l 140 1040 l 277 1040 "},"":{x_min:0,x_max:663.890625,ha:775,o:"m 663 529 q 566 293 663 391 q 331 196 469 196 q 97 294 194 196 q 0 529 0 393 q 96 763 0 665 q 331 861 193 861 q 566 763 469 861 q 663 529 663 665 "},"":{x_min:.1875,x_max:819.546875,ha:886,o:"m 563 561 l 697 561 l 696 487 l 520 487 l 482 416 l 482 380 l 697 380 l 695 308 l 482 308 l 482 0 l 342 0 l 342 308 l 125 308 l 125 380 l 342 380 l 342 417 l 303 487 l 125 487 l 125 561 l 258 561 l 0 1013 l 140 1013 l 411 533 l 679 1013 l 819 1013 l 563 561 "},"(":{x_min:0,x_max:318.0625,ha:415,o:"m 318 -290 l 230 -290 q 61 23 122 -142 q 0 365 0 190 q 62 712 0 540 q 230 1024 119 869 l 318 1024 q 175 705 219 853 q 125 360 125 542 q 176 22 125 187 q 318 -290 223 -127 "},U:{x_min:0,x_max:796,ha:904,o:"m 796 393 q 681 93 796 212 q 386 -25 566 -25 q 101 95 208 -25 q 0 393 0 211 l 0 1013 l 138 1013 l 138 391 q 204 191 138 270 q 394 107 276 107 q 586 191 512 107 q 656 391 656 270 l 656 1013 l 796 1013 l 796 393 "},"":{x_min:.5,x_max:744.953125,ha:822,o:"m 744 737 l 463 54 l 463 -278 l 338 -278 l 338 54 l 154 495 q 104 597 124 569 q 13 651 67 651 l 0 651 l 0 751 l 39 753 q 168 711 121 753 q 242 594 207 676 l 403 208 l 617 737 l 744 737 "},"":{x_min:0,x_max:765.5625,ha:809,o:"m 765 -4 q 698 -14 726 -14 q 564 97 586 -14 q 466 7 525 40 q 337 -26 407 -26 q 88 98 186 -26 q 0 369 0 212 q 88 637 0 525 q 337 760 184 760 q 465 728 407 760 q 563 637 524 696 l 563 739 l 685 739 l 685 222 q 693 141 685 168 q 748 94 708 94 q 765 96 760 94 l 765 -4 m 584 371 q 531 562 584 485 q 360 653 470 653 q 192 566 254 653 q 135 379 135 489 q 186 181 135 261 q 358 84 247 84 q 528 176 465 84 q 584 371 584 260 "},F:{x_min:0,x_max:683.328125,ha:717,o:"m 683 888 l 140 888 l 140 583 l 613 583 l 613 458 l 140 458 l 140 0 l 0 0 l 0 1013 l 683 1013 l 683 888 "},"":{x_min:0,x_max:705.5625,ha:803,o:"m 705 334 l 0 334 l 0 410 l 705 410 l 705 334 "},":":{x_min:0,x_max:142,ha:239,o:"m 142 585 l 0 585 l 0 738 l 142 738 l 142 585 m 142 0 l 0 0 l 0 151 l 142 151 l 142 0 "},"":{x_min:0,x_max:854.171875,ha:935,o:"m 854 0 l 683 0 l 423 409 l 166 0 l 0 0 l 347 519 l 18 1013 l 186 1013 l 427 637 l 675 1013 l 836 1013 l 504 521 l 854 0 "},"*":{x_min:116,x_max:674,ha:792,o:"m 674 768 l 475 713 l 610 544 l 517 477 l 394 652 l 272 478 l 178 544 l 314 713 l 116 766 l 153 876 l 341 812 l 342 1013 l 446 1013 l 446 811 l 635 874 l 674 768 "},"":{x_min:0,x_max:777,ha:835,o:"m 458 804 l 777 804 l 777 683 l 458 683 l 458 0 l 319 0 l 319 681 l 0 683 l 0 804 l 319 804 l 319 1015 l 458 1013 l 458 804 "},"":{x_min:0,x_max:347,ha:444,o:"m 173 802 q 43 856 91 802 q 0 977 0 905 q 45 1101 0 1049 q 173 1153 90 1153 q 303 1098 255 1153 q 347 977 347 1049 q 303 856 347 905 q 173 802 256 802 m 173 884 q 238 910 214 884 q 262 973 262 937 q 239 1038 262 1012 q 173 1064 217 1064 q 108 1037 132 1064 q 85 973 85 1010 q 108 910 85 937 q 173 884 132 884 "},V:{x_min:0,x_max:862.71875,ha:940,o:"m 862 1013 l 505 0 l 361 0 l 0 1013 l 143 1013 l 434 165 l 718 1012 l 862 1013 "},"":{x_min:0,x_max:734.71875,ha:763,o:"m 723 889 l 9 889 l 9 1013 l 723 1013 l 723 889 m 673 463 l 61 463 l 61 589 l 673 589 l 673 463 m 734 0 l 0 0 l 0 124 l 734 124 l 734 0 "},"":{x_min:0,x_max:0,ha:853},"":{x_min:.328125,x_max:819.515625,ha:889,o:"m 588 1046 l 460 1046 l 460 1189 l 588 1189 l 588 1046 m 360 1046 l 232 1046 l 232 1189 l 360 1189 l 360 1046 m 819 1012 l 482 416 l 482 0 l 342 0 l 342 416 l 0 1012 l 140 1012 l 411 533 l 679 1012 l 819 1012 "},0:{x_min:73,x_max:715,ha:792,o:"m 394 -29 q 153 129 242 -29 q 73 479 73 272 q 152 829 73 687 q 394 989 241 989 q 634 829 545 989 q 715 479 715 684 q 635 129 715 270 q 394 -29 546 -29 m 394 89 q 546 211 489 89 q 598 479 598 322 q 548 748 598 640 q 394 871 491 871 q 241 748 298 871 q 190 479 190 637 q 239 211 190 319 q 394 89 296 89 "},"":{x_min:0,x_max:347,ha:454,o:"m 139 851 q 102 737 139 784 q 0 669 65 690 l 0 734 q 59 787 42 741 q 72 873 72 821 l 0 873 l 0 1013 l 139 1013 l 139 851 m 347 851 q 310 737 347 784 q 208 669 273 690 l 208 734 q 267 787 250 741 q 280 873 280 821 l 208 873 l 208 1013 l 347 1013 l 347 851 "},"@":{x_min:0,x_max:1260,ha:1357,o:"m 1098 -45 q 877 -160 1001 -117 q 633 -203 752 -203 q 155 -29 327 -203 q 0 360 0 127 q 176 802 0 616 q 687 1008 372 1008 q 1123 854 969 1008 q 1260 517 1260 718 q 1155 216 1260 341 q 868 82 1044 82 q 772 106 801 82 q 737 202 737 135 q 647 113 700 144 q 527 82 594 82 q 367 147 420 82 q 314 312 314 212 q 401 565 314 452 q 639 690 498 690 q 810 588 760 690 l 849 668 l 938 668 q 877 441 900 532 q 833 226 833 268 q 853 182 833 198 q 902 167 873 167 q 1088 272 1012 167 q 1159 512 1159 372 q 1051 793 1159 681 q 687 925 925 925 q 248 747 415 925 q 97 361 97 586 q 226 26 97 159 q 627 -122 370 -122 q 856 -87 737 -122 q 1061 8 976 -53 l 1098 -45 m 786 488 q 738 580 777 545 q 643 615 700 615 q 483 517 548 615 q 425 322 425 430 q 457 203 425 250 q 552 156 490 156 q 722 273 665 156 q 786 488 738 309 "},"":{x_min:0,x_max:499,ha:613,o:"m 277 1040 l 83 799 l 0 799 l 140 1040 l 277 1040 m 499 0 l 360 0 l 360 1012 l 499 1012 l 499 0 "},i:{x_min:14,x_max:136,ha:275,o:"m 136 873 l 14 873 l 14 1013 l 136 1013 l 136 873 m 136 0 l 14 0 l 14 737 l 136 737 l 136 0 "},"":{x_min:0,x_max:778,ha:877,o:"m 580 545 q 724 468 671 534 q 778 310 778 402 q 673 83 778 170 q 432 0 575 0 l 0 0 l 0 1013 l 411 1013 q 629 957 541 1013 q 732 768 732 891 q 691 632 732 692 q 580 545 650 571 m 393 899 l 139 899 l 139 587 l 379 587 q 521 623 462 587 q 592 744 592 666 q 531 859 592 819 q 393 899 471 899 m 419 124 q 566 169 504 124 q 635 302 635 219 q 559 435 635 388 q 402 476 494 476 l 139 476 l 139 124 l 419 124 "},"":{x_min:0,x_max:617,ha:725,o:"m 617 352 q 540 94 617 199 q 308 -24 455 -24 q 76 94 161 -24 q 0 352 0 199 l 0 739 l 126 739 l 126 355 q 169 185 126 257 q 312 98 220 98 q 451 185 402 98 q 492 355 492 257 l 492 739 l 617 739 l 617 352 "},"]":{x_min:0,x_max:275,ha:372,o:"m 275 -281 l 0 -281 l 0 -187 l 151 -187 l 151 920 l 0 920 l 0 1013 l 275 1013 l 275 -281 "},m:{x_min:0,x_max:1019,ha:1128,o:"m 1019 0 l 897 0 l 897 454 q 860 591 897 536 q 739 660 816 660 q 613 586 659 660 q 573 436 573 522 l 573 0 l 447 0 l 447 455 q 412 591 447 535 q 294 657 372 657 q 165 586 213 657 q 122 437 122 521 l 122 0 l 0 0 l 0 738 l 117 738 l 117 640 q 202 730 150 697 q 316 763 254 763 q 437 730 381 763 q 525 642 494 697 q 621 731 559 700 q 753 763 682 763 q 943 694 867 763 q 1019 512 1019 625 l 1019 0 "},"":{x_min:8.328125,x_max:780.5625,ha:815,o:"m 780 -278 q 715 -294 747 -294 q 616 -257 663 -294 q 548 -175 576 -227 l 379 133 l 143 -277 l 9 -277 l 313 254 l 163 522 q 127 586 131 580 q 36 640 91 640 q 8 637 27 640 l 8 752 l 52 757 q 162 719 113 757 q 236 627 200 690 l 383 372 l 594 737 l 726 737 l 448 250 l 625 -69 q 670 -153 647 -110 q 743 -188 695 -188 q 780 -184 759 -188 l 780 -278 "},8:{x_min:55,x_max:736,ha:792,o:"m 571 527 q 694 424 652 491 q 736 280 736 358 q 648 71 736 158 q 395 -26 551 -26 q 142 69 238 -26 q 55 279 55 157 q 96 425 55 359 q 220 527 138 491 q 120 615 153 562 q 88 726 88 668 q 171 904 88 827 q 395 986 261 986 q 618 905 529 986 q 702 727 702 830 q 670 616 702 667 q 571 527 638 565 m 394 565 q 519 610 475 565 q 563 717 563 655 q 521 823 563 781 q 392 872 474 872 q 265 824 312 872 q 224 720 224 783 q 265 613 224 656 q 394 565 312 565 m 395 91 q 545 150 488 91 q 597 280 597 204 q 546 408 597 355 q 395 465 492 465 q 244 408 299 465 q 194 280 194 356 q 244 150 194 203 q 395 91 299 91 "},"":{x_min:42,x_max:326.71875,ha:361,o:"m 284 3 q 233 -10 258 -5 q 182 -15 207 -15 q 85 26 119 -15 q 42 200 42 79 l 42 737 l 167 737 l 168 215 q 172 141 168 157 q 226 101 183 101 q 248 102 239 101 q 284 112 257 104 l 284 3 m 326 1040 l 137 819 l 54 819 l 189 1040 l 326 1040 "},"":{x_min:0,x_max:779.171875,ha:850,o:"m 779 0 l 0 0 l 0 113 l 620 896 l 40 896 l 40 1013 l 779 1013 l 779 887 l 170 124 l 779 124 l 779 0 "},R:{x_min:0,x_max:781.953125,ha:907,o:"m 781 0 l 623 0 q 587 242 590 52 q 407 433 585 433 l 138 433 l 138 0 l 0 0 l 0 1013 l 396 1013 q 636 946 539 1013 q 749 731 749 868 q 711 597 749 659 q 608 502 674 534 q 718 370 696 474 q 729 207 722 352 q 781 26 736 62 l 781 0 m 373 551 q 533 594 465 551 q 614 731 614 645 q 532 859 614 815 q 373 896 465 896 l 138 896 l 138 551 l 373 551 "},o:{x_min:0,x_max:713,ha:821,o:"m 357 -25 q 94 91 194 -25 q 0 368 0 202 q 93 642 0 533 q 357 761 193 761 q 618 644 518 761 q 713 368 713 533 q 619 91 713 201 q 357 -25 521 -25 m 357 85 q 528 175 465 85 q 584 369 584 255 q 529 562 584 484 q 357 651 467 651 q 189 560 250 651 q 135 369 135 481 q 187 177 135 257 q 357 85 250 85 "},5:{x_min:54.171875,x_max:738,ha:792,o:"m 738 314 q 626 60 738 153 q 382 -23 526 -23 q 155 47 248 -23 q 54 256 54 125 l 183 256 q 259 132 204 174 q 382 91 314 91 q 533 149 471 91 q 602 314 602 213 q 538 469 602 411 q 386 528 475 528 q 284 506 332 528 q 197 439 237 484 l 81 439 l 159 958 l 684 958 l 684 840 l 254 840 l 214 579 q 306 627 258 612 q 407 643 354 643 q 636 552 540 643 q 738 314 738 457 "},7:{x_min:58.71875,x_max:730.953125,ha:792,o:"m 730 839 q 469 448 560 641 q 335 0 378 255 l 192 0 q 328 441 235 252 q 593 830 421 630 l 58 830 l 58 958 l 730 958 l 730 839 "},K:{x_min:0,x_max:819.46875,ha:906,o:"m 819 0 l 649 0 l 294 509 l 139 355 l 139 0 l 0 0 l 0 1013 l 139 1013 l 139 526 l 626 1013 l 809 1013 l 395 600 l 819 0 "},",":{x_min:0,x_max:142,ha:239,o:"m 142 -12 q 105 -132 142 -82 q 0 -205 68 -182 l 0 -138 q 57 -82 40 -124 q 70 0 70 -51 l 0 0 l 0 151 l 142 151 l 142 -12 "},d:{x_min:0,x_max:683,ha:796,o:"m 683 0 l 564 0 l 564 93 q 456 6 516 38 q 327 -25 395 -25 q 87 100 181 -25 q 0 365 0 215 q 90 639 0 525 q 343 763 187 763 q 564 647 486 763 l 564 1013 l 683 1013 l 683 0 m 582 373 q 529 562 582 484 q 361 653 468 653 q 190 561 253 653 q 135 365 135 479 q 189 175 135 254 q 358 85 251 85 q 529 178 468 85 q 582 373 582 258 "},"":{x_min:-109,x_max:247,ha:232,o:"m 247 1046 l 119 1046 l 119 1189 l 247 1189 l 247 1046 m 19 1046 l -109 1046 l -109 1189 l 19 1189 l 19 1046 "},E:{x_min:0,x_max:736.109375,ha:789,o:"m 736 0 l 0 0 l 0 1013 l 725 1013 l 725 889 l 139 889 l 139 585 l 677 585 l 677 467 l 139 467 l 139 125 l 736 125 l 736 0 "},Y:{x_min:0,x_max:820,ha:886,o:"m 820 1013 l 482 416 l 482 0 l 342 0 l 342 416 l 0 1013 l 140 1013 l 411 534 l 679 1012 l 820 1013 "},'"':{x_min:0,x_max:299,ha:396,o:"m 299 606 l 203 606 l 203 988 l 299 988 l 299 606 m 96 606 l 0 606 l 0 988 l 96 988 l 96 606 "},"":{x_min:17.984375,x_max:773.609375,ha:792,o:"m 773 40 l 18 376 l 17 465 l 773 799 l 773 692 l 159 420 l 773 149 l 773 40 "},"":{x_min:0,x_max:364,ha:467,o:"m 141 -12 q 104 -132 141 -82 q 0 -205 67 -182 l 0 -138 q 56 -82 40 -124 q 69 0 69 -51 l 0 0 l 0 151 l 141 151 l 141 -12 m 364 -12 q 327 -132 364 -82 q 222 -205 290 -182 l 222 -138 q 279 -82 262 -124 q 292 0 292 -51 l 222 0 l 222 151 l 364 151 l 364 -12 "},"":{x_min:1,x_max:710,ha:810,o:"m 710 360 q 616 87 710 196 q 356 -28 518 -28 q 99 82 197 -28 q 1 356 1 192 q 100 606 1 509 q 355 703 199 703 q 180 829 288 754 q 70 903 124 866 l 70 1012 l 643 1012 l 643 901 l 258 901 q 462 763 422 794 q 636 592 577 677 q 710 360 710 485 m 584 365 q 552 501 584 447 q 451 602 521 555 q 372 611 411 611 q 197 541 258 611 q 136 355 136 472 q 190 171 136 245 q 358 85 252 85 q 528 173 465 85 q 584 365 584 252 "},"":{x_min:0,x_max:634.71875,ha:714,o:"m 634 234 q 527 38 634 110 q 300 -25 433 -25 q 98 29 183 -25 q 0 204 0 93 q 37 313 0 265 q 128 390 67 352 q 56 459 82 419 q 26 555 26 505 q 114 712 26 654 q 295 763 191 763 q 499 700 416 763 q 589 515 589 631 l 478 515 q 419 618 464 580 q 307 657 374 657 q 207 630 253 657 q 151 547 151 598 q 238 445 151 469 q 389 434 280 434 l 389 331 l 349 331 q 206 315 255 331 q 125 210 125 287 q 183 107 125 145 q 302 76 233 76 q 436 117 379 76 q 509 234 493 159 l 634 234 m 520 1040 l 331 819 l 248 819 l 383 1040 l 520 1040 "},"":{x_min:0,x_max:922,ha:1031,o:"m 922 339 q 856 97 922 203 q 650 -26 780 -26 q 538 9 587 -26 q 461 103 489 44 q 387 12 436 46 q 277 -22 339 -22 q 69 97 147 -22 q 0 339 0 203 q 45 551 0 444 q 161 738 84 643 l 302 738 q 175 553 219 647 q 124 336 124 446 q 155 179 124 249 q 275 88 197 88 q 375 163 341 88 q 400 294 400 219 l 400 572 l 524 572 l 524 294 q 561 135 524 192 q 643 88 591 88 q 762 182 719 88 q 797 342 797 257 q 745 556 797 450 q 619 738 705 638 l 760 738 q 874 551 835 640 q 922 339 922 444 "},"":{x_min:0,x_max:96,ha:251,o:"m 96 606 l 0 606 l 0 988 l 96 988 l 96 606 "},"":{x_min:11,x_max:781,ha:792,o:"m 781 490 l 446 490 l 446 255 l 349 255 l 349 490 l 11 490 l 11 586 l 349 586 l 349 819 l 446 819 l 446 586 l 781 586 l 781 490 m 781 21 l 11 21 l 11 115 l 781 115 l 781 21 "},"|":{x_min:343,x_max:449,ha:792,o:"m 449 462 l 343 462 l 343 986 l 449 986 l 449 462 m 449 -242 l 343 -242 l 343 280 l 449 280 l 449 -242 "},"":{x_min:0,x_max:617,ha:725,o:"m 482 800 l 372 800 l 372 925 l 482 925 l 482 800 m 239 800 l 129 800 l 129 925 l 239 925 l 239 800 m 617 352 q 540 93 617 199 q 308 -24 455 -24 q 76 93 161 -24 q 0 352 0 199 l 0 738 l 126 738 l 126 354 q 169 185 126 257 q 312 98 220 98 q 451 185 402 98 q 492 354 492 257 l 492 738 l 617 738 l 617 352 "},"":{x_min:0,x_max:593,ha:690,o:"m 593 425 q 554 312 593 369 q 467 233 516 254 q 537 83 537 172 q 459 -74 537 -12 q 288 -133 387 -133 q 115 -69 184 -133 q 47 96 47 -6 l 166 96 q 199 7 166 40 q 288 -26 232 -26 q 371 -5 332 -26 q 420 60 420 21 q 311 201 420 139 q 108 309 210 255 q 0 490 0 383 q 33 602 0 551 q 124 687 66 654 q 75 743 93 712 q 58 812 58 773 q 133 984 58 920 q 300 1043 201 1043 q 458 987 394 1043 q 529 814 529 925 l 411 814 q 370 908 404 877 q 289 939 336 939 q 213 911 246 939 q 180 841 180 883 q 286 720 180 779 q 484 612 480 615 q 593 425 593 534 m 467 409 q 355 544 467 473 q 196 630 228 612 q 146 587 162 609 q 124 525 124 558 q 239 387 124 462 q 398 298 369 315 q 448 345 429 316 q 467 409 467 375 "},b:{x_min:0,x_max:685,ha:783,o:"m 685 372 q 597 99 685 213 q 347 -25 501 -25 q 219 5 277 -25 q 121 93 161 36 l 121 0 l 0 0 l 0 1013 l 121 1013 l 121 634 q 214 723 157 692 q 341 754 272 754 q 591 637 493 754 q 685 372 685 526 m 554 356 q 499 550 554 470 q 328 644 437 644 q 162 556 223 644 q 108 369 108 478 q 160 176 108 256 q 330 83 221 83 q 498 169 435 83 q 554 356 554 245 "},q:{x_min:0,x_max:683,ha:876,o:"m 683 -278 l 564 -278 l 564 97 q 474 8 533 39 q 345 -23 415 -23 q 91 93 188 -23 q 0 364 0 203 q 87 635 0 522 q 337 760 184 760 q 466 727 408 760 q 564 637 523 695 l 564 737 l 683 737 l 683 -278 m 582 375 q 527 564 582 488 q 358 652 466 652 q 190 565 253 652 q 135 377 135 488 q 189 179 135 261 q 361 84 251 84 q 530 179 469 84 q 582 375 582 260 "},"":{x_min:-.171875,x_max:969.5625,ha:1068,o:"m 969 0 l 555 0 l 555 123 q 744 308 675 194 q 814 558 814 423 q 726 812 814 709 q 484 922 633 922 q 244 820 334 922 q 154 567 154 719 q 223 316 154 433 q 412 123 292 199 l 412 0 l 0 0 l 0 124 l 217 124 q 68 327 122 210 q 15 572 15 444 q 144 911 15 781 q 484 1041 274 1041 q 822 909 691 1041 q 953 569 953 777 q 899 326 953 443 q 750 124 846 210 l 969 124 l 969 0 "},"":{x_min:0,x_max:617,ha:725,o:"m 617 352 q 540 93 617 199 q 308 -24 455 -24 q 76 93 161 -24 q 0 352 0 199 l 0 738 l 126 738 l 126 354 q 169 185 126 257 q 312 98 220 98 q 451 185 402 98 q 492 354 492 257 l 492 738 l 617 738 l 617 352 m 535 1040 l 346 819 l 262 819 l 397 1040 l 535 1040 "},z:{x_min:-.015625,x_max:613.890625,ha:697,o:"m 613 0 l 0 0 l 0 100 l 433 630 l 20 630 l 20 738 l 594 738 l 593 636 l 163 110 l 613 110 l 613 0 "},"":{x_min:0,x_max:894,ha:1e3,o:"m 389 951 l 229 951 l 229 503 l 160 503 l 160 951 l 0 951 l 0 1011 l 389 1011 l 389 951 m 894 503 l 827 503 l 827 939 l 685 503 l 620 503 l 481 937 l 481 503 l 417 503 l 417 1011 l 517 1011 l 653 580 l 796 1010 l 894 1011 l 894 503 "},"":{x_min:.78125,x_max:697,ha:810,o:"m 697 -278 l 572 -278 l 572 454 q 540 587 572 536 q 425 650 501 650 q 271 579 337 650 q 206 420 206 509 l 206 0 l 81 0 l 81 489 q 73 588 81 562 q 0 644 56 644 l 0 741 q 68 755 38 755 q 158 721 124 755 q 200 630 193 687 q 297 726 234 692 q 434 761 359 761 q 620 692 544 761 q 697 516 697 624 l 697 -278 m 479 1040 l 290 819 l 207 819 l 341 1040 l 479 1040 "},"":{x_min:0,x_max:960,ha:1056,o:"m 960 507 q 833 129 960 280 q 476 -32 698 -32 q 123 129 255 -32 q 0 507 0 280 q 123 883 0 732 q 476 1045 255 1045 q 832 883 696 1045 q 960 507 960 732 m 817 500 q 733 789 817 669 q 476 924 639 924 q 223 792 317 924 q 142 507 142 675 q 222 222 142 339 q 476 89 315 89 q 730 218 636 89 q 817 500 817 334 m 716 449 l 243 449 l 243 571 l 716 571 l 716 449 "},"":{x_min:-3,x_max:1008,ha:1106,o:"m 503 532 q 614 562 566 532 q 672 658 672 598 q 614 747 672 716 q 503 772 569 772 l 338 772 l 338 532 l 503 532 m 502 -7 q 123 151 263 -7 q -3 501 -3 294 q 123 851 -3 706 q 502 1011 263 1011 q 881 851 739 1011 q 1008 501 1008 708 q 883 151 1008 292 q 502 -7 744 -7 m 502 60 q 830 197 709 60 q 940 501 940 322 q 831 805 940 681 q 502 944 709 944 q 174 805 296 944 q 65 501 65 680 q 173 197 65 320 q 502 60 294 60 m 788 146 l 678 146 q 653 316 655 183 q 527 449 652 449 l 338 449 l 338 146 l 241 146 l 241 854 l 518 854 q 688 808 621 854 q 766 658 766 755 q 739 563 766 607 q 668 497 713 519 q 751 331 747 472 q 788 164 756 190 l 788 146 "},"~":{x_min:0,x_max:833,ha:931,o:"m 833 958 q 778 753 833 831 q 594 665 716 665 q 402 761 502 665 q 240 857 302 857 q 131 795 166 857 q 104 665 104 745 l 0 665 q 54 867 0 789 q 237 958 116 958 q 429 861 331 958 q 594 765 527 765 q 704 827 670 765 q 729 958 729 874 l 833 958 "},"":{x_min:0,x_max:736.21875,ha:778,o:"m 736 0 l 0 0 l 0 1013 l 725 1013 l 725 889 l 139 889 l 139 585 l 677 585 l 677 467 l 139 467 l 139 125 l 736 125 l 736 0 "},"":{x_min:0,x_max:450,ha:547,o:"m 450 552 q 379 413 450 464 q 220 366 313 366 q 69 414 130 366 q 0 567 0 470 l 85 567 q 126 470 85 504 q 225 437 168 437 q 320 467 280 437 q 360 552 360 498 q 318 632 360 608 q 213 657 276 657 q 195 657 203 657 q 176 657 181 657 l 176 722 q 279 733 249 722 q 334 815 334 752 q 300 881 334 856 q 220 907 267 907 q 133 875 169 907 q 97 781 97 844 l 15 781 q 78 926 15 875 q 220 972 135 972 q 364 930 303 972 q 426 817 426 888 q 344 697 426 733 q 421 642 392 681 q 450 552 450 603 "},"[":{x_min:0,x_max:273.609375,ha:371,o:"m 273 -281 l 0 -281 l 0 1013 l 273 1013 l 273 920 l 124 920 l 124 -187 l 273 -187 l 273 -281 "},L:{x_min:0,x_max:645.828125,ha:696,o:"m 645 0 l 0 0 l 0 1013 l 140 1013 l 140 126 l 645 126 l 645 0 "},"":{x_min:0,x_max:803.390625,ha:894,o:"m 803 628 l 633 628 q 713 368 713 512 q 618 93 713 204 q 357 -25 518 -25 q 94 91 194 -25 q 0 368 0 201 q 94 644 0 533 q 356 761 194 761 q 481 750 398 761 q 608 739 564 739 l 803 739 l 803 628 m 360 85 q 529 180 467 85 q 584 374 584 262 q 527 566 584 490 q 352 651 463 651 q 187 559 247 651 q 135 368 135 478 q 189 175 135 254 q 360 85 251 85 "},"":{x_min:0,x_max:573,ha:642,o:"m 573 -40 q 553 -162 573 -97 q 510 -278 543 -193 l 400 -278 q 441 -187 428 -219 q 462 -90 462 -132 q 378 -14 462 -14 q 108 45 197 -14 q 0 290 0 117 q 108 631 0 462 q 353 901 194 767 l 55 901 l 55 1012 l 561 1012 l 561 924 q 261 669 382 831 q 128 301 128 489 q 243 117 128 149 q 458 98 350 108 q 573 -40 573 80 "},"":{x_min:0,x_max:674,ha:778,o:"m 674 496 q 601 160 674 304 q 336 -26 508 -26 q 73 153 165 -26 q 0 485 0 296 q 72 840 0 683 q 343 1045 166 1045 q 605 844 516 1045 q 674 496 674 692 m 546 579 q 498 798 546 691 q 336 935 437 935 q 178 798 237 935 q 126 579 137 701 l 546 579 m 546 475 l 126 475 q 170 233 126 348 q 338 80 230 80 q 504 233 447 80 q 546 475 546 346 "},"":{x_min:0,x_max:958,ha:1054,o:"m 485 1042 q 834 883 703 1042 q 958 511 958 735 q 834 136 958 287 q 481 -26 701 -26 q 126 130 261 -26 q 0 504 0 279 q 127 880 0 729 q 485 1042 263 1042 m 480 98 q 731 225 638 98 q 815 504 815 340 q 733 783 815 670 q 480 913 640 913 q 226 785 321 913 q 142 504 142 671 q 226 224 142 339 q 480 98 319 98 "},"":{x_min:0,x_max:705.28125,ha:749,o:"m 705 886 l 140 886 l 140 0 l 0 0 l 0 1012 l 705 1012 l 705 886 "}," ":{x_min:0,x_max:0,ha:375},"%":{x_min:-3,x_max:1089,ha:1186,o:"m 845 0 q 663 76 731 0 q 602 244 602 145 q 661 412 602 344 q 845 489 728 489 q 1027 412 959 489 q 1089 244 1089 343 q 1029 76 1089 144 q 845 0 962 0 m 844 103 q 945 143 909 103 q 981 243 981 184 q 947 340 981 301 q 844 385 909 385 q 744 342 781 385 q 708 243 708 300 q 741 147 708 186 q 844 103 780 103 m 888 986 l 284 -25 l 199 -25 l 803 986 l 888 986 m 241 468 q 58 545 126 468 q -3 715 -3 615 q 56 881 -3 813 q 238 958 124 958 q 421 881 353 958 q 483 712 483 813 q 423 544 483 612 q 241 468 356 468 m 241 855 q 137 811 175 855 q 100 710 100 768 q 136 612 100 653 q 240 572 172 572 q 344 614 306 572 q 382 713 382 656 q 347 810 382 771 q 241 855 308 855 "},P:{x_min:0,x_max:726,ha:806,o:"m 424 1013 q 640 931 555 1013 q 726 719 726 850 q 637 506 726 587 q 413 426 548 426 l 140 426 l 140 0 l 0 0 l 0 1013 l 424 1013 m 379 889 l 140 889 l 140 548 l 372 548 q 522 589 459 548 q 593 720 593 637 q 528 845 593 801 q 379 889 463 889 "},"":{x_min:0,x_max:1078.21875,ha:1118,o:"m 1078 0 l 342 0 l 342 1013 l 1067 1013 l 1067 889 l 481 889 l 481 585 l 1019 585 l 1019 467 l 481 467 l 481 125 l 1078 125 l 1078 0 m 277 1040 l 83 799 l 0 799 l 140 1040 l 277 1040 "},"":{x_min:.125,x_max:1136.546875,ha:1235,o:"m 1136 0 l 722 0 l 722 123 q 911 309 842 194 q 981 558 981 423 q 893 813 981 710 q 651 923 800 923 q 411 821 501 923 q 321 568 321 720 q 390 316 321 433 q 579 123 459 200 l 579 0 l 166 0 l 166 124 l 384 124 q 235 327 289 210 q 182 572 182 444 q 311 912 182 782 q 651 1042 441 1042 q 989 910 858 1042 q 1120 569 1120 778 q 1066 326 1120 443 q 917 124 1013 210 l 1136 124 l 1136 0 m 277 1040 l 83 800 l 0 800 l 140 1041 l 277 1040 "},_:{x_min:0,x_max:705.5625,ha:803,o:"m 705 -334 l 0 -334 l 0 -234 l 705 -234 l 705 -334 "},"":{x_min:-110,x_max:246,ha:275,o:"m 246 1046 l 118 1046 l 118 1189 l 246 1189 l 246 1046 m 18 1046 l -110 1046 l -110 1189 l 18 1189 l 18 1046 m 136 0 l 0 0 l 0 1012 l 136 1012 l 136 0 "},"+":{x_min:23,x_max:768,ha:792,o:"m 768 372 l 444 372 l 444 0 l 347 0 l 347 372 l 23 372 l 23 468 l 347 468 l 347 840 l 444 840 l 444 468 l 768 468 l 768 372 "},"":{x_min:0,x_max:1050,ha:1149,o:"m 1050 0 l 625 0 q 712 178 625 108 q 878 277 722 187 q 967 385 967 328 q 932 456 967 429 q 850 484 897 484 q 759 450 798 484 q 721 352 721 416 l 640 352 q 706 502 640 448 q 851 551 766 551 q 987 509 931 551 q 1050 385 1050 462 q 976 251 1050 301 q 829 179 902 215 q 717 68 740 133 l 1050 68 l 1050 0 m 834 985 l 215 -28 l 130 -28 l 750 984 l 834 985 m 224 422 l 142 422 l 142 811 l 0 811 l 0 867 q 104 889 62 867 q 164 973 157 916 l 224 973 l 224 422 "},"":{x_min:0,x_max:720,ha:783,o:"m 424 1013 q 637 933 554 1013 q 720 723 720 853 q 633 508 720 591 q 413 426 546 426 l 140 426 l 140 0 l 0 0 l 0 1013 l 424 1013 m 378 889 l 140 889 l 140 548 l 371 548 q 521 589 458 548 q 592 720 592 637 q 527 845 592 801 q 378 889 463 889 "},"'":{x_min:0,x_max:139,ha:236,o:"m 139 851 q 102 737 139 784 q 0 669 65 690 l 0 734 q 59 787 42 741 q 72 873 72 821 l 0 873 l 0 1013 l 139 1013 l 139 851 "},"":{x_min:0,x_max:350,ha:397,o:"m 350 625 q 307 616 328 616 q 266 631 281 616 q 247 673 251 645 q 190 628 225 644 q 116 613 156 613 q 32 641 64 613 q 0 722 0 669 q 72 826 0 800 q 247 866 159 846 l 247 887 q 220 934 247 916 q 162 953 194 953 q 104 934 129 953 q 76 882 80 915 l 16 882 q 60 976 16 941 q 166 1011 104 1011 q 266 979 224 1011 q 308 891 308 948 l 308 706 q 311 679 308 688 q 331 670 315 670 l 350 672 l 350 625 m 247 757 l 247 811 q 136 790 175 798 q 64 726 64 773 q 83 682 64 697 q 132 667 103 667 q 207 690 174 667 q 247 757 247 718 "},"":{x_min:0,x_max:450,ha:553,o:"m 450 800 l 340 800 l 340 925 l 450 925 l 450 800 m 406 1040 l 212 800 l 129 800 l 269 1040 l 406 1040 m 110 800 l 0 800 l 0 925 l 110 925 l 110 800 "},T:{x_min:0,x_max:777,ha:835,o:"m 777 894 l 458 894 l 458 0 l 319 0 l 319 894 l 0 894 l 0 1013 l 777 1013 l 777 894 "},"":{x_min:0,x_max:915,ha:997,o:"m 527 0 l 389 0 l 389 122 q 110 231 220 122 q 0 509 0 340 q 110 785 0 677 q 389 893 220 893 l 389 1013 l 527 1013 l 527 893 q 804 786 693 893 q 915 509 915 679 q 805 231 915 341 q 527 122 696 122 l 527 0 m 527 226 q 712 310 641 226 q 779 507 779 389 q 712 705 779 627 q 527 787 641 787 l 527 226 m 389 226 l 389 787 q 205 698 275 775 q 136 505 136 620 q 206 308 136 391 q 389 226 276 226 "},"":{x_min:0,x_max:0,ha:694},j:{x_min:-77.78125,x_max:167,ha:349,o:"m 167 871 l 42 871 l 42 1013 l 167 1013 l 167 871 m 167 -80 q 121 -231 167 -184 q -26 -278 76 -278 l -77 -278 l -77 -164 l -41 -164 q 26 -143 11 -164 q 42 -65 42 -122 l 42 737 l 167 737 l 167 -80 "},"":{x_min:0,x_max:756.953125,ha:819,o:"m 756 0 l 0 0 l 0 107 l 395 523 l 22 904 l 22 1013 l 745 1013 l 745 889 l 209 889 l 566 523 l 187 125 l 756 125 l 756 0 "},1:{x_min:215.671875,x_max:574,ha:792,o:"m 574 0 l 442 0 l 442 697 l 215 697 l 215 796 q 386 833 330 796 q 475 986 447 875 l 574 986 l 574 0 "},"":{x_min:18.0625,x_max:774,ha:792,o:"m 774 376 l 18 40 l 18 149 l 631 421 l 18 692 l 18 799 l 774 465 l 774 376 "},"<":{x_min:17.984375,x_max:773.609375,ha:792,o:"m 773 40 l 18 376 l 17 465 l 773 799 l 773 692 l 159 420 l 773 149 l 773 40 "},"":{x_min:0,x_max:704.484375,ha:801,o:"m 704 41 q 623 -10 664 5 q 543 -26 583 -26 q 359 15 501 -26 q 243 36 288 36 q 158 23 197 36 q 73 -21 119 10 l 6 76 q 125 195 90 150 q 175 331 175 262 q 147 443 175 383 l 0 443 l 0 512 l 108 512 q 43 734 43 623 q 120 929 43 854 q 358 1010 204 1010 q 579 936 487 1010 q 678 729 678 857 l 678 684 l 552 684 q 504 838 552 780 q 362 896 457 896 q 216 852 263 896 q 176 747 176 815 q 199 627 176 697 q 248 512 217 574 l 468 512 l 468 443 l 279 443 q 297 356 297 398 q 230 194 297 279 q 153 107 211 170 q 227 133 190 125 q 293 142 264 142 q 410 119 339 142 q 516 96 482 96 q 579 105 550 96 q 648 142 608 115 l 704 41 "},t:{x_min:0,x_max:367,ha:458,o:"m 367 0 q 312 -5 339 -2 q 262 -8 284 -8 q 145 28 183 -8 q 108 143 108 64 l 108 638 l 0 638 l 0 738 l 108 738 l 108 944 l 232 944 l 232 738 l 367 738 l 367 638 l 232 638 l 232 185 q 248 121 232 140 q 307 102 264 102 q 345 104 330 102 q 367 107 360 107 l 367 0 "},"":{x_min:0,x_max:706,ha:803,o:"m 706 411 l 706 158 l 630 158 l 630 335 l 0 335 l 0 411 l 706 411 "},"":{x_min:0,x_max:750,ha:803,o:"m 750 -7 q 679 -15 716 -15 q 538 59 591 -15 q 466 214 512 97 l 336 551 l 126 0 l 0 0 l 270 705 q 223 837 247 770 q 116 899 190 899 q 90 898 100 899 l 90 1004 q 152 1011 125 1011 q 298 938 244 1011 q 373 783 326 901 l 605 192 q 649 115 629 136 q 716 95 669 95 l 736 95 q 750 97 745 97 l 750 -7 "},W:{x_min:0,x_max:1263.890625,ha:1351,o:"m 1263 1013 l 995 0 l 859 0 l 627 837 l 405 0 l 265 0 l 0 1013 l 136 1013 l 342 202 l 556 1013 l 701 1013 l 921 207 l 1133 1012 l 1263 1013 "},">":{x_min:18.0625,x_max:774,ha:792,o:"m 774 376 l 18 40 l 18 149 l 631 421 l 18 692 l 18 799 l 774 465 l 774 376 "},v:{x_min:0,x_max:675.15625,ha:761,o:"m 675 738 l 404 0 l 272 0 l 0 738 l 133 737 l 340 147 l 541 737 l 675 738 "},"":{x_min:.28125,x_max:644.5,ha:703,o:"m 644 628 l 382 628 l 382 179 q 388 120 382 137 q 436 91 401 91 q 474 94 447 91 q 504 97 501 97 l 504 0 q 454 -9 482 -5 q 401 -14 426 -14 q 278 67 308 -14 q 260 233 260 118 l 260 628 l 0 628 l 0 739 l 644 739 l 644 628 "},"":{x_min:0,x_max:624.9375,ha:699,o:"m 624 -37 q 608 -153 624 -96 q 563 -278 593 -211 l 454 -278 q 491 -183 486 -200 q 511 -83 511 -126 q 484 -23 511 -44 q 370 1 452 1 q 323 0 354 1 q 283 -1 293 -1 q 84 76 169 -1 q 0 266 0 154 q 56 431 0 358 q 197 538 108 498 q 94 613 134 562 q 54 730 54 665 q 77 823 54 780 q 143 901 101 867 l 27 901 l 27 1012 l 576 1012 l 576 901 l 380 901 q 244 863 303 901 q 178 745 178 820 q 312 600 178 636 q 532 582 380 582 l 532 479 q 276 455 361 479 q 118 281 118 410 q 165 173 118 217 q 274 120 208 133 q 494 101 384 110 q 624 -37 624 76 "},"&":{x_min:-3,x_max:894.25,ha:992,o:"m 894 0 l 725 0 l 624 123 q 471 0 553 40 q 306 -41 390 -41 q 168 -7 231 -41 q 62 92 105 26 q 14 187 31 139 q -3 276 -3 235 q 55 433 -3 358 q 248 581 114 508 q 170 689 196 640 q 137 817 137 751 q 214 985 137 922 q 384 1041 284 1041 q 548 988 483 1041 q 622 824 622 928 q 563 666 622 739 q 431 556 516 608 l 621 326 q 649 407 639 361 q 663 493 653 426 l 781 493 q 703 229 781 352 l 894 0 m 504 818 q 468 908 504 877 q 384 940 433 940 q 293 907 331 940 q 255 818 255 875 q 289 714 255 767 q 363 628 313 678 q 477 729 446 682 q 504 818 504 771 m 556 209 l 314 499 q 179 395 223 449 q 135 283 135 341 q 146 222 135 253 q 183 158 158 192 q 333 80 241 80 q 556 209 448 80 "},"":{x_min:0,x_max:862.5,ha:942,o:"m 862 0 l 719 0 l 426 847 l 143 0 l 0 0 l 356 1013 l 501 1013 l 862 0 "},I:{x_min:41,x_max:180,ha:293,o:"m 180 0 l 41 0 l 41 1013 l 180 1013 l 180 0 "},G:{x_min:0,x_max:921,ha:1011,o:"m 921 0 l 832 0 l 801 136 q 655 15 741 58 q 470 -28 568 -28 q 126 133 259 -28 q 0 499 0 284 q 125 881 0 731 q 486 1043 259 1043 q 763 957 647 1043 q 905 709 890 864 l 772 709 q 668 866 747 807 q 486 926 589 926 q 228 795 322 926 q 142 507 142 677 q 228 224 142 342 q 483 94 323 94 q 712 195 625 94 q 796 435 796 291 l 477 435 l 477 549 l 921 549 l 921 0 "},"":{x_min:0,x_max:617,ha:725,o:"m 524 800 l 414 800 l 414 925 l 524 925 l 524 800 m 183 800 l 73 800 l 73 925 l 183 925 l 183 800 m 617 352 q 540 93 617 199 q 308 -24 455 -24 q 76 93 161 -24 q 0 352 0 199 l 0 738 l 126 738 l 126 354 q 169 185 126 257 q 312 98 220 98 q 451 185 402 98 q 492 354 492 257 l 492 738 l 617 738 l 617 352 m 489 1040 l 300 819 l 216 819 l 351 1040 l 489 1040 "},"`":{x_min:0,x_max:138.890625,ha:236,o:"m 138 699 l 0 699 l 0 861 q 36 974 0 929 q 138 1041 72 1020 l 138 977 q 82 931 95 969 q 69 839 69 893 l 138 839 l 138 699 "},"":{x_min:0,x_max:142,ha:239,o:"m 142 585 l 0 585 l 0 738 l 142 738 l 142 585 "},"":{x_min:.328125,x_max:819.515625,ha:889,o:"m 819 1013 l 482 416 l 482 0 l 342 0 l 342 416 l 0 1013 l 140 1013 l 411 533 l 679 1013 l 819 1013 "},r:{x_min:0,x_max:355.5625,ha:432,o:"m 355 621 l 343 621 q 179 569 236 621 q 122 411 122 518 l 122 0 l 0 0 l 0 737 l 117 737 l 117 604 q 204 719 146 686 q 355 753 262 753 l 355 621 "},x:{x_min:0,x_max:675,ha:764,o:"m 675 0 l 525 0 l 331 286 l 144 0 l 0 0 l 256 379 l 12 738 l 157 737 l 336 473 l 516 738 l 661 738 l 412 380 l 675 0 "},"":{x_min:0,x_max:696.609375,ha:747,o:"m 696 -4 q 628 -14 657 -14 q 498 97 513 -14 q 422 8 470 41 q 313 -24 374 -24 q 207 3 258 -24 q 120 80 157 31 l 120 -278 l 0 -278 l 0 738 l 124 738 l 124 343 q 165 172 124 246 q 308 82 216 82 q 451 177 402 82 q 492 358 492 254 l 492 738 l 616 738 l 616 214 q 623 136 616 160 q 673 92 636 92 q 696 95 684 92 l 696 -4 "},h:{x_min:0,x_max:615,ha:724,o:"m 615 472 l 615 0 l 490 0 l 490 454 q 456 590 490 535 q 338 654 416 654 q 186 588 251 654 q 122 436 122 522 l 122 0 l 0 0 l 0 1013 l 122 1013 l 122 633 q 218 727 149 694 q 362 760 287 760 q 552 676 484 760 q 615 472 615 600 "},".":{x_min:0,x_max:142,ha:239,o:"m 142 0 l 0 0 l 0 151 l 142 151 l 142 0 "},"":{x_min:-2,x_max:878,ha:974,o:"m 496 -279 l 378 -279 l 378 -17 q 101 88 204 -17 q -2 367 -2 194 q 68 626 -2 510 q 283 758 151 758 l 283 646 q 167 537 209 626 q 133 373 133 462 q 192 177 133 254 q 378 93 259 93 l 378 758 q 445 764 426 763 q 476 765 464 765 q 765 659 653 765 q 878 377 878 553 q 771 96 878 209 q 496 -17 665 -17 l 496 -279 m 496 93 l 514 93 q 687 183 623 93 q 746 380 746 265 q 691 569 746 491 q 522 658 629 658 l 496 656 l 496 93 "},";":{x_min:0,x_max:142,ha:239,o:"m 142 585 l 0 585 l 0 738 l 142 738 l 142 585 m 142 -12 q 105 -132 142 -82 q 0 -206 68 -182 l 0 -138 q 58 -82 43 -123 q 68 0 68 -56 l 0 0 l 0 151 l 142 151 l 142 -12 "},f:{x_min:0,x_max:378,ha:472,o:"m 378 638 l 246 638 l 246 0 l 121 0 l 121 638 l 0 638 l 0 738 l 121 738 q 137 935 121 887 q 290 1028 171 1028 q 320 1027 305 1028 q 378 1021 334 1026 l 378 908 q 323 918 346 918 q 257 870 273 918 q 246 780 246 840 l 246 738 l 378 738 l 378 638 "},"":{x_min:1,x_max:348.21875,ha:454,o:"m 140 670 l 1 670 l 1 830 q 37 943 1 897 q 140 1011 74 990 l 140 947 q 82 900 97 940 q 68 810 68 861 l 140 810 l 140 670 m 348 670 l 209 670 l 209 830 q 245 943 209 897 q 348 1011 282 990 l 348 947 q 290 900 305 940 q 276 810 276 861 l 348 810 l 348 670 "},A:{x_min:.03125,x_max:906.953125,ha:1008,o:"m 906 0 l 756 0 l 648 303 l 251 303 l 142 0 l 0 0 l 376 1013 l 529 1013 l 906 0 m 610 421 l 452 867 l 293 421 l 610 421 "},6:{x_min:53,x_max:739,ha:792,o:"m 739 312 q 633 62 739 162 q 400 -31 534 -31 q 162 78 257 -31 q 53 439 53 206 q 178 859 53 712 q 441 986 284 986 q 643 912 559 986 q 732 713 732 833 l 601 713 q 544 830 594 786 q 426 875 494 875 q 268 793 331 875 q 193 517 193 697 q 301 597 240 570 q 427 624 362 624 q 643 540 552 624 q 739 312 739 451 m 603 298 q 540 461 603 400 q 404 516 484 516 q 268 461 323 516 q 207 300 207 401 q 269 137 207 198 q 405 83 325 83 q 541 137 486 83 q 603 298 603 197 "},"":{x_min:1,x_max:139.890625,ha:236,o:"m 139 670 l 1 670 l 1 830 q 37 943 1 897 q 139 1011 74 990 l 139 947 q 82 900 97 940 q 68 810 68 861 l 139 810 l 139 670 "},"":{x_min:-70,x_max:283,ha:361,o:"m 283 800 l 173 800 l 173 925 l 283 925 l 283 800 m 40 800 l -70 800 l -70 925 l 40 925 l 40 800 m 283 3 q 232 -10 257 -5 q 181 -15 206 -15 q 84 26 118 -15 q 41 200 41 79 l 41 737 l 166 737 l 167 215 q 171 141 167 157 q 225 101 182 101 q 247 103 238 101 q 283 112 256 104 l 283 3 "},"":{x_min:-.21875,x_max:773.21875,ha:857,o:"m 773 -7 l 707 -11 q 575 40 607 -11 q 552 174 552 77 l 552 226 l 552 626 l 222 626 l 222 0 l 97 0 l 97 626 l 0 626 l 0 737 l 773 737 l 773 626 l 676 626 l 676 171 q 695 103 676 117 q 773 90 714 90 l 773 -7 "},"":{x_min:0,x_max:765.5625,ha:809,o:"m 765 -4 q 698 -14 726 -14 q 564 97 586 -14 q 466 7 525 40 q 337 -26 407 -26 q 88 98 186 -26 q 0 369 0 212 q 88 637 0 525 q 337 760 184 760 q 465 727 407 760 q 563 637 524 695 l 563 738 l 685 738 l 685 222 q 693 141 685 168 q 748 94 708 94 q 765 95 760 94 l 765 -4 m 584 371 q 531 562 584 485 q 360 653 470 653 q 192 566 254 653 q 135 379 135 489 q 186 181 135 261 q 358 84 247 84 q 528 176 465 84 q 584 371 584 260 m 604 1040 l 415 819 l 332 819 l 466 1040 l 604 1040 "},O:{x_min:0,x_max:958,ha:1057,o:"m 485 1041 q 834 882 702 1041 q 958 512 958 734 q 834 136 958 287 q 481 -26 702 -26 q 126 130 261 -26 q 0 504 0 279 q 127 880 0 728 q 485 1041 263 1041 m 480 98 q 731 225 638 98 q 815 504 815 340 q 733 783 815 669 q 480 912 640 912 q 226 784 321 912 q 142 504 142 670 q 226 224 142 339 q 480 98 319 98 "},n:{x_min:0,x_max:615,ha:724,o:"m 615 463 l 615 0 l 490 0 l 490 454 q 453 592 490 537 q 331 656 410 656 q 178 585 240 656 q 117 421 117 514 l 117 0 l 0 0 l 0 738 l 117 738 l 117 630 q 218 728 150 693 q 359 764 286 764 q 552 675 484 764 q 615 463 615 593 "},3:{x_min:54,x_max:737,ha:792,o:"m 737 284 q 635 55 737 141 q 399 -25 541 -25 q 156 52 248 -25 q 54 308 54 140 l 185 308 q 245 147 185 202 q 395 96 302 96 q 539 140 484 96 q 602 280 602 190 q 510 429 602 390 q 324 454 451 454 l 324 565 q 487 584 441 565 q 565 719 565 617 q 515 835 565 791 q 395 879 466 879 q 255 824 307 879 q 203 661 203 769 l 78 661 q 166 909 78 822 q 387 992 250 992 q 603 921 513 992 q 701 723 701 844 q 669 607 701 656 q 578 524 637 558 q 696 434 655 499 q 737 284 737 369 "},9:{x_min:53,x_max:739,ha:792,o:"m 739 524 q 619 94 739 241 q 362 -32 516 -32 q 150 47 242 -32 q 59 244 59 126 l 191 244 q 246 129 191 176 q 373 82 301 82 q 526 161 466 82 q 597 440 597 255 q 363 334 501 334 q 130 432 216 334 q 53 650 53 521 q 134 880 53 786 q 383 986 226 986 q 659 841 566 986 q 739 524 739 719 m 388 449 q 535 514 480 449 q 585 658 585 573 q 535 805 585 744 q 388 873 480 873 q 242 809 294 873 q 191 658 191 745 q 239 514 191 572 q 388 449 292 449 "},l:{x_min:41,x_max:166,ha:279,o:"m 166 0 l 41 0 l 41 1013 l 166 1013 l 166 0 "},"":{x_min:40.09375,x_max:728.796875,ha:825,o:"m 728 304 l 649 224 l 512 363 q 383 331 458 331 q 256 363 310 331 l 119 224 l 40 304 l 177 441 q 150 553 150 493 q 184 673 150 621 l 40 818 l 119 898 l 267 749 q 321 766 291 759 q 384 773 351 773 q 447 766 417 773 q 501 749 477 759 l 649 898 l 728 818 l 585 675 q 612 618 604 648 q 621 553 621 587 q 591 441 621 491 l 728 304 m 384 682 q 280 643 318 682 q 243 551 243 604 q 279 461 243 499 q 383 423 316 423 q 487 461 449 423 q 525 553 525 500 q 490 641 525 605 q 384 682 451 682 "},"":{x_min:0,x_max:632.328125,ha:679,o:"m 632 0 l 482 0 l 225 384 l 124 288 l 124 0 l 0 0 l 0 738 l 124 738 l 124 446 l 433 738 l 596 738 l 312 466 l 632 0 "},4:{x_min:48,x_max:742.453125,ha:792,o:"m 742 243 l 602 243 l 602 0 l 476 0 l 476 243 l 48 243 l 48 368 l 476 958 l 602 958 l 602 354 l 742 354 l 742 243 m 476 354 l 476 792 l 162 354 l 476 354 "},p:{x_min:0,x_max:685,ha:786,o:"m 685 364 q 598 96 685 205 q 350 -23 504 -23 q 121 89 205 -23 l 121 -278 l 0 -278 l 0 738 l 121 738 l 121 633 q 220 726 159 691 q 351 761 280 761 q 598 636 504 761 q 685 364 685 522 m 557 371 q 501 560 557 481 q 330 651 437 651 q 162 559 223 651 q 108 366 108 479 q 162 177 108 254 q 333 87 224 87 q 502 178 441 87 q 557 371 557 258 "},"":{x_min:0,x_max:777,ha:835,o:"m 458 238 l 458 0 l 319 0 l 319 238 l 0 238 l 0 360 l 319 360 l 319 681 l 0 683 l 0 804 l 319 804 l 319 1015 l 458 1013 l 458 804 l 777 804 l 777 683 l 458 683 l 458 360 l 777 360 l 777 238 l 458 238 "},"":{x_min:0,x_max:808,ha:907,o:"m 465 -278 l 341 -278 l 341 -15 q 87 102 180 -15 q 0 378 0 210 l 0 739 l 133 739 l 133 379 q 182 195 133 275 q 341 98 242 98 l 341 922 l 465 922 l 465 98 q 623 195 563 98 q 675 382 675 278 l 675 742 l 808 742 l 808 381 q 720 104 808 213 q 466 -13 627 -13 l 465 -278 "},"":{x_min:.78125,x_max:697,ha:810,o:"m 697 -278 l 572 -278 l 572 454 q 540 587 572 536 q 425 650 501 650 q 271 579 337 650 q 206 420 206 509 l 206 0 l 81 0 l 81 489 q 73 588 81 562 q 0 644 56 644 l 0 741 q 68 755 38 755 q 158 720 124 755 q 200 630 193 686 q 297 726 234 692 q 434 761 359 761 q 620 692 544 761 q 697 516 697 624 l 697 -278 "}},cssFontWeight:"normal",ascender:1189,underlinePosition:-100,cssFontStyle:"normal",boundingBox:{yMin:-334,xMin:-111,yMax:1189,xMax:1672},resolution:1e3,original_font_information:{postscript_name:"Helvetiker-Regular",version_string:"Version 1.00 2004 initial release",vendor_url:"http://www.magenta.gr/",full_font_name:"Helvetiker",font_family_name:"Helvetiker",copyright:"Copyright (c) agenta ltd, 2004",description:"",trademark:"",designer:"",designer_url:"",unique_font_identifier:"agenta ltd:Helvetiker:22-10-104",license_url:"http://www.ellak.gr/fonts/MgOpen/license.html",license_description:'Copyright (c) 2004 by MAGENTA Ltd. All Rights Reserved.\r\n\r\nPermission is hereby granted, free of charge, to any person obtaining a copy of the fonts accompanying this license ("Fonts") and associated documentation files (the "Font Software"), to reproduce and distribute the Font Software, including without limitation the rights to use, copy, merge, publish, distribute, and/or sell copies of the Font Software, and to permit persons to whom the Font Software is furnished to do so, subject to the following conditions: \r\n\r\nThe above copyright and this permission notice shall be included in all copies of one or more of the Font Software typefaces.\r\n\r\nThe Font Software may be modified, altered, or added to, and in particular the designs of glyphs or characters in the Fonts may be modified and additional glyphs or characters may be added to the Fonts, only if the fonts are renamed to names not containing the word "MgOpen", or if the modifications are accepted for inclusion in the Font Software itself by the each appointed Administrator.\r\n\r\nThis License becomes null and void to the extent applicable to Fonts or Font Software that has been modified and is distributed under the "MgOpen" name.\r\n\r\nThe Font Software may be sold as part of a larger software package but no copy of one or more of the Font Software typefaces may be sold by itself. \r\n\r\nTHE FONT SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO ANY WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT OF COPYRIGHT, PATENT, TRADEMARK, OR OTHER RIGHT. IN NO EVENT SHALL MAGENTA OR PERSONS OR BODIES IN CHARGE OF ADMINISTRATION AND MAINTENANCE OF THE FONT SOFTWARE BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, INCLUDING ANY GENERAL, SPECIAL, INDIRECT, INCIDENTAL, OR CONSEQUENTIAL DAMAGES, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF THE USE OR INABILITY TO USE THE FONT SOFTWARE OR FROM OTHER DEALINGS IN THE FONT SOFTWARE.',manufacturer_name:"agenta ltd",font_sub_family_name:"Regular"},descender:-334,familyName:"Helvetiker",lineHeight:1522,underlineThickness:50})},t}(Kn),da={id:"id",name:"name",userID:"userid",position:"position",rotation:"rotation",scale:"scale",properties:"properties",plans:"plans",walls:"walls",placements:"placements",videoprobes:"videoprobes",groups:"groups",corners:"corners",holesCorners:"holescorners",doorOrWindows:"doororwindows",curveLines:"curvelines",pipeLines:"pipelines",text3Ds:"text3ds",rooms:"rooms",height:"height",thick:"thick",texture:"texture",type:"type",model:"model",suspendPercent:"suspendpercent",leftTexture:"lefttexture",rightTexture:"righttexture",edgeTexture:"edgetexture",floorTexture:"floortexture",ceilingTexture:"ceilingtexture",roofTexture:"rooftexture",isOpen:"isopen",wallType:"type"},fa=function(){function e(){qn(this,e),this.sceneJson=null,this.scale=1,this.curFloorPlan=null,this.enableCombine=!0,this.defaultWallEdgeTextureUri="Textures/WallEdge.jpg",this.defaultWallTextureUri="Textures/RoomWall.jpg",this.defaultFloorTextureUri="Textures/FloorDefault.jpg",this.defaultCeilingTextureUri="Textures/CeilingDefault.jpg",this.defaultRoofTextureUri="Textures/RoofDefault.jpg",this.world=null,this.resourceManager=new Mo,this.combineManager=new sa(this.resourceManager),this.combineParser=new $o(this),Jn.enableBuildMesh=!1}return e.prototype.disposeModels=function(){this.resourceManager.disposeModels()},e.prototype.disposeTextures=function(){this.resourceManager.disposeTextures()},e.prototype._nestingLoopYield=function(e,t,r){var i=this,n=e.next();if(n.done)return t&&t(),n.value;var o=n.value;n.done;o instanceof Promise?o.then(function(n){return i._nestingLoopYield(e,t,r)}).catch(function(e){r(e)}):this._nestingLoopYield(e,t,r)},e.prototype.delayLoad=function(e){var t=this;return e?(e.url&&(this.sceneURL=e.url,this.resourceManager.localCustomModelBaseUrl=this.getParentRelativeUrl(this.sceneURL)),e.json&&(this.sceneJson=e.json),e.customModeBaseUrl&&(this.resourceManager.localCustomModelBaseUrl=e.customModeBaseUrl),new Promise(function(e,r){t.resourceManager.initLightMaps(function(){t.loadSceneJson().then(function(){t.parseSceneJson().then(function(){return t.world.build(),new Promise(function(e,r){Jn.enableCombine&&(t.combineParser.parseWorld(t.world),t.combineParser.buildWorld(t.world)),e(t.world)})})}).then(function(){e(t.world)}).catch(function(e){console.error(e)})})})):(console.error("load param can not be null"),null)},e.prototype.loadFont=function(e){return new Promise(function(t,r){(new THREE.FontLoader).load("./models/Font/Microsoft YaHei_Regular.json",function(t){pa.font=t,e()})})},e.prototype.loadResources=function(){var e=this;return new Promise(function(t,r){e.resourceManager.downloadResourcesWithQueue(function(){t(e.world)})})},e.prototype.getParentRelativeUrl=function(e){for(var t=e.split("/"),r="",i=0;i<t.length-1;i++){r+=t[i]+"/"}return r},e.prototype.load=function(e){var t=this;this.delayLoad(e).then(function(e,r){return t.loadResources()})},e.prototype.loadSceneJson=function(){var e=this;return new Promise(function(t,r){if(e.sceneJson)t(e.sceneJson);else if(e.sceneURL){(new THREE.FileLoader).load(e.sceneURL,function(r){e.sceneJson=JSON.parse(r),t()},function(){},function(t){r("can not load "+e.sceneURL)})}else r("load scene json error")})},e.prototype.createTextureLoaderPromise=function(e){return new Promise(function(t,r){(new THREE.TextureLoader).load(e,function(e){e.wrapS=THREE.RepeatWrapping,e.wrapT=THREE.RepeatWrapping,t(e)},function(t){console.log(e+" "+t.loaded/t.total*100+"% loaded")},function(r){t(null),console.log(e+"load error")})})},e.prototype.parseSceneJson=function(){var e=this;return new Promise(function(t,r){e.resourceManager.delayDownload=!0,e.resourceManager.loadTextures(e.sceneJson.textures),e.resourceManager.loadModels(e.sceneJson.models),e.parseWorld(e.sceneJson),t()})},e.prototype.parseWorld=function(e){var t=new go;if(this.world=t,this.parseBaseObject(e,t),e.buildings)for(var r=e.buildings,i=0;i<r.length;i++){var n=r[i],o=this.parseBuilding(n);t.buildings.push(o)}if(e.outdoors){var a=new _o;this.parseFloorPlan(e.outdoors,a),t.outdoors=a}},e.prototype.parseBuilding=function(e,t){var r=e,i=new vo;this.parseBaseObject(e,i,t);var n=r[da.plans];if(n)for(var o=0;o<n.length;o++){var a=n[o],s=new co;this.parseFloorPlan(a,s,i),i.floorplans.push(s)}var l=r.facades;if(l)for(h=0;h<l.length;h++){var c=l[h];this.parseFacade(c,i)}var u=r.facadegroups;if(u)for(var h=0;h<u.length;h++){var p=u[h];this.parseFacadeGroup(p,i)}return i},e.prototype.parseFloorPlan=function(e,t,r){if(this.parseBaseObject(e,t,r),e[da.height]&&(t.height=e[da.height]),e[da.corners])for(var i=e[da.corners],n=0;n<i.length;n++){var o=i[n],a=o[0],s=o[1],l=-o[2];t.existsCorner(a,s,l)?console.error("repeat corner"):t.addCorner(a,s,l)}if(e[da.walls])for(var c=e[da.walls],n=0;n<c.length;n++){var u=c[n];this.parseWall(u,t)}if(e[da.rooms])for(var h=e[da.rooms],n=0;n<h.length;n++){var p=h[n];this.parseRoom(p,t)}if(e[da.placements])for(var d=e[da.placements],n=0;n<d.length;n++){f=d[n];this.parsePlacement(f,t)}if(e[da.videoprobes])for(var d=e[da.videoprobes],n=0;n<d.length;n++){var f=d[n];this.parsePlacement(f,t)}if(e[da.groups])for(var m=e[da.groups],n=0;n<m.length;n++){var g=m[n];this.parseGroup(g,t)}if(e[da.doorOrWindows])for(var v=e[da.doorOrWindows],n=0;n<v.length;n++){var y=v[n];this.parseDoorOrWindow(y,t)}if(e[da.curveLines])for(var E=e[da.curveLines],n=0;n<E.length;n++){x=E[n];this.parseCurveLine(x,t)}if(e[da.pipeLines])for(var E=e[da.pipeLines],n=0;n<E.length;n++){x=E[n];this.parsePipeLine(x,t)}if(e[da.text3Ds])for(var b=e[da.text3Ds],n=0;n<b.length;n++){var x=b[n];this.parseText3D(x,t)}return t},e.prototype.parseText3D=function(e,t){var r=new pa;if(this.parseBaseObject(e,r,t),e.color){var i=e.color;r.color=new THREE.Color(i[0],i[1],i[2]),4===i.length&&(r.opacity=i[3])}void 0!==e.font&&(r.font=e.font),void 0!==e.text&&(r.text=e.text),t.text3Ds.push(r)},e.prototype.parsePipeLine=function(e,t){var r=new ua;if(this.parseBaseObject(e,r,t),void 0!==e[da.texture]&&(r.resource=this.resourceManager.textures[e[da.texture]]),e.color){var i=e.color;r.color=new THREE.Color(i[0],i[1],i[2]),4===i.length&&(r.opacity=i[3])}e.sectionType&&(r.sectionType=e.sectionType),void 0!==e.rendermode&&(r.renderMode=e.rendermode),void 0!==e.radius&&(r.radius=e.radius),t.pipelines.push(r);for(var n=e.path,o=0;o<n.length;o++){var a=n[o],s=a[0],l=a[1],c=-a[2],u=new THREE.Vector3(s,l,c);r.points.push(u)}},e.prototype.parseCurveLine=function(e,t){var r=new ca;if(this.parseBaseObject(e,r,t),void 0!==e[da.texture]&&(r.resource=this.resourceManager.textures[e[da.texture]]),e.color){var i=e.color;r.color=new THREE.Color(i[0],i[1],i[2]),4===i.length&&(r.opacity=i[3])}void 0!==e.width&&(r.width=e.width),t.curvelines.push(r);for(var n=e.path,o=0;o<n.length;o++){var a=n[o],s=a[0],l=a[1],c=-a[2],u=new THREE.Vector3(s,l,c);r.points.push(u)}},e.prototype.parseDoorOrWindow=function(e,t){var r=new ho;this.parseBaseObject(e,r,t.parent),r.resource=this.resourceManager.models[e[da.model]],t.doorOrWindows.push(r),e[da.suspendPercent]&&(r.suspendPercent=e[da.suspendPercent]),e[da.isOpen]&&(r.isOpen=e[da.isOpen]),r.attachWall=t},e.prototype.parseFacade=function(e,t){var r=new la;if(this.parseBaseObject(e,r,t),r.resource=this.resourceManager.models[e[da.model]],void 0!==e.texture&&null!==e.texture&&(r.customTextureResource=this.resourceManager.textures[e.texture]),e.color){var i=e.color;r.customColor=new THREE.Color(i[0],i[1],i[2]),4===i.length&&(r.opacity=i[3])}e.rendermode&&(r.renderMode=e.rendermode),t.facades.push(r)},e.prototype.parseFacadeGroup=function(e,t){var r=new ha;if(this.parseBaseObject(e,r,t),t instanceof vo?t.facadeGroups.push(r):t.groups.push(r),e[da.placements])for(var i=e[da.placements],n=0;n<i.length;n++){var o=i[n];this.parseFacadeGroupChild(o,r)}if(e[da.groups])for(var a=e[da.groups],n=0;n<a.length;n++){var s=a[n];this.parseFacadeGroup(s,r)}},e.prototype.parseFacadeGroupChild=function(e,t){var r=new la;if(this.parseBaseObject(e,r,t),r.resource=this.resourceManager.models[e[da.model]],void 0!==e.texture&&null!==e.texture&&(r.customTextureResource=this.resourceManager.textures[e.texture]),e.color){var i=e.color;r.customColor=new THREE.Color(i[0],i[1],i[2]),4===i.length&&(r.opacity=i[3])}e.rendermode&&(r.renderMode=e.rendermode),t.placements.push(r)},e.prototype.parsePlacement=function(e,t){var r=new uo;if(this.parseBaseObject(e,r,t),r.resource=this.resourceManager.models[e[da.model]],void 0!==e.texture&&null!==e.texture&&(r.customTextureResource=this.resourceManager.textures[e.texture]),e.color){var i=e.color;r.customColor=new THREE.Color(i[0],i[1],i[2]),4===i.length&&(r.opacity=i[3])}e.rendermode&&(r.renderMode=e.rendermode),e.animinfo&&(r.isPlayAnim=e.animinfo.isplay,r.animClip=e.animinfo.clip),t.placements.push(r)},e.prototype.parseGroup=function(e,t){var r=new Io;if(this.parseBaseObject(e,r,t),t.groups.push(r),e[da.placements])for(var i=e[da.placements],n=0;n<i.length;n++){var o=i[n];this.parsePlacement(o,r)}if(e[da.groups])for(var a=e[da.groups],n=0;n<a.length;n++){var s=a[n];this.parseGroup(s,r)}},e.prototype.parseWall=function(e,t){var r=null;0===e[da.wallType]?(r=new no).lightMapResource=Qn.wallLightMapResource:r=new Fo,this.parseBaseObject(e,r,t);var i=e[da.corners];if(r.startCorner=t.corners[i[1]],r.endCorner=t.corners[i[0]],void 0!==e[da.leftTexture]&&(r.leftResource=this.resourceManager.textures[e[da.leftTexture]]),void 0!==e[da.rightTexture]&&(r.rightResource=this.resourceManager.textures[e[da.rightTexture]]),void 0!==e[da.edgeTexture]&&(r.edgeResource=this.resourceManager.textures[e[da.edgeTexture]]),void 0!==e[da.model]&&(r.resource=this.resourceManager.models[e[da.model]]),void 0!==e.isshow&&(r.isShow=e.isshow),e[da.doorOrWindows])for(var n=e[da.doorOrWindows],o=0;o<n.length;o++){var a=n[o];this.parseDoorOrWindow(a,r,t)}e.height&&(r.height=e.height),r.startCorner.addWall(r),r.endCorner.addWall(r),t.addWall(r)},e.prototype.parseRoom=function(e,t){var r=new lo;this.parseBaseObject(e,r,t);var i=e[da.corners],n=[],o=null;if(i)for(d=0;d<i.length;d++){v=i[d];n.push(t.corners[v].position)}if(0===n.length){var a=e.points;if(!a)return;for(d=0;d<a.length;d++){var s=a[d],l=s[0],c=s[1],u=-s[2],h=new THREE.Vector3(l,c,u);n.push(h)}}if(0!==n.length){var p=e[da.holesCorners];if(p){o=[];for(var d=0;d<p.length;d++){for(var f=p[d],m=[],g=0;g<f.length;g++){var v=f[g];m.push(t.corners[v].position)}o.push(m)}}if(o&&(r.holes=o),void 0!==e[da.floorTexture]&&(r.floorResource=this.resourceManager.textures[e[da.floorTexture]]),void 0!==e[da.ceilingTexture]&&(r.ceilingResource=this.resourceManager.textures[e[da.ceilingTexture]]),void 0!==e[da.roofTexture]&&(r.roofResource=this.resourceManager.textures[e[da.roofTexture]]),void 0!==e.isshowfloor&&(r.floor.isShow=e.isshowfloor),void 0!==e.isshowceiling&&(r.ceiling.isShow=e.isshowceiling),void 0!==e.isshowroof&&(r.roof.isShow=e.isshowroof),void 0!==e.ceilingheight&&(r.ceiling.height=e.ceilingheight),void 0!==e.roofheight&&(r.roof.height=e.roofheight),void 0!==e.floorheight&&(r.floor.height=e.floorheight),e.floorblocksize){y=e.floorblocksize;r.floor.blockSize=new THREE.Vector2(y[0],y[1])}if(e.ceilingblocksize){y=e.ceilingblocksize;r.ceiling.blockSize=new THREE.Vector2(y[0],y[1])}if(e.roofblocksize){var y=e.roofblocksize;r.roof.blockSize=new THREE.Vector2(y[0],y[1])}r.points=n,t.rooms.push(r)}else console.error("room points is null")},e.prototype.parseBaseObject=function(e,t,r){var i,n,o;if(t.parent=r,e[da.id]&&(i=e[da.id],t.id=i),e[da.userID]&&(o=e[da.userID],t.userID=o),e[da.name]&&(n=e[da.name],t.name=n),t.jsonData=e,e[da.position]){var a=e[da.position];t.position.set(a[0],a[1],-a[2])}if(e[da.scale]){var s=e[da.scale],l=t.scale;0===s[0]&&(s[0]=.01),0===s[1]&&(s[1]=.01),0===s[2]&&(s[2]=.01),l.set(s[0],s[1],s[2])}if(e[da.rotation]){var c=e[da.rotation];t.rotation.set(c[0],c[1],-c[2],-c[3])}e[da.properties]&&(t.properties=e[da.properties]),void 0!==e.isshow&&null!==e.isshow&&(t.isShow=e.isshow)},e.prototype.createRooms=function(){for(var e=[],t=0;t<this.curFloorPlan.rooms.length;t++){var r=this.curFloorPlan.rooms[t];e.push(r.meshGroup)}return e},e.prototype.createWalls=function(){for(var e=[],t=0;t<this.world.buildings.length;t++)for(var r=this.world.buildings[t],i=0;i<r.floorplans.length;i++)for(var n=r.floorplans[i],o=0;o<n.walls.length;o++){var a=n.walls[o];e.push(a.wallGroup)}return e},e.prototype.createWallMesh=function(e){var t=new THREE.BufferGeometry;t.addAttribute("position",new THREE.BufferAttribute(e.positionArray,3)),t.addAttribute("normal",new THREE.BufferAttribute(e.normalArray,3)),t.addAttribute("uv",new THREE.BufferAttribute(e.uvArray,2));var r=e.material;return new THREE.Mesh(t,r)},Gn(e,[{key:"downloadResourceProgress",get:function(){return this.resourceManager.downloadResProgess}}]),e}(),ma={id:"id",name:"name",position:"position",rotation:"rotation",scale:"scale",properties:"properties",plans:"plans",walls:"walls",placements:"placements",videoprobes:"videoprobes",groups:"groups",corners:"corners",doorOrWindows:"doororwindows",curveLines:"curvelines",pipeLines:"pipelines",text3Ds:"text3ds",rooms:"rooms",height:"height",thick:"thick",texture:"texture",type:"type",model:"model",suspendPercent:"suspendpercent",leftTexture:"lefttexture",rightTexture:"righttexture",edgeTexture:"edgetexture",floorTexture:"floortexture",ceilingTexture:"ceilingtexture",roofTexture:"rooftexture",isOpen:"isopen",wallType:"type"},ga=function(){function e(){qn(this,e),this.sceneJson=null,this.scale=1,this.curFloorPlan=null,this.enableCombine=!0,this.defaultWallEdgeTextureUri="Textures/WallEdge.jpg",this.defaultWallTextureUri="Textures/RoomWall.jpg",this.defaultFloorTextureUri="Textures/FloorDefault.jpg",this.defaultCeilingTextureUri="Textures/CeilingDefault.jpg",this.defaultRoofTextureUri="Textures/RoofDefault.jpg",this.world=null,this.resourceManager=new Mo,this.combineManager=new sa(this.resourceManager),this.combineParser=new $o(this),Jn.enableBuildMesh=!1}return e.prototype.disposeModels=function(){this.resourceManager.disposeModels()},e.prototype.disposeTextures=function(){this.resourceManager.disposeTextures()},e.prototype._nestingLoopYield=function(e,t,r){var i=this,n=e.next();if(n.done)return t&&t(),n.value;var o=n.value;n.done;o instanceof Promise?o.then(function(n){return i._nestingLoopYield(e,t,r)}).catch(function(e){r(e)}):this._nestingLoopYield(e,t,r)},e.prototype.delayLoad=function(e){var t=this;return e?(e.url&&(this.sceneURL=e.url,this.resourceManager.localCustomModelBaseUrl=this.getParentRelativeUrl(this.sceneURL)),e.json&&(this.sceneJson=e.json),e.customModeBaseUrl&&(this.resourceManager.localCustomModelBaseUrl=e.customModeBaseUrl),new Promise(function(e,r){t.resourceManager.initLightMaps(function(){t.loadSceneJson().then(function(){t.parseSceneJson().then(function(){return t.world.build(),new Promise(function(e,r){t.combineParser.parseWorld(t.world),t.combineParser.buildWorld(t.world),e(t.world)})})}).then(function(){e(t.world)}).catch(function(e){console.error(e)})})})):(console.error("load param can not be null"),null)},e.prototype.loadFont=function(e){return new Promise(function(t,r){(new THREE.FontLoader).load("./models/Font/Microsoft YaHei_Regular.json",function(t){pa.font=t,e()})})},e.prototype.loadResources=function(){var e=this;return new Promise(function(t,r){e.resourceManager.downloadResourcesWithQueue(function(){t(e.world)})})},e.prototype.getParentRelativeUrl=function(e){for(var t=e.split("/"),r="",i=0;i<t.length-1;i++){r+=t[i]+"/"}return r},e.prototype.load=function(e){var t=this;return e?(e.url&&(this.sceneURL=e.url,this.resourceManager.localCustomModelBaseUrl=this.getParentRelativeUrl(this.sceneURL)),e.json&&(this.sceneJson=e.json),new Promise(function(e,r){t.loadSceneJson().then(function(){t.parseSceneJson().then(function(){e(t.world)})}).then(function(){e(t.world)}).catch(function(e){console.error(e)})})):(console.error("load param can not be null"),null)},e.prototype.loadSceneJson=function(){var e=this;return new Promise(function(t,r){if(e.sceneJson)t(e.sceneJson);else if(e.sceneURL){(new THREE.FileLoader).load(e.sceneURL,function(r){e.sceneJson=JSON.parse(r),t()},function(){},function(t){r("can not load "+e.sceneURL)})}else r("load scene json error")})},e.prototype.createTextureLoaderPromise=function(e){return new Promise(function(t,r){(new THREE.TextureLoader).load(e,function(e){e.wrapS=THREE.RepeatWrapping,e.wrapT=THREE.RepeatWrapping,t(e)},function(t){console.log(e+" "+t.loaded/t.total*100+"% loaded")},function(r){t(null),console.log(e+"load error")})})},e.prototype.parseSceneJson=function(){var e=this;return new Promise(function(t,r){e.resourceManager.delayDownload=!0,e.resourceManager.loadTextures(e.sceneJson.textures),e.resourceManager.loadModels(e.sceneJson.models),e.parseWorld(e.sceneJson),t()})},e.prototype.parseWorld=function(e){var t=new go;if(this.world=t,this.parseBaseObject(e,t),e.buildings)for(var r=e.buildings,i=0;i<r.length;i++){var n=r[i],o=this.parseBuilding(n);t.buildings.push(o)}if(e.outdoors){var a=new _o;this.parseFloorPlan(e.outdoors,a),t.outdoors=a}},e.prototype.parseBuilding=function(e,t){var r=e,i=new vo;this.parseBaseObject(e,i,t);var n=r[ma.plans];if(n)for(var o=0;o<n.length;o++){var a=n[o],s=new co;this.parseFloorPlan(a,s,i),i.floorplans.push(s)}var l=r.facades;if(l)for(h=0;h<l.length;h++){var c=l[h];this.parseFacade(c,i)}var u=r.facadegroups;if(u)for(var h=0;h<u.length;h++){var p=u[h];this.parseFacadeGroup(p,i)}return i},e.prototype.parseFloorPlan=function(e,t,r){if(this.parseBaseObject(e,t,r),e[ma.height]&&(t.height=e[ma.height]),e[ma.corners])for(var i=e[ma.corners],n=0;n<i.length;n++){var o=i[n],a=o[0],s=o[1],l=-o[2];t.existsCorner(a,s,l)?console.error("repeat corner"):t.addCorner(a,s,l)}if(e[ma.walls])for(var c=e[ma.walls],n=0;n<c.length;n++){var u=c[n];this.parseWall(u,t)}if(e[ma.rooms])for(var h=e[ma.rooms],n=0;n<h.length;n++){var p=h[n];this.parseRoom(p,t)}if(e[ma.placements])for(var d=e[ma.placements],n=0;n<d.length;n++){f=d[n];this.parsePlacement(f,t)}if(e[ma.videoprobes])for(var d=e[ma.videoprobes],n=0;n<d.length;n++){var f=d[n];this.parsePlacement(f,t)}if(e[ma.groups])for(var m=e[ma.groups],n=0;n<m.length;n++){var g=m[n];this.parseGroup(g,t)}if(e[ma.doorOrWindows])for(var v=e[ma.doorOrWindows],n=0;n<v.length;n++){var y=v[n];this.parseDoorOrWindow(y,t)}if(e[ma.curveLines])for(var E=e[ma.curveLines],n=0;n<E.length;n++){x=E[n];this.parseCurveLine(x,t)}if(e[ma.pipeLines])for(var E=e[ma.pipeLines],n=0;n<E.length;n++){x=E[n];this.parsePipeLine(x,t)}if(e[ma.text3Ds])for(var b=e[ma.text3Ds],n=0;n<b.length;n++){var x=b[n];this.parseText3D(x,t)}return t},e.prototype.parseText3D=function(e,t){var r=new pa;if(this.parseBaseObject(e,r,t),e.color){var i=e.color;r.color=new THREE.Color(i[0],i[1],i[2]),4===i.length&&(r.opacity=i[3])}void 0!==e.font&&(r.font=e.font),void 0!==e.text&&(r.text=e.text),t.text3Ds.push(r)},e.prototype.parsePipeLine=function(e,t){var r=new ua;if(this.parseBaseObject(e,r,t),void 0!==e[ma.texture]&&(r.resource=this.resourceManager.textures[e[ma.texture]]),e.color){var i=e.color;r.color=new THREE.Color(i[0],i[1],i[2]),4===i.length&&(r.opacity=i[3])}e.sectionType&&(r.sectionType=e.sectionType),void 0!==e.rendermode&&(r.renderMode=e.rendermode),void 0!==e.radius&&(r.radius=e.radius),t.pipelines.push(r);for(var n=e.path,o=0;o<n.length;o++){var a=n[o],s=a[0],l=a[1],c=-a[2],u=new THREE.Vector3(s,l,c);r.points.push(u)}},e.prototype.parseCurveLine=function(e,t){var r=new ca;if(this.parseBaseObject(e,r,t),void 0!==e[ma.texture]&&(r.resource=this.resourceManager.textures[e[ma.texture]]),e.color){var i=e.color;r.color=new THREE.Color(i[0],i[1],i[2]),4===i.length&&(r.opacity=i[3])}void 0!==e.width&&(r.width=e.width),t.curvelines.push(r);for(var n=e.path,o=0;o<n.length;o++){var a=n[o],s=a[0],l=a[1],c=-a[2],u=new THREE.Vector3(s,l,c);r.points.push(u)}},e.prototype.parseDoorOrWindow=function(e,t){var r=new ho;this.parseBaseObject(e,r,t.parent),r.resource=this.resourceManager.models[e[ma.model]],t.doorOrWindows.push(r),e[ma.suspendPercent]&&(r.suspendPercent=e[ma.suspendPercent]),e[ma.isOpen]&&(r.isOpen=e[ma.isOpen]),r.attachWall=t},e.prototype.parseFacade=function(e,t){var r=new la;if(this.parseBaseObject(e,r,t),r.resource=this.resourceManager.models[e[ma.model]],void 0!==e.texture&&null!==e.texture&&(r.customTextureResource=this.resourceManager.textures[e.texture]),e.color){var i=e.color;r.customColor=new THREE.Color(i[0],i[1],i[2]),4===i.length&&(r.opacity=i[3])}e.rendermode&&(r.renderMode=e.rendermode),t.facades.push(r)},e.prototype.parseFacadeGroup=function(e,t){var r=new ha;if(this.parseBaseObject(e,r,t),t instanceof vo?t.facadeGroups.push(r):t.groups.push(r),e[ma.placements])for(var i=e[ma.placements],n=0;n<i.length;n++){var o=i[n];this.parseFacadeGroupChild(o,r)}if(e[ma.groups])for(var a=e[ma.groups],n=0;n<a.length;n++){var s=a[n];this.parseFacadeGroup(s,r)}},e.prototype.parseFacadeGroupChild=function(e,t){var r=new la;if(this.parseBaseObject(e,r,t),r.resource=this.resourceManager.models[e[ma.model]],void 0!==e.texture&&null!==e.texture&&(r.customTextureResource=this.resourceManager.textures[e.texture]),e.color){var i=e.color;r.customColor=new THREE.Color(i[0],i[1],i[2]),4===i.length&&(r.opacity=i[3])}e.rendermode&&(r.renderMode=e.rendermode),t.placements.push(r)},e.prototype.parsePlacement=function(e,t){var r=new uo;if(this.parseBaseObject(e,r,t),r.resource=this.resourceManager.models[e[ma.model]],void 0!==e.texture&&null!==e.texture&&(r.customTextureResource=this.resourceManager.textures[e.texture]),e.color){var i=e.color;r.customColor=new THREE.Color(i[0],i[1],i[2]),4===i.length&&(r.opacity=i[3])}e.rendermode&&(r.renderMode=e.rendermode),e.animinfo&&(r.isPlayAnim=e.animinfo.isplay,r.animClip=e.animinfo.clip),t.placements.push(r)},e.prototype.parseGroup=function(e,t){var r=new Io;if(this.parseBaseObject(e,r,t),t.groups.push(r),e[ma.placements])for(var i=e[ma.placements],n=0;n<i.length;n++){var o=i[n];this.parsePlacement(o,r)}if(e[ma.groups])for(var a=e[ma.groups],n=0;n<a.length;n++){var s=a[n];this.parseGroup(s,r)}},e.prototype.parseWall=function(e,t){var r=null;0===e[ma.wallType]?(r=new no).lightMapResource=Qn.wallLightMapResource:r=new Fo,this.parseBaseObject(e,r,t);var i=e[ma.corners];if(r.startCorner=t.corners[i[0]],r.endCorner=t.corners[i[1]],void 0!==e[ma.leftTexture]&&(r.rightResource=this.resourceManager.textures[e[ma.leftTexture]]),void 0!==e[ma.rightTexture]&&(r.leftResource=this.resourceManager.textures[e[ma.rightTexture]]),void 0!==e[ma.edgeTexture]&&(r.edgeResource=this.resourceManager.textures[e[ma.edgeTexture]]),void 0!==e[ma.model]&&(r.resource=this.resourceManager.models[e[ma.model]]),void 0!==e.isshow&&(r.isShow=e.isshow),e[ma.doorOrWindows])for(var n=e[ma.doorOrWindows],o=0;o<n.length;o++){var a=n[o];this.parseDoorOrWindow(a,r,t)}e.height&&(r.height=e.height),r.startCorner.addWall(r),r.endCorner.addWall(r),t.addWall(r)},e.prototype.parseRoom=function(e,t){var r=new lo;this.parseBaseObject(e,r,t);var i=e[ma.corners],n=[];if(i)for(s=0;s<i.length;s++){var o=i[s];n.push(t.corners[o].position)}if(0===n.length){var a=e.points;if(!a)return;for(var s=0;s<a.length;s++){var l=a[s],c=l[0],u=l[1],h=-l[2],p=new THREE.Vector3(c,u,h);n.push(p)}}if(0!==n.length){if(void 0!==e[ma.floorTexture]&&(r.floorResource=this.resourceManager.textures[e[ma.floorTexture]]),void 0!==e[ma.ceilingTexture]&&(r.ceilingResource=this.resourceManager.textures[e[ma.ceilingTexture]]),void 0!==e[ma.roofTexture]&&(r.roofResource=this.resourceManager.textures[e[ma.roofTexture]]),void 0!==e.isshowfloor&&(r.floor.isShow=e.isshowfloor),void 0!==e.isshowceiling&&(r.ceiling.isShow=e.isshowceiling),void 0!==e.isshowroof&&(r.roof.isShow=e.isshowroof),void 0!==e.ceilingheight&&(r.ceiling.height=e.ceilingheight),void 0!==e.roofheight&&(r.roof.height=e.roofheight),void 0!==e.floorheight&&(r.floor.height=e.floorheight),e.floorblocksize){d=e.floorblocksize;r.floor.blockSize=new THREE.Vector2(d[0],d[1])}if(e.ceilingblocksize){d=e.ceilingblocksize;r.ceiling.blockSize=new THREE.Vector2(d[0],d[1])}if(e.roofblocksize){var d=e.roofblocksize;r.roof.blockSize=new THREE.Vector2(d[0],d[1])}r.points=n,t.rooms.push(r)}else console.error("room points is null")},e.prototype.parseBaseObject=function(e,t,r){var i,n;if(t.parent=r,e[ma.id]&&(i=e[ma.id],t.id=i),e[ma.name]&&(n=e[ma.name],t.name=n),t.jsonData=e,e[ma.position]){var o=e[ma.position];t.position.set(o[0],o[1],-o[2])}if(e[ma.scale]){var a=e[ma.scale],s=t.scale;0===a[0]&&(a[0]=.01),0===a[1]&&(a[1]=.01),0===a[2]&&(a[2]=.01),s.set(a[0],a[1],a[2])}if(e[ma.rotation]){var l=e[ma.rotation];t.rotation.set(l[0],l[1],-l[2],-l[3])}e[ma.properties]&&(t.properties=e[ma.properties]),void 0!==e.isshow&&null!==e.isshow&&(t.isShow=e.isshow)},e.prototype.createRooms=function(){for(var e=[],t=0;t<this.curFloorPlan.rooms.length;t++){var r=this.curFloorPlan.rooms[t];e.push(r.meshGroup)}return e},e.prototype.createWalls=function(){for(var e=[],t=0;t<this.world.buildings.length;t++)for(var r=this.world.buildings[t],i=0;i<r.floorplans.length;i++)for(var n=r.floorplans[i],o=0;o<n.walls.length;o++){var a=n.walls[o];e.push(a.wallGroup)}return e},e.prototype.createWallMesh=function(e){var t=new THREE.BufferGeometry;t.addAttribute("position",new THREE.BufferAttribute(e.positionArray,3)),t.addAttribute("normal",new THREE.BufferAttribute(e.normalArray,3)),t.addAttribute("uv",new THREE.BufferAttribute(e.uvArray,2));var r=e.material;return new THREE.Mesh(t,r)},Gn(e,[{key:"downloadResourceProgress",get:function(){return this.resourceManager.downloadResProgess}}]),e}(),va={id:"id",name:"name",position:"position",rotation:"rotation",scale:"scale",properties:"properties",plans:"plans",walls:"walls",placements:"placements",videoprobes:"videoprobes",groups:"groups",corners:"corners",doorOrWindows:"doororwindows",curveLines:"curvelines",pipeLines:"pipelines",rooms:"rooms",height:"height",thick:"thick",texture:"texture",type:"type",model:"model",suspendPercent:"suspendpercent",leftTexture:"lefttexture",rightTexture:"righttexture",edgeTexture:"edgetexture",floorTexture:"floortexture",ceilingTexture:"ceilingtexture",roofTexture:"rooftexture",isOpen:"isopen",wallType:"type"},ya=function(){function e(){qn(this,e),this.sceneJson=null,this.scale=1,this.curFloorPlan=null,this.enableCombine=!0,this.defaultWallEdgeTextureUri="Textures/WallEdge.jpg",this.defaultWallTextureUri="Textures/RoomWall.jpg",this.defaultFloorTextureUri="Textures/FloorDefault.jpg",this.defaultCeilingTextureUri="Textures/CeilingDefault.jpg",this.defaultRoofTextureUri="Textures/RoofDefault.jpg",this.world=null,this.resourceManager=new Mo,this.combineManager=new sa(this.resourceManager),this.combineParser=new $o(this),Jn.enableBuildMesh=!1}return e.prototype._nestingLoopYield=function(e,t,r){var i=this,n=e.next();if(n.done)return t&&t(),n.value;var o=n.value;n.done;o instanceof Promise?o.then(function(n){return i._nestingLoopYield(e,t,r)}).catch(function(e){r(e)}):this._nestingLoopYield(e,t,r)},e.prototype.delayLoad=function(e){var t=this;return e?(e.url&&(this.sceneURL=e.url),e.json&&(this.sceneJson=e.json),new Promise(function(e,r){t.loadSceneJson().then(function(){t.parseSceneJson().then(function(){return t.world.build(),new Promise(function(e,r){t.combineParser.parseWorld(t.world),t.combineParser.buildWorld(t.world),console.log("finish combine parser"),e(t.world)})})}).then(function(){e(t.world)}).catch(function(e){console.error(e)})})):(console.error("load param can not be null"),null)},e.prototype.loadResources=function(){var e=this;return new Promise(function(t,r){e.resourceManager.downloadResourcesWithQueue(function(){console.log("finish downloadResources"),t(e.world)})})},e.prototype.load=function(e){var t=this;return e?(e.url&&(this.sceneURL=e.url),e.json&&(this.sceneJson=e.json),new Promise(function(e,r){t.loadSceneJson().then(function(){t.parseSceneJson().then(function(){e(t.world)})}).then(function(){e(t.world)}).catch(function(e){console.error(e)})})):(console.error("load param can not be null"),null)},e.prototype.loadSceneJson=function(){var e=this;return new Promise(function(t,r){if(e.sceneJson)t(e.sceneJson);else if(e.sceneURL){(new THREE.FileLoader).load(e.sceneURL,function(r){e.sceneJson=JSON.parse(r),t()},function(){},function(t){r("can not load "+e.sceneURL)})}else r("load scene json error")})},e.prototype.createTextureLoaderPromise=function(e){return new Promise(function(t,r){(new THREE.TextureLoader).load(e,function(e){e.wrapS=THREE.RepeatWrapping,e.wrapT=THREE.RepeatWrapping,t(e)},function(t){console.log(e+" "+t.loaded/t.total*100+"% loaded")},function(r){t(null),console.log(e+"load error")})})},e.prototype.parseSceneJson=function(){var e=this;return new Promise(function(t,r){e.parseWorld(e.sceneJson),t()})},e.prototype.parseWorld=function(e){var t=new go;if(this.world=t,this.parseBaseObject(e,t),e.buildings)for(var r=e.buildings,i=0;i<r.length;i++){var n=r[i],o=this.parseBuilding(n);t.buildings.push(o)}if(e.outdoors){var a=new _o;this.parseFloorPlan(e.outdoors,a),t.outdoors=a}},e.prototype.parseBuilding=function(e,t){var r=e,i=new vo;this.parseBaseObject(e,i,t);var n=r[va.plans];if(n)for(var o=0;o<n.length;o++){var a=n[o],s=new co;this.parseFloorPlan(a,s,i),i.floorplans.push(s)}var l=r.facades;if(l)for(h=0;h<l.length;h++){var c=l[h];this.parseFacade(c,i)}var u=r.facadegroups;if(u)for(var h=0;h<u.length;h++){var p=u[h];this.parseFacadeGroup(p,i)}return i},e.prototype.parseFloorPlan=function(e,t,r){if(this.parseBaseObject(e,t,r),e[va.height]&&(t.height=e[va.height]),e[va.corners])for(var i=e[va.corners],n=0;n<i.length;n++){var o=i[n],a=o[0],s=o[1],l=-o[2];t.existsCorner(a,s,l)?console.error("repeat corner"):t.addCorner(a,s,l)}if(e[va.walls])for(var c=e[va.walls],n=0;n<c.length;n++){var u=c[n];this.parseWall(u,t)}return t},e.prototype.parsePipeLine=function(e,t){var r=new ua;if(this.parseBaseObject(e,r,t),void 0!==e[va.texture]&&(r.resource=this.resourceManager.textures[e[va.texture]]),e.color){var i=e.color;r.color=new THREE.Color(i[0],i[1],i[2]),4===i.length&&(r.opacity=i[3])}e.sectionType&&(r.sectionType=e.sectionType),void 0!==e.rendermode&&(r.renderMode=e.rendermode),void 0!==e.radius&&(r.radius=e.radius),t.pipelines.push(r);for(var n=e.path,o=0;o<n.length;o++){var a=n[o],s=a[0],l=a[1],c=-a[2],u=new THREE.Vector3(s,l,c);r.points.push(u)}},e.prototype.parseCurveLine=function(e,t){var r=new ca;if(this.parseBaseObject(e,r,t),void 0!==e[va.texture]&&(r.resource=this.resourceManager.textures[e[va.texture]]),e.color){var i=e.color;r.color=new THREE.Color(i[0],i[1],i[2]),4===i.length&&(r.opacity=i[3])}void 0!==e.width&&(r.width=e.width),t.curvelines.push(r);for(var n=e.path,o=0;o<n.length;o++){var a=n[o],s=a[0],l=a[1],c=-a[2],u=new THREE.Vector3(s,l,c);r.points.push(u)}},e.prototype.parseDoorOrWindow=function(e,t){var r=new ho;this.parseBaseObject(e,r,t.parent),r.resource=this.resourceManager.models[e[va.model]],t.doorOrWindows.push(r),e[va.suspendPercent]&&(r.suspendPercent=e[va.suspendPercent]),e[va.isOpen]&&(r.isOpen=e[va.isOpen]),r.attachWall=t},e.prototype.parseFacade=function(e,t){var r=new la;if(this.parseBaseObject(e,r,t),r.resource=this.resourceManager.models[e[va.model]],void 0!==e.texture&&null!==e.texture&&(r.customTextureResource=this.resourceManager.textures[e.texture]),e.color){var i=e.color;r.customColor=new THREE.Color(i[0],i[1],i[2]),4===i.length&&(r.opacity=i[3])}e.rendermode&&(r.renderMode=e.rendermode),t.facades.push(r)},e.prototype.parseFacadeGroup=function(e,t){var r=new ha;if(this.parseBaseObject(e,r,t),t instanceof vo?t.facadeGroups.push(r):t.groups.push(r),e[va.placements])for(var i=e[va.placements],n=0;n<i.length;n++){var o=i[n];this.parseFacadeGroupChild(o,r)}if(e[va.groups])for(var a=e[va.groups],n=0;n<a.length;n++){var s=a[n];this.parseFacadeGroup(s,r)}},e.prototype.parseFacadeGroupChild=function(e,t){var r=new la;if(this.parseBaseObject(e,r,t),r.resource=this.resourceManager.models[e[va.model]],void 0!==e.texture&&null!==e.texture&&(r.customTextureResource=this.resourceManager.textures[e.texture]),e.color){var i=e.color;r.customColor=new THREE.Color(i[0],i[1],i[2]),4===i.length&&(r.opacity=i[3])}e.rendermode&&(r.renderMode=e.rendermode),t.placements.push(r)},e.prototype.parsePlacement=function(e,t){var r=new uo;if(this.parseBaseObject(e,r,t),r.resource=this.resourceManager.models[e[va.model]],void 0!==e.texture&&null!==e.texture&&(r.customTextureResource=this.resourceManager.textures[e.texture]),e.color){var i=e.color;r.customColor=new THREE.Color(i[0],i[1],i[2]),4===i.length&&(r.opacity=i[3])}e.rendermode&&(r.renderMode=e.rendermode),t.placements.push(r)},e.prototype.parseGroup=function(e,t){var r=new Io;if(this.parseBaseObject(e,r,t),t.groups.push(r),e[va.placements])for(var i=e[va.placements],n=0;n<i.length;n++){var o=i[n];this.parsePlacement(o,r)}if(e[va.groups])for(var a=e[va.groups],n=0;n<a.length;n++){var s=a[n];this.parseGroup(s,r)}},e.prototype.parseWall=function(e,t){var r=null;r=0===e[va.wallType]?new no:new Fo,this.parseBaseObject(e,r,t);var i=e[va.corners];if(r.startCorner=t.corners[i[0]],r.endCorner=t.corners[i[1]],void 0!==e[va.leftTexture]&&(r.rightResource=this.resourceManager.textures[e[va.leftTexture]]),void 0!==e[va.rightTexture]&&(r.leftResource=this.resourceManager.textures[e[va.rightTexture]]),void 0!==e[va.edgeTexture]&&(r.edgeResource=this.resourceManager.textures[e[va.edgeTexture]]),void 0!==e[va.model]&&(r.resource=this.resourceManager.models[e[va.model]]),void 0!==e.isshow&&(r.isShow=e.isshow),e[va.doorOrWindows])for(var n=e[va.doorOrWindows],o=0;o<n.length;o++){var a=n[o];this.parseDoorOrWindow(a,r,t)}e.height&&(r.height=e.height),r.startCorner.addWall(r),r.endCorner.addWall(r),t.addWall(r)},e.prototype.parseRoom=function(e,t){var r=new lo;this.parseBaseObject(e,r,t);var i=e[va.corners],n=[];if(i)for(s=0;s<i.length;s++){var o=i[s];n.push(t.corners[o].position)}if(0===n.length){var a=e.points;if(!a)return;for(var s=0;s<a.length;s++){var l=a[s],c=l[0],u=l[1],h=-l[2],p=new THREE.Vector3(c,u,h);n.push(p)}}if(0!==n.length){if(void 0!==e[va.floorTexture]&&(r.floorResource=this.resourceManager.textures[e[va.floorTexture]]),void 0!==e[va.ceilingTexture]&&(r.ceilingResource=this.resourceManager.textures[e[va.ceilingTexture]]),void 0!==e[va.roofTexture]&&(r.roofResource=this.resourceManager.textures[e[va.roofTexture]]),void 0!==e.isshowfloor&&(r.floor.isShow=e.isshowfloor),void 0!==e.isshowceiling&&(r.ceiling.isShow=e.isshowceiling),void 0!==e.isshowroof&&(r.roof.isShow=e.isshowroof),void 0!==e.ceilingheight&&(r.ceiling.height=e.ceilingheight),void 0!==e.roofheight&&(r.roof.height=e.roofheight),void 0!==e.floorheight&&(r.floor.height=e.floorheight),e.floorblocksize){d=e.floorblocksize;r.floor.blockSize=new THREE.Vector2(d[0],d[1])}if(e.ceilingblocksize){d=e.ceilingblocksize;r.ceiling.blockSize=new THREE.Vector2(d[0],d[1])}if(e.roofblocksize){var d=e.roofblocksize;r.roof.blockSize=new THREE.Vector2(d[0],d[1])}r.points=n,t.rooms.push(r)}else console.error("room points is null")},e.prototype.parseBaseObject=function(e,t,r){var i,n;if(t.parent=r,e[va.id]&&(i=e[va.id],t.id=i),e[va.name]&&(n=e[va.name],t.name=n),t.jsonData=e,e[va.position]){var o=e[va.position];t.position.set(o[0],o[1],-o[2])}if(e[va.scale]){var a=e[va.scale];t.scale.set(a[0],a[1],a[2])}if(e[va.rotation]){var s=e[va.rotation];t.rotation.set(s[0],s[1],-s[2],-s[3])}e[va.properties]&&(t.properties=e[va.properties]),void 0!==e.isshow&&null!==e.isshow&&(t.isShow=e.isshow)},e.prototype.createRooms=function(){for(var e=[],t=0;t<this.curFloorPlan.rooms.length;t++){var r=this.curFloorPlan.rooms[t];e.push(r.meshGroup)}return e},e.prototype.createWalls=function(){for(var e=[],t=0;t<this.world.buildings.length;t++)for(var r=this.world.buildings[t],i=0;i<r.floorplans.length;i++)for(var n=r.floorplans[i],o=0;o<n.walls.length;o++){var a=n.walls[o];e.push(a.wallGroup)}return e},e.prototype.createWallMesh=function(e){var t=new THREE.BufferGeometry;t.addAttribute("position",new THREE.BufferAttribute(e.positionArray,3)),t.addAttribute("normal",new THREE.BufferAttribute(e.normalArray,3)),t.addAttribute("uv",new THREE.BufferAttribute(e.uvArray,2));var r=e.material;return new THREE.Mesh(t,r)},Gn(e,[{key:"downloadResourceProgress",get:function(){return this.resourceManager.downloadResProgess}}]),e}(),Ea=function(){function e(){qn(this,e),this.sceneJson=null,this.scale=1,this.enableCombine=!0,this.pointInLineDeviation=.001,this.world=null,this.resourceManager=new Mo,this.combineManager=new sa(this.resourceManager),this.combineParser=new $o(this),this.defaultWallEdgeResource=new fo(this.resourceManager),this.defaultWallEdgeResource.id="EB9ECFA1101C4A0ABB770ED3A9865441",this.defaultWallEdgeResource.ext="jpg",this.defaultWallEdgeResource.baseUrl=this.resourceManager.baseTextureUrl,this.defaultWallTextureResource=new fo(this.resourceManager),this.defaultWallTextureResource.id="81FDB96B43D441C5B3C650BFA2B76CD4",this.defaultWallTextureResource.ext="jpg",this.defaultWallTextureResource.isDefault=!0,this.defaultWallTextureResource.baseUrl=this.resourceManager.baseTextureUrl,this.defaultFloorTextureResource=new fo(this.resourceManager),this.defaultFloorTextureResource.id="IQR8PZE2SGEV2H07WX3EJK22CA6ZS0YG",this.defaultFloorTextureResource.ext="jpg",this.defaultFloorTextureResource.baseUrl=this.resourceManager.baseTextureUrl,this.defaultCeilingTextureResource=new fo(this.resourceManager),this.defaultCeilingTextureResource.id="UPEUIZIK19VMBPP9TLZJ3J3ILWK8V5ZB",this.defaultCeilingTextureResource.ext="jpg",this.defaultCeilingTextureResource.baseUrl=this.resourceManager.baseTextureUrl,this.defaultRoofTextureResource=new fo(this.resourceManager),this.defaultRoofTextureResource.id="3OZVGE55PV0MY48FPRG5BELXKHV26NU5",this.defaultRoofTextureResource.ext="jpg",this.defaultRoofTextureResource.baseUrl=this.resourceManager.baseTextureUrl,Jn.enableBuildMesh=!1}return e.prototype.disposeModels=function(){this.resourceManager.disposeModels()},e.prototype.disposeTextures=function(){this.resourceManager.disposeTextures()},e.prototype._nestingLoopYield=function(e,t,r){var i=this,n=e.next();if(n.done)return t&&t(),n.value;var o=n.value;n.done;o instanceof Promise?o.then(function(n){return i._nestingLoopYield(e,t,r)}).catch(function(e){r(e)}):this._nestingLoopYield(e,t,r)},e.prototype.delayLoad=function(e){var t=this;return e?(e.url&&(this.sceneURL=e.url,this.resourceManager.localCustomModelBaseUrl=this.getParentRelativeUrl(this.sceneURL)),e.json&&(this.sceneJson=e.json),e.customModeBaseUrl&&(this.resourceManager.localCustomModelBaseUrl=e.customModeBaseUrl),new Promise(function(e,r){t.resourceManager.initLightMaps(function(){t.loadSceneJson().then(function(){t.parseSceneJson().then(function(){return t.world.build(),new Promise(function(e,r){t.combineParser.parseWorld(t.world),t.combineParser.buildWorld(t.world),e(t.world)})})}).then(function(){e(t.world)}).catch(function(e){console.error(e)})})})):(console.error("load param can not be null"),null)},e.prototype.loadFont=function(e){return new Promise(function(t,r){(new THREE.FontLoader).load("./models/Font/Microsoft YaHei_Regular.json",function(t){pa.font=t,e()})})},e.prototype.loadResources=function(){var e=this;return new Promise(function(t,r){e.resourceManager.downloadResourcesWithQueue(function(){t(e.world)})})},e.prototype.getParentRelativeUrl=function(e){for(var t=e.split("/"),r="",i=0;i<t.length-1;i++){r+=t[i]+"/"}return r},e.prototype.load=function(e){var t=this;return this.delayLoad(e).then(function(e,r){return t.loadResources()})},e.prototype.loadSceneJson=function(){var e=this;return new Promise(function(t,r){if(e.sceneJson)t(e.sceneJson);else if(e.sceneURL){(new THREE.FileLoader).load(e.sceneURL,function(r){e.sceneJson=JSON.parse(r),t()},function(){},function(t){r("can not load "+e.sceneURL)})}else r("load scene json error")})},e.prototype.createTextureLoaderPromise=function(e){return new Promise(function(t,r){(new THREE.TextureLoader).load(e,function(e){e.wrapS=THREE.RepeatWrapping,e.wrapT=THREE.RepeatWrapping,t(e)},function(t){console.log(e+" "+t.loaded/t.total*100+"% loaded")},function(r){t(null),console.log(e+"load error")})})},e.prototype.parseSceneJson=function(){var e=this;return new Promise(function(t,r){e.resourceManager.delayDownload=!0,e.parseWorld(e.sceneJson),t()})},e.prototype.parseWorld=function(e){var t=new go;this.world=t,e.unit&&(this.scale=.01*e.unit),e.planheight&&(this.planHeight=e.planheight);var r=this.parseBuilding(e,t);t.buildings.push(r);var i=new _o;t.outdoors=i},e.prototype.parseBuilding=function(e,t){var r=new vo,i=new co;return this.parseFloorPlan(e,i,r),r.floorplans.push(i),r},e.prototype.parseFloorPlan=function(e,t,r){return this.planHeight&&(t.height=this.planHeight),e.walls&&this.parseWall(e.walls,t),e.rooms&&this.parseRoom(e.rooms,t),e.doors&&this.parseDoorJson(e.doors,t),t},e.prototype.parseDoorJson=function(e,t){for(var r=0,i=e.length;r<i;r++){var n=e[r],o=n.height*this.scale,a=n.width*this.scale,s=n.pos[0]*this.scale,l=n.pos[1]*this.scale,c=new THREE.Vector3(s,0,l),u=this.getPointOnWhichWall(t,c);if(null!==u){var h=new ho;n.suspendpercent&&(h.suspendPercent=n.suspendpercent),h.size.x=a,h.size.y=o,h.position=c,u.doorOrWindows.push(h)}else console.warn("can not find door on which wall!")}},e.prototype.getPointOnWhichWall=function(e,t){for(var r=e.walls,i=0;i<r.length;i++){var n=r[i];if(this.isPointOnLineAndBetweenPoints(n.startCorner.position,n.endCorner.position,t))return n}return null},e.prototype.isPointOnLine=function(e,t,r){var i=new THREE.Vector3;return i.crossVectors(e.clone().sub(r),t.clone().sub(r)),i.length()<this.pointInLineDeviation},e.prototype.isPointOnLineAndBetweenPoints=function(e,t,r){if(!this.isPointOnLine(e,t,r))return!1;var i=t.x-e.x,n=t.z-e.z;return Math.abs(i)>=Math.abs(n)?i>0?e.x<=r.x&&r.x<=t.x:t.x<=r.x&&r.x<=e.x:n>0?e.z<=r.z&&r.z<=t.z:t.z<=r.z&&r.z<=e.z},e.prototype.parseWall=function(e,t){for(var r=0,i=e.length;r<i;r++){var n=e[r],o=n.start[0]*this.scale,a=n.start[1]*this.scale,s=null,l=null;s=t.existsCorner(o,0,a)?t.getCorner(o,0,a):t.addCorner(o,0,a),o=n.end[0]*this.scale,a=n.end[1]*this.scale,l=t.existsCorner(o,0,a)?t.getCorner(o,0,a):t.addCorner(o,0,a);var c=new no;n.height?c.height=n.height:this.planHeight&&(c.height=this.planHeight),c.leftResource=this.defaultWallTextureResource,c.rightResource=this.defaultWallTextureResource,c.edgeResource=this.defaultWallEdgeResource,c.lightMapResource=Qn.wallLightMapResource,c.startCorner=s,c.endCorner=l,c.startCorner.addWall(c),c.endCorner.addWall(c),t.addWall(c)}},e.prototype.parseRoom=function(e,t){for(var r=0;r<e.length;r++){for(var i=e[r],n=[],o=null,a=0;a<i.points.length;a++){u=i.points[a];n.push(new THREE.Vector3(u[0]*this.scale,0,u[1]*this.scale))}if(i.holes){o=[];for(a=0;a<i.holes.length;a++){for(var s=i.holes[a],l=[],c=0;c<s.length;c++){var u=s[c];l.push(new THREE.Vector3(u[0]*this.scale,0,u[1]*this.scale))}o.push(l)}}var h=new lo;if(h.floorResource=this.defaultFloorTextureResource,h.ceilingResource=this.defaultCeilingTextureResource,h.roofResource=this.defaultRoofTextureResource,h.lightMapResource=Qn.floorLightMapResource,h.points=n,o&&(h.holes=o),i.center){var p=new THREE.Vector3;p.x=i.center[0],p.y=0,p.z=i.center[1],h.center=p}if(i.offset){var d=new THREE.Vector3;d.x=i.offset[0],d.y=i.offset[1],d.z=i.offset[2],h.offset=d}if(i.parentPosition){var f=new THREE.Vector3;f.x=i.parentPosition[0],f.y=i.parentPosition[1],f.z=i.parentPosition[2],h.parentPosition=f}h.parent=t,t.rooms.push(h)}},e.prototype.createRooms=function(){for(var e=[],t=0;t<plan.rooms.length;t++){var r=plan.rooms[t];e.push(r.meshGroup)}return e},e.prototype.createWalls=function(){for(var e=[],t=0;t<this.world.buildings.length;t++)for(var r=this.world.buildings[t],i=0;i<r.floorplans.length;i++)for(var n=r.floorplans[i],o=0;o<n.walls.length;o++){var a=n.walls[o];e.push(a.wallGroup)}return e},e.prototype.createWallMesh=function(e){var t=new THREE.BufferGeometry;t.addAttribute("position",new THREE.BufferAttribute(e.positionArray,3)),t.addAttribute("normal",new THREE.BufferAttribute(e.normalArray,3)),t.addAttribute("uv",new THREE.BufferAttribute(e.uvArray,2));var r=e.material;return new THREE.Mesh(t,r)},Gn(e,[{key:"downloadResourceProgress",get:function(){return this.resourceManager.downloadResProgess}}]),e}();e.HUAWEILoader=mo,e.HUAWEIWorldLoader=Eo,e.HUAWEIFloorPlanLoader=bo,e.Thing3DCadLoader=xo,e.UBuilderSceneLoader=Zo,e.UBuilderSceneDelayLoader=fa,e.UBuilderSceneSimpleLoader=ga,e.ExportTestXSLoader=ya,e.ThingjsEditorSceneLoader=Ea,e.DefaultSetting=Jn,Object.defineProperty(e,"__esModule",{value:!0})}),function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.t3d={})}(this,function(e){"use strict";function t(e,t){t.canNotQueryFromSelector||e.push(t)}function r(e,r,i){if(-1!==e.search("##uuid")){e=e.replace("##","");var n=(new exprEval.Parser).parse(e);r.forEach(function(e){n.evaluate({uuid:e.uuid})&&t(i,e)})}else e=e.substring(2),r.forEach(function(r){r.uuid==e&&t(i,r)})}function i(e,t,r,i){function n(e,t){return[e+l,t+c]}function o(e,t){return function(e,t){return function(e,t){if(0===e)return 0<t?90:0>t?270:0;if(0===t)return 0<e?0:180;if(isNaN(e)||isNaN(t))return 0;var r=180*Math.atan(Math.abs(t/e))/Math.PI;return 0>e?r=0>t?r+180:180-r:0>t&&(r=360-r),r}(t.x-e.x,t.y-e.y)}(t.startpoint,t.endpoint)}var a,s={unit:t=t||1,walls:[],rooms:[],doors:[]},l=0,c=0;if(r){for(var u=1/0,h=1/0,p=-1/0,d=-1/0,f=0,m=e.nodeDataArray.length;f<m;f++)"WallGroup"===(a=e.nodeDataArray[f]).category&&(u=Math.min(a.startpoint.x,u),u=Math.min(a.endpoint.x,u),h=Math.min(a.startpoint.y,h),h=Math.min(a.endpoint.y,h),p=Math.max(a.startpoint.x,p),p=Math.max(a.endpoint.x,p),d=Math.max(a.startpoint.y,d),d=Math.max(a.endpoint.y,d));l=-u,c=-h}for(var g={},f=0,m=e.nodeDataArray.length;f<m;f++)"WallGroup"==(a=e.nodeDataArray[f]).category&&(g[a.key]=a);for(var f=0,m=e.nodeDataArray.length;f<m;f++)switch((a=e.nodeDataArray[f]).category){case"WallGroup":var v={weight:a.thickness,start:n(a.startpoint.x,a.startpoint.y),end:n(a.endpoint.x,a.endpoint.y)};s.walls.push(v);break;case"Room":var y=a.offset.split(" ");y[0]-=0,y[1]-=0;var E=a.textLoc.split(" ");E[0]-=0,E[1]-=0;for(var b={points:[],holes:[],center:n(y[0]+E[0],y[1]+E[1])},x=0,_=a.polygons.length;x<_;x++){for(var w=0!==x&&i?b.holes:b.points,T=0,M=a.polygons[x].length;T<M;T++)R=a.polygons[x][T],w.push(n(y[0]+R[0],y[1]+R[1]));var R=a.polygons[x][0];w.push(n(y[0]+R[0],y[1]+R[1]))}s.rooms.push(b);break;case"DoorNode":(A=a.loc.split(" "))[0]-=0,A[1]-=0;var S=g[a.group],P={key:a.key,width:a.length,height:180,pos:n(A[0],A[1]),rotation:o(0,S)};s.doors.push(P);break;case"WindowNode":var A=a.loc.split(" ");A[0]-=0,A[1]-=0;var S=g[a.group],P={key:a.key,width:a.length,height:100,suspendpercent:.4,pos:n(A[0],A[1]),rotation:o(0,S)};s.doors.push(P)}return s}function n(e,t){if(null==e||e.length<3)console.log("invaild input parameter");else if(3!=e.length){for(var r=[],i=0;i<e.length-2;i+=2)t.push(new f(e[i],e[i+1],e[i+2])),r.push(e[i+1]);n(function(e,t){for(var r=[],i=0;i<e.length;i++){for(var n=!0,o=0;o<t.length;o++)if(function(e,t){return null!=e&&null!=t&&t.x==e.x&&t.y==e.y}(e[i],t[o])){n=!1;break}n&&r.push(e[i])}return r}(e,r),t)}else t.push(new f(e[0],e[1],e[2]))}function o(e,t){for(var r=[],i=0;i<e.length;i++){var o=new d(e[i].x,e[i].z);o.id=i,r.push(o)}var s=[];for(a(r,s),i=0;i<s.length;i++)n(s[i],t)}function a(e,t){for(var r=function(e){for(var t,r,i,n=[],o=0;o<e.length;o++)if(0==o){var a=e[e.length-1];r=t=a.x==e[0].x?"Infinity":(a.y-e[0].y)/(a.x-e[0].x),n.push(a)}else{var s;if(s=e[o-1].x==e[o].x?"Infinity":(e[o-1].y-e[o].y)/(e[o-1].x-e[o].x),t==s||Math.abs(t-s)<.001)continue;t=s,o==e.length-1&&(i=s),n.push(e[o-1])}return(r==i||Math.abs(r-i)<.001)&&n.shift(),n}(e),i=r.length,n=l(r),o=null,c=-1,f=0;f<i;f++){var m=r[f],g=s(f+1,i),v=s(f+2,i),y=h(m,r[g],r[v]);if(n&&y==_t){o=r[g],c=g;break}if(!n&&y==wt){o=r[g],c=g;break}}if(null!=o){for(var E,b=c,x=s(b+1,i),_=s(b-1,i),w=u(r[_],r[b],r[x]),T=(2*Math.PI-w)/2,M=100,f=0;f<r.length;f++)if(f!=b&&f!=_&&f!=x){var R=h(r[_],r[b],r[f]);if((n&&R==wt||!n&&R==_t||R==Mt)&&!function(e,t,r,i,n){for(var o=[_,r,x],a=[s(n-1,e.length),n,s(n+1,e.length)],l=0;l<e.length;l++){var c=(l+1)%e.length;if(!(o.indexOf(l)>=0&&o.indexOf(c)>=0)&&!(a.indexOf(l)>=0&&a.indexOf(c)>=0)&&function(e,t,r,i){if(e.equals(r)||e.equals(i)||t.equals(r)||t.equals(i))return!0;var n=function(e,t,r,i){var n=t.y-e.y,o=e.x-t.x,a=t.x*e.y-e.x*t.y,s=i.y-r.y,l=r.x-i.x,c=i.x*r.y-r.x*i.y,u=s*o-n*l;return 0==u?null:new d((l*a-o*c)/u,(n*c-s*a)/u)}(e,t,r,i);return null==n?h(e,t,r)==Tt||h(e,t,i)==Tt:!!(p(n.x,e.x,t.x)&&p(n.x,r.x,i.x)&&p(n.y,e.y,t.y)&&p(n.y,r.y,i.y))}(e[l],e[c],e[r],e[n]))return!0}return!1}(r,0,b,0,f)){var S=u(r[_],r[b],r[f]),P=Math.abs(S-T);P<M&&(M=P,E=f)}}var A=function(e,t,r){var i,n=Math.min(t,r),o=Math.max(t,r),a=(e.length,e[n]),s=e[o],l=n+1,c=Math.abs(t-r)-1,u=l+c-e.length;if(u>0)for(var h=0;h<u;h++){var p=e.shift();e.push(p),l--}return(i=e.splice(l,c)).push(s,a),[i,e]}(r,b,E);a(A[0],t),a(A[1],t)}else t.push(r)}function s(e,t){return e>=t?e%t:e<0?t+e%t:e}function l(e){for(var t=0,r=0,i=0;i<e.length;i++){var n=s(i+1,e.length),o=s(i+2,e.length);h(e[i],e[n],e[o])==_t?t++:r++}if(r>t)return!0;if(r<t)return!1;var a=e;return a.pop(),l(a)}function c(e,t){var r=function(e,t){return Math.sqrt(function(e,t){var r=t.x-e.x,i=t.y-e.y;return r*r+i*i}(e,t))}(e,t),i=(t.x-e.x)/r;return t.y>=e.y?Math.acos(i):2*Math.PI-Math.acos(i)}function u(e,t,r){var i=c(t,e),n=c(t,r),o=Math.abs(i-n);return o>Math.PI?2*Math.PI-o:o}function h(e,t,r){var i=c(e,t),n=c(e,r);return Math.abs(i-n)<.001||Math.abs(i-n-Math.PI)<.001?p(r.x,e.x,t.x)&&p(r.y,e.y,t.y)?Tt:Mt:i<=Math.PI?n<i||n-i>Math.PI?_t:wt:n>i||i-n>Math.PI?wt:_t}function p(e,t,r){return e>=t&&e<=r||e>=r&&e<=t}function d(e,t){this.x=e,this.y=t,this.id="unknown",this.equals=function(e){return null!=e&&e.x==this.x&&e.y==this.y},this.toString=function(){return"("+parseInt(this.x)+" | "+parseInt(this.y)+")"},this.init=function(e){var t=e.substring(1,e.length-1).split("|");this.x=parseInt(t[0]),this.y=parseInt(t[1])},this.emphasizeDraw=function(e){e.beginPath(),e.arc(this.x,this.y,8,0,2*Math.PI,!0),e.closePath(),e.strokeStyle="#00aa00",e.stroke()},this.draw=function(e){e.beginPath(),e.arc(this.x,this.y,5,0,2*Math.PI,!0),e.closePath(),e.fillStyle="#0000ff",e.fill()},this.drawId=function(e){e.font="24px Courier New",e.fillStyle="orange",e.fillText(this.id,this.x,this.y)}}function f(e,t,r){this.id="t",this.isObstacle=!1,this.v1=e,this.v2=t,this.v3=r,this.max=e,this.min=e;var i=Math.min(e.x,t.x,r.x),n=Math.max(e.x,t.x,r.x),o=Math.min(e.y,t.y,r.y),a=Math.max(e.y,t.y,r.y);this.a1=u(t,e,r),this.a2=u(r,t,e),this.a3=Math.PI-this.a1-this.a2,this.maxAngle=Math.max(this.a1,this.a2,this.a3),this.isValid=this.maxAngle<xt;var s=new d(1,1);s.x=(this.v1.x/2+this.v2.x/2+this.v3.x)/2,s.y=(this.v1.y/2+this.v2.y/2+this.v3.y)/2,this.drawId=function(e){e.font="12px Courier New",e.fillStyle="red",e.fillText(this.id,s.x,s.y)},this.draw=function(i){this.isValid?this.isObstacle?(i.beginPath(),i.moveTo(e.x,e.y),i.lineTo(t.x,t.y),i.lineTo(r.x,r.y),i.lineTo(e.x,e.y),i.closePath(),i.fillStyle="#636363",i.fill()):(i.beginPath(),i.moveTo(e.x,e.y),i.lineTo(t.x,t.y),i.lineTo(r.x,r.y),i.lineTo(e.x,e.y),i.closePath(),i.strokeStyle="#ff0000",i.stroke()):(i.beginPath(),i.moveTo(e.x,e.y),i.lineTo(t.x,t.y),i.lineTo(r.x,r.y),i.lineTo(e.x,e.y),i.closePath(),i.fillStyle="#a3a3a3",i.fill())},this.contains=function(e){return!(!p(e.x,i,n)||!p(e.y,o,a))&&function(e,t){var r=h(e,t.v1,t.v2);if(r==Tt)return!0;if(r==Mt)return!1;var i=h(e,t.v2,t.v3);if(i==Tt)return!0;if(i==Mt)return!1;var n=h(e,t.v3,t.v1);return n==Tt||n!=Mt&&r==i&&i==n}(e,this)},this.toString=function(){return"("+e.id+", "+t.id+", "+r.id+")"},this.equals=function(e){return null!=e&&this.toString()==e.toString()}}function m(e){this.app=e.app,this.camera=this.app.camera,this.savedPosition=this.camera.position,this.savedTarget=this.camera.target,this.position=e.position,this.target=e.target,this.time=e.time}function g(e){this.app=e.app,this.scene=this.app.scene,this.vertices=e.vertices,this.pointColor=e.pointColor,this.lineColor=e.lineColor,this.regionColor=e.regionColor,this.id=e.id}function v(e){this.app=e.app,this.setParam(e),this.expandingCount=0,this.expandState=di.Normal}function y(e){this.app=e.app,this.node=e.node,this.oldPosition=e.position,this.oldScale=e.scale,this.oldRotation=e.rotation,this.position=this.node.position.clone(),this.scale=this.node.scale.clone(),this.rotation=this.node.rotation.clone()}function E(e){this.app=e.app,this.node=e.node,this.nodeParent=e.nodeParent,this.oldNodeParent=this.node.parent}function b(e){this.app=e.app,this.object=e.object,this.oldPosition=e.position,this.oldScale=e.scale,this.oldAngles=e.angles||e.offsetAngles,this.position=this.object.position,this.scale=this.object.scale,this.angles=this.object.angles}function x(e){this.app=e.app,this.object=e.object}function _(e){this.app=e.app,this.object=e.object,this.params=e.params}function w(e){return e===bi||e===xi}function T(e){var t=e.length;if(0===t)return".";var r,i=0,n=!1,o=e.charCodeAt(0);if(t>1)if(w(o))if(n=!0,w(e.charCodeAt(1))){for(var a=2,s=a;a<t&&!w(e.charCodeAt(a));++a);if(a<t&&a!==s){var l=e.slice(s,a);for(s=a;a<t&&w(e.charCodeAt(a));++a);if(a<t&&a!==s){for(s=a;a<t&&!w(e.charCodeAt(a));++a);if(a===t)return"//"+l+"/"+e.slice(s)+"/";a!==s&&(r="//"+l+"/"+e.slice(s,a),i=a)}}}else i=1;else(o>=gi&&o<=yi||o>=vi&&o<=Ei)&&e.charCodeAt(1)===wi&&(r=e.slice(0,2),i=2,t>2&&w(e.charCodeAt(2))&&(n=!0,i=3));else if(w(o))return"/";var c;return 0!==(c=i<t?function(e,t,r,i){for(var n,o="",a=0,s=-1,l=0,c=0;c<=e.length;++c){if(c<e.length)n=e.charCodeAt(c);else{if(i(n))break;n=bi}if(i(n)){if(s===c-1||1===l);else if(s!==c-1&&2===l){if(o.length<2||2!==a||o.charCodeAt(o.length-1)!==_i||o.charCodeAt(o.length-2)!==_i)if(o.length>2){var u=o.lastIndexOf(r);if(u!==o.length-1){-1===u?(o="",a=0):a=(o=o.slice(0,u)).length-1-o.lastIndexOf(r),s=c,l=0;continue}}else if(2===o.length||1===o.length){o="",a=0,s=c,l=0;continue}t&&(o.length>0?o+="/..":o="..",a=2)}else o.length>0?o+=r+e.slice(s+1,c):o=e.slice(s+1,c),a=c-s-1;s=c,l=0}else n===_i&&-1!==l?++l:l=-1}return o}(e.slice(i),!n,"/",w):"").length||n||(c="."),c.length>0&&w(e.charCodeAt(t-1))&&(c+="/"),void 0===r?n?c.length>0?"/"+c:"/":c.length>0?c:"":n?c.length>0?r+"/"+c:r+"/":c.length>0?r+c:r}function M(e){return"s"==e[e.length-1]}function R(e){var t=e;return G.isString(e)&&e.length>0&&"."==e[0]&&(t=e.substr(1)),t}function S(e){var t,r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=ki,o=Di[e];if(void 0!=o){if(i)return o;if(void 0!=(t=Ni[e])&&r)return t}t="",o="";for(var a=R(e).split("."),s=[],l=0;l<a.length;l++)l>0&&M(a[l-1])?s[l]=a[l]:o=o+"."+a[l];if(o=R(o),Di[e]=o,i)return o;if(n.hasOwnProperty(o)){a=n[o].split(".");for(var l=0,c=0;l<=a.length;l++,c++)r&&void 0!=s[c]&&(t=t+"."+s[c],c++),l<a.length&&(t=t+"."+a[l]);return t=R(t),r&&(Ni[e]=t),t}}function P(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(G.isString(t)&&""!=t){var i=t.split("."),n=e,o=i.length;if(r>0&&!isNaN(r)&&(o-=r),!(o<=0)){for(var a=0;a<o;a++){var s=i[a];if(a>0&&M(i[a-1])&&G.isArray(n)?n=n[s]:s&&(n=n[s]),void 0==n)return n}return n}}}function A(e,t,r){for(var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0,n=t,o=R(r).split("."),a="",s=0;s<o.length;s++){var l=o[s];if(G.isObject(n)&&l.length>0){if(M(l))n.hasOwnProperty(l)||(n[l]=[]);else if(s==o.length-1&&void 0!=i){n[l]=i;var c={};c[l]=0,L(e,R(a),n,c)}else n.hasOwnProperty(l)||(n[l]={});n=n[l]}else G.isArray(n)?l<n.length?n=n[l]:(n.length++,n[l]={},n=n[n.length-1],L(e,R(a+"."+l),n)):n=n[l];a=a+"."+l}return t}function C(e,t,r,i){var n=P(i,S(t,!1,!0));if(void 0!=n){var o=P(r,S(t));if(M(t)){if(!G.isArray(o))return;for(var a=0;a<o.length;a++)C(e,t+"."+a,r,i)}else if(G.isObject(n)){for(var s in n)if(void 0!=P(r,S(t+"."+s))){var l=P(e,t);l?void 0==l[s]&&C(e,t+"."+s,r,i):C(e,t+"."+s,r,i)}}else e=A(r,e,t,o);return e}}function L(e,t,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;G.isObject(r)&&(i?Object.keys(i).forEach(function(i){O(e,r,i,t)}):Object.keys(r).forEach(function(i){O(e,r,i,t)}))}function O(e,t,r,i){t[r];var n=P(e,S(i)),o=S(i+"."+r),a=o.substring(o.lastIndexOf(".")+1,o.length);Object.defineProperty(t,r,{enumerable:!0,configurable:!1,get:function(){return n[r]},set:function(e){n[a]=e}})}var H,F="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},I=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},k=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),D=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},N=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},j=Object.prototype.toString,U=function(e){return function(t){return j.call(t)=="[object "+e+"]"}},B=eval,V=function(e){return null===e?"null":void 0===e?"undefined":Object.prototype.toString.call(e).slice(8,-1)},z=null,q={RegExp:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(e){var t="";return t+=e.global?"g":"",t+=e.multiline?"m":"",t+=e.ignoreCase?"i":"",new RegExp(e.source,t)}),Date:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(e){return new Date(+e)}),Array:function(e,t,r,i){var n,o=[];for(n=0;n<e.length;n++)if(t)o[n]=e[n];else{if(-1!==z.indexOf(e[n]))continue;if(i&&e[n]){var a=i(e[n]);if(a){o[n]=a;continue}}var s=q[V(e[n])];s?(z.push(e[n]),o[n]=s(e[n],!1)):o[n]=e[n]}return o},Object:function(e,t,r,i){var n,o,a={};for(n in e)if(e.hasOwnProperty(n))if(t||r&&!r(n))a[n]=e[n];else{if(-1!==z.indexOf(e[n]))continue;if(i&&e[n]){var s=i(e[n],n);if(s){a[n]=s;continue}}(o=q[V(e[n])])?(z.push(e[n]),a[n]=o(e[n],!1,r,i)):a[n]=e[n]}return a}},G=(H={consoleWarnFunc:console.warn,consoleTimeFunc:console.time,consoleTimeEndFunc:console.timeEnd,isType:U,isArray:U("Array"),isObject:U("Object"),isString:U("String"),isNumber:U("Number"),isFunction:U("Function"),isRegExp:U("RegExp"),isUndefined:U("Undefined"),isBoolean:function(e){return"boolean"==typeof e},isDom:function(e){return"object"===(void 0===e?"undefined":F(e))&&"number"==typeof e.nodeType&&"object"===F(e.ownerDocument)},isNull:function(e){return void 0===e||null===e},isBlank:function(e){if(!G.isNull(e)&&G.isString(e))for(var t=0;t<e.length;t++)if(" "!=e[t]&&"\t"!=e[t])return!1;return!0},isEmptyObj:function(e){return"{}"==JSON.stringify(e)},isEmptyArray:function(e){return U("Array")(e)&&0==e.length},toLowerCase:function(e){return e?e.toLowerCase():""},objectKeysToLowerCase:function(e,t,r){var i,n,o,a,s,l,c,u;if(l=G.objectKeysToLowerCase,"undefined"===(c=void 0===t?"undefined":F(t))||null===t||0===t||!1===t)t=0;else if("object"===c){if(!(t instanceof l))throw new TypeError('Expected "deep" to be a special object')}else if(!0===t)t=1/0;else{if("number"!==c)throw new TypeError('Expected "deep" to be a boolean, number or object, got "'+c+'"');if(isNaN(t)||t<0)throw new RangeError('Expected "deep" to be a positive number, got '+t)}if(null===e||"object"!==(void 0===e?"undefined":F(e)))throw new TypeError('Expected "input" to be an object');if(c=void 0===r?"undefined":F(r),null!==r&&"undefined"!==c&&"function"!==c)throw new TypeError('Expected "filter" to be a function');if(r=r||null,o=Object.keys(e),a=o.length-1,s={},t){if("number"==typeof t)t=Object.seal(Object.create(l.prototype,{input:{value:[]},output:{value:[]},level:{value:-1,writable:!0},max:{value:t,writable:!1}}));else if(~(i=t.input.indexOf(e)))return t.output[i];for(t.level+=1,t.input.push(e),t.output.push(s),i=a+1;i--;)"object"===(void 0===(u=e[n=o[a-i]])?"undefined":F(u))&&u&&t.level<t.max&&(r?r(u):u.constructor===Object)&&(u=l(u,t,r)),s[n.toLowerCase()]=u;t.level-=1}else for(i=a+1;i--;)s[(n=o[a-i]).toLowerCase()]=e[n];return s},getObject:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return e[t]=e[t]||r,e[t]},getMapObject:function(e,t){return e[t]=e[t]||new Map,e[t]},getSetObject:function(e,t){return e[t]=e[t]||new Set,e[t]},generateUUID:function(e){return Math.generateUUID(e)},backupValue:function(e,t,r){if(void 0===e["_prev_"+t]){var i=e[t||r];return e["_prev_"+t]=i,i}return null},revertValue:function(e,t,r){var i=e["_prev_"+t];void 0!==i&&(e[r||t]=i,delete e["_prev_"+t])},getValue:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=e["_prev_"+t];return r&&delete e["_prev_"+t],i},setValue:function(e,t,r){G.backupValue(e,t),e[t]=r},cloneObject:function(e,t,r,i){z=[],t=void 0===t;var n=q[V(e)];return n?n(e,t,r,i):e},cloneArray:function(e){return e&&G.isArray(e)?e.concat():null},mergeObject:function(e,t,r){if(!t)return G.cloneObject(e);if(!G.isObject(t)||!G.isObject(e))return r?G.cloneObject(t):e;for(var i in t)if(t.hasOwnProperty(i)){var n=e[i],o=t[i];!G.isObject(o)||!G.isObject(n)||G.isArray(o)||G.isArray(n)||G.isDom(o)||G.isDom(n)?!r&&i in e||(e[i]=G.cloneObject(t[i],!0)):G.mergeObject(n,o,r)}return e},isEqual:function(e,t){for(var r in e){if(!t.hasOwnProperty(r))return!1;if(e[r]!=t[r])return!1}return!0},swapValue:function(e,t,r){var i=e[t];return e[t]=e[r],e[r]=i,e},parseValue:function(e,t){return G.isNull(e)?t:e},parseNumber3:function(e,t){return G.isArray(e)&&3===e.length?e.concat():t||[0,0,0]},parseVector2:function(e,t){if(e){if(e.isVector2)return e;if(G.isArray(e)){var r=e[0],i=e.length>1?e[1]:0;return new THREE.Vector2(r,i)}G.isString(e)&&console.log("parseVector2 not impl")}return t},parseVector3:function(e,t){if(e){if(e.isVector3)return e;if(G.isArray(e))return 1===e.length?new THREE.Vector3(e[0],0,0):2===e.length?new THREE.Vector3(e[0],0,e[1]):new THREE.Vector3(e[0],e[1],e[2]);if(G.isString(e)){for(var r=e.split(/,| /),i=0;i<r.length;i++){var n=r[i].trimBoth("\\[\\]");n.isBlank()?r.splice(i--,1):r[i]=Number(n)}return G.parseVector3(r,t)}}return t},parseVector4:function(e,t){if(e){if(e.isVector4)return e;if(G.isArray(e))return 1===e.length?new THREE.Vector4(e[0],0,0,1):2===e.length?new THREE.Vector4(e[0],0,e[1],1):3===e.length?new THREE.Vector4(e[0],e[1],e[2],1):new THREE.Vector4(e[0],e[1],e[2],e[3]);if(G.isString(e)){for(var r=e.split(/,| /),i=0;i<r.length;i++){var n=r[i].trimBoth("\\[\\]");n.isBlank()?r.splice(i--,1):r[i]=Number(n)}return G.parseVector4(r,t)}}return t},parseEuler:function(e){if(e.isEuler)return e;if(G.isArray(e)){(e.length<3||e.length>4)&&console.log("parseEuler not impl");var t=Math.degToRad(e[0]%360),r=Math.degToRad(e[1]%360),i=Math.degToRad(e[2]%360);if(3==e.length)return new THREE.Euler(t,r,i);if(4==e.length)return new THREE.Euler(t,r,i,e[3])}else{if(e instanceof THREE.Quaternion){var n=new THREE.Euler;return n.setFromQuaternion(e),n}console.log("parseEuler not impl")}},parseQuaternion:function(e){if(!e)return null;if(G.isArray(e))return new THREE.Quaternion(e[0],e[1],e[2],e[3]);var t=this.parseEuler(e),r=new THREE.Quaternion;return r.setFromEuler(t),r},parseAngles:function(e){if(e instanceof THREE.Euler)return[Math.radToDeg(e._x),Math.radToDeg(e._y),Math.radToDeg(e._z)];if(e instanceof THREE.Quaternion){var t=new THREE.Euler;return G.parseAngles(t.setFromQuaternion(e))}return e},parseCubeTextureUrls:function(e){if(this.isArray(e))return e;if(this.isString(e)){var t=null,r=(t=e.startsWith(".")?e:"skyboxes/"+e)+"/";return[r+"posx.jpg",r+"negx.jpg",r+"posy.jpg",r+"negy.jpg",r+"posz.jpg",r+"negz.jpg"]}return null},parseColor:function(e,t){if(!this.isNull(e)){if(e.isColor)return e;if(G.isArray(e))return new THREE.Color(e[0],e[1],e[2]);if(G.isNumber(e)){var r=new THREE.Color;return r.setHex(e),r}if(G.isString(e)){if(G.isBlank(e))return new THREE.Color(0,0,0);if("#"==e[0])return G.parseColor(parseInt(e.substr(1),16));if(e.startsWith("rgb(")){var i=e.substring(4).split(",");if(3===i.length){var n=Math.toInteger(i[0].trimBoth(" )")),o=Math.toInteger(i[1].trimBoth(" )")),a=Math.toInteger(i[2].trimBoth(" )"));return new THREE.Color(n/255,o/255,a/255)}}else if(!isNaN(e))return G.parseColor(Math.toInteger(e))}}return t},parseLoopType:function(e){return G.isNumber(e)?e:G.isBoolean(e)?e?THREE.LoopRepeat:THREE.Once:"pingpong"==e?THREE.LoopPingPong:"repeat"==e?THREE.LoopRepeat:THREE.LoopOnce},parseWrapType:function(e){return"repeat"==e?THREE.RepeatWrapping:"clamptoedge"==e?THREE.ClampToEdgeWrapping:"mirroredrepeat"==e?THREE.MirroredRepeatWrapping:null},parseSize:function(e){var t=e.width||1,r=e.height||1,i=e.size;return i?G.isNumber(i)&&(i=[i,i]):i=[t,r],i},parseLength:function(e){if(G.isString(e)){var t=e.search("px");return-1!=t&&(e=e.substring(0,t)),Math.toInteger(e)}return e},parseArrayArgument:function(e,t,r){var i=t[r];return G.isNull(i)?[]:G.isArray(i)?i.length!=e.length?(console.error(r+" array("+i.length+") not match to names("+e.length+")"),[]):i:[]},parseEvent:function(e,t,r,i,n){if(e){if(G.isFunction(e)&&G.isString(t)&&G.isBoolean(r))return{selector:null,userData:null,callback:e,tag:t};if(G.isFunction(e)&&G.isString(t)&&G.isNull(r)&&G.isNull(i))return{selector:null,userData:null,callback:e,tag:t};if(G.isFunction(e)&&G.isString(t)&&G.isNumber(r)&&G.isNull(i))return{selector:null,userData:null,callback:e,tag:t,priority:r};if(G.isFunction(e)&&G.isNumber(t)&&G.isNull(r)&&G.isNull(i))return{selector:null,userData:null,callback:e,tag:null,priority:t};if(G.isFunction(e)&&G.isNull(t)&&G.isNull(r)&&G.isNull(i))return{selector:null,userData:null,callback:e};if(G.isFunction(e)&&G.isBoolean(t)&&G.isNull(r)&&G.isNull(i))return{selector:null,userData:null,callback:e};if(G.isString(e)&&G.isFunction(t)&&G.isNull(r)&&G.isNull(i))return{selector:e,userData:null,callback:t};if(G.isString(e)&&G.isNull(t)&&G.isString(r)&&G.isNull(i))return{selector:e,userData:null,callback:null,tag:r};if(G.isString(e)&&G.isFunction(t)&&G.isString(r)&&G.isNull(i))return{selector:e,userData:null,callback:t,tag:r};if(G.isString(e)&&G.isFunction(t)&&G.isString(r)&&G.isNumber(i)&&G.isNull(n))return{selector:e,userData:null,callback:t,tag:r,priority:i};if(G.isString(e)&&G.isFunction(t)&&G.isNumber(r)&&G.isNull(i))return{selector:e,userData:null,callback:t,priority:r};if(G.isFunction(t)&&G.isNull(r))return{selector:null,userData:e,callback:t};if(G.isFunction(t)&&G.isString(r)&&G.isNull(i))return{selector:null,userData:e,callback:t,tag:r};if(G.isNull(t)&&G.isNull(r)&&G.isNull(i)&&G.isNull(n))return{selector:e,userData:null,callback:null,tag:null}}else{if(G.isFunction(t)&&!G.isFunction(r))return{selector:null,userData:null,callback:t};if(G.isNull(t)&&G.isString(r))return{selector:null,userData:null,callback:null,tag:r}}return e&&!G.isString(e)&&console.error("Event: selector is invalid"),r&&!G.isFunction(r)&&console.error("Event: callback is invalid"),i&&!G.isString(i)&&console.error("Event: tag is invalid"),G.isNull(n)&&(n=50),{selector:e,userData:t,callback:r,tag:i,priority:n}},parseFunction:function(e){return G.isFunction(e)?e:null},callFunction:function(e,t,r){var i=e.call(t,r);G.isBoolean(i)&&(r.__ret__=i),void 0===r.stopDefault&&Object.defineProperty(r,"stopDefault",{get:function(){return void 0!==this.__ret__&&!this.__ret__}})},getArrayArgumentValue:function(e,t,r,i){r.length&&(e[t]=r[i])},toMatrixElementsArray:function(e){return{_00:e.elements[0],_01:e.elements[1],_02:e.elements[2],_03:e.elements[3],_10:e.elements[4],_11:e.elements[5],_12:e.elements[6],_13:e.elements[7],_20:e.elements[8],_21:e.elements[9],_22:e.elements[10],_23:e.elements[11],_30:e.elements[12],_31:e.elements[13],_32:e.elements[14],_33:e.elements[15]}},elementsArrayToMatrix:function(e,t){e.elements[0]=t._00,e.elements[1]=t._01,e.elements[2]=t._02,e.elements[3]=t._03,e.elements[4]=t._10,e.elements[5]=t._11,e.elements[6]=t._12,e.elements[7]=t._13,e.elements[8]=t._20,e.elements[9]=t._21,e.elements[10]=t._22,e.elements[11]=t._23,e.elements[12]=t._30,e.elements[13]=t._31,e.elements[14]=t._32,e.elements[15]=t._33}},H.isEqual=function(e,t){return Math.abs(e-t)<1e-5},H.getLength=function(e){if(!G.isArray(e))return 0;for(var t=0,r=0;r<e.length-1;r++){var i=G.parseVector3(e[r]),n=G.parseVector3(e[r+1]);t+=i.distanceTo(n)}return t},H.getArrayIndexFromProgress=function(e,t,r){if(!e.length)return-1;if(t>=1)return e.length-1;if(!r){var i=1/e.length,n=Math.floor(t/i);return Math.min(n,e.length-1)}for(var o=0,a=0;a<r.length;a++){if(o+(i=r[a])>=t)return a;o+=i}},H.getArrayProgress=function(e,t,r){if(!e.length)return 0;if(t>=1)return 1;if(!r)return o=1/e.length,Math.fract(t/o);for(var i=0,n=0;n<r.length;n++){var o,a=i+(o=r[n])-t;if(a>=0)return 1-a/o;i+=o}},H.getConsumeTime=function(e,t,r,i,n,o){if(n){var a=G.parseVector3([t.x,t.y,t.z]),s=G.parseVector3([r.x,r.y,r.z]);return a.distanceTo(s)/n*1e3}return void 0!==i?e?i/e.length:i:o},H.hasAttribute=function(e,t){return null!=G.getAttribute(e,t)},H.getAttribute=function(e,t){if(e&&t){for(var r=t.split("/"),i=0;i<r.length;i++)if(!(e=e[r[i]]))return;return e}},H.setAttribute=function(e,t,r){if(!e||!t)return null;for(var i=t.split("/"),n=0;n<i.length;n++){if(t=i[n],n==i.length-1){e[t]=r;break}if(!(e=e[t]))return null}return r},H.add=function(e,t){return G.isArray(e)?-1===e.indexOf(t)&&e.push(t):e.add(t),t},H.remove=function(e,t){if(G.isArray(e)){var r=e.indexOf(t);-1!==r&&e.splice(r,1)}else e.delete(t)},H.dynamicLoad=function(e,t){function r(e){var t=e.lastIndexOf("."),r=e.substr(t+1);return"css"==r?"css":"js"==r?"js":""}function i(e,r){var i=document.getElementsByTagName("head")[0],n=document.createElement("link");n.type="text/css",n.rel="stylesheet",n.href=e,i.appendChild(n),n.onreadystatechange=function(){"complete"==css.readyState&&null!=r&&r()},n.onload=function(){null!=t&&r()}}function n(e,t){var r,i,n=document.getElementsByTagName("script");for(r=0,i=n.length;r<i;r++){var o=n[r];if(o){var a=o.getAttribute("src");a&&(a!=e&&-1==a.indexOf(e)||o.parentNode.removeChild(o))}}var s=-1==e.lastIndexOf("?")?e+"?time="+(new Date).getTime():e+"&time="+(new Date).getTime(),l=document.createElement("script");l.type="text/javascript",l.src=s,l.onload=function(){t&&t()},l.onreadystatechange=function(){"loaded"!=this.readyState&&"complete"!=this.readyState||t&&t()},document.getElementsByTagName("head")[0].appendChild(l)}function o(e,t){var r=null;if(window.XMLHttpRequest&&(r=new XMLHttpRequest),null!=r){r.onreadystatechange=function(){if(4==r.readyState)if(200==r.status){if(null!=t){var i=null;try{i=JSON.parse(r.responseText)}catch(e){i=r.responseText}c[e]=i,t(),r=null}}else console.log("Problem retrieving XML data:"+r.statusText),r=null};var i=-1==e.lastIndexOf("?")?e+"?time="+(new Date).getTime():e+"&time="+(new Date).getTime();r.open("GET",i,!0),r.send(null)}else console.error("Your browser does not support XMLHTTP.")}function a(){(l+=1)>=s&&t&&t(c)}"string"==typeof e&&(e=[e]);for(var s=e.length,l=0,c={},u=0;u<s;u++){var h=e[u],p=r(h);"js"==p?n(h,a):"css"==p?i(h,a):o(h,a)}},H.dynamicLoadJSON=function(e,t){this.dynamicLoad(e,t)},H.dynamicLoadJS=function(e,t){this.dynamicLoad(e,t)},H.dynamicLoadCSS=function(e,t){this.dynamicLoad(e,t)},H.addCastType=function(e,t,r){G.castTypes=G.castTypes||[],G.castTypes.push({type:e,condition:t,params:r}),G.evalTypes&&delete G.evalTypes[e],THING.factory.registerClass(e,G.evaluate(e))},H.removeCastType=function(e,t,r){G.castTypes=G.castTypes||[];for(var i=0;i<G.castTypes.length;i++){var n=G.castTypes[i];n.type==e&&n.condition==t&&(r&&n.params!=r||G.castTypes.splice(i--,1))}},H.getCastTypes=function(){return G.castTypes=G.castTypes||[],G.castTypes},H.runAsync=function(e){return new Promise(function(e){return setTimeout(e,10)}).then(function(){e()})},H.r=function(e,t){return Math.floor(Math.random()*(t-e+1)+e)},H.evaluate=function(e){if(!G.evalTypes){G.evalTypes={};for(var t=["BaseObject","Facade","Building","Floor","Room","Thing","Box","Sphere","Plane","Cylinder","Tetrahedron","Door","ElevatorDoor","Elevator","StairDoor","Stair","Line","PolygonLine","RouteLine","Water","WebView","Region","PolygonRegion","Marker","Campus"],r=0;r<t.length;r++){var i=t[r];G.evalTypes[i]=B("THING."+i)}}if(void 0!==G.evalTypes[e])return G.evalTypes[e];try{var n=B(e);return G.evalTypes[e]=n,n}catch(t){return G.evalTypes[e]=null,null}},H.instanceOf=function(e,t){var r=G.evaluate(t);if(!r)return!1;try{return e instanceof r}catch(e){return!1}},H);Object.defineProperties(G,{disableWarning:{get:function(){return console.warn!=G.consoleWarnFunc},set:function(e){console.warn=e?function(){}:G.consoleWarnFunc}},disableTime:{get:function(){return console.time!=G.consoleTimeFunc},set:function(e){e?(console.time=function(){},console.timeEnd=function(){}):(console.time=G.consoleTimeFunc,console.timeEnd=G.consoleTimeEndFunc)}}});var W=function(){function e(t){I(this,e),this.obj=t,this.node=t.node,this._renderOrder=0,this._opacity=1,this._color=null,this._outlineColor=null,this._alwaysOnTop=!1,this._wireframe=!1,this._image="",this._uvAnimationParams=null,this._boundingBoxResource=null,this._axisResource=null,this._defaultOutlineColor=null}return e.prototype.cloneMaterial=function(){this.node.traverse(function(e){var t=e.userData;if(!t.skipStyle){var r=e.material;if(r){if(t._prev_material)return;if(G.isArray(r)){t._prev_material=[],e.material=[];for(var i=0;i<r.length;i++)t._prev_material.push(r[i]),e.material.push(r[i].clone())}else t._prev_material=r,e.material=r.clone()}}})},e.prototype.getValue=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=e["_prev_"+t];return r&&delete e["_prev_"+t],i},e.prototype.revertMaterial=function(){this.node.traverse(function(e){if(!e.userData.skipStyle){var t=e.material;if(t){var r=e.userData._prev_material;r?(e.material=r,e.material.needsUpdate=!0,delete e.userData._prev_material):(G.revertValue(t,"opacity"),G.revertValue(t,"color"),G.revertValue(t,"depthTest"),G.revertValue(t,"depthWrite"),G.revertValue(t,"onBeforeRender"),G.revertValue(t,"wireframe"),G.revertValue(t,"wireframeMap","map"))}G.revertValue(e,"renderOrder")}})},e.prototype.isNeedRevertMaterials=function(e){return!this.isNeedCloneMaterials(e)&&!this.isNeedCloneMaterials({opacity:this._opacity,color:this._color,alwaysOnTop:this._alwaysOnTop,wireframe:this._wireframe})},e.prototype.isNeedCloneMaterials=function(e){var t=e.opacity,r=e.color,i=e.alwaysOnTop,n=e.wireframe;return!G.isNull(t)&&1!==t||!G.isNull(r)||!!i||!!n},e.prototype.setOpacity=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this._opacity!=e)if(this._opacity=G.isNull(e)?1:Math.clamp(e,0,1),this.obj.app.needUpdate=!0,t&&this.isNeedRevertMaterials({opacity:this._opacity}))this.revertMaterial();else{t&&this.isNeedCloneMaterials({opacity:this._opacity})&&this.cloneMaterial();var r=this;this.node.traverse(function(e){if(!e.userData.skipStyle){var t=e.material;if(t){G.backupValue(t,"opacity"),t.opacity=r._opacity,t.alphaTest&&G.backupValue(t,"alphaTest");var i=t._prev_alphaTest;i&&(t.alphaTest=i*r._opacity),t.transparent=!0}}}),this.obj.removePickingMaterial()}},e.prototype.setColor=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(null==e){if(null==this._color)return;this._color=e,t&&this.isNeedRevertMaterials({color:e})?this.revertMaterial():this.node.traverse(function(e){if(!e.userData.skipStyle){var t=e.material;t&&G.revertValue(t,"color")}})}else{if(e=new THREE.Color(e),this._color&&this._color.equals(e))return;this._color=e,t&&this.isNeedCloneMaterials({color:e})&&this.cloneMaterial(),this.node.traverse(function(t){if(!t.userData.skipStyle){var r=t.material;r&&(G.backupValue(r,"color"),r.color=e)}})}this.obj.app.needUpdate=!0},e.prototype.setOutlineColor=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=this.obj.app.rendererManager;G.isNull(e)?(this._outlineColor&&(r.removeOutline(this.node,this._outlineColor),this.node.traverse(function(e){e.layers.disable(1)}),this._outlineColor=null),this._defaultOutlineColor&&r.addOutline(this.node,this._defaultOutlineColor)):(this._outlineColor&&r.removeOutline(this.node,this._outlineColor),e=G.parseColor(e),this._outlineColor=e,r.addOutline(this.node,e),t&&(this.node.ensureParentsVisible(!0),this.node.visible=!0),this.node.traverse(function(e){e.isSprite||e.layers.enable(1)})),this.obj.app.needUpdate=!0},e.prototype._setAlwaysOnTop=function(e,t){if(t&&this.isNeedRevertMaterials({alwaysOnTop:this._alwaysOnTop})?this.revertMaterial():t&&this.isNeedCloneMaterials({alwaysOnTop:this._alwaysOnTop})&&this.cloneMaterial(),e){G.backupValue(this.node,"parent");var r=new THREE.MeshStandardMaterial({transparent:!0,opacity:1e-4});(n=new THREE.Mesh(new THREE.Geometry,r)).name="AlwaysOnTopRootMesh",n.userData=G.mergeObject({keepOutline:!0},this.node.userData),n.frustumCulled=!1,n.renderOrder=1e6,n.addBeforeRenderFunction("AlwaysOnTopRootMesh",function(e){e.clearDepth()}),this.node.parent.add(n),this.node.attach(n,this.obj.app.scene,!0),this.node.traverse(function(e){if(!e.userData.skipStyle){G.backupValue(e,"renderOrder");var t=e.material;t&&(G.backupValue(t,"transparent"),t.transparent=!0),e.renderOrder=10000001}}),this.obj.removePickingMaterial()}else{var i=this.getValue(this.node,"parent",!0),n=this.node.parent;n.removeBySelf(),i.add(this.node),this.node.traverse(function(e){if(!e.userData.skipStyle){G.revertValue(e,"renderOrder");var t=e.material;t&&G.revertValue(t,"transparent")}})}},e.prototype.setAlwaysOnTop=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._alwaysOnTop!=e&&(this._alwaysOnTop=e,this._setAlwaysOnTop(e,t),this.obj.app.needUpdate=!0)},e.prototype.setBoundingBox=function(e){e&&(this.obj.updateBounds(),null==this._boundingBoxResource&&(this._boundingBoxResource=new THREE.Box3Helper(this.obj._boundingBox,16777215),this._boundingBoxResource.name=this.obj.name+"_BoundingBox",this._boundingBoxResource.userData.skipBoundingBox=!0),this.obj.node.add(this._boundingBoxResource),this.obj.tickable=!0),this._boundingBoxResource&&(this._boundingBoxResource.visible=e)},e.prototype.setAxisHelper=function(e){if(e){if(null==this._axisResource){this._axisResource=new THREE.AxesHelper(this.obj.boundingBox.radius),this._axisResource.name=this.obj.name+"_Axis",this._axisResource.material.depthTest=!1;var t=new THREE.Vector3;this.obj.node.getWorldScale(t),this._axisResource.scale.set(1/t.x,1/t.y,1/t.z)}this.obj.node.add(this._axisResource)}this._axisResource&&(this._axisResource.visible=e)},e.prototype.setImage=function(e){if(G.isString(e)){var t=this.obj.app.confirmURL(e);if(this._image!=t){this._image=t;var r=new THREE.TextureLoader;r.setCrossOrigin("anonymous");var i=r.load(t);this.node.traverse(function(e){e.userData.skipStyle||e.material&&(e.material.map=i)}),this.obj.app.needUpdate=!0}}},e.prototype.flipOutlineColor=function(e){e=G.parseColor(e).getHex();var t=this.outlineColor;this.outlineColor=null==t||t!=e?e:null},e.prototype.setLightMap=function(e){var t=(e=e||{}).intensity||0,r=G.parseColor(e.color,new THREE.Color),i=e.image;i&&((i=(new THREE.TextureLoader).load(this.obj.app.confirmURL(i))).anisotropy=16),this.node.traverse(function(e){e.userData.skipStyle||e.material&&(e.material.lightMap=i,e.material.lightMapIntensity=t,e.material.color.copy(r),e.material.needsUpdate=!0)}),this.obj.app.needUpdate=!0},e.prototype.setMaterial=function(e){var t=this;if(e){var r=function(e,r){var i=G.parseColor(r.color);i&&e.color.copy(i);var n=r.image;if(n){(n=(new THREE.TextureLoader).load(t.obj.app.confirmURL(n))).anisotropy=16;var o=G.parseWrapType(r.wrap||r.wrapType);o&&(n.wrapT=o,n.wrapS=o),e.map=n}var a=r.envMap;if(null===a)e.envMap=null;else if(a){var s=this.app.confirmURL(G.parseCubeTextureUrls(value));e.envMap=(new THREE.CubeTextureLoader).load(s)}e.envMapIntensity=G.parseValue(r.envMapIntensity,e.envMapIntensity),e.side=G.parseValue(r.doubleSide,e.side),e.transparent=G.parseValue(r.transparent,e.transparent),e.opacity=G.parseValue(r.opacity,e.opacity);var l=G.parseColor(r.emissive);l&&e.emissive.copy(l),e.roughness=G.parseValue(r.roughness,e.roughness)},i=e.index;this.cloneMaterial(),this.node.traverse(function(t){var n=t.userData;if(!n.skipStyle&&t.material)if(n._prev_material||(n._prev_material=t.material),G.isArray(t.material))if(void 0!==i)i<t.material.length&&r(t.material[i],e);else for(var o=0;o<t.material.length;o++)r(t.material[o],e);else r(t.material,e)})}else this.revertMaterial();this.obj.app.needUpdate=!0},e.prototype.changeMaterial=function(e){e?this.node.traverse(function(t){var r=t.userData;if(!r.skipStyle){var i=t.material;if(i){var n=r._prev_material;n&&(G.isArray(i)?i.forEach(function(e){return e.dispose()}):i.dispose(),i=n),G.isArray(i)?(r._prev_material=[],t.material=[],i.forEach(function(i){r._prev_material.push(i),t.material.push(e(i,t))})):(r._prev_material=i,t.material=e(i,t))}}}):this.revertMaterial(),this.obj.app.needUpdate=!0},e.prototype.setPolygonOffset=function(e){e=e||{};var t=G.parseValue(e.polygonOffset,!1),r=G.parseValue(e.polygonOffsetFactor,0),i=G.parseValue(e.polygonOffsetUnits,0);this.node.traverse(function(e){if(!e.userData.skipStyle){var n=e.material;n&&(n.polygonOffset=t,n.polygonOffsetFactor=r,n.polygonOffsetUnits=i)}}),this.obj.app.needUpdate=!0},e.prototype.setWireframe=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._wireframe=e,e?(t&&this.isNeedCloneMaterials({wireframe:e})&&this.cloneMaterial(),this.node.traverse(function(e){if(!e.userData.skipStyle){var t=e.material;t&&(G.backupValue(t,"wireframe"),G.backupValue(t,"wireframeMap","map"),t.wireframe=!0,t.map=null)}})):this.isNeedRevertMaterials({wireframe:e})?this.revertMaterial():this.node.traverse(function(e){if(!e.userData.skipStyle){var t=e.material;t&&(G.revertValue(t,"wireframe"),G.revertValue(t,"wireframeMap","map"))}}),this.obj.app.needUpdate=!0},e.prototype.setRenderOrder=function(e){this._renderOrder=e,e?this.node.traverse(function(t){G.backupValue(t,"renderOrder"),t.renderOrder=e}):this.node.traverse(function(e){G.revertValue(e,"renderOrder")}),this.obj.app.needUpdate=!0},e.prototype.setUVAnimation=function(e){this._uvAnimationParams=e,this._uvAnimationParams&&(this.obj.tickable=!0,this._uvAnimationParams.wrapType=G.parseWrapType(this._uvAnimationParams.wrapType))},e.prototype.hasUVAnimation=function(){return!!this._uvAnimationParams},e.prototype.update=function(e){if(this._uvAnimationParams){for(var t=this._uvAnimationParams.offset,r=this._uvAnimationParams.repeat,i=this._uvAnimationParams.rotation,n=this._uvAnimationParams.wrapType,o=this.obj.node.getTextures(),a=0;a<o.length;a++){var s=o[a];t&&(s.offset.x+=t[0]*e,s.offset.y+=t[1]*e),i&&(s.rotation+=i*e,0!==i&&s.center.set(.5,.5)),r&&(s.repeat.x=r[0],s.repeat.y=r[1]),n&&(s.wrapS=n,s.wrapT=n)}return!0}return!1},k(e,[{key:"renderOrder",set:function(e){this.setRenderOrder(e)},get:function(){return this._renderOrder}},{key:"wireframe",set:function(e){this.setWireframe(e)},get:function(){return this._wireframe}},{key:"opacity",set:function(e){this.setOpacity(e)},get:function(){return this._opacity}},{key:"color",set:function(e){this.setColor(e)},get:function(){return null==this._color?null:this._color.toHexString()}},{key:"skipBoundingBox",set:function(e){this.obj.node.traverse(function(t){t.userData.skipBoundingBox=e})}},{key:"skipOutline",set:function(e){for(var t=0;t<this.obj.children.length;t++)this.obj.children[t].node.traverse(function(t){t.userData.skipStyle||t.isMesh&&(t.userData.skipOutline=e)})}},{key:"outlineColor",set:function(e){this.setOutlineColor(e)},get:function(){return null==this._outlineColor?null:this._outlineColor.toHexString()}},{key:"defaultOutlineColor",set:function(e){var t=G.parseColor(e);t?(this._defaultOutlineColor=t,this.outlineColor||this.obj.app.rendererManager.addOutline(this.node,t),this.obj.app.needUpdate=!0):(this._defaultOutlineColor=null,this._outlineColor||this._defaultOutlineColor||this.obj.app.rendererManager.removeOutline(this.node))},get:function(){return this._defaultOutlineColor}},{key:"axisHelper",set:function(e){this.setAxisHelper(e)},get:function(){return!!this._axisResource&&this._axisResource.visible}},{key:"boundingBox",set:function(e){this.setBoundingBox(e)},get:function(){return!!this._boundingBoxResource&&this._boundingBoxResource.visible}},{key:"boundingBoxColor",set:function(e){this.setBoundingBox(!0),this._boundingBoxResource&&(this._boundingBoxResource.material.color=G.parseColor(e))},get:function(){return this._boundingBoxResource?this._boundingBoxResource.material.color.toHexString():0}},{key:"alwaysOnTop",set:function(e){this.setAlwaysOnTop(e)},get:function(){return this._alwaysOnTop}},{key:"image",set:function(e){this.setImage(e)},get:function(){return this._image}}]),e}(),X=function(){function e(t,r){I(this,e),this.app=t,this.objects=r}return e.prototype._setAttribute=function(e,t){for(var r=0;r<this.objects.length;r++){var i=this.objects[r];i&&(i.style[e]=t)}},e.prototype.setMaterial=function(e){this.objects.forEach(function(t){t.style.setMaterial(e)})},k(e,[{key:"renderOrder",set:function(e){this._setAttribute("renderOrder",e)}},{key:"color",set:function(e){this._setAttribute("color",e)}},{key:"opacity",set:function(e){this._setAttribute("opacity",e)}},{key:"outlineColor",set:function(e){this._setAttribute("outlineColor",e)}},{key:"defaultOutlineColor",set:function(e){this._setAttribute("defaultOutlineColor",e)}},{key:"skipOutline",set:function(e){this._setAttribute("skipOutline",e)}},{key:"wireframe",set:function(e){this._setAttribute("wireframe",e)}},{key:"axisHelper",set:function(e){this._setAttribute("axisHelper",e)}},{key:"boundingBox",set:function(e){this._setAttribute("boundingBox",e)}},{key:"boundingBoxColor",set:function(e){this._setAttribute("boundingBoxColor",e)}},{key:"alwaysOnTop",set:function(e){this._setAttribute("alwaysOnTop",e)}}]),e}(),Y=function(){function e(t,r){I(this,e),this.objects=[],this.app=t,this.objectManager=t.objectManager,this.events=t.events,this.length=0,this.initObjectPool=r||this.objectManager.objects}return e.prototype.query=function(t){var r=new e(this.app,this.initObjectPool);return r.select(t,this.objects),r},e.prototype._getObjects=function(t){var r=null;if(t instanceof e)r=(i=t).objects;else if(G.isString(t)){var i=new e(this.app,this.initObjectPool);i.select(t),r=i.objects}else G.isArray(t)?r=t:t instanceof ye?r=[t]:console.error("selector.add unkown: "+t);return r},e.prototype.remove=function(e){if(!e)return this;var t=this._getObjects(e);if(!t)return this;for(var r=this.objects,i=0;i<r.length;i++)for(var n=0;n<t.length;n++)if(r[i]==t[n]){r.splice(i--,1);break}return this.buildReturnObject(r)},e.prototype.add=function(e){if(!e)return this;var t=this._getObjects(e);if(!t)return this;var r=this.objects.concat(t),i=Array.from(new Set(r));return this.buildReturnObject(i)},e.prototype.not=function(t){if(!t)return this;var r=null;if(t instanceof e)r=(i=t).objects;else if(G.isString(t)){var i=new e(this.app,this.initObjectPool);i.select(t),r=i.objects}else if(G.isArray(t))r=t;else{if(!(t instanceof ye))return console.error("selector.not unkown: "+t),this;r=[t]}for(var n=0;n<r.length;n++){var o=r[n],a=this.objects.indexOf(o);a>-1&&this.objects.splice(a,1)}var s=this.objects;return this.buildReturnObject(s)},e.prototype.parse=function(e,i,n){G.isString(e)?0==e.indexOf(".")?function(e,r,n){i.forEach(function(r){(r.type==e||G.instanceOf(r,e))&&t(n,r)})}(e.substring(1),0,n):0==e.indexOf("##")?r(e,i,n):0==e.indexOf("#")?(!function(e,r,i){if(-1!==e.search("#id")){e=e.replace("#","");var n=(new exprEval.Parser).parse(e);r.forEach(function(e){n.evaluate({id:e.id})&&t(i,e)})}else e=e.substring(1),r.forEach(function(r){r.id==e&&t(i,r)})}(e,i,n),n.length||(r("#"+e,i,n),n.length&&console.warn('[Selector] please use "##" to query object'))):0==e.indexOf("[")&&e.indexOf("]")==e.length-1?function(e,r,i){for(var n=null,o=["!=",">=","<=","=",">","<"],a=0;a<o.length;a++){var s=o[a];if(e.indexOf(s)>0){n=s;break}}if(null!=n){var l=e.split(n),c=l[0].trimBoth("\"' "),u=l[1].trimBoth("\"' ");r.forEach(function(e){var r=G.parseValue(e.userData[c],e.getAttribute(c));void 0!==r&&function(e,t,r){return"!="==r?e!=t:">="==r?e>=t:"<="==r?e<=t:"="==r?G.isString(t)&&t.indexOf("*")>0?(t=t.replace("*",""),e.indexOf(t)>=0):e==t:">"==r?e>t:"<"==r?e<t:void 0}(r,u,n)&&t(i,e)})}else{var h=e;r.forEach(function(e){(e.userData[h]||e.getAttribute(h))&&t(i,e)})}}(e.slice(1,e.length-1),i,n):"*"==e?function(e,r){i.forEach(function(e){t(r,e)})}(0,n):function(e,r,n){i.forEach(function(r){r.name==e&&t(n,r)})}(e,0,n):G.isRegExp(e)?function(e,r,n){i.forEach(function(r){e.test(r.name)&&t(n,r)})}(e,0,n):G.isFunction(e)&&function(e,r,n){i.forEach(function(r){e(r)&&t(n,r)})}(e,0,n)},e.prototype.queryResult=function(e,t){e=e||{},t=t||this.initObjectPool;var r=[];if(G.isFunction(e.split)){for(var i=e.split("|"),n=0;n<i.length;n++){var o=i[n].trim();o&&this.parse(o,t,r)}i.length>1&&(r=Array.from(new Set(r)))}else this.parse(e,t,r);return r},e.prototype.select=function(e,t){var r=this.queryResult(e,t);return this.buildReturnObject(r)},e.prototype.buildReturnObject=function(t){this.clear(),(t=t||[])instanceof e&&(t=t.toArray()),this.objects=t,this.length=t.length;for(var r=0;r<t.length;r++)this[r]=t[r];return this},e.prototype.clear=function(){for(var e=0;e<this.length;e++)delete this[e];this.objects=[],this.length=0},e.prototype.forEach=function(e){if(e)for(var t=0;t<this.objects.length;t++){var r=this.objects[t];if(r&&!1===e(r))break}},e.prototype.toJSON=function(){return JSON.stringify(this.objects)},e.prototype.toArray=function(){return this.objects},e.prototype.indexOf=function(e){return this.objects.indexOf(e)},e.prototype.splice=function(e,t){this.objects.splice(e,t),this.length=this.objects.length},e.prototype.reverse=function(){var t=this.objects.reverse(),r=new e(this.app,t);return r.buildReturnObject(t),r},e.prototype.has=function(e){return-1!==this.objects.indexOf(e)},e.prototype.setOpacity=function(e){for(var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=0;r<this.objects.length;r++){var i=this.objects[r];i&&i.style.setOpacity(e,t)}},e.prototype.flipVisible=function(){for(var e=0;e<this.objects.length;e++){var t=this.objects[e];t&&(t.visible=!t.visible)}},e.prototype.fadeIn=function(e){for(var t=0;t<this.objects.length;t++){var r=this.objects[t];r&&r.fadeIn(e)}},e.prototype.fadeOut=function(e){for(var t=0;t<this.objects.length;t++){var r=this.objects[t];r&&r.fadeOut(e)}},e.prototype.destroyAll=function(){for(var e=0;e<this.objects.length;e++){var t=this.objects[e];t&&t.destroy()}this.clear()},e.prototype.on=function(e,t,r,i,n){this.events.bindCallObj(e,t,r,i,this.objects,n)},e.prototype.off=function(e,t,r){this.events.unbindCallObj(e,t,r,this.objects)},e.prototype.one=function(e,t,r,i,n){this.events.bindCallObj(e,t,r,i,this.objects,n,!0)},e.prototype.trigger=function(e,t,r){for(var i=0;i<this.objects.length;i++)this.objects[i].trigger(e,t,r)},e.prototype.pauseEvent=function(e,t,r){for(var i=0;i<this.objects.length;i++)this.objects[i].pauseEvent(e,t,r)},e.prototype.pauseEventInFrame=function(e,t,r){for(var i=0;i<this.objects.length;i++)this.objects[i].pauseEventInFrame(e,t,r)},e.prototype.resumeEvent=function(e,t,r){for(var i=0;i<this.objects.length;i++)this.objects[i].resumeEvent(e,t,r)},e.prototype.destroy=function(){console.warn("[Selector] Please use '.destroyAll()' to replace '.destroy()'"),this.destroyAll()},e.prototype.showBoundingBox=function(e){console.warn("[Selector] Please use '.style.boundingBox=' to replace '.showBoundingBox()'"),this.style.boundingBox=e},k(e,[{key:"visible",set:function(e){for(var t=0;t<this.objects.length;t++){var r=this.objects[t];r&&(r.visible=e)}}},{key:"pickable",set:function(e){for(var t=0;t<this.objects.length;t++){var r=this.objects[t];r&&(r.pickable=e)}}},{key:"style",get:function(){return new X(this.app,this.objects)}},{key:"opacity",set:function(e){console.warn("[Selector] Please use '.style.opacity=' to replace '.opacity'"),this.style.opacity=e}}]),e}(),Q=function(){function e(){I(this,e),this._flags=0}return e.prototype.setFlags=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:16777215;this._flags=e},e.prototype.clearFlags=function(){this._flags=0},e.prototype.enableFlags=function(e,t){var r=this._flags;return t?this._flags|=e:this._flags&=~e,r!=this._flags},e.prototype.hasFlags=function(e){return!!(this._flags&e)},e.prototype.hasAnyFlags=function(){return 0!==this._flags},e}(),J={Vector3:THREE.Vector3,randomVector3:function(){if(1==arguments.length){var e=THREE.Math.randFloat(-range,range),t=THREE.Math.randFloat(-range,range),r=THREE.Math.randFloat(-range,range);return new THREE.Vector3(e,t,r)}if(3==arguments.length){var i=arguments[0],n=arguments[1],o=arguments[2],e=THREE.Math.randFloat(-i,i),t=THREE.Math.randFloat(-n,n),r=THREE.Math.randFloat(-o,o);return new THREE.Vector3(e,t,r)}},directionFromAlphaBeta:function(e,t,r){var i=e/180*Math.PI+Math.PI/2,n=-t/180*Math.PI+Math.PI/2,o=r||new THREE.Vector3,a=Math.sin(i);return o.x=a*Math.cos(n),o.y=-Math.cos(i),o.z=a*Math.sin(n),o}},K=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new TextEncoderLite("utf-8").encode("bai@3$%218%^$%^~)((&0!?<kjh");if(!(this instanceof e))return new e(t);var r,i,n=[],o=0;for(r=0;r<256;r++)n[r]=r;for(r=0;r<256;r++)o=(o+n[r]+t[r%t.length])%256,i=n[r],n[r]=n[o],n[o]=i;this._s=n,this._i=0,this._j=0};K.prototype.update=function(e){var t=e;if(G.isType("String")(e)&&(t=new TextEncoderLite("utf-8").encode(e)),G.isType("Array")(e)&&(t=new Uint8Array(e)),!G.isType("Uint8Array")(t))return null;var r,i,n,o=t.length,a=new Uint8Array(o),s=G.cloneObject(this._i),l=G.cloneObject(this._j),c=G.cloneObject(this._s);for(n=0;n<o;n++)i=c[l=(l+(r=c[s=(s+1)%256]))%256],c[s]=i,c[l]=r,a[n]=t[n]^c[(r+i)%256];return a},K.prototype.toStr=function(e){return G.isType("Uint8Array")(e)?new TextDecoderLite("utf-8").decode(e):null};var Z=new K,$={Level:"info",Log:function(e){this.Level in{info:0}&&console.info(e)},Error:function(e){this.Level in{info:0,error:0}&&console.error(e)},Debug:function(e){this.Level in{debug:0,error:0}&&console.info(e)}},ee={KEY_ERROR:"No Key Or Key Error",NO_EL_ERROR:"No div id",READ_ONLY_ERROR:"read only",SCENE_FILE_NOT_FOUND:"scene.json not found"},te={click:!0,dblclick:!0,singleclick:!0,mouseover:!0,mouseout:!0,mouseup:!0,mousedown:!0,mousemove:!0,mouseenter:!0,mouseleave:!0,mouseon:!0,mouseoff:!0},re={dragstart:!0,drag:!0,dragend:!0},ie={keydown:!0,keypress:!0,keyup:!0},ne={Perspective:"perspective",Orthographic:"orthographic"},oe={Normal:"normal",TopView:"topview",LeftView:"leftview",RightView:"rightview",FrontView:"frontview",BackView:"backview"},ae={Linear:{None:TWEEN.Easing.Linear.None},Quadratic:{In:TWEEN.Easing.Quadratic.In,Out:TWEEN.Easing.Quadratic.Out,InOut:TWEEN.Easing.Quadratic.InOut},Cubic:{In:TWEEN.Easing.Cubic.In,Out:TWEEN.Easing.Cubic.Out,InOut:TWEEN.Easing.Cubic.InOut},Quartic:{In:TWEEN.Easing.Quartic.In,Out:TWEEN.Easing.Quartic.Out,InOut:TWEEN.Easing.Quartic.InOut},Quintic:{In:TWEEN.Easing.Quintic.In,Out:TWEEN.Easing.Quintic.Out,InOut:TWEEN.Easing.Quintic.InOut},Sinusoidal:{In:TWEEN.Easing.Sinusoidal.In,Out:TWEEN.Easing.Sinusoidal.Out,InOut:TWEEN.Easing.Sinusoidal.InOut},Exponential:{In:TWEEN.Easing.Exponential.In,Out:TWEEN.Easing.Exponential.Out,InOut:TWEEN.Easing.Exponential.InOut},Circular:{In:TWEEN.Easing.Circular.In,Out:TWEEN.Easing.Circular.Out,InOut:TWEEN.Easing.Circular.InOut},Elastic:{In:TWEEN.Easing.Elastic.In,Out:TWEEN.Easing.Elastic.Out,InOut:TWEEN.Easing.Elastic.InOut},Back:{In:TWEEN.Easing.Back.In,Out:TWEEN.Easing.Back.Out,InOut:TWEEN.Easing.Back.InOut},Bounce:{In:TWEEN.Easing.Bounce.In,Out:TWEEN.Easing.Bounce.Out,InOut:TWEEN.Easing.Bounce.InOut}},se={LeftTop:0,RightTop:1,LeftBottom:2,RightBottom:3},le={Self:"self",Local:"local",World:"world"},ce={No:THREE.NoBlending,Normal:THREE.NormalBlending,Additive:THREE.AdditiveBlending,Subtractive:THREE.SubtractiveBlending,Multiply:THREE.MultiplyBlending,Custom:THREE.CustomBlending},ue={No:"no",Dragging:"dragging",DragEnd:"dragend"},he={No:"no",Repeat:"repeat",PingPong:"pingpong"},pe={Auto:1,RealTime:2,NotRealTime:3},de={Position:1,Rotation:2,Scale:4,Transform:7},fe={Unknown:"",Campus:"Campus",Building:"Building",Floor:"Floor",Room:"Room",Thing:"Thing"},me={Backspace:8,Tab:9,Enter:13,Shift:16,Ctrl:17,Alt:18,Pause:19,Capslock:20,Escape:27,PageUp:33,PageDown:34,End:35,Home:36,Left:37,Up:38,Right:39,Down:40,Insert:45,Delete:46,Key0:48,Key1:49,Key2:50,Key3:51,Key4:52,Key5:53,Key6:54,Key7:55,Key8:56,Key9:57,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,Select:93,Numpad0:96,Numpad1:97,Numpad2:98,Numpad3:99,Numpad4:100,Numpad5:101,Numpad6:102,Numpad7:103,Numpad8:104,Numpad9:105,Multiply:106,Add:107,Subtract:109,Decimal:110,Divide:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,Numlock:144,Scrolllock:145,Semicolon:186,EqualSign:187,Comma:188,Dash:189,Period:190,ForwardSlash:191,GraveAccent:192,OpenBracket:219,BackSlash:220,CloseBraket:221,SingleQuote:222},ge={Default:"__default__",LevelSetBackground:"__level_set_background__",LevelSceneOperations:"__level_scene_operations__",LevelPickedResultFunc:"__level_picked_result_func__",LevelFly:"__level_fly__",LevelFlyBreak:"__level_fly_break__",LevelPickMethod:"__level_pick_method__",LevelEnterMethod:"__level_enter_method__",LevelBackMethod:"__level_back_method__"},ve={Complete:"complete",Resize:"resize",Update:"update",Progress:"progress",BeforeLoad:"beforeload",Load:"load",Unload:"unload",Click:"click",DBLClick:"dblclick",SingleClick:"singleclick",MouseUp:"mouseup",MouseDown:"mousedown",MouseMove:"mousemove",MouseWheel:"mousewheel",MouseEnter:"mouseenter",MouseOver:"mouseover",MouseLeave:"mouseleave",DragStart:"dragstart",Drag:"drag",DragEnd:"dragend",KeyDown:"keydown",KeyPress:"keypress",KeyUp:"keyup",CameraChangeStart:"camerachangestart",CameraChangeEnd:"camerachangeend",CameraChange:"camerachange",CameraZoom:"camerazoom",CameraViewChange:"cameraviewchange",Create:"create",Destroy:"destroy",Expand:"expand",Unexpand:"unexpand",Pick:"pick",Unpick:"unpick",PickChange:"pickchange",AreaPickStart:"areapickstart",AreaPicking:"areapicking",AreaPickEnd:"areapickend",Select:"select",Deselect:"deselect",SelectionChange:"selectionchange",LevelChange:"levelChange",EnterLevel:"enterLevel",LeaveLevel:"leaveLevel",AppComplete:"complete",LoadCampusProgress:"progress",LoadCampus:"load",UnloadCampus:"unload",PickObject:"pick",Dragging:"drag",CreateObject:"create",DestroyObject:"destroy",ExpandBuilding:"expand",UnexpandBuilding:"unexpand",SelectObject:"select",DeselectObject:"deselect",ObjectSelectionChanged:"selectionchange",PickedObjectChanged:"pickchange",BeforeLevelChange:"beforelevelchange"},ye=function(){function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;I(this,e),this.app=t,this._id="",this._name="",this._uuid="",this._queryid=Math.generateUUID(),this._parent=i,this.children=[],this.node=r||new THREE.Group,this._lodNode=null,this._style=null,this._box=null,this._boundingBox=null,this._boxSize=null,this._boxRadius=0,this._boxCenter=null,this._initBoxSize=null,this._pivot=null,this._grid=null,this._dragState=ue.No,this.isDraggable=!1,this.isTickable=!1,this._catchEventAnyTime=!1,this._pickable=!0,this._lookingAtObject=null,this._dirtyFlags=new Q,this._independentControlFlags=new Q,this._renderDistance=null,this._shadowDistance=null,this._localClippingPlaneBase=null,this._localClippingPlane=null,this._lockedOffset=[],this._independentPosition=null,this._independentWorldAngles=null,this._independentWorldScale=null,this.scaling=!1,this.scaleTween=null,this.rotating=!1,this.rotateTween=null,this.fadeTween=null,this.pathTween=null,this.pathTweens=[],this._attachPoints=null,this._controls=[],this.waitCommands=[],this.loaded=!1,this._internalUserData={},this._userData={},this._tags=[],this.initStaticMembers()}return e.prototype.initStaticMembers=function(){e.hasStaticMembers||(e.hasStaticMembers=!0,e.boundingBoxDirtyFlag=1)},e.prototype.setUserDataFlag=function(e,t){t?this.node.traverse(function(t){t.userData[e]=!0}):this.node.traverse(function(t){delete t.userData[e]})},e.prototype.setupEffects=function(){this.app.isMobileDevice?this.node.traverse(function(e){e.material&&(e.material.needsUpdate=!0),e.isMesh&&(e.castShadow=!1,e.receiveShadow=!1),e.material&&e.material.map&&(e.material.map.anisotropy=1,e.material.map.needsUpdate=!0)}):this.node.traverse(function(e){e.material&&(e.material.needsUpdate=!0),e.isMesh&&(e.castShadow=!0,e.receiveShadow=!0),e.material&&e.material.map&&(e.material.map.anisotropy=16,e.material.map.needsUpdate=!0)})},e.prototype.setupUserData=function(){var e=this.node.userData;if(e.isBaseObject=!0,e.id=this._queryid,void 0===e.object){var t=this;Object.defineProperties(e,{object:{get:function(){return t.app.objectManager.get(t.queryID)}}})}},e.prototype.setupNode=function(e){e.updateMatrixWorld(!0);var t=e.parent;this.node.updateMatrix();var r=this.node.matrix.clone();r.multiply(e.matrix),t&&e._detach(t,this.app.scene),THREE.SceneUtils.attach(e,this.app.scene,this.node),this.node.identity(),this.node.applyMatrix(r),e.identity(),e instanceof THREE.LOD&&(this._lodNode=e,this.tickable=!0),e.visible||(e.ensureVisible(!0,!0),e.ensureVisible(!1,!1),this.visible=!1)},e.prototype.setupCommonInfo=function(e){this._id=e.id||"",this._name=e.name||"",this._uuid=e.uuid||"",this._id=this._id||this._uuid||this._name,this._name=this._name||this._id,this._id||this._uuid||(this._id=Math.generateUUID()),this.visible=G.parseValue(e.visible,this.visible),this._internalUserData=e.internalUserData||this._internalUserData},e.prototype.setupTranslation=function(e){var t=e.position;t&&(this.position=t);var r=e.localPosition,i=G.parseValue(e.ignoreParentScale,!1);r&&this.setLocalPosition(r,i);var n=e.angle;if(n)this.angles=[0,n,0];else{var o=e.angles||e.localAngles;o&&(this.angles=o)}var a=e.scale;a&&(this.scale=a)},e.prototype.setupEnvMap=function(e){var t=this.getEnvMapResources();t&&(e||this.isOutdoors?t.outdoorsEnvMap&&this.node.traverse(function(e){!e.userData.skipEnvMap&&e.material&&"envMap"in e.material&&(e.material.envMap=t.outdoorsEnvMap,e.material.envMapIntensity=1.3)}):t.indoorsEnvMap&&this.node.traverse(function(e){!e.userData.skipEnvMap&&e.material&&"envMap"in e.material&&(e.material.envMap=t.indoorsEnvMap,e.material.envMapIntensity=1.3)}))},e.prototype.setupBounds=function(e){var t=e.initSize;t&&(this._initBoxSize=t.concat())},e.prototype.loadFromURL=function(e,t){t&&t()},e.prototype.setupFromURL=function(e){if(e.node)this._setup(e);else{var t=this;this.loadFromURL(e,function(){t._setup(e)})}},e.prototype.setupFromData=function(e){console.error('[BaseObject] inherited class should impl "setupFromData(param)" interface'),this._setup(e)},e.prototype._setup=function(e){this._userData=e.properties||e.userData||{},this._tags=e.tags||[],this.setupUserData();var t=e.node;t&&this.setupNode(t),this.setupParent(e),this.customSetup(e),this.setupComplete(e)},e.prototype.setup=function(e){this.setupCommonInfo(e);var t=e.url,r=e.data;t?(e.url=this.app.confirmURL(t)._trimRight("/"),this.setupFromURL(e)):r?this.setupFromData(e):this._setup(e)},e.prototype.setupStyle=function(e){var t=e.style;if(t)for(var r in t)void 0!==this.style[r]&&(this.style[r]=t[r])},e.prototype.setupCommands=function(e){var t=this.waitCommands;t.push({type:"SetObjectStyle",object:this}),this.app.commandManager.create(t).execute(),this.waitCommands=[]},e.prototype.setupInheritAttributes=function(e){var t=G.parseValue(e.inheritPosition,!0),r=G.parseValue(e.inheritAngles,!0),i=G.parseValue(e.inheritScale,!0);t&&r&&i||this.node.updateMatrixWorld(),this.inheritPosition=t,this.inheritAngles=r,this.inheritScale=i},e.prototype.setupParent=function(t){if(!t.independent){var r=t.parent;r instanceof e?this._parent=r:r&&console.error("[BaseObject] Please make sure parent is BaseObject"),null==this._parent&&void 0===r&&(this._parent=this.app.level.currentParentObject,this._parent||(this._parent=this.app.outdoors)),this._parent&&this.attachToParent(t)}},e.prototype.attachToParent=function(e){if(this.node&&null==this.node.parent){e.attachToParent?THREE.SceneUtils.attach(this.node,this.app.scene,this._parent.node):this._parent.node.add(this.node)}this._parent._add(this,e,-1)},e.prototype.customSetup=function(e){},e.prototype.setupComplete=function(e){this.dirty=!0,this.loaded=!0,this._userData=this._userData||{},this._internalUserData=this._internalUserData||{},this.setupEffects(),this.setupEnvMap(),this.setupTranslation(e),this.setupInheritAttributes(e),this.setupBounds(e),this.setupStyle(e),this.setupCommands(e),this.trigger("load",{object:this}),this.trigger("complete",{object:this});var t=e.successCallback||e.complete;t&&t.call(this,{object:this}),this.node.updateWorldMatrix(!1,!1),this.selfUpdate()},e.prototype.setParent=function(e,t,r){var i=this._parent;if(i!=e&&(i&&i.remove(this,!1),this._parent=e),e){var n=e.node;t?n&&n.add(this.node):this.node.attach(n,this.app.scene,r)}},e.prototype.synTickableObject=function(){this.isTickable?this.app.resourceManager.addTickableObject(this):this.app.resourceManager.removeTickableObject(this)},e.prototype._setDirtyFlag=function(){for(var e=this;e;e=e.parent)e._dirtyFlags.setFlags()},e.prototype.getChildByPath=function(e,t){var r=e.search("/");if(-1!==r)r=e.substring(0,r),e=e.substring(r.length+1);else if(r=e,t){if(t(this,r))return this}else if(this._id==r)return this;for(var i=0;i<this.children.length;i++){var n=this.children[i],o=null;if(t?t(n,r)&&(o=n):n.id==r&&(o=n),o){var a=o.getChildByPath(e);if(a)return a}}return null},e.prototype._getBasePointNode=function(e){var t=this.node.traverseBreakable(function(t){return t.name.contains(e)});return t||(t=this.node.traverseBreakable(function(t){return t.name==e})),t},e.prototype._addFromCampus=function(e){},e.prototype.add=function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;if((t=t||{})instanceof e)this._add(t,null,r);else{var i=t.url;if(G.isString(i)){var n=t.position||this.position,o=t.angles||t.localAngles||this.angles,a=G.parseValue(t.isCamFitScene,!1),s=t.complete,l=this;this.app.create({type:"Campus",url:i,position:n,angles:o,isCamFitScene:a,complete:function(e){var t=e.object;l._addFromCampus(t),t.destroy(),l.dirty=!0,s&&s(),this.app.trigger("addFromCampusComplete")}})}else{var c=t.object;G.isNull(c)||this._add(c,t,r)}}},e.prototype._add=function(t,r,i){if(!t)return!1;if(!(t instanceof e))return!1;var n=(r=r||{}).basePoint,o=r.offset||r.localPosition,a=r.angles||r.localAngles;if(G.parseValue(r.keepNode,!1)){var s=t.parent;if(s){var l=s.children.indexOf(t);-1!==l&&s.children.splice(l,1)}t._parent=this}else{var c=G.parseValue(r.keepLocalPosition,!1),u=G.parseValue(r.force||r.position||r.angles||r.scale,!1);t.setParent(this,c,u)}var h=void 0;if(G.isString(n)){if(!(h=this._getBasePointNode(n)))return console.error("The '"+n+"' basePoint is not existing"),!1;var p=new THREE.Vector3;h.getWorldPosition(p),t.position=p.toArray(),o&&(t.position=Math.addVector3(t.position,o))}else o&&(t.localPosition=o);return a&&(t.angles=a),t.dirty=!0,this._setDirtyFlag(),this.hasChild(t)||(i>=this.children.length||-1===i?this.children.push(t):this.children.splice(i,0,t)),h&&t.node.attach(h,!0),t.node.userData.removedNode&&(t.node.visible=!0,delete t.node.userData.removedNode),!0},e.prototype.remove=function(t){var r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!G.isNull(t)&&t instanceof e&&t.isChildOf(this)){t.dirty=!0,this._setDirtyFlag(),t.node.updateWorldMatrix(!0,!1),-1!==t.node.getParents().indexOf(this.app.scene)&&(t.node.attach(this.app.scene,!1),r&&(t.node.visible=!1,t.node.userData.removedNode=!0)),t._parent=null;var i=this.children.indexOf(t);-1!==i&&this.children.splice(i,1)}},e.prototype.swapChild=function(e,t){var r=this.children.indexOf(e),i=this.children.indexOf(t);-1!==r&&-1!==i&&Math.swapArray(this.children,r,i)},e.prototype.hasChild=function(e){if(!e)return!!this.children.length;for(var t=0;t<this.children.length;t++)if(this.children[t]==e)return!0;return!1},e.prototype.destroy=function(){this.removePickingMaterial(),this.tickable=!1,this.removeAllControls(),this.app.objectManager.destroy(this);for(var e=this.children.concat(),t=0;t<e.length;t++)e[t].destroy();this.children=[],this.clearAttachPoints(),this.clearNode(),this._parent&&(this._parent.remove(this),this._parent=null),this.node.parent&&this.node.parent.remove(this.node),this.app.events.unbindCallObj(null,null,null,[this]),this._lodNode=null,this._queryid=""},e.prototype.getRaycastPosition=function(e){if(!e)return null;var t=new THREE.Raycaster;t.ray.origin=G.parseVector3(this.position),t.ray.direction=G.parseVector3(e);var r=t.intersectObject(this.app.scene,!0);if(!r.length)return null;for(var i=0;i<r.length;i++){var n=r[i],o=n.object;if(this.app.objectManager.getAncestors(o)&&!o.isChildOf(this.node))return n.point.toArray()}return null},e.prototype.removePickingMaterial=function(){this.app.picker.removePickingMaterial(this.node)},e.prototype.synPickable=function(){var e=this._pickable;this.node.pickable(e);for(var t=0;t<this.children.length;t++)this.children[t].pickable=e;this.removePickingMaterial()},e.prototype.worldToSelf=function(e){var t=G.parseVector3(e);return this.node.worldToLocal(t).toArray()},e.prototype.selfToWorld=function(e){return e=G.parseVector3(e),this.node.updateMatrixWorld(),this.node.localToWorld(e).toArray()},e.prototype.localToWorld=function(e){return this._parent?this._parent.selfToWorld(e):this.node.localToWorld(G.parseVector3(e)).toArray()},e.prototype.worldToLocal=function(e){if(this._parent)return this._parent.worldToSelf(e);var t=G.parseVector3(e);return this.node.worldToLocal(t).toArray()},e.prototype.distanceTo=function(t){return t?(t instanceof e&&(t=t.position),G.parseVector3(this.position).distanceTo(G.parseVector3(t))):0},e.prototype.lookAt=function(t,r){if(this._lookingAtObject=null,t){if(this._lookingAtObject={target:t},(t instanceof e||G.isArray(t))&&r){var i=G.parseEuler(r),n=new THREE.Quaternion;n.setFromEuler(i),this._lookingAtObject.quat=n}this.tickable=!0}this.selfUpdate()},e.prototype.rotate=function(e,t){var r=Math.degToRad(e);(t=G.parseVector3(t||[0,1,0])).normalize(),this.node.rotateOnAxis(t,r),this.synIndependentWorldAngles(),this.dirty=!0},e.prototype.rotateX=function(e){if(!isNaN(e)){var t=this.angles;this.angles=[t[0]+e,t[1],t[2]]}},e.prototype.rotateY=function(e){if(!isNaN(e)){var t=this.angles;this.angles=[t[0],t[1]+e,t[2]]}},e.prototype.rotateZ=function(e){if(!isNaN(e)){var t=this.angles;this.angles=[t[0],t[1],t[2]+e]}},e.prototype.rotateAround=function(t){var r=(t=t||{}).object,i=t.target,n=t.yRotateAngle,o=t.xRotateAngle||t.angle,a=t.time,s=t.speed||10,l=G.parseLoopType(t.loopType),c=t.stop,u=t.update,h=t.complete;i instanceof e?(r=i,i=null):i=G.parseVector3(i);var p=G.parseVector3(this.position),d=new THREE.Spherical,f=p.clone(),m=i||G.parseVector3(r.position);f.sub(m),d.setFromVector3(f),this.stopRotating(),this.rotating=!0;var g=this.position,v=new THREE.Vector3,y={theta:d.theta,phi:d.phi,neg:!1};a?s=0:s&&(a=16777215);var E=this;this.rotateTween=new TWEEN.Tween({progress:0}).to({progress:1},a).easing(ae.Linear.None).onStop(function(){c&&c()}).onUpdate(function(){if(s)d.theta+=s/1e3;else{var e=this._object.progress;n&&(d.theta=y.theta+e*Math.degToRad(n)),o&&(d.phi=y.phi+e*Math.degToRad(o))}var t=i?i.clone():G.parseVector3(r.position);d.radius=E.distanceTo(t.toArray()),d.makeSafe(),v.setFromSpherical(d),t.add(v),E.node.position.copy(t),u&&u()}).onComplete(function(){l==THREE.LoopOnce?h&&h():l==THREE.LoopRepeat?(E.position=g,E.rotateAround(t)):l==THREE.LoopPingPong&&(void 0!==n&&(t.yRotateAngle=-n),void 0!==o&&(t.xRotateAngle=-o),E.rotateAround(t))}),this.rotateTween.start()},e.prototype.rotateTo=function(e){var t=(e=e||{}).angles||e.localAngles,r=e.time,i=e.speed,n=e.lerpType||ae.Linear.None,o=e.loopType||he.No,a=e.complete,s=G.parseVector3(this.angles),l=s.clone(),c=G.parseVector3(t),u=G.getConsumeTime(null,s,c,r,i,2e3);this.stopRotating(),this.rotating=!0;var h=this;this.rotateTween=new TWEEN.Tween(s).to(c,u).easing(n).onUpdate(function(){h.angles=[this._object.x,this._object.y,this._object.z]}).onComplete(function(){o==he.Repeat?(h.angles=l.toArray(),h.rotateTo(e)):o==he.PingPong?(e.angles=l.toArray(),h.rotateTo(e)):a&&a()}).start()},e.prototype.stopRotating=function(){this.rotating=!1,this.rotateTween&&this.rotateTween.stop()},e.prototype.scaleTo=function(e){var t=(e=e||{}).scale,r=e.time,i=e.speed,n=e.lerpType||ae.Linear.None,o=e.loopType||he.No,a=e.complete,s=G.parseVector3(this.scale),l=s.clone(),c=G.parseVector3(t),u=G.getConsumeTime(null,s,c,r,i,2e3);this.stopScaling(),this.scaling=!0;var h=this;this.scaleTween=new TWEEN.Tween(s).to(c,u).easing(n).onUpdate(function(){h.scale=[this._object.x,this._object.y,this._object.z]}).onStop(function(){}).onComplete(function(){o==he.Repeat?(h.scale=l.toArray(),h.scaleTo(e)):o==he.PingPong?(e.scale=l.toArray(),h.scaleTo(e)):a&&a()}).start()},e.prototype.stopScaling=function(){this.scaling=!1,this.scaleTween&&this.scaleTween.stop()},e.prototype._createDispatchEvent=function(e){var t=this.app.events,r={};if(te[e]){var i=t.mouseMovePos;r=t.createMouseEvent(e,{clientX:i[0],clientY:i[1]})}return r},e.prototype._on=function(e,t,r,i,n,o){return this.app.events.bindCallObj(e,t,r,i,this,n,!1,o)},e.prototype._off=function(e,t,r){return this.app.events.unbindCallObj(e,t,r,this)},e.prototype._one=function(e,t,r,i,n,o){var a=G.parseEvent(t,r,i,n,o);return this.app.events.bindCallObj(e,a.selector,a.userData,function e(t){a.callback.call(t.object,t),t.object.off(t.type,e)},this,a.tag,!0,a.priority)},e.prototype.on=function(e,t,r,i,n,o){for(var a=this._on(e,t,r,i,n,o),s=0;s<this._controls.length;s++){var l=this._controls[s].control;G.isFunction(l.onRegisterEvent)&&l.onRegisterEvent(e,a)}return this},e.prototype.off=function(e,t,r){for(var i=this._off(e,t,r),n=0;n<this._controls.length;n++){var o=this._controls[n].control;G.isFunction(o.onUnregisterEvent)&&o.onUnregisterEvent(e,i)}return this},e.prototype.one=function(e,t,r,i,n,o){for(var a=this._one(e,t,r,i,n,o),s=0;s<this._controls.length;s++){var l=this._controls[s].control;G.isFunction(l.onRegisterEvent)&&this._controls.onRegisterEvent(e,a,!0)}return this},e.prototype.hasEvent=function(e,t){var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return this.app.events.hasCallObjects(e,t,[this],r)},e.prototype.trigger=function(e,t,r){this.app.events.dispatchBindCallObj(e,t,[this],r)},e.prototype.pauseEvent=function(e,t,r){this.app.events.pauseEvent(e,t,r,!1,this)},e.prototype.pauseEventInFrame=function(e,t,r){this.app.events.pauseEvent(e,t,r,!0,this)},e.prototype.resumeEvent=function(e,t,r){this.app.events.resumeEvent(e,t,r,this)},e.prototype._traverseObjects=function(e,t){for(var r=0;r<this.children.length;r++){var i=this.children[r];G.isFunction(e)?e(i):G.isArray(e)&&e.push(i),t&&i._traverseObjects(e,t)}},e.prototype._traverseNodes=function(t,r,i){for(var n=0;n<t.children.length;n++){var o=t.children[n],a=o.userData,s=a.baseObject_bindSubNode;s||((s=new e(this.app,o,this)).name=o.name,a.baseObject_bindSubNode=s),G.isFunction(r)?r(s):G.isArray(r)&&r.push(s),i&&this._traverseNodes(o,r,i)}},e.prototype.traverse=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];e&&(e(this),this._traverseObjects(e,t))},e.prototype.query=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(G.isString(e)&&e.startsWith("/"))return console.warn("[BaseObject] Please use '.subNodes.query()' to replace it, and remove '/' prefix of params"),this.subNodes.query(new RegExp(e.substring(1)),t);var r=[];this._traverseObjects(r,t);var i=new Y(this.app,r);return i.select(e),i},e.prototype.isChildOf=function(e){if(!e)return!1;for(var t=this._parent;t;){if(t==e)return!0;t=t.parent}return!1},e.prototype.isBrotherOf=function(e){if(!e)return!1;var t=this._parent;return!!t&&-1!==t.children.indexOf(e)},e.prototype.clearAttachPoints=function(){if(this._attachPoints){for(var e=0;e<this._attachPoints.length;e++)this._attachPoints[e].destroy();this._attachPoints=null}},e.prototype.isAttachPoint=function(e){if(e&&e.node)for(var t=["dummy:","point:","connector:"],r=0;r<t.length;r++)if(e.name.startsWith(t[r]))return!0;return!1},e.prototype.translate=function(e){this.node.translateX(e[0]),this.node.translateY(e[1]),this.node.translateZ(e[2]),this.synIndependentWorldPosition(),this.dirty=!0},e.prototype.translateX=function(e){this.translate([e,0,0])},e.prototype.translateY=function(e){this.translate([0,e,0])},e.prototype.translateZ=function(e){this.translate([0,0,e])},e.prototype.moveTo=function(e){var t=e.offset||e.offsetPosition||e.localPosition,r=e.direction;if(t)t=G.parseVector3(t);else if(r){t=G.parseVector3(r);var i=G.parseValue(e.distance,5);t.multiplyScalar(i)}if(t){var n=G.parseVector3(this.position);n.add(t),e.position=n.toArray()}this.movePath(e)},e.prototype.createPathTween=function(e,t,r,i,n,o){var a,s=G.parseVector3(e).clone(),l=G.parseVector3(t).clone();if(r){o||(o=new THREE.Matrix4,n.updateWorldMatrix(!0,!1),o.getInverse(n.matrixWorld));var c=new THREE.Matrix4,u=s.clone(),h=l.clone();u.applyMatrix4(o),h.applyMatrix4(o),c.lookAt(h,u,this.node.up);var p=new THREE.Quaternion;if(p.setFromRotationMatrix(c),i){var d=new THREE.Quaternion;d.setFromAxisAngle(new THREE.Vector3(0,1,0),Math.degToRad(i)),p.multiply(d)}a=p}return{distance:s.distanceTo(l),from:s,to:l,toQuat:a}},e.prototype.createPathTweens=function(e,t,r,i){var n=new THREE.Matrix4;e.updateWorldMatrix(!0,!1),n.getInverse(e.matrixWorld);for(var o=0;o<t.length-1;o++){var a=t[o],s=t[o+1],l=this.createPathTween(a,s,r,i,e,n);this.pathTweens.push(l)}},e.prototype.startPathTweens=function(e,t,r,i,n,o,a){var s=function(e){for(var t=0,r=0;r<e.length;r++)t+=e[r].distance;return t}(this.pathTweens);if(s){t&&(e=s/t*1e3,o=ae.Linear.None);var l=-1,c={progress:s},u=function(e,t){for(var r=[],i=0;i<e.length;i++)r.push(e[i].distance/t);return r}(this.pathTweens,s),h=this;this.pathTween=new TWEEN.Tween({progress:0}).to(c,e).easing(o).onUpdate(function(){var e=this._object.progress/s,t=G.getArrayIndexFromProgress(h.pathTweens,e,u),o=G.getArrayProgress(h.pathTweens,e,u),a=h.pathTweens[t];if(t!=l&&(l=t,r&&(a.fromQuat=h.node.quaternion.clone())),i)h.node.lookAt(i);else if(r)if(n){var c=a.fromQuat.clone();c.slerp(a.toQuat,o),h.node.quaternion.copy(c)}else h.node.quaternion.copy(a.toQuat);var p=a.from.clone();p.lerp(a.to,o),h.position=p.toArray()}).onStop(function(){}).onComplete(function(){a&&a()}).start()}},e.prototype.movePath=function(e){var t=(e=e||{}).path,r=e.time||1e3,i=e.speed,n=G.parseValue(e.local,!0),o=G.parseValue(e.orientToPath,!1),a=e.orientToPathDegree,s=e.lookAt,l=e.loopType,c=function(e){return null!==e.lerp&&null!==e.lerpType&&G.parseValue(e.lerp,!0)}(e),u=e.lerpType||ae.Linear.None,h=e.complete;e.loop&&(l=he.Repeat,console.warn('[BaseObject] movePath() use "loopType(THING.LoopType)" to instead "loop(Boolean)" argument'));var p,d=this.parents.query(".Campus")[0];if(p=d?d.node:this.node.parent,t){if(n){p.updateWorldMatrix(!0,!1);for(var f=p.matrixWorld,m=[],g=0;g<t.length;g++){var v=G.parseVector3(t[g]);v.applyMatrix4(f),m.push(v.toArray())}t=m}1===t.length&&(t=[this.position,t[0]])}else{var y=e.position;y&&(t=[this.position,y])}if(0!=t.length){s&&(o=null,s=G.parseVector3(s)),this.stopMoving();for(var E=[],g=0;g<t.length;g++){var b=null;2==t[g].length?b=new THREE.Vector3(t[g][0],this.position[1],t[g][1]):3==t[g].length&&(b=G.parseVector3(t[g])),E.push(b)}this.createPathTweens(p,E,o,a);var x=this.pathTweens[0].from;this.position=[x.x,x.y,x.z],e.path=t.concat();var _=this;this.startPathTweens(r,i,o,s,c,u,function(){l==he.Repeat?_.movePath(e):l==he.PingPong?(e.path.reverse(),void 0!==e.orientToPathDegree&&(e.orientToPathDegree=360-e.orientToPathDegree),_.movePath(e)):h&&h.call(_)})}},e.prototype.stopMoving=function(){this.pathTweens=[],this.pathTween&&this.pathTween.stop()},e.prototype.hasAttribute=function(e){return G.hasAttribute(this,e)},e.prototype.getAttribute=function(e){return G.getAttribute(this,e)},e.prototype.setAttribute=function(e,t){return G.setAttribute(this,e,t)},e.prototype.setAttributes=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];e=e||{};for(var r in e)(t||G.isUndefined(this[r]))&&this.setAttribute(r,e[r])},e.prototype._updateLookingAtObject=function(){var e=this._lookingAtObject,t=e.target;G.isArray(t)?this.node.lookAt(G.parseVector3(t)):this.node.lookAt(G.parseVector3(t.position));var r=e.quat;r&&this.node.quaternion.multiply(r)},e.prototype.selfUpdate=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=0;if(this._style&&G.isFunction(this._style.update)&&(t|=this._style.update(e)),this.style.boundingBox&&(this.updateBounds(),t=!0),this._localClippingPlane){var r=this._localClippingPlaneBase.clone();r.applyMatrix4(this.node.matrixWorld),this._localClippingPlane.normal=r.normal,this._localClippingPlane.constant=r.constant,t=!0}return this._lodNode&&(this._lodNode.update(this.app.renderCamera),t=!0),this._lookingAtObject&&(this._updateLookingAtObject(),t=!0),this._independentPosition&&(this._getIndependentControlRenderNode()._setWorldPosition(this._independentPosition.clone(),!1,this.static),t=!0),this._independentWorldAngles&&(this._getIndependentControlRenderNode()._setWorldAngles(this._independentWorldAngles.clone(),this.static),t=!0),this._independentWorldScale&&(this._getIndependentControlRenderNode()._setWorldScale(this._independentWorldScale.clone(),this.static),t=!0),t},e.prototype.update=function(e){for(var t=this.selfUpdate(e),r=0;r<this._controls.length;r++){var i=this._controls[r].control,n=i.onUpdate;n&&(t|=n.call(i,e))}return t},e.prototype.updateBox=function(e){var t=new THREE.Matrix4;if(t.getInverse(this.node.matrixWorld),e){var r=new THREE.Matrix4;r.setPosition(e),this.updateBounds(),this._box.applyMatrix4(r)}var i=new THREE.Vector3;this._box.getCenter(i),this._boxCenter=i.toArray();var n=new THREE.Vector3;this._box.getSize(n),this._boxSize=n.toArray(),this._boxRadius=n.length(),this._boundingBox=this._box.clone(),this._boundingBox.applyMatrix4(t),this._initBoxSize=this._initBoxSize||this._boxSize.concat()},e.prototype.updateBounds=function(){this.boundingBoxDirty&&(null==this._box?this._box=(new THREE.Box3).setFromVisibleObject(this.node):this._box.setFromVisibleObject(this.node),this.updateBox(),this.boundingBoxDirty=!1)},e.prototype.createGrid=function(e,t,r,i){this._grid=this.app.create({type:"Grid",size:e,divisions:t,color1:r,color2:i,parent:this}),this._grid.userData.topNode=!0,this._grid.userData.skipBoundingBox=!0,this._grid.userData.skipOutline=!0,this._grid.userData.independent=!0,this._grid.canNotQueryFromSelector=!0,this._grid.translateY(-.01)},e.prototype.showGrid=function(e,t,r,i){var n=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];if(G.isBoolean(e)){var o=e;o&&(this._grid||this.createGrid(300,28,1131673,1131673)),this._grid&&(this._grid.visible=o)}else if(this._grid&&(this._grid.destroy(),this._grid=null),this.createGrid(e,t,r,i),n){var a=e;G.isNumber(n)&&(a=n),this._grid.addPickableGround({size:a})}},e.prototype.fade=function(e,t){var r=(e=e||{}).time||1e3,i=e.complete;this.fadeTween&&this.fadeTween.stop();var n={opacity:this.style.opacity},o={opacity:t},a=this;this.visible=!0,this.fadeTween=new TWEEN.Tween(n).to(o,r).easing(TWEEN.Easing.Linear.None).onUpdate(function(){a.style.opacity=this._object.opacity}).onComplete(function(){0==a.style.opacity&&(a.visible=!1),i&&i()}).start()},e.prototype.fadeIn=function(e){this.style.opacity=0,this.fade(e,1)},e.prototype.fadeOut=function(e){this.style.opacity=1,this.fade(e,0)},e.prototype.setClippingPlanes=function(e){var t=(e=e||{}).height,r=G.parseVector3(e.direction,new THREE.Vector3(0,-1,0));this._localClippingPlaneBase=new THREE.Plane(r,t),this._localClippingPlane=this._localClippingPlaneBase.clone();var i=this;this.node.traverse(function(e){e.isMesh&&(e._clip_prev_material=e.material,e.material=e.material.clone(),e.material.clippingPlanes=[i._localClippingPlane])}),this.tickable=!0},e.prototype.clearClippingPlanes=function(){this.node.traverse(function(e){e.isMesh&&(e.material=e._clip_prev_material,e.material.clippingPlanes=null)}),this._localClippingPlaneBase=null,this._localClippingPlane=null},e.prototype.toJSON=function(){var e={};e.id=this._id,e.type=this.type,e.name=this.name,e.localPosition=this.localPosition,e.localAngles=this.angles,e.scale=this.scale,this._parent&&(e.parentId=this._parent.id);var t={};return null!==this.style.color&&(t.color=this.style.color),1!==this.style.opacity&&(t.opacity=this.style.opacity),e.style=t,e.internalUserData=this.internalUserData,e},e.prototype.addControl=function(e,t,r){if(e){if(G.isString(t)&&(r=r||t,t={}),!G.isNumber(e))return this.hasControl(e)?(console.error("The control is existing when addControl() with '"+e+"'"),null):(this._controls.push({control:e,name:r}),this.tickable=!0,this.dirty=!0,e);for(var i=[],n=0;n<i.length;n++){var o=i[n];if(o.id==e){var a=new o.type(this);return a.setup(t),this.addControl(a)}}return null}},e.prototype.getControl=function(e){for(var t=0;t<this._controls.length;t++)if(e==this._controls[t].name)return this._controls[t].control;return null},e.prototype.removeControl=function(e){if(e){if(G.isString(e)){for(t=0;t<this._controls.length;t++)if(this._controls[t].name==e){(i=(r=this._controls[t].control).onRemove)&&i.call(r),this._controls.splice(t,1);break}}else for(var t=0;t<this._controls.length;t++)if(this._controls[t].control==e){var r=this._controls[t].control,i=r.onRemove;i&&i.call(r),this._controls.splice(t,1);break}this.dirty=!0}},e.prototype.removeAllControls=function(){for(var e=0;e<this._controls.length;e++){var t=this._controls[e].control,r=t.onRemove;r&&r.call(t)}this._controls=[],this.dirty=!0},e.prototype.hasControl=function(e){if(G.isString(e)){for(var t=0;t<this._controls.length;t++)if(e==this._controls[t].name)return!0}else if(-1!==this._controls.indexOf(e))return!0;return!1},e.prototype.setWorldPosition=function(e){var t=G.parseVector3(e);this.node._setWorldPosition(t,!1,this.static),this.dirty=!0},e.prototype.setWorldAngles=function(e){var t=G.parseQuaternion(e);this.node._setWorldAngles(t,this.static),this.boundingBoxDirty=!0},e.prototype.setWorldScale=function(e){var t=G.parseVector3(e);this.node._setWorldScale(t,this.static),this.boundingBoxDirty=!0},e.prototype.setLocalPosition=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=G.parseVector3(e);if(t){var i=new THREE.Vector3;this.node.updateMatrixWorld(),this.node.getWorldScale(i),r.divide(i)}this.localPosition=r},e.prototype.getLocalPosition=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=this.node.position.clone();if(e){var r=new THREE.Vector3;this.node.updateMatrixWorld(),this.node.getWorldScale(r),t.multiply(r)}return t.toArray()},e.prototype.getOffsetPosition=function(e){e=e||{};var t=G.parseValue(e.yAngle,0),r=G.parseValue(e.xAngle,0),i=G.parseValue(e.distance||e.radius,this.boundingBox.radius),n=e.radiusFactor;return n&&(i=this.boundingBox.radius*n),(new THREE.Vector3).getDirectionFromAngles(t,r,i).toArray()},e.prototype.canResponeEventFrom=function(e){var t=e.object;return!!(t&&t.isChildOf(this)&&"mouseover"==e.type&&t.isChildOf(this))},e.prototype.needChangeVisible=function(e){return!(this.node.layers.mask==e&&this.node.visible==e&&!function(e){for(var t=0;t<e.length;t++)if(!e[t].visible)return!0;return!1}(this.parents))},e.prototype.indexOfParent=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this._parent)return-1;var t=this._parent.children.indexOf(this);if(-1===t)return-1;if(e){t=0;for(var r=this._parent.children,i=0;i<r.length;i++){var n=r[i];if(n==this)return t;n.type==this.type&&t++}}return t},e.prototype.clearNode=function(e){this.app.resourceManager.remove(this.node,e)},e.prototype.cloneSelf=function(e){return this.app.create(e)},e.prototype.clone=function(e,t){var r={type:this.type,url:this.url,position:this.position,angles:this.angles,scale:this.scale,visible:this.visible,parent:t||this._parent};if(!this.url){var i=this,n=this.node.cloneByFilter(function(e){for(var t=0;t<i.children.length;t++){var r=i.children[t].node;if(e==r||e.isChildOf(r))return!1}return!0});n.traverse(function(e){e.userData={}}),r.node=n}var o=this.cloneSelf(r);if(!o)return null;if(e)for(var a=0;a<this.children.length;a++)this.children[a].clone(e,o);return o},e.prototype.getEnvMapResources=function(){for(var e=this.parents,t=0;t<e.length;t++){var r=e[t].envMapResources;if(r)return r}return null},e.prototype.synIndependentWorldPosition=function(){if(this._independentControlFlags.hasFlags(de.Position)){var e=new THREE.Vector3;this._getIndependentControlRenderNode().getWorldPosition(e),this._independentPosition=e}},e.prototype.synIndependentWorldAngles=function(){if(this._independentControlFlags.hasFlags(de.Rotation)){var e=new THREE.Quaternion;this._getIndependentControlRenderNode().getWorldQuaternion(e),this._independentWorldAngles=e}},e.prototype.synIndependentWorldScale=function(){if(this._independentControlFlags.hasFlags(de.Scale)){var e=new THREE.Vector3;this._getIndependentControlRenderNode().getWorldScale(e),this._independentWorldScale=e}},e.prototype.synIndependentTransform=function(){this.synIndependentWorldPosition(),this.synIndependentWorldAngles(),this.synIndependentWorldScale()},e.prototype._getIndependentControlRenderNode=function(){return this.node},e.prototype._useIndependentTransform=function(e){var t=e.matrixWorld,r=new THREE.Vector3,i=new THREE.Vector3,n=new THREE.Quaternion;t.decompose(r,n,i),this._independentPosition&&(r=this._independentPosition.clone()),this._independentWorldAngles&&(n=this._independentWorldAngles.clone()),this._independentWorldScale&&(i=this._independentWorldScale.clone()),t.compose(r,n,i)},e.prototype._useIndependentRaycast=function(e){var t=this._getIndependentControlRenderNode();if(t)if(e){t.userData.original_raycast=t.userData.original_raycast||t.raycast;var r=this;t.raycast=function(e,t){var i=r._getIndependentControlRenderNode();return i&&r._useIndependentTransform(i),this.userData.original_raycast.call(this,e,t)}}else t.userData.original_raycast&&(t.raycast=t.userData.original_raycast,delete t.userData.original_raycast)},e.prototype._enableIndependentControl=function(){this.node.removeBeforeRenderFunction("independentControlRender");var e=!1,t=this._independentControlFlags;if(t.hasFlags(de.Transform)){this.synIndependentTransform(),this.tickable=!0;var r=this._getIndependentControlRenderNode();if(!r.hasBeforeRenderFunction("independentControlRender")){var i=this;r.addBeforeRenderFunction("independentControlRender",function(e,t,r){i._useIndependentTransform(this)})}e=!0}return t.hasFlags(de.Position)||(this._independentPosition=null),t.hasFlags(de.Rotation)||(this._independentWorldAngles=null),t.hasFlags(de.Scale)||(this._independentWorldScale=null),this._useIndependentRaycast(e),e},e.prototype.enableIndependentControl=function(e,t){return!!this._independentControlFlags.enableFlags(e,t)&&this._enableIndependentControl()},e.prototype.getAllObjectsInChildren=function(e){console.warn("[BaseObject] Please use '.children' to replace 'getAllObjectsInChildren()'");for(var t=0;t<this.children.length;t++)e.push(this.children[t])},e.prototype.dispatch=function(e){console.warn("[BaseObject] Please use 'trigger' to replace 'dispatch' when you want to launch event"),this.trigger(e)},e.prototype.getWorldPosition=function(e){return console.warn("[BaseObject] Please use '.selfToWorld()' to replace 'getWorldPosition()'"),this.selfToWorld(e)},e.prototype.upPosition=function(e){return console.warn("[BaseObject] Please use '.this.selfToWorld([0, distance, 0])' to replace 'upPosition()'"),this.selfToWorld([0,e,0])},e.prototype.downPosition=function(e){return console.warn("[BaseObject] Please use '.this.selfToWorld([0, -distance, 0])' to replace 'downPosition()'"),this.selfToWorld([0,-e,0])},e.prototype.setPosition=function(e,t,r){console.warn("[BaseObject] Please use '.position=[x, y, z]' to replace 'setPosition()'"),this.position=[e,t,r]},e.prototype.setX=function(e){console.warn("[BaseObject] Please use '.position=[x, y, z]' to replace '.x='");var t=this.position;t[0]=e,this.position=t},e.prototype.setY=function(e){console.warn("[BaseObject] Please use '.position=[x, y, z]' to replace '.y='");var t=this.position;t[1]=e,this.position=t},e.prototype.setZ=function(e){console.warn("[BaseObject] Please use '.position=[x, y, z]' to replace '.z='");var t=this.position;t[2]=e,this.position=t},e.prototype.show=function(e){console.warn("[BaseObject] Please use '.visible=true/false' to replace 'show()'"),void 0===e&&(e=!0),this.visible=e},e.prototype.hide=function(){console.warn("[BaseObject] Please use '.visible=false' to replace 'hide()'"),this.visible=!1},e.prototype.flipVisible=function(){console.warn("[BaseObject] Please use '.visible=!.visible' to replace 'flipVisible()'"),this.visible=!this.visible},e.prototype.attr=function(){return console.warn("[BaseObject] Please use 'userData[x]' to replace 'attr()'"),0==arguments.length?this.userData:1==arguments.length?this.userData[arguments[0]]:void(2==arguments.length&&(this.userData[arguments[0]]=arguments[1]))},e.prototype.moveX=function(e){console.warn("[BaseObject] Please use '.translate([d, 0, 0])' to replace 'moveX(d)'"),this.translate([e,0,0])},e.prototype.moveY=function(e){console.warn("[BaseObject] Please use '.translate([0, d, 0])' to replace 'moveY(d)'"),this.translate([0,e,0])},e.prototype.moveZ=function(e){console.warn("[BaseObject] Please use '.translate([0, 0, d])' to replace 'moveZ(d)'"),this.translate([0,0,e])},e.prototype.hasShowBoundingBox=function(){return console.warn("[BaseObject] Please use '.style.boundingBox' to replace 'hasShowBoundingBox()'"),this.style.boundingBox},e.prototype.showBoundingBox=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];console.warn("[BaseObject] Please use '.style.boundingBox' to replace 'showBoundingBox()'"),this.style.boundingBox=e},e.prototype.getAncestor=function(e){return console.warn("[BaseObject] Please use '.parents.query(param)' to replace '.getAncestor(param)'"),this.parents.query(e)},e.prototype.getSubNodeIndex=function(e){return console.warn('[BaseObject] we do not support ".getSubNodeIndex()" anymore, please do not use it'),-1},e.prototype.getSubNodesNumber=function(){return console.warn('[BaseObject] we do not support ".getSubNodesNumber()" anymore, please do not use it'),0},e.prototype.getSubNodeByIndex=function(e){return console.warn('[BaseObject] we do not support ".getSubNodeByIndex()" anymore, please do not use it'),null},e.prototype.removeSubNodeByIndex=function(e){console.warn('[BaseObject] we do not support ".removeSubNodeByIndex()" anymore, please do not use it')},e.prototype.insertSubNode=function(e,t){console.warn('[BaseObject] we do not support ".insertSubNode()" anymore, please do not use it')},e.prototype.createSubNode=function(e){return console.warn('[BaseObject] we do not support ".createSubNode()" anymore, please do not use it'),null},e.prototype.setPolygonOffset=function(e){console.warn("[BaseObject] Please use '.style.setPolygonOffset(params)' to replace '.setPolygonOffset(params)'"),this.style.setPolygonOffset(e)},k(e,[{key:"pickable",set:function(e){this._pickable!=e&&(this._pickable=e,this.synPickable())},get:function(){return this._pickable}},{key:"subNodes",get:function(){var e=[];this._traverseNodes(this.node,e,!0);var t=new Y(this.app,e);return t.buildReturnObject(e),t}},{key:"attachPoints",get:function(){if(!this._attachPoints){this._attachPoints=[];var e=this;this.node.traverse(function(t){var r=t.userData;if(r&&r.isBaseObject){var i=e.app.objectManager.get(r.id);e.isAttachPoint(i)&&(e._attachPoints.push(i),e.app.objectManager.destroy(i))}})}var t=new Y(this.app);return t.buildReturnObject(this._attachPoints),t}},{key:"destroied",get:function(){return!this._queryid}},{key:"internalUserData",get:function(){return this._internalUserData},set:function(e){this._internalUserData=e}},{key:"uuid",get:function(){return this._uuid}},{key:"id",set:function(e){this._id=e},get:function(){return this._id}},{key:"name",set:function(e){this._name=e},get:function(){return this._name}},{key:"queryID",set:function(e){this._queryid=e},get:function(){return this._queryid}},{key:"userData",set:function(e){this._userData=e},get:function(){return this._userData}},{key:"tags",set:function(e){this._tags=e},get:function(){return this._tags}},{key:"gridSize",get:function(){return this._grid.size}},{key:"renderOrder",set:function(e){this.node.traverse(function(t){t.renderOrder=e})},get:function(){return this.node.renderOrder}},{key:"controls",get:function(){return this._controls}},{key:"x",set:function(e){var t=this.position;this.position=[e,t[1],t[2]]},get:function(){return this.position[0]}},{key:"y",set:function(e){var t=this.position;this.position=[t[0],e,t[2]]},get:function(){return this.position[1]}},{key:"z",set:function(e){var t=this.position;this.position=[t[0],t[1],e]},get:function(){return this.position[2]}},{key:"position",set:function(e){e&&(this.setWorldPosition(e),this.synIndependentWorldPosition())},get:function(){var e=new THREE.Vector3;return this.node.getWorldPosition(e),e.toArray()}},{key:"localPosition",set:function(e){if(this._parent){if(this._parent.node==this.node.parent){var t=G.parseVector3(e);this.node.position.copy(t)}else{var r=G.parseVector3(e);this._parent.localToWorld(r),this.node._setWorldPosition(r,!1,this.static)}this.dirty=!0}},get:function(){if(!this._parent)return[0,0,0];if(this._parent.node==this.node.parent)return(e=this.node.position).toArray();var e=new THREE.Vector3;return this.node.getWorldPosition(e),this._parent.node.worldToLocal(e),e.toArray()}},{key:"angleX",set:function(e){var t=this.angles;this.angles=[e,t[1],t[2]]},get:function(){return this.angles[0]}},{key:"angleY",set:function(e){var t=this.angles;this.angles=[t[1],e,t[2]]},get:function(){return this.angles[1]}},{key:"angleZ",set:function(e){var t=this.angles;this.angles=[t[1],t[2],e]},get:function(){return this.angles[2]}},{key:"angles",set:function(e){var t=G.parseEuler(e);this.node.rotation.copy(t),this.synIndependentWorldAngles(),this.boundingBoxDirty=!0},get:function(){var e=this.node.parent;return e&&e.userData.childUseWorldAnglesAlways?this.worldAngles:this.node.getAngles()}},{key:"worldAngles",set:function(e){this.setWorldAngles(e),this.synIndependentWorldAngles(),this.dirty=!0},get:function(){var e=new THREE.Quaternion;return this.node.getWorldQuaternion(e),G.parseAngles(e)}},{key:"forward",get:function(){var e=new THREE.Vector3;return this.node.updateMatrixWorld(!0),this.node.getWorldDirection(e),e.normalize(),e.toArray()}},{key:"up",get:function(){var e=this.node.up.clone();return this.node.updateMatrixWorld(!0),e.transformDirection(this.node.matrixWorld),e.toArray()}},{key:"cross",get:function(){var e=G.parseVector3(this.up),t=G.parseVector3(this.forward),r=new THREE.Vector3;return r.crossVectors(e,t),r.normalize(),r.toArray()}},{key:"scale",set:function(e){var t=G.parseVector3(e);this.node.scale.set(t.x,t.y,t.z),this.synIndependentWorldScale(),this.dirty=!0},get:function(){return this.node.scale.toArray()}},{key:"worldScale",set:function(e){this.setWorldScale(e),this.synIndependentWorldScale(),this.dirty=!0},get:function(){var e=new THREE.Vector3;return this.node.getWorldScale(e),e.toArray()}},{key:"box",get:function(){return this.updateBounds(),this._box}},{key:"boundingBox",get:function(){var e=this,t=this.box;return{min:t.min.toArray(),max:t.max.toArray(),center:this._boxCenter,size:this._boxSize,radius:this._boxRadius,initSize:this._initBoxSize,getOffsetWorldPosition:function(t){var r=e.getOffsetPosition(t);return e.selfToWorld(r)}}}},{key:"style",get:function(){return this._style||(this._style=new W(this)),this._style}},{key:"catchEventAnyTime",set:function(e){this._catchEventAnyTime=e},get:function(){return this._catchEventAnyTime}},{key:"draggable",set:function(e){this.isDraggable=e},get:function(){return this.isDraggable}},{key:"dragState",set:function(e){this._dragState=e},get:function(){return this._dragState}},{key:"tickable",set:function(e){this.isTickable!=e&&(this.isTickable=e,this.synTickableObject(),this.app.needUpdate=!0)},get:function(){return this.isTickable}},{key:"renderDistance",set:function(e){this._renderDistance=e,G.isNull(e)?this.app.objectManager.removeRenderDistanceObject(this):this.app.objectManager.addRenderDistanceObject(this)},get:function(){return this._renderDistance}},{key:"shadowDistance",set:function(e){this._shadowDistance=e,G.isNull(e)?this.app.objectManager.removeShadowDistanceObject(this):this.app.objectManager.addShadowDistanceObject(this)},get:function(){return this._shadowDistance}},{key:"visible",set:function(e){if(this.needChangeVisible(e)){e&&this.node.ensureParentsVisible(e),this.node.ensureVisible(e),this.node.traverseChild(function(t){t.ensureVisible(e,!1)});for(var t=0;t<this._controls.length;t++){var r=this._controls[t].control;G.isFunction(r.onVisible)&&r.onVisible(e)}this.dirty=!0}},get:function(){return this.node.ensureVisible()}},{key:"pivot",set:function(e){if(this.node.removeBeforeRenderFunction("pivot"),e){this._pivot={},this._pivot.offset=G.parseVector3(e);var t=this;this.node.addBeforeRenderFunction("pivot",function(e,r,i){var n=t.box.clone(),o=new THREE.Matrix4;o.getInverse(t.node.matrixWorld),n.applyMatrix4(o);var a=new THREE.Vector3;a.subVectors(n.max,n.min),a.multiply(t._pivot.offset),a.applyMatrix4(t.node.matrixWorld),this.matrixWorld.setPosition(a)}),this.tickable=!0}},get:function(){var e=this._pivot;return e?e.offset:null}},{key:"dirty",set:function(e){if(e){this._dirtyFlags.setFlags();for(var t=this.parents,r=0;r<t.length;r++)t[r]._dirtyFlags.setFlags();for(r=0;r<this.children.length;r++)this.children[r].dirty=!0;this.app.needUpdate=!0}else this._dirtyFlags.clearFlags()},get:function(){return this._dirtyFlags.hasAnyFlags()}},{key:"boundingBoxDirty",set:function(t){this._dirtyFlags.enableFlags(e.boundingBoxDirtyFlag,t)&&(this.app.needUpdate=!0)},get:function(){return!!this._dirtyFlags.hasFlags(e.boundingBoxDirtyFlag)||!this._box}},{key:"static",get:function(){return this.app.root.static}},{key:"brothers",get:function(){var e=[],t=this._parent;if(t)for(var r=0;r<t.children.length;r++){var i=t.children[r];i!=this&&e.push(i)}var n=new Y(this.app,e);return n.buildReturnObject(e),n}},{key:"parents",get:function(){for(var e=[],t=this._parent;t;t=t.parent)e.push(t);var r=new Y(this.app,e);return r.buildReturnObject(e),r}},{key:"parent",get:function(){return this._parent}},{key:"verticesNumber",get:function(){return G.isFunction(this.node.verticesCount)?this.node.verticesCount():0}},{key:"meshNames",get:function(){return this.node.getMeshNames()}},{key:"inheritPosition",set:function(e){this.enableIndependentControl(THING.IndependentControlType.Position,!e)},get:function(){return!this._independentControlFlags.hasFlags(THING.IndependentControlType.Position)}},{key:"inheritAngles",set:function(e){this.enableIndependentControl(THING.IndependentControlType.Rotation,!e)},get:function(){return!this._independentControlFlags.hasFlags(THING.IndependentControlType.Rotation)}},{key:"inheritScale",set:function(e){this.enableIndependentControl(THING.IndependentControlType.Scale,!e)},get:function(){return!this._independentControlFlags.hasFlags(THING.IndependentControlType.Scale)}},{key:"self",get:function(){return console.warn("[BaseObject] Please do not use '.self'"),this}},{key:"custom",get:function(){return console.warn("[BaseObject] Please use '.userData' to replace '.custom'"),this.userData}},{key:"boxSize",get:function(){return console.warn("[BaseObject] Please use '.size' to replace '.boxSize'"),this.size}},{key:"boxRadius",get:function(){return console.warn("[BaseObject] Please use '.radius' to replace '.boxRadius'"),this.radius}},{key:"localAngles",set:function(e){console.warn("[BaseObject] Please use '.angles' to replace '.localAngles'"),this.angles=e},get:function(){return console.warn("[BaseObject] Please use '.angles' to replace '.localAngles'"),this.angles}},{key:"isShowBoundingBox",get:function(){return console.warn("[BaseObject] Please use '.hasShowBoundingBox()' to replace '.isShowBoundingBox'"),this.hasShowBoundingBox()}},{key:"building",get:function(){return console.warn("[BaseObject] Please use '.getAncestor('.Building')[0]' to replace '.building'"),this.parents.query(".Building")[0]}},{key:"ancestors",get:function(){return console.warn("[BaseObject] Please use '.parents' to replace '.ancestors'"),this.parents}},{key:"root",get:function(){return console.warn("[BaseObject] Please use 'this.parents.query('.Campus')[0]')' to replace '.root'"),this.parents.query(".Campus")[0]}},{key:"boxCenter",get:function(){return console.warn("[BaseObject] Please use '.boundingBox.center' to replace '.boxCenter'"),this.boundingBox.center}},{key:"size",get:function(){return console.warn("[BaseObject] Please use '.boundingBox.size' to replace '.size'"),this.boundingBox.size}},{key:"radius",get:function(){return console.warn("[BaseObject] Please use '.boundingBox.radius' to replace '.radius'"),this.boundingBox.radius}},{key:"center",get:function(){return console.warn("[BaseObject] Please use '.boundingBox.center' to replace '.center'"),this.boundingBox.center}},{key:"isBaseObject",get:function(){return console.warn("[BaseObject] Please use 'instanceof THING.BaseObject' to replace '.isBaseObject'"),this instanceof THING.BaseObject}},{key:"lockOffset",set:function(e){console.warn("[BaseObject] Please use '.inheritPosition' to replace '.lockOffset'"),this.inheritPosition=!e},get:function(){return console.warn("[BaseObject] Please use '.inheritPosition' to replace '.lockOffset'"),!this.inheritPosition}},{key:"showDetail",set:function(e){console.warn('[BaseObject] we do not support ".showDetail" anymore, please do not use it')}}]),e}(),Ee=function(){function e(t,r,i){I(this,e),this.object=t,this.app=t.app,this.loadingBox=null,this.needDestroy=!1,this.loadModelFromURL(r,i)}return e.prototype.loadComplete=function(e,t,r){var i=this.object;t.model=e;var n=e.cloneNode();i.setupNode(n),i.synPickable(),null!=r&&r(),this.object.removeControl(this),this.needDestroy=!0},e.prototype.loadModelFromURL=function(e,t){var r=this,i=this.object,n=e.url,o=this.app.modelResource,a=o.get(n);a?this.loadComplete(a,e,t):(i.setupUserData(),e.force=!0,i.setupParent(e),i.setupTranslation(e),i.node.updateMatrixWorld(),o.download(n,function(t){var n=t.size;if(n){e.initSize=n.concat();var o=new THREE.BoxGeometry(n[0],n[1],n[2],1,1,1),a=new THREE.MeshPhongMaterial({color:2200782,transparent:!0});r.loadingBox=new THREE.Mesh(o,a),r.loadingBox.material.opacity=.01,r.loadingBox.position.y+=n[1]/2,r.loadingBox.userData.size=n.concat(),r.loadingBox.userData.curProgress=.01,i.pickable||(r.loadingBox.userData.skipPick=!0),i.setupParent(e),i.node.add(r.loadingBox)}var s=e.indexJsonCallback;s&&s.call(i,t)},function(n){if(!i.destroyed){if(r.loadingBox){var o=new THREE.Vector3,a=new THREE.Quaternion,s=new THREE.Vector3;r.loadingBox.updateWorldMatrix(!0,!1),r.loadingBox.matrixWorld.decompose(o,a,s);var l=r.loadingBox.userData.size||e.initSize;o.y-=l[1]/2,r.loadingBox&&r.app.resourceManager.remove(r.loadingBox),e.position=o.toArray(),e.angles=G.parseAngles(a),e.scale=s.toArray()}r.loadComplete(n,e,t)}},function(e){if(r.loadingBox&&r.loadingBox.material){var t=Math.max(.01,e.progress);r.loadingBox.userData.curProgress=Math.max(r.loadingBox.userData.curProgress,t),r.loadingBox.material.opacity=r.loadingBox.userData.curProgress}},function(t){var r=e.error;r&&r()}))},e.prototype.onUpdate=function(e){this.needDestroy&&this.object.removeControl(this)},e}(),be=function(e){function t(r){return I(this,t),N(this,e.call(this,r))}return D(t,e),t.prototype.loadFromURL=function(e,t){this.addControl(new Ee(this,e,t))},k(t,[{key:"isOutdoors",get:function(){return!0}},{key:"building",get:function(){return this.parents.query(".Building")[0]}},{key:"isFacade",get:function(){return console.warn("[Facade] Please use 'instanceof THING.Facade' to replace '.isFacade'"),this instanceof THING.Facade}}]),t}(ye),xe=function(){function e(t,r){I(this,e),this.object=t,this.app=t.app,this.animationClips=null,this.animationPlayingActions=[],this.animationActions=[],this.animationMixer=null,this.init(r)}return e.prototype.init=function(e){var t=this;this.animationClips=e,this.animationMixer=new THREE.AnimationMixer(this.object.node);for(var r=0;r<this.animationClips.length;r++){var i=this.animationMixer.clipAction(this.animationClips[r]);this.animationActions.push(i)}this.animationMixer.addEventListener("loop",function(e){}),this.animationMixer.addEventListener("finished",function(e){var r=e.action;r.setEffectiveTimeScale(0);var i=r.complete;if(i){var n=r.getClip().name;i.call(t.object,n)}})},e.prototype.onRemove=function(){this.animationMixer&&(this.animationClips=null,this.animationActions=[],this.animationMixer=null)},e.prototype.onUpdate=function(e){var t=this.animationMixer;if(t){var r=t.isRunning();if(this.app.root.static&&r){var i=this.object.box;this.app.camera.frustum.intersectsBox(i)&&this.object.node._synMatrixWorld()}return t.update(e),r}return!1},e.prototype.containAnimation=function(e){if(this.animationClips)for(var t=0;t<this.animationClips.length;t++)if(this.animationClips[t].name===e)return!0;return!1},e.prototype._updatePlayingAnimation=function(e){for(var t=0;t<this.animationPlayingActions.length;++t)if(this.animationPlayingActions[t]==e)return;this.animationPlayingActions.push(e)},e.prototype.stopAnimation=function(e){if(e){if(G.isArray(e))for(n=0;n<this.animationPlayingActions.length;n++){for(var t=this.animationPlayingActions[n],r=!1,i=0;i<e.length;i++)if(e[i]==t.getClip().name){r=!0;break}r||(t.stop(),this.animationPlayingActions.splice(n,1),n--)}else if(G.isString(e)){for(n=0;n<this.animationPlayingActions.length;n++)e!=(t=this.animationPlayingActions[n]).getClip().name&&(t.stop(),this.animationPlayingActions.splice(n,1),n--);for(n=0;n<this.animationPlayingActions.length;++n)this.animationPlayingActions[n].stop()}}else for(var n=0;n<this.animationPlayingActions.length;++n)this.animationPlayingActions[n].stop()},e.prototype.playAnimation=function(e,t){var r=(t=t||{}).speed||1,i=G.parseValue(t.reverse,!1),n=G.parseLoopType(t.loopType||t.loop),o=t.loopTimes||1/0,a=t.frames||null,s=t.complete,l=THREE.AnimationClip.findByName(this.animationClips,e);if(!l)return console.error("The '"+e+"' animation is not existing"),!1;var c=this.animationMixer.clipAction(l);if(!c)return!1;r=1/r;var u=i?-r:r,h=u,p=c.isRunning();if(i&&n==THREE.LoopOnce&&(o=p?0:1,n=THREE.LoopRepeat),c.complete=s,c.paused=!1,c.clampWhenFinished=!0,c.setEffectiveTimeScale(u),c.setEffectiveWeight(1),c.setDuration(h),c.setLoop(n,o),a){var d=0,f=1;G.isArray(a)?(d=a[0],f=a.length>1?a[1]:1):G.isNumber(a)?d=a:console.error("animation frames is invalid"),c.warp(d,f,h)}else c.stopWarping();return p||(c.isScheduled()?c.reset():c.play(),this._updatePlayingAnimation(c)),!0},e.prototype.isPlayingAnimation=function(){return!(!this.animationMixer||!this.animationMixer.isRunning())},k(e,[{key:"animationNames",get:function(){var e=[];if(this.animationClips)for(var t=0;t<this.animationClips.length;t++)e.push(this.animationClips[t].name);return e}}]),e}(),_e=function(e){function t(r){I(this,t);var i=N(this,e.call(this,r));return i._url="",i._textureAnimations=new Map,i._animationControl=null,i}return D(t,e),t.prototype.setupCustomKeys=function(e){var t=G.parseValue(e.ON_IU,"oniu"),r=G.parseValue(e.SJGN_IHT,"sjgniht"),i=G.parseValue(e.IJ_EKOU_NUOY,"ijekounuoy"),n=G.parseValue(e.RE_ISRAT,"reisrat");"naijil"!=t&&"NA_IJ_IL"!=t||(this.userData.bindFeatureOn=t),"auhnujuw"!=r&&"AU_HN_UJ_UW"!=r||(this.userData.SightTestOn=r),"nahoanehc"!=i&&"NA_HO_AN_EHC"!=i||(this.userData.LoopControlOn=i),"eilam"!=n&&"EI_LAM"!=n||(this.userData.bindFeatureOn=n)},t.prototype.setupAnimations=function(e){var t=e.animations,r=e.model;if(r&&(t||(t=r.animations)),t&&t.length){this._animationControl=new xe(this,t),this.addControl(this._animationControl);var i=e.animation;i&&this.playAnimation(i)}},t.prototype.setupTextureAnimations=function(){this._textureAnimations.clear();var e=this;this.node&&this.node.traverse(function(t){if(t.material){var r=[];Array.isArray(t.material)?r=t.material:r.push(t.material);for(var i=0;i<r.length;i++){var n=r[i];if(n.userData.gltfExtensions){var o=n.userData.gltfExtensions.baseColorTexture||n.userData.gltfExtensions.alphaTexture,a=!!n.userData.gltfExtensions.baseColorTexture;if(o&&(o.scrollAnim||o.rotateAnim||o.scaleAnim||o.multiFramesAnim||o.scroll)){var s={offset:[0,0],repeat:[1,1],rotation:0},l={offset:[0,0],repeat:[0,0],rotation:0,update:null};if(o.scroll&&(s.offset[0]=o.scroll[0],s.offset[1]=o.scroll[1]),o.scrollAnim&&(l.offset[0]-=o.scrollAnim[0],l.offset[1]-=o.scrollAnim[1]),o.rotateAnim&&(l.rotation+=o.rotateAnim/180*Math.PI),o.scaleAnim,o.multiFramesAnim){var c=o.multiFramesAnim.tilesX,u=o.multiFramesAnim.tilesY,h=c*u,p=1/o.multiFramesAnim.animSpeed||1;s.repeat[0]=1/c,s.repeat[1]=1/u;var d=0,f=0;l.update=function(e,t){for(d+=t;d>p;){d-=p,++f==h&&(f=0);var r=f%c;e.offset.x=r/c;var i=Math.floor(f/c);e.offset.y=i/u}}}var m=a?n.map:n.alphaMap;if(m){var g=m.clone();g.needsUpdate=!0,g.offset.set(s.offset[0],s.offset[1]),g.repeat.set(s.repeat[0],s.repeat[1]),g.wrapS=g.wrapT=THREE.RepeatWrapping,a?n.map=g:n.alphaMap=g,n.needsUpdate=!0,l.texture=g,e._textureAnimations.set(g.uuid,l),e.tickable=!0}}}}}})},t.prototype.customSetup=function(e){this.setupAnimations(e),this.setupTextureAnimations(e),this.setupCustomKeys(e)},t.prototype.loadFromURL=function(e,t){this._url=e.url,this.addControl(new Ee(this,e,t))},t.prototype.clearNode=function(){e.prototype.clearNode.call(this,!0),this._url&&(this.app.modelResource.unload(this._url),this._url=null)},t.prototype.clear=function(){this._textureAnimations.clear(),e.prototype.clear.call(this)},t.prototype.containAnimation=function(e){return!!this._animationControl&&this._animationControl.containAnimation(e)},t.prototype.playAnimation=function(e){if(e=e||{},this.loaded){if(G.isString(e))return this._stopAnimation(e),void this._playAnimation(e,null);var t=e.name;if(G.isString(t))return this._stopAnimation(t),void this._playAnimation(t,e);if(G.isArray(t)&&t.length){if(1==t.length)return this._stopAnimation(t[0]),void this._playAnimation(t[0],e);e=G.cloneObject(e);var r=G.parseArrayArgument(t,e,"speed"),i=G.parseArrayArgument(t,e,"reverse"),n=G.parseArrayArgument(t,e,"loop"),o=G.parseArrayArgument(t,e,"loopType"),a=G.parseArrayArgument(t,e,"loopTimes"),s=G.parseArrayArgument(t,e,"frames");this._stopAnimation(t);for(var l=0;l<t.length;l++)G.getArrayArgumentValue(e,"speed",r,l),G.getArrayArgumentValue(e,"reverse",i,l),G.getArrayArgumentValue(e,"loop",n,l),G.getArrayArgumentValue(e,"loopType",o,l),G.getArrayArgumentValue(e,"loopTimes",a,l),G.getArrayArgumentValue(e,"frames",s,l),this._playAnimation(t[l],e)}}else this.waitCommands.push({type:"PlayObjectAnimation",object:this,params:e})},t.prototype._stopAnimation=function(e){this._animationControl&&this._animationControl.stopAnimation(e)},t.prototype._playAnimation=function(e,t){this._animationControl&&!this._animationControl.playAnimation(e,t)||(this.tickable=!0)},t.prototype.stopAnimation=function(){this._animationControl&&this._animationControl.stopAnimation(),this.tickable=!1},t.prototype.isPlayingAnimation=function(){return!!this._animationControl&&this._animationControl.isPlayingAnimation()},t.prototype.update=function(t){var r=e.prototype.update.call(this,t);return this._textureAnimations.size>0?(this._textureAnimations.forEach(function(e){var r=e.texture;r&&(e.update?e.update(r,t):(r.offset.x+=e.offset[0]*t,r.offset.y+=e.offset[1]*t,r.repeat.x+=e.repeat[0]*t,r.repeat.y+=e.repeat[1]*t,r.rotation+=e.rotation*t,0!==e.rotation&&r.center.set(.5,.5)))}),!0):r},t.prototype.toJSON=function(){var t=e.prototype.toJSON.call(this);return t.type="Thing",this._url&&(t.url=this._url),t},k(t,[{key:"animationNames",get:function(){return this._animationControl?this._animationControl.animationNames:[]}},{key:"isOutdoors",get:function(){return!this.parents.query(".Building").length}},{key:"floor",get:function(){return this.parents.query(".Floor")[0]}},{key:"building",get:function(){return this.parents.query(".Building")[0]}},{key:"isThing",get:function(){return console.warn("[Thing] Please use 'instanceof THING.Thing' to replace '.Thing'"),this instanceof THING.Thing}}]),t}(ye),we=function(e){function t(r){I(this,t);var i=N(this,e.call(this,r));return i.sprite=null,i.spriteVisible=!0,i.onTop=!1,i.progress=0,i}return D(t,e),t.prototype.canNotQueryFromSelector=function(){return!0},t.prototype.customSetup=function(e){var t=e.scene,r=e.height,i=e.onTop,n=this.app.calcRect();this.onTop=i;var o=new THREE.SpriteMaterial({opacity:.8,color:34816,transparent:!0});this.sprite=new THREE.Sprite(o),this.sprite.scale.set(2*n.width,r,1),this.updatePosition(n.width,n.height),t.add(this.sprite)},t.prototype.updatePosition=function(e,t){if(void 0===e||void 0===t){var r=this.app.calcRect();e=r.width,t=r.height}var i=this.sprite,n=-e/2,o=this.onTop?t/2-i.scale.y/2:-t/2+i.scale.y/2;i.position.set(n,o,-10)},t.prototype.updateProgress=function(e){if(!this.sprite)return!1;if(this.progress==e)return!1;this.progress=e;var t=this.app.calcRect();if(e<1&&0!=e)this.sprite.visible=this.spriteVisible;else{var r=this;setTimeout(function(){r.sprite&&(r.spriteVisible=!1,r.sprite.visible=!1)},1e3)}var i=Math.max(1,2*t.width*e);return this.sprite.scale.x=i,!0},t.prototype.resize=function(e,t){if(this.sprite){this.updatePosition(e,t);var r=Math.max(1,2*e*this.progress);this.sprite.scale.x=r}},t.prototype.prepare=function(){this.sprite.scale.x=1e-4,this.spriteVisible=!0},k(t,[{key:"visible",set:function(e){this.spriteVisible=e},get:function(){return this.spriteVisible}},{key:"height",set:function(e){this.sprite.scale.y=e},get:function(){return this.sprite.scale.y}}]),t}(ye),Te={};!function(e){var t=Math.PI/180,r=48,i=57,n=44,o=32,a=46,s=45;e.transformSVGPath=function(e){function l(){for(var t,l,c,u=!1;m<g&&((l=e.charCodeAt(m))===n||l===o);)m++;for(t=l===s?m++:m;m<g;)if(l=e.charCodeAt(m),r<=l&&l<=i)m++;else{if(l!==a)return c=e.substring(t,m),u?parseFloat(c):parseInt(c);m++,u=!0}return c=e.substring(t),u?parseFloat(c):parseInt(c)}function c(){for(var t;m<g&&((t=e.charCodeAt(m))===n||t===o);)m++;return(t=e.charCodeAt(m))===s||r<=t&&t<=i}var u,h,p,d,f=new THREE.ShapePath,m=1,g=e.length,v=0,y=0,E=0,b=0,x=null,_=null,w=0,T=0,M=0,R=0,S=0,P=0,A=0,C=0,L=0;for(u=e[0];m<=g;){switch(d=!0,u){case"M":v=l(),y=l(),f.moveTo(v,y),u="L",x=v,_=y;break;case"m":v+=l(),y+=l(),f.moveTo(v,y),u="l",x=v,_=y;break;case"Z":case"z":d=!1,v===x&&y===_||f.lineTo(x,_);break;case"L":case"H":case"V":E="V"===u?v:l(),b="H"===u?y:l(),f.lineTo(E,b),v=E,y=b;break;case"l":case"h":case"v":E="v"===u?v:v+l(),b="h"===u?y:y+l(),f.lineTo(E,b),v=E,y=b;break;case"C":w=l(),M=l();case"S":"S"===u&&(w=2*v-T,M=2*y-R),T=l(),R=l(),E=l(),b=l(),f.bezierCurveTo(w,M,T,R,E,b),v=E,y=b;break;case"c":w=v+l(),M=y+l();case"s":"s"===u&&(w=2*v-T,M=2*y-R),T=v+l(),R=y+l(),E=v+l(),b=y+l(),f.bezierCurveTo(w,M,T,R,E,b),v=E,y=b;break;case"Q":w=l(),M=l();case"T":"T"===u&&(w=2*v-w,M=2*y-M),E=l(),b=l(),f.quadraticCurveTo(w,M,E,b),v=E,y=b;break;case"q":w=v+l(),M=y+l();case"t":"t"===u&&(w=2*v-w,M=2*y-M),E=v+l(),b=y+l(),f.quadraticCurveTo(w,M,E,b),v=E,y=b;break;case"A":S=l(),P=l(),A=l()*t,C=l(),L=l(),E=l(),b=l(),S!==P&&console.warn("Forcing elliptical arc to be a circular one:",S,P),w=Math.cos(A)*(v-E)/2+Math.sin(A)*(y-b)/2,M=-Math.sin(A)*(v-E)/2+Math.cos(A)*(y-b)/2;var O=Math.sqrt((S*S*P*P-S*S*M*M-P*P*w*w)/(S*S*M*M+P*P*w*w));C===L&&(O=-O),T=O*S*M/P,R=O*-P*w/S,h=Math.cos(A)*T-Math.sin(A)*R+(v+E)/2,p=Math.sin(A)*T+Math.cos(A)*R+(y+b)/2;var H=new THREE.Vector2(1,0),F=new THREE.Vector2((w-T)/S,(M-R)/P),I=Math.acos(H.dot(F)/H.length()/F.length());H.x*F.y-H.y*F.x<0&&(I=-I),H.x=(-w-T)/S,H.y=(-M-R)/P;var k=Math.acos(F.dot(H)/F.length()/H.length());F.x*H.y-F.y*H.x<0&&(k=-k),!L&&k>0&&(k-=2*Math.PI),L&&k<0&&(k+=2*Math.PI),f.absarc(h,p,S,I,I+k,L),v=E,y=b;break;default:throw new Error("Wrong path command: "+u)}d&&c()||(u=e[m++])}return f}}(Te);var Me=function(e){function t(r){return I(this,t),N(this,e.call(this,r))}return D(t,e),t.prototype.createMaterial=function(e){if(!e)return new THREE.MeshPhongMaterial({color:2200782});var t=e.color||2200782,r=e.opacity||1,i=r<1,n=e.image||null,o=null;if(n=this.app.confirmURL(n)){var a=new THREE.TextureLoader;a.setCrossOrigin("anonymous"),o=a.load(n)}var s=e.doubleSide||!1,l=new THREE.MeshPhongMaterial({color:t});return l.transparent=i,l.opacity=r,o&&(l.map=o),s&&(l.side=THREE.DoubleSide),l},t.prototype.createGeometry=function(e){return null},t.prototype.setup=function(t){var r=this.createGeometry(t);if(r){var i=this.createMaterial(t.style),n=new THREE.Mesh(r,i);n.castShadow=!0,n.receiveShadow=!0;var o=t.center;if(o){if("Bottom"==o){var a=t.height||1;n.translateY(.5*a);var s=new THREE.Group;s.add(n),this.node=s}}else this.node=n}this.node.traverse(function(e){e.userData.skipEnvMap=!0}),e.prototype.setup.call(this,t)},t.prototype.addPickableGround=function(e){var t=this.app.create({type:"Plane",width:e,height:e,visible:!1,parent:this,style:{doubleSide:!0}}),r=t.node;return r.userData.topNode=!0,r.userData.skipBoundingBox=!0,r.userData.skipOutline=!0,r.userData.independent=!0,r.userData.alwaysPickable=!0,r.canNotQueryFromSelector=!0,this.app.objectManager.addInteractableNode(r),t},t.prototype.pickGroundWorldPosition=function(e,t,r){if(G.isArray(t)&&void 0===r){var i=t;t=i[0],r=i[1]}var n=this.app.camera.getRaycaster(t,r).intersectObjectForcible(e.node);return n.length?n[0].point:null},t}(_e),Re=function(e){function t(r){I(this,t);var i=N(this,e.call(this,r));return i._width=0,i._height=0,i._depth=0,i._center="",i._lineStyle=null,i._lines=null,i}return D(t,e),t.prototype.createGeometry=function(e){this._width=e.width||1,this._height=e.height||1,this._depth=e.depth||1,this._center=e.center;var t=e.widthSegments||1,r=e.heightSegments||1,i=e.depthSegments||1;return new THREE.BoxGeometry(this._width,this._height,this._depth,t,r,i)},t.prototype.setup=function(t){e.prototype.setup.call(this,t),this._lineStyle=t.lineStyle,this._lineStyle&&(this._lines=this.setupLine())},t.prototype.setupLine=function(){var e=this._width,t=this._height,r=this._depth,i=this._lineStyle,n=e/2,o=r/2,a=t/2,s=-a,l=a,c=this._center;c&&"Bottom"==c&&(s+=a,l+=a);var u=[-n,s,-o],h=[n,s,-o],p=[-n,s,o],d=[n,s,o],f=[-n,l,-o],m=[n,l,-o],g=[-n,l,o],v=[n,l,o],y=[u,h,d,p,u],E=[f,m,v,g,f];return this.app.create({type:"Line",points:y,spaceType:le.Local,style:i,parent:this}),this.app.create({type:"Line",points:E,spaceType:le.Local,style:i,parent:this}),this.app.create({type:"Line",points:[u,f],spaceType:le.Local,style:i,parent:this}),this.app.create({type:"Line",points:[h,m],spaceType:le.Local,style:i,parent:this}),this.app.create({type:"Line",points:[d,v],spaceType:le.Local,style:i,parent:this}),this.app.create({type:"Line",points:[p,g],spaceType:le.Local,style:i,parent:this}),this.query(".Line",!1)},k(t,[{key:"lines",get:function(){return this._lines||(this._lines=this.setupLine()),this._lines}},{key:"isBox",get:function(){return console.warn("[Box] Please use 'instanceof THING.Box' to replace '.isBox'"),this instanceof THING.Box}}]),t}(Me),Se=function(e){function t(r){return I(this,t),N(this,e.call(this,r))}return D(t,e),t.prototype.createGeometry=function(e){var t=e.radius,r=e.segments,i=e.thetaStart,n=e.thetaLength;return new THREE.CircleGeometry(t,r,i,n)},t}(Me),Pe=function(e){function t(r){return I(this,t),N(this,e.call(this,r))}return D(t,e),t.prototype.createGeometry=function(e){var t=e.radius||50,r=e.widthSegments||8,i=e.heightSegments||6,n=e.phiStart||0,o=e.phiLength||2*Math.PI,a=e.thetaStart||0,s=e.thetaLength||Math.PI;return new THREE.SphereGeometry(t,r,i,n,o,a,s)},k(t,[{key:"isSphere",get:function(){return console.warn("[Sphere] Please use 'instanceof THING.Sphere' to replace '.isSphere'"),this instanceof THING.Sphere}}]),t}(Me),Ae=function(e){function t(r){I(this,t);var i=N(this,e.call(this,r));return i._ground=null,i._groundSize=0,i}return D(t,e),t.prototype.destroy=function(){this._ground&&this.app.objectManager.removeInteractableNode(this._ground.node),e.prototype.destroy.call(this)},t.prototype.createGeometry=function(e){var t=e.width||1,r=e.height||1,i=e.widthSegments||1,n=e.heightSegments||1;return new THREE.PlaneGeometry(t,r,i,n)},t.prototype.addPickableGround=function(t){this._groundSize=t.size,this._ground=e.prototype.addPickableGround.call(this,this._groundSize)},t.prototype.pickGroundWorldPosition=function(t,r){return e.prototype.pickGroundWorldPosition.call(this,this._ground,t,r)},k(t,[{key:"isPlane",get:function(){return console.warn("[Plane] Please use 'instanceof THING.Plane' to replace '.isPlane'"),this instanceof THING.Plane}}]),t}(Me),Ce=function(e){function t(r){I(this,t);var i=N(this,e.call(this,r));return i._grid=null,i._color1=null,i._color2=null,i._size=0,i._divisions=0,i}return D(t,e),t.prototype.setup=function(t){this._color1=G.parseColor(t.color1,16777215),this._color2=G.parseColor(t.color2,16777215),this._size=t.size||10,this._divisions=t.divisions||10,this._grid=new THREE.GridHelper(this._size,this._divisions,this._color1,this._color2),this.node.add(this._grid),e.prototype.setup.call(this,t)},k(t,[{key:"size",get:function(){return this._size}}]),t}(Me),Le=function(e){function t(r){return I(this,t),N(this,e.call(this,r))}return D(t,e),t.prototype.createGeometry=function(e){var t=e.height||1,r=e.radius||.5,i=e.radiusTop?e.radiusTop:r,n=e.radiusBottom?e.radiusBottom:r,o=e.radiusSegments||8,a=e.heightSegments||1,s=e.heightSegments||!1,l=e.heightSegments||0,c=e.heightSegments||2*Math.PI;return new THREE.CylinderGeometry(i,n,t,o,a,s,l,c)},k(t,[{key:"isCylinder",get:function(){return console.warn("[Cylinder] Please use 'instanceof THING.Cylinder' to replace '.isCylinder'"),this instanceof THING.Cylinder}}]),t}(Me),Oe=function(e){function t(r){return I(this,t),N(this,e.call(this,r))}return D(t,e),t.prototype.createGeometry=function(e){var t=e.radius||1,r=e.detail||0;return new THREE.TetrahedronGeometry(t,r)},k(t,[{key:"isTetrahedron",get:function(){return console.warn("[Tetrahedron] Please use 'instanceof THING.Tetrahedron' to replace '.isTetrahedron'"),this instanceof THING.Tetrahedron}}]),t}(Me),He=function(e){function t(r){I(this,t);var i=N(this,e.call(this,r));return i._vertices=null,i._height=0,i._lineStyle=null,i._lines=null,i}return D(t,e),t.prototype.addGeoObject=function(e,t){for(var r={generateTopUV:function(e,t,r,i,n){var o=t[3*r],a=t[3*r+1],s=t[3*i],l=t[3*i+1],c=t[3*n],u=t[3*n+1];return[new THREE.Vector2(o,a),new THREE.Vector2(s,l),new THREE.Vector2(c,u)]},generateSideWallUV:function(e,t,r,i,n,o){return[new THREE.Vector2(0,0),new THREE.Vector2(0,1),new THREE.Vector2(1,1),new THREE.Vector2(1,0)]}},i=Te.transformSVGPath(t.path),n=[new THREE.MeshPhongMaterial({transparent:!0}),new THREE.MeshPhongMaterial({transparent:!0})],o=i.toShapes(!0),a=0;a<o.length;a++){var s=o[a],l=new THREE.ExtrudeBufferGeometry(s,{depth:t.height,bevelEnabled:!1,UVGenerator:r}),c=new THREE.Matrix4;c.makeRotationFromEuler(G.parseEuler([90,0,0]));var u=new THREE.Matrix4;u.makeTranslation(t.center[0],t.height,t.center[1]),u.multiply(c);for(var h=l.attributes.position.array,p=0;p<h.length;p+=3){var d=new THREE.Vector3(h[p],h[p+1],h[p+2]);d.applyMatrix4(u),h[p]=d.x,h[p+1]=d.y,h[p+2]=d.z}l.computeVertexNormals();var f=new THREE.Mesh(l,n);e.add(f)}},t.prototype.setup=function(t){for(var r=t.vertices,i=t.center||[0,0],n=t.height,o={center:i,height:n,path:""},a=0;a<r.length;a++){var s=G.parseVector3(r[a]);o.path?o.path+="L":o.path+="M",o.path+=s.x.toString(),o.path+=",",o.path+=s.z.toString(),o.path+=" "}o.path+=" Z",this._vertices=r,this._height=n,this.addGeoObject(this.node,o),this._lineStyle=t.lineStyle,this._lineStyle&&(this._lines=this.setupLine()),e.prototype.setup.call(this,t)},t.prototype.setupLine=function(){for(var e=this._vertices,t=this._lineStyle,r=[],i=0;i<e.length;i++)r.push(e[i].concat());r.push(e[0].concat()),this.app.create({type:"Line",points:r,spaceType:le.Local,parent:this,style:t});for(var n=[],i=0;i<e.length;i++)n.push(e[i].concat());for(n.push(e[0].concat()),i=0;i<n.length;i++)n[i][1]+=this._height;for(this.app.create({type:"Line",points:n,spaceType:le.Local,parent:this,style:t}),i=0;i<e.length;i++){var o=[r[i].concat(),n[i].concat()];this.app.create({type:"Line",points:o,spaceType:le.Local,parent:this,style:t})}return this.query(".Line",!1)},k(t,[{key:"lines",get:function(){return this._lines||(this._lines=this.setupLine()),this._lines}}]),t}(Me),Fe=function(e){function t(r){I(this,t);var i=N(this,e.call(this,r));return i.isOpen=!1,i}return D(t,e),t.prototype.setup=function(t){e.prototype.setup.call(this,t),this.node&&null==this.node.parent&&this.parent.node.add(this.node)},t.prototype.open=function(){0!==this.animationNames.length&&this.playAnimation("Auto_Open"),this.isOpen=!0},t.prototype.close=function(){0!==this.animationNames.length&&this.playAnimation("Auto_Close"),this.isOpen=!1},k(t,[{key:"floor",get:function(){return this.parents.query(".Floor")[0]}},{key:"isDoor",get:function(){return console.warn("[Door] Please use 'instanceof THING.Door' to replace '.isDoor'"),this instanceof THING.Door}}]),t}(_e),Ie=function(e){function t(r){I(this,t);var i=N(this,e.call(this,r));return i.elevator=null,i}return D(t,e),t.prototype.setup=function(t){e.prototype.setup.call(this,t),this.levelNum=this.parent.levelNum},k(t,[{key:"owner",get:function(){return this.elevator}}]),t}(Fe),ke=function(e){function t(r){I(this,t);var i=N(this,e.call(this,r));return i.doors=[],i}return D(t,e),t.prototype.setup=function(t){if(e.prototype.setup.call(this,t),t.doors){this.doors=t.doors;for(var r=0;r<this.doors.length;r++)this.doors[r].elevator=this}},t.prototype.getDoor=function(e){for(var t=0;t<this.doors.length;t++){var r=this.doors[t];if(r.floor==e)return r}return r},t}(ye),De=function(e){function t(r){I(this,t);var i=N(this,e.call(this,r));return i.stair=null,i}return D(t,e),t.prototype.setup=function(t){e.prototype.setup.call(this,t)},k(t,[{key:"owner",get:function(){return this.stair}},{key:"isStairDoor",get:function(){return console.warn("[StairDoor] Please use 'instanceof THING.StairDoor' to replace '.StairDoor'"),this instanceof THING.StairDoor}}]),t}(Fe),Ne=function(e){function t(r){I(this,t);var i=N(this,e.call(this,r));return i.doors=[],i}return D(t,e),t.prototype.setup=function(t){if(e.prototype.setup.call(this,t),t.doors){this.doors=t.doors;for(var r=0;r<this.doors.length;r++)this.doors[r].stair=this}},t.prototype.getDoor=function(e){for(var t=0;t<this.doors.length;t++){var r=this.doors[t];if(r.floor==e)return r}return r},k(t,[{key:"isStair",get:function(){return console.warn("[Stair] Please use 'instanceof THING.Stair' to replace '.Stair'"),this instanceof THING.Stair}}]),t}(ye),je=function(e){function t(r){return I(this,t),N(this,e.call(this,r))}return D(t,e),t.prototype.customSetup=function(e){var t=e.width,r=e.height;if(t&&r){var i=new THREE.PlaneBufferGeometry(t,r),n=new THREE.MeshBasicMaterial({polygonOffset:!0,polygonOffsetFactor:10,polygonOffsetUnits:10}),o=new THREE.Mesh(i,n);o.rotation.x=-.5*Math.PI,o.position.x=0,o.position.y=-.1,o.position.z=0;for(var a=i.getAttribute("position").count,s=i.getAttribute("uv").array,l=0;l<a;l++)s[2*l+0]*=t,s[2*l+1]*=r;i.getAttribute("uv").needsUpdate=!0;var c=e.image;if(c){var u=this.app.confirmURL(c,"https://static.3dmomoda.com/textures");o.material.map=(new THREE.TextureLoader).load(u),o.material.map.wrapT=o.material.map.wrapS=THREE.RepeatWrapping}this.node.add(o)}},t}(ye),Ue=function(){function e(t){I(this,e),this.bundeObj=t,this.materialMap=new Map,this.combineBundleMeshs=[]}return e.prototype.combine=function(){this._combine(this.bundeObj,[],[],[])},e.prototype._combine=function(e,t,r,i){if(t.push(e.scale),i.push(e.position),r.push(e.quaternion),e instanceof THREE.Mesh){var n=new function e(t,r,i,n){I(this,e),this.positionArray=t.geometry.getAttribute("position").array.slice();var o=t.geometry.getAttribute("normal");o?this.normalArray=o.array.slice():console.warn("not has normal");var a=t.geometry.getAttribute("uv");a&&(this.uvArray=a.array);var s=t.geometry.getAttribute("uv2");s&&(this.uv2Array=s.array);var l=t.geometry.getAttribute("color");l&&(this.colorArray=l.array),this.indexArray=t.geometry.index.array,this.material=t.material;for(var c=this.positionArray,u=this.normalArray,h=0;h<c.length;){for(var p=n.length-1;p>-1;p--){var d=r[p],f=i[p],m=n[p];c[h]*=d.x,c[h+1]*=d.y,c[h+2]*=d.z;var g=new THREE.Vector3(c[h],c[h+1],c[h+2]);if(g=g.applyQuaternion(f),g.x+=m.x,g.y+=m.y,g.z+=m.z,c[h]=g.x,c[h+1]=g.y,c[h+2]=g.z,u){var v=new THREE.Vector3(u[h],u[h+1],u[h+2]);v=v.applyQuaternion(f),u[h]=v.x,u[h+1]=v.y,u[h+2]=v.z}}h+=3}this.vertexCount=this.positionArray.length/3,this.indexCount=this.indexArray.length}(e,t,r,i);0!==n.vertexCount&&(this.combineBundleMeshs.push(n),void 0===this.materialMap.get(n.material)&&this.materialMap.set(n.material,[]),this.materialMap.get(n.material).push(n))}if(0!==e.children.length)for(var o=0;o<e.children.length;o++){var a=r.slice(),s=t.slice(),l=i.slice();this._combine(e.children[o],s,a,l)}},e}(),Be=function e(){I(this,e),this.positions=[],this.scales=[],this.quaternions=[]},Ve=function(){function e(t){I(this,e),this.vertexCount=0,this.indexCount=0,this.material=t,this.bundeMeshs=[],this.transformations=[],this.maxCount=65534,this.combineMesh=null}return e.prototype.isExceed=function(e){return this.vertexCount+e>this.maxCount},e.prototype.add=function(e,t){if(this.isExceed(e.vertexCount))return console.error("combine exceed vertex count "),!1;this.vertexCount+=e.vertexCount,this.indexCount+=e.indexCount,this.bundeMeshs.push(e),this.transformations.push(t)},e.prototype.build=function(){for(var e=this.bundeMeshs,t=this.indexCount,r=this.vertexCount,i=new Float32Array(3*r),n=new Float32Array(3*r),o=new Float32Array(2*r),a=new Float32Array(4*r),s=new Float32Array(2*r),l=new Uint16Array(t),c=0,u=0,h=0,p=0,d=0,f=new THREE.BufferGeometry,m=0;m<e.length;m++){for(var g=e[m],v=this.transformations[m],y=v.positions,E=v.scales,b=v.quaternions,x=g.indexArray,_=0;_<x.length;_++)l[_+p]=c/3+x[_];p+=x.length;for(var w=g.positionArray,_=0;_<w.length;){for(var T=new THREE.Vector3(w[_],w[_+1],w[_+2]),M=y.length-1;M>-1;M--){var R=y[M],S=E[M],P=b[M];T.x*=S.x,T.y*=S.y,T.z*=S.z,(T=T.applyQuaternion(P)).x+=R.x,T.y+=R.y,T.z+=R.z}i[_+c]=T.x,i[_+c+1]=T.y,i[_+c+2]=T.z,_+=3}c+=w.length;for(var A=g.normalArray,_=0;_<A.length;){for(var C=new THREE.Vector3(A[_],A[_+1],A[_+2]),M=b.length-1;M>-1;M--)P=b[M],C=C.applyQuaternion(P);n[_+u]=C.x,n[_+u+1]=C.y,n[_+u+2]=C.z,_+=3}u+=A.length;var L=g.uvArray;if(L)for(_=0;_<L.length;_++)o[_+h]=L[_];var O=g.uv2Array;if(O)for(_=0;_<O.length;_++)s[_+h]=O[_];L&&(h+=L.length);var H=g.colorArray;if(H){for(_=0;_<H.length;_++)a[_+d]=H[_];d+=H.length}}f.addAttribute("position",new THREE.BufferAttribute(i,3)),f.addAttribute("normal",new THREE.BufferAttribute(n,3)),f.addAttribute("uv",new THREE.BufferAttribute(o,2)),0!==s.length&&f.addAttribute("uv2",new THREE.BufferAttribute(s,2)),0!==a.length&&f.addAttribute("color",new THREE.BufferAttribute(a,4)),f.setIndex(new THREE.BufferAttribute(l,1));var F=new THREE.Mesh(f,this.material);this.material.defines&&this.material.defines.USE_ALPHAINDEX&&delete this.material.defines.USE_ALPHAINDEX,F.name="combine",this.combineMesh=F},e}(),ze=function(){function e(t){I(this,e),this.app=t,this.combineBundleObjectMap={},this.processorMap=new Map,this.floorMaterialMap=new Map,this.processors=[]}return e.prototype.combineModels=function(){var e=this.app.modelResource.models,t=[],r=this;for(var i in e)t.push(new Promise(function(t,n){var o=performance.now(),a=new Ue(e[i].node);r.combineBundleObjectMap[i]=a,a.combine(),performance.now()-o>.1?setTimeout(function(){t()},10):t()}));return Promise.all(t)},e.prototype.getModelObject=function(e){return this.combineBundleObjectMap[e]||null},e.prototype.addPlacement=function(e,t,r,i,n){var o=this.floorMaterialMap.get(e);o||(o=new Map,this.floorMaterialMap.set(e,o));var a=this.processorMap.get(e);a||(this.processorMap.set(e,[]),a=this.processorMap.get(e));var s=new Be;s.positions=r,s.scales=i,s.quaternions=n,this.combineBundleObjectMap[t].materialMap.forEach(function(e,t,r){for(var i=e,n=t,l=0;l<i.length;l++){var c=i[l],u=o.get(n);u&&!u.isExceed(c.vertexCount)||(u=new Ve(n),o.set(n,u),a.push(u)),u.add(c,s)}})},e.prototype.getCombineProcessors=function(e,t,r,i){var n=[],o=new Map;for(var a in e){var s=e[a];if(!s.uid&&!s.name){var l=this.app.modelResource.bundleIDArray[s.bIdx],c=(this.app.modelResource.get(l).node,new THREE.Vector3(0,0,0)),u=new Be;if(s.pos){var h=s.pos.split(" ");c.x=parseFloat(h[0]),c.y=parseFloat(h[1]),c.z=-parseFloat(h[2])}var p=new THREE.Vector3(1,1,1);if(s.scl){var d=s.scl.split(" ");p.x=parseFloat(d[0]),p.y=parseFloat(d[1]),p.z=parseFloat(d[2])}var f=new THREE.Quaternion(0,0,0,1);if(s.rot){var m=s.rot.split(" ");f.x=parseFloat(m[0]),f.y=parseFloat(m[1]),f.z=-parseFloat(m[2]),f.w=-parseFloat(m[3])}var g=t.slice(),v=r.slice(),y=i.slice();y.push(f),v.push(p),g.push(c),u.positions=g,u.scales=v,u.quaternions=y,this.combineBundleObjectMap[l].materialMap.forEach(function(e,t,r){for(var i=e,a=t,s=0;s<i.length;s++){var l=i[s],c=o.get(a);c&&!c.isExceed(l.vertexCount)||(c=new Ve(a),o.set(a,c),n.push(c)),c.add(l,u)}})}}return n},e}(),qe=function(){function e(t,r){I(this,e),this.app=t,this.nodes=[],this.scene=this.app.scene,this.outdoors=this.app.outdoors,this.objectPool=this.app.objectPool,this.worldNode=new THREE.Object3D,this.campus=null,this.baseURL=null,this.curLoadGLTFIndex=0,this.splitLoadedGLTFCount=0,this.allLoadedGLTFCount=0,this.sliceRootNodeArray=[],this.sceneJsonData=null,this.states=null,this.combineManager=new ze(this.app),this.loadSpeed=.1,this.isCamFitScene=!0,r&&(r.position&&(this.campusPosition=r.position),r.rotation&&(this.campusRotation=r.rotation),void 0!==r.isCamFitScene&&null!==r.isCamFitScene&&(this.isCamFitScene=r.isCamFitScene),void 0!==r.isDelayLoadFloorPlan&&null!==r.isDelayLoadFloorPlan&&(this.isDelayLoadFloorPlan=r.isDelayLoadFloorPlan),r.campus&&(this.campus=r.campus))}return e.prototype.load=function(e){var t=this;return this.baseURL=e,this.scene.add(this.worldNode),new Promise(function(e,r){t.loadSceneJson().then(function(r){t.parseObjects().then(function(){e(t.campus)})}).then(function(){e(t.campus)}).catch(function(e){r(e)})})},e.prototype.loadSceneJson=function(){var e=this;return new Promise(function(t,r){new THREE.FileLoader(e.app.loadingManager).load(e.baseURL+"/scene.json",function(r){var i=JSON.parse(r);e.sceneJsonData=i,t(i)},function(e){},function(e){r("cant not load file: scene.json")})})},e.prototype.parseObjects=function(){var e=this.sceneJsonData,t=this;return new Promise(function(r,i){t.parse(e).then(function(){t.sliceRootNodeArray=[],r()}).catch(function(e){i(e)})})},e.prototype.parse=function(e){var t=this;return new Promise(function(r,i){t.parseWorld(e),r()})},e.prototype.parseWorld=function(e){var t=this.worldNode;if(null==this.campus&&(this.campus=this.app.objectManager.create({type:"Campus",name:"Campus",node:t}),this.app.scene.add(this.campus.node)),this.campusRotation&&this.campus.node.quaternion.set(this.campusRotation.x,this.campusRotation.y,this.campusRotation.z,this.campusRotation.w),this.campusPosition&&(this.campus.position=this.campusPosition),e.outdoors&&this.parseOutdoors(e.outdoors,t),e.buildings){var r=e.buildings;for(var i in r){var n=r[i],o=new THREE.Vector3(0,0,0),a=i,s=void 0;n.name&&(a=n.name),n.id&&(s=n.id);var l=new THREE.Object3D,c=this.app.objectManager.create({type:"Building",name:a,id:s,parent:this.campus,node:l});if(c.app=this.app,c.node.position.x=o.x,c.node.position.y=o.y,c.node.position.z=o.z,n.plans&&this.parseFloorPlans(n.plans,c),n.facades){var u=n.facades;for(var h in u)this.createThing(u[h],c,"Facade")}if(n.facadegroups){d=n.facadegroups;for(var p in d)n=d[p],this.createGroup(n,c,"Facade")}if(n.groups){var d=n.groups;for(var p in d)n=d[p],this.createGroup(n,c)}}}},e.prototype.parseOutdoors=function(e){var t=new THREE.Object3D;this.outdoors=this.app.objectManager.create({type:"Outdoors",name:"Outdoors",parent:this.campus,node:t}),this.app.outdoors||(this.app.outdoors=this.outdoors,this.app.currentParentObject=this.outdoors),this.processFloorPlanData(e,this.outdoors)},e.prototype.processFloorPlanData=function(e,t){t.app=this.app,e.placements&&this.parseThings(e.placements,t),e.videoprobes&&this.parseThings(e.videoprobes,t),e.groups&&this.parseGroups(e.groups,t),e.doororwindows&&this.parseDoorWins(e.doororwindows,t),e.rooms&&this.parseRooms(e.rooms,t)},e.prototype.parseRooms=function(e,t){for(var r=0;r<e.length;r++){var i=e[r],n=null;i.name&&(n=i.name);var o=new THREE.Object3D("room_temp"),a=null,s=i.properties;if(s){a={};for(var l in s){var c=s[l];a[l]=c}}var u=null,h=null,p=null,d={};if(i.area&&(h=i.area,d.area=h),i.circumference&&(p=i.circumference,d.circumference=p),i.center){var f=i.center;(u=new THREE.Vector3).set(f[0],f[1],-f[2]),d.center=u}this.app.objectManager.create({type:"Room",name:n,node:o,id:void 0,parent:t,properties:a,auxiliaryInfo:d})}},e.prototype.parseDoorWins=function(e,t){new THREE.Group("doors");for(var r in e){var i=e[r],n=r,o=void 0;i.name&&(n=i.name),i.id&&(o=i.id);var a=new THREE.Object3D("doororwin_temp"),s=null;if(i.properties){var l=i.properties;s={};for(var c in l){var u=l[c];s[c]=u}}this.app.objectManager.create({type:"Door",name:n,node:a,id:o,parent:t,properties:s})}},e.prototype.parseGroups=function(e,t){for(var r in e){var i=e[r];(i.name||i.properties)&&this.createGroup(i,t)}},e.prototype.createGroup=function(e,t){var r,i,n,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Thing",a=new THREE.Object3D("group_temp");e.id&&(r=e.id),e.name&&(i=e.name);var s=e.properties;if(s){n={};for(var l in s){var c=s[l];n[l]=c}}return this.app.objectManager.create({type:o,name:i,id:r,node:a,parent:t,properties:n})},e.prototype.parseFloorPlans=function(e,t){var r=[];for(var i in e){var n=e[i],o=n.id,a="";n.name&&(a=n.name);var s=new THREE.Object3D,l=this.app.objectManager.create({type:"Floor",name:a,id:o,node:s,parent:t});s.name="floorPlan",t.node.add(l.node),this.processFloorPlanData(n,l),r.push(l)}return r},e.prototype.parseThings=function(e,t,r){for(var i in e){var n=e[i];(n.name||n.properties)&&this.createThing(n,t,r)}},e.prototype.createThing=function(e,t,r){var i,n,o,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"Thing";e.id&&(i=e.id),e.name&&(n=e.name);var s=e.properties;if(s){o={};for(var l in s){var c=s[l];o[l]=c}}var u=new THREE.Object3D("temp_cannotuse");return this.app.objectManager.create({type:a,name:n,node:u,id:i,parent:t,properties:o})},e}(),Ge=function(){function e(t,r){if(I(this,e),this.app=t,this.resourceUrl=null,this.relativeResourceUrl=null,this.sceneJson=null,this.scale=1,this.curFloorPlan=null,this.tempTexture=null,this.indexJson=r,this.sceneJsonUri="scene.json",this.defaultWallTextureUri="Textures/RoomWall.jpg",this.defaultWallEdgeTextureUri="Textures/WallEdge.jpg",this.defaultFloorTextureUri="Textures/FloorDefault.jpg",this.defaultCeilingTextureUri="Textures/CeilingDefault.jpg",this.defaultRoofTextureUri="Textures/RoofDefault.jpg",this.defaultWallTexture=null,this.defaultCeilingTexture=null,this.defaultFloorTexture=null,this.defaultRoofTexture=null,this.defaultWallEdgeTexture=null,this.worldNode=new THREE.Object3D("world"),this.isCamFitScene=!0,this.campus=null,this.outdoorsVisible=!0,this.campusVisible=!0,this.enableUseHighestVersionResource=!0,this.worldNode,r&&(r.position&&(this.campusPosition=r.position),r.rotation&&(this.campusRotation=r.rotation),void 0!==r.isCamFitScene&&null!==r.isCamFitScene&&(this.isCamFitScene=r.isCamFitScene),r.scale&&(this.campusScale=r.scale),void 0!==r.outdoorsVisible&&(this.outdoorsVisible=r.outdoorsVisible),void 0!==r.campusVisible&&(this.campusVisible=r.campusVisible),r.campus&&(this.campus=r.campus),void 0!==r.enableUseHighestVersionResource&&(this.enableUseHighestVersionResource=r.enableUseHighestVersionResource,json2mesh.DefaultSetting.enableUseHighestVersionResource=this.enableUseHighestVersionResource)),this.campus&&(this.campusRotation&&this.campus.node.quaternion.set(this.campusRotation.x,this.campusRotation.y,this.campusRotation.z,this.campusRotation.w),this.campusPosition&&(this.campus.position=this.campusPosition),this.campusScale&&(this.campus.scale=this.campusScale)),r&&r.default){var i=r.default;i.sceneJson&&(this.sceneJson="export.json"),i.wallTexture&&(this.defaultWallTextureUri=i.wallTexture),i.wallEdgeTexture&&(this.defaultWallEdgeTextureUri=i.wallEdgeTexture),i.floorTexture&&(this.defaultFloorTextureUri=i.floorTexture),i.ceilingTexture&&(this.defaultCeilingTextureUri=i.ceilingTexture),i.roofTexture&&(this.defaultRoofTextureUri=i.roofTexture)}this.app.options.loaderResourceUrl&&(this.resourceUrl=this.app.options.loaderResourceUrl),void 0!=this.app.options.enableUseHighestVersionResource&&(this.enableUseHighestVersionResource=this.app.options.enableUseHighestVersionResource,json2mesh.DefaultSetting.enableUseHighestVersionResource=this.enableUseHighestVersionResource),this.app.options.resourceLibraryUrl&&(this.resourceUrl=this.app.options.resourceLibraryUrl),this.indexJson&&this.indexJson.resourceLibrary&&(this.relativeResourceUrl=this.indexJson.resourceLibrary)}return e.prototype.parseCamInfo=function(e){var t=e.eye,r=e.target,i=t.split(" "),n=r.split(" "),o=[Number(i[0]),Number(i[1]),Number(i[2])];o[2]=-o[2];var a=[Number(n[0]),Number(n[1]),Number(n[2])];a[2]=-a[2],this.app.camera.position=o,this.app.camera.target=a},e.prototype.exportJsonString=function(e){for(var t=e.outdoors,r=e.buildings,i=[],n=[],o=0;o<t.things.length;o++){var a=t.things[o];i.push({id:a.id,name:a.name})}for(o=0;o<t.rooms.length;o++)g=t.rooms[o],n.push({id:g.id,name:g.name});for(var s=[],o=0;o<r.length;o++){for(var l=r[o],c=[],u=0;u<l.floors.length;u++){for(var h=l.floors[u],p=[],d=[],f=0;f<h.things.length;f++){var m=h.things[f];p.push({id:m.id,name:m.name})}for(f=0;f<h.rooms.length;f++){var g=h.rooms[f];d.push({id:g.id,name:g.name})}c.push({id:h.id,name:h.name,placements:p,rooms:d})}s.push({id:l.id,name:l.name,plans:c})}return{id:e.id,name:e.name,outdoors:{id:t.id,name:t.name,placements:i,rooms:n},buildings:s}},e.prototype.load=function(e){var t=this;return this.sceneURL=e,this.relativeResourceUrl&&(this.resourceUrl=this.sceneURL+this.relativeResourceUrl),new Promise(function(e,r){t.updateProgress(.1),t.loadSceneJson().then(function(r){t.sceneJson=JSON.parse(r),t.sceneJson.camInfo&&t.isCamFitScene&&t.parseCamInfo(t.sceneJson.camInfo),t.updateProgress(.15);var i=new json2mesh.UBuilderSceneSimpleLoader;t.resourceUrl&&(i.resourceManager.baseTextureUrl=t.resourceUrl+"/texture/",i.resourceManager.baseModelUrl=t.resourceUrl+"/model/"),i.load({json:t.sceneJson,customModeBaseUrl:t.sceneURL+"/"}).then(function(r){t.parseWorld(r),t.updateProgress(.2),t.updateProgress(1),e(t.campus)})})})},e.prototype.loadSceneJson=function(){var e=this;return new Promise(function(t,r){new THREE.FileLoader(e.app.loadingManager).load(e.sceneURL+"/"+e.sceneJsonUri,function(e){t(e)})})},e.prototype.updateProgress=function(e){this.app.mainUI.updateLoadingProcess(e)},e.prototype.createTextureLoaderPromise=function(e){var t=this;return new Promise(function(r,i){(new THREE.TextureLoader).load(t.sceneURL+"/"+e,function(e){r(e)},function(t){console.log(e+" "+t.loaded/t.total*100+"% loaded")},function(t){console.log(e+"load error")})})},e.prototype.loadDefaultTexture=function(){var e=this;return new Promise(function(t,r){var i=e.createTextureLoaderPromise(e.defaultWallTextureUri),n=e.createTextureLoaderPromise(e.defaultWallEdgeTextureUri),o=e.createTextureLoaderPromise(e.defaultFloorTextureUri),a=e.createTextureLoaderPromise(e.defaultRoofTextureUri),s=e.createTextureLoaderPromise(e.defaultCeilingTextureUri);Promise.all([i,n,o,a,s]).then(function(e){DefaultResource.wallTexture=e[0],DefaultResource.wallEdgeTexture=e[1],DefaultResource.floorTexture=e[2],DefaultResource.ceilinngTexture=e[3],DefaultResource.roofTexture=e[4],t()})})},e.prototype.parseWorld=function(e){null===this.campus&&(this.campus=this.app.objectManager.create({uuid:e.id,id:e.userID,type:"Campus",name:"Campus",node:this.worldNode}),this.campus.visible=this.campusVisible,this.campusRotation&&this.campus.node.quaternion.set(this.campusRotation.x,this.campusRotation.y,this.campusRotation.z,this.campusRotation.w),this.campusPosition&&(this.campus.position=this.campusPosition),this.campusScale&&(this.campus.scale=this.campusScale));for(var t=0;t<e.buildings.length;t++){var r=e.buildings[t];this.parseBuilding(r)}if(e.outdoors){var i=new THREE.Object3D("outdoors");i.name="plan",this.outdoors=this.app.objectManager.create({uuid:e.outdoors.id,id:e.outdoors.userID,type:"Outdoors",name:e.outdoors.name,parent:this.campus,node:i}),this.outdoors.visible=this.outdoorsVisible,this.parseFloorPlan(e.outdoors,this.outdoors)}},e.prototype.parseBuilding=function(e){var t=new THREE.Object3D("building");t.name="building";var r=this.app.objectManager.create({uuid:e.id,id:e.userID,type:"Building",name:e.name,parent:this.campus,node:t,properties:e.properties});r.localPosition=e.position;for(var i=e.floorplans,n=e.facades,o=e.facadeGroups,a=0;a<n.length;a++)s=n[a],this.app.objectManager.create({type:"Facade",id:s.userID,name:s.name,uuid:s.id,node:s.delayObject,parent:r,properties:s.properties});for(a=0;a<o.length;a++){var s=o[a];this.app.objectManager.create({type:"Facade",uuid:s.id,id:s.userID,name:s.name,node:s.delayObject,parent:r,properties:s.properties})}for(var l=0;l<i.length;l++){var c=i[l],u=new THREE.Object3D("floorplan");u.name="plan";var h=this.app.objectManager.create({id:c.userID,uuid:c.id,type:"Floor",name:c.name,node:u,parent:r});h.localPosition=c.position,this.parseFloorPlan(c,h),0!==r.facades.length&&(h.node.visible=!1)}},e.prototype.placementInitCallback=function(e){this.app.objectManager.create({id:e.id,name:e.name,node:e.mesh,parent:plan,animations:e.resource.animations,properties:e.properties})},e.prototype.parseOutdoors=function(e){},e.prototype.parseFloorPlan=function(e,t){for(s=0;s<e.walls.length;s++)for(var r=e.walls[s],i=0;i<r.doorOrWindows.length;i++){var n=r.doorOrWindows[i];if(n.mesh){if(E=this.app.objectManager.create({type:"Door",uuid:n.id,id:n.userID,name:n.name,node:n.delayObject,parent:t,animations:n.resource.animations,properties:n.properties}),n.isOpen&&E.open(),E.animationClips)for(i=0;i<E.animationClips.length;i++){var o=E.animationClips[i];if("_defaultAnim_"===o.name){E.playAnimation({name:o.name,loop:!0,speed:.15});break}}}else n.initCompleteCallback=function(e){var r=m.app.objectManager.create({type:"Door",uuid:e.id,id:e.userID,name:e.name,node:e.mesh,parent:t,animations:e.resource.animations,properties:e.properties});if(t.miscNode.add(r.node),e.isOpen&&r.open(),r.animationClips)for(var i=0;i<r.animationClips.length;i++){var n=r.animationClips[i];if("_defaultAnim_"===n.name){r.playAnimation({name:n.name,loop:!0,speed:.15});break}}}}for(var a=new THREE.Object3D("combineFloor"),s=0;s<e.combineFloors.length;s++)x=e.combineFloors[s],a.add(x);t.node.add(a),t.floorNode=a;for(var l=new THREE.Object3D("combineCeiling"),s=0;s<e.combineCeilings.length;s++){var c=e.combineCeilings[s];l.add(c)}t.node.add(l),t.ceilingNode=l;for(var u=new THREE.Object3D("combineRoof"),s=0;s<e.combineRoofs.length;s++){var h=e.combineRoofs[s];u.add(h)}t.node.add(u),t.roofNode=u;for(var p=new THREE.Object3D("combinePlacement"),s=0;s<e.combinePlacements.length;s++)y=e.combinePlacements[s],p.add(y);t.node.add(p),t.miscNode=p;for(var d=new THREE.Object3D("combineWall"),f=0;f<e.combineStraightManualWalls.length;f++)r=e.combineStraightManualWalls[f],d.add(r);for(f=0;f<e.combineModelWalls.length;f++)r=e.combineModelWalls[f],d.add(r);for(f=0;f<e.combineDoorOrWins.length;f++)y=e.combineDoorOrWins[f],d.add(y);for(t.node.add(d),t.wallNode=d,s=0;s<e.groups.length;s++)g="Thing",(y=e.groups[s]).jsonData&&y.jsonData.type&&(g=y.jsonData.type),E=this.app.objectManager.create({uuid:y.id,id:y.userID,name:y.name,node:y.delayObject,type:g,parent:t,properties:y.properties});for(var m=this,s=0;s<e.placements.length;s++){var g="Thing";if((y=e.placements[s]).jsonData&&y.jsonData.type&&(g=y.jsonData.type),y.mesh){if((E=this.app.objectManager.create({uuid:y.id,id:y.userID,name:y.name,type:g,node:y.delayObject,parent:t,url:y.resource.getModelUrl(),animations:y.resource.animations,properties:y.properties})).bundleID=y.resource.modelID,E.bundleName=y.resource.modelName,y.isPlayAnim&&E.containAnimation(y.animClip)){var v={name:y.animClip,loop:!1,speed:.15};y.hasSkin&&(v.loop=!0),E.playAnimation(v)}}else y.initCompleteCallback=function(e){g="Thing",e.jsonData&&e.jsonData.type&&(g=e.jsonData.type);var r=m.app.objectManager.create({uuid:e.id,id:e.userID,name:e.name,node:e.mesh,parent:t,type:g,url:e.resource.getModelUrl(),animations:e.resource.animations,properties:e.properties});if(r.bundleID=e.resource.modelID,r.bundleName=e.resource.modelName,t.miscNode.add(r.node),e.isPlayAnim&&r.containAnimation(e.animClip)){var i={name:e.animClip,loop:!1,speed:.15};e.hasSkin&&(i.loop=!0),r.playAnimation(i)}}}for(s=0;s<e.videoprobes.length;s++){var y;if((y=e.videoprobes[s]).mesh)var E=this.app.objectManager.create({id:y.userID,name:y.name,uuid:y.id,node:y.delayObject,parent:t,url:y.resource.getModelUrl(),animations:y.resource.animations,properties:y.properties});else y.initCompleteCallback=function(e){var r=m.app.objectManager.create({id:e.userID,name:e.name,uuid:e.id,node:e.mesh,parent:t,url:e.resource.getModelUrl(),animations:e.resource.animations,properties:e.properties});t.miscNode.add(r.node)}}for(s=0;s<e.rooms.length;s++)var b=e.rooms[s],x=this.app.objectManager.create({type:"Room",name:b.name,node:b.mesh,uuid:b.id,id:b.userID,ceilingNode:b.ceiling.mesh,roofNode:b.roof.mesh,floorNode:b.floor.mesh,parent:t,properties:b.properties});for(s=0;s<e.curvelines.length;s++)_=e.curvelines[s],this.parseCurveLines(_,t);for(s=0;s<e.pipelines.length;s++){var _=e.pipelines[s];this.parsePipeLines(_,t)}},e.prototype.parsePipeLines=function(e,t){var r={type:"PolygonLine",name:e.name,points:e.points,id:e.userID,uuid:e.id,parent:t,style:{}};e.color&&(r.style.color="#"+e.color.getHexString());var i=this;if(e.resource)e.initCompleteCallback=function(t){r.image=t.resource.getTextureUrl();var n=i.app.objectManager.create(r);n.node.position.set(e.position.x,e.position.y,e.position.z),e.sectionType&&"Triangle"===e.sectionType&&(n.pathRadialSegments=3,n._updateByPoints()),e.radius&&(n.width=e.radius)};else{var n=i.app.objectManager.create(r);n.node.position.set(e.position.x,e.position.y,e.position.z),e.sectionType&&"Triangle"===e.sectionType&&(n.pathRadialSegments=3,n._updateByPoints()),e.radius&&(n.width=e.radius)}},e.prototype.parseCurveLines=function(e,t){var r={type:"RouteLine",parent:t,name:e.name,uuid:e.id,id:e.userID,points:e.points,arrowFlag:!1,style:{}},i=this;if(e.color&&(r.style.color="#"+e.color.getHexString()),e.resource)e.initCompleteCallback=function(t){if(t.resource.texture){var n=t.resource.texture.clone();n.rotation=Math.PI/2,r.image=n}var o=i.app.objectManager.create(r);null!==e.width&&(o.width=e.width),o.node.position.set(e.position.x,e.position.y,e.position.z)};else{var n=i.app.objectManager.create(r);null!==e.width&&(n.width=e.width),n.node.position.set(e.position.x,e.position.y,e.position.z)}},e}(),We=function(e,t){return t={exports:{}},function(e){!function(t){function r(e,t,r,o){var a=t&&t.prototype instanceof n?t:n,s=Object.create(a.prototype),l=new p(o||[]);return s._invoke=function(e,t,r){var n=w;return function(o,a){if(n===M)throw new Error("Generator is already running");if(n===R){if("throw"===o)throw a;return f()}for(r.method=o,r.arg=a;;){var s=r.delegate;if(s){var l=c(s,r);if(l){if(l===S)continue;return l}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(n===w)throw n=R,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n=M;var u=i(e,t,r);if("normal"===u.type){if(n=r.done?R:T,u.arg===S)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(n=R,r.method="throw",r.arg=u.arg)}}}(e,r,l),s}function i(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}function n(){}function o(){}function a(){}function s(e){["next","throw","return"].forEach(function(t){e[t]=function(e){return this._invoke(t,e)}})}function l(e){function t(r,n,o,a){var s=i(e[r],e,n);if("throw"!==s.type){var l=s.arg,c=l.value;return c&&"object"==typeof c&&v.call(c,"__await")?Promise.resolve(c.__await).then(function(e){t("next",e,o,a)},function(e){t("throw",e,o,a)}):Promise.resolve(c).then(function(e){l.value=e,o(l)},a)}a(s.arg)}var r;this._invoke=function(e,i){function n(){return new Promise(function(r,n){t(e,i,r,n)})}return r=r?r.then(n,n):n()}}function c(e,t){var r=e.iterator[t.method];if(r===m){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=m,c(e,t),"throw"===t.method))return S;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return S}var n=i(r,e.iterator,t.arg);if("throw"===n.type)return t.method="throw",t.arg=n.arg,t.delegate=null,S;var o=n.arg;return o?o.done?(t[e.resultName]=o.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=m),t.delegate=null,S):o:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,S)}function u(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function h(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function p(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(u,this),this.reset(!0)}function d(e){if(e){var t=e[E];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,i=function t(){for(;++r<e.length;)if(v.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=m,t.done=!0,t};return i.next=i}}return{next:f}}function f(){return{value:m,done:!0}}var m,g=Object.prototype,v=g.hasOwnProperty,y="function"==typeof Symbol?Symbol:{},E=y.iterator||"@@iterator",b=y.asyncIterator||"@@asyncIterator",x=y.toStringTag||"@@toStringTag",_=t.regeneratorRuntime;if(_)e.exports=_;else{(_=t.regeneratorRuntime=e.exports).wrap=r;var w="suspendedStart",T="suspendedYield",M="executing",R="completed",S={},P={};P[E]=function(){return this};var A=Object.getPrototypeOf,C=A&&A(A(d([])));C&&C!==g&&v.call(C,E)&&(P=C);var L=a.prototype=n.prototype=Object.create(P);o.prototype=L.constructor=a,a.constructor=o,a[x]=o.displayName="GeneratorFunction",_.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===o||"GeneratorFunction"===(t.displayName||t.name))},_.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,a):(e.__proto__=a,x in e||(e[x]="GeneratorFunction")),e.prototype=Object.create(L),e},_.awrap=function(e){return{__await:e}},s(l.prototype),l.prototype[b]=function(){return this},_.AsyncIterator=l,_.async=function(e,t,i,n){var o=new l(r(e,t,i,n));return _.isGeneratorFunction(t)?o:o.next().then(function(e){return e.done?e.value:o.next()})},s(L),L[x]="Generator",L[E]=function(){return this},L.toString=function(){return"[object Generator]"},_.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var i=t.pop();if(i in e)return r.value=i,r.done=!1,r}return r.done=!0,r}},_.values=d,p.prototype={constructor:p,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=m,this.done=!1,this.delegate=null,this.method="next",this.arg=m,this.tryEntries.forEach(h),!e)for(var t in this)"t"===t.charAt(0)&&v.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=m)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){function t(t,i){return o.type="throw",o.arg=e,r.next=t,i&&(r.method="next",r.arg=m),!!i}if(this.done)throw e;for(var r=this,i=this.tryEntries.length-1;i>=0;--i){var n=this.tryEntries[i],o=n.completion;if("root"===n.tryLoc)return t("end");if(n.tryLoc<=this.prev){var a=v.call(n,"catchLoc"),s=v.call(n,"finallyLoc");if(a&&s){if(this.prev<n.catchLoc)return t(n.catchLoc,!0);if(this.prev<n.finallyLoc)return t(n.finallyLoc)}else if(a){if(this.prev<n.catchLoc)return t(n.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<n.finallyLoc)return t(n.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&v.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var n=i;break}}n&&("break"===e||"continue"===e)&&n.tryLoc<=t&&t<=n.finallyLoc&&(n=null);var o=n?n.completion:{};return o.type=e,o.arg=t,n?(this.method="next",this.next=n.finallyLoc,S):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),S},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),h(r),S}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var i=r.completion;if("throw"===i.type){var n=i.arg;h(r)}return n}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:d(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=m),S}}}}(function(){return this}()||Function("return this")())}(t),t.exports}(),Xe=function(){return this}()||Function("return this")(),Ye=Xe.regeneratorRuntime&&Object.getOwnPropertyNames(Xe).indexOf("regeneratorRuntime")>=0,Qe=Ye&&Xe.regeneratorRuntime;Xe.regeneratorRuntime=void 0;var Je=We;if(Ye)Xe.regeneratorRuntime=Qe;else try{delete Xe.regeneratorRuntime}catch(lr){Xe.regeneratorRuntime=void 0}var Ke=Je,Ze=function(){function e(t){I(this,e),this.app=t,this.nodes=[],this.scene=this.app.scene,this.objectPool=this.app.objectPool,this.worldNode=new THREE.Object3D,this.app.scene.add(this.worldNode),this.baseURL=t.sceneURL,this.curLoadGLTFIndex=0,this.splitLoadedGLTFCount=0,this.allLoadedGLTFCount=0,this.sliceRootNodeArray=[],this.sceneJsonData=null,this.states=null,this.combineManager=new ze(this.app),this.combineProcessorMap=new Map,this.loadSpeed=.1}return e.prototype.load=function(){var e=this;return new Promise(function(t,r){e.loadSceneJson().then(function(t){return t.camInfo&&(e.parseCamInfo(t.camInfo),e.app.camera.update()),e.sceneJsonData=t,e.loadStructureJson()}).then(function(t){var r=e.getSortedStructureGLTFs(t);return new Promise(function(t,i){e.loadStructure(r,function(){e.parseObjects().then(function(){t(e.worldNode)})})})}).then(function(){t(e.worldNode)}).catch(function(e){r(e)})})},e.prototype.loadSceneJson=function(){var e=this;return new Promise(function(t,r){(new THREE.FileLoader).load(e.baseURL+"/scene.json",function(e){var r=JSON.parse(e);t(r)},function(e){},function(e){r("cant not load file: scene.json")})})},e.prototype.loadStructureJson=function(){var e=this;return new Promise(function(t,r){(new THREE.FileLoader).load(e.baseURL+"/structure.json",function(e){var r=JSON.parse(e);t(r)},function(){},function(e){r("cant not load file: structure.json")})})},e.prototype.loadStructure=function(e,t,r){this.splitLoadedGLTFCount=0;var i=this,n=0;if(0==e.length)t&&t();else for(var o=i.curLoadGLTFIndex;o<e.length&&(0==n||n%10!=0);o++){n++,i.curLoadGLTFIndex++;var a=new THREE.GLTFLoader(i.app.loadingManager);a.setCrossOrigin("anonymous"),a.load(i.baseURL+"/"+e[o].path,function(n){var o=n.scene.children[0].children[0];i.nodes[o.name]=o,i.sliceRootNodeArray.push(o),o.traverse(function(e){i.nodes[e.name]=e}),i.splitLoadedGLTFCount++,i.allLoadedGLTFCount++,10===i.splitLoadedGLTFCount&&i.loadStructure(e,t,r),i.app.scene.add(o),i.allLoadedGLTFCount==e.length&&t&&t()},function(){},function(t){r&&r("load "+i.baseURL+"/"+e[o].path+" failed")})}},e.prototype.parseObjects=function(){var e=this.sceneJsonData,t=this;return e.bIdList?new Promise(function(r,i){t.parseBundleList(e.bIdList).then(function(){return t.parse(e)}).then(function(){t.sliceRootNodeArray=[],r()}).catch(function(e){i(e)})}):new Promise(function(r,i){t.parse(e).then(function(){t.sliceRootNodeArray=[],r()}).catch(function(e){i(e)})})},e.prototype.getSortedStructureGLTFs=function(e){var t=[],r=[],i=[],n=e.outdoors,o=e.buildings;for(var a in n){var s=n[a];t.push(s)}for(l=0;l<t.length;l++)if(c=t[l],0!=r.length)for(u=0;u<r.length;u++){if(h=r[u],c.size<h.size){r.splice(u,0,c);break}if(u==r.length-1){r.push(c);break}}else r.push(t[l]);t=[];for(var a in o)t.push(o[a]);for(var l=0;l<t.length;l++){var c=t[l];if(0!=i.length)for(var u=0;u<i.length;u++){var h=i[u];if(c.size<h.size){i.splice(u,0,c);break}if(u==i.length-1){i.push(c);break}}else i.push(t[l])}return r.concat(i)},e.prototype._nestingLoopYield=function(e,t,r){var i=this,n=e.next();if(n.done)return t&&t(),n.value;var o=n.value;n.done,o instanceof Promise?o.then(function(n){return i._nestingLoopYield(e,t,r)}).catch(function(e){r(e)}):this._nestingLoopYield(e,t,r)},e.prototype.parse=function(e){var t=this;return this.combineManager.combineModels().then(function(){return new Promise(function(r,i){if(e.objects){var n=e.objects,o=null;for(var a in n){o=n[a];break}t._nestingLoopYield(t.parseWorld(o),function(){r()})}if(e.camInfo){var s=e.camInfo;t.parseCamInfo(s)}})})},e.prototype.parseCamInfo=function(e){var t=e.eye,r=e.target,i=t.split(" "),n=r.split(" "),o=[Number(i[0]),Number(i[1]),Number(i[2])];o[2]=-o[2];var a=[Number(n[0]),Number(n[1]),Number(n[2])];a[2]=-a[2],this.app.camera.position=o,this.app.camera.target=a},e.prototype.parseWorld=function(e){function t(e){var t,i,n,o,a,s,l,c,u;return Ke.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:t=v.loadSpeed,i=10,n=e.keys(),o=Array.isArray(n),a=0,n=o?n:n[Symbol.iterator]();case 3:if(!o){r.next=9;break}if(!(a>=n.length)){r.next=6;break}return r.abrupt("break",24);case 6:s=n[a++],r.next=13;break;case 9:if(!(a=n.next()).done){r.next=12;break}return r.abrupt("break",24);case 12:s=a.value;case 13:l=s,c=e.get(l),u=0;case 16:if(!(u<c.length)){r.next=22;break}return r.next=19,new Promise(function(e,r){var n=performance.now();c[u].build();var o=c[u].combineMesh;l.node.add(o),performance.now()-n>t?setTimeout(function(){e()},i):e()});case 19:u++,r.next=16;break;case 22:r.next=3;break;case 24:case"end":return r.stop()}},r,this)}var r=Ke.mark(t),i=this.worldNode;if(e.plan&&this.parseOutdoors(e.plan,i),e.bds){var n=e.bds;for(var o in n){var a=n[o],s=new THREE.Vector3(0,0,0);if(a.pos){var l=a.pos.split(" ");s.x=parseFloat(l[0]),s.y=parseFloat(l[1]),s.z=-parseFloat(l[2])}var c=new THREE.Object3D,u=this.app.objectManager.create({type:"Building",name:o,node:c});if(u.name=o,u.app=this.app,u.id=o,i.add(c),a.plans&&this.parseFloorPlans(a.plans,u),a.facades){var h=a.facades;for(var p in h){var d=this.createThing(h[p],u,null,"Facade"),f=d.node.position;f.x+=s.x,f.y+=s.y,f.z+=s.z,d.node.position.set(f.x,f.y,f.z)}}if(a.groups){var m=a.groups;for(var g in m)a=m[g],this.createGroup(a,u)}}}var v=this;return t(this.combineProcessorMap)},e.prototype.parseOutdoors=function(e,t){var r,i;for(var n in e){i=e[n],r=n;break}var o=this.app.outdoors;this.worldNode.add(o.node),this.processFloorPlanData(r,i,o)},e.prototype.processFloorPlanData=function(e,t,r){r.name=e,r.app=this.app,r.id=e;var i=new THREE.Vector3(0,0,0);if(t.pos){var n=t.pos.split(" ");i.x=parseFloat(n[0]),i.y=parseFloat(n[1]),i.z=-parseFloat(n[2])}var o=t.cwalls;if(o){var a=new THREE.Group;a.name="combinewall";for(var s in o){var l=o[s].gltfid,c=this.nodes[l];c&&a.add(c)}r.node.add(a),a.updateMatrixWorld(),r.wallNode=a}var u=t.croofs;if(u){var h=new THREE.Group;h.name="combineroof";for(var s in u){var l=u[s].gltfid,p=this.nodes[l];p&&h.add(p)}r.node.add(h),r.roofNode=h}var d=t.cceilings;if(d){var f=new THREE.Group;f.name="combineceiling";for(var s in d){var l=d[s].gltfid,m=this.nodes[l];m&&f.add(m)}r.node.add(f),r.ceilNode=f}if(v=t.cfloors){var g=new THREE.Group;g.name="combinefloor";for(var s in v){var v;if(l=(v=v[s]).gltfid){var y=this.nodes[l];y&&g.add(y)}}r.node.add(g),r.floorNode=g}var E=new THREE.Group;E.name="combinePlacement",r.miscNode=E,r.node.add(E);var b=t.cplcs;if(b)for(var s in b){var l=b[s].gltfid,x=this.nodes[l];x&&(E.add(x),x.updateMatrixWorld())}if(t.plcs){var _=this.combineManager.getCombineProcessors(t.plcs,[i],[new THREE.Vector3(1,1,1)],[new THREE.Quaternion(0,0,0,1)]);this.combineProcessorMap.set(r,_),this.parseThings(t.plcs,r,i)}t.routes&&this.parseStructureThing(t.routes,r),t.pipelines&&this.parseStructureThing(t.pipelines,r),t.curvelines&&this.parseStructureThing(t.curvelines,r),t.arrowlines&&this.parseStructureThing(t.arrowlines,r),t.arrowdatalines&&this.parseStructureThing(t.arrowdatalines,r),t.leakwaterlines&&this.parseStructureThing(t.leakwaterlines,r),t.vps&&this.parseThings(t.vps,r,i),t.groups&&this.parseGroups(t.groups,r,[new THREE.Vector3(1,1,1)],[new THREE.Quaternion(0,0,0,1)],[i],i),t.dws&&this.parseDoorWins(t.dws,r,i)},e.prototype.parseDoorWins=function(e,t,r){for(var i in e){var n=e[i],o=i;n.uid&&(o=n.uid);var a=null;if(n.gltfid){var s=n.gltfid;this.nodes[s]&&((a=this.nodes[s]).position.x+=r.x,a.position.y+=r.y,a.position.z+=r.z,t.node.add(a))}var l=null;if(n.prop){var c=n.prop;l={};for(var u in c){var h=c[u];l[u]=h}}this.app.objectManager.create({type:"Door",name:o,node:a,parent:t,properties:l})}},e.prototype.parseGroups=function(e,t,r,i,n,o){for(var a in e){var s=e[a];s.uid?this.createGroup(s,t):this.combineGroup(s,t,r,i,n,o)}},e.prototype.createGroup=function(e,t){var r,i,n=this.instanceGroup(e);e.id&&e.id,e.uid&&(r=e.uid);var o=e.prop;if(o){i={};for(var a in o){var s=o[a];i[a]=s}}return this.app.objectManager.create({type:"Thing",name:r,node:n,parent:t,properties:i})},e.prototype.parseFloorPlans=function(e,t){var r=[];for(var i in e){var n=e[i],o=new THREE.Object3D,a=this.app.objectManager.create({type:"Floor",name:i,node:o,parent:t});a.id=i,o.name="floorPlan",t.node.add(a.node),this.processFloorPlanData(i,n,a),a._parent=t,r.push(a)}return r},e.prototype.parseBundleList=function(e){this.app.modelResource.bundleIDArray=e;var t=0,r=this;return new Promise(function(i,n){0!=e.length?e.forEach(function(o){var a=new THREE.GLTFLoader(r.app.loadingManager);a.setCrossOrigin("anonymous"),a.load(r.baseURL+"/"+o+"/scene.gltf",function(n){t++,r.app.modelResource.set(o,n.scene.children[0].children[0]),t==e.length&&i()},function(){},function(e){n("can not load "+r.baseURL+"/"+o+"/scene.gltf")})}):i()})},e.prototype.combineGroup=function(e,t,r,i,n,o){var a=e,s=new THREE.Vector3(0,0,0);if(a.pos){var l=a.pos.split(" ");s.x=parseFloat(l[0]),s.y=parseFloat(l[1]),s.z=-parseFloat(l[2])}var c=new THREE.Vector3(1,1,1);a.scl&&(h=a.scl.split(" "),c.x=parseFloat(h[0]),c.y=parseFloat(h[1]),c.z=parseFloat(h[2]));var u=new THREE.Quaternion(0,0,0,1);if(a.rot){var h=a.rot.split(" ");u.x=parseFloat(h[0]),u.y=parseFloat(h[1]),u.z=-parseFloat(h[2]),u.w=-parseFloat(h[3])}var p,d,f;if(n?(p=r.slice(),f=i.slice(),d=n.slice()):(p=[],d=[],f=[]),p.push(c),d.push(s),f.push(u),a.plcs){var m=this.combineManager.getCombineProcessors(a.plcs,d,p,f),g=this.combineProcessorMap.get(t);g&&(m=g.concat(m)),this.combineProcessorMap.set(t,m)}if(a.groups)for(var v in a.groups)this.combineGroup(a.groups[v],t,p,f,d,o)},e.prototype.instanceGroup=function(e){var t=new THREE.Vector3(0,0,0);if(e.pos){var r=e.pos.split(" ");t.x=parseFloat(r[0]),t.y=parseFloat(r[1]),t.z=-parseFloat(r[2])}var i=new THREE.Vector3(1,1,1);e.scl&&(o=e.scl.split(" "),i.x=parseFloat(o[0]),i.y=parseFloat(o[1]),i.z=parseFloat(o[2]));var n=new THREE.Quaternion(0,0,0,1);if(e.rot){var o=e.rot.split(" ");n.x=parseFloat(o[0]),n.y=parseFloat(o[1]),n.z=-parseFloat(o[2]),n.w=-parseFloat(o[3])}var a=new THREE.Group;if(e.plcs)for(var s in e.plcs)l=this.instanceChildOfGroup(e.plcs[s]),a.add(l);if(e.groups)for(var s in e.groups){var l=this.instanceGroup(e.plcs[s]);a.add(l)}return a.scale.copy(i),a.setRotationFromQuaternion(n),a.position.copy(t),a},e.prototype.instanceChildOfGroup=function(e){var t=this.app.modelResource.bundleIDArray[e.bIdx],r=this.app.modelResource.get(t).node.clone();if(e.pos&&(i=e.pos.split(" "),r.position.x=parseFloat(i[0]),r.position.y=parseFloat(i[1]),r.position.z=-parseFloat(i[2])),e.rot){var i=e.rot.split(" "),n=new THREE.Quaternion;n.x=parseFloat(i[0]),n.y=parseFloat(i[1]),n.z=-parseFloat(i[2]),n.w=-parseFloat(i[3]),r.setRotationFromQuaternion(n)}return r},e.prototype.parseThings=function(e,t,r){for(var i in e){var n=e[i];(n.uid||n.prop)&&this.createThing(n,t,r)}},e.prototype.createThing=function(e,t,r){var i,n,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"Thing";e.id&&e.id,e.uid&&(i=e.uid);var a=e.prop;if(a){n={};for(var s in a){var l=a[s];n[s]=l}}var c=this.app.modelResource.bundleIDArray[e.bIdx],u=this.app.modelResource.get(c).node.clone();if(e.pos){var h=e.pos.split(" "),p=new THREE.Vector3(parseFloat(h[0]),parseFloat(h[1]),-parseFloat(h[2]));r&&(p.x+=r.x,p.y+=r.y,p.z+=r.z),u.position.x=p.x,u.position.y=p.y,u.position.z=p.z}if(e.rot){var h=e.rot.split(" "),d=new THREE.Quaternion;d.x=parseFloat(h[0]),d.y=parseFloat(h[1]),d.z=-parseFloat(h[2]),d.w=-parseFloat(h[3]),u.setRotationFromQuaternion(d)}if(e.scl){var h=e.scl.split(" "),f=new THREE.Vector3;f.x=parseFloat(h[0]),f.y=parseFloat(h[1]),f.z=-parseFloat(h[2]),u.scale.x=f.x,u.scale.y=f.y,u.scale.z=f.z}return this.app.objectManager.create({type:o,name:i,node:u,parent:t,properties:n})},e.prototype.parseStructureThing=function(e,t,r){for(var i in e){var n=e[i];if(n.gltfid){var o=new _e(this.app);o.name=i,o.app=this.app,n.id&&(o.id=n.id),n.uid&&(o.name=n.uid);var a=n.gltfid;if(this.nodes[a]){var s=this.nodes[a];o.node=s,t.add(o),r&&(s.position.x=r.x,s.position.y=r.y,s.position.z=r.z)}}}},e}(),$e=function(){function e(t,r){I(this,e),this.app=t,this.nodes=[],this.outdoors=this.app.outdoors,this.objectPool=this.app.objectPool,this.worldNode=new THREE.Object3D,this.worldNode.name="world",this.campus=null,this.baseURL=null,this.curLoadGLTFIndex=0,this.splitLoadedGLTFCount=0,this.allLoadedGLTFCount=0,this.sliceRootNodeArray=[],this.sceneJsonData=null,this.states=null,this.combineManager=new ze(this.app),this.loadSpeed=.1,this.isCamFitScene=!0,this.loadStageWeight=[.1,.1,.3,.5],this.loadedProgress=0,this.curStageLoadProgress=0,this.isDelayLoadFloorPlan=!1,this.envMap=null,this.appFirstTimeLoad=!1,this.outdoors?this.appFirstTimeLoad=!1:this.appFirstTimeLoad=!0,r&&(r.position&&(this.campusPosition=r.position),r.rotation&&(this.campusRotation=r.rotation),void 0!==r.isCamFitScene&&null!==r.isCamFitScene&&(this.isCamFitScene=r.isCamFitScene),void 0!==r.isDelayLoadFloorPlan&&null!==r.isDelayLoadFloorPlan&&(this.isDelayLoadFloorPlan=r.isDelayLoadFloorPlan),r.campus&&(this.campus=r.campus));var i=this.worldNode;null==this.campus&&(this.campus=this.app.objectManager.create({type:"Campus",name:"Campus",node:i}),this.app.scene.add(this.campus.node)),this.campusRotation&&this.campus.node.quaternion.set(this.campusRotation.x,this.campusRotation.y,this.campusRotation.z,this.campusRotation.w),this.campusPosition&&(this.campus.position=this.campusPosition),this.scene=this.campus.node}return e.prototype.updateProgress=function(e){this.app.mainUI.updateLoadingProcess(e)},e.prototype.loadSkybox=function(){if(this.sceneJsonData.skybox){for(var e=this.sceneJsonData.skybox,t=0;t<e.length;t++){var r=e[t];r=this.baseURL+r,e[t]=r}var i=this;return new Promise(function(t,r){(new THREE.CubeTextureLoader).load(e,function(e){e.flipY=!0,i.envMap=e,t()},null,function(){console.warn("load skybox fail"),t()})})}return new Promise(function(e,t){e()})},e.prototype.load=function(e){var t=this;return this.baseURL=e,new Promise(function(e,r){t.loadSceneJson().then(function(e){return e.camInfo&&t.isCamFitScene&&t.parseCamInfo(e.camInfo),t.sceneJsonData=e,t.updateProgress(.1),t.loadSkybox().then(function(){return t.loadStructureJson()})}).then(function(e){t.updateProgress(.2);var r=t.getSortedStructureGLTFs(e);return new Promise(function(e,i){t.updateProgress(.3),t.loadStructure(r,function(){t.updateProgress(.7),t.parseObjects().then(function(){t.updateProgress(.8),e(t.campus)})})})}).then(function(){t.updateProgress(1),e(t.campus)}).catch(function(e){r(e)})})},e.prototype.loadSceneJson=function(){var e=this;return new Promise(function(t,r){(new THREE.FileLoader).load(e.baseURL+"/scene.json",function(e){var r=JSON.parse(e);t(r)},function(e){},function(e){r("cant not load file: scene.json")})})},e.prototype.loadStructureJson=function(){var e=this;return new Promise(function(t,r){(new THREE.FileLoader).load(e.baseURL+"/structure.json",function(e){var r=JSON.parse(e);t(r)},function(){},function(e){r("cant not load file: structure.json")})})},e.prototype.addEnvMap=function(e){var t=this;this.envMap&&e.traverse(function(e){e.material&&(e.material.opacity<1&&!e.material.transparent&&(e.material.transparent=!0,e.material.needsUpdate=!0),e.material.transparent&&(e.material.metalness=1,e.material.roughness=0,e.material.envMap=t.envMap,e.material.envMapIntensity=2,e.material.refractionRatio=1,e.material.needsUpdate=!0),e.material.isMeshStandardMaterial&&(e.material.envMap=t.envMap,e.material.envMapIntensity=1,e.material.refractionRatio=1,e.material.needsUpdate=!0))})},e.prototype.loadStructure=function(e,t,r){this.splitLoadedGLTFCount=0;var i=this,n=0;if(0==e.length)t&&t();else for(var o=i.curLoadGLTFIndex;o<e.length&&(0==n||n%10!=0);o++){n++,i.curLoadGLTFIndex++;var a=new THREE.GLTFLoader;a.setCrossOrigin("anonymous");var s=e[o];a.load(i.baseURL+"/"+s.path,function(n){var o=n.scene.children[0].children[0];i.nodes[o.name]=o,i.sliceRootNodeArray.push(o),o.traverse(function(e){i.nodes[e.name]=e}),i.splitLoadedGLTFCount++,i.allLoadedGLTFCount++,10===i.splitLoadedGLTFCount&&i.loadStructure(e,t,r),(void 0===s.show||s.show)&&i.scene.add(o),i.addEnvMap(o),o.updateMatrixWorld(),i.scene.updateMatrixWorld(!0),i.allLoadedGLTFCount==e.length&&t&&t()},function(){},function(t){r?r("load "+i.baseURL+"/"+e[o].path+" failed"):console.error("load "+i.baseURL+"/"+s.path+" failed"),console.error(t)})}},e.prototype.parseObjects=function(){var e=this.sceneJsonData,t=this;return e.models?new Promise(function(r,i){t.parseBundleList(e.models).then(function(){return t.parse(e)}).then(function(){t.sliceRootNodeArray=[],r()}).catch(function(e){i(e)})}):new Promise(function(r,i){t.parse(e).then(function(){t.sliceRootNodeArray=[],r()}).catch(function(e){i(e)})})},e.prototype.getSortedStructureGLTFs=function(e){var t=[],r=[],i=[],n=e.outdoors,o=e.buildings;for(var a in n){var s=n[a];t.push(s)}for(l=0;l<t.length;l++)if(c=t[l],0!=r.length)for(u=0;u<r.length;u++){if(h=r[u],c.size<h.size){r.splice(u,0,c);break}if(u==r.length-1){r.push(c);break}}else r.push(t[l]);t=[];for(var a in o)t.push(o[a]);for(var l=0;l<t.length;l++){var c=t[l];if(0!=i.length)for(var u=0;u<i.length;u++){var h=i[u];if(c.size<h.size){i.splice(u,0,c);break}if(u==i.length-1){i.push(c);break}}else i.push(t[l])}return r.concat(i)},e.prototype._nestingLoopYield=function(e,t,r){var i=this,n=e.next();if(n.done)return t&&t(),n.value;var o=n.value;n.done,o instanceof Promise?o.then(function(n){return i._nestingLoopYield(e,t,r)}).catch(function(e){r(e)}):this._nestingLoopYield(e,t,r)},e.prototype.parse=function(e){var t=this;return this.combineManager.combineModels().then(function(){return new Promise(function(r,i){var n=t.parseWorld(e);if(n?t._nestingLoopYield(n,function(){r()},function(e){i(e)}):r(),e.camInfo&&t.isCamFitScene){var o=e.camInfo;t.parseCamInfo(o)}})})},e.prototype.parseCamInfo=function(e){var t=e.eye,r=e.target,i=t.split(" "),n=r.split(" "),o=[Number(i[0]),Number(i[1]),Number(i[2])];o[2]=-o[2];var a=[Number(n[0]),Number(n[1]),Number(n[2])];a[2]=-a[2],this.app.camera.position=o,this.app.camera.target=a},e.prototype.parseWorld=function(e){function t(e){var t,i,n,o,a,s,l,c,u;return Ke.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:t=x.loadSpeed,i=10,n=e.keys(),o=Array.isArray(n),a=0,n=o?n:n[Symbol.iterator]();case 3:if(!o){r.next=9;break}if(!(a>=n.length)){r.next=6;break}return r.abrupt("break",24);case 6:s=n[a++],r.next=13;break;case 9:if(!(a=n.next()).done){r.next=12;break}return r.abrupt("break",24);case 12:s=a.value;case 13:l=s,c=e.get(l),u=0;case 16:if(!(u<c.length)){r.next=22;break}return r.next=19,new Promise(function(e,r){var n=performance.now();c[u].build();var o=c[u].combineMesh;l.miscNode.add(o),performance.now()-n>t?setTimeout(function(){e()},i):e()});case 19:u++,r.next=16;break;case 22:r.next=3;break;case 24:case"end":return r.stop()}},r,this)}var r=Ke.mark(t);if(e.outdoors&&this.parseOutdoors(e.outdoors),e.buildings){var i=e.buildings;for(var n in i){var o=i[n],a=new THREE.Vector3(0,0,0),s=n,l=void 0;o.id&&(l=o.id),o.name&&(s=o.name);var c=o.properties,u=null;if(c){u={};for(var h in c){var p=c[h];u[h]=p}}if(o.position){var d=o.position;a.x=d[0],a.y=d[1],a.z=-d[2]}var f=new THREE.Object3D,m=this.app.objectManager.create({type:"Building",name:s,id:l,properties:u,parent:this.campus,node:f});if(m.app=this.app,m.node.position.x=a.x,m.node.position.y=a.y,m.node.position.z=a.z,o.facades){var g=o.facades;for(var v in g)this.createThing(g[v],m,null,"Facade")}if(o.facadegroups){var y=o.facadegroups;for(var E in y){var b=y[E];this.createGroup(b,m,"Facade")}}o.plans&&this.parseFloorPlans(o.plans,m)}}var x=this;if(this.isDelayLoadFloorPlan){var _=new Map,w=this.combineManager.processorMap.get(this.outdoors);w&&_.set(this.outdoors,w);for(var T=this.combineManager.processorMap.keys(),M=Array.isArray(T),R=0,T=M?T:T[Symbol.iterator]();;){var S;if(M){if(R>=T.length)break;S=T[R++]}else{if((R=T.next()).done)break;S=R.value}var P=S;P!=this.outdoors&&(P.isLoaded=!1)}return t(_)}return t(this.combineManager.processorMap)},e.prototype.parseOutdoors=function(e){var t=new THREE.Object3D;this.outdoors=this.app.objectManager.create({type:"Outdoors",name:"Outdoors",parent:this.campus,node:t}),this.app.outdoors||(this.app.outdoors=this.outdoors,this.app.currentParentObject=this.outdoors),this.processFloorPlanData(e,this.outdoors)},e.prototype.processFloorPlanData=function(e,t){t.app=this.app;var r=new THREE.Vector3(0,0,0);if(e.position){var i=e.position;r.x=i[0],r.y=i[1],r.z=-i[2]}t.node.position.x=r.x,t.node.position.y=r.y,t.node.position.z=r.z,t.node.updateMatrixWorld(),t.node.updateMatrix(),this.parseStructure(e,t),e.placements&&(this.parseCombineProcessors(t,e.placements,[],[],[]),this.parseThings(e.placements,t,r)),e.videoprobes&&this.parseThings(e.videoprobes,t,r),e.groups&&this.parseGroups(e.groups,t,[],[],[],r),e.doororwindows&&this.parseDoorWins(e.doororwindows,t,r),e.rooms&&this.parseRooms(e.rooms,t),e.routes&&this.parseStructureThing(e.routes,t),e.pipelines&&this.parseStructureThing(e.pipelines,t),e.curvelines&&this.parseStructureThing(e.curvelines,t),e.arrowlines&&this.parseStructureThing(e.arrowlines,t),e.arrowdatalines&&this.parseStructureThing(e.arrowdatalines,t),e.leakwaterlines&&this.parseStructureThing(e.leakwaterlines,t)},e.prototype.parseRooms=function(e,t){for(var r=0;r<e.length;r++){var i=e[r],n=null;i.name&&(n=i.name),e.id&&e.id;var o=null,a=i.gltfid;a&&this.nodes[a]&&(o=this.nodes[a]);var s=null,l=i.properties;if(l){s={};for(var c in l){var u=l[c];s[c]=u}}var h=null,p=null,d=null;i.floor&&(a=i.floor.gltfid,this.nodes[a]&&(d=this.nodes[a])),i.ceiling&&(a=i.ceiling.gltfid,this.nodes[a]&&(h=this.nodes[a])),i.roof&&(a=i.roof.gltfid,this.nodes[a]&&(p=this.nodes[a]));var f=i.isShown;if(f){var m="false"!==(f=f.toLowerCase());o.visible=m}var g=null,v=null,y=null,E={};if(i.area&&(v=i.area,E.area=v),i.circumference&&(y=i.circumference,E.circumference=y),i.center){var b=i.center;(g=new THREE.Vector3).set(b[0],b[1],-b[2]),E.center=g}this.app.objectManager.create({type:"Room",name:n,node:o,ceilingNode:h,roofNode:p,floorNode:d,parent:t,properties:s,auxiliaryInfo:E})}},e.prototype.parseCombineProcessors=function(e,t,r,i,n){for(var o in t){var a=t[o];if(!a.name&&!a.properties){var s=this.app.modelResource.bundleIDArray[a.model].uri;s||(s=this.app.modelResource.bundleIDArray[a.model].id);var l=new THREE.Vector3(0,0,0);if(a.position){var c=a.position;l.x=c[0],l.y=c[1],l.z=-c[2]}var u=new THREE.Vector3(1,1,1);if(a.scale){var h=a.scale;u.x=h[0],u.y=h[1],u.z=h[2]}var p=new THREE.Quaternion(0,0,0,1);if(a.rotation){var d=a.rotation;p.x=d[0],p.y=d[1],p.z=-d[2],p.w=-d[3]}var f=r.slice(),m=i.slice(),g=n.slice();g.push(p),m.push(u),f.push(l),this.combineManager.addPlacement(e,s,f,m,g)}}},e.prototype.parseStructure=function(e,t){t.node.updateMatrixWorld();var r=t.node.position,i=new THREE.Vector3;t.parent&&!t.isOutdoors&&(i=t.parent.node.position);var n=new THREE.Vector3(i.x+r.x,i.y+r.y,i.z+r.z);if(e.structure){var o=(e=e.structure).walls;if(o){var a=new THREE.Group;a.name="structurnWall";for(var s in o){var l=o[s].gltfid,c=this.nodes[l];c.traverse(function(e){e.material&&(e.material.onBeforeCompile=function(e){e.fragmentShader=e.fragmentShader.replace("#include <aomap_fragment>",["#ifdef USE_AOMAP","float ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 3.0;","#if defined( USE_ENVMAP ) && defined( PHYSICAL )","float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );","reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );","#endif","#endif"].join("\n"))},e.material.needsUpdate=!0)}),c&&a.add(c)}t.node.add(a),a.position.set(-n.x,-n.y,-n.z),t.wallNode=a}var u=e.roofs;if(u){var h=new THREE.Group;h.name="structurnRoof";for(var s in u){var l=u[s].gltfid,p=this.nodes[l];p&&h.add(p)}t.node.add(h),h.position.set(-n.x,-n.y,-n.z),t.roofNode=h}var d=e.ceilings;if(d){var f=new THREE.Group;f.name="structureCeiling";for(var s in d){var l=d[s].gltfid,m=this.nodes[l];m&&f.add(m)}t.node.add(f),f.position.set(-n.x,-n.y,-n.z),t.ceilNode=f}if(v=e.floors){var g=new THREE.Group;g.name="structureFloor";for(var s in v){var v;if(l=(v=v[s]).gltfid){var y=this.nodes[l];y.traverse(function(e){e.material&&(e.material.roughness=.9,e.material.needsUpdate=!0)}),y&&g.add(y)}}t.node.add(g),g.position.set(-n.x,-n.y,-n.z),t.floorNode=g}var E=new THREE.Group;E.name="structurePlacement",t.miscNode=E,t.node.add(E),t.floorNode||(t.floorNode=E),E.updateMatrixWorld(),E.updateMatrix(),E.position.set(0,0,0);var b=e.placements;if(b)for(var s in b){var l=b[s].gltfid,x=this.nodes[l];x&&E.add(x)}e.routes&&this.parseStructureThing(e.routes,t),e.pipelines&&this.parseStructureThing(e.pipelines,t),e.curvelines&&this.parseStructureThing(e.curvelines,t),e.arrowlines&&this.parseStructureThing(e.arrowlines,t),e.arrowdatalines&&this.parseStructureThing(e.arrowdatalines,t),e.leakwaterlines&&this.parseStructureThing(e.leakwaterlines,t)}},e.prototype.parseDoorWins=function(e,t,r){new THREE.Group("doors");for(var i in e){var n=e[i],o=i;n.name&&(o=n.name);var a=null;if(n.gltfid){var s=n.gltfid;this.nodes[s]&&(a=this.nodes[s],t.node.add(a))}var l=null;if(n.properties){var c=n.properties;l={};for(var u in c){var h=c[u];l[u]=h}}this.app.objectManager.create({type:"Door",name:o,node:a,parent:t,properties:l})}},e.prototype.parseGroups=function(e,t,r,i,n,o){for(var a in e){var s=e[a];s.name||s.properties?this.createGroup(s,t):this.combineGroup(s,t,r,i,n,o)}},e.prototype.createGroup=function(e,t){var r,i,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Thing",o=this.instanceGroup(e);e.id&&e.id,e.name&&(r=e.name);var a=e.properties;if(a){i={};for(var s in a){var l=a[s];i[s]=l}}return this.app.objectManager.create({type:n,name:r,node:o,parent:t,properties:i})},e.prototype.parseFloorPlans=function(e,t){for(var r=[],i=0;i<e.length;i++){var n=e[i],o=n.id,a="";n.name&&(a=n.name);var s=new THREE.Object3D,l=this.app.objectManager.create({type:"Floor",name:a,id:o,node:s,parent:t});s.name="floorPlan",0!=t.facades.length&&(l.node.visible=!1),t.node.add(l.node),t.node.updateMatrixWorld(),t.node.updateMatrix(),this.processFloorPlanData(n,l),r.push(l)}return r},e.prototype.parseBundleList=function(e){this.app.modelResource.bundleIDArray=e;var t=0,r=this;return new Promise(function(i,n){0!==e.length?e.forEach(function(o){if(c=o.uri){var a=new THREE.GLTFLoader;a.setCrossOrigin("anonymous"),a.load(r.baseURL+"/"+c,function(n){t++;var o=null;-1!==n.asset.generator.indexOf("Unity")?(o=n.scene.children[0].children[0],r.app.modelResource.set(c,o,n.animations)):(o=n.scene.children[0],r.app.modelResource.set(c,o,n.animations)),r.addEnvMap(o),t===e.length&&i()},function(){},function(e){n("can not load "+r.baseURL+"/"+c)})}else{var s=o.id,l=o.version,c="http://model.3dmomoda.cn/models/"+s+"/"+l+"/gltf/",u=new THREE.FileLoader;u.setResponseType("json"),u.load(c+"index.json",function(o){var a=o.gltfFiles[0],l=new THREE.GLTFLoader;l.setCrossOrigin("anonymous"),l.load(c+a,function(n){t++,r.app.modelResource.set(s,n.scene.children[0],n.animations),t===e.length&&i()},function(){},function(e){n("can not load "+r.baseURL+"/"+c)})})}}):i()})},e.prototype.combineGroup=function(e,t,r,i,n,o){var a=e,s=new THREE.Vector3(0,0,0);a.position&&(h=a.position,s.x=h[0],s.y=h[1],s.z=-h[2]);var l=new THREE.Vector3(1,1,1);a.scale&&(p=a.scale,l.x=p[0],l.y=p[1],l.z=p[2]);var c=new THREE.Quaternion(0,0,0,1);a.rotation&&(p=a.rotation,c.x=p[0],c.y=p[1],c.z=-p[2],c.w=-p[3]);var u,h,p;if(n?(u=r.slice(),p=i.slice(),h=n.slice()):(u=[],h=[],p=[]),u.push(l),h.push(s),p.push(c),a.placements&&this.parseCombineProcessors(t,a.placements,h,u,p),a.groups)for(var d in a.groups)this.combineGroup(a.groups[d],t,u,p,h,o)},e.prototype.instanceGroup=function(e){var t=new THREE.Vector3(0,0,0);if(e.position){var r=e.position;t.x=r[0],t.y=r[1],t.z=-r[2]}var i=new THREE.Vector3(1,1,1);e.scale&&(o=e.scale,i.x=o[0],i.y=o[1],i.z=o[2]);var n=new THREE.Quaternion(0,0,0,1);if(e.rotation){var o=e.rotation;n.x=o[0],n.y=o[1],n.z=-o[2],n.w=-o[3]}var a=new THREE.Group;if(e.placements)for(var s in e.placements)l=this.instanceChildOfGroup(e.placements[s]),a.add(l);if(e.groups)for(var s in e.groups){var l=this.instanceGroup(e.groups[s]);a.add(l)}return a.scale.copy(i),a.setRotationFromQuaternion(n),a.position.copy(t),a},e.prototype.instanceChildOfGroup=function(e){var t=this.app.modelResource.bundleIDArray[e.model].uri;t||(t=this.app.modelResource.bundleIDArray[e.model].id);var r=this.app.modelResource.get(t).node.clone();if(e.scale&&(i=e.scale,r.scale.x=i[0],r.scale.y=i[1],r.scale.z=i[2]),e.rotation){var i=e.rotation,n=new THREE.Quaternion;n.x=i[0],n.y=i[1],n.z=-i[2],n.w=-i[3],r.setRotationFromQuaternion(n)}return e.position&&(i=e.position,r.position.x=i[0],r.position.y=i[1],r.position.z=-i[2]),r},e.prototype.parseThings=function(e,t,r){for(var i in e){var n=e[i];(n.name||n.properties||n.type)&&this.createThing(n,t,r)}},e.prototype.createThing=function(e,t,r){var i,n,o,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"Thing";e.id&&(i=e.id);var s=e.type||a;e.name&&(n=e.name);var l=e.properties;if(l){o={};for(var c in l){var u=l[c];o[c]=u}}var h=this.app.modelResource.bundleIDArray[e.model].uri;h||(h=this.app.modelResource.bundleIDArray[e.model].id);var p=this.app.modelResource.get(h).node.clone(),d=this.app.modelResource.get(h).animations;if(e.position){var f=e.position,m=new THREE.Vector3(f[0],f[1],-f[2]);p.position.x=m.x,p.position.y=m.y,p.position.z=m.z}if(e.rotation){var g=e.rotation,v=new THREE.Quaternion;v.x=g[0],v.y=g[1],v.z=-g[2],v.w=-g[3],p.setRotationFromQuaternion(v)}if(e.scale){var y=e.scale,E=new THREE.Vector3;E.x=y[0],E.y=y[1],E.z=y[2],p.scale.x=E.x,p.scale.y=E.y,p.scale.z=E.z}var b=e.isShown;if(b){var x="false"!==(b=b.toLowerCase());p.visible=x}return this.app.objectManager.create({type:s,id:i,name:n,node:p,parent:t,animations:d,properties:o})},e.prototype.parseStructureThing=function(e,t,r){for(var i in e){var n=e[i];if(n.gltfid){var o=new _e(this.app);o.name=i,o.app=this.app,n.id&&(o.id=n.id),n.name&&(o.name=n.name);var a=n.gltfid;if(this.nodes[a]){var s=this.nodes[a];t.node.add(s),o.node=s,t.add(o),r&&(s.position.x=r.x,s.position.y=r.y,s.position.z=r.z)}}}},e.prototype.delayLoadFloorPlan=function(e){function t(t){var n,o,a;return Ke.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:n=i.loadSpeed,o=10,a=0;case 3:if(!(a<t.length)){r.next=9;break}return r.next=6,new Promise(function(r,i){var s=performance.now();t[a].build();var l=t[a].combineMesh;e.miscNode.add(l),performance.now()-s>n?setTimeout(function(){r()},o):r()});case 6:a++,r.next=3;break;case 9:case"end":return r.stop()}},r,this)}var r=Ke.mark(t),i=this,n=null,o=null;return e.isLoaded||(n=this.combineManager.processorMap.get(e),o=t(n)),new Promise(function(t,r){o?i._nestingLoopYield(o,function(){e.isLoaded=!0,t()},function(e){r(e)}):e.isLoaded?console.warn("floorplan "+e.id+" has been loaded!"):r()})},e}(),et=function(e){function t(r,i){return I(this,t),N(this,e.call(this,r,i))}return D(t,e),t.prototype.parseDoorWins=function(e,t,r){new THREE.Group("doors");for(var i in e){var n=e[i];n.type||(n.type="Door"),this.createThing(n,t,r)}},t}($e),tt=function(){function e(t){I(this,e),this.app=t,this.nodes=[],this.scene=this.app.scene,this.objectPool=this.app.objectPool,this.rootNode=null,this.campus=null,this.sceneURL=null,this.sceneJsonData=null,this.loadedSceneGLTF=null,this.worldNode=new THREE.Object3D,this.fitCamInfo=null}return e.prototype.parse=function(e){for(var t in e)if("objects"==t){var r=e.objects;for(var i in r){var n=r[i];this.parseWorld(n);break}}else if("camInfo"==t){var o=e[t];this.fitCamInfo=o}else console.log("unkown other parser: "+t)},e.prototype.parseCamInfo=function(e){var t=e.eye,r=e.target,i=t.split(" "),n=r.split(" "),o=[Number(i[0]),Number(i[1]),Number(i[2])];o[2]=-o[2];var a=[Number(n[0]),Number(n[1]),Number(n[2])];a[2]=-a[2],this.app.camera.position=o,this.app.camera.target=a},e.prototype.parseWorld=function(e){var t=this.worldNode;if(null==this.campus&&(this.campus=this.app.objectManager.create({type:"Campus",name:"Campus",node:t}),this.campus.node.name="campus",this.app.scene.add(this.campus.node)),e.plan&&this.parseOutdoors(e.plan),e.bds){var r=e.bds;this.parseBuildings(r)}},e.prototype.parseOutdoors=function(e){var t=null;for(var r in e){t=e[r];break}var i=new THREE.Object3D;this.outdoors=this.app.objectManager.create({type:"Outdoors",name:"Outdoors",parent:this.campus,node:i});var n=this.outdoors,o=t.gltfid;if(o&&this.nodes[o]){var a=this.nodes[o];THREE.SceneUtils.detach(a,a.parent,this.app.scene),THREE.SceneUtils.attach(a,this.app.scene,n.node),n.node.updateMatrixWorld()}this.parseFloorPlan(t,n)},e.prototype.parseBuildings=function(e){for(var t in e){var r=e[t],i=null;if(r.gltfid){var n=r.gltfid;this.nodes[n]&&(i=this.nodes[n])}var o=this.app.objectManager.create({type:"Building",name:t,parent:this.campus,node:i});r.plans&&this.parseFloorPlans(r.plans,o),r.facades&&this.parseFacades(r.facades,o)}},e.prototype.parseFloorPlans=function(e,t){for(var r in e){var i=null,n=e[r],o=n.gltfid;o&&this.nodes[o]&&(i=this.nodes[o]);var a=this.app.objectManager.create({type:"Floor",name:r,node:i,parent:t});this.parseFloorPlan(n,a)}},e.prototype.parseFloorPlan=function(e,t){e.plcs&&this.parseThings(e.plcs,t),e.vps&&this.parseThings(e.vps,t),e.dws&&this.parseDoorWins(e.dws,t),e.routes&&this.parseThings(e.routes,t),e.pipelines&&this.parseThings(e.pipelines,t),e.curvelines&&this.parseThings(e.curvelines,t),e.arrowlines&&this.parseThings(e.arrowlines,t),e.arrowdatalines&&this.parseThings(e.arrowdatalines,t),e.leakwaterlines&&this.parseThings(e.leakwaterlines,t);var r=e.cplcs;if(r)for(var i in r){var n=r[i].gltfid,o=this.nodes[n];if(o){t.miscNode=o.parent;break}}var a=e.cwalls;if(a)for(var i in a){var n=a[i].gltfid,s=this.nodes[n];if(s){t.wallNode=s.parent;break}}var l=e.croofs;if(l)for(var i in l){var n=l[i].gltfid,c=this.nodes[n];if(c){t.roofNode=c.parent;break}}var u=e.cceilings;if(u)for(var i in u){var n=u[i].gltfid,h=this.nodes[n];if(h){t.ceilingNode=h.parent;break}}if(p=e.cfloors)for(var i in p){var p;if(n=(p=p[i]).gltfid){var d=this.nodes[n];if(d){t.floorNode=d.parent;break}}}var f=e.groups;f&&this.parseGroup(f,t)},e.prototype.parseGroup=function(e,t){for(var r in e){var i=e[r],n=r;i.uid&&(n=i.uid);var o=i.type||"Thing",a=null,s=i.gltfid;s&&this.nodes[s]&&(a=this.nodes[s]);var l=null,c=i.prop;if(c){l={};for(var u in c){var h=c[u];l[u]=h}}this.app.objectManager.create({type:o,name:n,node:a,parent:t,properties:l}),i.plcs&&this.parseThings(i.plcs,t)}},e.prototype.parseFacades=function(e,t){for(var r in e){var i=e[r],n=r;i.uid&&(n=i.uid);var o=null,a=i.gltfid;a&&this.nodes[a]&&(o=this.nodes[a]);var s=null,l=i.prop;if(l){s={};for(var c in l){var u=l[c];s[c]=u}}var h=i.isShown;if(h){var p="false"!==(h=h.toLowerCase());o.visible=p}this.app.objectManager.create({type:"Facade",name:n,node:o,parent:t,properties:s}),t.node.add(o)}},e.prototype.parseThings=function(e,t){for(var r in e){var i=e[r],n=r;i.uid&&(n=i.uid);var o=null,a=i.gltfid;a&&this.nodes[a]&&(o=this.nodes[a]);var s=null,l=i.prop;if(l){s={};for(var c in l){var u=l[c];s[c]=u}}var h=i.isShown;if(h){var p="false"!==(h=h.toLowerCase());o.visible=p}this.app.objectManager.create({type:"Thing",name:n,node:o,parent:t,properties:s})}},e.prototype.parseDoorWins=function(e,t){for(var r in e){var i=e[r],n=r;i.uid&&(n=i.uid);var o=null;if(i.gltfid){var a=i.gltfid;this.nodes[a]&&(o=this.nodes[a])}var s=null;if(i.prop){var l=i.prop;s={};for(var c in l){var u=l[c];s[c]=u}}this.app.objectManager.create({type:"Door",name:n,node:o,parent:t,properties:s})}},e.prototype.load=function(e){var t=this;return this.sceneURL=e,new Promise(function(e,r){t.loadGLTF().then(function(e){return t.loadedSceneGLTF=e,e.scene.traverse(function(e){t.nodes[e.name]=e}),t.parseSceneJson()}).then(function(r){t.fitCamInfo?t.parseCamInfo(t.fitCamInfo):t.campus.node&&t.app.camera.fit(t.campus),e(t.campus)}).catch(function(){t.campus.node.add(t.loadedSceneGLTF.scene.children[0]),t.campus&&t.app.camera.fit(t.campus),e(t.campus)})})},e.prototype.loadGLTF=function(){var e=this;return new Promise(function(t,r){var i=new THREE.GLTFLoader(e.app.loadingManager);i.setCrossOrigin("anonymous"),i.load(e.sceneURL+"/Unity2GLTF.gltf",function(e){t(e)})})},e.prototype.parseSceneJson=function(){var e=this;return new Promise(function(t,r){new THREE.FileLoader(e.app.loadingManager).load(e.sceneURL+"/scene.json",function(r){var i=JSON.parse(r);e.sceneJsonData=i;for(var n in i)if("objects"==n){var o=i.objects;for(var a in o){var s=o[a];e.parseWorld(s);break}}else if("camInfo"==n){var l=i[n];e.fitCamInfo=l}else console.log("unkown other parser: "+n);t(i)},function(){},function(){console.error("not find file scene.json "),r()})})},e}(),rt=function(){function e(t,r){if(I(this,e),this.app=t,this.resourceUrl=null,this.relativeResourceUrl=null,this.sceneJson=null,this.scale=1,this.curFloorPlan=null,this.tempTexture=null,this.indexJson=r,this.sceneJsonUri="scene.json",this.defaultWallTextureUri="Textures/RoomWall.jpg",this.defaultWallEdgeTextureUri="Textures/WallEdge.jpg",this.defaultFloorTextureUri="Textures/FloorDefault.jpg",this.defaultCeilingTextureUri="Textures/CeilingDefault.jpg",this.defaultRoofTextureUri="Textures/RoofDefault.jpg",this.defaultWallTexture=null,this.defaultCeilingTexture=null,this.defaultFloorTexture=null,this.defaultRoofTexture=null,this.defaultWallEdgeTexture=null,this.worldNode=new THREE.Object3D("world"),this.isCamFitScene=!0,this.campus=null,this.outdoorsVisible=!0,this.campusVisible=!0,this.enableUseHighestVersionResource=!0,this.enableDownloadSceneJsonCache=!0,this.worldNode,r&&(r.position&&(this.campusPosition=r.position),r.rotation&&(this.campusRotation=r.rotation),void 0!==r.isCamFitScene&&null!==r.isCamFitScene&&(this.isCamFitScene=r.isCamFitScene),r.scale&&(this.campusScale=r.scale),void 0!==r.outdoorsVisible&&(this.outdoorsVisible=r.outdoorsVisible),void 0!==r.campusVisible&&(this.campusVisible=r.campusVisible),r.campus&&(this.campus=r.campus),void 0!==r.enableUseHighestVersionResource&&(this.enableUseHighestVersionResource=r.enableUseHighestVersionResource,json2mesh.DefaultSetting.enableUseHighestVersionResource=this.enableUseHighestVersionResource),void 0!==r.enableDownloadSceneJsonCache&&(this.enableDownloadSceneJsonCache=r.enableDownloadSceneJsonCache)),this.campus&&(this.campusRotation&&this.campus.node.quaternion.set(this.campusRotation.x,this.campusRotation.y,this.campusRotation.z,this.campusRotation.w),this.campusPosition&&(this.campus.position=this.campusPosition),this.campusScale&&(this.campus.scale=this.campusScale)),r.default){var i=r.default;i.sceneJson&&(this.sceneJson="export.json"),i.wallTexture&&(this.defaultWallTextureUri=i.wallTexture),i.wallEdgeTexture&&(this.defaultWallEdgeTextureUri=i.wallEdgeTexture),i.floorTexture&&(this.defaultFloorTextureUri=i.floorTexture),i.ceilingTexture&&(this.defaultCeilingTextureUri=i.ceilingTexture),i.roofTexture&&(this.defaultRoofTextureUri=i.roofTexture)}this.app.options.loaderResourceUrl&&(this.resourceUrl=this.app.options.loaderResourceUrl),void 0!=this.app.options.enableUseHighestVersionResource&&(this.enableUseHighestVersionResource=this.app.options.enableUseHighestVersionResource,json2mesh.DefaultSetting.enableUseHighestVersionResource=this.enableUseHighestVersionResource),this.app.options.resourceLibraryUrl&&(this.resourceUrl=this.app.options.resourceLibraryUrl),this.indexJson.resourceLibrary&&(this.relativeResourceUrl=this.indexJson.resourceLibrary),this.enableDownloadSceneJsonCache||(this.sceneJsonUri+="?_t="+(new Date).getTime())}return e.prototype.parseCamInfo=function(e){var t=e.eye,r=e.target,i=t.split(" "),n=r.split(" "),o=[Number(i[0]),Number(i[1]),Number(i[2])];o[2]=-o[2];var a=[Number(n[0]),Number(n[1]),Number(n[2])];a[2]=-a[2],this.app.camera.position=o,this.app.camera.target=a},e.prototype.exportJsonString=function(e){for(var t=e.outdoors,r=e.buildings,i=[],n=[],o=0;o<t.things.length;o++){var a=t.things[o];i.push({id:a.id,name:a.name})}for(o=0;o<t.rooms.length;o++)g=t.rooms[o],n.push({id:g.id,name:g.name});for(var s=[],o=0;o<r.length;o++){for(var l=r[o],c=[],u=0;u<l.floors.length;u++){for(var h=l.floors[u],p=[],d=[],f=0;f<h.things.length;f++){var m=h.things[f];p.push({id:m.id,name:m.name})}for(f=0;f<h.rooms.length;f++){var g=h.rooms[f];d.push({id:g.id,name:g.name})}c.push({id:h.id,name:h.name,placements:p,rooms:d})}s.push({id:l.id,name:l.name,plans:c})}return{id:e.id,name:e.name,outdoors:{id:t.id,name:t.name,placements:i,rooms:n},buildings:s}},e.prototype.load=function(e){var t=this;return this.sceneURL=e,this.relativeResourceUrl&&(0===this.relativeResourceUrl.indexOf("./")?this.resourceUrl=this.sceneURL+this.relativeResourceUrl.replace("./","/"):this.resourceUrl=this.relativeResourceUrl),new Promise(function(e,r){t.updateProgress(.1),t.loadSceneJson().then(function(r){t.sceneJson=JSON.parse(r),t.sceneJson.camInfo&&t.isCamFitScene&&t.parseCamInfo(t.sceneJson.camInfo),t.updateProgress(.15);var i=new json2mesh.UBuilderSceneDelayLoader;t.resourceUrl&&(i.resourceManager.baseTextureUrl=t.resourceUrl+"/texture/",i.resourceManager.baseModelUrl=t.resourceUrl+"/model/"),t.loader=i,i.delayLoad({json:t.sceneJson,customModeBaseUrl:t.sceneURL+"/"}).then(function(r){t.sceneJson.camInfo&&t.isCamFitScene&&t.parseCamInfo(t.sceneJson.camInfo),t.parseWorld(r),t.updateProgress(.2);var n=setInterval(function(){t.updateProgress(.2+.8*i.downloadResourceProgress)},10);i.loadResources().then(function(){t.updateProgress(1),clearInterval(n),e(t.campus)})})})})},e.prototype.loadSceneJson=function(){var e=this;return new Promise(function(t,r){new THREE.FileLoader(e.app.loadingManager).load(e.sceneURL+"/"+e.sceneJsonUri,function(e){t(e)})})},e.prototype.updateProgress=function(e){this.app.mainUI.updateLoadingProcess(e)},e.prototype.createTextureLoaderPromise=function(e){var t=this;return new Promise(function(r,i){(new THREE.TextureLoader).load(t.sceneURL+"/"+e,function(e){r(e)},function(t){console.log(e+" "+t.loaded/t.total*100+"% loaded")},function(t){console.log(e+"load error")})})},e.prototype.loadDefaultTexture=function(){var e=this;return new Promise(function(t,r){var i=e.createTextureLoaderPromise(e.defaultWallTextureUri),n=e.createTextureLoaderPromise(e.defaultWallEdgeTextureUri),o=e.createTextureLoaderPromise(e.defaultFloorTextureUri),a=e.createTextureLoaderPromise(e.defaultRoofTextureUri),s=e.createTextureLoaderPromise(e.defaultCeilingTextureUri);Promise.all([i,n,o,a,s]).then(function(e){DefaultResource.wallTexture=e[0],DefaultResource.wallEdgeTexture=e[1],DefaultResource.floorTexture=e[2],DefaultResource.ceilinngTexture=e[3],DefaultResource.roofTexture=e[4],t()})})},e.prototype.parseWorld=function(e){null===this.campus&&(this.campus=this.app.objectManager.create({uuid:e.id,id:e.userID,type:"Campus",name:"Campus",node:this.worldNode}),this.campus.visible=this.campusVisible,this.campusRotation&&this.campus.node.quaternion.set(this.campusRotation.x,this.campusRotation.y,this.campusRotation.z,this.campusRotation.w),this.campusPosition&&(this.campus.position=this.campusPosition),this.campusScale&&(this.campus.scale=this.campusScale),this.app.scene.add(this.campus.node));for(var t=0;t<e.buildings.length;t++){var r=e.buildings[t];this.parseBuilding(r)}if(e.outdoors){var i=new THREE.Object3D("outdoors");i.name="plan",this.outdoors=this.app.objectManager.create({uuid:e.outdoors.id,id:e.outdoors.userID,type:"Outdoors",name:e.outdoors.name,parent:this.campus,node:i}),this.app.outdoors||(this.app.outdoors=this.outdoors,this.app.currentParentObject=this.outdoors),this.outdoors.visible=this.outdoorsVisible,this.parseFloorPlan(e.outdoors,this.outdoors)}},e.prototype.parseBuilding=function(e){var t=new THREE.Object3D("building");t.name="building";var r=this.app.objectManager.create({uuid:e.id,id:e.userID,type:"Building",name:e.name,parent:this.campus,node:t,properties:e.properties});r.localPosition=e.position;for(var i=e.floorplans,n=e.facades,o=e.facadeGroups,a=0;a<n.length;a++)s=n[a],this.app.objectManager.create({type:"Facade",id:s.userID,name:s.name,uuid:s.id,node:s.delayObject,parent:r,properties:s.properties});for(a=0;a<o.length;a++){var s=o[a];this.app.objectManager.create({type:"Facade",uuid:s.id,id:s.userID,name:s.name,node:s.delayObject,parent:r,properties:s.properties})}for(var l=0;l<i.length;l++){var c=i[l],u=new THREE.Object3D("floorplan");u.name="plan";var h=this.app.objectManager.create({id:c.userID,uuid:c.id,type:"Floor",name:c.name,node:u,parent:r});h.localPosition=c.position,this.parseFloorPlan(c,h),0!==r.facades.length&&(h.node.visible=!1)}},e.prototype.placementInitCallback=function(e){this.app.objectManager.create({id:e.id,name:e.name,node:e.mesh,parent:plan,animations:e.resource.animations,properties:e.properties})},e.prototype.parseOutdoors=function(e){},e.prototype.parseFloorPlan=function(e,t){for(s=0;s<e.walls.length;s++)for(var r=e.walls[s],i=0;i<r.doorOrWindows.length;i++){var n=r.doorOrWindows[i];if(n.mesh){if(E=this.app.objectManager.create({type:"Door",uuid:n.id,id:n.userID,name:n.name,node:n.delayObject,parent:t,animations:n.resource.animations,properties:n.properties}),n.isOpen&&E.open(),E.animationClips)for(i=0;i<E.animationClips.length;i++){var o=E.animationClips[i];if("_defaultAnim_"===o.name){E.playAnimation({name:o.name,loop:!0,speed:.15});break}}}else n.initCompleteCallback=function(e){var r=m.app.objectManager.create({type:"Door",uuid:e.id,id:e.userID,name:e.name,node:e.mesh,parent:t,animations:e.resource.animations,properties:e.properties});if(t.miscNode.add(r.node),e.isOpen&&r.open(),r.animationClips)for(var i=0;i<r.animationClips.length;i++){var n=r.animationClips[i];if("_defaultAnim_"===n.name){r.playAnimation({name:n.name,loop:!0,speed:.15});break}}}}for(var a=new THREE.Object3D("combineFloor"),s=0;s<e.combineFloors.length;s++)x=e.combineFloors[s],a.add(x);t.node.add(a),t.floorNode=a;for(var l=new THREE.Object3D("combineCeiling"),s=0;s<e.combineCeilings.length;s++){var c=e.combineCeilings[s];l.add(c)}t.node.add(l),t.ceilingNode=l;for(var u=new THREE.Object3D("combineRoof"),s=0;s<e.combineRoofs.length;s++){var h=e.combineRoofs[s];u.add(h)}t.node.add(u),t.roofNode=u;for(var p=new THREE.Object3D("combinePlacement"),s=0;s<e.combinePlacements.length;s++)y=e.combinePlacements[s],p.add(y);t.node.add(p),t.miscNode=p;for(var d=new THREE.Object3D("combineWall"),f=0;f<e.combineStraightManualWalls.length;f++)r=e.combineStraightManualWalls[f],d.add(r);for(f=0;f<e.combineModelWalls.length;f++)r=e.combineModelWalls[f],d.add(r);for(f=0;f<e.combineDoorOrWins.length;f++)y=e.combineDoorOrWins[f],d.add(y);for(t.node.add(d),t.wallNode=d,s=0;s<e.groups.length;s++)g="Thing",(y=e.groups[s]).jsonData&&y.jsonData.type&&(g=y.jsonData.type),E=this.app.objectManager.create({uuid:y.id,id:y.userID,name:y.name,node:y.delayObject,type:g,parent:t,properties:y.properties});for(var m=this,s=0;s<e.placements.length;s++){var g="Thing";if((y=e.placements[s]).jsonData&&y.jsonData.type&&(g=y.jsonData.type),y.mesh){if((E=this.app.objectManager.create({uuid:y.id,id:y.userID,name:y.name,type:g,node:y.delayObject,parent:t,url:y.resource.getModelUrl(),animations:y.resource.animations,properties:y.properties})).bundleID=y.resource.modelID,E.bundleName=y.resource.modelName,y.isPlayAnim&&E.containAnimation(y.animClip)){var v={name:y.animClip,loop:!1,speed:.15};y.hasSkin&&(v.loop=!0),E.playAnimation(v)}}else y.initCompleteCallback=function(e){g="Thing",e.jsonData&&e.jsonData.type&&(g=e.jsonData.type);var r=m.app.objectManager.create({uuid:e.id,id:e.userID,name:e.name,node:e.mesh,parent:t,type:g,url:e.resource.getModelUrl(),animations:e.resource.animations,properties:e.properties});if(r.bundleID=e.resource.modelID,r.bundleName=e.resource.modelName,t.miscNode.add(r.node),e.isPlayAnim&&r.containAnimation(e.animClip)){var i={name:e.animClip,loop:!1,speed:.15};e.hasSkin&&(i.loop=!0),r.playAnimation(i)}}}for(s=0;s<e.videoprobes.length;s++){var y;if((y=e.videoprobes[s]).mesh)var E=this.app.objectManager.create({id:y.userID,name:y.name,uuid:y.id,node:y.delayObject,parent:t,url:y.resource.getModelUrl(),animations:y.resource.animations,properties:y.properties});else y.initCompleteCallback=function(e){var r=m.app.objectManager.create({id:e.userID,name:e.name,uuid:e.id,node:e.mesh,parent:t,url:e.resource.getModelUrl(),animations:e.resource.animations,properties:e.properties});t.miscNode.add(r.node)}}for(s=0;s<e.rooms.length;s++)var b=e.rooms[s],x=this.app.objectManager.create({type:"Room",name:b.name,node:b.mesh,uuid:b.id,id:b.userID,ceilingNode:b.ceiling.mesh,roofNode:b.roof.mesh,floorNode:b.floor.mesh,parent:t,properties:b.properties});for(s=0;s<e.curvelines.length;s++)_=e.curvelines[s],this.parseCurveLines(_,t);for(s=0;s<e.pipelines.length;s++){var _=e.pipelines[s];this.parsePipeLines(_,t)}},e.prototype.parsePipeLines=function(e,t){var r={type:"PolygonLine",name:e.name,points:e.points,id:e.userID,uuid:e.id,parent:t,style:{}};e.color&&(r.style.color="#"+e.color.getHexString());var i=this;if(e.resource)e.initCompleteCallback=function(t){r.image=t.resource.getTextureUrl();var n=i.app.objectManager.create(r);n.node.position.set(e.position.x,e.position.y,e.position.z),e.sectionType&&"Triangle"===e.sectionType&&(n.pathRadialSegments=3,n._updateByPoints()),e.radius&&(n.width=e.radius)};else{var n=i.app.objectManager.create(r);n.node.position.set(e.position.x,e.position.y,e.position.z),e.sectionType&&"Triangle"===e.sectionType&&(n.pathRadialSegments=3,n._updateByPoints()),e.radius&&(n.width=e.radius)}},e.prototype.parseCurveLines=function(e,t){var r={type:"RouteLine",parent:t,name:e.name,uuid:e.id,id:e.userID,points:e.points,arrowFlag:!1,style:{}},i=this;if(e.color&&(r.style.color="#"+e.color.getHexString()),e.resource)e.initCompleteCallback=function(t){if(t.resource.texture){var n=t.resource.texture.clone();n.rotation=Math.PI/2,r.image=n}var o=i.app.objectManager.create(r);null!==e.width&&(o.width=e.width),o.node.position.set(e.position.x,e.position.y,e.position.z)};else{var n=i.app.objectManager.create(r);null!==e.width&&(n.width=e.width),n.node.position.set(e.position.x,e.position.y,e.position.z)}},e}(),it=function(){function e(t){I(this,e),this.app=t,this.nodes=[],this.scene=this.app.scene,this.objectPool=this.app.objectPool,this.rootNode=null,this.campus=null,this.sceneURL=null,this.sceneJsonData=null,this.loadedSceneGLTF=null,this.worldNode=new THREE.Object3D,this.fitCamInfo=null}return e.prototype.parse=function(e){if(this.parseWorld(e),e.camInfo){var t=e.camInfo;this.fitCamInfo=t}},e.prototype.parseCamInfo=function(e){var t=e.eye,r=e.target,i=t.split(" "),n=r.split(" "),o=[Number(i[0]),Number(i[1]),Number(i[2])];o[2]=-o[2];var a=[Number(n[0]),Number(n[1]),Number(n[2])];a[2]=-a[2],this.app.camera.position=o,this.app.camera.target=a},e.prototype.parseWorld=function(e){var t=this.worldNode;if(null==this.campus&&(this.campus=this.app.objectManager.create({type:"Campus",name:"Campus",node:t}),this.campus.node.name="campus",this.app.scene.add(this.campus.node)),e.outdoors&&this.parseOutdoors(e.outdoors),e.buildings){var r=e.buildings;this.parseBuildings(r)}},e.prototype.parseOutdoors=function(e){var t=e,r=new THREE.Object3D;this.outdoors=this.app.objectManager.create({type:"Outdoors",name:"Outdoors",parent:this.campus,node:r});var i=this.outdoors;this.app.outdoors||(this.app.outdoors=this.outdoors,this.app.currentParentObject=this.outdoors);var n=t.gltfid;if(n&&this.nodes[n]){var o=this.nodes[n];THREE.SceneUtils.detach(o,o.parent,this.app.scene),THREE.SceneUtils.attach(o,this.app.scene,i.node),i.node.updateMatrixWorld()}this.parseFloorPlan(t,i)},e.prototype.parseBuildings=function(e){for(var t in e){var r=e[t],i=t;r.name&&(i=r.name);var n=null;if(r.gltfid){var o=r.gltfid;this.nodes[o]&&(n=this.nodes[o])}var a=this.app.objectManager.create({type:"Building",name:i,parent:this.campus,node:n});r.plans&&this.parseFloorPlans(r.plans,a),r.facades&&this.parseFacades(r.facades,a)}},e.prototype.parseFloorPlans=function(e,t){for(var r in e){var i=null,n=e[r],o=r;n.name&&(o=n.name);var a=n.gltfid;a&&this.nodes[a]&&(i=this.nodes[a]);var s=this.app.objectManager.create({type:"Floor",name:o,node:i,parent:t});this.parseFloorPlan(n,s)}},e.prototype.parseFloorPlan=function(e,t){e.placements&&this.parseThings(e.placements,t),e.videoprobes&&this.parseThings(e.videoprobes,t),e.doororwindows&&this.parseDoorWins(e.doororwindows,t),e.routes&&this.parseThings(e.routes,t),e.pipelines&&this.parseThings(e.pipelines,t),e.curvelines&&this.parseThings(e.curvelines,t),e.arrowlines&&this.parseThings(e.arrowlines,t),e.arrowdatalines&&this.parseThings(e.arrowdatalines,t),e.leakwaterlines&&this.parseThings(e.leakwaterlines,t),e.rooms&&this.parseRooms(e.rooms,t),this.parseStructure(e,t);var r=e.groups;r&&this.parseGroup(r,t)},e.prototype.parseRooms=function(e,t){for(var r=0;r<e.length;r++){var i=e[r],n=null;i.name&&(n=i.name);var o=null,a=i.gltfid;a&&this.nodes[a]&&(o=this.nodes[a]);var s=null,l=i.properties;if(l){s={};for(var c in l){var u=l[c];s[c]=u}}var h=null,p=null,d=null;i.floor&&(a=i.floor.gltfid,this.nodes[a]&&(d=this.nodes[a])),i.ceiling&&(a=i.ceiling.gltfid,this.nodes[a]&&(h=this.nodes[a])),i.roof&&(a=i.roof.gltfid,this.nodes[a]&&(p=this.nodes[a]));var f=null,m=null,g=null,v={};if(i.area&&(m=i.area,v.area=m),i.circumference&&(g=i.circumference,v.circumference=g),i.center){var y=i.center;(f=new THREE.Vector3).set(y[0],y[1],-y[2]),v.center=f}var E=i.isShown;if(E){var b="false"!==(E=E.toLowerCase());o.visible=b}this.app.objectManager.create({type:"Room",name:n,node:o,ceilingNode:h,roofNode:p,floorNode:d,parent:t,properties:s,auxiliaryInfo:v})}},e.prototype.parseStructure=function(e,t){if(e.structure){var r=(e=e.structure).placements;if(r)for(var i in r){var n=r[i].gltfid,o=this.nodes[n];if(o){t.miscNode=o.parent;break}}var a=e.walls;if(a)for(var i in a){var n=a[i].gltfid,s=this.nodes[n];if(s){t.wallNode=s.parent;break}}var l=e.roofs;if(l)for(var i in l){var n=l[i].gltfid,c=this.nodes[n];if(c){t.roofNode=c.parent;break}}var u=e.ceilings;if(u)for(var i in u){var n=u[i].gltfid,h=this.nodes[n];if(h){t.ceilingNode=h.parent;break}}if(p=e.floors)for(var i in p){var p;if(n=(p=p[i]).gltfid){var d=this.nodes[n];if(d){t.floorNode=d.parent;break}}}}},e.prototype.parseGroup=function(e,t){for(var r in e){var i=e[r],n=r;i.name&&(n=i.name);var o=null,a=i.gltfid;a&&this.nodes[a]&&(o=this.nodes[a]);var s=null,l=i.properties;if(l){s={};for(var c in l){var u=l[c];s[c]=u}}this.app.objectManager.create({type:"Thing",name:n,node:o,parent:t,properties:s}),i.placements&&this.parseThings(i.placements,t)}},e.prototype.parseFacades=function(e,t){for(var r in e){var i=e[r],n=r;i.name&&(n=i.name);var o=null,a=i.gltfid;a&&this.nodes[a]&&(o=this.nodes[a]);var s=null,l=i.properties;if(l){s={};for(var c in l){var u=l[c];s[c]=u}}var h=i.isShown;if(h){var p="false"!==(h=h.toLowerCase());o.visible=p}this.app.objectManager.create({type:"Facade",name:n,node:o,parent:t,properties:s}),t.node.add(o)}},e.prototype.parseThings=function(e,t){for(var r in e){var i=e[r],n=i.name||r,o=i.type||"Thing",a=null,s=i.gltfid;s&&this.nodes[s]&&(a=this.nodes[s]);var l=null,c=i.properties;if(c){l={};for(var u in c){var h=c[u];l[u]=h}}var p=i.isShown;if(p){var d="false"!==(p=p.toLowerCase());a.visible=d}this.app.objectManager.create({type:o,name:n,node:a,parent:t,properties:l})}},e.prototype.parseDoorWins=function(e,t){for(var r in e){var i=e[r],n=r;i.name&&(n=i.name);var o=null;if(i.gltfid){var a=i.gltfid;this.nodes[a]&&(o=this.nodes[a])}var s=null;if(i.properties){var l=i.properties;s={};for(var c in l){var u=l[c];s[c]=u}}this.app.objectManager.create({type:"Door",name:n,node:o,parent:t,properties:s})}},e.prototype.load=function(e){var t=this;return this.sceneURL=e,new Promise(function(e,r){t.loadGLTF().then(function(e){return t.loadedSceneGLTF=e,e.scene.traverse(function(e){t.nodes[e.name]=e}),t.parseSceneJson()}).then(function(r){t.fitCamInfo?t.parseCamInfo(t.fitCamInfo):t.campus.node&&t.app.camera.fit(t.campus),e(t.campus)}).catch(function(){t.campus.node.add(t.loadedSceneGLTF.scene.children[0]),t.campus&&t.app.camera.fit(t.campus),e(t.campus)})})},e.prototype.loadGLTF=function(){var e=this;return new Promise(function(t,r){var i=new THREE.GLTFLoader(e.app.loadingManager);i.setCrossOrigin("anonymous"),i.load(e.sceneURL+"/Unity2GLTF.gltf",function(e){t(e)})})},e.prototype.parseSceneJson=function(){var e=this;return new Promise(function(t,r){new THREE.FileLoader(e.app.loadingManager).load(e.sceneURL+"/scene.json",function(r){var i=JSON.parse(r);e.sceneJsonData=i,e.parseWorld(i),t(i)},function(){},function(){console.error("not find file scene.json "),r()})})},e}(),nt=function(){function e(t){I(this,e),this.app=t,this.supportVersion={1:1,2:1,3:0},this.versionLib={1:{0:{0:tt},1:{0:it}},2:{0:{0:Ze},1:{0:$e,1:et}},3:{0:{0:rt,1:rt}}}}return e.prototype.getLoader=function(e){if(e){var t=e.version,r=0,i=0,n=0;if(t){var o=t.split(".");r=parseInt(o[0]),i=parseInt(o[1]),n=parseInt(o[2])}var a=null,s=this.versionLib[r];if(s){var l=s[i];l&&(a=l[n])}if(!a)return console.error("can not find right version "+t+" to load scenejson"),null;if(1===r)h=new a(this.app);else if(2===r)switch(i){case 1:var c={},u=e.position;u&&(c.position=u),e.rotation&&(c.rotation=e.rotation),e.campus&&(c.campus=e.campus),c.isCamFitScene=G.parseValue(e.isCamFitScene,!0),c.isDelayLoadFloorPlan=G.parseValue(e.isDelayLoadFloorPlan,!1),h=new a(this.app,c);break;default:h=new a(this.app)}else 3===r&&(h=new a(this.app,e));return h}var h=new tt(this.app);return h},e}(),ot=function(){function e(t){I(this,e),this.app=t}return e.prototype.load=function(e,t){var r=void 0,i=void 0;if(null!==e)if(G.isString(e))r=e,i=e;else if(G.isArray(e))r=e[0],i=e[1];else{var n=this.app.confirmBaseURL(t||"https://static.3dmomoda.com/").appendPath("textures");r=[n.appendPath("18121914knt6udgm")+".jpg",n.appendPath("18121914samwxteu")+".jpg",n.appendPath("18121914xnb113j8")+".jpg",n.appendPath("18121914ebsns29i")+".jpg",n.appendPath("18121914mt9ppmog")+".jpg",n.appendPath("18121914vwg2nqvt")+".jpg"],i=null}var o=null,a=null;if(i){var s=this.app.confirmURL(G.parseCubeTextureUrls(i));s&&(o=(new THREE.CubeTextureLoader).load(s,function(){}))}if(r){var l=this.app.confirmURL(G.parseCubeTextureUrls(r));l&&(a=(new THREE.CubeTextureLoader).load(l,function(){}))}return{indoorsEnvMap:o,outdoorsEnvMap:a}},e}(),at=function(e){function t(r){I(this,t);var i=N(this,e.call(this,r));i.name="Campus",i.outdoors=null,i._url="",i._sceneJSONData={},i._envMapResources=null;var n=i;return i.one("beforeload",null,function(e){var t=new ot(n.app);n._envMapResources=t.load(n.app.options.env,e.indexJson.resourceLibrary)}),i.one("load",null,function(){if(n.outdoors){var e=n.outdoors.node;e.userData={},e.removeBySelf();var t=n.outdoors.id,r=n.outdoors.uuid,i=n.app.create({type:"Ground",id:t,uuid:r,node:e,parent:n.outdoors.parent});n.outdoors.node=new THREE.Group,n.outdoors.destroy(),n.outdoors=i}n.getEnvMapResources()&&n.query(".Thing || .Facade").forEach(function(e){e.setupEnvMap(e instanceof THING.Facade)})}),i}return D(t,e),t.prototype.setupFromURL=function(e){e.isCamFitScene=G.parseValue(e.isCamFitScene,!1),this._url=this.app.confirmURL(e.url),this.app.campusLoader.load(this,e)},t.prototype.setupFromData=function(e){e.url="./",e.fileloader={load:function(t,r,i,n){var o=e.data[t.getFileName()];o?r&&r(o):n&&n()}},this.setupFromURL(e)},t.prototype.destroy=function(){this._url&&this.app.trigger("unload",{url:this._url}),this._floorNode=null,this.outdoors&&(this.outdoors.destroy(),this.outdoors=null),this.buildings.destroyAll(),this.app.resourceManager.disposeTextures(this._envMapResources),e.prototype.destroy.call(this)},k(t,[{key:"envMapResources",get:function(){return this._envMapResources}},{key:"url",get:function(){return this._url}},{key:"floorNode",set:function(e){this._floorNode=e},get:function(){return this._floorNode}},{key:"ground",get:function(){return this.outdoors}},{key:"sceneJSONData",get:function(){return this._sceneJSONData},set:function(e){e=e||{},this._sceneJSONData=e}},{key:"buildings",get:function(){return this.query(".Building",!1)}},{key:"things",get:function(){return this.query(".Thing",!1)}},{key:"isCampus",get:function(){return console.warn("[Campus] Please use 'instanceof THING.Campus' to replace '.isCampus'"),this instanceof THING.Campus}}]),t}(ye),st=function(){function e(t){I(this,e),this._major=0,this._minor=0,this._modified=0;var r=t.split(".");this._major=parseInt(r.length>=1?r[0]:0),this._minor=parseInt(r.length>=2?r[1]:0),this._modified=parseInt(r.length>=3?r[2]:0)}return e.prototype.compare=function(t){return G.isString(t)&&(t=new e(t)),this._major!=t._major?this._major>t._major?1:-1:this._minor!=t._minor?this._minor>t._minor?1:-1:this._modified!=t._modified?this._modified>t._modified?1:-1:0},k(e,[{key:"major",get:function(){return this._major}},{key:"minor",get:function(){return this._minor}},{key:"modified",get:function(){return this._modified}}]),e}(),lt=function(){function e(t){I(this,e),this.app=t,this.waitingLoadCampuses=[],this.loadingCampus=!1}return e.prototype._loadViewPointFile=function(e){var t=this.app.sceneManager,r=G.parseValue(e.enableDeafultViewPointFile,t.enableDeafultViewPointFile),i=e.defaultViewPointFileName||t.defaultViewPointFileName;if(r&&i){var n=e.url.appendPath(i),o=this;(new THREE.FileLoader).load(n,function(e){o.app.viewPointManger.loadJSON(e)})}},e.prototype._moveToBuilding=function(e,t,r){var i=r.buildings;if(i.length){var n=i[0];e.name=n.name,e.userData=n.userData;for(var o=n.floors,a=0;a<o.length;a++){var s=o[a];e.add(s)}}},e.prototype._moveToCampus=function(e,t,r){var i=e._id;e._id=r._id,e._name=r._name,e._uuid=r._uuid,e.position=r.position,e.angles=r.angles,e.scale=r.scale,e.visible=r.visible,e._sceneJSONData=r._sceneJSONData,e.node=r.node,e._floorNode=r._floorNode,e.outdoors=r.outdoors,e.remove(r);var n=e.children.concat();for(e.children=[],l=0;l<n.length;l++)e.add(n[l]);if(r.outdoors)for(l=0;l<r.outdoors.children.length;l++)e.add(r.outdoors.children[l]);for(l=0;l<r.children.length;l++){var o=r.children[l];o._parent=e,e.children.push(o)}r._id=i,r.node=new THREE.Group,r._floorNode=null,r.outdoors=null,r.children=[];var a=e.outdoors;if(a)for(var s=a.children.concat(),l=0;l<s.length;l++)e.add(s[l]);this.app.objectManager.objects.set(r.queryID,r),this.app.objectManager.objects.set(e.queryID,e),e.node.parent||this.app.scene.add(e.node)},e.prototype._moveFromUBuilder=function(e,t,r,i,n){r.scene&&r.scene.parent===this.app.scene&&this.app.scene.remove(r.scene),e instanceof ct?this._moveToBuilding(e,i,t):e instanceof at&&this._moveToCampus(e,i,t),t.destroy(),n&&n()},e.prototype.loadFromUBuilder=function(e,t,r,i,n){var o=this,a=i.position,s=i.rotation||i.angles,l=i.scale,c=i.outdoorsVisible,u=i.campusVisible,h=G.parseValue(i.isCamFitScene,!0),p=G.parseValue(i.isDelayLoadFloorPlan,!1),d=i.splitLoadSpeed,f=G.parseValue(i.disableCache,!1);a&&(r.position=a),s&&(r.rotation=G.parseQuaternion(s)),l&&(r.scale=l),void 0!==c&&(r.outdoorsVisible=c),void 0!==u&&(r.campusVisible=u),r.isCamFitScene=h,r.isDelayLoadFloorPlan=p,r.enableDownloadSceneJsonCache=!f;var m=new nt(this.app).getLoader(r);m.loadSpeed=d;var g=r.camInfo;g&&(m.fitCamInfo=g),m.load(t).then(function(t){var l=m.sceneJson?m.sceneJson:r;if(l){var c=l.camInfo;c&&(c.eye=G.parseVector3(c.eye),c.eye.z*=-1,c.eye=c.eye.toArray(),c.target=G.parseVector3(c.target),c.target.z*=-1,c.target=c.target.toArray())}t.sceneJSONData=l,t.position=t.position||a,t.angles=t.angles||s,o._moveFromUBuilder(e,t,m,i,n)})},e.prototype.updateItemNumber=function(e){if(e.loadedNumber++,e.loadedNumber==e.totalNumber){var t=e.complete;t&&t(),e.complete=null}var r=e.loadedNumber/e.totalNumber;this.app.mainUI.updateLoadingProcess(r)},e.prototype.updateTotalItemNumber=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;e.totalNumber+=t},e.prototype.getBundleData=function(e,t){if(G.isNull(e)||e>=t.length)return!1;var r=t[e],i=r.id;return!!i&&{url:this.app.modelURL.appendPath(i).appendPath("/0/gltf/"),name:r.name}},e.prototype.parseFloorPlan=function(e,t,r,i,n){var o=this;return this.app.create({type:"Floor",name:e.name,data:t,localPosition:[0,e.localPosition[1],0],visible:e.visible,parent:e.parent,complete:function(){var e=i.models;if(e){var t=r.objects;if(t)for(var a=0;a<t.length;a++){var s=t[a];o.parseThing(this,s,e,i,n)}}}})},e.prototype.parseFloorPlans=function(e,t,r,n){for(var o=e.buildings,a=0;a<o.length;a++)for(var s=o[a],l=s.floors,c=0;c<l.length;c++){var u=l[c],h=u.internalUserData.floorPlanID,p=u.internalUserData.height,d=u.internalUserData.outlineShape,f=t[h];if(f){var m=i(f.structure,1,!1,!0);if(m){m.planheight=p;var g=this.parseFloorPlan(u,m,f,r,n);g.add(d),d.visible=!1,s.swapChild(u,g),u.destroy()}}}return!0},e.prototype.parseFloor=function(e,t,r,i){var n=t.floors;if(!n)return!1;this.updateTotalItemNumber(r,n.length);for(var o=t.size,a=0,s=0;s<n.length;s++){var l=n[s],c=l.id,u=l.height,h=this.app.create({type:"Floor",localPosition:[0,a,0],parent:e,visible:!1});h.internalUserData.floorPlanID=c,h.internalUserData.height=u;var p,d=l.outlineData;d?((p=this.app.create({type:"Shape",vertices:d,height:1,parent:h})).scale=[1,u,1],p.style.setMaterial({index:0,color:11194623,opacity:.6,transparent:!0}),p.style.setMaterial({index:1,image:"images/sf_texture/blue.png",wrapType:THING.WrapType.Repeat,doubleSide:!0,transparent:!0})):(p=this.app.create({type:"Box",width:o[0],height:u,depth:o[2],center:"Bottom",parent:h})).style.setMaterial({image:"images/sf_texture/blue.png",wrapType:THING.WrapType.Repeat,doubleSide:!0,transparent:!0}),h.internalUserData.outlineShape=p,a+=u,this.updateItemNumber(r)}return!0},e.prototype.parseBuilding=function(e,t,r,i,n){var o=t.position,a=t.localPosition,s=t.angles,l=t.scale,c=t.thingClass,u=t.name,h=t.id,p=t.userData,d=t.tags,f=this.app.create({type:c,name:u,id:h,position:o,localPosition:a,angles:s,scale:l,userData:p,tags:d,parent:e});(r=this.getBundleData(t.model,r))&&this.app.create({type:"Facade",url:r.url,parent:f});var m=i.buildings[h];return!(m&&!this.parseFloor(f,m,i,n))},e.prototype.parseThing=function(e,t,r,i,n){if(!(r=this.getBundleData(t.model,r)))return!1;this.updateTotalItemNumber(i);var o=t.position,a=t.localPosition,s=t.angles,l=t.scale,c=t.thingClass,u=t.name,h=t.id,p=t.userData,d=t.tags,f=this;return this.app.create({type:c,name:u,id:h,position:o,localPosition:a,angles:s,scale:l,userData:p,tags:d,url:r.url,parent:e,indexJsonCallback:function(){f.updateItemNumber(i)}}),!0},e.prototype.parseObject=function(e,t,r,i,n){var o=t.thingClass;return"Building"==o?this.parseBuilding(e,t,r,i,n):"Thing"==o&&this.parseThing(e,t,r,i,n)},e.prototype.parseGround=function(e){},e.prototype.parseEffects=function(e){var t=e.fog;t&&(this.app.fog=t);var r=e.lighting;r&&(this.app.lighting=r);var i=e.postEffect;i&&(this.app.postEffect=i);var n=e.skyBox;n&&(this.app.skyBox=n);var o=e.ground;o&&this.parseGround(o)},e.prototype.parseScene=function(e,t,r,i){var n=this;if(G.parseValue(i.isCamFitScene,!1)){var o=r.camInfo;if(o){var a=G.parseVector3(o.eye);a&&(this.app.camera.position=a.toArray());var s=G.parseVector3(o.target);s&&(this.app.camera.target=s.toArray()),e.sceneJSONData.camInfo={eye:a.toArray(),target:s.toArray()}}}var l=t.models;if(l){t.loadedNumber=0,t.totalNumber=0;var c=t.objects;if(c){this.updateTotalItemNumber(t,c.length);for(var u=0;u<c.length;u++){var h=c[u];this.parseObject(e,h,l,t,i),this.updateItemNumber(t)}}var p=r.files.floors;if(p){var d=t.url.appendPath(p);(i.fileloader||new THREE.FileLoader).load(d,function(r){var o=JSON.parse(r);n.parseFloorPlans(e,o,t,i)},function(){},function(){})}var f=r.effects;f&&this.parseEffects(f)}},e.prototype.loadFromCampusBuildier=function(e,t,r,i,n){var o=this,t=this.app.confirmURL(t),a=r.files;if(a){var s=a.campus;if(s){var l=i.parent||this.app.root;l&&l.add(e);var c=t.appendPath(s);(i.fileloader||new THREE.FileLoader).load(c,function(a){var s=JSON.parse(a);s.url=t,s.complete=n,o.parseScene(e,s,r,i)},function(){},function(){})}else console.error('load "'+t+'" failed, due to scene file name of index.json is missing')}else console.error('load "'+t+'" failed, due to files of index.json is missing')},e.prototype._loadCampusFinished=function(e,t){this._loadViewPointFile(t),this.app.sceneManager.setupSceneLights({})},e.prototype._loadFinished=function(e,t){e instanceof at?(t.parent=t.parent||this.app.root,e._setup(t)):e instanceof Buliding&&e._setup(t),this._loadCampusFinished(e,t)},e.prototype.load=function(e,t){var r=this,i=this.app.confirmURL(t.url),n=i.appendPath("index.json");G.parseValue(t.disableCache,!1)&&(n=n.appendRandomSuffix()),(t.fileloader||new THREE.FileLoader).load(n,function(n){var o=JSON.parse(n);new st(o.version).major<4?r.waitingLoadCampuses.push({owner:e,url:i,indexJson:o,params:t}):r.loadCampus(e,i,o,t)},function(){},function(){var n=new nt(r.app).getLoader();n.load(i).then(function(i){r._moveFromUBuilder(e,i,n,t,function(){r._loadFinished(e,t)})})})},e.prototype.loadCampus=function(e,t,r,i){var n=this;this.loadingCampus=!0,json2mesh.DefaultSetting.enableFloorLightMap=G.parseValue(i.enableFloorLightMap,!1),i.indexJson=r,e.trigger(ve.BeforeLoad,i),this.app.loadingProgressBar.prepare(),new st(r.version).major<4?this.loadFromUBuilder(e,t,r,i,function(){n._loadFinished(e,i),n.loadingCampus=!1}):this.loadFromCampusBuildier(e,t,r,i,function(){n._loadFinished(e,i),n.loadingCampus=!1})},e.prototype.update=function(){if(!this.loadingCampus)for(var e=0;e<this.waitingLoadCampuses.length;e++){var t=this.waitingLoadCampuses[e];this.loadCampus(t.owner,t.url,t.indexJson,t.params),this.waitingLoadCampuses.splice(e,1)}},e.prototype._buildCampusStructure=function(e,t){t.app=this.app,t.type=e.type,t.name=e.name?e.name:e.id,t.id=e.id?e.id:e.uuid,t.uuid=e.uuid,t.userData=e.userData,t.children=[],t.getAttribute=function(e){return G.getAttribute(this,e)},t.getPath=function(){for(var e=this.id,t=this.parent;t&&t.parent&&t.parent.parent;)e=t.id+"/"+e,t=t.parent;return e},t._traverseObjects=function(e,t){for(var r=0;r<this.children.length;r++){var i=this.children[r];G.isFunction(e)?e(i):G.isArray(e)&&e.push(i),t&&i._traverseObjects(e,t)}},t.query=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=[];this._traverseObjects(r,t);var i=new Y(this.app,r);return i.select(e),i};for(var r=0;r<e.children.length;r++){var i=e.children[r],n={id:i.id,parent:t};t.children.push(n),this._buildCampusStructure(i,n)}},e.prototype._peekJSONBySimpleLoader=function(e,t,r){var i=r.complete,n=r.errorCallback,o=this;t.load(e).then(function(t){var r={url:e,id:t.id,children:[]};o._buildCampusStructure(t,r),t.destroy(),i&&i(r)}).catch(function(e){console.error(e),n&&n()})},e.prototype.peekJSON=function(e,t){t=t||{};var r=(e=this.app.confirmURL(e)).appendPath("index.json");G.parseValue(t.disableCache,!1)&&(r=r.appendRandomSuffix());var i=this;(t.fileloader||new THREE.FileLoader).load(r,function(r){var n=JSON.parse(r),o=new st(n.version);4==o.major||(3==o.major?i._peekJSONBySimpleLoader(e,new Ge(i.app),t):i._peekJSONBySimpleLoader(e,new qe(i.app),t))},function(){},function(){i._peekJSONBySimpleLoader(e,new qe(i.app),t)})},e}(),ct=function(e){function t(r){I(this,t);var i=N(this,e.call(this,r));return i._graph=null,i._expanded=!1,i}return D(t,e),t.prototype.canResponeEventFrom=function(t){var r=t.object;if(r.isChildOf(this)){var i=t.type;if(i==ve.MouseEnter||"mouseon"==i){if(r instanceof dt)return!0;if(r instanceof be)return!0}}return e.prototype.canResponeEventFrom.call(this,t)},t.prototype._addFromCampus=function(e){if(e.buildings.length){this.floors.destroy();var t=this;e.buildings[0].floors.forEach(function(e){t.add(e)})}},t.prototype.setupElevators=function(){var e={};this.query(".ElevatorDoor").forEach(function(t){var r=t.userData._ELEVATOR_;e[r]||(e[r]=[]),e[r].push(t)});for(var t in e){var r=e[t];this.app.create({type:"Elevator",name:t,parent:this,doors:r})}},t.prototype.setupStairs=function(){this.query("[type=stairway]").forEach(function(e){e.floorNode.visible=!1});var e={};this.query(".StairDoor").forEach(function(t){t.visible=!1;var r=t.userData._STAIR_;e[r]=e[r]||[],e[r].push(t)});for(var t in e){var r=e[t];this.app.create({type:"Stair",name:t,parent:this,doors:r})}},t.prototype.setupGraph=function(){if(!this._graph){this.setupElevators(),this.setupStairs();var e={};this.floors.forEach(function(t){e[t.id]=e[t.id]||{};for(var r=t.linkableDoors,i=0;i<r.length;i++){var n=r[i],o=n.owner;e[n.id]=e[n.id]||{},e[o.id]=e[o.id]||{},e[t.id][n.id]=e[n.id][t.id]=1e4,e[o.id][n.id]=e[n.id][o.id]=1e4}}),this._graph=new Graph(e)}},t.prototype.setupFromURL=function(e){this.app.campusLoader.load(this,e)},t.prototype.updateBounds=function(){e.prototype.updateBounds.call(this),this.floors.forEach(function(e){e.updateBounds()})},t.prototype.destroy=function(){this._graph=null,e.prototype.destroy.call(this)},t.prototype.hasAnyFacadesVisible=function(){for(var e=this.facades,t=0;t<e.length;t++)if(e[t].visible)return!0;return!1},t.prototype.hasFacades=function(){return 0!==this.facades.length},t.prototype.showAllRoofs=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.floors.forEach(function(t){t.showAllRoofs(e)})},t.prototype.expandFloors=function(e){this.expandCmd||(this.expandCmd=this.app.commandManager.create({type:"ExpandObjects",objects:this.floors.objects})),this.expandCmd.setParam(e),this.expandCmd.execute(),this._expanded=!0},t.prototype.unexpandFloors=function(e){this.expandCmd&&(this.expandCmd.setParam(e),this.expandCmd.undo(),this._expanded=!1)},t.prototype.showFacades=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];console.warn("[Building] Please use '.facades.visible=true/false' to replace '.showFacades()'"),this.facades.visible=e},t.prototype.showFloors=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];console.warn("[Building] Please use '.floors.visible=true/false' to replace '.showFloors()'"),this.floors.visible=e},t.prototype.showRoof=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];console.warn("[Building] Please use '.showAllRoofs()' to replace '.showRoof()'"),this.showAllRoofs(e)},k(t,[{key:"graph",get:function(){return this.setupGraph(),this._graph}},{key:"expanded",get:function(){return this._expanded}},{key:"facade",get:function(){return this.query(".Facade",!1)[0]}},{key:"facades",get:function(){return this.query(".Facade",!1)}},{key:"elevators",get:function(){return this.query(".Elevator",!1)}},{key:"stairs",get:function(){return this.query(".Stair",!1)}},{key:"floors",get:function(){return this.query(".Floor",!1)}},{key:"things",get:function(){return this.query(".Thing",!1)}},{key:"isBuilding",get:function(){return console.warn("[Building] Please use 'instanceof THING.Building' to replace '.isBuilding'"),this instanceof THING.Building}}]),t}(ye),ut=function(){function e(t,r){I(this,e),this.app=t,this.textures=new Map,this._canvas=null,this._enableFileNameAsKey=r,this.loader=new THREE.TextureLoader(this.app.loadingManager)}return e.prototype.isPowerOf2=function(e){return Math.isPowerOf2(e.width)&&Math.isPowerOf2(e.height)},e.prototype.makePowerOf2=function(e){return e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof ImageBitmap?(this._canvas||(this._canvas=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")),this._canvas.width=Math.floorPowerOf2(e.width),this._canvas.height=Math.floorPowerOf2(e.height),this._canvas.getContext("2d").drawImage(e,0,0,this._canvas.width,this._canvas.height),this._canvas):e},e.prototype.load=function(e,t,r,i){var n,o=e.getNormalize();n=this._enableFileNameAsKey?o.getFileName(!1):o;var a=this.textures.get(n);if(a)return a.refCount++,setTimeout(function(){t&&t(a.resource)},100),a.resource;var s=this;if(!(a=this.loader.load(o,function(e){var r=e.image,i=s.app.options.maxTextureSize;(r.width>i||r.height>i)&&console.warn("The '"+r.src+"' texture is too big("+r.width+"x"+r.height+") max size: ("+i+"x"+i+")"),t(e)},r,i)))return null;a.key=n;var l=this.textures.get(n);return l?l.refCount++:this.textures.set(n,{resource:a,refCount:1}),a},e.prototype.setCrossOrigin=function(e){return this.loader.setCrossOrigin(e),this},e.prototype.setPath=function(e){return this.loader.setPath(e),this},e.prototype.removeTexture=function(e){var t=this.textures.get(e.key);if(t){if(t.refCount&&t.refCount--,!t.refCount&&!this.app.scene.hasTexture(e))return e.dispose(),this.textures.delete(e.key),!0}else if(!this.app.scene.hasTexture(e))return e.dispose(),!0;return!1},e.prototype.loadFromImage=function(e){var t=this.textures.get(e);return t?t.refCount++:((t=new THREE.Texture).image=e,t.needsUpdate=!0,t.key=e),t},k(e,[{key:"enableFileNameAsKey",set:function(e){this._enableFileNameAsKey=e},get:function(){return this._enableFileNameAsKey}},{key:"repetitionRate",get:function(){if(!this.textures.size)return 0;var e=0;return this.textures.forEach(function(t){e+=t.refCount}),e/this.textures.size-1}}]),e}(),ht=function(){function e(t){I(this,e),this.app=t}return e.prototype.initOptions=function(e){this.app.resourceManager.textureLoader},e.prototype.parseDoorOrWindow=function(e,t,r){function i(e,t){var r=n.app.objectManager.create({type:"Door",id:t.id,name:t.name,node:t.delayObject,parent:e,animations:t.resource.animations,properties:t.properties});if(t.isOpen&&r.open(),r.animationClips)for(var i=0;i<r.animationClips.length;i++){var o=r.animationClips[i];if("_defaultAnim_"===o.name){r.playAnimation({name:o.name,loop:!0,speed:.15});break}}return r}var n=this;t.mesh?i():t.initCompleteCallback=function(t){var r=i(e,t);e.miscNode.add(r.node)}},e.prototype.parseWall=function(e,t,r){for(var i=0;i<t.doorOrWindows.length;i++){var n=t.doorOrWindows[i];this.parseDoorOrWindow(e,n,r)}},e.prototype.parseGroups=function(e,t,r){for(var i=0;i<t.groups.length;i++){var n=t.groups[i],o="Thing";n.jsonData&&n.jsonData.type&&(o=n.jsonData.type),this.app.objectManager.create({id:n.id,name:n.name,node:n.delayObject,type:o,parent:e,properties:n.properties})}},e.prototype.parsePlacements=function(e,t,r){for(var i=0;i<t.placements.length;i++){var n=t.placements[i],o="Thing";if(n.jsonData&&n.jsonData.type&&(o=n.jsonData.type),n.mesh){var a=this.app.objectManager.create({id:n.id,type:o,name:n.name,node:n.delayObject,parent:e,url:n.resource.getModelUrl(),animations:n.resource.animations,properties:n.properties});if(a.bundleID=n.resource.modelID,a.bundleName=n.resource.modelName,n.isPlayAnim&&a.containAnimation(n.animClip)){var s={name:n.animClip,loop:!1,speed:.15};n.hasSkin&&(s.loop=!0),a.playAnimation(s)}}}},e.prototype.parseRooms=function(e,t,r){for(var i=0;i<t.rooms.length;i++){var n=t.rooms[i];this.app.objectManager.create({type:"Room",name:n.name,node:n.mesh,ceilingNode:n.ceiling.mesh,roofNode:n.roof.mesh,floorNode:n.floor.mesh,parent:e,properties:n.properties})}},e.prototype.parsePlan=function(e,t,r){for(var i=new THREE.Object3D("combineFloor"),n=0;n<t.combineFloors.length;n++){var o=t.combineFloors[n];i.add(o)}e.node.add(i),e.floorNode=i;for(var a=new THREE.Object3D("combineCeiling"),n=0;n<t.combineCeilings.length;n++){var s=t.combineCeilings[n];a.add(s)}e.node.add(a),e.ceilingNode=a;for(var l=new THREE.Object3D("combineRoof"),n=0;n<t.combineRoofs.length;n++){var c=t.combineRoofs[n];l.add(c)}e.node.add(l),e.roofNode=l;for(var u=new THREE.Object3D("combinePlacement"),n=0;n<t.combinePlacements.length;n++)f=t.combinePlacements[n],u.add(f);e.node.add(u),e.miscNode=u;for(var h=new THREE.Object3D("combineWall"),p=0;p<t.combineStraightManualWalls.length;p++)d=t.combineStraightManualWalls[p],h.add(d);for(p=0;p<t.combineModelWalls.length;p++){var d=t.combineModelWalls[p];h.add(d)}for(p=0;p<t.combineDoorOrWins.length;p++){var f=t.combineDoorOrWins[p];h.add(f)}e.node.add(h),e.wallNode=h},e.prototype.parseFloor=function(e,t,r){var i=t.buildings[0].floorplans[0];e.name=i.name,this.parsePlan(e,i,r),this.parseGroups(e,i,r),this.parsePlacements(e,i,r),this.parseRooms(e,i,r);for(var n=0;n<i.walls.length;n++){var o=i.walls[n];this.parseWall(e,o,r)}},e.prototype.load=function(e,t,r){var t=app.confirmURL(t),i=this;new THREE.FileLoader(this.app.loadingManager).load(t+"/scene.json",function(t){var n=JSON.parse(t);i.loadFromData(e,n,r)})},e.prototype.loadFromData=function(e,t,r){r=r||{},this.initOptions(r);var i=r.complete;json2mesh.DefaultSetting.enableFloorLightMap=G.parseValue(r.enableFloorLightMap,!1);var n=this,o=new json2mesh.ThingjsEditorSceneLoader;o.delayLoad({json:t}).then(function(t){n.parseFloor(e,t,r),o.loadResources().then(function(){i&&i(e)})})},e}(),pt=function(){function e(t){I(this,e),this.app=t,this.floor=null,this.prevFloorPosition=null,this.prevFloorScale=null,this.prevFloorAngles=null,this.rooms=[],this.groupNavigation=null,this.navigationHelpersNode=null,this.navigationHelpers=[]}return e.prototype.clear=function(){this.showHelper(!1),this.floor=null,this.prevFloorPosition=null,this.prevFloorScale=null,this.prevFloorAngles=null,this.rooms=[],this.groupNavigation=null,this.navigationHelpers=[]},e.prototype.needGen=function(){var e=this.floor;if(!e)return!0;var t=G.parseVector3(e.position),r=G.parseVector3(e.scale),i=G.parseVector3(e.angles);return!t.equals(this.prevFloorPosition)||!r.equals(this.prevFloorScale)||!i.equals(this.prevFloorAngles)},e.prototype.initFromRooms=function(e){for(var t=[],r=0;r<e.length;r++){var i=e[r],n=i._floorNode;if(n){var o=n.getMeshes();if(o.length){var a=o[0],s=a.geometry;if(s){var l=s.clone();a.updateMatrixWorld(),l.applyMatrix(a.matrixWorld);var c=[];i.doors.forEach(function(e){c.push(G.parseVector3(e.position))}),l.isBufferGeometry||(l=(new THREE.BufferGeometry).fromGeometry(l));var u=new MeshNavigation(l,c,30);t.push(u);var h=new MeshNavigationHelper(u);this.navigationHelpers.push(h),this.rooms.push(i)}}}}this.groupNavigation=new GroupNavigation(t)},e.prototype.init=function(e){this.clear(),this.floor=e,this.prevFloorPosition=G.parseVector3(e.position),this.prevFloorScale=G.parseVector3(e.scale),this.prevFloorAngles=G.parseVector3(e.angles);var t=e.rooms;t.length?this.initFromRooms(t):this.initFromRooms([e])},e.prototype.getRoomID=function(e){if(e instanceof ye)return this.rooms.indexOf(e);for(var t=0;t<this.rooms.length;t++){var r=this.rooms[t];if(r instanceof dt)return t;if(r.getRayCastPosition(e))return t}return-1},e.prototype.getRoomInfo=function(e,t,r){var i=e[t],n=e[r],o=-1;return i?o=this.getRoomID(i):n&&(o=this.getRoomID(n)),-1===o?null:{id:o,pos:G.parseVector3(n)}},e.prototype.findPath=function(e){e=e||{};var t=this.getRoomInfo(e,"startRoom","startPosition");if(!t)return null;var r=this.getRoomInfo(e,"endRoom","endPosition");if(!r)return null;var i=this.groupNavigation.findPath(t.id,t.pos,r.id,r.pos);if(!i||!i.length)return null;for(var n=e.height||0,o=t.pos,a=[t.pos.toArray()],s=0;s<i.length;s++){var l=i[s];l.y+=n,length+=l.distanceTo(o),o=l,a.push(l.toArray())}return a.getPathLength=function(){return G.getLength(this)},a},e.prototype.showHelper=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this.floor)if(e){if(!this.navigationHelpersNode){this.navigationHelpersNode=new THREE.Group;for(var t=0;t<this.navigationHelpers.length;t++){var r=this.navigationHelpers[t],i=r.createRebuiltTrianglesMesh();i.position.y=.1,i.material.color.setHex(6985427),this.navigationHelpersNode.add(i);var n=r.createPathPointsMesh();this.navigationHelpersNode.add(n);var o=r.createPathLineSegmentsMesh();this.navigationHelpersNode.add(o)}this.app.scene.add(this.navigationHelpersNode)}}else this.navigationHelpersNode&&(this.app.resourceManager.remove(this.navigationHelpersNode),this.navigationHelpersNode=null)},e}(),dt=function(e){function t(r){I(this,t);var i=N(this,e.call(this,r));return i.miscNode=null,i.miscObject=null,i.wallNode=null,i.wallObject=null,i.roofNode=null,i.roofObject=null,i.ceilingNode=null,i.ceilingObject=null,i._marker=null,i._navigation=null,i}return D(t,e),t.prototype.synTransform=function(e){this.setupUserData(e),this.setupParent(e),this.setupTranslation(e)},t.prototype.setupFromData=function(e){var t=this,r=e.data,i=e.options||{};i.complete=function(){t._setup(e)},this.synTransform(e),new ht(this.app).loadFromData(this,r,i)},t.prototype.setupFromURL=function(e){var t=this,r=this.app.confirmURL(e.url),i=e.options||{};i.complete=function(){t._setup(e)},this.synTransform(e),new ht(this.app).load(this,r,i)},t.prototype.clone=function(t,r){var i=e.prototype.clone.call(this,t,r);return i.miscNode=i.node.getChildNodeByIndexPath(this.miscNode.getIndexPath(this.node)),i.wallNode=i.node.getChildNodeByIndexPath(this.wallNode.getIndexPath(this.node)),i.roofNode=i.node.getChildNodeByIndexPath(this.roofNode.getIndexPath(this.node)),i.ceilingNode=i.node.getChildNodeByIndexPath(this.ceilingNode.getIndexPath(this.node)),i},t.prototype._getDoors=function(e){for(var t=[],r=0;r<this.doors.length;r++){var i=this.doors[r];i[e]&&t.push(i)}return t},t.prototype._createMarker=function(e){var t=(e=e||{}).connectorName||/connector/,r=e.markerName||/marker/,i=this.attachPoints.query(t),n=this.attachPoints.query(r);if(0!=i.length||0!=n.length){var o=i[0],a=n[0];e.type="Marker",e.parent=this,G.isNull(e.size)?console.error("floor's marker must provide size to show"):G.isNull(e.canvas)&&G.isNull(e.url)?console.error("floor's marker must provide 'canvas' or 'url' to show"):(a&&(e.position=a.position),o?e.lineToPosition=o.position:e.lineColor&&console.error("Please make sure connector is avaliable for showing connection line of marker"),this._marker=this.app.create(e))}},t.prototype.showAllRoofs=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.roofNode&&(this.roofNode.visible=e);for(var t=this.rooms,r=0;r<t.length;r++)t[r].roof.visible=e},t.prototype.showCeiling=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.ceilingNode&&(this.ceilingNode.visible=e);for(var t=this.rooms,r=0;r<t.length;r++)t[r].ceiling.visible=e},t.prototype.showMarker=function(e){this._marker||this._createMarker(e),G.isBoolean(e)?this._marker.visible=e:this._marker.setParams(e)},t.prototype.findPath=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.1;return this.navigation.findPath({startPosition:e,endPosition:t,height:r})},t.prototype.showNavigationHelper=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.navigation.showHelper(e)},t.prototype.getRoomFromLocalPosition=function(e){var t=this.localToWorld(e);if(!t)return null;for(var r=this.rooms,i=0;i<r.length;i++){var n=r[i];if(n.getRayCastPosition(t))return n}return null},t.prototype.showThings=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];console.warn("[Floor] Please use '.things.visible=true/false' to replace '.showThings'"),this.things.visible=e},t.prototype.showDoors=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];console.warn("[Floor] Please use '.things.visible=true/false' to replace '.showThings'"),this.doors.visible=e},t.prototype.hideMarker=function(){console.warn("[Floor] Please use '.showMarker(false)' to replace '.hideMarker'"),this.showMarker(!1)},t.prototype.setMarker=function(e){console.warn("[Floor] Please use '.showMarker(params)' to replace '.setMarker'"),this.showMarker(e)},t.prototype.getFindingPathLength=function(e,t){return console.warn("[Floor] Please use '.findPath().getPathLength()' to replace '.getFindingPathLength()'"),this.findPath(e,t).getPathLength()},t.prototype.showRoof=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];console.warn("[Floor] Please use '.showAllRoofs()' to replace '.showRoof()'"),this.showAllRoofs(e)},k(t,[{key:"isOutdoors",get:function(){var e=this.building;return!(!e||e.hasFacades())}},{key:"building",get:function(){return this.parents.query(".Building")[0]}},{key:"levelNumber",get:function(){return this.indexOfParent(!0)+1}},{key:"things",get:function(){return this.query(".Thing",!1)}},{key:"doors",get:function(){return this.query(".Door",!1)}},{key:"elevatorDoors",get:function(){return this.doors.query(".ElevatorDoor",!1)}},{key:"stairDoors",get:function(){return this.doors.query(".StairDoor",!1)}},{key:"linkableDoors",get:function(){var e=this.elevatorDoors.objects;return e=e.concat(this.stairDoors.objects)}},{key:"stairs",get:function(){return this.query(".Stair",!1)}},{key:"rooms",get:function(){return this.query(".Room",!1)}},{key:"misc",get:function(){return this.miscObject=this.miscObject||new ye(this.app,this.miscNode,this),this.miscObject}},{key:"plan",get:function(){return this.floorObject=this.floorObject||new ye(this.app,this.floorNode,this),this.floorObject}},{key:"wall",get:function(){return this.wallObject=this.wallObject||new ye(this.app,this.wallNode,this),this.wallObject}},{key:"roof",get:function(){return this.roofObject=this.roofObject||new ye(this.app,this.roofNode,this),this.roofObject}},{key:"ceiling",get:function(){return this.ceilingObject=this.ceilingObject||new ye(this.app,this.ceilingNode,this),this.ceilingObject}},{key:"marker",get:function(){return this._marker}},{key:"navigation",get:function(){return this._navigation||(this._navigation=new pt(app)),this._navigation.needGen()&&this._navigation.init(this),this._navigation}},{key:"isFloorPlan",get:function(){return console.warn("[Floor] Please use '.isFloor' to replace '.isFloorPlan'"),!0}},{key:"levelNum",get:function(){return console.warn("[Floor] Please use '.levelNumber' to replace '.levelNum'"),this.levelNumber}},{key:"indexOfBuilding",get:function(){return console.warn("[Floor] Please use '.levelNumber - 1' to replace '.indexOfBuilding'"),this.levelNumber-1}},{key:"isFloor",get:function(){return console.warn("[Floor] Please use 'instanceof THING.Floor' to replace '.isFloor'"),this instanceof THING.Floor}}]),t}(ye),ft=function(e){function t(r){I(this,t);var i=N(this,e.call(this,r));return i.name="Outdoors",i._floorNode=null,i}return D(t,e),t.prototype.destroy=function(){this._floorNode=null,e.prototype.destroy.call(this)},t.prototype.setup=function(e){this.setupCommonInfo(e),this.setupParent(e),this.parent.outdoors=this,this.setupUserData()},t.prototype.setPolygonOffset=function(e){var t=this._floorNode;if(t){var r=new ye(this.app);r.node=t,r.style.setPolygonOffset(e)}},k(t,[{key:"floorNode",set:function(e){this._floorNode=e},get:function(){return this._floorNode}},{key:"canNotQueryFromSelector",get:function(){return!0}},{key:"isOutdoors",get:function(){return console.warn("[Outdoors] Please do not use 'outdoors.isOutdoors', we will delete is soon in the future"),!0}}]),t}(dt),mt=function(e){function t(r){return I(this,t),N(this,e.call(this,r))}return D(t,e),t}(ye),gt=function(e){function t(r){I(this,t);var i=N(this,e.call(this,r));return i._ceilingNode=null,i._ceilingObject=null,i._roofNode=null,i._roofObject=null,i._floorNode=null,i._floorObject=null,i._volumeNode=null,i._volumeObject=null,i._auxiliaryInfo=null,i}return D(t,e),t.prototype.setup=function(t){e.prototype.setup.call(this,t),this._ceilingNode=t.ceilingNode||this._ceilingNode,this._roofNode=t.roofNode||this._roofNode,this._floorNode=t.floorNode||this._floorNode,this._auxiliaryInfo=t.auxiliaryInfo||this._auxiliaryInfo},t.prototype.getMode=function(e){return e.geometry instanceof THREE.ShapeGeometry?"xy":"xz"},t.prototype.getFloorMesh=function(){var e=this._floorNode;if(!e)return null;var t=e.getMeshes();return t.length?t[0]:null},t.prototype.getRoomHeight=function(){return 3},t.prototype.localToWorld=function(t){var r=G.parseVector3(this.center),i=G.parseVector3(this.position),n=G.parseVector3(e.prototype.localToWorld.call(this,t));return r.sub(i),n.add(r),n.toArray()},t.prototype.selfToWorld=function(e){var t=this.labelPosition;return Math.addVector3(t,e)},t.prototype.showGrid=function(t,r,i,n,o){var a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.01;e.prototype.showGrid.call(this,t,r,i,n,o,a);var s=G.parseVector3(this.labelPosition);this._grid._setWorldPosition(s,!1,this.static)},t.prototype.getLabelPosition=function(e){var t=this.getFloorMesh();if(!t)return null;var r=t.getLabelPosition(e,this.getMode(t));return r?r.toArray():null},t.prototype.getAvaliablePositions=function(e,t,r){if(G.isNumber(e)){for(var i=[],n=0;n<e;n++)i.push(t);t=i}var o=this.getFloorMesh();if(!o)return null;var a=o.getAvaliableLabelPosition(t,this.getMode(o),r);if(!a)return null;for(n=0;n<a.length;n++)a[n]=a[n].toArray();return a},t.prototype.getRayCastPosition=function(e){if(!(e=G.parseVector3(e)))return null;var t=this.getFloorMesh();if(!t)return null;var r=t.getRayCastPosition(e);return r?r.toArray():null},t.prototype.getPoints=function(e){},t.prototype.showCeiling=function(e){console.warn("[Room] Please use '.ceiling.visible=true/false' to replace '.showCeiling()'"),this.ceiling.visible=e},t.prototype.showRoof=function(e){console.warn("[Room] Please use '.roof.visible=true/false' to replace '.showRoof()'"),this.roof.visible=e},t.prototype.showFloor=function(e){console.warn("[Room] Please use '.floorNode.visible=true/false' to replace '.showFloor()'"),this.floorNode.visible=e},t.prototype.showRoof=function(e){console.warn("[Room] Please use '.roof.visible=true/false' to replace '.showRoof()'"),this.roof.visible=e},t.prototype.setFloor=function(e){console.warn("[Room] Please use '.floorNode.style.' to replace '.setFloor()'"),e=e||{};var t=this.floorNode.style,r=e.color;r&&(t.color=r);var i=e.opacity;i&&(t.opacity=i)},t.prototype.getAvaliableFloorPos=function(e,t){return console.warn("[Room] Please use '.floor.getAvaliablePositions()' to replace '.getAvaliableFloorPos()'"),this.getAvaliablePositions(e,t)},k(t,[{key:"labelPosition",get:function(){var e=this.getLabelPosition(null);if(e)return e;var t=this._auxiliaryInfo;return t&&t.center?t.center.toArray():null}},{key:"perimeter",get:function(){var e=this.getFloorMesh();return e?e.getPerimeter():0}},{key:"area",get:function(){var e=this.getFloorMesh();return e?e.getArea():0}},{key:"ceiling",get:function(){return this._ceilingObject=this._ceilingObject||new ye(this.app,this._ceilingNode),this._ceilingObject}},{key:"roof",get:function(){return this._roofObject=this._roofObject||new ye(this.app,this._roofNode),this._roofObject}},{key:"plan",get:function(){return this._floorObject=this._floorObject||new ye(this.app,this.getFloorMesh()),this._floorObject}},{key:"floor",get:function(){return this.parents.query(".Floor")[0]}},{key:"volume",get:function(){if(!this._volumeNode){var e=this.getFloorMesh();if(!e)return null;if(this._volumeNode=e.clone(),!this._volumeNode)return null;if(this._volumeNode.material=e.material.clone(),!this._volumeNode.material)return null;e.parent.add(this._volumeNode);var t=e.position;this._volumeNode.position.setY(t.y+this.getRoomHeight())}return this._volumeObject=this._volumeObject||new ye(this.app,this._volumeNode),this._volumeObject}},{key:"points",get:function(){var e=this.getFloorMesh();return e?e.getPoints():null}},{key:"things",get:function(){var e=this.floor;if(!e)return null;for(var t=[],r=e.things,i=0;i<r.length;i++){var n=r[i];this.getRayCastPosition(n.position)&&t.push(n)}return new Y(this.app,t).buildReturnObject(t)}},{key:"doors",get:function(){for(var e=this.floor.doors,t=[],r=0;r<e.length;r++){var i=e[r],n=G.parseVector3(i.forward),o=G.parseVector3(i.position),a=1;i instanceof De&&(a*=2);var s=new THREE.Vector3;n.multiplyScalar(a),s.addVectors(o,n),(this.getRayCastPosition(s)||(n.multiplyScalar(-a),s.addVectors(o,n),this.getRayCastPosition(s)))&&t.push(i)}return new Y(this.app,t).buildReturnObject(t)}},{key:"floorIndex",get:function(){return console.warn("[Room] Please use '.floor.indexOfParent()' to replace '.floorIndex()'"),this.floor.indexOfParent()}},{key:"center",get:function(){return console.warn("[Room] Please use '.labelPosition' to replace '.center' or if you want to use .boundingBox.center to get center of boundingBox?"),this.labelPosition}},{key:"floorNode",get:function(){return console.warn("[Room] Please use '.plan' to replace '.floorNode'"),this.plan}},{key:"isRoom",get:function(){return console.warn("[Room] Please use 'instanceof THING.Room' to replace '.Room'"),this instanceof THING.Room}}]),t}(ye),vt=function(e){function t(r){I(this,t);var i=N(this,e.call(this,r));return i._textColor="#1e90ff",i._textSize=16,i._textLineWidth=65536,i._textLineHeight=20,i._textType="",i._text="",i._factor=.1,i._mesh=null,i}return D(t,e),t.prototype.setupContext=function(e){e.font=this._textSize.toString(10)+"px "+this._textType,e.fillStyle=this._textColor,e.textAlign="center"},t.prototype.getTextRows=function(e,t,r,i,n){for(var o=t.split(""),a="",s=[],l=0;l<o.length;l++){var c=o[l];("\n"==c||e.measureText(a).width>=n)&&(s.push(a),a=""),a+=c}return s.push(a),s},t.prototype.drawText=function(e,t,r,i){for(var n=0;n<i.length;n++)e.fillText(i[n],t,r+n*this._textLineHeight)},t.prototype.createTextMesh=function(){var e=document.createElement("canvas"),t=this._textSize/72*96*2,r=Math.max(128,Math.roundUpPowerOf2(t));e.width=r,e.height=r;var i=e.getContext("2d");this.setupContext(i);var n=this.getTextRows(i,this._text,e.width/2,e.height/2,this._textLineWidth),r=Math.max(r,Math.roundUpPowerOf2(n.length*t));e.width=r,e.height=r,this.setupContext(i),this.drawText(i,e.width/2,e.height/2,n);var o=new THREE.Texture(e);o.minFilter=THREE.LinearFilter,o.magFilter=THREE.LinearFilter,o.needsUpdate=!0;var a=r*this._factor,s=new THREE.PlaneGeometry(a,a),l=new THREE.MeshBasicMaterial({map:o,transparent:!0,side:THREE.DoubleSide,depthWrite:!1}),c=new THREE.Mesh(s,l);return c.userData.skipOutline=!0,c},t.prototype.refreshTextMesh=function(){this.app.resourceManager.remove(this._mesh),this._mesh=this.createTextMesh(),this.node.add(this._mesh)},t.prototype.customSetup=function(e){this._textColor=e.fontColor||this._textColor,this._textSize=e.fontSize||this._textSize,this._textLineWidth=e.fontLineWidth||this._textLineWidth,this._textLineHeight=e.fontLineHeight||this._textLineHeight,this._textType=e.fontType||this._textType,this._text=e.fontText||e.text||this._text,this._factor=e.factor||this._factor,this.refreshTextMesh(),this.node.userData.skipBoundingBox=!0},k(t,[{key:"text",set:function(e){this._text=e,this.refreshTextMesh()},get:function(){return this._text}},{key:"textColor",set:function(e){this._textColor=e,this.refreshTextMesh()},get:function(){return this._textColor}},{key:"textSize",set:function(e){this._textSize=e,this.refreshTextMesh()},get:function(){return this._textSize}},{key:"textLineWidth",set:function(e){this._textLineWidth=e,this.refreshTextMesh()},get:function(){return this._textLineWidth}},{key:"textLineHeight",set:function(e){this._textLineHeight=e,this.refreshTextMesh()},get:function(){return this._textLineHeight}}]),t}(ye),yt=function(e){function t(r){I(this,t);var i=N(this,e.call(this,r));return i._points=[],i}return D(t,e),t.prototype._updateByPoints=function(){},t.prototype._createPolygonVertices=function(e){for(var t=[],r=0;r<this._points.length;r++)(a=this._points[r].clone()).y=a.z,a.z=0,t.push(a);THREE.ShapeUtils.isClockWise(t)||(t=t.reverse());for(var i=[],n=THREE.ShapeUtils.triangulateShape(t,[]),r=0;r<n.length;r++)i.push(new THREE.Face3(n[r][0],n[r][1],n[r][2]));var o=new THREE.Matrix4;for(this.parent.node.updateMatrixWorld(),o.getInverse(this.parent.node.matrixWorld),r=0;r<t.length;r++){var a=t[r];e||(a.z=a.y,a.y=0),a.applyMatrix4(o)}return{vertices:t,faces:i}},t.prototype._createPolygonGeometry=function(e,t){var r=new THREE.Geometry;r.vertices=e,r.faces=t,r.computeFaceNormals(),r.computeBoundingBox();var i=r.boundingBox.max,n=r.boundingBox.min,o=new THREE.Vector2(0-n.x,0-n.y),a=new THREE.Vector2(i.x-n.x,i.y-n.y),t=r.faces;r.faceVertexUvs[0]=[];for(var s=0;s<t.length;s++){var l=r.vertices[t[s].a],c=r.vertices[t[s].b],u=r.vertices[t[s].c],h=new THREE.Vector2((l.x+o.x)/a.x,(l.y+o.y)/a.y),p=new THREE.Vector2((c.x+o.x)/a.x,(c.y+o.y)/a.y),d=new THREE.Vector2((u.x+o.x)/a.x,(u.y+o.y)/a.y);r.faceVertexUvs[0].push([h,p,d])}return r.uvsNeedUpdate=!0,r},t.prototype.clearPoints=function(){this._points=[],this._updateByPoints()},t.prototype.insertPoint=function(e,t){t=G.parseVector3(t),this._points.splice(e,0,t),this._updateByPoints()},t.prototype.setPoint=function(e,t){return!(e>=this._points.length||!t||(t=G.parseVector3(t),this._points[e]=t,this._updateByPoints(),0))},t.prototype.getPoint=function(e){return e>=this._points.length?null:this._points[e].toArray()},t.prototype.addPoint=function(e){return e=G.parseVector3(e),this._points.push(e),this._updateByPoints(),this._points.length-1},t.prototype.addPoints=function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:le.World,r=0;r<e.length;r++){var i=G.parseVector3(e[r]);t==le.Local?i=G.parseVector3(this.localToWorld(i.toArray())):t==le.Self&&(i=G.parseVector3(this.selfToWorld(i.toArray()))),this._points.push(i)}this._updateByPoints()},t.prototype.removePoint=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;this._points.splice(e,t),this._updateByPoints()},t.prototype.inside=function(e){for(var t=this.planePoints,r=e[0],i=e[1],n=!1,o=0,a=t.length,s=a-1;o<a;s=o,o++){var l=t[o][0],c=t[o][1],u=t[s][0],h=t[s][1];if((l===r&&c===i||u===r&&h===i)&&(n=!n),c<i&&h>=i||c>=i&&h<i){var p=l+(i-c)*(u-l)/(h-c);p===r&&(n=!n),p>r&&(n=!n)}}return!!n},t.prototype.clearPathPoints=function(){console.warn("[PointsBase] Please use '.clearPoints()' to replace 'clearPathPoints()'"),this.clearPoints()},k(t,[{key:"points",get:function(){for(var e=[],t=0;t<this._points.length;t++)e.push(this._points[t].toArray());return e}},{key:"planePoints",get:function(){for(var e=[],t=0;t<this._points.length;t++){var r=this._points[t];e.push([r.x,r.z])}return e}},{key:"area",get:function(){for(var e=[],t=0;t<this._points.length;t++){var r=this._points[t];e.push(new THREE.Vector2(r.x,r.z))}var i=THREE.ShapeUtils.area(e);return Math.abs(i)}},{key:"centerPos",get:function(){return new polylabel([this.planePoints])}},{key:"avgHeight",get:function(){if(!this._points.length)return 0;for(var e=0,t=0;t<this._points.length;t++)e+=this._points[t].y;return e/this._points.length}}]),t}(ye),Et=function(e){function t(r){I(this,t);var i=N(this,e.call(this,r));return i._lineColor="#00BFFF",i._regionColor="#708090",i._lineMesh=null,i._areaMesh=null,i._textRegion=null,i}return D(t,e),t.prototype._updateTextPosition=function(){if(this._textRegion){var e=this.centerPos;this.avgHeight,this._textRegion.position=e}},t.prototype._updateByPoints=function(){if(!(this._points.length<3)){var e=new THREE.MeshBasicMaterial({color:this._regionColor,opacity:.5,transparent:!0,side:THREE.DoubleSide,depthWrite:!1}),t=this._createPolygonVertices(),r=this._createPolygonGeometry(t.vertices,t.faces);this.app.resourceManager.remove(this._areaMesh),this._areaMesh=new THREE.Mesh(r,e),this.node.add(this._areaMesh);var i=new THREE.LineBasicMaterial({color:this._lineColor});this.app.resourceManager.remove(this._lineMesh),(r=new THREE.Geometry).vertices=t.vertices,r.vertices.push(t.vertices[0]),this._lineMesh=new THREE.Line(r,i),this._lineMesh.userData.skipPick=!0,this.node.add(this._lineMesh)}},t.prototype.customSetup=function(t){e.prototype.customSetup.call(this,t),this._lineColor=t.lineColor||this._lineColor,this._regionColor=t.regionColor||this._regionColor;var r=t.points||t.vertices;if(r&&this.addPoints(r),t.fontText||t.text){var i=G.cloneObject(t);i.type="TextRegion",i.parent=this,this._textRegion=this.app.create(i),this._textRegion._mesh.renderOrder=1,this._textRegion.angleX=-90,this._textRegion.translateY(.1),this._updateTextPosition()}},k(t,[{key:"textRegion",get:function(){return this._textRegion}}]),t}(yt),bt=function(e){function t(r){I(this,t);var i=N(this,e.call(this,r));return i.node=new THREE.Group,i.areaMesh=null,i.vertices=[],i.pointColor="#1E90FF",i.lineColor="#00BFFF",i.regionColor="#708090",i.fontColor="#1e90ff",i.fontSize="16",i.text="",i.areaInfo="0",i.alpha="0.5",i.savedOptions={},i.lineSpacing=25,i.pointMat=new THREE.MeshBasicMaterial({color:i.pointColor}),i.lineMat=new THREE.LineBasicMaterial({color:i.lineColor,depthTest:!1}),i.regionMat=new THREE.MeshBasicMaterial({color:i.regionColor,opacity:i.alpha,transparent:!0,side:THREE.DoubleSide,depthTest:!1}),i.curLine=null,i.bFirstBuild=!0,i.triangles=[],i}return D(t,e),t.prototype.setup=function(t){e.prototype.setup.call(this,t),this.bFirstBuild=!0,this.build(t)},t.prototype.parseOptions=function(e){if(e=e||{},this.vertices=e.vertices||[],this.pointColor=e.pointColor||"#1E90FF",this.lineColor=e.lineColor||"#b4f5f8",this.regionColor=e.regionColor||"#0aa5ff",this.alpha=e.alpha||"0.5",this.fontSize=e.fontSize||"26",this.areaInfo=e.areaInfo||"0",this.fontInfo=e.fontInfo||e.text||"",this.fontColor=e.fontColor||"#b4f5f8",this.lineSpacing=e.lineSpacing||25,this.parent)for(var t=0;t<this.vertices.length;t++)this.vertices[t]=this.parent.worldToLocal(this.vertices[t])},t.prototype.reBuild=function(e){for(this.parseOptions(e),r=0;r<this.vertices.length;r++){var t=this.vertices[r];t=new THREE.Vector3(t.x,t.y,t.z),this.vertices[r]=t}for(var r=0;r<this.vertices.length;r++)this.node.add(this.drawPointByNode(this.vertices[r]));if(this.vertices.length>1&&this.node.add(new THREE.Line(this.setGeometry(this.vertices),new THREE.LineBasicMaterial({color:this.lineColor,depthTest:!1}))),this.vertices.length>2){var i=this.setGeometry(this.vertices);i.vertices=this.vertices;var n=drawRegion.setFaces(this.vertices);i.faces=n;var o=new THREE.Mesh(i,new THREE.MeshBasicMaterial({color:this.regionColor,opacity:this.alpha,transparent:!0,side:THREE.DoubleSide,depthTest:!1}));this.node.add(o)}},t.prototype.addPoint=function(e){for(this.bFirstBuild=!1,this.node.children=[],new THREE.Vector2(e.x,e.z),this.vertices.push(e),i=0;i<this.vertices.length;i++)this.node.add(this.drawPointByNode(this.vertices[i]));if(this.vertices.length>1&&this.node.add(new THREE.Line(this.setGeometry(this.vertices),new THREE.LineBasicMaterial({color:this.lineColor,depthTest:!1}))),this.vertices.length>2){var t=this.setGeometry(this.vertices);t.vertices=this.vertices,this.triangles=[],o(this.vertices,this.triangles);for(var r=[],i=0;i<this.triangles.length;i++){var n=this.triangles[i];r.push(new THREE.Face3(n.v1.id,n.v2.id,n.v3.id))}t.faces=r;var a=new THREE.Mesh(t,new THREE.MeshBasicMaterial({color:this.regionColor,opacity:this.alpha,transparent:!0,side:THREE.DoubleSide,depthTest:!1}));this.node.add(a)}},t.prototype.drawPointByBO=function(e){var t=this.app.create({type:"Box",width:3,height:3,depth:3,style:{color:this.pointColor,opacity:.75}});return t.position=[e.x,e.y,e.z],t},t.prototype.drawPointByNode=function(e){var t=new THREE.BoxGeometry(3,3,3),r=new THREE.Mesh(t,this.pointMat);return r.position.copy(e),r},t.prototype.build=function(e){if(this.parseOptions(e),!(this.vertices.length<3)){for(this.node.children=[],a=0;a<this.vertices.length;a++)if(!this.vertices[a].hasOwnProperty("x")){var t=this.vertices[a];t=new THREE.Vector3(t[0],t[1],t[2]),this.vertices[a]=t}var r=new THREE.Line(this.setGeometry(this.vertices),new THREE.LineBasicMaterial({color:this.lineColor,depthTest:!1}));this.node.add(r);var i=this.setGeometry(this.vertices);i.vertices=this.vertices,this.triangles=[],o(this.vertices,this.triangles);for(var n=[],a=0;a<this.triangles.length;a++){var s=this.triangles[a];n.push(new THREE.Face3(s.v1.id,s.v2.id,s.v3.id))}i.faces=n;var l=new THREE.Mesh(i,new THREE.MeshBasicMaterial({color:this.regionColor,opacity:this.alpha,transparent:!0,side:THREE.DoubleSide,depthTest:!1}));this.node.add(l),this.node.add(this.createAreaMesh()),this.bFirstBuild&&(this.savedOptions={vertices:this.vertices,pointColor:this.pointColor,lineColor:this.lineColor,regionColor:this.regionColor,fontColor:this.fontColor,areaInfo:this.areaInfo,fontSize:this.fontSize,fontInfo:this.fontInfo},this.bFirstBuild=!1);var c=new THREE.Geometry;c.vertices=[this.vertices[this.vertices.length-1],this.vertices[0]];var u=new THREE.Line(c,new THREE.LineBasicMaterial({color:this.lineColor,depthTest:!1}));this.node.add(u),this.setRegionPos()}},t.prototype.endBuild=function(){var e={vertices:this.vertices};this.bFirstBuild=!0,this.build(e),this.addEventForThis()},t.prototype.addEventForThis=function(){this.app.trigger("createPolygonRegion",{obj:this})},t.prototype.addCallbackForMotion=function(){this.app.trigger("addPoint",{obj:this})},t.prototype.setRegionPos=function(){if(this.vertices.length>2){var e=new THREE.Vector3(this.centerPos[0],this.vertices[0].y,this.centerPos[1]);this.node.position.copy(e);for(var t=0;t<this.node.children.length;t++)this.node.children[t].position.sub(e)}},t.prototype.resetSetting=function(){this.build(this.savedOptions)},t.prototype.resetRegion=function(){this.build(this.savedOptions)},t.prototype.setGeometry=function(e){var t=new THREE.Geometry;return t.vertices=e,t},t.prototype.addCurLine=function(e,t){if(this.curLine&&this.node.remove(this.curLine),this.vertices.length>0){var r=new THREE.LineBasicMaterial({color:t,depthTest:!1});this.curLine=new THREE.Line(this.setGeometry(e),r)}this.node.add(this.curLine)},t.prototype.createAreaMesh=function(){var e=document.createElement("canvas"),t=e.getContext("2d");t.font=this.fontSize+"px ",t.fillStyle=this.fontColor,t.textAlign="center";var r=" : "+Math.ceil(this.area)+"m",i=1==this.areaInfo?r+this.fontInfo:this.fontInfo,n=t.measureText(r).width;this.drawText(t,i,e.width/2,e.height/2,this.lineSpacing,n);var o=new THREE.Texture(e);o.minFilter=THREE.LinearFilter,o.magFilter=THREE.LinearFilter,o.generateMipmaps=!1,o.needsUpdate=!0;var a=new THREE.MeshBasicMaterial({map:o,side:THREE.DoubleSide,depthTest:!1,transparent:!0}),s=Math.ceil(this.area)/80>100?100:Math.ceil(this.area)/80;s<20&&(s=20);var l=new THREE.Mesh(new THREE.PlaneGeometry(s,s/(e.width/e.height)),a);return l.position.copy(new THREE.Vector3(this.centerPos[0],.15,this.centerPos[1])),l.rotateX(-Math.PI/2),l.position.y=this.vertices[0].y+.2,l.userData.skipOutline=!0,this.areaMesh=l,l},t.prototype.drawText=function(e,t,r,i,n,o){var a,s,l,c,u=null!==r&&null!==i,h=(t=t.replace(/(\r\n|\n\r|\r|\n)/g,"\n")).split("\n"),p=0,d=0,f=0,m=function(t){u&&e.fillText(t,r,i+n*p),p++,(l=e.measureText(t).width)>f&&(f=l)};for(a=0;a<h.length;a++){c=h[a].split(" ");for(var g=1;c.length>0&&g<=c.length;)s=c.slice(0,g).join(" "),(l=e.measureText(s).width)>o?(1===g?(s=c.slice(0,1).join(" "),c=c.splice(1)):(s=c.slice(0,g-1).join(" "),c=c.splice(g-1)),m(s),g=1):g++;g>0&&m(c.join(" "))}if(d=n*p,!u)return{height:d,width:f}},t.prototype.toJSON=function(){for(var e={vertices:this.vertices,lineColor:this.lineColor,fontSize:this.fontSize,regionColor:this.regionColor,fontInfo:this.fontInfo,fontColor:this.fontColor,areaInfo:this.areaInfo},t=[],r=0;r<this.vertices.length;r++){var i=this.vertices[r];t.push([i.x,i.y,i.z])}return JSON.stringify(e)},t.prototype.loadJSON=function(e){if(""!=e){var t=JSON.parse(e);t.vertices=function(e){for(var t=[],r=0;r<e.length;r++)t.push([e[r].x,e[r].y,e[r].z]);return t}(t.vertices),this.bFirstBuild=!0,this.build(t)}},k(t,[{key:"isPolygonRegion",get:function(){return!0}},{key:"area",get:function(){var e=THREE.ShapeUtils.area(this.points_2d);return Math.abs(e)}},{key:"centerPos",get:function(){for(var e=[],t=[],r=0;r<this.points_2d.length;r++)t.push([this.points_2d[r].x,this.points_2d[r].y]);return e.push(t),new polylabel(e)}},{key:"points_2d",get:function(){for(var e=[],t=this.vertices,r=0;r<t.length;r++)t[r].hasOwnProperty("x")?t[r].hasOwnProperty("z")?e.push(new THREE.Vector2(t[r].x,t[r].z)):e.push(new THREE.Vector2(t[r].x,t[r].y)):2==t[r].length?e.push(new THREE.Vector2(t[r][0],t[r][1])):3==t[r].length?e.push(new THREE.Vector2(t[r][0],t[r][2])):console.error("points ");return e}}]),t}(ye),xt=.88*Math.PI,_t=1,wt=2,Tt=3,Mt=4,Rt=null,St=function(e){function t(r){I(this,t);var i=N(this,e.call(this,r));return i.node=new THREE.Group,i._map=null,i._tex=null,i._params={},i}return D(t,e),t.prototype.setup=function(t){e.prototype.setup.call(this,t),null==this._parent&&(this._parent=this.app.outdoors),this.node&&null==this.node.parent&&this.parent.node.add(this.node),this._map=(Rt||(Rt=new SimpleHeatmap),Rt);var r=void 0!==t.opacity?t.opacity:1,i=this._tex=new THREE.Texture(this._map.canvas()),n=this._material=new THREE.MeshBasicMaterial({map:i,side:THREE.DoubleSide,transparent:!0,opacity:r}),o=new THREE.PlaneGeometry(t.width||10,t.height||10),a=new THREE.Mesh(o,n);this.node.add(a),this._initParameter(t),this._refresh()},t.prototype._initParameter=function(e){var t=this._params;t.areaWidth=e.width||10,t.areaHeight=e.height||10,t.mapSize=e.mapSize||256,t.alpha=!!e.alpha,t.gradient=e.gradient||{.4:"blue",.6:"cyan",.7:"lime",.8:"yellow",1:"red"},t.minValue=e.minValue||10,t.maxValue=e.maxValue||50,t.radius=e.radius||.8,t.blur=e.blur||.8,t.data=e.data||[]},t.prototype.setParameter=function(e){var t=this._params;t.areaWidth=e.width||t.areaWidth,t.areaHeight=e.height||t.areaHeight,t.mapSize=e.mapSize||t.mapSize,t.alpha=void 0!==e.alpha?e.alpha:t.alpha,t.gradient=e.gradient||t.gradient,t.minValue=e.minValue||t.minValue,t.maxValue=e.maxValue||t.maxValue,t.radius=e.radius||t.radius,t.blur=e.blur||t.blur,t.data=e.data||t.data,this._refresh()},t.prototype.addData=function(e){this._params.data.push(e),this._refresh()},t.prototype.setData=function(e){this._params.data=e,this._refresh()},t.prototype.setAlpha=function(e){this._params.alpha=e,this._refresh()},t.prototype.setRadius=function(e,t){this._params.radius=e,void 0!==t&&(this._params.blur=t),this._refresh()},t.prototype.setGradient=function(e){this._params.gradient=e,this._refresh()},t.prototype.randomData=function(){for(var e=this._params,t=[],r=0;r<Math.round(e.areaWidth*e.areaHeight);r++)t.push([(Math.random()-.5)*e.areaWidth,(Math.random()-.5)*e.areaHeight,Math.pow(Math.random(),3)*(e.maxValue-e.minValue)+e.minValue]);this.setData(t)},t.prototype._refresh=function(){var e=this._params,t=1,r=1,i=e.mapSize/e.areaWidth;e.areaWidth!=e.areaHeight&&(e.areaWidth>e.areaHeight?(t=1,r=e.areaHeight/e.areaWidth):(t=e.areaWidth/e.areaHeight,r=1,i=e.mapSize/e.areaHeight)),this._map.setCanvasSize(Math.floor(e.mapSize*t),Math.floor(e.mapSize*r)).setAreaSize(e.areaWidth,e.areaHeight).min(e.minValue).max(e.maxValue).alpha(e.alpha).gradient(e.gradient).radius(Math.floor(e.radius*i),Math.floor(e.blur*i)).data(e.data).draw(),this._tex.needsUpdate=!0,this.app.renderer.setTexture2D(this._tex,0)},k(t,[{key:"isHeatmap",get:function(){return console.warn("[Heatmap] Please use 'instanceof THING.Heatmap' to replace '.isHeatmap'"),this instanceof THING.Heatmap}}]),t}(ye),Pt=function(e){function t(r){return I(this,t),N(this,e.call(this,r))}return D(t,e),k(t,[{key:"image",set:function(e){if(this._image=e,e)if(e.isTexture)this._image=e.name,this.obj.synPathTexture(e);else{this._image=this.obj.app.confirmURL(e);var t=(new THREE.TextureLoader).load(this._image,function(e){e.wrapS=e.wrapT=THREE.RepeatWrapping,e.anisotropy=16});this.obj.synPathTexture(t)}},get:function(){return this._image}}]),t}(W),At=function(e){function t(r){I(this,t);var i=N(this,e.call(this,r));return i._style=new Pt(i),i.pathTexture=null,i.pathWidth=1,i.pathCornerRadius=.3,i.pathCornerSplit=10,i.pathScrollUV=!1,i.pathScrollSpeed=10,i.pathPlayingTween=null,i.pathUp=new THREE.Vector3(0,1,0),i.pathPointList=null,i.pathGeometry=null,i.pathLine=null,i}return D(t,e),t.prototype.synPathTexture=function(e){this.pathTexture=e,this.pathLine&&(this.pathLine.material.map=this.pathTexture,this.pathLine.material.needsUpdate=!0)},t.prototype._setupPoints=function(e){var t=e.points;if(t){var r=e.spaceType,i=e.local;!r&&i&&(r=SpaceType.Local),this.addPoints(t,r)}},t.prototype._setupPathLine=function(e){this.scrollUV=G.parseValue(e.scrollUV,!1),this.uvRatio=e.uvRatio||1,this.width=G.parseValue(e.width,this.width);var t=new THREE.MeshBasicMaterial({depthWrite:!0,transparent:!0,side:THREE.DoubleSide});this.pathLine=new THREE.Mesh(this.pathGeometry,t),this.pathLine.drawMode=THREE.TriangleStripDrawMode;var r=e.image;r&&(this.style.image=r)},t.prototype._addPathLine=function(){this.node.add(this.pathLine)},t.prototype.customSetup=function(e){this._setupPathLine(e),this._setupPoints(e),this._addPathLine()},t.prototype._updateByPoints=function(){this.node.updateMatrixWorld();for(var e=[],t=0;t<this._points.length;t++){var r=this._points[t].clone();e.push(this.node.parent.worldToLocal(r))}this.pathPointList.set(e,this.pathCornerRadius,this.pathCornerSplit,this.pathUp)},t.prototype.updatePath=function(){if(this.pathScrollUV&&this.pathTexture){var e=this.scrollSpeed/1e3;return this.pathTexture.offset.x-=e,!0}return!1},t.prototype.update=function(t){var r=e.prototype.update.call(this,t);return r|=this.updatePath()},t.prototype.play=function(e){var t=(e=e||{}).time||1e3,r=e.lerpType||ae.Linear.None,i=e.complete,n=this;this.pathPlayingTween=new TWEEN.Tween({progress:0}).to({progress:1},t).easing(r).onUpdate(function(){n.pathGeometry.update(n.pathPointList,{width:n.pathWidth,progress:this._object.progress})}).onComplete(function(){i&&i.call(n)}).start()},t.prototype.stop=function(){this.pathPlayingTween&&(this.pathPlayingTween.stop(),this.pathPlayingTween=null)},t.prototype.toJSON=function(){var t=e.prototype.toJSON.call(this);return t.image=this.image,t.scrollUV=this.scrollUV,t.points=this.points,t},k(t,[{key:"uvRatio",set:function(e){this.pathTexture&&(this.pathTexture.repeat.x=1/e)}},{key:"useTexture",set:function(e){var t=this.pathLine.material;t.map=e?this.pathTexture:null,t.needsUpdate=!0},get:function(){return null!==this.pathLine.material.map}},{key:"width",set:function(e){this.pathWidth=e,this._updateByPoints()},get:function(){return this.pathWidth}},{key:"scrollUV",set:function(e){this.pathScrollUV=e,this.tickable=!0},get:function(){return this.pathScrollUV}},{key:"scrollSpeed",set:function(e){this.pathScrollSpeed=Math.clamp(e,-99,99)},get:function(){return this.pathScrollSpeed}},{key:"cornerRadius",set:function(e){this.pathCornerRadius=e,this._updateByPoints()},get:function(){return this.pathCornerRadius}},{key:"cornerSplit",set:function(e){this.pathCornerSplit=e,this._updateByPoints()},get:function(){return this.pathCornerSplit}}]),t}(yt),Ct=function(){function e(t){I(this,e),this.app=t,this._points=[]}return e.prototype.set=function(e,t,r,i){this._points=e},k(e,[{key:"vertices",get:function(){for(var e=[],t=0;t<this._points.length;t++)e.push(G.parseVector3(this._points[t]));return e}}]),e}(),Lt=(function(e){function t(r){return I(this,t),N(this,e.call(this,r))}D(t,e),k(t,[{key:"lineMaterial",get:function(){return this.obj.pathLine.material}},{key:"lineColor",set:function(e){this.lineMaterial.color=G.parseColor(e)},get:function(){return this.lineMaterial.color.toHexString()}},{key:"lineOpacity",set:function(e){this.lineMaterial.opacity=e},get:function(){return this.lineMaterial.opacity}},{key:"lineDashSize",set:function(e){this.lineMaterial.lineDashSize=e},get:function(){return this.lineMaterial.lineDashSize}},{key:"lineGapSize",set:function(e){this.lineMaterial.lineGapSize=e},get:function(){return this.lineMaterial.lineGapSize}},{key:"lineWidth",set:function(e){this.lineMaterial.lineWidth=e},get:function(){return this.lineMaterial.lineWidth}}])}(W),function(e){function t(r){I(this,t);var i=N(this,e.call(this,r));return i.dotNode=null,i.pathGeometry=new THREE.BufferGeometry,i.pathGeometry.update=function(e,t){},i.dotGeometry=null,i.dotMaterial=null,i.pathPointList=new Ct,i}return D(t,e),t.prototype._updateByPoints=function(){e.prototype._updateByPoints.call(this);var t=this.pathPointList.vertices;t.length&&(this.pathGeometry.setFromPoints(t),this.pathLine.computeLineDistances(),this.dotGeometry&&this.dotGeometry.setFromPoints(t))},t.prototype._setupPathLine=function(e){var t,r=e.lineOpacity||1,i=e.lineDashSize||0,n=e.lineGapSize||0,o=e.lineWidth||1,a=e.color||255,s=this.pathPointList.vertices;t=i||n?new THREE.LineDashedMaterial({color:a,opacity:r,dashSize:i,gapSize:n,linewidth:o,transparent:!0}):new THREE.LineBasicMaterial({color:a,opacity:r,linewidth:o,transparent:!0}),this.pathGeometry.setFromPoints(s),this.pathLine=new THREE.Line(this.pathGeometry,t),this.pathLine.computeLineDistances();var l=e.dotColor||16777215,c=e.dotSize||1;c&&(this.dotGeometry=(new THREE.BufferGeometry).setFromPoints(s),this.dotMaterial=new THREE.PointsMaterial({color:l,size:c,sizeAttenuation:!1}),this.dotNode=new THREE.Points(this.dotGeometry,this.dotMaterial),this.node.add(this.dotNode))},t.prototype.showLines=function(e){this.pathLine.visible=e},t.prototype.showPoints=function(e){this.dotNode.visible=e},k(t,[{key:"isLine",get:function(){return console.warn("[Line] Please use 'instanceof THING.Line' to replace '.isLine'"),this instanceof THING.Line}}]),t}(At)),Ot=function(e){function t(r){I(this,t);var i=N(this,e.call(this,r));return i.arrowFlag=!0,i.pathGeometry=new THREE.PathGeometry,i.pathPointList=new THREE.PathPointList,i}return D(t,e),t.prototype._updateByPoints=function(){e.prototype._updateByPoints.call(this),this.pathGeometry.update(this.pathPointList,{width:this.pathWidth,arrow:this.arrowFlag}),this.pathGeometry.computeBoundingSphere()},t.prototype.setup=function(t){this.arrowFlag=G.parseValue(t.arrowFlag,!0),e.prototype.setup.call(this,t)},k(t,[{key:"progress",set:function(e){this.pathGeometry.update(this.pathPointList,{width:this.pathWidth,arrow:this.arrowFlag,progress:math.clamp(e,0,1)})}},{key:"isRouteLine",get:function(){return console.warn("[RouteLine] Please use 'instanceof THING.RouteLine' to replace '.RouteLine'"),this instanceof THING.RouteLine}}]),t}(At),Ht=function(e){function t(r){I(this,t);var i=N(this,e.call(this,r));return i.pathWidth=.2,i.pathRadialSegments=8,i.pathGeometry=new THREE.PathTubeGeometry,i.pathPointList=new THREE.PathPointList,i.pathUp=void 0,i}return D(t,e),t.prototype._updateByPoints=function(){e.prototype._updateByPoints.call(this),this.pathGeometry.update(this.pathPointList,{radius:this.pathWidth,radialSegments:this.pathRadialSegments}),this.pathGeometry.computeBoundingSphere()},t.prototype.setup=function(t){this.pathGeometry=new THREE.PathTubeGeometry,e.prototype.setup.call(this,t)},k(t,[{key:"progress",set:function(e){this.pathGeometry.update(this.pathPointList,{radius:this.pathWidth,radialSegments:this.pathRadialSegments,progress:math.clamp(e,0,1)})}},{key:"isPolygonLine",get:function(){return console.warn("[PolygonLine] Please use 'instanceof THING.PolygonLine' to replace '.PolygonLine'"),this instanceof THING.PolygonLine}}]),t}(At),Ft=function e(){I(this,e),this.strId="",this.fPPAfterImageValue=0,this.listGroups=new Array;var t=new It;this.listGroups[0]=t,this._attr="ParticleData"};Ft.prototype={getAttr:function(){return this._attr}};var It=function e(){I(this,e),this.strId="",this.texture=new Dt,this.fFixedTimeStep=.33,this.strUseMesh="false",this.strMeshUrl="BuildIn/Box",this.arrayMeshParams=new Array,this.arrayMeshParams.push(1),this.arrayMeshParams.push(1),this.arrayMeshParams.push(1),this.arrayMeshParams.push(1),this.arrayMeshParams.push(1),this.arrayMeshParams.push(1),this.strHasPerspective="true",this.strIsColorize="true",this.iBlendingMode=1,this.strIsTransparent="true",this.fAlphaTest=0,this.strIsDepthWrite="false",this.strIsDepthTest="false",this.strIsFog="false",this.strEnableTrail="false",this.textureTrail=new Dt,this.fTrailLife=.5,this.fTrailWidthStart=1,this.fTrailWidthEnd=1,this.fScale=window.innerHeight/2,this.iMaxParticleCount=500,this.vec4Quaternion=new THREE.Vector4(0,0,0,1),this.listEmitters=new Array;var t=new kt;this.listEmitters[0]=t},kt=function e(){I(this,e),this.strId="",this.iDistribution=1,this.iParticleCount=100,this.fDuration=-1,this.strIsStatic="false",this.strIsLookAtCamera="false",this.strIsLookAtCameraOnlyY="false",this.fActiveMultiplier=1,this.iDirection=1,this.maxAge=new Nt,this.position=new jt,this.velocity=new Ut,this.acceleration=new Bt,this.drag=new Vt,this.wiggle=new zt,this.rotation=new Gt,this.trail=new qt,this.listColor=new Array;var t=new Wt;this.listColor[0]=t,this.listOpacity=new Array;var r=new Xt;this.listOpacity[0]=r,this.listSize=new Array;var i=new Yt;this.listSize[0]=i,this.listAngle=new Array;var n=new Qt;this.listAngle[0]=n},Dt=function e(){I(this,e),this.name="32x32_star.png",this.url="http://static.3dmomoda.com/textures/18092617nyspq5moaka1i2fhvs1hh66s.png",this.vec2Frames=new THREE.Vector2(1,1),this.iFrameCount=1,this.iLoop=1},Nt=function e(){I(this,e),this.fValue=1,this.fSpread=1},jt=function e(){I(this,e),this.vec3Value=new THREE.Vector3(0,0,0),this.vec3Spread=new THREE.Vector3(0,0,0),this.vec3SpreadClamp=new THREE.Vector3(0,0,0),this.fRadius=0,this.vec3RadiusScale=new THREE.Vector3(1,1,1),this.iDistribution=1,this.strIsRandomise="false"},Ut=function e(){I(this,e),this.vec3Value=new THREE.Vector3(0,10,0),this.vec3Spread=new THREE.Vector3(10,0,10),this.iDistribution=1,this.strIsRandomise="false"},Bt=function e(){I(this,e),this.vec3Value=new THREE.Vector3(0,0,0),this.vec3Spread=new THREE.Vector3(0,0,0),this.iDistribution=1,this.strIsRandomise="false"},Vt=function e(){I(this,e),this.fValue=0,this.fSpread=0,this.strIsRandomise="false"},zt=function e(){I(this,e),this.fValue=0,this.fSpread=0},qt=function e(){I(this,e),this.fValue=0,this.fSpread=0,this.fStep=0,this.fStepSpread=0},Gt=function e(){I(this,e),this.vec3Axis=new THREE.Vector3(0,0,0),this.vec3AxisSpread=new THREE.Vector3(0,0,0),this.fAngle=0,this.fAngleSpread=0,this.strIsStatic="false",this.vec3Center=new THREE.Vector3(0,0,0),this.strIsRandomise="false"},Wt=function e(){I(this,e),this.vec3Value=new THREE.Vector3(1,1,1),this.vec3Spread=new THREE.Vector3(0,0,0),this.strIsRandomise="false"},Xt=function e(){I(this,e),this.fValue=1,this.fSpread=0,this.strIsRandomise="false"},Yt=function e(){I(this,e),this.fValue=1,this.fSpread=0,this.strIsRandomise="false"},Qt=function e(){I(this,e),this.fValue=0,this.fSpread=0,this.strIsRandomise="false"},Jt=function(){function e(t,r,i){I(this,e),this._options=t,this._emitter=r,this._particleGroup=i,this._emitter||this.refresh()}return e.prototype.cloneOptions=function(){return G.cloneObject(this._options,!1,null,function(e,t){if(G.isFunction(e.clone))return e.clone()})},e.prototype.refresh=function(){this._emitter&&(this._particleGroup._group.removeEmitter(this._emitter),this._emitter=null);var e=this.cloneOptions();this._particleGroup._options.useMesh?this._emitter=new MSPE.Emitter(e):this._emitter=new SPE.Emitter(e),this._particleGroup._group.addEmitter(this._emitter)},k(e,[{key:"options",set:function(e){e&&(G.mergeObject(this._options,e,!0),this.refresh())},get:function(){return this._options}}]),e}(),Kt=function(){function e(t,r,i){I(this,e),this._options=t,this._group=r,this._particleSystem=i,this._emitters=[],this._group||this.refresh()}return e.prototype.cloneOptions=function(){var e=G.cloneObject(this._options,!1,function(e){return"texture"!=e&&"bufferGeometry"!=e},function(e,t){if(G.isFunction(e.clone))return e.clone()}),t=this._options.vec4Quaternion;return t&&(e.vec4Quaternion=t.clone()),e},e.prototype.refresh=function(){for(-1===this._particleSystem._groups.indexOf(this)&&this._particleSystem._groups.push(this),this._group&&this._group.mesh&&this._particleSystem.node.remove(this._group.mesh),r=0;r<this._emitters.length;r++){var e=this._emitters[r];this._group.removeEmitter(e._emitter)}var t=this.cloneOptions();t.useMesh?this._group=new MSPE.Group(t):this._group=new SPE.Group(t);for(var r=0;r<this._emitters.length;r++){var i=this._emitters[r],n=i.cloneOptions();t.useMesh?i._emitter=new MSPE.Emitter(n):i._emitter=new SPE.Emitter(n),this._group.addEmitter(i._emitter)}this._group.mesh&&this._particleSystem.node.add(this._group.mesh)},e.prototype.tick=function(e,t){this._group.tick(e,t)},e.prototype.addEmitter=function(e){return new Jt(e,null,this)},e.prototype.removeEmitter=function(e){for(var t=0;t<this._emitters.length;t++)if(e==this._emitters[t]){this._emitters.splice(t,1),this._group.removeEmitter(e._emitter);break}},k(e,[{key:"options",set:function(e){e&&(G.mergeObject(this._options,e,!0),this.refresh())},get:function(){return this._options}}]),e}(),Zt=function(e){function t(r){I(this,t);var i=N(this,e.call(this,r));return i._groups=[],i}return D(t,e),t.prototype.loadFromURL=function(e,t){var r=this;e.node||(e.node=new THREE.Group),e.attachToParent=!0;var i=e.url,n=this.app.particleResource.get(i);n?this.loadComplete(n,e,t):this.app.particleResource.download(i,function(i){r.loadComplete(i,e,t)})},t.prototype.loadComplete=function(e,t,r){this.setupParticleData(e,t),this.setupUserData(),null!=r&&r()},t.prototype.customSetup=function(e){this.tickable=!0},t.prototype.update=function(e){for(var t=0;t<this._groups.length;t++)this._groups[t].tick(e,this.app.renderCamera);return!0},t.prototype.parseEmitterOptions=function(e,t){var r=new THREE.Vector3(e.position.vec3Value.x,e.position.vec3Value.y,e.position.vec3Value.z),i=new THREE.Vector3(e.position.vec3Spread.x,e.position.vec3Spread.y,e.position.vec3Spread.z),n=new THREE.Vector3(e.position.vec3SpreadClamp.x,e.position.vec3SpreadClamp.y,e.position.vec3SpreadClamp.z),o=!1;o="true"==e.position.strIsRandomise.valueOf();var a=new THREE.Vector3(e.velocity.vec3Value.x,e.velocity.vec3Value.y,e.velocity.vec3Value.z),s=new THREE.Vector3(e.velocity.vec3Spread.x,e.velocity.vec3Spread.y,e.velocity.vec3Spread.z);e.velocity.strIsRandomise.valueOf();var l=new THREE.Vector3(e.acceleration.vec3Value.x,e.acceleration.vec3Value.y,e.acceleration.vec3Value.z),c=new THREE.Vector3(e.acceleration.vec3Spread.x,e.acceleration.vec3Spread.y,e.acceleration.vec3Spread.z),u=!1;u="true"==e.acceleration.strIsRandomise.valueOf();var h=!1;h="true"==e.strIsStatic.valueOf();var p=new THREE.Vector3(e.rotation.vec3Axis.x,e.rotation.vec3Axis.y,e.rotation.vec3Axis.z),d=new THREE.Vector3(e.rotation.vec3AxisSpread.x,e.rotation.vec3AxisSpread.y,e.rotation.vec3AxisSpread.z),f=new THREE.Vector3(e.rotation.vec3Center.x,e.rotation.vec3Center.y,e.rotation.vec3Center.z),m=!1;m="true"==e.rotation.strIsStatic.valueOf();var g=!1;g="true"==e.rotation.strIsRandomise.valueOf();var v=new Array,y=new Array,E=new Array;if(e.listColor.length>0)for(var b=0,x=e.listColor.length;b<x;b++)v.push(new THREE.Color(e.listColor[b].vec3Value.x,e.listColor[b].vec3Value.y,e.listColor[b].vec3Value.z)),y.push(new THREE.Vector3(e.listColor[b].vec3Spread.x,e.listColor[b].vec3Spread.y,e.listColor[b].vec3Spread.z)),"true"==e.listColor[b].strIsRandomise.valueOf()?E.push(!0):E.push(!1);else v.push(new THREE.Color("white")),y.push(new THREE.Vector3(0,0,0)),E.push(!1);var _=new Array,w=new Array,T=new Array;if(e.listOpacity.length>0)for(var b=0,x=e.listOpacity.length;b<x;b++)_.push(e.listOpacity[b].fValue),w.push(e.listOpacity[b].fSpread),"true"==e.listOpacity[b].strIsRandomise.valueOf()?T.push(!0):T.push(!1);else _.push(1),w.push(0),T.push(!1);var M=new Array,R=new Array,S=new Array;if(e.listSize.length>0)for(var b=0,x=e.listSize.length;b<x;b++)M.push(e.listSize[b].fValue),R.push(e.listSize[b].fSpread),"true"==e.listSize[b].strIsRandomise.valueOf()?S.push(!0):S.push(!1);else M.push(1),R.push(0),S.push(!1);var P=new Array,A=new Array,C=new Array;if(e.listAngle.length>0)for(var b=0,x=e.listAngle.length;b<x;b++)P.push(e.listAngle[b].fValue),A.push(e.listAngle[b].fSpread),"true"==e.listAngle[b].strIsRandomise.valueOf()?S.push(!0):C.push(!1);else P.push(0),A.push(0),C.push(!1);return{type:e.iDistribution,particleCount:e.iParticleCount,duration:e.fDuration<=0?void 0:e.fDuration,isStatic:h,isLookAtCamera:"true"==e.strIsLookAtCamera,isLookAtCameraOnlyY:"true"==e.strIsLookAtCameraOnlyY,activeMultiplier:e.fActiveMultiplier,direction:e.iDirection,trail:{value:e.trail.fValue,spread:e.trail.fSpread,step:e.trail.fStep,stepSpread:e.trail.fStepSpread},maxAge:{value:e.maxAge.fValue,spread:e.maxAge.fSpread},position:{value:r,spread:i,spreadClamp:n,radius:e.position.fRadius,radiusScale:new THREE.Vector3(1,1,1),randomise:o},radius:{value:5,spread:0,scale:new THREE.Vector3(1,1,1),spreadClamp:new THREE.Vector3(2,2,2)},velocity:{value:a,spread:s,randomise:!1},acceleration:{value:l,spread:c,randomise:u},drag:{value:e.drag.fValue,spread:e.drag.fSpread},wiggle:{value:e.wiggle.fValue,spread:e.wiggle.fSpread},rotation:{axis:p,axisSpread:d,angle:e.rotation.fAngle,angleSpread:e.rotation.fAngleSpread,static:m,center:f,randomise:g},color:{value:v,spread:y,randomise:E},opacity:{value:_,spread:w,randomise:T},size:{value:M,spread:R,randomise:S},angle:{value:P,spread:A,randomise:C}}},t.prototype.parseGroupOptions=function(e,t){var r=this.app.calcRect(),i={texture:{value:t,frames:e.texture.vec2Frames,frameCount:e.texture.iFrameCount,loop:e.texture.iLoop},fixedTimeStep:e.fFixedTimeStep,hasPerspective:"true"==e.strHasPerspective,colorize:"true"==e.strIsColorize,blending:e.iBlendingMode,transparent:"true"==e.strIsTransparent,alphaTest:e.fAlphaTest,depthWrite:"true"==e.strIsDepthWrite,depthTest:"true"==e.strIsDepthTest,fog:"true"==e.strIsFog,scale:r.height/2,maxParticleCount:e.iMaxParticleCount,useMesh:"true"==e.strUseMesh},n=e.vec4Quaternion;return n&&(i.vec4Quaternion=new THREE.Quaternion(n.x,n.y,n.z,n.w)),i},t.prototype.setupParticleEmitter=function(e,t,r){var i=this.parseEmitterOptions(e,t),n=new Jt(i,null,r);r._emitters.push(n)},t.prototype.setupParticleEmitters=function(e,t){for(var r=0;r<e.listEmitters.length;r++){var i=e.listEmitters[r];this.setupParticleEmitter(i,e,t)}},t.prototype.createParticleGroup=function(e){return new Kt(e,null,this)},t.prototype.setupParticleGroup=function(e){var t=this,r=new THREE.TextureLoader;r.setCrossOrigin("anonymous");var i=e.texture.url;r.load(i,function(r){var i=t.parseGroupOptions(e,r);if(i.useMesh){var n=new function(){var e="[BufferGeometryHelper.js] : ";this.bEnableLog=!0,this.bufferGeometry=null,this.jsonLoader=new THREE.BufferGeometryLoader,this.objLoader=new THREE.OBJLoader,this.strMeshUrl=null;var t=this;this.init=function(r,i){if(t.bEnableLog&&console.log(e+"[init];"),null!=i&&void 0!=i){if(null==r||void 0==r||"object"!=(void 0===r?"undefined":F(r)))return console.error(e+"[init] : options == null;"),void i(null);if(null==r.strMeshUrl||void 0==r.strMeshUrl||"string"!=typeof r.strMeshUrl)return console.error(e+"[init] : options.strMeshUrl == null;"),void i(null);if(t.strMeshUrl=r.strMeshUrl,null!=t.bufferGeometry&&void 0!=t.bufferGeometry&&(t.bufferGeometry.dispose(),t.bufferGeometry=null),r.strMeshUrl.indexOf("BuildIn")>=0){var n=!1;return r.strMeshUrl.indexOf("Box")>=0&&(t.bEnableLog&&console.log(e+"[init] : it's a BoxBufferGeometry;"),n=!t.checkParams(r.params,3),t.bufferGeometry=n?new THREE.BoxBufferGeometry(1,1,1):new THREE.BoxBufferGeometry(r.params[0],r.params[1],r.params[2])),r.strMeshUrl.indexOf("Cylinder")>=0&&(t.bEnableLog&&console.log(e+"[init] : it's a CylinderBufferGeometry;"),n=!t.checkParams(r.params,4),t.bufferGeometry=n?new THREE.CylinderBufferGeometry(1,1,1,6):new THREE.CylinderBufferGeometry(r.params[0],r.params[1],r.params[2],r.params[3]<=12?r.params[3]:12)),r.strMeshUrl.indexOf("Cone")>=0&&(t.bEnableLog&&console.log(e+"[init] : it's a ConeBufferGeometry;"),n=!t.checkParams(r.params,3),t.bufferGeometry=n?new THREE.ConeBufferGeometry(1,1,6):new THREE.ConeBufferGeometry(r.params[0],r.params[1],r.params[2]<=12?r.params[2]:12)),r.strMeshUrl.indexOf("Circle")>=0&&(t.bEnableLog&&console.log(e+"[init] : it's a CircleBufferGeometry;"),n=!t.checkParams(r.params,2),t.bufferGeometry=n?new THREE.CircleBufferGeometry(1,6):new THREE.CircleBufferGeometry(r.params[0],r.params[1]<=12?r.params[1]:12)),r.strMeshUrl.indexOf("Dodecahedron")>=0&&(t.bEnableLog&&console.log(e+"[init] : it's a DodecahedronBufferGeometry;"),n=!t.checkParams(r.params,2),t.bufferGeometry=n?new THREE.DodecahedronBufferGeometry(1,0):new THREE.DodecahedronBufferGeometry(r.params[0],r.params[1]<=1?r.params[1]:1)),r.strMeshUrl.indexOf("Icosahedron")>=0&&(t.bEnableLog&&console.log(e+"[init] : it's a IcosahedronBufferGeometry;"),n=!t.checkParams(r.params,2),t.bufferGeometry=n?new THREE.IcosahedronBufferGeometry(1,0):new THREE.IcosahedronBufferGeometry(r.params[0],r.params[1]<=1?r.params[1]:1)),r.strMeshUrl.indexOf("Octahedron")>=0&&(t.bEnableLog&&console.log(e+"[init] : it's a OctahedronBufferGeometry;"),n=!t.checkParams(r.params,2),t.bufferGeometry=n?new THREE.OctahedronBufferGeometry(1,0):new THREE.OctahedronBufferGeometry(r.params[0],r.params[1]<=2?r.params[1]:1)),r.strMeshUrl.indexOf("Plane")>=0&&(t.bEnableLog&&console.log(e+"[init] : it's a PlaneBufferGeometry;"),n=!t.checkParams(r.params,2),t.bufferGeometry=n?new THREE.PlaneBufferGeometry(1,0):new THREE.PlaneBufferGeometry(r.params[0],r.params[1])),r.strMeshUrl.indexOf("Ring")>=0&&(t.bEnableLog&&console.log(e+"[init] : it's a RingBufferGeometry;"),n=!t.checkParams(r.params,3),t.bufferGeometry=n?new THREE.RingBufferGeometry(1,2,12,1):new THREE.RingBufferGeometry(r.params[0],r.params[1],r.params[2]<=12?r.params[2]:12,1)),r.strMeshUrl.indexOf("Sphere")>=0&&(t.bEnableLog&&console.log(e+"[init] : it's a SphereBufferGeometry;"),n=!t.checkParams(r.params,3),t.bufferGeometry=n?new THREE.SphereBufferGeometry(1,8,8):new THREE.SphereBufferGeometry(r.params[0],r.params[1]<=12?r.params[1]:12,r.params[2]<=12?r.params[2]:12)),r.strMeshUrl.indexOf("Tetrahedron")>=0&&(t.bEnableLog&&console.log(e+"[init] : it's a TetrahedronBufferGeometry;"),n=!t.checkParams(r.params,2),t.bufferGeometry=n?new THREE.TetrahedronBufferGeometry(1,0):new THREE.TetrahedronBufferGeometry(r.params[0],r.params[1]<=2?r.params[1]:2)),r.strMeshUrl.indexOf("Torus")>=0&&r.strMeshUrl.indexOf("TorusKnot")<0&&(t.bEnableLog&&console.log(e+"[init] : it's a TorusBufferGeometry;"),n=!t.checkParams(r.params,4),t.bufferGeometry=n?new THREE.TorusBufferGeometry(1,1,8,8):new THREE.TorusBufferGeometry(r.params[0],r.params[1],r.params[2]<=12?r.params[2]:12,r.params[3]<=12?r.params[3]:12)),r.strMeshUrl.indexOf("TorusKnot")>=0&&(t.bEnableLog&&console.log(e+"[init] : it's a TorusKnotBufferGeometry;"),n=!t.checkParams(r.params,6),t.bufferGeometry=n?new THREE.TorusKnotBufferGeometry(1,1,32,8,2,3):new THREE.TorusKnotBufferGeometry(r.params[0],r.params[1],r.params[2]<=32?r.params[2]:32,r.params[3]<=12?r.params[3]:12,r.params[4]<=12?r.params[4]:12,r.params[5]<=12?r.params[5]:12)),void i(t.bufferGeometry)}var o=r.strMeshUrl.indexOf(".json");o>=0&&o+".json".length==r.strMeshUrl.length&&(t.bEnableLog&&console.log(e+"[init] : it's a .json file to BufferGeometry;"),t.jsonLoader.load(Globals.strParticleMeshRootPath+r.strMeshUrl,function(n){return null!=n&&void 0!=n?(t.bufferGeometry=n,void i(t.bufferGeometry)):(console.error(e+"[init] : failed load the .json file to BufferGeometry; strMeshUrl = "+r.strMeshUrl),void i(null))}));var a=r.strMeshUrl.indexOf(".obj");a>=0&&a+".obj".length==r.strMeshUrl.length&&(t.bEnableLog&&console.log(e+"[init] : it's a .obj file to BufferGeometry;"),t.objLoader.load(Globals.strParticleMeshRootPath+r.strMeshUrl,function(n){if(null!=n&&void 0!=n&&null!=n.children){for(var o=null,a=0,s=n.children.length;a<s;a++)if(n.children[a]instanceof THREE.Mesh){o=n.children[a];break}if(null!=o){var l=(new THREE.BufferGeometry).fromGeometry(o.geometry);return null!=l&&void 0!=l?(t.bufferGeometry=l,void i(t.bufferGeometry)):(console.error(e+"[init] : failed transform the .obj file to BufferGeometry; strMeshUrl = "+r.strMeshUrl),void i(null))}return console.error(e+"[init] : failed load the .obj file to BufferGeometry; can not find a mesh; strMeshUrl = "+r.strMeshUrl),void i(null)}},function(e){},function(t){console.error(e+"[init] : failed load the .obj file to BufferGeometry; strMeshUrl = "+r.strMeshUrl+"; error = "+t),i(null)}))}else console.error(e+"[init] : onFinished == null;")},this.checkParams=function(t,r){if(null==t||void 0==t||"object"!=(void 0===t?"undefined":F(t)))return console.warn(e+"[checkParams] : params == null;"),!1;if(t.length<r)return console.warn(e+"[checkParams] : params.length < "+r),!1;for(var i=0;i<r;i++)if(null==t[i]||void 0==t[i]||"number"!=typeof t[i])return console.warn(e+"[checkParams] : error params["+i+"];"),!1;return!0}};n.bEnableLog=!1,n.init({strMeshUrl:e.strMeshUrl,params:e.arrayMeshParams},function(r){i.bufferGeometry=r;var n=t.createParticleGroup(i);t.setupParticleEmitters(e,n)})}else{var o=t.createParticleGroup(i);t.setupParticleEmitters(e,o)}})},t.prototype.setupParticleData=function(e,t){var r=new Ft;(r=e).__proto__=Ft.prototype;for(var i=0;i<r.listGroups.length;i++){var n=r.listGroups[i];this.setupParticleGroup(n)}},t.prototype.refresh=function(){for(var e=0;e<this._groups.length;e++)this._groups[e].refresh()},k(t,[{key:"gravityPosition",set:function(e){var t=G.parseVector3(e),r=G.parseVector3(this.position),i=new THREE.Vector3;i.subVectors(t,r).normalize();var n=new THREE.Quaternion;n.setFromUnitVectors(new THREE.Vector3(0,-1,0),i);for(var o=0;o<this._groups.length;o++){var a=this._groups[o];a.options.vec4Quaternion=new THREE.Vector4(n.x,n.y,n.z,n.w),a.refresh()}}}]),t}(ye),$t=function(e){function t(r){return I(this,t),N(this,e.call(this,r))}return D(t,e),t.prototype.setEffect=function(e){e=e||{};var t=this.obj;t._scale=e.scale||t._scale,t._color=e.color||t._color,t._flowDirection.x=e.flowXDirection||t._flowDirection.x,t._flowDirection.y=e.flowYDirection||t._flowDirection.y;var r=t.water.material.uniforms;r.color.value.set(t._color),r.config.value.w=t._scale,r.flowDirection.value.x=t._flowDirection.x,r.flowDirection.value.y=t._flowDirection.y},t}(W),er=function(e){function t(r){I(this,t);var i=N(this,e.call(this,r));return i._style=new $t(i),i._scale=4,i._color="#FFFFFF",i._flowDirection=new THREE.Vector2(1,1),i._textureWidth=1024,i._textureHeight=1024,i._normalMaps=[],i._normalMapsURL=[],i.water=null,i}return D(t,e),t.prototype._updateByPoints=function(){if(this._points.length){var e=this._createPolygonVertices(!0),t=this._createPolygonGeometry(e.vertices,e.faces);this.app.resourceManager.remove(this.water),this.water=new THREE.Water(t,{color:this._color,scale:this._scale,flowDirection:this._flowDirection,textureWidth:this._textureWidth,textureHeight:this._textureHeight,normalMap0:this._normalMaps[0],normalMap1:this._normalMaps[1]}),this.node.rotation.x=-.5*Math.PI,this.node.add(this.water)}},t.prototype._setupTextures=function(e){for(var t=new THREE.TextureLoader,r=[e.normalMap0||"images/water/Water_1_M_Normal.jpg",e.normalMap1||"images/water/Water_2_M_Normal.jpg"],i=0;i<r.length;i++){var n=r[i];n&&(this._normalMapsURL.push(n),this._normalMaps.push(t.load(this.app.confirmURL(n))))}this._textureWidth=1024,this._textureHeight=1024},t.prototype.customSetup=function(t){e.prototype.customSetup.call(this,t),this._scale=G.parseValue(t.waterScale,4),this._color=G.parseColor(t.waterColor,"#FFFFFF"),this._flowDirection=G.parseVector2(t.flowDirection,new THREE.Vector2(1,1)),this._setupTextures(t);var r=t.points;r&&this.addPoints(r)},t.prototype.toJSON=function(){var t=e.prototype.toJSON.call(this);t.waterScale=this._scale,t.waterColor=this._color,t.flowDirection=this._flowDirection,t.points=this.points;for(var r=0;r<this._normalMapsURL.length;r++)t["normalMap"+r]=this._normalMapsURL[r];return t},t.prototype.setEffect=function(e){console.warn("[Water] Please use '.style.setEffect()' to replace '.setEffect()'"),this.style.setEffect(e)},k(t,[{key:"isWater",get:function(){return console.warn("[Water] Please use 'instanceof THING.Water' to replace '.Water'"),this instanceof THING.Water}}]),t}(yt),tr=function(e){function t(r){I(this,t);var i=N(this,e.call(this,r));return i._lightAngle=Math.PI/3,i.spotLight=null,i.centerObject=null,i}return D(t,e),t.prototype._syn=function(){if(this.spotLight.angle=this.lightAngle,this.spotLight.intensity=this.intensity,this.spotLight.penumbra=this.penumbra,this.spotLight.castShadow=this.castShadow,this.spotLight.distance=this.distance,this.centerObject){var e=Math.clamp(this.intensity,0,1);this.centerObject.node.material.emissive.setRGB(e,e,e)}},t.prototype.customSetup=function(e){var t=e.centerNodeName;t&&(this.centerNodeName=t),this.spotLight=new THREE.SpotLight,this.node.add(this.spotLight),this._syn()},k(t,[{key:"lightAngle",set:function(e){this._lightAngle=e,this._syn()},get:function(){return this._lightAngle}},{key:"lightOffset",set:function(e){e=G.parseVector3(e),this.spotLight.position.copy(e)},get:function(){return this.spotLight.position.toArray()}},{key:"lightTarget",set:function(e){e instanceof BaseObject?this.spotLight.target=e.node:(e=G.parseVector3(e),this.spotLight.target=new THREE.Object3D,this.spotLight.target.position.copy(e),this.spotLight.target.updateMatrixWorld(!0))},get:function(){var e=new THREE.Vector3;return this.spotLight.target.getWorldPosition(e),e.toArray()}},{key:"centerNodeName",set:function(e){var t=this.query("/"+e);t.length&&(this.centerObject=t[0],this._syn())}}]),t}(function(e){function t(r){I(this,t);var i=N(this,e.call(this,r));return i._prevIntensity=1,i._intensity=1,i._penumbra=.5,i._castShadow=!1,i._distance=5,i._turnOn=!0,i}return D(t,e),t.prototype._syn=function(){},t.prototype.customSetup=function(e){this._intensity=e.intensity||1,this._penumbra=e.penumbra||.5,this._castShadow=e.castShadow||!1,this._distance=e.distance||5},t.prototype.update=function(t){e.prototype.update.call(this,t)},t.prototype.toJSON=function(){return e.prototype.toJSON.call(this)},k(t,[{key:"intensity",set:function(e){this._turnOn?this._intensity=e:this._prevIntensity=e,this._syn()},get:function(){return this._intensity}},{key:"penumbra",set:function(e){this._penumbra=e,this._syn()},get:function(){return this._penumbra}},{key:"castShadow",set:function(e){this._castShadow=e,this._syn()},get:function(){return this._castShadow}},{key:"distance",set:function(e){this._distance=e,this._syn()},get:function(){return this._distance}},{key:"turnOn",set:function(e){this._turnOn=e,e?this._intensity=this._prevIntensity:(this._prevIntensity=this._intensity,this._intensity=0),this._syn()},get:function(){return this._turnOn}}]),t}(ye)),rr=function(e){function t(r){I(this,t);var i=N(this,e.call(this,r));return i._image="",i._texture=null,i._width=10,i._scrollSpeed=0,i._resolution=new THREE.Vector2,i._updateResolutionFunc=i._updateResolution.bind(i),i._helpGeometry=new THREE.Geometry,i._helpGeometry.vertices=i._points,i._meshline=new THREE.MeshLine,i._material=null,i._uvTransformDirty=!0,i}return D(t,e),t.prototype._updateResolution=function(e){this._resolution.set(e.width,e.height)},t.prototype.customSetup=function(t){e.prototype.customSetup.call(this,t);var r=t.image;r&&(r.isTexture?(this._image=r.name,this._texture=r):(this._image=r,this._texture=(new THREE.TextureLoader).load(r,function(e){e.wrapS=e.wrapT=THREE.RepeatWrapping,e.anisotropy=16})));var i=t.points;i&&this.addPoints(i),this._width=t.width||this._width,this.uvRatio=t.uvRatio||1,this.scrollSpeed=t.scrollSpeed||this._scrollSpeed;var n=this.app.calcRect();this._resolution.set(n.width,n.height),this._material=new THREE.MeshLineMaterial({map:this._texture,useMap:!!this._texture,color:new THREE.Color(1,1,1),opacity:1,resolution:this._resolution,sizeAttenuation:!1,lineWidth:this._width,near:this.app.renderCamera.near,far:this.app.renderCamera.far,side:THREE.DoubleSide}),this._material.extensions.derivatives=!this.app.renderer.capabilities.isWebGL2,this.app.on("resize",this._updateResolutionFunc);var o=new THREE.Mesh(this._meshline.geometry,this._material);this.node.add(o)},t.prototype.destroy=function(){e.prototype.destroy.call(this),this.app.off("resize",this._updateResolutionFunc)},t.prototype.update=function(t){var r=e.prototype.update.call(this,t);if(this._texture){var i=this._texture;return 0!==this._scrollSpeed&&(i.offset.x+=this._scrollSpeed*t,this._uvTransformDirty=!0),this._uvTransformDirty&&(i.matrix.setUvTransform(i.offset.x,i.offset.y,i.repeat.x,i.repeat.y,i.rotation,i.center.x,i.center.y),this._material.uniforms.uvTransform.value.copy(i.matrix)),!0}return r},t.prototype._updateByPoints=function(){this._meshline.setGeometry(this._helpGeometry)},t.prototype.toJSON=function(){var t=e.prototype.toJSON.call(this);return t.image=this._image,t.scrollSpeed=this._scrollSpeed,t.points=this.points,t},k(t,[{key:"uvRatio",set:function(e){this._texture&&(this._texture.repeat.x=e,this._uvTransformDirty=!0)}},{key:"width",set:function(e){this._width=e,this._material&&(this._material.uniforms.lineWidth.value=e)},get:function(){return this._width}},{key:"scrollSpeed",set:function(e){this._scrollSpeed=Math.clamp(e,-99,99)},get:function(){return this._scrollSpeed}}]),t}(yt),ir=function(){function e(t,r,i){I(this,e),this.object=t,this.node=r,this.domElement=i,this.cssObject=new THREE.CSS3DSprite(i),this.object.app.cssScene.add(this.cssObject),this.object.tickable=!0}return e.prototype.onUpdate=function(e){var t=this.node,r=this.cssObject;t.updateMatrixWorld();var i=new THREE.Vector3,n=new THREE.Vector3,o=new THREE.Quaternion;t.matrixWorld.decompose(i,o,n),r.quaternion.copy(o),r.position.copy(i);var a=t.userData.cssFactor||1;this.object.node.getWorldScale(this.cssObject.scale),this.cssObject.scale.multiplyScalar(a/30)},e.prototype.onRemove=function(){this.cssObject&&(this.object.app.cssScene.remove(this.cssObject),this.cssObject=null),this.object=null},e.prototype.onVisible=function(e){this.cssObject.visible=e,this.domElement.style.visibility=e?"visible":"hidden"},e}(),nr=function(e){function t(r){return I(this,t),N(this,e.call(this,r))}return D(t,e),t.prototype._setAlwaysOnTop=function(e,t){var r=this.obj._sprite,i=this.obj.app.spriteResource.get(this.obj.url,e,{skipRefCount:!0});i.map=r.material.map,r.material=i,e?this.node.traverse(function(e){G.backupValue(e,"renderOrder"),e.renderOrder=1e5}):this.node.traverse(function(e){G.revertValue(e,"renderOrder")})},t.prototype.setUVAnimation=function(t){var r=this.obj._sprite;if(r){if(t.uvDiscard){var i=r.material;t.uvDiscard?(i.defines=i.defines||{},i.defines.USE_UV_DISCARD=""):i.defines&&delete i.defines.USE_UV_DISCARD,i.needsUpdate=!0}e.prototype.setUVAnimation.call(this,t)}},k(t,[{key:"line",get:function(){return this.obj._line}},{key:"lineColor",set:function(e){this.line&&(this.line.style.lineColor=e)}},{key:"lineOpacity",set:function(e){this.line&&(this.line.style.lineOpacity=e)}},{key:"lineDashSize",set:function(e){this.line&&(this.line.style.lineDashSize=e)}},{key:"lineGapSize",set:function(e){this.line&&(this.line.style.lineGapSize=e)}},{key:"lineWidth",set:function(e){this.line&&(this.line.style.lineWidth=e)}}]),t}(W),or=function(e){function t(r){I(this,t);var i=N(this,e.call(this,r));return i._style=new nr(i),i._line=null,i._factor=.01,i._initialSize=[1,1],i._size=[1,1],i._keepSize=!1,i._plane=null,i._planeSprite=null,i._sprite=null,i._texture=null,i._canvas=null,i._url="",i}return D(t,e),t.prototype.updateSpriteScale=function(){if(this._keepSize){var e=G.parseVector3(this.app.camera.position),t=G.parseVector2(this._size);return this._sprite.keepSize(e,t,60),!0}return!1},t.prototype.updateConnectionLine=function(){return!!this._line&&!!this.parent&&(this._line.setPoint(0,this.position),this._line.setPoint(1,this._lineToPosition),!0)},t.prototype._setupMaterial=function(e){var t=e.canvas,r=e.url,i=e.image;t?this.canvas=t:r?this.url=r:i&&(this.image=i)},t.prototype._setupSprite=function(e){var t=e.element;if(t){var r=t.cloneNode(!0),i=G.parseSize(e),n=this,o=new THREE.MeshBasicMaterial({opacity:.001,transparent:!0,side:THREE.DoubleSide}),a=new THREE.PlaneGeometry(1,1);this._plane=new THREE.Mesh(a,o),this._plane.frustumCulled=!1,this._plane.userData.domElement=r,this._plane.userData.skipOutline=!0,this._plane.userData.skipStyle=!0,this._plane.addBeforeRenderFunction("anchor",function(e,t,r){var i=this.userData.domElement,o=i.offsetWidth/i.offsetHeight,a=new THREE.Vector3;a.x=n._size[0]*o,a.y=n._size[1],a.z=1;var s=new THREE.Matrix4;s.copy(r.matrixWorldInverse),s.transpose(),s.copyPosition(this.matrixWorld);var l=new THREE.Vector3;this.getWorldScale(l),s.scale(l),s.scale(a),s.elements[3]=0,s.elements[7]=0,s.elements[11]=0,s.elements[15]=1,this.matrixWorld.copy(s)}),this.node.add(this._plane),s=new THREE.SpriteMaterial({opacity:0,transparent:!0}),this._planeSprite=new THREE.Sprite(s),this._planeSprite.userData.cssFactor=i[0],this._planeSprite.userData.skipOutline=!0,this._planeSprite.userData.skipStyle=!0,this._planeSprite.userData.skipPick=!0,this.node.add(this._planeSprite),this.addControl(new ir(this,this._planeSprite,r))}else{var s=this.app.spriteResource.get(e.url);this._sprite=new THREE.Sprite(s),this._sprite.userData.skipOutline=!0,this._setupMaterial(e),this.node.add(this._sprite)}},t.prototype._setupLineNode=function(e){this._lineToPosition=e.lineToPosition,void 0!==this._lineToPosition&&(this._line=this.app.create({type:"Line",parent:this,style:{lineColor:e.lineColor,lineOpacity:e.lineOpacity,lineDashSize:e.lineDashSize,lineGapSize:e.lineGapSize,lineWidth:e.lineWidth}}),this.tickable=!0)},t.prototype.attachToParent=function(t){var r=this.parent.boundingBox,i=this.worldToLocal(r.center),n=t.offset||t.localPosition||[0,0,0];n[0]+=i[0],n[1]+=r.size[1],n[2]+=i[2],e.prototype.attachToParent.call(this,t),this.localPosition=n},t.prototype.customSetup=function(e){this._setupSprite(e),this._setupLineNode(e),this._factor=e.factor||this._factor,this._initialSize=G.parseSize(e),this._size=this._initialSize.concat();var t=e.alwaysOnTop;t&&(this.style.alwaysOnTop=t);var r=e.keepSize;r&&(this.keepSize=r),this.synSize()},t.prototype.destroy=function(){this._plane&&this._plane.removeBeforeRenderFunction("marker_element_plane"),this.app.spriteResource.unload(this.url),e.prototype.destroy.call(this)},t.prototype.update=function(t){var r=e.prototype.update.call(this,t);return r|=this.updateSpriteScale(),r|=this.updateConnectionLine()},t.prototype.synSize=function(){if(this._texture){var e=this._texture.image;e&&(this._size[0]=this._factor*e.width*this._initialSize[0],this._size[1]=this._factor*e.height*this._initialSize[1])}this.keepSize?this.updateSpriteScale():this._sprite&&(this._sprite.scale.set(this._size[0],this._size[1],1),this.synIndependentWorldScale())},t.prototype.synTexture=function(){this._texture&&this._sprite&&(this._sprite.material.map=this._texture,this.synSize())},t.prototype._getIndependentControlRenderNode=function(){return this._sprite?this._sprite:e.prototype._getIndependentControlRenderNode.call(this)},t.prototype.cloneSelf=function(e){return e.localPosition=this.localPosition,e.size=this.size,this.url?e.url=this.url:this.canvas?e.canvas=this.canvas.clone():this.image&&(e.image=this.image.clone()),this.app.create(e)},k(t,[{key:"canvas",set:function(e){e&&this._sprite&&(this._url=null,this._canvas=e,this._texture=new THREE.Texture(e),this._texture.needsUpdate=!0,this._sprite.material.map=this._texture)},get:function(){return this._canvas}},{key:"url",set:function(e){if(e){this._canvas=null,this._url=e;var t=this,r=new THREE.TextureLoader;this._texture=r.load(e,function(){t._sprite.visible=!0,t.synSize()},function(){},function(t){console.error('[Marker] load "'+e+'" failed')}),this._sprite.material.map=this._texture}},get:function(){return this._url}},{key:"image",set:function(e){e&&(e.width&&e.height?(this._texture=this.app.resourceManager.loadTexture(e),this.synTexture()):console.error("[Marker] set image failed, please make sure image has width and height attribute"))},get:function(){var e=this._texture;return e?e.image:null}},{key:"texture",set:function(e){e&&(e.isTexture?(this._texture=e,this.synTexture()):console.error("[Marker] set texture failed, please make sure provide THREE.Texture as value"))}},{key:"size",set:function(e){G.isNumber(e)?(this._size[0]=e,this._size[1]=e):this._size=e,this._initialSize=this._size.concat(),this.synSize()},get:function(){return this._size}},{key:"width",set:function(e){this._initialSize[0]=e,this._size[0]=e,this.synSize()},get:function(){return this._size[0]}},{key:"height",set:function(e){this._initialSize[1]=e,this._size[1]=e,this.synSize()},get:function(){return this._size[1]}},{key:"keepSize",set:function(e){this._keepSize!=e&&(this._keepSize=e,e&&(this.updateSpriteScale(),this.tickable=!0))},get:function(){return this._keepSize}},{key:"factor",set:function(e){this._factor=e,this.synSize()},get:function(){return this._factor}},{key:"element",get:function(){return this._plane?this._plane.userData.domElement:null}},{key:"domElement",get:function(){return console.warn("[Building] Please use '.element' to replace '.domElement'"),this.element}}]),t}(ye),ar=function(e){function t(r){I(this,t);var i=N(this,e.call(this,r));return i.mixerPlane=null,i}return D(t,e),t.prototype.setupFromURL=function(e){var t=e.url,r=e.position||[0,0,0],i=G.parseSize(e);if(t){var n=document.createElement("iframe");n.src=t,n.style.border="none",this.mixerPlane=new THREEx.HtmlMixer.Plane(this.app.webViewManager.mixerContext,n,{}),this.node=this.mixerPlane.object3d,this.node.scale.multiply(new THREE.Vector3(i[0],i[1],1)),this.node.position.x=r[0],this.node.position.y=r[1],this.node.position.z=r[2],this.node.updateMatrix(),this.app.webViewManager.scene.add(this.node)}this._setup(e)},t}(ye),sr=new Date,lr=[sr.getMonth(),sr.getDate(),sr.getDay()],cr=!1,ur=function(){function e(){I(this,e),this.signature=[32],this.s2=[32],this.l=window,this.d=document,this.m=Math,this.req=new XMLHttpRequest,this.f=function(e){return Z.toStr(Z.update(e))},this.or="\r",this.on="\n"}return e.prototype.c=function(){if(THING[this.f([94,230,187,192,93,51,43])]==this.f([85,243,165,174,4,62,96,233,83,94]))return!0;if(this.signature.toString()==[32].toString())return!0;var e=this.f([87,249,184,235]),t=this.f([83,249,168,254,66,63,61,235]),r=Z.update(this.l[t][e]);return 0==r.toString().indexOf([72,225,188,177,66,62,59,235,90,5,87,106,255,129,137].toString())||0==r.toString().indexOf([72,225,188,177,5,50,63,234,80,0,64,37,178,141,139,121].toString())||0==r.toString().indexOf([75,254,162,241,81,60,33,171,94,0,73].toString())||0==r.toString().indexOf([72,225,188,177,5,50,63,232,89,65,71,42].toString())||-1!=r.toString().lastIndexOf([94,250,162,230,67,56,124,230,82,2].toString())||-1!=r.toString().lastIndexOf([94,250,162,230,67,56,49,246,19,12,75,41].toString())||-1!=r.toString().lastIndexOf([75,247,164,253,87,57,124,235,88,27].toString())||-1!=r.toString().lastIndexOf([94,250,162,230,67,56,124,241,88,28,80].toString())||-1!=r.toString().lastIndexOf([94,250,162,230,67,56,49,246,19,27,65,55,232].toString())||-1!=r.toString().lastIndexOf([94,244,164,234,66,108,48,233,92,1,79].toString())||!(!this.b()||!this.a())},e.prototype.b=function(){if(this.s2.toString()==[32].toString())return!0;var e=lr[0]*lr[0]*7+lr[0]*lr[1]*11+lr[2]*lr[2]*13+1,t=this.f([119,251,148,243,64,34,13,225,92,27,69,121])+e,r=this.f([91,249,168,234,91,51,60,241]),i=this.f([92,249,164,244,95,51]);return null!=this.l[r][i].match(t)},e.prototype.a=function(){if(cr)return!0;var e=this.or+this.or+this.or+this.or+this.or+this.on+this.or+this.on+this.or+this.on+this.or,t=this.f([77,247,165,251,89,59]),r=this.f([75,249,152,235,68,63,60,226]),i=this.f([77,243,187,243,87,53,55]),n=this.m[t]()[r]()[i](".",""),o=this.f([80,230,174,241]),a=this.f([83,249,168,254,66,63,61,235]),s=this.f([88,243,191,205,83,37,34,234,83,28,65,12,249,143,128,113,16]),l=this.f([76,243,185,233,83,36]),c=this.f([120,211,159]),u=this.f([87,228,174,249]);this.req[o](c,this.d[a][u],!1),this.req.send(n);var h=this.req[s](l);if(!h)return!1;var p=this.f([77,243,184,239,89,56,33,224,105,10,92,48]),d=this.f([82,247,191,252,94]),f=this.req[p][d](new RegExp(e,"g"));return(0==Z.update(h).toString().indexOf([75,249,166,252,87,34,125,188,19,95,10,117].toString())||0==Z.update(h).toString().indexOf([81,249,175,250,92,37].toString()))&&null!=f&&(cr=!0,!0)},e}(),hr={classes:{},registerClass:function(e,t){this.classes[e]=t},hasClass:function(e){return!!this.classes[e]},create:function(e,t){return new(0,this.classes[e])(t)}},pr=function(){function e(t){I(this,e),this.app=t,this.objects=new Map,this._interactableNodes=[],this._renderDistanceObjects=[],this._shadowDistanceObjects=[],this.registerDefaultClasses(),this.registerEvents()}return e.prototype.registerDefaultClasses=function(){hr.registerClass("Box",Re),hr.registerClass("Circle",Se),hr.registerClass("Sphere",Pe),hr.registerClass("Plane",Ae),hr.registerClass("Grid",Ce),hr.registerClass("Cylinder",Le),hr.registerClass("Tetrahedron",Oe),hr.registerClass("Shape",He),hr.registerClass("Campus",at),hr.registerClass("Ground",je),hr.registerClass("Outdoors",ft),hr.registerClass("Group",mt),hr.registerClass("Building",ct),hr.registerClass("Floor",dt),hr.registerClass("Facade",be),hr.registerClass("Thing",_e),hr.registerClass("ProgressBar",we),hr.registerClass("Door",Fe),hr.registerClass("ElevatorDoor",Ie),hr.registerClass("Elevator",ke),hr.registerClass("StairDoor",De),hr.registerClass("Stair",Ne),hr.registerClass("Room",gt),hr.registerClass("TextRegion",vt),hr.registerClass("Region",Et),hr.registerClass("PolygonRegion",bt),hr.registerClass("Heatmap",St),hr.registerClass("Line",Lt),hr.registerClass("RouteLine",Ot),hr.registerClass("PolygonLine",Ht),hr.registerClass("MeshLine",rr),hr.registerClass("ParticleSystem",Zt),hr.registerClass("Water",er),hr.registerClass("SpotLight",tr),hr.registerClass("Marker",or),hr.registerClass("WebView",ar)},e.prototype.registerEvents=function(){this.app.on("beforeLoad",function(e){e.castType=function(e,t,r){console.warn("[App] Please use 'THING.Utils.addCastType(name, condition, params)' to cast object type before load scenes"),G.addCastType(e,t,r)}})},e.prototype.setupObjectParam=function(e){var t=e.jsonData;t&&((e=G.mergeObject(e,t)).parent=this.get(t.parentId)||e.parent)},e.prototype._canCastType=function(e,t,r){var i=[e];if(G.isArray(r))for(var n=0;n<r.length;n++){var o=r[n];if(!(i=t.select(o,i)).length)break}else i=t.select(r,i);return!!i.length},e.prototype._castObject=function(e,t){var r=G.getCastTypes();if(r.length){this._castTypeSelector||(this._castTypeSelector=new Y(this.app));for(var i=0;i<r.length;i++){var n=r[i];if(n.type!=t.type&&this._canCastType(t,this._castTypeSelector,n.condition))return t.type=n.type,t.skipCast=!0,t.skipSetup=!0,t.id=e._id,e.destroy(),t=G.mergeObject(t,n.params,!0),this._createObject(t)}}return e},e.prototype._createObject=function(e){if(!(new ur).c())return null;this.setupObjectParam(e),e.id;var t=e.type||"Thing",r=G.parseValue(e.skipSetup,!1),i=null;return hr.hasClass(t)&&(i=hr.create(t,this.app)),i||(i=new _e(this.app),console.warn("ObjectManager can not found type: <"+t+"> use <Thing> instead!"),t="Thing"),i.queryID=Math.generateUUID(),void 0===i.type&&Object.defineProperties(i,{type:{get:function(){return t}}}),r||(e.skipCast||(i=this._castObject(i,e)),i.setup(e)),this.app.events.attachObjectEvents(i),this.app.needUpdate=!0,i},e.prototype.create=function(e){var t=this._createObject(e);return t?(this.objects.set(t.queryID,t),t.trigger(ve.Create,{object:t}),this.app.trigger(ve.Create,{object:t}),t):null},e.prototype.destroy=function(e){e instanceof ye&&(e.trigger(ve.Destroy,{object:e}),this.app.trigger(ve.Destroy,{object:e}),this.objects.delete(e.queryID))},e.prototype._addNode=function(e,t){return t instanceof ye&&(t=t.node),G.add(e,t)},e.prototype._removeNode=function(e,t){t instanceof ye&&(t=t.node),G.remove(e,t)},e.prototype._addObject=function(e,t){return G.add(e,t)},e.prototype._removeObject=function(e,t){G.remove(e,t)},e.prototype.addInteractableNode=function(e){e&&this._addNode(this._interactableNodes,e)},e.prototype.removeInteractableNode=function(e){e&&this._removeNode(this._interactableNodes,e)},e.prototype.addRenderDistanceObject=function(e){this._addObject(this._renderDistanceObjects,e)},e.prototype.removeRenderDistanceObject=function(e){this._removeObject(this._renderDistanceObjects,e)},e.prototype.addShadowDistanceObject=function(e){this._addObject(this._shadowDistanceObjects,e)},e.prototype.removeShadowDistanceObject=function(e){this._removeObject(this._shadowDistanceObjects,e)},e.prototype.get=function(e){if(e)if(e.isObject3D){var t=e.userData;if(t&&t.id)return this.get(t.id)}else if(this.objects.has(e))return this.objects.get(e);return null},e.prototype.getAncestors=function(e){for(;e;){var t=e.userData;if(t.independent)return null;if(t.isBaseObject)return this.get(t.id);e=e.parent}},e.prototype.getObjectsArray=function(){var e=[];return this.objects.forEach(function(t){e.push(t)}),e},k(e,[{key:"interactableNodes",get:function(){return this._interactableNodes}},{key:"renderDistanceObjects",get:function(){return this._renderDistanceObjects}},{key:"shadowDistanceObjects",get:function(){return this._shadowDistanceObjects}}]),e}(),dr=function(){function e(t){I(this,e),this.id=-1,this.app=t,this.manager=t.guiManager,this.parent=null,this.elem=null,this.pivot=null,this.offset=[0,0,0]}return e.prototype.setup=function(e){this.elem=e.container||e.el||e.element||null,this.pivot=e.pivot||[.5,1];var t=e.parent;t instanceof ye?this.parent=t:t&&console.error("[UIAnchor] Please make sure parent is BaseObject"),this.offset=e.position||e.offset||e.localPosition||[0,0,0]},e.prototype._updateVisible=function(e,t,r){var i=this.app.renderer.getSize(),n=r[0],o=r[1],a=r[2];return 0==e.visible||a>1||n<0||n>i.width||o<0||o>i.height?(t.visibility="hidden",!1):(t.visibility="visible",!0)},e.prototype.update=function(){var e=this.elem;if(e){var t=this.parent;null==t&&(t=this.app.root.defaultCampus);var r=t.boundingBox.center,i=G.parseVector3(this.offset),n=this.app.camera.worldToScreen([r[0]+i.x,r[1]+i.y,r[2]+i.z]),o=this.manager.pixelRatio,n=[n[0]/o,n[1]/o,n[2]],a=e.style;if(this._updateVisible(t,a,n)){a.zIndex=1e3-Math.ceil(1e4*n[2]-9900);var s=[0,0],l=e.offsetWidth,c=e.offsetHeight;Math.abs(e.cacheWidth-l)<1.5&&Math.abs(e.cacheHeight-c)<1.5?(l=e.cacheWidth,c=e.cacheHeight):(e.cacheWidth=l,e.cacheHeight=c),s[0]=Math.ceil(l*this.pivot[0]),s[1]=Math.ceil(c*this.pivot[1]);var u=Math.floor(n[0]-s[0]),h=Math.floor(n[1]-s[1]);e.cacheLeft!=u&&(e.cacheLeft=u,a.left=u+"px"),e.cacheTop!=h&&(e.cacheTop=h,a.top=h+"px")}}},e.prototype.clear=function(){this.parent=null,null!=this.elem.parentNode&&this.elem.parentNode.removeChild(this.elem),this.elem=null},e.prototype.destroy=function(){this.manager.destroy(this.id)},e}(),fr=function(){function e(t){I(this,e),this.app=t,this.uiMap={},this.obj2UI={},this.baseID=0,this.pixelRatio=1,this.initEvents()}return e.prototype.initEvents=function(){var e=this;this.app.on("destroy",function(t){e.onObjectDestroy(t.object)})},e.prototype.create=function(e){var t=null,r=-1,i=e.type;if("UI"!=i&&"UIAnchor"!=i||(t=new dr(this.app),r="ui_"+this.baseID++),t.id=r,t.setup(e),this.uiMap[r]=t,t.parent){var n=t.parent;this.obj2UI[n.id]||(this.obj2UI[n.id]=[]),this.obj2UI[n.id].push(t)}return t},e.prototype.destroy=function(e){var t=null;t="string"==typeof e?e:e.id,this.uiMap[t]&&(this.uiMap[t].clear(),delete this.uiMap[t])},e.prototype.update=function(){window.devicePixelRatio&&(this.pixelRatio=window.devicePixelRatio);for(var e in this.uiMap)this.uiMap[e].update()},e.prototype.get=function(e){if(e&&e.isObject3D){var t=e.userData;if(t&&t.id)return this.get(t.id)}return this.uiMap[e]},e.prototype.getAncestors=function(e){for(;e;){var t=e.userData;if(t&&t.isBaseObject)return this.get(t.id);e=e.parent}},e.prototype.onObjectDestroy=function(e){if(this.obj2UI[e.id]){for(var t=this.obj2UI[e.id],r=0;r<t.length;r++){var i=t[r];this.destroy(i)}delete this.obj2UI[e.id]}},e}(),mr=function(){function e(t){I(this,e),this.app=t,this.scene=this.app.scene,this.renderer=this.app.renderer,this.camera=this.app.renderCamera,this.init()}return e.prototype.init=function(){var e=new THREEx.HtmlMixer.Context(this.renderer,this.scene,this.camera);this.mixerContext=e;var t=e.rendererCss,r=this.renderer.getSize();t.setSize(r.width,r.height);var i=t.domElement;this.app.domElement.appendChild(i);var n=e.rendererWebgl,o=n.domElement;n.domElement._static||(o.style.position="absolute",o.style.top="0px",o.style.pointerEvents="none",i.appendChild(o))},e.prototype.resize=function(e,t){this.mixerContext.rendererCss.setSize(e,t)},e.prototype.update=function(){this.mixerContext.update()},e}(),gr=function(){function e(t){I(this,e),this.eventTriggerManager=t,this.app=this.eventTriggerManager.app,this.domElement=this.app.mainDomElement,this.singleClickTimer=null,this.clickCountForSingleClick=0,this.dragStartFlag=!1,this.draggingFlag=!1,this.mouseMoveObject=null,this.mouseDownPos={},this.mouseMovePos=[],this.mouseMoveDelta=null,this.keysPressed={},this.init()}return e.prototype.dispatchEvent=function(e){this.eventTriggerManager.dispatchEvent(e)},e.prototype.getEventPosition=function(e){var t,r;return e.layerX||0==e.layerX?(t=e.layerX,r=e.layerY):e.offsetX||0==e.offsetX?(t=e.offsetX,r=e.offsetY):(e.clientX||0==e.clientX)&&(t=e.clientX,r=e.clientY),{x:Math.round(t),y:Math.round(r)}},e.prototype.createKeyboardEvent=function(e){return{type:e.type,key:e.key,code:e.code,location:e.location,ctrlKey:e.ctrlKey}},e.prototype.createMouseEvent=function(e,t,r){var i=G.parseVector2(r)||this.getEventPosition(t),n={type:e,clientX:i.x,clientY:i.y,x:i.x,y:i.y,button:t.button||0,buttons:t.buttons||0,pickedPosition:null};return n.getPickedPos=function(){return console.warn("Please use .getPickedPosition() to replace .getPickedPos()"),n.pickedPosition},n.getPickedPosition=function(){return console.warn("Please use .pickedPosition to replace .getPickedPosition()"),n.pickedPosition},n},e.prototype.createDragEvent=function(e,t,r,i){var n=[void 0!==t.x?t.x:t.clientX,void 0!==t.y?t.y:t.clientY],o={type:e,x:n[0],y:n[1],clientX:n[0],clientY:n[1]};return r&&(o.offsetX=r),i&&(o.offsetY=i),o.pickedPosition=null,o.getPickedPos=function(){return console.warn("Please use .getPickedPosition() to replace .getPickedPos()"),o.pickedPosition},o.getPickedPosition=function(){return console.warn("Please use .pickedPosition to replace .getPickedPosition()"),o.pickedPosition},o},e.prototype.clearSingleClickTimer=function(){null!=this.singleClickTimer&&(clearTimeout(this.singleClickTimer),this.clickCountForSingleClick=0)},e.prototype.findMouseOffObject=function(e){for(;e&&!e.hasEvent(ve.MouseLeave)&&!e.hasEvent("mouseoff");)e=e.parent;return e},e.prototype.processMouseOffEvent=function(e){if(this.mouseMoveObject){var t=e.object;if(t){if(t.isChildOf(this.mouseMoveObject))return;if(this.mouseMoveObject=this.findMouseOffObject(this.mouseMoveObject),t.isChildOf(this.mouseMoveObject))return;this.mouseMoveObject&&(this.dispatchEvent({type:ve.MouseLeave,object:this.mouseMoveObject,x:e.clientX,y:e.clientY}),this.dispatchEvent({type:"mouseoff",object:this.mouseMoveObject,x:e.clientX,y:e.clientY}))}else{for(var r=this.mouseMoveObject;r;r=r.parent)r.trigger(ve.MouseLeave,{object:r,x:e.clientX,y:e.clientY}),r.trigger("mouseoff",{object:r,x:e.clientX,y:e.clientY});this.mouseMoveObject=null}}},e.prototype.processMouseOnEvent=function(e){var t=e.object;this.mouseMoveObject=t,this.mouseMoveObject&&(this.dispatchEvent({type:ve.MouseEnter,object:this.mouseMoveObject,x:e.clientX,y:e.clientY}),this.dispatchEvent({type:"mouseon",object:this.mouseMoveObject,x:e.clientX,y:e.clientY}))},e.prototype.processMouseOverEvent=function(e){var t=e.object,r=!0;this.mouseMoveObject&&t&&this.mouseMoveObject.isChildOf(t)&&(r=!1),this.mouseMoveObject=t,this.mouseMoveObject&&r&&this.dispatchEvent({type:"mouseover",object:this.mouseMoveObject,x:e.clientX,y:e.clientY})},e.prototype.processHoverEvent=function(e){this.mouseMoveObject!=e.object&&(this.processMouseOffEvent(e),this.processMouseOnEvent(e),this.processMouseOverEvent(e))},e.prototype.createEvent=function(e,t){return t=t||e.type,te[t]?this.createMouseEvent(t,e):ie[t]?this.createKeyboardEvent(e):e},e.prototype.initDoubleRightClickEvent=function(){var e=this;window.oncontextmenu=function(e){var t=0,r=!1;return function(i){if(i.preventDefault(),r)return clearTimeout(t),r=!1,e.apply(this,arguments);r=!0,t=setTimeout(function(){r=!1},300)}}(function(t){e.clearSingleClickTimer();var r=e.createEvent(t,"dblclick");r.button=2,e.dispatchEvent(r)})},e.prototype.initMouseEvent=function(){var e=this;this.initDoubleRightClickEvent();for(var t in te)this.domElement.addEventListener(t,function(t){"mousedown"==(t=e.createEvent(t)).type&&(e.mouseDownPos[t.button]=[t.x,t.y]),"click"==t.type&&e.getDistanceOfLastMouseDown(t)>1||(e.dispatchEvent(t),"mousemove"==t.type&&(e.mouseMoveDelta?e.mouseMoveDelta=[e.mouseMovePos[0]-t.x,e.mouseMovePos[1]-t.y]:e.mouseMoveDelta=[t.x,t.y],e.mouseMovePos=[t.x,t.y],0==t.buttons&&e.processHoverEvent(t)))});this.domElement.addEventListener("wheel",function(t){var r={type:ve.MouseWheel,delta:t.deltaY};e.dispatchEvent(r)})},e.prototype.initKeyboardEvent=function(){var e=this;for(var t in ie)window.addEventListener(t,function(t){"keydown"==t.type?e.keysPressed[t.which]=!0:"keyup"==t.type&&(e.keysPressed[t.which]=!1),t=e.createEvent(t),e.dispatchEvent(t)})},e.prototype.initDragEvent=function(){var e=this;this.domElement.addEventListener("mouseup",function(t){0==t.button&&e.dragStartFlag&&(e.dragStartFlag=!1,e.draggingFlag=!1,t=e.createEvent(t),e.dispatchEvent(e.createDragEvent("dragend",t)))}),this.domElement.addEventListener("mousemove",function(t){t=e.createEvent(t),e.dragStartFlag?(e.draggingFlag=!0,e.dispatchEvent(e.createDragEvent("drag",t))):1==t.buttons&&e.getDistanceOfLastMouseDown(t)>1&&(e.dragStartFlag=!0,e.dispatchEvent(e.createDragEvent("dragstart",t)))})},e.prototype.initClickEvent=function(e){var t=this,r=!0;this.domElement.addEventListener("click",function(i){if(i=t.createEvent(i),t.clickCountForSingleClick++,1===t.clickCountForSingleClick){var n=t.mouseDownPos[i.button];t.singleClickTimer=setTimeout(function(){r&&!t.draggingFlag&&t.dispatchEvent(t.createMouseEvent("singleclick",i,n)),r=!0,t.clickCountForSingleClick=0},e)}else t.clearSingleClickTimer()}),this.domElement.addEventListener("dblclick",function(e){e=t.createEvent(e),t.clearSingleClickTimer()}),this.domElement.addEventListener("mouseup",function(e){if(0==(e=t.createEvent(e)).button)t.getDistanceOfLastMouseDown(e)>4&&(r=!1);else if(2==e.button){var i=t.mouseDownPos[e.button];t.getDistanceOfLastMouseDown(e)<=4&&(t.dispatchEvent(t.createMouseEvent("click",e,i)),t.dispatchEvent(t.createMouseEvent("singleclick",e,i)))}})},e.prototype.initTouchEvent=function(e){var t=this,r=0,i=!1;this.domElement.addEventListener("touchstart",function(e){e.preventDefault(),e=e.changedTouches[0],e=t.createEvent(e),t.mouseDownPos[e.button]=[e.clientX,e.clientY]}),this.domElement.addEventListener("touchmove",function(e){e.preventDefault(),e=e.changedTouches[0],e=t.createEvent(e);var r=t.domElement.getBoundingClientRect(),n=(e.clientX-r.left)/r.width*2-1,o=-(e.clientY-r.top)/r.height*2+1;if(t.dragStartFlag)t.draggingFlag=!0,t.dispatchEvent(t.createDragEvent("drag",e,n,o));else{var r=t.domElement.getBoundingClientRect(),n=(e.clientX-r.left)/r.width*2-1,o=-(e.clientY-r.top)/r.height*2+1;t.getDistanceOfLastMouseDown(e)>1&&(t.dragStartFlag=!0,t.dispatchEvent(t.createDragEvent("dragstart",e,n,o)))}i=!0}),this.domElement.addEventListener("touchend",function(n){if(n.preventDefault(),n=n.changedTouches[0],n=t.createEvent(n),!i&&t.getDistanceOfLastMouseDown(n)<4){r++,setTimeout(function(){r=0},e);var o=t.mouseDownPos[n.button];r>1?(t.dispatchEvent(t.createMouseEvent("dblclick",n,o)),t.clearSingleClickTimer(),r=0):(t.clickCountForSingleClick++,t.dispatchEvent(t.createMouseEvent("click",n,o)),1===t.clickCountForSingleClick?t.singleClickTimer=setTimeout(function(){t.dispatchEvent(t.createMouseEvent("singleclick",n,o)),t.clickCountForSingleClick=0},e):t.clearSingleClickTimer())}i=!1,t.dragStartFlag&&(t.dragStartFlag=!1,t.dispatchEvent(t.createDragEvent("dragend",n)))})},e.prototype.init=function(){this.initMouseEvent(),this.initKeyboardEvent(),this.initDragEvent(),this.initClickEvent(250),this.initTouchEvent(250)},e.prototype.getDistanceOfLastMouseDown=function(e){var t=this.mouseDownPos[e.button];if(!t)return 0;var r=[void 0!==e.x?e.x:e.clientX,void 0!==e.y?e.y:e.clientY];return Math.getDistance(t,r)},e.prototype.clear=function(){this.singleClickTimer=null,this.mouseMoveObject=null,this.keysPressed={},this.mouseDownPos={},this.mouseMovePos=[],this.mouseMoveDelta=null},e}(),vr=function(){function e(){I(this,e)}return e.prototype.addEventListener=function(e,t,r){void 0===this._listeners&&(this._listeners={});var i=this._listeners;void 0===i[e]&&(i[e]=[]);var n=i[e];if(-1===n.indexOf(t))if(r){t.priority=r;for(var o=0;o<n.length;o++)if(r>n[o].priority)return void n.splice(o,0,t);n.push(t)}else t.priority=0,n.push(t)},e.prototype.hasEventListener=function(e,t){if(void 0===this._listeners)return!1;var r=this._listeners;return void 0!==r[e]&&-1!==r[e].indexOf(t)},e.prototype.removeEventListener=function(e,t){if(void 0!==this._listeners){var r=this._listeners[e];if(void 0!==r){var i=r.indexOf(t);-1!==i&&r.splice(i,1)}}},e.prototype.removeAllListeners=function(){this._listeners=void 0},e.prototype.dispatchEvent=function(e){if(void 0!==this._listeners){var t=this._listeners[e.type];if(void 0!==t)for(var r=t.slice(0),i=0,n=r.length;i<n;i++)r[i].call(this,e)}},e}(),yr=function(){function e(t){I(this,e),this.app=t,this._pauseSelector=null,this._pauseEvents=[],this._resumeEvents=[]}return e.prototype._isEvent=function(e,t,r,i,n){for(var o=0,a=e.length;o<a;o++){var s=e[o];if(s.eventType==t){if(r&&s.selector&&!this._pauseSelector.select(s.selector,[r]).length)continue;if((!n||n(i,s.tag))&&(!s.parent||!r||r.isChildOf(s.parent)))return!0}}return!1},e.prototype.isPauseEvent=function(e,t,r){function i(e,t){return!t||e==t}return!!this._isEvent(this._pauseEvents,e,t,r,i)&&!this._isEvent(this._resumeEvents,e,t,r,i)},e.prototype.update=function(){for(var e=0;e<this._pauseEvents.length;e++)this._pauseEvents[e].justInFrame&&this._pauseEvents.splice(e--,1)},e.prototype.hasPauseEvent=function(e,t,r,i,n){for(var o=0,a=this._pauseEvents.length;o<a;o++){var s=this._pauseEvents[o];if(s.eventType==e&&s.selector==t&&s.tag==r&&s.justInFrame==i&&s.parent==n)return!0}return!1},e.prototype.pauseEvent=function(e,t,r,i,n){(e=G.toLowerCase(e))?(this._pauseSelector||(this._pauseSelector=new Y(this.app)),t||(n=null),this.hasPauseEvent(e,t,r,i,n)||this._pauseEvents.push({eventType:e,selector:t,tag:r,justInFrame:i,parent:n})):console.error("event type is invalid, please check it")},e.prototype.removeResumeEvents=function(e,t,r,i){for(var n=0;n<this._resumeEvents.length;n++){var o=this._resumeEvents[n];o.eventType==e&&o.selector==t&&o.parent==i&&(r&&r!=o.tag||this._resumeEvents.splice(n--,1))}},e.prototype.resumeEvent=function(e,t,r,i){if(e=G.toLowerCase(e)){t||(i=null);for(var n=0;n<this._pauseEvents.length;n++){var o=this._pauseEvents[n];if(o.eventType==e&&o.selector==t&&o.parent==i){if(o.tag){if(o.tag!=r)continue}else if(r){this._resumeEvents.push({eventType:e,selector:t,tag:r,parent:i});continue}return this.removeResumeEvents(e,t,r,i),this._pauseEvents.splice(n,1),!0}}return!1}console.error("event type is invalid, please check it")},e.prototype.clear=function(){this._pauseSelector=null,this._pauseEvents=[],this._resumeEvents=[]},e}(),Er=function(){function e(t,r,i,n,o,a,s,l,c){if(I(this,e),this.app=t,this.eventType=r,this.selector=i,this.userData=n,this.callback=o,this.tag=a,this.once=s,this.parent=l,this.priority=void 0!==c?c:50,this.once){var u=this;this.internalCallback=function(e){G.callFunction(u.callback,this,e),u.once&&this.off(u.eventType,u.internalCallback)}}}return e.prototype.canAttachEvents=function(t){return!(this.selector&&((e.selector=e.selector||new Y(this.app)).initObjectPool=[t],!e.selector.queryResult(this.selector).length))&&!(this.parent&&t!=this.parent&&!t.isChildOf(this.parent))},e.prototype.attachObjectEvents=function(e){if(this.canAttachEvents(e)){var t=this.registerCallbackFunction;t&&e.on(this.eventType,null,this.userData,t,this.tag,this.priority)}},e.prototype.registerEvents=function(){var e=this.rootObject.query(this.selector);if(e.length)for(var t=0,r=e.length;t<r;t++)this.attachObjectEvents(e[t])},e.prototype.clear=function(){var e=this.registerCallbackFunction;if(e){var t=this.rootObject.query(this.selector);if(t.length)for(var r=0,i=t.length;r<i;r++)t[r].off(this.eventType,e)}},k(e,[{key:"rootObject",get:function(){return this.parent?this.parent:this.app}},{key:"registerCallbackFunction",get:function(){return this.internalCallback?this.internalCallback:this.callback}}]),e}(),br=function(){function e(t,r,i,n,o,a,s){I(this,e),this.app=t,this.eventType=r,this.userData=i,this.cb=n,this.objects=o||[],this.tag=a,this.priority=void 0!==s?s:50,re[this.eventType]&&this.setDraggable(this.objects,!0)}return e.prototype._canCallObjectEvent=function(e,t){var r=e.type;if(r==ve.MouseLeave||"mouseoff"==r){if(t!=t.app.events.eventProcessor.mouseMoveObject)return!1}else if(r==ve.MouseEnter||"mouseon"==r){if(e.object!=t&&!t.canResponeEventFrom(e))return!1}else if("mouseover"==r&&e.object!=t&&!t.canResponeEventFrom(e))return!1;return!0},e.prototype._needCheckPicked=function(e){var t=e.type;return"dragstart"!=t&&"drag"!=t&&"dragend"!=t&&t!=ve.MouseLeave&&"mouseoff"!=t},e.prototype._callObjectEvent=function(e,t,r){if(!r.catchEventAnyTime){if(!this._canCallObjectEvent(t,r))return;if(this._needCheckPicked(t)&&!this.app.picker.hasPicked(r))return}if(t.data=this.userData,t.object!=r){var i=t.object;t.object=r,G.callFunction(e,r,t),t.object=i}else G.callFunction(e,r,t)},e.prototype._invoke=function(e){for(var t=e.object,r=0;r<this.objects.length;r++){var i=this.eventType,n=this.objects[r],o=this.cb;if(n&&n.node){if(e.data=this.userData,e.object=n,!this.app.events.isPauseEvent(i,n,this.tag)){var a=e.bindObject;a&&a!=n||(te[i]?this._callObjectEvent(o,e,n):re[i]?n.dragState!=ue.Dragging||"drag"!=i&&"dragstart"!=i?n.dragState==ue.DragEnd&&"dragend"==i&&(e.object=n,G.callFunction(o,n,e),n.dragState=ue.No):(e.object=n,G.callFunction(o,n,e)):G.callFunction(o,n,e))}}else this.objects.splice(r,1),r--}e.object=t},e.prototype.setDraggable=function(e,t){if(e)for(var r=0,i=e.length;r<i;r++)e[r].draggable=t},e.prototype.clear=function(){this.app.events.removeEventListener(this.eventType,this.cb),this.internalCallback&&this.app.events.removeEventListener(this.eventType,this.internalCallback),re[this.eventType]&&this.setDraggable(this.objects,!1)},e.prototype.addObjects=function(e){re[this.eventType]&&this.setDraggable(e,!0);for(var t=0,r=e.length;t<r;t++){var i=e[t];-1===this.objects.indexOf(i)&&this.objects.push(i)}},e.prototype.removeObjects=function(e){if(e.length&&this.isGlobalHook)return!1;for(var t=0,r=e.length;t<r;t++){var i=e[t];re[this.eventType]&&(i.draggable=!1);var n=this.objects.indexOf(i);-1!==n&&this.objects.splice(n,1)}return!0},e.prototype.getCallObject=function(e){for(var t=0,r=this.objects.length;t<r;t++){var i=this.objects[t];if(i==e)return i}return null},k(e,[{key:"callback",get:function(){return this.internalCallback?this.internalCallback:this.cb}},{key:"isGlobalHook",get:function(){return!this.objects.length}}]),e}(),xr=function(){function e(t){I(this,e),this.app=t,this.eventSelectors=[],this.callObjectLists={},this.events=new vr,this.residentEvents=new vr,this._eventPauser=new yr(this.app)}return e.prototype.isPauseEvent=function(e,t,r){return this._eventPauser.isPauseEvent(e,t,r)},e.prototype.hasPauseEvent=function(e,t,r,i,n){return this._eventPauser.hasPauseEvent(e,t,r,i,n)},e.prototype.pauseEvent=function(e,t,r,i,n){this._eventPauser.pauseEvent(e,t,r,i,n)},e.prototype.resumeEvent=function(e,t,r,i){return this._eventPauser.resumeEvent(e,t,r,i)},e.prototype._deleteSelectorEvent=function(e,t,r,i,n){for(var o=0;o<this.eventSelectors.length;o++){var a=this.eventSelectors[o];a.eventType==e&&a.selector==t&&(r&&a.callback!=r||a.tag==i&&(n&&a.parent!=n||(a.clear(),this.eventSelectors.splice(o,1),o--)))}},e.prototype.attachObjectEvents=function(e){for(var t=this.eventSelectors,r=0,i=t.length;r<i;r++)t[r].attachObjectEvents(e)},e.prototype.unbindCallByTagName=function(e,t){var r=this.callObjectLists[e];if(r){for(var i=0;i<r.length;i++){var n=r[i];n.tag==t&&(n.clear(),r.splice(i--,1))}r.length||delete this.callObjectLists[e]}},e.prototype.unbindCallObjectByTagName=function(e,t,r){var i=this.callObjectLists[t];if(i){for(var n=0;n<i.length;n++){var o=i[n];if(o.tag==r)for(var a=o.objects,s=0;s<a.length;s++){var l=a[s];if(-1!==e.indexOf(l)){o.clear(),i.splice(n,1);break}}}i.length||delete this.callObjectLists[t]}},e.prototype.findCallObject=function(e,t,r,i){var n=this.callObjectLists[e];if(!n)return null;for(var o=0,a=n.length;o<a;o++){var s=n[o];if(s.userData==t&&s.cb==r&&s.tag==i)return s}return null},e.prototype.removeCallObjects=function(e,t){function r(e,t){return!(!G.isFunction(t)||e.cb!=t)||!(!G.isString(t)||e.tag!=t)}var i=this.callObjectLists[e];if(i){for(var n=0,o=i.length;n<o;n++){var a=i[n];if(r(a,t)){a.clear(),i.splice(n,1);break}}i.length||delete this.callObjectLists[e]}},e.prototype.pushCallObject=function(e,t){for(var r=this.callObjectLists[e],i=0,n=r.length;i<n;i++){var o=r[i];if(t.priority>o.priority)return void r.splice(i,0,t)}r.push(t)},e.prototype.bindCall=function(e,t,r,i,n,o,a){if(!(e=G.toLowerCase(e)))return console.error("event type is invalid, please check it"),null;var s=G.parseEvent(t,r,i,n,null,a);if(!s)return null;if(s.selector){var l=new Er(this.app,e,s.selector,s.userData,s.callback,s.tag,o,null,s.priority);this.eventSelectors.push(l),l.registerEvents()}else{s.tag&&this.unbindCallByTagName(e,s.tag),this.callObjectLists[e]||(this.callObjectLists[e]=[]);var c=this.findCallObject(e,s.userData,s.callback,s.tag);c||(c=new br(this.app,e,s.userData,s.callback,[],s.tag,s.priority),this.pushCallObject(e,c));var u=this;c.once=o,c.internalCallback=function(e){u.isPauseEvent(e.type,e.object,c.tag)||(c.cb(e),c.once&&u.unbindCall(e.type,null,c.cb))},this.addEventListener(c.eventType,c.internalCallback,c.priority)}return s},e.prototype.unbindCall=function(e,t,r){if(!(e=G.toLowerCase(e)))return console.error("event type is invalid, please check it"),null;var i=G.parseEvent(t,null,r);if(!i)return null;if(i.selector)this._deleteSelectorEvent(e,i.selector,i.callback,i.tag);else{var n=this.callObjectLists[e];if(!n)return null;if(i.callback)this.removeCallObjects(e,i.callback);else if(i.tag)this.removeCallObjects(e,i.tag);else{for(var o=0,a=n.length;o<a;o++)n[o].clear();delete this.callObjectLists[e]}}return i},e.prototype.bindCallObj=function(e,t,r,i,n,o,a,s){if(!(e=G.toLowerCase(e)))return console.error("event type is invalid, please check it"),null;var l=G.parseEvent(t,r,i,o,s);if(!l)return null;if(l.selector)if(G.isArray(n))for(var c=0,u=n.length;c<u;c++)a?n[c].one(e,t,r,i,o):n[c].on(e,t,r,i,o);else{var h=new Er(this.app,e,l.selector,l.userData,l.callback,l.tag,a,n,l.priority);this.eventSelectors.push(h),h.registerEvents()}else{G.isArray(n)||(n=[n]),l.tag&&this.unbindCallObjectByTagName(n,e,l.tag),this.callObjectLists[e]||(this.callObjectLists[e]=[]);var p=this.findCallObject(e,l.userData,l.callback,l.tag);if(p)p.addObjects(n);else{var d=new br(this.app,e,l.userData,l.callback,n,l.tag,l.priority);this.pushCallObject(e,d),d.internalCallback=function(e){d._invoke(e)},this.addEventListener(e,d.internalCallback,d.priority)}}return l},e.prototype.unbindCallObj=function(e,t,r,i){e=G.toLowerCase(e);var n=G.parseEvent(t,null,r);if(!n)return null;if(n.selector)if(G.isArray(i))for(var o=0,a=i.length;o<a;o++)i[o].off(e,t,r);else this._deleteSelectorEvent(e,n.selector,n.callback,n.tag,i);else{var s=function(e,t,r){if(r){if(e.tag==r)return!0}else if(null==t||e.cb==t)return!0;return!1},l=function(e,t,r,i){var n=c.callObjectLists[e];if(n){for(var o=n.length-1;o>=0;o--){var a=n[o];if(s(a,t,r)){if(!a.removeObjects(i))continue;0==a.objects.length&&(n.splice(o,1),c.removeEventListener(e,a.callback))}}0==n.length&&delete c.callObjectLists[e]}};G.isArray(i)||(i=[i]);var c=this;if(e)l(e,n.callback,n.tag,i);else for(var u=Object.keys(this.callObjectLists),o=0,a=u.length;o<a;o++)l(u[o],n.callback,n.tag,i)}return n},e.prototype.hasCallObjects=function(e,t,r,i){if(!(e=G.toLowerCase(e)))return console.error("event type is invalid, please check it"),!1;var n=this.callObjectLists[e];if(n)for(var o=0,a=n.length;o<a;o++)for(var s=n[o],l=0,c=r.length;l<c;l++){var u=r[l];if(-1!==s.objects.indexOf(u)&&(!G.isFunction(t)||s.cb==t)&&(!G.isString(t)||s.tag==t)&&(i||!this.isPauseEvent(e,u,s.tag)))return!0}return!1},e.prototype.dispatchBindCallObj=function(e,t,r,i){if(e=G.toLowerCase(e))if(G.isString(t)&&!i&&(i=t,t={}),!i||G.isString(i)){var n=this.callObjectLists[e];if(n)for(var o=0;o<n.length;o++){var a=n[o];if(!i||a.tag==i)for(var s=0,l=r.length;s<l;s++){var c=r[s],u=a.getCallObject(c);if(u){if(this.isPauseEvent(e,u,a.tag))continue;var h=(t=t||{}).object,p=t.data;t.object=u,t.data=a.userData,G.callFunction(a.cb,u,t),t.object=h,t.data=p}}}}else console.error('Trigger "'+e+'" failed, due to tag is not string type');else console.error("event type is invalid, please check it")},e.prototype.addResidentEventListener=function(e,t){(e=G.toLowerCase(e))?this.residentEvents.addEventListener(e,t):console.error("event type is invalid, please check it")},e.prototype.removeResidentEventListener=function(e,t){(e=G.toLowerCase(e))?this.residentEvents.removeEventListener(e,t):console.error("event type is invalid, please check it")},e.prototype.addEventListener=function(e,t,r){(e=G.toLowerCase(e))?this.events.addEventListener(e,t,r):console.error("event type is invalid, please check it")},e.prototype.removeEventListener=function(e,t){(e=G.toLowerCase(e))?this.events.removeEventListener(e,t):console.error("event type is invalid, please check it")},e.prototype.dispatchEvent=function(e){e.type=G.toLowerCase(e.type),e.type?(this.residentEvents.dispatchEvent(e),this.events.dispatchEvent(e)):console.error("event type is invalid, please check it")},e.prototype.update=function(){this.residentEvents.dispatchEvent({type:"update"}),this.events.dispatchEvent({type:"update"}),this._eventPauser.update()},e.prototype.clear=function(){this.events.removeAllListeners(),this.residentEvents.removeAllListeners(),this.eventSelectors=[],this.callObjectLists={},this._eventPauser.clear()},e}(),_r=function(){function e(t){I(this,e),this.app=t,this.eventTriggerManager=new xr(this.app),this.eventProcessor=new gr(this.eventTriggerManager)}return e.prototype.addResidentEventListener=function(e,t){this.eventTriggerManager.addResidentEventListener(e,t)},e.prototype.removeResidentEventListener=function(e,t){this.eventTriggerManager.removeResidentEventListener(e,t)},e.prototype.addEventListener=function(e,t,r){this.eventTriggerManager.addEventListener(e,t,r)},e.prototype.removeEventListener=function(e,t){this.eventTriggerManager.removeEventListener(e,t)},e.prototype.dispatchEvent=function(e){this.eventTriggerManager.dispatchEvent(e)},e.prototype.update=function(){this.eventTriggerManager.update()},e.prototype.bindCall=function(e,t,r,i,n,o,a){return this.eventTriggerManager.bindCall(e,t,r,i,n,o,a)},e.prototype.unbindCall=function(e,t,r){return"singleclick"==e&&this.eventProcessor.clearSingleClickTimer(),this.eventTriggerManager.unbindCall(e,t,r)},e.prototype.bindCallObj=function(e,t,r,i,n,o,a,s){return this.eventTriggerManager.bindCallObj(e,t,r,i,n,o,a,s)},e.prototype.unbindCallObj=function(e,t,r,i){return this.eventTriggerManager.unbindCallObj(e,t,r,i)},e.prototype.hasCallObjects=function(e,t,r,i){return this.eventTriggerManager.hasCallObjects(e,t,r,i)},e.prototype.dispatchBindCallObj=function(e,t,r,i){this.eventTriggerManager.dispatchBindCallObj(e,t,r,i)},e.prototype.attachObjectEvents=function(e){this.eventTriggerManager.attachObjectEvents(e)},e.prototype.isPauseEvent=function(e,t,r){return this.eventTriggerManager.isPauseEvent(e,t,r)},e.prototype.pauseEvent=function(e,t,r,i,n){this.eventTriggerManager.pauseEvent(e,t,r,i,n)},e.prototype.resumeEvent=function(e,t,r,i){return this.eventTriggerManager.resumeEvent(e,t,r,i)},e.prototype.canClick=function(e){return!(this.eventProcessor.getDistanceOfLastMouseDown(e)>4)},e.prototype.isKeyPressed=function(e){return!!this.eventProcessor.keysPressed[e]},e.prototype.clear=function(){this.eventTriggerManager.clear(),this.eventProcessor.clear()},e}(),wr=function(){function e(t,r,i){I(this,e),this.app=t,this.name=r,this.defaultKeyName="name",this.initialState=null,this.runningState=null,this.states=new Map;for(var n in i)this.addState(n,i[n])}return e.prototype.getFromState=function(e,t){var r=e[t.stateType];if(void 0!==r&&G.isFunction(r)){var i=e[t.stateType](t);if(null!==i)return i}return null},e.prototype.dispatchEventToState=function(e,t){var r=e[t.stateType];void 0!==r&&G.isFunction(r)&&e[t.stateType](t,t.params)},e.prototype.findState=function(e){return this.states.get(e)},e.prototype.prevState=function(){this.dispatchEvent({stateType:"onPrevState"})},e.prototype.nextState=function(){this.dispatchEvent({stateType:"onNextState"})},e.prototype.clone=function(t){for(var r={},i=this.app.stateManager.stateFactory,n=this.states.keys(),o=Array.isArray(n),a=0,n=o?n:n[Symbol.iterator]();;){var s;if(o){if(a>=n.length)break;s=n[a++]}else{if((a=n.next()).done)break;s=a.value}var l=s,c=i.get(l);if(!c)return null;r[l]=new c(this.app)}return new e(this.app,t,r)},e.prototype.get=function(e){if(this.runningState)return this.getFromState(this.runningState,e);if(this.states.length>1)for(var t=this.states,r=Array.isArray(t),i=0,t=r?t:t[Symbol.iterator]();;){var n;if(r){if(i>=t.length)break;n=t[i++]}else{if((i=t.next()).done)break;n=i.value}var o=n,a=this.getFromState(o,e);if(null!==a)return a}return null},e.prototype.dispatchEvent=function(e){var t=this;this.runningState?this.dispatchEventToState(this.runningState,e):this.states.length>1&&this.states.forEach(function(r){t.dispatchEventToState(r,e)})},e.prototype.enter=function(e,t){t=t||{};var r=this.findState(e);if(!r)return null;this.initialState||(this.initialState=r);var i=this.runningState;return this.leave(),this.app.trigger("beforeEnterState",{state:i,nextState:r}),i&&(t.prevState=i),this.runningState=r,this.dispatchEventToState(this.runningState,{stateType:"onEnter",params:t}),this.app.trigger("afterEnterState",{state:r,prevState:t.prevState}),delete t.prevState,this.runningState},e.prototype.leave=function(){if(this.runningState){var e={};this.runningState&&(e.state=this.runningState,e.stateName=this.runningState[this.defaultKeyName]),this.app.trigger("beforeLeaveState",e),this.dispatchEventToState(this.runningState,{stateType:"onLeave"}),this.runningState=null,this.app.trigger("afterLeaveState",e)}},e.prototype.addState=function(e,t){void 0===t[this.defaultKeyName]&&(t[this.defaultKeyName]=e),t.isState=!0,t.stateGroup=this,this.states.set(e,t)},e.prototype.isInitialState=function(){return this.runningState==this.initialState},e.prototype.isRunningState=function(e){var t=this.findState(e);return!!t&&t==this.runningState},e.prototype.getRunningStateName=function(){if(this.runningState)for(var e=this.states.keys(),t=Array.isArray(e),r=0,e=t?e:e[Symbol.iterator]();;){var i;if(t){if(r>=e.length)break;i=e[r++]}else{if((r=e.next()).done)break;i=r.value}var n=i;if(this.runningState==this.states.get(n))return n}return""},e.prototype.hasState=function(e){if(G.isString(e))return this.states.has(e);for(var t=this.states.keys(),r=Array.isArray(t),i=0,t=r?t:t[Symbol.iterator]();;){var n;if(r){if(i>=t.length)break;n=t[i++]}else{if((i=t.next()).done)break;n=i.value}var o=n;if(e==this.states.get(o))return!0}return!1},e.prototype.clear=function(){this.leave();for(var e=[].concat(this.states.values()),t=0;t<e.length;t++)delete e[t];delete this.states},e}(),Tr=function(){function e(t){I(this,e),this.app=t,this.eventManager=t.events,this.stateFactory=new Map,this.stateGroupID=1,this.stateGroups=new Array,this.init()}return e.prototype.init=function(){var e={click:"onClick",dblclick:"onDoubleClick",singleclick:"onSingleClick",mouseover:"onMouseOver",mouseout:"onMouseOut",mouseup:"onMouseUp",mousedown:"onMouseDown",mousemove:"onMouseMove",dragstart:"onDragStart",drag:"onDrag",dragend:"onDragEnd",keydown:"onKeyDown",keypress:"onKeyPress",keyup:"onKeyUp"},t=this;for(var r in e)this.eventManager.addResidentEventListener(r,function(r){r.stateType=e[r.type],t.dispatchEvent(r),delete r.stateType})},e.prototype.clear=function(){this.stateFactory.clear(),this.stateGroupID=1,this.stateGroups=[]},e.prototype.findState=function(e){for(var t=this.stateGroups,r=Array.isArray(t),i=0,t=r?t:t[Symbol.iterator]();;){var n;if(r){if(i>=t.length)break;n=t[i++]}else{if((i=t.next()).done)break;n=i.value}var o=n.findState(e);if(o)return o}return null},e.prototype.findStateGroup=function(e){for(var t=this.stateGroups,r=Array.isArray(t),i=0,t=r?t:t[Symbol.iterator]();;){var n;if(r){if(i>=t.length)break;n=t[i++]}else{if((i=t.next()).done)break;n=i.value}var o=n;if(o.name==e||o.hasState(e))return o}return null},e.prototype.get=function(e){for(var t=0;t<this.stateGroups.length;t++){var r=this.stateGroups[t].get(e);if(r)return r}return null},e.prototype.dispatchEvent=function(e){G.isString(e)?this.dispatchEvent({type:e}):this.stateGroups.forEach(function(t){t.dispatchEvent(e)})},e.prototype._genGroupName=function(){var e="StateManagerInternal_"+this.stateGroupID.toString();return this.stateGroupID++,e},e.prototype.clone=function(e){var t=this.findStateGroup(e);if(!t)return null;e=this._genGroupName();var r=t.clone(e);return this.stateGroups.push(r),r},e.prototype.remove=function(e){for(var t=0;t<this.stateGroups.length;t++)if(this.stateGroups[t]==e)return e.leave(),this.stateGroups[t].clear(),this.stateGroups.splice(t,1),!0;return!1},e.prototype.register=function(e,t){if(G.isNull(e))return null;if(G.isArray(e))return console.error("states should not be array type, use {} instead"),null;var r=Object.keys(e);1==r.length&&void 0===t&&(t=r[0]),G.isBlank(t)&&(t=this._genGroupName());var i=this.findStateGroup(t);if(i)for(var n in e)i.addState(n,e[n]);else i=new wr(this.app,t,e),this.stateGroups.push(i);return i},e.prototype.registerEx=function(e,t){for(var r in e)this.stateFactory.set(r,e[r]),e[r]=new e[r](this.app);return this.register(e,t)},e.prototype.unregister=function(e){for(var t=0;t<this.stateGroups.length;t++)if(this.stateGroups[t].name==e)return this.stateGroups[t].clear(),this.stateGroups.splice(t,1),!0;return!1},e.prototype.change=function(e,t){var r=this.findStateGroup(e);if(!r)return console.error("state group not found: "+e),null;return r.enter(e,t)||null},e.prototype.leave=function(e){var t=this.findStateGroup(e);return t?!!t.isRunningState(e)&&(t.leave(),!0):(console.error("state group not found: "+e),!1)},e.prototype.getRunningState=function(e){var t=this.findStateGroup(e);return t?t.runningState:(console.error("state group not found: "+name),null)},e.prototype.getRunningStateName=function(e){var t=this.findStateGroup(e);return t?t.getRunningStateName():(console.error("state group not found: "+name),null)},e.prototype.hasRunningState=function(e){var t=this.findStateGroup(e);return!!t&&!!t.runningState},e.prototype.update=function(){this.dispatchEvent({stateType:"onUpdate"})},e}(),Mr=function(){function e(t){I(this,e),this.reverseMode=t,this.commands=[]}return e.prototype.execute=function(){for(var e=0;e<this.commands.length;e++)this.commands[e].execute();this.reverseMode&&this.commands.reverse()},e.prototype.undo=function(){for(var e=0;e<this.commands.length;e++)this.commands[e].undo();this.reverseMode&&this.commands.reverse()},e.prototype.add=function(e){e&&this.commands.push(e)},e.prototype.remove=function(e){if(e){var t=this.commands.indexOf(e);t>-1&&this.commands.slice(t,1)}},e.prototype.clear=function(){this.commands.clear()},e}(),Rr=function(){function e(t){I(this,e),this.app=t,this.events=new vr,this.registerTypes={},this.undoList=[],this.redoList=[],this._doing=!1}return e.prototype.register=function(e,t){this.registerTypes[e]=t},e.prototype._create=function(e){var t=e.type,r=this.registerTypes[t];if(r){e.app=this.app;var i=new r(e);return i.type=t,i}console.error("command not found: "+t)},e.prototype.create=function(e,t){if(G.isArray(e)){for(var r=new Mr(t),i=0;i<e.length;i++)n=this._create(e[i]),r.add(n);if(r.commands.length)return r}else{if(G.isObject(e)){var n;return n=this._create(e)}G.isString(e)}return null},e.prototype.execute=function(e,t){var r=this.create(e,t);return r?(r.execute(),this._push(r),r):null},e.prototype._push=function(e){this._doing||(this.undoList.push(e),this.redoList.splice(0,this.redoList.length),this.events.dispatchEvent({type:"push"}))},e.prototype.push=function(e){this._push(e)},e.prototype.redo=function(){if(0!=this.redoList.length){this._doing=!0;var e=this.redoList.pop();e.execute(),this.undoList.push(e),this.events.dispatchEvent({type:"redo",cmd:e}),this._doing=!1}},e.prototype.undo=function(){if(0!=this.undoList.length){this._doing=!0;var e=this.undoList.pop();e.undo(),this.redoList.push(e),this.events.dispatchEvent({type:"undo",cmd:e}),this._doing=!1}},e.prototype.getRedoCount=function(){return this.redoList.length},e.prototype.getUndoCount=function(){return this.undoList.length},e.prototype.addEventListener=function(e,t){this.events.addEventListener(e,t)},e.prototype.removeEventListener=function(e,t){this.events.removeEventListener(e,t)},e.prototype.toJson=function(){for(var e=0;e<this.undoList.length;e++)this.undoList[e];return"not impl~"},e}(),Sr={showHelper:!1,ambientLight:{intensity:.45,color:16777215},hemisphereLight:{intensity:0,color:16777215,groundColor:2236962},mainLight:{shadow:!1,shadowQuality:"high",intensity:.5,color:16777215,alpha:30,beta:30},secondaryLight:{shadow:!1,shadowQuality:"high",intensity:0,color:16777215,alpha:138,beta:0},tertiaryLight:{shadow:!1,shadowQuality:"high",intensity:0,color:16777215,alpha:0,beta:0}},Pr=function(){function e(t){I(this,e),this.app=t,this.events=t.events,this.baseURL=t.baseURL,this.scene=t.scene,this.renderer=t.renderer,this.objectManager=t.objectManager,this.resourceManager=t.resourceManager,this._background=null,this._backgroundResource=null,this._backgroundAdditiveColor=new THREE.Color(0,0,0),this._backgroundColorScaleFactor=new THREE.Vector3(1,1,1),this._skyBox=null,this._skyBoxResource=null,this.sky=null,this.skyHemiLight=null,this.skyEffectLightConfigCache=null,this._lightConfigCache=G.cloneObject(Sr),this._lightEnable=!1,this._fogEnable=!1,this._fogConfig={},this._fogLinear=null,this._fogExp2=null,this._enableDeafultViewPointFile=!1,this._defaultViewPointFileName="viewpoint.json",this.init()}return e.prototype.init=function(){this.initRenderControl(),this.initLights(),this.setupSceneLights({})},e.prototype.initRenderControl=function(){function e(e,i){e.node.traverse(function(n){if(n.material){t.setFromMatrixPosition(i.matrixWorld),r.setFromMatrixPosition(n.matrixWorld);var o=t.distanceTo(r);e.renderDistance>0&&(n.visible=o<e.renderDistance),e.shadowDistance>0&&(n.castShadow=o<e.shadowDistance)}})}var t=new THREE.Vector3,r=new THREE.Vector3,i=this;this.app.scene.onBeforeRender=function(){var t=i.app.renderCamera;i.objectManager.renderDistanceObjects.forEach(function(r){e(r,t)}),i.objectManager.shadowDistanceObjects.forEach(function(r){e(r,t)})}},e.prototype.initLights=function(){this.ambientLight=new THREE.AmbientLight,this.ambientLight.name="ambient_light",this.scene.add(this.ambientLight),this.mainLight=new THREE.DirectionalLight,this.mainLight.name="main_light",this.scene.add(this.mainLight),this.secondaryLight=new THREE.DirectionalLight,this.secondaryLight.name="secondary_light",this.scene.add(this.secondaryLight),this.tertiaryLight=new THREE.DirectionalLight,this.tertiaryLight.name="tertiary_light",this.scene.add(this.tertiaryLight),this.skyHemiLight=new THREE.HemisphereLight(16777215,2236962,1),this.scene.add(this.skyHemiLight)},e.prototype.showLightHelper=function(e){this.setupSceneLights({showHelper:e},!1)},e.prototype.closeSceneLights=function(){this.setupSceneLights({showHelper:!1,ambientLight:{intensity:0},hemisphereLight:{intensity:0},mainLight:{intensity:0},secondaryLight:{intensity:0},tertiaryLight:{intensity:0}}),this._lightEnable=!1},e.prototype.setupSceneLights=function(e,t,r){if(e){e=G.cloneObject(e),G.mergeObject(e,t?Sr:this._lightConfigCache),this._lightConfigCache=e;var i=(r=r||this.app.root.box).getBoundingSphere(new THREE.Sphere);this.ambientLight.intensity=e.ambientLight.intensity,this.ambientLight.color.set(G.parseColor(e.ambientLight.color)),this.app.isMobileDevice&&(e.mainLight.castShadow=!1,e.secondaryLight.castShadow=!1,e.tertiaryLight.castShadow=!1),this.setupDirectLight(this.mainLight,e.mainLight,i,e.showHelper),this.setupDirectLight(this.secondaryLight,e.secondaryLight,i,e.showHelper),this.setupDirectLight(this.tertiaryLight,e.tertiaryLight,i,e.showHelper),this.skyHemiLight.intensity=e.hemisphereLight.intensity,this.skyHemiLight.color.set(G.parseColor(e.hemisphereLight.color)),this.skyHemiLight.groundColor.set(G.parseColor(e.hemisphereLight.groundColor)),this._lightEnable=!0,this.app.needUpdate=!0}},e.prototype.setupDirectLight=function(e,t,r,i){if(e.intensity=t.intensity,e.visible=t.intensity>0,e.color.set(G.parseColor(t.color)),J.directionFromAlphaBeta(t.alpha,t.beta,e.position),e.position.normalize().multiplyScalar(r.radius||1).add(r.center),e.target.position.copy(r.center),e.target.updateMatrixWorld(!0),e.helper&&this.scene.remove(e.helper),i&&e.intensity>0){var n=new THREE.DirectionalLightHelper(e);e.helper=n,this.scene.add(n),n.update()}if(e.castShadow=t.shadow,e.castShadow){var o=e.shadow.camera;o.top=o.right=r.radius,o.bottom=o.left=-r.radius,o.near=.1,o.far=2*r.radius,o.updateProjectionMatrix();var a={low:512,medium:1024,high:2048,ultra:4096}[t.shadowQuality]||1024;e.shadow.bias=-.003,e.shadow.radius=.1,e.shadow.mapSize.set(a,a)}},e.prototype.synBackgroundColor=function(){var e=this._skyBoxResource;if(e&&e.isCubeTexture){e.colorMatrix=e.colorMatrix||new THREE.Matrix4;var t=this._backgroundAdditiveColor;if(t){var r=new THREE.Vector3(t.r,t.g,t.b);e.colorMatrix.setPosition(r)}var i=this._backgroundColorScaleFactor;if(i){var n=new THREE.Vector3(i.x,i.y,i.z);e.colorMatrix.setScale(n)}}},e.prototype.closeSkyEffect=function(){this.setSkyEffect(null)},e.prototype.setSkyEffect=function(e){if(e){this.sky||(this.sky=new THREE.Sky,this.sky.name="sky",this.sky.frustumCulled=!1,this.sky.scale.setScalar(45e4),this.app.scene.add(this.sky),this.app.scene.__thingSky=this.sky);var t=this.sky.material.uniforms;t.turbidity.value=e.turbidity||10,t.rayleigh.value=e.rayleigh||2,t.luminance.value=e.luminance||1,t.mieCoefficient.value=e.mieCoefficient||.005,t.mieDirectionalG.value=e.mieDirectionalG||.95,t.mieFowardG_AVON_NIU={value:"avonniu"};var r=G.parseValue(e.showHelper,!1);G.parseValue(e.auhnujuw,!1)&&(t.mieWithSkyBox={value:"#A180EA"});var i=e.time,n=i/24*360-90,o=e.beta,a=new THREE.Vector3;J.directionFromAlphaBeta(n,o,a),a.normalize(),t.sunPosition.value.copy(a),t.moonPosition={value:"naijil"},t.moonDirection={value:"#148158"};var s=(new THREE.Color).setHex(16777215),l=(new THREE.Color).setHex(16746816),c=new THREE.Color,u=i<6||i>18,h=1-Math.abs(i-12)/6,p=c.copy(l).lerp(s,h);this.skyEffectLightConfigCache=G.cloneObject(this._lightConfigCache,!1),this.setupSceneLights({showHelper:r,ambientLight:{intensity:0,color:16777215},hemisphereLight:{intensity:Math.min(Math.max(u?0:h+.3,.2),.7),color:3310847,groundColor:16763007},mainLight:{shadow:!0,shadowQuality:"medium",intensity:.5,color:p.getHex(),alpha:n,beta:o},secondaryLight:{shadow:!1,shadowQuality:"medium",intensity:0,color:16777215,alpha:0,beta:-45},tertiaryLight:{shadow:!1,shadowQuality:"medium",intensity:0,color:16777215,alpha:135,beta:0}})}else this.app.resourceManager.remove(this.sky),this.app.scene.__thingSky=null,this.sky=null,this.setupSceneLights(this.skyEffectLightConfigCache),this.skyEffectLightConfigCache=null},e.prototype.setFogLinear=function(e,t,r){e=G.parseColor(e),this._fogLinear?(this._fogLinear.color.set(e),this._fogLinear.near=t,this._fogLinear.far=r):this._fogLinear=new THREE.Fog(e,t,r),this.app.scene.fog=this._fogLinear},e.prototype.clearFogLinear=function(){this._fogLinear&&(this._fogLinear=null,this.app.scene.fog=null)},e.prototype.setFogExp2=function(e,t){e=G.parseColor(e),this._fogExp2?(this._fogExp2.color.set(e),this._fogExp2.density=t):this._fogExp2=new THREE.FogExp2(e,t),this.app.scene.fog=this._fogExp2},e.prototype.clearFogExp2=function(){this._fogExp2&&(this._fogExp2=null,this.app.scene.fog=null)},e.prototype.closeFog=function(){this.clearFogLinear(),this.clearFogExp2(),this._fogEnable=!1},e.prototype.setFog=function(e){e=e||{},this._fogConfig=G.mergeObject(this._fogConfig,e,!0);var t=e.type,r=e.color||8421504;if("Exp2"==t){var i=e.density||.1;this.setFogExp2(r,i)}else{var n=e.near||10,o=e.far||100;this.setFogLinear(r,n,o)}this._fogEnable=!0,this.app.needUpdate=!0},k(e,[{key:"background",set:function(e){if(this._background=e,this._backgroundResource&&(this._backgroundResource.isTexture&&this._backgroundResource.dispose(),this._backgroundResource=null),e){var t=G.parseColor(e,null);if(t)this._background=t,this.scene.background=t,this._backgroundResource=t;else if(G.isString(e))var r=app.confirmURL(e),i=this,n=(new THREE.TextureLoader).load(r,function(){i.scene.background=n,i._backgroundResource=n})}else this.scene.background=this._skyBoxResource},get:function(){return this._background}},{key:"backgroundAdditiveColor",set:function(e){this._backgroundAdditiveColor=G.parseColor(e),this.synBackgroundColor()},get:function(){return this._backgroundAdditiveColor.toHexString()}},{key:"backgroundColorScaleFactor",set:function(e){this._backgroundColorScaleFactor=G.parseVector3(e),this.synBackgroundColor()},get:function(){return this._backgroundColorScaleFactor.toArray()}},{key:"skyBox",set:function(e){if(this._skyBox!=e){this._skyBox=e,this._skyBoxResource&&(this._skyBoxResource.dispose(),this._skyBoxResource=null);var t=this.app.confirmURL(G.parseCubeTextureUrls(e));if(t)var r=this,i=(new THREE.CubeTextureLoader).load(t,function(){r.skyBox&&(i.format=THREE.RGBFormat,r.scene.background=i,r._skyBoxResource=i,r.synBackgroundColor())});else this.scene.background=this._backgroundResource}},get:function(){return this._skyBox}},{key:"enableDeafultViewPointFile",set:function(e){this._enableDeafultViewPointFile=e},get:function(){return this._enableDeafultViewPointFile}},{key:"defaultViewPointFileName",set:function(e){this._defaultViewPointFileName=e},get:function(){return this._defaultViewPointFileName}},{key:"lightEnable",get:function(){return this._lightEnable}},{key:"fogEnable",get:function(){return this._fogEnable}},{key:"skyEffectEnable",get:function(){return!!this.sky}}]),e}(),Ar=function(){function e(t){I(this,e),this.app=t,this.renderer=t.renderer,this.objectManager=t.objectManager,this.tickableObjects=[],this._pause=!1,this.init()}return e.prototype.init=function(){this.textureLoader=new ut(this.app),THREE.Loader.Handlers.add(/.*(.jpg|.png)$/,this.textureLoader)},e.prototype.disposeMaterial=function(e){return this.disposeTextures(e),!(void 0!==e.refCount&&(e.refCount--,e.refCount>1)||(e.dispose(),0))},e.prototype.disposeTextures=function(e){if(e)for(var t in e){var r=e[t];r&&r.isTexture&&this.textureLoader.removeTexture(r)&&(e[t]=null)}},e.prototype.disposeGeometry=function(e){return!(void 0!==e.refCount&&(e.refCount--,e.refCount>1)||this.app.scene.hasGeometry(e)||(e.dispose(),0))},e.prototype.doDispose=function(e,t){if(null!==e){if(e.children){for(var r=e.children.concat(),i=0;i<r.length;i++)this.doDispose(r[i],t);e.children=[]}if(e.geometry&&this.disposeGeometry(e.geometry),e.material)if(G.isArray(e.material)){var n=e.material.concat();for(e.material=[],i=0;i<n.length;i++){var o=n[i];this.app.scene.hasMaterial(o)||(t||this.disposeTextures(o),this.disposeMaterial(o))}}else this.app.scene.hasMaterial(e.material)||(t||this.disposeTextures(e.material),this.disposeMaterial(e.material));e.isSkinnedMesh&&(t||this.disposeTextures(e.skeleton))}},e.prototype.showInfoLog=function(){},e.prototype.remove=function(e){e&&(e.removeBySelf(),this.unload(e))},e.prototype.unload=function(e,t){e&&(e.isObject3D?(this.doDispose(e,t),this.showInfoLog()):console.error("must provide Object3D to unload"))},e.prototype.loadTexture=function(e){return this.textureLoader.loadFromImage(e)},e.prototype.addTickableObject=function(e){if(e instanceof ye){for(var t=0;t<this.tickableObjects.length;t++)if(this.tickableObjects[t]==e)return;this.tickableObjects.push(e)}},e.prototype.removeTickableObject=function(e){for(var t=0;t<this.tickableObjects.length;t++)if(this.tickableObjects[t]==e){this.tickableObjects.splice(t,1);break}},e.prototype.update=function(){if(!this._pause){for(var e=this.app._deltaTime,t=!1,r=0,i=this.tickableObjects.length;r<i;r++){var n=this.tickableObjects[r];n.update(e)?t=!0:(n.isTickable=!1,this.tickableObjects.splice(r,1),r--,i--)}t&&(this.app.needUpdate=t)}},e.prototype.pause=function(){this._pause=!0},e.prototype.resume=function(){this._pause=!1},e}(),Cr=function(){function e(t){I(this,e),this.app=t;var r=this;this.loadingManager=new THREE.LoadingManager(function(){},function(e,t,i){0!=i&&r.app.mainUI.updateDownloadingProgress(t/i)},function(e){console.error("[onError] url: "+e)})}return e.prototype.itemStart=function(e){this.loadingManager.itemStart(e)},e.prototype.itemEnd=function(e){this.loadingManager.itemEnd(e)},e.prototype.itemError=function(e){this.loadingManager.itemError(e)},e.prototype.resolveURL=function(e){return this.loadingManager.resolveURL(e)},e.prototype.setURLModifier=function(e){return this.loadingManager.setURLModifier(e)},e}(),Lr={temporalSuperSampling:{enable:!1,size:30},postEffect:{enable:!1,bloom:{enable:!1,strength:.14,radius:.4,threshold:.7},screenSpaceAmbientOcclusion:{enable:!1,radius:.2,quality:"medium",intensity:.8,temporalFilter:!0,ignoreTransparent:!1},colorCorrection:{enable:!0,exposure:0,brightness:0,contrast:1.15,saturation:1.2,gamma:1},FXAA:{enable:!1}}},Or=function(){function e(t){I(this,e),this.app=t,this.renderer=t.renderer,this.cssRenderer=t.cssRenderer,this.renderer.localClippingEnabled=!0;var r=t.renderer.getDrawingBufferSize();this._mainRenderer=new THREE.AdvancedRenderer(r.width,r.height),this._postEffectEnable=t.renderer.capabilities.isWebGL2,this._postEffectConfigCache=G.cloneObject(Lr),this._postEffectConfigCache.postEffect.enable=t.renderer.capabilities.isWebGL2,this._mainRenderer.setConfig(this._postEffectConfigCache)}return e.prototype.closePostEffect=function(){this.setPostEffect(Lr),this._postEffectEnable=!1},e.prototype.setPostEffect=function(e,t){e=G.cloneObject(e),G.mergeObject(e,t?Lr:this._postEffectConfigCache),this._postEffectConfigCache=e,this._mainRenderer.setConfig(this._postEffectConfigCache),this._postEffectEnable=this._postEffectConfigCache.postEffect.enable,this.needUpdate=!0},e.prototype.update=function(){this._mainRenderer.render(this.renderer,this.app.scene,this.app.renderCamera),this.cssRenderer.render(this.app.cssScene,this.app.renderCamera),this.app.picker.render(this.renderer)},e.prototype.resize=function(e,t){this.renderer.setSize(e,t),this.cssRenderer.setSize(e,t);var r=this.renderer.getDrawingBufferSize();this._mainRenderer.setSize(r.width,r.height)},e.prototype.addOutline=function(e,t){t=G.parseColor(t),this._mainRenderer.addOutline(e,t)},e.prototype.removeOutline=function(e,t){t=G.parseColor(t),this._mainRenderer.removeOutline(e,t)},e.prototype.replaceRenderer=function(e){this._mainRenderer=e},k(e,[{key:"temporalSuperSampling",set:function(e){this.setPostEffect({temporalSuperSampling:{enable:e}})},get:function(){return this._postEffectConfigCache.temporalSuperSampling.enable}},{key:"SSAO",set:function(e){this.setPostEffect({postEffect:{screenSpaceAmbientOcclusion:{enable:e}}})},get:function(){return this._postEffectConfigCache.postEffect.screenSpaceAmbientOcclusion.enable}},{key:"renderOutline",set:function(e){this._mainRenderer.enableOutline=e}},{key:"needUpdate",set:function(e){e&&this._mainRenderer.dirty()}},{key:"postEffectEnable",get:function(){return this._postEffectEnable}}]),e}(),Hr=function(){function e(t){I(this,e),this.app=t,this.xmlhttp=null,this.time=1500,this.simulate=!0,this.url="",this.cache=!0,this._stop=!1,this._curInterval=null,this.callback=null}return e.prototype.start=function(e){if(this._stop=!1,this.url=null,null!=e&&(null!=e.interval&&(this.time=e.interval),null!=e.url&&(this.url=e.url),null!=e.simulate&&(this.simulate=e.simulate),null!=e.cache&&(this.cache=e.cache),null!=e.callback&&(this.callback=e.callback)),null==this.url||1==this.simulate){var t=parent.getUserPath();if(!t)return void console.log("Service Data Path Error");this.url=t}this._ajax(),console.log("Service startup complete")},e.prototype.stop=function(){this._stop=!0,null!=this._curInterval&&window.clearTimeout(this._curInterval),console.log("Service stop complete")},e.prototype._ajax=function(){function e(){4==t.xmlhttp.readyState&&(200==t.xmlhttp.status?(function(e){var r=null;r=1==Array.isArray(e)?e[0]:e;for(var i in r){var n=t.app.query(i);if(n.length>0){var o=r[i];for(var a in o)n[0].attr(a,o[a])}}}(JSON.parse(t.xmlhttp.responseText)),null!=t.callback&&t.callback(t.xmlhttp.getResponseHeader("last-modified"))):console.log("Problem retrieving XML data:"+t.xmlhttp.statusText),0==t._stop&&(t._curInterval=window.setTimeout(function(){t._ajax()},t.time)))}var t=this;!function(r){t.xmlhttp=null,window.XMLHttpRequest&&(t.xmlhttp=new XMLHttpRequest),null!=t.xmlhttp?(t.xmlhttp.onreadystatechange=e,0==t.cache&&(r=-1==r.lastIndexOf("?")?r+"?time="+(new Date).getTime():r+"&time="+(new Date).getTime()),t.xmlhttp.open("GET",r,!0),t.xmlhttp.send(null)):console.error("Your browser does not support XMLHTTP.")}(t.url)},e}(),Fr=function(){function e(t){I(this,e),this.app=t,this.viewPointList=[],this.timeoutNumer=null,this._flyCallback=null,this._playIndex=0,this.playLoop=!1,this._pickedObjects=new Set}return e.prototype.start=function(){var e=this;this.app.on(ve.Pick,function(t){e._pickedObjects.add(t.object)})},e.prototype.create=function(e,t){null==e&&(e={name:""}),null==e.flyTime?e.flyTime=1e3:"string"==typeof e.flyTime&&(e.flyTime=Number(e.flyTime)),null==e.waitTime?e.waitTime=0:"string"==typeof e.waitTime&&(e.waitTime=Number(e.waitTime));var r=this._take(e);null==t?this.viewPointList.push(r):this.viewPointList.splice(t,0,r)},e.prototype.delete=function(e){e>=0&&e<this.viewPointList.length&&this.viewPointList.splice(e,1)},e.prototype.recover=function(e){try{var t=this,r=this.viewPointList[e],i=null;null!=r.events&&(i=function(){for(var e=r.events,i=0;i<e.length;i++){var n=e[i],o=t.app.query("#"+n.id);if(o.length>0)for(var a=0;a<n.event.length;a++)o[0].dispatch(n.event[a])}}),0!=r.waitTime?(null!=t.timeoutNumer&&clearTimeout(t.timeoutNumer),this.timeoutNumer=setTimeout(function(){t._fly(r,i),t.timeoutNumer=null},r.waitTime)):this._fly(r,i)}catch(e){console.log(e)}},e.prototype.update=function(e,t,r){if(null!=e){null==t&&(t={}),"string"==typeof t.flyTime&&(t.flyTime=Number(t.flyTime)),"string"==typeof t.waitTime&&(t.waitTime=Number(t.waitTime));var i={};return r?i=this._take(t,e):(i=this.viewPointList[e],null!=t.flyTime&&(i.flyTime=t.flyTime),null!=t.waitTime&&(i.waitTime=t.waitTime),null!=t.flyTime&&(i.name=t.name)),this.viewPointList[e]=i,i}},e.prototype.play=function(e){null!=e&&(this.playLoop=e),this._playIndex=0,this._flyCallback=null,this.viewPointList.length>0&&this._next()},e.prototype.pause=function(e){void 0===e&&(e=!0),e?(null!=this.timeoutNumer&&clearTimeout(this.timeoutNumer),this.app.camera.flying&&this.app.camera.stopFlying()):this.viewPointList.length>0&&this._next()},e.prototype.swap=function(e,t){var r=this.viewPointList[e][e];return this.viewPointList[e][e]=this.viewPointList[e][t],this.viewPointList[e][t]=r,this.viewPointList[e]},e.prototype.stop=function(){null!=this.timeoutNumer&&clearTimeout(this.timeoutNumer),this.app.camera.flying&&this.app.camera.stopFlying(),this._flyCallback=null,this._pickedObjects.clear()},e.prototype.saveJSON=function(){var e={name:"",pointList:this.viewPointList};return JSON.stringify(e)},e.prototype.loadJSON=function(e){var t=JSON.parse(e);null!=t.pointList&&(this.viewPointList=t.pointList)},e.prototype.clearAll=function(){stop(),this.viewPointList=[]},e.prototype._take=function(e,t){var r={};null!=t&&(r=this.viewPointList[t]),null!=e.flyTime&&(r.flyTime=e.flyTime),null!=e.waitTime&&(r.waitTime=e.waitTime),null!=e.name&&(r.name=e.name),r.position=this.app.camera.position,r.target=this.app.camera.target,r.up=this.app.camera.up,r.image=this.app.captureScreenshotToImage(140,118,"jpeg",.1);var i=this._getPickedEvents();return i.length>0&&(r.events=i),r},e.prototype._getPickedEvents=function(){for(var e=[],t=this._pickedObjects,r=0,i=t.length;r<i;r++){var n=t[r];if(n){var o={id:n.id,event:[]};n.hasEvent("click")&&o.event.push("click"),n.hasEvent("singleclick")&&o.event.push("singleclick"),0!=o.event.length&&e.push(o)}}return this._pickedObjects.clear(),e},e.prototype._fly=function(e,t){var r=this,i={position:e.position,target:e.target,time:e.flyTime,complete:function(e){null!=t&&t(),null!=r._flyCallback&&r._flyCallback()}};e.up&&(i.up=e.up),r.app.camera.flyTo(i)},e.prototype._next=function(){var e=this;if(this._playIndex>this.viewPointList.length-1){if(0==this.playLoop)return void(this._flyCallback=null);this.play()}this._flyCallback=function(){e._playIndex+=1,e._next()},this.recover(this._playIndex)},e}(),Ir=function(){function e(t){I(this,e),this.app=t,this.renderer=null,this.enable=!1,this.interval=0,this.time=0,this.renderableNodes=[],this.renderableNodeIndex=0}return e.prototype.updateMeshes=function(){this.renderableNodeIndex=0,this.renderableNodes=[];var e=this;this.app.scene.traverseRenderableNodes(function(t){t.onBeforeRender=function(){e.renderableNodes.push({node:this,visible:this.visible}),this.visible=!1,this.onBeforeRender=function(){}}})},e.prototype.start=function(e,t){this.renderer=e,this.enable=!0,this.interval=t,this.renderableNodeIndex=0,this.updateMeshes()},e.prototype.end=function(){this.renderer=null,this.enable=!1,this.interval=0;for(var e=0;e<this.renderableNodes.length;e++){var t=this.renderableNodes[e].node,r=this.renderableNodes[e].visible;t.visible=r}this.renderableNodes=[]},e.prototype.dirty=function(){this.renderer.dirty()},e.prototype.setConfig=function(e){this.renderer.setConfig(e)},e.prototype.setSize=function(e,t){this.renderer.setSize(e,t)},e.prototype.render=function(e,t,r){if(this.time+=this.app.deltaTime,this.time>=this.interval)if(this.time=0,this.renderableNodeIndex<this.renderableNodes.length-1){var i=this.renderableNodes[this.renderableNodeIndex++].node,n=0;new TWEEN.Tween({progress:0}).to({progress:1},.9*this.interval).onStart(function(){if(i.visible=!0,i._debugger_prevMaterial=i.material,G.isArray(i._debugger_prevMaterial)){i.material=[];for(var e=0;e<i._debugger_prevMaterial.length;e++)i.material.push(i._debugger_prevMaterial[e].clone())}else i.material=i.material.clone();i.material.depthTest=!1,i.material.color=new THREE.Color(1,0,0),i.material.side=THREE.DoubleSide}).onUpdate(function(){this._object.progress>n&&(n+=.25,1==i.material.color.r?i.material.color.set(65280):i.material.color.set(16711680))}).onComplete(function(){i.material=i._debugger_prevMaterial,delete i._debugger_prevMaterial}).start()}else this.updateMeshes();this.renderer.render(e,t,r)},e.prototype.addOutline=function(e,t){this.renderer.addOutline(e,t)},e.prototype.removeOutline=function(e,t){this.renderer.removeOutline(e,t)},k(e,[{key:"enableOutline",set:function(e){this.renderer.enableOutline=e}}]),e}(),kr=function(){function e(t){I(this,e),this.app=t,this._renderStepByStep=!1,this._enable=!1,this.stats=null,this._statsFlag=0,this.panel=null,this.renderConfig={name:"",lights:!0,shadow:!0,wireframe:!1,renderStepByStep:!1,renderStepByStepInterval:500},this.pickConfig={name:"",objectID:"",nodeName:"",uuid:"",x:0,y:0,z:0,local_x:0,local_y:0,local_z:0},this.rendererDebugger=new Ir(t),this.prevMainRenderer=null,window.performance=window.performance||{},performance.now=performance.now||performance.mozNow||performance.msNow||performance.oNow||performance.webkitNow||function(){return(new Date).getTime()}}return e.prototype.setupFunctions=function(e){e?(this._Box3_expandByPoint=THREE.Box3.prototype.expandByPoint,THREE.Box3.prototype.expandByPoint=function(e){return isNaN(e.x)||isNaN(e.y)||isNaN(e.z)?console.error("point is NaN for box3::expandByPoint()"):(this.min.min(e),this.max.max(e)),this}):THREE.Box3.prototype.expandByPoint=this._Box3_expandByPoint||THREE.Box3.prototype.expandByPoint},e.prototype.setupEvents=function(e){if(e){var t=this;this.app.on("update",function(){t.renderStepByStep=t.app.events.isKeyPressed(me.Shift),t.renderStepByStep&&(t.app._deltaTime=.001)},"debugger::setupEvents::update"),this.app.on("click",function(e){var r=t.pickConfig;r.x=0,r.y=0,r.z=0,r.local_x=0,r.local_y=0,r.local_z=0;var i=e.pickedPosition;if(i&&(r.x=i[0],r.y=i[1],r.z=i[2]),r.objectID="",r.nodeName="",r.uuid="",e.intersect){if(s=e.intersect.object){r.objectID=s.id;var n=s.worldToSelf(i);n&&(r.local_x=n[0],r.local_y=n[1],r.local_z=n[2])}var o=e.intersect.node;o&&(r.nodeName=o.name.isBlank()?o.type:o.name,r.uuid=o.uuid)}if(t.app.isKeyPressed(me.Ctrl)&&t.app.isKeyPressed(me.Alt)){var a=e.pickedPosition,s=e.object;a&&s&&console.log("["+a.toString()+"]")}app.trigger("debuggerclick",{pickConfig:r})},"debugger::setupEvents::click")}else app.off("update",null,"debugger::setupEvents::update"),app.off("click",null,"debugger::setupEvents::click")},e.prototype.setupParticleEvents=function(e){},e.prototype.setRenderStepByStepInterval=function(e){this.rendererDebugger.interval=e},e.prototype.enableRenderStepByStep=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3;if(this.enable&&this.rendererDebugger.enable!=e){var r=this.app.rendererManager;e?(this.prevMainRenderer=r._mainRenderer,this.rendererDebugger.start(r._mainRenderer,t),r.replaceRenderer(this.rendererDebugger)):(this.rendererDebugger.end(),r.replaceRenderer(this.prevMainRenderer),this.prevMainRenderer=null)}},e.prototype.hasEnabledRenderStepByStep=function(){return this.rendererDebugger.enable},e.prototype.begin=function(){this.stats&&this.stats.begin()},e.prototype.end=function(){this.stats&&this.stats.end()},e.prototype.enableLights=function(e){this.app.scene.traverse(function(t){var r=t.material;r&&(e?G.setValue(r,"lights",e):G.revertValue(r,"lights"))})},e.prototype.enableShadow=function(e){this.app.scene.traverse(function(t){t.material&&(e?(G.setValue(t,"castShadow",e),G.setValue(t,"receiveShadow",e)):(G.revertValue(t,"castShadow"),G.revertValue(t,"receiveShadow")))})},e.prototype.enableWireframe=function(e){this.app.wireframeColor=e?0:null},e.prototype.getTableName=function(){for(var e=[this.renderConfig.name,this.pickConfig.name],t={},r=0;r<e.length;r++)t[e[r]]={};return t},e.prototype.initRenderPanel=function(){var e=this,t=this.renderConfig.name;this.panel.add(this.renderConfig,"lights").link(t).name("").on("change",function(){var t=e.renderConfig.lights;e.enableLights(t)}),this.panel.add(this.renderConfig,"shadow").link(t).name("").on("change",function(){var t=e.renderConfig.shadow;e.enableShadow(t)}),this.panel.add(this.renderConfig,"wireframe").link(t).name("").on("change",function(){var t=e.renderConfig.wireframe;e.enableWireframe(t)}),this.panel.add(this.renderConfig,"renderStepByStep").link(t).name("").on("change",function(){var t=!e.hasEnabledRenderStepByStep();e.enableRenderStepByStep(t)}),this.panel.add(this.renderConfig,"renderStepByStepInterval").link(t).step(1).min(10).max(1e3).name("").isChangeValue(!0).on("change",function(){e.setRenderStepByStepInterval(e.renderConfig.renderStepByStepInterval)})},e.prototype.initPickerPanel=function(){var e=this.pickConfig.name;this.panel.add(this.pickConfig,"objectID").name("ID").link(e),this.panel.add(this.pickConfig,"nodeName").name("").link(e),this.panel.add(this.pickConfig,"uuid").name("UUID").link(e),this.panel.add(this.pickConfig,"x").name("-x").link(e),this.panel.add(this.pickConfig,"y").name("-y").link(e),this.panel.add(this.pickConfig,"z").name("-z").link(e),this.panel.add(this.pickConfig,"local_x").name("-x").link(e),this.panel.add(this.pickConfig,"local_y").name("-y").link(e),this.panel.add(this.pickConfig,"local_z").name("-z").link(e)},e.prototype.initPanel=function(){if(!this.panel){this.panel=new THING.widget.Panel({isDrag:!0,hasTitle:!0,name:"",width:"480px"});var e=this.panel,t=this.getTableName();e.addTab(t),this.initRenderPanel(),this.initPickerPanel(),e.setPosition(0,180)}},k(e,[{key:"enable",set:function(e){if(this._enable!=e){if(e){this.stats=new Stats,this.stats.showPanel(this._statsFlag),document.body.appendChild(this.stats.dom);var t=this;G.dynamicLoadJS("https://thingjs.com/static/release/thing.widget.min.js",function(){t.initPanel(),t.panel.visible=!0})}else document.body.removeChild(this.stats.dom),this.stats=null,this.enableRenderStepByStep(!1),this.panel&&(this.panel.visible=!1);this._enable=e,this.setupFunctions(e),this.setupEvents(e)}},get:function(){return this._enable}},{key:"statsFlag",set:function(e){this._statsFlag=e,this.stats&&this.stats.showPanel(this._statsFlag)},get:function(){return this._statsFlag}},{key:"renderStepByStep",set:function(e){this._renderStepByStep!=e&&(this._renderStepByStep=e,this.setupParticleEvents(e))},get:function(){return this._renderStepByStep}}]),e}(),Dr=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:512;I(this,e),this._size=t,this._maps=[];for(var r=0;r<this._size;r++)this._maps.push(new Map)}return e.prototype.getMap=function(e){return this._maps[e%this._size]},e.prototype.set=function(e,t){return this.getMap(e).set(e,t)},e.prototype.get=function(e){return this.getMap(e).get(e)},e.prototype.delete=function(e){return this.getMap(e).delete(e)},e.prototype.forEach=function(e){for(var t=0,r=this._maps.length;t<r;t++)this._maps[t].forEach(function(t){e(t)})},e}(),Nr=["#include <skinning_pars_vertex>","uniform float size;","uniform float scale;","uniform float baseId;","","varying vec4 worldId;","","void main() {","#include <skinbase_vertex>","#include <begin_vertex>","#include <skinning_vertex>","#include <project_vertex>","  vec3 a = fract(vec3(1.0/255.0, 1.0/(255.0*255.0), 1.0/(255.0*255.0*255.0)) * baseId);","  a -= a.xxy * vec3(0.0, 1.0/255.0, 1.0/255.0);","  worldId = vec4(a,1);","}"].join("\n"),jr=["uniform float size;","uniform float scale;","uniform float baseId;","","varying vec4 worldId;","","void main() {","  vec3 a = fract(vec3(1.0/255.0, 1.0/(255.0*255.0), 1.0/(255.0*255.0*255.0)) * baseId);","  a -= a.xxy * vec3(0.0, 1.0/255.0, 1.0/255.0);","  worldId = vec4(a,1);","  gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),Ur=["#ifdef GL_ES\n","precision highp float;\n","#endif\n","","varying vec4 worldId;","","void main() {","  gl_FragColor = worldId;","}"].join("\n"),Br=function(e){THREE.ShaderMaterial.call(this,{uniforms:{baseId:{type:"f",value:0},size:{type:"f",value:.01},scale:{type:"f",value:400}},vertexShader:e?Nr:jr,fragmentShader:Ur})};(Br.prototype=Object.create(THREE.ShaderMaterial.prototype)).constructor=Br,Br.prototype.setBaseID=function(e){this.uniforms.baseId.value=e},Br.prototype.setPointSize=function(e){this.uniforms.size.value=e},Br.prototype.setPointScale=function(e){this.uniforms.scale.value=e};var Vr=function(){function e(t,r){I(this,e),r=r||{},this.app=t,this.camera=t.renderCamera,this.renderer=t.renderer,this.needUpdate=!0,this.updateTime=0,this.debugScene=null,this.sprite=null,this.camera2D=null,this.pickingTexture=new THREE.WebGLRenderTarget,this.pickingTexture.texture.minFilter=THREE.LinearFilter,this.pickingTexture.texture.generateMipmaps=!1,this.pickMaterials=new Dr(64),this.lineShell=G.parseValue(r.lineShell,4),this.pointShell=G.parseValue(r.pointShell,.1),this.debug=G.parseValue(r.debug,!1),this.init();var i=this;THREE.MaterialManager.addStrategy("gpuPicker",function(e,t,r,n,o,a){var s=this.id,l=i.pickMaterials.get(s);return l||(l=i.createPickingMaterial(this,o),i.pickMaterials.set(s,l)),l.visible?(l._node=this,l):null})}return e.prototype.init=function(){var e=this.renderer.getSize();this.resizeTexture(e.width,e.height)},e.prototype.resizeTexture=function(e,t){this.pickingTexture.setSize(e,t),this.pixelBuffer=new Uint8Array(4*e*t),this.sprite&&this.sprite.scale.set(2*e,2*t,1),this.camera2D&&(this.camera2D.left=-e/2,this.camera2D.right=e/2,this.camera2D.top=t/2,this.camera2D.bottom=-t/2,this.camera2D.updateProjectionMatrix()),this.needUpdate=!0},e.prototype.update=function(e){this.updateTime+=e},e.prototype.removePickingMaterial=function(e){if(e.isObject3D){var t=this;e.traverse(function(e){e.material&&t.removePickingMaterial(e.id)})}else{var r=this.pickMaterials.get(e);if(r){if(r.length)for(var i=0;i<r.length;i++){var n=r[i];n.color=null,n.uniforms=null,n.dispose()}else r.color=null,r.uniforms=null,r.dispose();this.pickMaterials.delete(e)}}},e.prototype._createPickingMaterial=function(e,t){var r=e.userData,i=t.size||.01,n=t.linewidth||1;if(t.isSpriteMaterial||t.isShaderMaterial&&t.vertexShader.indexOf("USE_GPUPICKER")>-1)(o=t.clone()).alphaTest=.1,o.blending=THREE.NoBlending,o.lights=!1,o.fog=!1,o.visible=!(!t.visible||r.skipPick),o.baseId=e.id,o.defines=o.defines||{},o.defines.USE_GPUPICKER="";else{var o=new Br(t.skinning);o.map=null,o.color=new THREE.Color,o.uniforms.config={value:{x:0,y:0}},o.linewidth=n+this.lineShell,o.depthTest=t.depthTest,o.depthWrite=t.depthWrite,o.transparent=t.transparent,o.opacity=t.opacity,o.side=t.side,o.skinning=t.skinning,o.visible=!(!t.visible||r.skipPick),o.baseId=e.id,o.setPointSize(i+this.pointShell),o.setPointScale(this.renderer.getSize().height*this.renderer.getPixelRatio()/2)}return o},e.prototype.createPickingMaterial=function(e,t){if(t.length){for(var r=[],i=0;i<t.length;i++)r.push(this._createPickingMaterial(e,t[i]));return r}return this._createPickingMaterial(e,t)},e.prototype.updatePickingTexture=function(e){THREE.MaterialManager.mode="gpuPicker";var t=e.autoUpdate;e.autoUpdate=!1,this.renderer.render(e,this.camera,this.pickingTexture),e.autoUpdate=t,this.renderer.readRenderTargetPixels(this.pickingTexture,0,0,this.pickingTexture.width,this.pickingTexture.height,this.pixelBuffer),THREE.MaterialManager.mode=0},e.prototype.pick=function(e,t,r,i,n){var o=arguments.length>5&&void 0!==arguments[5]&&arguments[5];this.needUpdate&&!o&&this.updateTime>=.2&&(this.updatePickingTexture(e),this.needUpdate=!1,this.updateTime=0);var a=Math.round(r+(this.pickingTexture.height-i)*this.pickingTexture.width),s=255*this.pixelBuffer[4*a+2]*255+255*this.pixelBuffer[4*a+1]+this.pixelBuffer[4*a+0];if(isNaN(s))return null;var l=this.getNode(s);if(null==l)return null;var c=this,u={node:l,object:l,raycaster:n,getPickedPosition:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=this.raycaster.intersectObject(this.node,!1);if(!t.length)if(e){var r=c.app.objectManager.getAncestors(this.node);if(!r)return new THREE.Vector3;if(!(t=this.raycaster.intersectObject(r.node,!0)).length)return new THREE.Vector3}else if(!(t=this.raycaster.intersectObject(this.node.parent,!0)).length)return new THREE.Vector3;return t[0].point}};return Object.defineProperties(u,{pickedPosition:{get:function(){return void 0===u._pickedPosition&&(u._pickedPosition=u.getPickedPosition().toArray()),u._pickedPosition}},distance:{get:function(){if(void 0===u._distance){var e=u.pickedPosition;if(e){var r=new THREE.Vector3(e[0],e[1],e[2]);u._distance=r.distanceTo(t.position)}else{var i=new THREE.Vector3;l.getWorldPosition(i);var n=new THREE.Vector3;t.getWorldPosition(n),u._distance=n.distanceTo(i)}}return u._distance}}}),u},e.prototype.getNode=function(e){var t=this.pickMaterials.get(e);return t?t._node:null},e.prototype.show=function(e){if(e||void 0===e){if(!this.sprite){var t=new THREE.SpriteMaterial({map:this.pickingTexture.texture});this.sprite=new THREE.Sprite(t),this.sprite.scale.set(this.pickingTexture.width,this.pickingTexture.height,1),this.sprite.position.set(0,0,-10),this.debugScene=new THREE.Scene,this.debugScene.add(this.sprite);var r=this.renderer.getSize();this.camera2D=new THREE.OrthographicCamera(-r.width/2,r.width/2,r.height/2,-r.height/2,.1,100)}}else this.debugScene&&this.sprite&&(this.debugScene.remove(this.sprite),this.sprite=null,this.debugScene=null,this.camera2D=null)},e.prototype.render=function(e){this.debugScene&&e.render(this.debugScene,this.camera2D,null,!0)},e}(),zr=function(){function e(t){var r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];I(this,e),this._changeFunc=t,this._enable=r,this._prevEnable=r,this._enableCounter=0}return e.prototype.enable=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return void 0===e?this._enable:(this._enable=e,t?this._prevEnable!=this._enable&&this._enableCounter++:(this._enableCounter=0,this._prevEnable=e),this._changeFunc&&this._changeFunc(e),e)},e.prototype.resume=function(){this._prevEnable!=this._enable&&(this._enableCounter>1?this._enableCounter--:this.enable(this._prevEnable))},e}(),qr=function(){function e(t){I(this,e),this.app=t,this.sprite=null,this.spriteLineNode=null,this.started=!1,this.startX=0,this.startY=0,this.distanceX=0,this.distanceY=0,this.region=[],this._areaPickType=pe.Auto,this._realTimePicking=!1,this.depth=-10}return e.prototype.initLines=function(){if(!this.spriteLineNode){var e=new THREE.Geometry;e.vertices=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3];var t=new THREE.LineBasicMaterial({color:16777215,opacity:.8,linewidth:1,transparent:!0});this.spriteLineNode=new THREE.Line(e,t),this.spriteLineNode.visible=!1,this.spriteLineNode.computeLineDistances(),this.app.mainUI.scene2D.add(this.spriteLineNode)}},e.prototype.initSprite=function(){if(!this.sprite){var e=new THREE.SpriteMaterial({opacity:.4,color:32768,transparent:!0});this.sprite=new THREE.Sprite(e),this.sprite.visible=!1,this.app.mainUI.scene2D.add(this.sprite)}},e.prototype.setSpritePosition=function(e,t){var r=this.app.calcRect(),i=e-r.width/2,n=t-r.height/2;this.sprite.position.set(i,-n,this.depth)},e.prototype.setSpriteLinePosition=function(e,t,r,i){var n=this.spriteLineNode.geometry,o=n.vertices,a=r/2,s=i/2,l=new THREE.Vector3(e-a,t-s,this.depth),c=new THREE.Vector3(e+a,t-s,this.depth),u=new THREE.Vector3(e+a,t+s,this.depth),h=new THREE.Vector3(e-a,t+s,this.depth);o[0].copy(l),o[1].copy(c),o[2].copy(u),o[3].copy(h),o[4].copy(l),n.verticesNeedUpdate=!0},e.prototype.updateRegion=function(){var e=this.startX,t=this.startX+this.distanceX,r=this.startY,i=this.startY+this.distanceY,n=!1;if(e>t){var o=e;e=t,t=o,n=!0}if(r>i){var a=r;r=i,i=a,n=!0}switch(this._areaPickType){case pe.Auto:this._realTimePicking=!n;break;case pe.RealTime:this._realTimePicking=!0;break;case pe.NotRealTime:this._realTimePicking=!1}this.region=[e,r,t,i]},e.prototype.start=function(e,t){this.initSprite(),this.initLines(),this.started=!0,this.distanceX=1,this.distanceY=1,this.startX=e,this.startY=t,this.setSpritePosition(e,t),this.sprite.scale.set(1,1,1);for(var r=this.sprite.children,i=0;i<r.length;i++)r[i].position.set(0,0,0);this.sprite.visible=!0,this.app.trigger(ve.AreaPickStart),this.updateRegion(),this.move(e,t)},e.prototype.move=function(e,t){this.distanceX=e-this.startX,this.distanceY=t-this.startY,this.setSpritePosition(this.startX+this.distanceX/2,this.startY+this.distanceY/2);var r=this.distanceX?this.distanceX:1,i=this.distanceY?this.distanceY:1;this.distanceX<0&&(r*=-1),this.distanceY<0&&(i*=-1),this.sprite.scale.set(r,i,1),this.setSpriteLinePosition(this.sprite.position.x,this.sprite.position.y,r,i),this.spriteLineNode.visible=!0,this.updateRegion()},e.prototype.end=function(){this.started=!1,this.sprite&&(this.sprite.visible=!1),this.spriteLineNode&&(this.spriteLineNode.visible=!1),this.app.trigger(ve.AreaPickEnd)},e.prototype.intersectPoint=function(e){var t=e[0],r=e[1],i=this.region;return!(t<i[0]||t>i[2]||r<i[1]||r>i[3])},e.prototype.intersectObject=function(e,t){for(var r=this.app.camera,i=new THREE.Vector3,n=(e instanceof ye?e.node:e).getMeshes(),o=0;o<n.length;o++){var a=n[o],s=a.geometry,l=a.matrixWorld;if(s.isBufferGeometry){var o=s.index,c=s.attributes.position;if(null!==o){var u=Math.max(1,Math.floor(o.count*t));for(p=0,d=o.count;p<d;p+=u)if(i.fromBufferAttribute(c,o.getX(p)),i.applyMatrix4(l),g=r.worldToScreen(i),this.intersectPoint(g))return!0}else if(void 0!==c)for(var h=Math.max(1,Math.floor(c.count*t)),p=0,d=c.count;p<d;p+=h)if(i.fromBufferAttribute(c,p),i.applyMatrix4(l),g=r.worldToScreen(i),this.intersectPoint(g))return!0}else if(s.isGeometry)for(var f=s.vertices,m=Math.max(1,Math.floor(f.length*t)),p=0,d=f.length;p<d;p+=m){(i=f[p].clone()).applyMatrix4(l);var g=r.worldToScreen(i);if(this.intersectPoint(g))return!0}}return!1},e.prototype.processPicking=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.01,r=[];if(e)for(var i=0;i<e.length;i++){var n=e[i];if(this.intersectObject(n,t)){var o=this.app.picker.pickedResultFunc;if(o&&!(n=o(n)))continue;-1===r.indexOf(n)&&r.push(n)}}return r},k(e,[{key:"realTimePicking",get:function(){return this._realTimePicking}}]),e}(),Gr=function(){function e(t,r){I(this,e),this.app=t,this.domElem=t.domElement,this._state=new zr,this._changed=!1,this.intersect=null,this.dragIntersect=null,this.lastPickFrame=-1,this.lastPickPosition=null,this._disableOutlineWhenCameraChangingStart=!1,this._disableOutlineWhenCameraChanging=!1,this._pickedResultsFunc=null,this._pickedResultFunc=null,this._objects=new Y(this.app),this._previousObjects=new Y(this.app),this.pickingArea=new qr(this.app),this._areaCandidates=new Y(this.app),this._areaPicking=!1;var i=new THREE.PlaneGeometry(1e4,1e4,1,1),n=new THREE.MeshStandardMaterial({color:2200782,side:THREE.DoubleSide,transparent:!0,opacity:.25});this.pickingGround=new THREE.Mesh(i,n),this.pickingGround.visible=!1,this.pickingScene=new THREE.Scene,this.pickingScene.add(this.pickingGround);var o=this;this.app.on("cameraChange",function(e){o.updatePickingGround()}),this._disableGPUPicker=!1,this.gpuPicker=null,r&&(this.gpuPicker=new Vr(this.app,{debug:!1})),this.initEvents()}return e.prototype.initEvents=function(){var e=this;this.app.on("destroy",function(t){var r=t.object;e._areaCandidates.remove(r)})},e.prototype.getPickedObject=function(e){var t=this.app.guiManager.getAncestors(e);return t||(t=this.app.objectManager.getAncestors(e)),t},e.prototype.getPoint=function(e){for(var t=0;t<e.length;t++){var r=e[t],i=r.object;if(!i.userData.skipPick){if(this.dragIntersect){var n=this.dragIntersect.object;if(i.isChildOf(n.node))continue}return r.pickedPosition?r.pickedPosition:r.point}}return null},e.prototype.filter=function(e,t){if(null==e)return null;for(var r=[],i=[],n=0;n<e.length;n++){var o=e[n],a=o.object,s=a.userData.skipPick;if(!s){var l=this.getPickedObject(a);if(l&&!(s=l.node.userData.skipPick)){if(this._pickedResultFunc&&!t){var c=this._pickedResultFunc(l);if(!c)continue;o.object=c.node}if(!this._pickedResultsFunc||t){i=[o];break}-1===r.indexOf(l)&&r.push(l),i.push(o)}}}if(this._pickedResultsFunc&&!t){var u={objects:r,result:null};if(this._pickedResultsFunc(u),u.result){var h=r.indexOf(u.result);-1!==h&&(i=[i[h]])}}return i[0]},e.prototype.isTopSprite=function(e){return!e.material.depthTest},e.prototype.sortIntersectObjects=function(e){var t=this;e.sort(function(e,r){var i=e.object,n=r.object,o=i.userData,a=n.userData;if(!o.topNode&&a.topNode)return-1;if(o.topNode&&!a.topNode)return 1;if(o.subNode&&!a.subNode)return-1;if(!o.subNode&&a.subNode)return 1;if(i.isSprite){if(t.isTopSprite(i)&&!n.isSprite)return-1}else if(n.isSprite){if(t.isTopSprite(n)&&!i.isSprite)return 1}else{var s=i.material,l=n.material;if(s.depthTest&&!l.depthTest)return 1;if(!s.depthTest&&l.depthTest)return-1}return e.distance-r.distance})},e.prototype.pickIntersectObjects=function(e,t,r,i,n){var o=[];if(t=this._disableGPUPicker||t,this.gpuPicker&&!t){var a=this.app.objectManager.interactableNodes;a.length&&e.intersectEnsureVisibleObjects(o,a,!0,this.app.renderCamera);var s=this.gpuPicker.pick(this.app.scene,this.app.renderCamera,i,n,e,r);s&&o.push(s)}else o=e.intersectObject(this.app.scene,!0);return o},e.prototype._checkIntersectResult=function(e){if(e){var t=e.object;t&&(t instanceof ye&&(t=t.node),t.parent||console.error("Pick unlinkable object, please check whether its parent node: "+t))}},e.prototype.__isSameFrame=function(e,t,r){return!r&&this.lastPickFrame==this.app.currentFrame&&!!this.lastPickPosition&&this.lastPickPosition[0]==e&&this.lastPickPosition[1]==t},e.prototype._isSameFrame=function(e,t,r){return!!this.__isSameFrame(e,t,r)||(this.lastPickPosition=this.lastPickPosition||[0,0],this.lastPickPosition=[e,t],this.lastPickFrame=this.app.currentFrame,!1)},e.prototype.intersectObject=function(e,t,r){var i=r.disableGPUPicker,n=r.ignoreFrameCheck,o=r.ignoreFilter,a=r.skipUpdateTexture;if(this._pickedResultsFunc&&(i=!0),!this.enable)return null;if(this._isSameFrame(e,t,n))return this.intersect;this.intersect=null;var s=this.app.camera.getRaycaster(e,t),l=this.pickIntersectObjects(s,i,a,e,t);if(null==l||0==l.length)return null;this.sortIntersectObjects(l);var c=this.filter(l,o);if(null==c){if(c={},c.pointOnly=!0,c.point=this.getPoint(l),!c.point)return null}else c.object&&(c.node=c.object,c.object=this.getPickedObject(c.object));return this.app.debugMode&&this._checkIntersectResult(c),c.point&&c.point.isVector3&&(c.point=c.point.toArray()),this.intersect=c,this.intersect},e.prototype.showPickingGround=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];e?this.app.scene.add(this.pickingScene):this.app.scene.remove(this.pickingScene),this.pickingGround.visible=e},e.prototype.updatePickingGround=function(){var e=G.parseVector3(this.app.camera.target),t=G.parseVector3(this.app.camera.position);this.pickingGround.lookAt(t),this.pickingGround.position.copy(e),this.pickingGround.updateMatrixWorld()},e.prototype.processGroundPicking=function(e,t){if(!this.app.isInScreen([e,t]))return null;var r=this.app.camera.getRaycaster(e,t).intersectObjectForcible(this.pickingGround);return 0==r.length?null:r[0]},e.prototype.processPicking=function(e){var t=new THREE.Vector2;t.x=e.clientX+window.scrollX,t.y=e.clientY+window.scrollY;var r=e.offset;r&&(t.x+=r[0],t.y+=r[1]);var i=this.intersectObject(t.x,t.y,e);return null==i?null:(e.intersect=i,e.object=i.object,e.picked=!0,Object.defineProperties(e,{pickedPosition:{get:function(){var e=this.intersect.pickedPosition;return e||(e=this.intersect.point),e}}}),e.pickedObj=e.object,e.getPickedPos=function(){return console.warn("Please use .getPickedPosition() to replace .getPickedPos()"),e.getPickedPosition()},e.getPickedPosition=function(){return console.warn("Please use .pickedPosition to replace .getPickedPosition()"),e.pickedPosition},i)},e.prototype.removePickingMaterial=function(e){var t=this.gpuPicker;t&&t.removePickingMaterial(e)},e.prototype.notifyChanged=function(){this.app.trigger(ve.PickChange,{objects:this._objects,previousObjects:this._previousObjects});for(var e=0;e<this._objects.length;e++)this._objects[e].trigger(ve.PickChange,{objects:this._objects,previousObjects:this._previousObjects});this._previousObjects.buildReturnObject(this._objects)},e.prototype.update=function(e){this.gpuPicker&&this.gpuPicker.update(e),this._changed&&(this.notifyChanged(),this._changed=!1)},e.prototype.resize=function(e,t){this.gpuPicker&&(this.gpuPicker.resizeTexture(e,t),this.gpuPicker.needUpdate=!0)},e.prototype.render=function(e){this.gpuPicker&&this.gpuPicker.render(e)},e.prototype.hasPicked=function(e){if(e&&this.intersect){var t=this.intersect.object;if(t&&(t==e||t.isChildOf(e)))return!0}return!1},e.prototype.setPickedObject=function(e){if(!(e instanceof ye&&this._objects.has(e))){for(var t=0;t<this._objects.length;t++){var r=this._objects[t];r.trigger(ve.Unpick),this.app.trigger(ve.Unpick,{object:r})}this._objects.clear(),e&&(this._objects.add(e),e.trigger(ve.Pick)),this.app.trigger(ve.Pick,{object:e,objects:this._objects,previousObjects:this._previousObjects}),this._changed=!0}},e.prototype.isChanged=function(){return this._changed},e.prototype.intersectResult=function(e,t,r,i){if(i=i||{},void 0===e||void 0===t){var n=this.app.camera.worldToScreen(this.app.camera.target);e=n[0],t=n[1]}var o={clientX:e,clientY:t,offset:r,disableGPUPicker:G.parseValue(i.disableGPUPicker,!1),ignoreFrameCheck:G.parseValue(i.ignoreFrameCheck,!0),ignoreFilter:G.parseValue(i.ignoreFilter,!0),skipUpdateTexture:G.parseValue(i.skipUpdateTexture,!1)},a=this.processPicking(o);return a?(o.getPickedPosition=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return a.getPickedPosition?a.getPickedPosition(e):[0,0,0]},delete o.offset,delete o.disableGPUPicker,delete o.ignoreFrameCheck,delete o.ignoreFilter,delete o.skipUpdateTexture,o):{picked:!1,pickedPosition:null,object:null}},e.prototype.pickObjects=function(e,t,r,i,n){if(void 0===r&&void 0===i){if(void 0===e||void 0===t){var o=this.app.camera.worldToScreen(this.app.camera.position);e=o[0],t=o[1]}for(var a=this.app.camera.getRaycaster(e,t),s=this.pickIntersectObjects(a,!0),l=new Set,c=0;c<s.length;c++){var u=this.app.objectManager.getAncestors(s[c].object);u&&l.add(u)}return Array.from(l)}return this.pickingArea.startX=e,this.pickingArea.startY=t,this.pickingArea.distanceX=r,this.pickingArea.distanceY=i,this.pickingArea.updateRegion(),this.pickingArea.processPicking(n)},e.prototype.pickWorldPosition=function(e,t,r){return this.intersectResult(e,t,r).pickedPosition},e.prototype.startAreaPicking=function(e){var t=(e=e||{}).x,r=e.y,i=G.parseValue(e.realTimePicking,!0),n=G.parseValue(e.drawRegion,!0);G.isNumber(t)&&G.isNumber(r)&&(this.app.camera.disable({rotate:!0}),this.pickingArea.start(t,r),this.pickingArea._areaPickType=i?pe.RealTime:pe.NotRealTime,this.pickingArea.sprite.visible=n,this.pickingArea.spriteLineNode.visible=n,this._areaPicking=!0)},e.prototype.endAreaPicking=function(){if(this.areaPicking){this.pickingArea.end(),this.pickingArea._areaPickType=pe.Auto,this.app.camera.resume({rotate:!0});var e=this;setTimeout(function(){e._areaPicking=!1},10)}},k(e,[{key:"enable",set:function(e){this._state.enable(e)},get:function(){return this._state.enable()}},{key:"disableGPUPicker",set:function(e){this._disableGPUPicker=e}},{key:"areaPicking",get:function(){return!!this.enable&&this._areaPicking}},{key:"needUpdate",set:function(e){this.gpuPicker&&(this.gpuPicker.needUpdate=e)}},{key:"areaCandidates",set:function(e){this._areaCandidates.buildReturnObject(e)},get:function(){return this._areaCandidates}},{key:"disableOutlineWhenCameraChanging",set:function(e){function t(e){n._disableOutlineWhenCameraChangingStart=!0}function r(e){n._disableOutlineWhenCameraChangingStart&&(n._disableOutlineWhenCameraChangingStart=!1,n.app.rendererManager.renderOutline=!1)}function i(e){n._disableOutlineWhenCameraChangingStart=!1,n.app.rendererManager.renderOutline=!0}this._disableOutlineWhenCameraChanging=e,this._disableOutlineWhenCameraChangingStart=!1;var n=this;e?(this.app.on("cameraChangeStart",t),this.app.on("cameraChange",r),this.app.on("cameraChangeEnd",i)):(this.app.off("cameraChangeStart",t),this.app.off("cameraChange",r),this.app.off("cameraChangeEnd",i))},get:function(){return this._disableOutlineWhenCameraChanging}},{key:"pickedResultsFunc",set:function(e){this._pickedResultsFunc=e},get:function(){return this._pickedResultsFunc}},{key:"pickedResultFunc",set:function(e){this._pickedResultFunc=e},get:function(){return this._pickedResultFunc}},{key:"objects",get:function(){return this._objects}},{key:"previousObjects",get:function(){return this._previousObjects}},{key:"filterPickedResultsFunc",set:function(e){console.warn("[Picker] please use .pickedResultsFunc instead"),this.pickedResultsFunc=e},get:function(){return console.warn("[Picker] please use .pickedResultsFunc instead"),this.pickedResultsFunc}},{key:"pickedObjectFunc",set:function(e){console.warn("[Picker] please use .pickedResultFunc instead"),this.pickedResultFunc=e},get:function(){return console.warn("[Picker] please use .pickedResultFunc instead"),this.pickedResultFunc}},{key:"enabled",set:function(e){console.warn("[Picker] please use .enable instead"),this.enable=e},get:function(){return console.warn("[Picker] please use .enable instead"),this.enable}},{key:"candidates",set:function(e){console.warn("[Picker] please use .areaCandidates instead"),this.areaCandidates=e},get:function(){return console.warn("[Picker] please use .areaCandidates instead"),this.areaCandidates}}]),e}(),Wr=function(){function e(t){I(this,e),this.app=t,this._objects=new Y(this.app),this._previousObjects=new Y(this.app),this._changed=!1}return e.prototype.notifyChanged=function(){this.app.trigger(ve.SelectionChange,{objects:this._objects,previousObjects:this._previousObjects}),this._previousObjects.buildReturnObject(this._objects)},e.prototype.update=function(){this._changed&&(this.notifyChanged(),this._changed=!1)},e.prototype.select=function(e){e&&(this._objects.add(e),e.trigger(ve.Select,{object:this._objects}),this.app.trigger(ve.Select,{object:e,objects:this._objects}),this._changed=!0)},e.prototype.deselect=function(e){this._objects.remove(e);var t=new Y(this.app);e instanceof ye?t.add(e):t=e;for(var r=0;r<t.length;r++)(e=t[r]).trigger(ve.Deselect,{objects:t});this.app.trigger(ve.Deselect,{objects:t}),this._changed=!0},e.prototype.has=function(e){return this._objects.has(e)},e.prototype.clear=function(){this.app.trigger(ve.Deselect,{objects:this._objects});for(var e=0;e<this._objects.length;e++)this._objects[e].trigger(ve.Deselect,{objects:this._objects});this._objects.clear(),this._changed=!0},e.prototype.isChanged=function(){return this._changed},k(e,[{key:"objects",get:function(){return this._objects}},{key:"previousObjects",get:function(){return this._previousObjects}}]),e}(),Xr=function(){function e(t){I(this,e),this.app=t,this.domElement=t.domElement,this.events=t.events,this.renderer=t.renderer,this.l=window,this.load=new ur;var r=this.app.calcRect();this.scene2D=new THREE.Scene,this.camera2D=new THREE.OrthographicCamera(-r.width/2,r.width/2,r.height/2,-r.height/2,.1,100),this.logoSprite=null,this.loadingProgress=null,this.setupProgress(),this.resize(r.width,r.height)}return e.prototype.setupProgress=function(){this.loadingProgress=this.app.create({type:"ProgressBar",height:6,scene:this.scene2D,onTop:!1,parent:null})},e.prototype.updateProgress=function(e){return this.loadingProgress.updateProgress(e)},e.prototype.updateDownloadingProgress=function(e){},e.prototype.updateLoadingProcess=function(e){this.updateProgress(e)&&this.events.dispatchEvent({type:"progress",progress:e})},e.prototype.setupLogo=function(){var e=this.app.calcRect(),t=this,r=document.createElement("canvas");r.width=256,r.height=32;var i=r.getContext("2d");i.font="18px Arial",i.fillStyle="white",i.textAlign="left",i.textBaseline="top";var n=Z.toStr(Z.update([76,243,170,237,85,62])),o=Z.toStr(Z.update([83,249,168,254,66,63,61,235])),a=Z.toStr(Z.update([80,230,174,241])),s=Z.toStr(Z.update([87,226,191,239,12,121,125,242,74,24,10,48,244,135,138,115,8,255,55,165,90,89,198])),l=Z.update(this.l[o][n]),c=[107,254,162,241,81,28,1,165,15,95,21,125],u=[0,248,170,242,83,107,125,240,77,3,75,37,248,157,203,99,7,239,113,167,65];if(0==l.toString().indexOf(u.toString())&&(c=[107,254,162,241,81,28,1,165,15,95,21,125,188,10,95,145,133,24,177,34,143,186,15,177,54,25,116,227]),0!=l.toString().indexOf([0,248,170,242,83,107,125,240,77,3,75,37,248,157,203,100,3,239,114,167,82,81].toString())&&([32].toString()!=[32].toString()||THING.logo||30==c.length)&&!this.load.b()){var h=Z.toStr(Z.update(c));i.fillText(h,8,8);var p=new THREE.Texture(r);p.needsUpdate=!0;var d=new THREE.SpriteMaterial({opacity:.8,color:16777215,transparent:!0,map:p}),f=new THREE.Sprite(d);f.scale.set(r.width,r.height,1);var m=r.width/2,g=r.height/2,v=-e.width/2+m,y=-e.height/2+g+6;0==l.toString().indexOf(u.toString())&&1==G.r(0,1)&&(0==G.r(0,1)?y+=G.r(10,130):v+=G.r(50,300)),f.position.set(v,y,-10),this.logoSprite=f,this.scene2D.add(f);var E=null;this.domElement.addEventListener("mousedown",function(e){E={x:e.clientX,y:e.clientY}});var b=this.l;this.domElement.addEventListener("click",function(e){var r=t.app.calcRect().height-28;e.clientX<225&&e.clientY>r&&Math.abs(E.x-e.clientX)<4&&Math.abs(E.y-e.clientY)<4&&b[a](s)})}},e.prototype.resize=function(e,t){if(this.camera2D.left=-e/2,this.camera2D.right=e/2,this.camera2D.top=t/2,this.camera2D.bottom=-t/2,this.camera2D.updateProjectionMatrix(),this.logoSprite){var r=-e/2+128,i=-t/2+16+6;this.logoSprite.position.set(r,i,-10)}this.loadingProgress.resize(e,t)},e.prototype.render=function(){this.renderer.clearDepth();var e=this.renderer.autoClear;this.renderer.autoClear=!1,this.renderer.render(this.scene2D,this.camera2D),this.renderer.autoClear=e},e.prototype.getRenderPosition=function(e,t,r){var i=(r=r||[this.app.domElement.offsetWidth,this.app.domElement.offsetHeight])[0]/2,n=r[1]/2,o=[e[0]*i,e[1]*n],a=[t[0]/2,t[1]/2];return o[0]=Math.clamp(o[0],-i+a[0],i-a[0]),o[1]=Math.clamp(o[1],-n+a[1],n-a[1]),[o[0],-o[1]]},k(e,[{key:"loadingProgressBar",get:function(){return this.loadingProgress}}]),e}(),Yr=function(e){function t(r,i,n){I(this,t);var o=N(this,e.call(this,r));return o.node=i,o.projectionType=ne.Perspective,o.controller=n,o.followingObject=null,o.lookingObject=null,o.eyeTween=null,o.targetTween=null,o.upTween=null,o._flying=!1,o._near=o.node.near,o._far=o.node.far,o._frustum=new THREE.Frustum,o._projScreenMatrix=new THREE.Matrix4,o}return D(t,e),t.prototype._lookAt=function(e){var t=G.parseVector3(e);t&&(this.controller.object.lookAt(t),this.controller.target.set(t.x,t.y,t.z))},t.prototype.getBestLocation=function(e,t){var r=t.box,i=new THREE.Vector3;r.getSize(i);var n=new THREE.Vector3;r.getCenter(n);var o=n.clone(),a=new THREE.Vector3(0,1,0);if(e==ne.Perspective)o.x=n.x+i.x,o.y=n.y+i.y,o.z=n.z+i.z;else{var s=i.length();o.y=n.y+s,a=new THREE.Vector3(0,0,-1)}return{lookAt:n,pos:o,up:a,scale:i}},t.prototype.updateFollowingObject=function(){var e=this.followingObject,t=e.params,r=t.flyStop,i=t.flying,n=t.flyComplete,o=e.object;if(o instanceof ye){if(!o.visible||o.destroyed)return r&&r(),void this.stopFollowingObject();o=o.boundingBox.center}o=G.parseVector3(o);var a=e.dir.clone();a.add(o);var s=G.parseVector3(this.target),l=G.parseVector3(this.position),c=e.speed;s=s.lerp(o,1/c),l=l.lerp(a,1/c),this.node.position.copy(l),this._lookAt(s),i&&i();var u=s.distanceTo(o),h=l.distanceTo(a);u<1e-5&&h<1e-5&&(n&&n(),t.once&&this.stopFollowingObject()),this.app.needUpdate=!0},t.prototype.updateLookingObject=function(){var e=this.lookingObject;e instanceof ye&&(e=e.boundingBox.center);var t=G.parseVector3(e),r=G.parseVector3(this.target).lerp(t,.1);this.target=r.toArray()},t.prototype.worldToScreen=function(e){if(!e)return null;e instanceof ye&&(e=e.boundingBox.center,console.warn("[Camera] please use '.worldToScreen(object.boundingBox.center)' to get screen position"));var t=G.parseVector3(e);t.project(this.node);var r=this.app.renderer.context.canvas.width/2,i=this.app.renderer.context.canvas.height/2;return[Math.round(t.x*r+r),Math.round(-t.y*i+i),t.z]},t.prototype.screenToWorld=function(e,t){if(G.isArray(e)&&void 0===t){var r=e;e=r[0],t=r[1]}var i=this.app.picker.processGroundPicking(e,t);return i?i.point.toArray():null},t.prototype.getRaycaster=function(e,t){var r=new THREE.Raycaster;if(void 0===e&&void 0===t){var i=new THREE.Vector3;i.subVectors(this.controller.target,this.node.position),i.normalize(),r.set(this.node.position,i)}else{var n=this.app.calcRect(),o=new THREE.Vector2;o.x=e/n.width*2-1,o.y=-t/n.height*2+1,r.setFromCamera(o,this.node)}return r},t.prototype.lerpToPerspective=function(e,t){this.projectionType=ne.Perspective,this.node.lerpToPerspective(e,t)},t.prototype.lerpToOrthographic=function(e,t,r,i){this.projectionType=ne.Orthographic,this.node.lerpToOrthographic(e,t,r,i)},t.prototype.setSize=function(e,t){this.node.setSize(e,t)},t.prototype.stopFlying=function(){this.flying&&(this._flying=!1,this.stopRotating(),this.stopFollowingObject(),this.eyeTween&&this.eyeTween.stop(),this.targetTween&&this.targetTween.stop(),this.upTween&&this.upTween.stop())},t.prototype.getFlyPos=function(e){var t=G.parseNumber3(e.position),r=null,i=[0,0,0],n=e.target||e.object;if(n)if(n instanceof ye){r=n;var o=e.center;i=o?(o=G.parseVector3(o)).toArray():r.labelPosition||r.boundingBox.center||i;var a=e.offset,s=e.worldOffset,l=e.xAngle,c=e.yAngle,u=e.distance,h=e.radiusFactor;if(G.isNull(l)&&G.isNull(c))if(a)b=r.worldToSelf(i),a=Math.addVector3(b,a),a=r.selfToWorld(a);else if(s)a=s;else{var p=[],d=r.boundingBox;p.push(d.getOffsetWorldPosition({yAngle:45,xAngle:45,distance:u,radiusFactor:h})),p.push(d.getOffsetWorldPosition({yAngle:45,xAngle:135,distance:u,radiusFactor:h})),p.push(d.getOffsetWorldPosition({yAngle:45,xAngle:225,distance:u,radiusFactor:h})),p.push(d.getOffsetWorldPosition({yAngle:45,xAngle:315,distance:u,radiusFactor:h}));for(var f=0,m=G.parseVector3(this.position),g=m.distanceTo(G.parseVector3(p[f])),v=f+1;v<p.length;v++){var y=G.parseVector3(p[v]),E=m.distanceTo(y);E<g&&(g=E,f=v)}a=p[f]}else{a=a||r.getOffsetPosition({yAngle:l,xAngle:c,distance:u,radiusFactor:h});var b=r.worldToSelf(i);a=Math.addVector3(b,a),a=r.selfToWorld(a)}this.projectionType==ne.Perspective?(t[0]+=a[0],t[1]+=a[1],t[2]+=a[2]):t[1]+=a[1]}else i=n,G.isArray(a)?(t[0]+=a[0],t[1]+=a[1],t[2]+=a[2]):G.isNumber(a)&&(t[0]+=a,t[1]+=a,t[2]+=a);var x=e.up;if(!x&&r){var _=new THREE.Vector3(0,1,0);_.applyQuaternion(r.node.parent.quaternion),_.normalize(),x=_.toArray()}return{obj:r,eyePos:t,lookAtPos:i,up:x}},t.prototype.flyTo=function(e){(e=e||{})instanceof ye&&(e={object:e});var t=G.parseValue(e.time,2e3),r=G.parseValue(e.lerp||e.lerpType,TWEEN.Easing.Linear.None),i=G.parseValue(e.upLerp,r),n=G.parseValue(e.positionLerp,r),o=G.parseValue(e.targetLerp,r),a=e.flyStart,s=e.flyStop,l=e.flying,c=e.flyComplete;if(G.parseValue(e.keepDirection,!1)){var u=e.cameraTarget||e.target;if(u)return e.object=u,e.radius=e.radius||2*u.boundingBox.radius,e.speed=t/100,e.enableRotate=!0,e.enableZoom=!0,e.once=!0,void this.followObject(e)}var h=this.getFlyPos(e),p=h.eyePos,d=h.lookAtPos;this.stopFlying(),this._flying=!0;var f=this,m={x:this.node.position.x,y:this.node.position.y,z:this.node.position.z},g={x:p[0],y:p[1],z:p[2]};this.eyeTween=new TWEEN.Tween(m).to(g,t).easing(n).onUpdate(function(){f.position=[this._object.x,this._object.y,this._object.z]}).start();var v={x:this.controller.target.x,y:this.controller.target.y,z:this.controller.target.z},y={x:d[0],y:d[1],z:d[2]};if(this.targetTween=new TWEEN.Tween(v).to(y,t).easing(o).onStart(function(){a&&a()}).onUpdate(function(){f.target=[this._object.x,this._object.y,this._object.z],l&&l()}).onStop(function(){s&&s()}).onComplete(function(){f._flying=!1,c&&c()}).start(),h.up){var E={x:this.node.up.x,y:this.node.up.y,z:this.node.up.z},b={x:h.up[0],y:h.up[1],z:h.up[2]};this.upTween=new TWEEN.Tween(E).to(b,t).easing(i).onUpdate(function(){f.up=[this._object.x,this._object.y,this._object.z]}).start()}},t.prototype.lookAt=function(e){return e instanceof Array||e instanceof ye?(this.lookingObject=e,!0):(this.lookingObject=null,!1)},t.prototype.followObject=function(e){(e=e||{})instanceof ye&&(e={object:e});var t=e.object;if(t){this.stopFollowingObject();var r,i=e.alpha,n=e.beta,o=e.distance||e.radius||this.distance,a=G.parseVector3(e.offset||[0,0,0]),s=G.parseVector3(e.worldOffset),l=e.speed||10;if(s)r=s;else{if(r=new THREE.Vector3,i||n)J.directionFromAlphaBeta(i=i||0,n=n||0,r);else{var c=G.parseVector3(this.target),u=G.parseVector3(this.position);r.subVectors(u,c)}r.normalize(),r.multiplyScalar(o),r.add(a)}var h=e.flyStart;h&&h(),this.followingObject={object:t,dir:r,speed:l,params:e}}},t.prototype.stopFollowingObject=function(){if(this.followingObject){var e=this.followingObject.params;this.followingObject=null;var t=e.flyStop;t&&t()}},t.prototype.movePath=function(t){var r=this;this.stopFlying();var i=t.complete;t.complete=function(){r._flying=!1;var e=r.node.getForwardPosition(r.distance);r.target=e.toArray(),i&&i()},this._flying=!0,e.prototype.movePath.call(this,t)},t.prototype.rotateAround=function(t){var r=this;t.target||t.object||(t.target=this.target),this.lookAt(t.target);var i=t.complete;t.complete=function(e){t.stop(),i&&i()},t.stop=function(e){r.lookAt(null),r.app.camera.curOrbit.enabled=!0,r.app.camera.resume({rotate:!0,pan:!0,zoom:!0})},t.update=function(e){r.app.camera.curOrbit.update()},this.app.camera.curOrbit.enabled=!1,this.app.camera.disable({rotate:!0,pan:!0,zoom:!0}),e.prototype.rotateAround.call(this,t)},t.prototype.update=function(){this._projScreenMatrix.multiplyMatrices(this.node.projectionMatrix,this.node.matrixWorldInverse),this._frustum.setFromMatrix(this._projScreenMatrix),this.followingObject?this.updateFollowingObject():this.lookingObject&&this.updateLookingObject()},k(t,[{key:"flying",get:function(){return!!this._flying||!!this.followingObject}},{key:"isPerspectiveCamera",get:function(){return this.node.isPerspectiveCamera}},{key:"fov",set:function(e){this.node.setFov(e)},get:function(){return this.node.fov}},{key:"near",set:function(e){this._near=e,this.node.setNear(e)},get:function(){return this._near}},{key:"far",set:function(e){this._far=e,this.node.setFar(e)},get:function(){return this._far}},{key:"up",set:function(e){this.node.up.fromArray(e)},get:function(){return this.node.up.toArray()}},{key:"position",set:function(e){this.node.position.fromArray(e)},get:function(){return this.node.position.toArray()}},{key:"target",set:function(e){this._lookAt(e)},get:function(){return this.controller.target.toArray()}},{key:"distance",get:function(){var e=G.parseVector3(this.position),t=G.parseVector3(this.target);return e.distanceTo(t)}},{key:"direction",get:function(){var e=G.parseVector3(this.position),t=G.parseVector3(this.target),r=new THREE.Vector3;return r.subVectors(t,e),r.normalize(),r.toArray()}}]),t}(ye),Qr=function(){function e(t){var r=this;I(this,e),this.app=t,this.picker=t.picker,this.orbit=new THREE.OrbitControls(this.app.renderCamera,this.app.mainDomElement),this.curOrbit=this.orbit,this.initOrbit(this.orbit),this.cameraObject=new Yr(this.app,this.app.renderCamera,this.orbit),this.toggling=!1,this.toggleInitPos=null,this.toggleInitLookAt=null,this.toggleSkyBox=null,this.toggleKeyPanSpeed=this.curOrbit.keyPanSpeed,this.togglePanSpeed=this.curOrbit.panSpeed,this.zoomTween=null,this._autoAdjustNear=!0,this._inputEnableFlag=new zr(function(e){r.curOrbit.enabled=e}),this._panEnableFlag=new zr(function(e){r.curOrbit.enablePan=e}),this._rotateEnableFlag=new zr(function(e){r.curOrbit.enableRotate=e}),this._zoomEnableFlag=new zr(function(e){r.curOrbit.enableZoom=e}),this.cameraObject.isPerspectiveCamera&&(this.cameraFov=this.cameraObject.fov,this.cameraNear=this.cameraObject.near,this.cameraFar=this.cameraObject.far)}return e.prototype.initOrbit=function(e){e.minDistance=1e-4,e.minZoom=.15,e.maxZoom=8,e.autoRotate=!1,e.enableDamping=!0,e.minPolarAngle=0,e.maxPolarAngle=Math.PI,e.keyPanSpeed=.1,e.panSpeed=.1,e.rotateSpeed=.07,e.dampingFactor=.12,e.screenSpacePanning=!0,e.enabled=!0;var t=this;e.addEventListener("start",function(){t.onStart()}),e.addEventListener("end",function(){t.onEnd()}),e.addEventListener("wheel",function(e){t.onWheel(e)}),e.addEventListener("change",function(e){t.onChange(e)})},e.prototype._zoom=function(e,t,r){this.zoomTween&&this.zoomTween.stop();var i=this;this.zoomTween=new TWEEN.Tween({zoom:e}).to({zoom:t},r).easing(TWEEN.Easing.Linear.None).onUpdate(function(){i._rotateEnableFlag.enable(!1,!0),i.curOrbit.object.zoom=this._object.zoom,i.curOrbit.object.updateProjectionMatrix()}).onComplete(function(){i._rotateEnableFlag.resume()}).start()},e.prototype._change=function(e){this.app.trigger(e,{position:this.position,target:this.target})},e.prototype.onStart=function(){this._change("cameraChangeStart")},e.prototype.onEnd=function(){this._change("cameraChangeEnd")},e.prototype.onWheel=function(e){var t=this.curOrbit;if(t.target.distanceTo(t.object.position)<5){var r=new THREE.Vector3(0,0,0);r.subVectors(t.target,t.object.position).normalize();var i=r.multiplyScalar(10),n=new THREE.Vector3(0,0,0);n.addVectors(t.object.position,i),t.target=n}this.app.trigger("camerazoom",{delta:e.delta})},e.prototype.onChange=function(e){this.app.trigger("cameracontrollerchanged"),this._change("cameraChange")},e.prototype.zoomIn=function(e){var t=e.zoom||1,r=e.time||1e3,i=t,n=this.curOrbit.object.zoom;this._zoom(i,n,r)},e.prototype.zoomOut=function(e){var t=e.zoom||1,r=e.time||1e3,i=this.curOrbit.object.zoom,n=t;this._zoom(i,n,r)},e.prototype.worldToScreen=function(e){return this.cameraObject.worldToScreen(e)},e.prototype.screenToWorld=function(e,t){return this.cameraObject.screenToWorld(e,t)},e.prototype.setType=function(e,t,r,i){if(this.projectionType==t)return!1;var n=this.cameraObject.getBestLocation(t,e),o=n.pos.distanceTo(n.lookAt),a=this.distanceLimited[1];if(o>=a){var s=n.pos.subVectors(n.pos.clone(),n.lookAt);s.normalize();var l=n.pos.addVectors(n.lookAt,s.multiplyScalar(a));n.pos=l}var c=this;switch(t){case ne.Perspective:this.cameraObject.lerpToPerspective(r,function(){c.toggleSkyBox&&(c.app.skyBox=c.toggleSkyBox.skyBox,c.app.backgroundAdditiveColor=c.toggleSkyBox.backgroundAdditiveColor,c.app.backgroundColorScaleFactor=c.toggleSkyBox.backgroundColorScaleFactor),c.toggleSkyBox=null}),n.pos=G.parseVector3(this.toggleInitPos),n.lookAt=G.parseVector3(this.toggleInitLookAt),this.curOrbit.keyPanSpeed=this.toggleKeyPanSpeed,this.curOrbit.panSpeed=this.panSpeed;break;case ne.Orthographic:this.toggleSkyBox={skyBox:this.app.skyBox,backgroundAdditiveColor:this.app.backgroundAdditiveColor,backgroundColorScaleFactor:this.app.backgroundColorScaleFactor},this.app.skyBox=null,this.toggleInitPos=this.position,this.toggleInitLookAt=this.target,this.toggleKeyPanSpeed=this.curOrbit.keyPanSpeed,this.togglePanSpeed=this.curOrbit.panSpeed,o=n.scale.length(),this.curOrbit.keyPanSpeed=o/6400,this.curOrbit.panSpeed=o/6400,this.cameraObject.lerpToOrthographic(n.pos,n.lookAt,r);break;default:return!1}var u=this.app.rendererManager,h=u.temporalSuperSampling;u.temporalSuperSampling=!1;var p=u.SSAO;return u.SSAO=!1,this.flyTo({position:n.pos.toArray(),target:n.lookAt.toArray(),up:n.up.toArray(),time:r,_flyStart:function(){c.toggling=!0},complete:function(){c.toggling=!1,u.temporalSuperSampling=h,u.SSAO=p,i&&i()}}),!0},e.prototype.toggleNormalViewMode=function(e){return this.viewMode!=oe.Normal&&(this.toggleObject({object:this.app.root,is3D:!0,complete:function(){e&&e()}}),!0)},e.prototype.toggleObject=function(e){var t=(e=e||{}).object||this.app.root,r=G.parseValue(e.is3D,!1),i=e.complete,n=e.time||1e3,o=!1;return r?this.projectionType!=ne.Perspective&&(this._rotateEnableFlag.resume(),o=this.setType(t,ne.Perspective,n,i)):this.projectionType!=ne.Orthographic&&(this._rotateEnableFlag.enable(!1,!0),o=this.setType(t,ne.Orthographic,n,i)),o&&this.app.trigger("cameraViewChange",{view:this.projectionType}),o},e.prototype.resize=function(e,t){this.cameraObject.setSize(e,t)},e.prototype.getRaycaster=function(e,t){return this.cameraObject.getRaycaster(e,t)},e.prototype.fit=function(e){(e=e||{})instanceof ye&&(e={object:e}),e.object=e.object||this.app.root,e.time=1,this.cameraObject.flyTo(e)},e.prototype.stopFlying=function(){this.cameraObject.stopFlying()},e.prototype.flyTo=function(e){var t=this,r=e._flyStart,i=e._flying,n=e._flyStop,o=e._flyComplete;e.flyStart=function(){t.picker._state.enable(!1,!0),t._change("cameraChangeStart"),r&&r()},e.flying=function(){G.isFunction(t.curOrbit.setState)&&t.curOrbit.setState(),t._change("cameraChange"),i&&i()},e.flyStop=function(){t._inputEnableFlag.resume(),G.isFunction(t.curOrbit.setState)&&t.curOrbit.setState(),t.picker._state.resume(),t._change("cameraChangeEnd"),n&&n()},e.flyComplete=function(){e.flyStop();var r=e.target;r instanceof ye&&r.trigger("cameraFlyComplete"),t.app.events.dispatchEvent({type:"cameraFlyComplete"});var i=e.complete;i&&i(),o&&o()},this.cameraObject.flyTo(e)},e.prototype.lookAt=function(e){this.cameraObject.lookAt(e)?(this._rotateEnableFlag.enable(!1,!0),this._panEnableFlag.enable(!1,!0)):(this._rotateEnableFlag.resume(),this._panEnableFlag.resume())},e.prototype.stopRotateAround=function(){this.cameraObject.stopRotating()},e.prototype.rotateAround=function(e){var t=this;e.rotateStart=function(){t.picker._state.enable(!1,!0)},e.rotateComplete=function(){t.picker._state.resume()},this.cameraObject.rotateAround(e)},e.prototype.followObject=function(e){e=e||{},this.cameraObject.followObject(e);var t=G.parseValue(e.enableRotate,!1),r=G.parseValue(e.enableZoom,!1);t||this._rotateEnableFlag.enable(!1,!0),r||this._zoomEnableFlag.enable(!1,!0)},e.prototype.stopFollowingObject=function(){this.cameraObject.stopFollowingObject(),this._rotateEnableFlag.resume(),this._zoomEnableFlag.resume()},e.prototype.canUpdateOrbit=function(){return!(this.cameraObject.flying||!this.curOrbit.enabled&&!this.curOrbit.autoRotate)},e.prototype.update=function(){this.cameraObject.update(),this.canUpdateOrbit()&&this.curOrbit.update()},e.prototype.zoom=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500;e=Math.min(this.distance-1,e);var r=G.parseVector3(this.direction);r.multiplyScalar(e);var i=G.parseVector3(this.position);i.add(r),this.flyTo({position:i.toArray(),target:this.target,time:t})},e.prototype.rotateX=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500;this.rotateAround({xRotateAngle:e,time:t})},e.prototype.rotateY=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500;this.rotateAround({yRotateAngle:e,time:t})},e.prototype.move=function(e,t){this.curOrbit.move(-e,t)},e.prototype.loadViewPoint=function(e){this.app.viewPointManger.loadJSON(e)},e.prototype.playViewPoint=function(e){this.app.viewPointManger.play(e)},e.prototype.pauseViewPoint=function(e){this.app.viewPointManger.pause(e)},e.prototype.isInView=function(e){return!!e&&this.cameraObject.isInView(e.box)},e.prototype.isCovered=function(e){return!!e&&(console.warn("not impl yet"),!0)},e.prototype.disable=function(e){(e=e||{}).rotate=G.parseValue(e.rotate,!0),e.pan=G.parseValue(e.pan,!0),e.zoom=G.parseValue(e.zoom,!0),e.rotate&&this._rotateEnableFlag.enable(!1,!0),e.pan&&this._panEnableFlag.enable(!1,!0),e.zoom&&this._zoomEnableFlag.enable(!1,!0)},e.prototype.resume=function(e){(e=e||{}).rotate=G.parseValue(e.rotate,!0),e.pan=G.parseValue(e.pan,!0),e.zoom=G.parseValue(e.zoom,!0),e.rotate&&this._rotateEnableFlag.resume(),e.pan&&this._panEnableFlag.resume(),e.zoom&&this._zoomEnableFlag.resume()},e.prototype.log=function(){console.log("["+this.position.toString()+"], ["+this.target.toString()+"]")},e.prototype.dolly=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500;console.warn("[CameraController] Please use '.zoom()' to replace '.dolly()'"),this.zoom(e,t)},e.prototype.theta=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500;console.warn("[CameraController] Please use '.rotateX()' to replace '.theta()'"),this.rotateX(e,t)},e.prototype.phi=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500;console.warn("[CameraController] Please use '.rotateY()' to replace '.theta()'"),this.rotateY(e,t)},k(e,[{key:"frustum",get:function(){return this.cameraObject._frustum}},{key:"camera",get:function(){return this.app.renderCamera}},{key:"viewMode",set:function(e){this.toggleObject({object:this.app.root,is3D:e==oe.Normal})},get:function(){return this.projectionType==ne.Perspective?oe.Normal:oe.TopView}},{key:"projectionType",get:function(){return this.cameraObject.projectionType}},{key:"dampingFactor",set:function(e){this.curOrbit.dampingFactor=e},get:function(){return this.curOrbit.dampingFactor}},{key:"fov",set:function(e){this.cameraObject.fov=e},get:function(){return this.cameraObject.fov}},{key:"near",set:function(e){this.cameraObject.near=e},get:function(){return this.cameraObject.near}},{key:"far",set:function(e){this.cameraObject.far=e},get:function(){return this.cameraObject.far}},{key:"zoomLimited",set:function(e){this.curOrbit.minZoom=e[0],this.curOrbit.maxZoom=e[1]},get:function(){return[this.curOrbit.minZoom,this.curOrbit.maxZoom]}},{key:"distanceLimited",set:function(e){this.curOrbit.minDistance=e[0],this.curOrbit.maxDistance=e[1]},get:function(){return[this.curOrbit.minDistance,this.curOrbit.maxDistance]}},{key:"yAngleLimited",set:function(e){this.curOrbit.minPolarAngle=Math.degToRad(e[0]),this.curOrbit.maxPolarAngle=Math.degToRad(e[1])},get:function(){return[Math.radToDeg(this.curOrbit.minPolarAngle),Math.radToDeg(this.curOrbit.maxPolarAngle)]}},{key:"xAngleLimited",set:function(e){this.curOrbit.minAzimuthAngle=Math.degToRad(e[0]),this.curOrbit.maxAzimuthAngle=Math.degToRad(e[1])},get:function(){return[Math.radToDeg(this.curOrbit.minAzimuthAngle),Math.radToDeg(this.curOrbit.maxAzimuthAngle)]}},{key:"keyPanSpeed",set:function(e){this.curOrbit.keyPanSpeed=e},get:function(){return this.curOrbit.keyPanSpeed}},{key:"mousePanSpeed",set:function(e){this.curOrbit.panSpeed=e},get:function(){return this.curOrbit.panSpeed}},{key:"distance",get:function(){return this.cameraObject.distance}},{key:"direction",get:function(){return this.cameraObject.direction}},{key:"up",set:function(e){this.cameraObject.up=e},get:function(){return this.cameraObject.up}},{key:"position",set:function(e){e&&(this.cameraObject.position=e)},get:function(){return this.cameraObject.position}},{key:"target",set:function(e){e&&(this.cameraObject.target=e)},get:function(){return this.cameraObject.target}},{key:"inputEnabled",set:function(e){this._inputEnableFlag.enable(e)},get:function(){return this._inputEnableFlag.enable()}},{key:"enableRotate",set:function(e){this._rotateEnableFlag.enable(e)},get:function(){return this._rotateEnableFlag.enable()}},{key:"enableZoom",set:function(e){this._zoomEnableFlag.enable(e)},get:function(){return this._zoomEnableFlag.enable()}},{key:"enablePan",set:function(e){this.curOrbit.enablePan=e},get:function(){return this.curOrbit.enablePan}},{key:"flying",get:function(){return this.cameraObject.flying}},{key:"mode",set:function(e){this.mode!=e&&(this.curOrbit.enabled=!1,"earth"==e?(this.curOrbit=new THREE.EarthOrbitControls(this.app.renderCamera,this.app.mainDomElement),this.curOrbit.app=this.app,this.initOrbit(this.curOrbit),this.autoAdjustNear=!1):(this.curOrbit.dispose(),this.curOrbit=this.orbit,this.curOrbit.enabled=!0,this.autoAdjustNear=!0),this.cameraObject.controller=this.curOrbit)},get:function(){return this.curOrbit instanceof THREE.EarthOrbitControls?"earth":"normal"}},{key:"autoAdjustNear",set:function(e){this._autoAdjustNear=e,e||(this.cameraObject.near=this.cameraObject._near)},get:function(){return this._autoAdjustNear}},{key:"toggle3D",set:function(e){console.warn("[CameraController] Please use '.viewMode=THING.CameraView.Normal/TopView' to replace '.toggle3D'"),this.viewMode=e?oe.Normal:oe.TopView},get:function(){return console.warn("[CameraController] Please use '.viewMode == THING.CameraView.Normal' to replace '.toggle3D'"),this.viewMode==oe.Normal}},{key:"enabled",set:function(e){console.warn("[CameraController] Please use '.inputEnabled' to replace '.enabled'"),this.inputEnabled=e},get:function(){return console.warn("[CameraController] Please use '.inputEnabled' to replace '.enabled'"),this.inputEnabled}},{key:"minZoom",set:function(e){console.warn("[CameraController] Please use '.zoomLimited=[min, max]' to replace '.minZoom'"),this.zoomLimited=[e,this.zoomLimited[1]]},get:function(){return console.warn("[CameraController] Please use '.zoomLimited[0]' to replace '.minZoom'"),this.zoomLimited[0]}},{key:"maxZoom",set:function(e){console.warn("[CameraController] Please use '.zoomLimited=[min, max]' to replace '.maxZoom'"),this.zoomLimited=[this.zoomLimited[0],e]},get:function(){return console.warn("[CameraController] Please use '.zoomLimited[0]' to replace '.maxZoom'"),this.zoomLimited[1]}},{key:"minDistance",set:function(e){console.warn("[CameraController] Please use '.distanceLimited=[min, max]' to replace '.minDistance'"),this.distanceLimited=[e,this.distanceLimited[1]]},get:function(){return console.warn("[CameraController] Please use '.distanceLimited[0]' to replace '.minDistance'"),this.distanceLimited[0]}},{key:"maxDistance",set:function(e){console.warn("[CameraController] Please use '.distanceLimited=[min, max]' to replace '.maxDistance'"),this.distanceLimited=[this.distanceLimited[0],e]},get:function(){return console.warn("[CameraController] Please use '.distanceLimited[0]' to replace '.maxDistance'"),this.distanceLimited[1]}},{key:"minPolarAngle",set:function(e){console.warn("[CameraController] Please use '.verticalAngleLimited=[min, max]' to replace '.minPolarAngle'"),this.verticalAngleLimited=[e,this.verticalAngleLimited[1]]},get:function(){return console.warn("[CameraController] Please use '.verticalAngleLimited[0]' to replace '.minPolarAngle'"),this.verticalAngleLimited[0]}},{key:"maxPolarAngle",set:function(e){console.warn("[CameraController] Please use '.verticalAngleLimited=[min, max]' to replace '.maxPolarAngle'"),this.verticalAngleLimited=[this.verticalAngleLimited[0],e]},get:function(){return console.warn("[CameraController] Please use '.verticalAngleLimited[0]' to replace '.maxPolarAngle'"),this.verticalAngleLimited[1]}},{key:"minAzimuthAngle",set:function(e){console.warn("[CameraController] Please use '.horizontalAngleLimited=[min, max]' to replace '.minAzimuthAngle'"),this.horizontalAngleLimited=[e,this.horizontalAngleLimited[1]]},get:function(){return console.warn("[CameraController] Please use '.horizontalAngleLimited[0]' to replace '.minAzimuthAngle'"),this.horizontalAngleLimited[0]}},{key:"maxAzimuthAngle",set:function(e){console.warn("[CameraController] Please use '.horizontalAngleLimited=[min, max]' to replace '.maxAzimuthAngle'"),this.horizontalAngleLimited=[this.horizontalAngleLimited[0],e]},get:function(){return console.warn("[CameraController] Please use '.horizontalAngleLimited[0]' to replace '.maxAzimuthAngle'"),this.horizontalAngleLimited[1]}},{key:"verticalAngleLimited",set:function(e){console.warn("[CameraController] Please use '.yAngleLimited' to replace '.verticalAngleLimited'"),this.yAngleLimited=e},get:function(){return console.warn("[CameraController] Please use '.yAngleLimited' to replace '.verticalAngleLimited'"),this.yAngleLimited}},{key:"horizontalAngleLimited",set:function(e){console.warn("[CameraController] Please use '.xAngleLimited' to replace '.verticalAngleLimited'"),this.xAngleLimited=e},get:function(){return console.warn("[CameraController] Please use '.xAngleLimited' to replace '.verticalAngleLimited'"),this.xAngleLimited}},{key:"rotating",get:function(){return console.warn("[CameraController] Please use '.flying' to replace '.rotating'"),this.flying}},{key:"panSpeed",set:function(e){console.warn("[CameraController] Please use '.keyPanSpeed' to replace '.panSpeed'"),this.keyPanSpeed=e},get:function(){return console.warn("[CameraController] Please use '.keyPanSpeed' to replace '.panSpeed'"),this.keyPanSpeed}}]),e}(),Jr=function(){function e(t){I(this,e),this.app=t,this._currentParentObject=null,this._previous=null,this._current=null,this._root=null,this._options={}}return e.prototype.init=function(){this._root=this.app.root},e.prototype.buildState=function(e){var t=e.type;"Campus"==t&&(t="Outdoors");var r={};r.name=t+"Level";var i=[];e instanceof dt?(i.push("floor"),i.push("_floor")):e instanceof ct&&(i.push("building"),i.push("_building"));for(var n=0;n<i.length;n++)r[i[n]]=e;return r},e.prototype.buildAfterEnterState=function(e){var t=e.type;"Campus"==t&&(t="Outdoors");var r=this.previous?this.previous.type:"";"Campus"==r&&(r="Outdoors");var i={prevState:{name:r+"Level"},state:this.buildState(e),stateName:t+"Level"};return this.previous&&(this.previous instanceof ct?(i.prevState.building=this.previous,i.prevState._building=this.previous):this.previous instanceof dt&&(i.prevState.floor=this.previous,i.prevState._floor=this.previous)),i},e.prototype.buildBeforeEnterState=function(e){var t=e.type;"Campus"==t&&(t="Outdoors");var r=this.current?this.current.type:"";"Campus"==r&&(r="Outdoors");var i={prevState:{name:r+"Level"},curState:this.buildState(e),stateName:t+"Level"};return this.previous&&(this.previous instanceof ct?(i.prevState.building=this.previous,i.prevState._building=this.previous):this.previous instanceof dt&&(i.prevState.floor=this.previous,i.prevState._floor=this.previous)),i},e.prototype.getEventType=function(e,t){var r=t.type;return"Campus"==r&&(r="Outdoors"),e+r+"Level"},e.prototype.buildEventArguments=function(e){var t=e.type;"Campus"==t&&(t="Outdoors");var r={name:t+"Level"};return r.state=this.buildState(e),r},e.prototype.notifyBeforeEnterState=function(e){this.app.trigger("beforeEnterState",this.buildBeforeEnterState(e))},e.prototype.notifyAfterEnterState=function(e){this.app.trigger("afterEnterState",this.buildAfterEnterState(e))},e.prototype.nofityAfterLevelChange=function(e){var t=e.object;this.app.trigger(this.getEventType("enter",t),this.buildEventArguments(t)),this.app.trigger(this.getEventType("afterEnter",t),this.buildEventArguments(t))},e.prototype.notifyBeforeLevelChange=function(e){this.app.trigger(this.getEventType("beforeEnter",e),this.buildEventArguments(e))},e.prototype._getLevelType=function(){var e=this._current;return e instanceof at?fe.Campus:e instanceof ct?fe.Building:e instanceof dt?fe.Floor:e instanceof gt?fe.Room:e instanceof _e?fe.Thing:fe.Unknown},e.prototype._leaveLevel=function(e,t){if(this.app.trigger(ve.BeforeLevelChange,{level:this._getLevelType(),current:this._current,previous:this._previous,next:e}),this._current){var r={object:e,current:e,previous:this._current,hasJumped:t.hasJumped};this._current.trigger(ve.LeaveLevel,r),this.app.trigger(ve.LeaveLevel,r)}e&&(this.notifyBeforeLevelChange(e),this.notifyBeforeEnterState(e))},e.prototype._enterLevel=function(e,t){if(this._previous=this._current,this._current=e,this._currentParentObject=this._current,t.level=this._getLevelType(),t.current=this._current,t.object=this._current,t.previous=this._previous,this.app.trigger(ve.LevelChange,t),e){var r=t.lastObject;if(r.internalUserData.level_complete||(r.internalUserData.level_complete=!0,r.one(ve.EnterLevel,function(e){delete e.object.internalUserData.level_complete;var i=t.userComplete;i&&i(),r.one("cameraFlyComplete",{lastLevelChanged:!0},function(e){if(e.data.lastLevelChanged&&e.object==r){var i=t.flyComplete;i&&i()}})},"___level_complete___")),e.trigger(ve.LevelChange,t),this.notifyAfterEnterState(e),t.jumping){e.pauseEvent(ve.EnterLevel,null,ge.LevelFly),e.trigger(ve.EnterLevel,t),e.resumeEvent(ve.EnterLevel,null,ge.LevelFly);var i=t.complete;i&&i()}else e.trigger(ve.EnterLevel,t);t.object=e,this.app.trigger(ve.EnterLevel,t),this.nofityAfterLevelChange(t)}},e.prototype._change=function(e,t){t=t||{};var r=this;this.app.camera.toggleNormalViewMode(function(){r._change(e,t)})||("Outdoors"==e.type&&(console.warn("Please use campus to change, not outdoors"),e=e.parents.query(".Campus")[0]),e.hasEvent(ve.EnterLevel,null,!1)&&(this._leaveLevel(e,t),this._enterLevel(e,t)))},e.prototype.updateJumpBacking=function(e,t){var r=this._current;r&&(r.isChildOf(e)||r.isBrotherOf(e))&&(t.jumping=!0)},e.prototype.getParents=function(e,t){for(var r=[],i=e.parents,n=0;n<i.length;n++){var o=i[n];if(o==this.app.root)break;if(r.push(o),o==t)break}return r},e.prototype.getLevelPath=function(e,t){var r=[];if(this._current)if(this._current.isChildOf(e))(r=this.getParents(this._current,e)).length>=2&&(t.hasJumped=!0);else if(e.isChildOf(this._current))(r=(r=this.getParents(e,this._current)).reverse()).splice(0,1),r.push(e);else{(r=(r=this.getParents(e,null)).reverse()).push(e);for(var i=this._current.parents;r.length>2&&-1!==i.indexOf(r[0])&&-1!==i.indexOf(r[1]);)r.splice(0,1);r.length<=2&&(t.hasJumped=!0)}else r.push(e),r=(r=r.concat(e.parents.not(this.app.root).toArray())).reverse();return r},e.prototype.jumpLevelPath=function(e){var t=e.levelPath;if(t.splice(0,1),t.length){var r=t[0];if(1==t.length)delete e.jumping,this.app.off("cameraFlyComplete","sceneLevel_cameraFlyComplete");else{var i=t[t.length-1];this.updateJumpBacking(i,e)}this._change(r,e)}},e.prototype.change=function(e,t){if(t=t||{},e){if(e!=this.current){e instanceof be&&(e=e.building);var r=this.getLevelPath(e,t);if(r.length){if(t.userComplete=t.complete,t.userFlyComplete=t.flyComplete,r.length>1){t.levelPath=r;var i=this;t.hasJumped?t.complete=function(){i.jumpLevelPath(t)}:this.app.on("cameraFlyComplete",function(e){i.jumpLevelPath(t)},"sceneLevel_cameraFlyComplete")}var n=r[0],o=r.length>1?r[r.length-1]:null;o&&this.updateJumpBacking(o,t),t.lastObject=o||e,this._change(n,t)}}}else console.error("Please provide the object to change")},e.prototype.quit=function(e){e=e||{},this._current&&(this._leaveLevel(null,e),this._enterLevel(null,e))},e.prototype.back=function(){this._current&&this.backTo(this._current.parent)},e.prototype.backTo=function(e){var t=this;if(!this.app.camera.toggleNormalViewMode(function(){t.backTo(e)})){if(this._current==e)return;if(this._root==e)return;this.change(e)}},k(e,[{key:"current",get:function(){return this._current}},{key:"previous",get:function(){return this._previous}},{key:"root",set:function(e){this._root=e},get:function(){return this._root}},{key:"currentParentObject",set:function(e){this._currentParentObject=e},get:function(){return this._currentParentObject}},{key:"options",set:function(e){this._options=G.mergeObject(this._options,e,!0)},get:function(){return this._options}}]),e}(),Kr=function(e){function t(r){I(this,t);var i=N(this,e.call(this,r));i._defaultCampus=new at(r);var n=new ot(r);return i._envMapResources=n.load(r.options.env),i.init(),i}return D(t,e),t.prototype.init=function(){this.campuses.destroyAll(),this.app.level.currentParentObject=this,this.app.scene.add(this.node)},t.prototype.destroy=function(){e.prototype.destroy.call(this),this.app.resourceManager.disposeTextures(this._envMapResources)},t.prototype.cleanup=function(){this.app.scene.cleanup()},k(t,[{key:"envMapResources",get:function(){return this._envMapResources}},{key:"box",get:function(){if(this.boundingBoxDirty)return this.updateBounds(),this._box;for(var e=new THREE.Box3,t=this.campuses,r=0;r<t.length;r++){var i=t[r];e.union(i.box)}return e}},{key:"visible",set:function(e){this.app.scene.visible=e},get:function(){return this.app.scene.visible}},{key:"defaultCampus",get:function(){var e=this.campuses;return e.length?e[0]:this._defaultCampus}},{key:"things",get:function(){return this.query(".Thing",!1)}},{key:"campuses",get:function(){return this.query(".Campus",!1)}},{key:"wireframeColor",set:function(e){var t=G.parseColor(e);this.app.scene.overrideMaterial=t?new THREE.MeshBasicMaterial({color:t,wireframe:!0,side:THREE.DoubleSide,skinning:!0}):null}},{key:"static",set:function(e){this.app.scene.autoUpdate=!e},get:function(){return!this.app.scene.autoUpdate}}]),t}(ye),Zr=function(){function e(t){I(this,e),this.app=t,this._cameraBackups={},this._campusSkyBox=null,this._campusSkyBoxColorTween=null,this._levelChanging=!1,this.init()}return e.prototype.setCampusSkyBoxColorScaleFactor=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3;this._campusSkyBoxColorTween&&this._campusSkyBoxColorTween.stop();var r=G.parseVector3(this.app.backgroundColorScaleFactor),i=G.parseVector3(e),n=this;this._campusSkyBoxColorTween=new TWEEN.Tween(r).to(i,t).onUpdate(function(){n.app.backgroundColorScaleFactor=[this._object.x,this._object.y,this._object.z]}),this._campusSkyBoxColorTween.start()},e.prototype.backupCameraInfo=function(e){this._cameraBackups[e]=this._cameraBackups[e]||{};var t=this._cameraBackups[e];t.position=this.app.camera.position,t.target=this.app.camera.target},e.prototype.clearCameraInfo=function(e){delete this._cameraBackups[e]},e.prototype.getCameraPosition=function(e){var t=this._cameraBackups[e];return t?t.position:null},e.prototype.getCameraTarget=function(e){var t=this._cameraBackups[e];return t?t.target:null},e.prototype.initAppEvents=function(){var e=this;this.app.on("cameracontrollerchanged",function(t){e.app.level.current&&e._levelChanging&&e.app.camera.stopFlying()},ge.LevelFlyBreak),this.app.on("dblclick",function(t){if(0==t.button){var r=e.app.level;if(r.current){var i=t.object;i&&r.change(i)}}},ge.LevelEnterMethod),this.app.on("click",function(t){if(2==t.button){var r=e.app.level;if(r.current){var i=t.object;i&&(i.style.outlineColor=null),r.back()}}},ge.LevelBackMethod),this.app.on(ve.Pick,function(t){e.app.level.current&&(t.previousObjects.style.outlineColor=null,t.object&&(t.object.style.outlineColor=255))},ge.LevelPickMethod),this._campusSkyBox=this.app.skyBox},e.prototype.buildFlyParams=function(e,t){t=t||{};var r=this;e._flyStart=function(){r._levelChanging=!0},e._flying=function(){r._levelChanging=!0},e._flyStop=function(){r._levelChanging=!1},e._flyComplete=function(){r._levelChanging=!1},e.distance=e.distance||t.distance,e.time=G.parseValue(e.time||t.time,1e3),e.keepDirection=G.parseValue(e.keepDirection||t.keepDirection,!1);var i=this.app.level.current;return t.lastObject==i&&(e.offset=e.offset||t.offset,e.worldOffset=e.worldOffset||t.worldOffset,e.radius=e.radius||t.radius||i.boundingBox.radius,e.xAngle=G.parseValue(e.xAngle||t.xAngle,null),e.yAngle=G.parseValue(e.yAngle||t.yAngle,null)),e},e.prototype.registerSceneLevelEvents=function(){var e=this;this.app.on(ve.EnterLevel,".Campus",function(t){e.onCampusLevelSetBackground(t)},ge.LevelSetBackground),this.app.on(ve.EnterLevel,".Campus",function(t){e.onCampusLevelSceneOperations(t)},ge.LevelSceneOperations),this.app.on(ve.EnterLevel,".Campus",function(t){e.onCampusLevelPickedResultFunc(t)},ge.LevelPickedResultFunc),this.app.on(ve.EnterLevel,".Campus",function(t){e.onCampusLevelFly(t)},ge.LevelFly),this.app.on(ve.LeaveLevel,".Campus",function(t){e.onCampusLevelLeaveSceneOperations(t)},ge.LevelSceneOperations),this.app.on(ve.EnterLevel,".Building",function(t){e.onBuildingLevelSetBackground(t)},ge.LevelSetBackground),this.app.on(ve.EnterLevel,".Building",function(t){e.onBuildingLevelSceneOperations(t)},ge.LevelSceneOperations),this.app.on(ve.EnterLevel,".Building",function(t){e.onBuildingLevelPickedResultFunc(t)},ge.LevelPickedResultFunc),this.app.on(ve.EnterLevel,".Building",function(t){e.onBuildingLevelFly(t)},ge.LevelFly),this.app.on(ve.LeaveLevel,".Building",function(t){e.onBuildingLevelLeaveSceneOperations(t)},ge.LevelSceneOperations),this.app.on(ve.EnterLevel,".Floor",function(t){e.onFloorLevelSetBackground(t)},ge.LevelSetBackground),this.app.on(ve.EnterLevel,".Floor",function(t){e.onFloorLevelSceneOperations(t)},ge.LevelSceneOperations),this.app.on(ve.EnterLevel,".Floor",function(t){e.onFloorLevelPickedResultFunc(t)},ge.LevelPickedResultFunc),this.app.on(ve.EnterLevel,".Floor",function(t){e.onFloorLevelFly(t)},ge.LevelFly),this.app.on(ve.LeaveLevel,".Floor",function(t){e.onFloorLevelLeaveSceneOperations(t)},ge.LevelSceneOperations),this.app.on(ve.EnterLevel,".Room",function(t){e.onRoomLevelSetBackground(t)},ge.LevelSetBackground),this.app.on(ve.EnterLevel,".Room",function(t){e.onRoomLevelSceneOperations(t)},ge.LevelSceneOperations),this.app.on(ve.EnterLevel,".Room",function(t){e.onRoomLevelPickedResultFunc(t)},ge.LevelPickedResultFunc),this.app.on(ve.EnterLevel,".Room",function(t){e.onRoomLevelFly(t)},ge.LevelFly),this.app.on(ve.LeaveLevel,".Room",function(t){e.onRoomLevelLeaveSceneOperations(t)},ge.LevelSceneOperations),this.app.on(ve.EnterLevel,".Thing",function(t){e.onThingLevelSetBackground(t)},ge.LevelSetBackground),this.app.on(ve.EnterLevel,".Thing",function(t){e.onThingLevelSceneOperations(t)},ge.LevelSceneOperations),this.app.on(ve.EnterLevel,".Thing",function(t){e.onThingLevelPickedResultFunc(t)},ge.LevelPickedResultFunc),this.app.on(ve.EnterLevel,".Thing",function(t){e.onThingLevelFly(t)},ge.LevelFly),this.app.on(ve.LeaveLevel,".Thing",function(t){e.onThingLevelLeaveSceneOperations(t)},ge.LevelSceneOperations)},e.prototype.onCampusLevelSetBackground=function(e){this._campusSkyBox&&(this.app.skyBox=this._campusSkyBox),this.setCampusSkyBoxColorScaleFactor([1,1,1])},e.prototype.onCampusLevelSceneOperations=function(e){var t=e.object;for(t.style.outlineColor=null,t.visible=!0,t.outdoors&&(t.outdoors.visible=!0),i=0;i<t.children.length;i++)t.children[i].visible=!0;for(var r=t.buildings,i=0;i<r.length;i++){var n=r[i];n.visible=!0;var o=n.floors,a=n.facades;n.hasFacades()?(a.visible=!0,o.visible=!1,n.showAllRoofs(!1)):(o.visible=!0,n.showAllRoofs(!0))}},e.prototype.onCampusLevelPickedResultFunc=function(e){function t(e){return"Outdoors"!=e.type&&!!function(e){var t=e.app.level.current;if(!t)return!0;if(e instanceof ar)return!0;if(e instanceof or)return!0;if(e.parent==t){if(e instanceof ct)return!0;if(e instanceof _e)return!0}return!1}(e)}this.app.picker.pickedResultFunc=function(e){if(t(e))return e;for(var r=e.parents,i=0;i<r.length;i++){var n=r[i];if(t(n))return n}}},e.prototype.onCampusLevelFly=function(e){var t,r,i=e.object,n=i.sceneJSONData.camInfo;n&&(t=n.eye.concat(),r=n.target.concat(),t=i.selfToWorld(t),r=i.selfToWorld(r));var o=e.position||this.getCameraPosition("Campus")||t,a=e.target||this.getCameraTarget("Campus")||r||i,s=e.radius||Math.min(i.boundingBox.radius,300);this.app.camera.flyTo(this.buildFlyParams({position:o,target:a,radius:s},e))},e.prototype.onCampusLevelLeaveSceneOperations=function(e){if(e.current){var t=e.object;if(!t.things.has(e.current)){t.outdoors&&(t.outdoors.visible=!1);for(var r=0;r<t.children.length;r++)t.children[r].visible=!1}e.hasJumped||this.backupCameraInfo("Campus")}},e.prototype.onBuildingLevelSetBackground=function(e){this.app.skyBox="White",this.setCampusSkyBoxColorScaleFactor([.5,.5,.5])},e.prototype.onBuildingLevelSceneOperations=function(e){var t=e.object;t.style.outlineColor=null;var r=t.parents.query(".Campus")[0];r.visible=!0,t.visible=!0,t.facades.visible=!1,r.buildings.not(t).visible=!1;var i=t.floors;i.visible=!0;for(var n=0;n<i.length;n++)i[n].showAllRoofs(!1)},e.prototype.onBuildingLevelPickedResultFunc=function(e){function t(e){return!e.app.level.current||e instanceof ar||e instanceof or||e instanceof dt&&"Outdoors"!=e.type}this.app.picker.pickedResultFunc=function(e){if(t(e))return e;for(var r=e.parents,i=0;i<r.length;i++){var n=r[i];if(t(n))return n}}},e.prototype.onBuildingLevelFly=function(e){var t=e.object;this.app.camera.flyTo(this.buildFlyParams({target:t},e))},e.prototype.onBuildingLevelLeaveSceneOperations=function(e){e.object.style.outlineColor=null},e.prototype.onFloorLevelSetBackground=function(e){this.app.skyBox="White",this.setCampusSkyBoxColorScaleFactor([.25,.25,.25])},e.prototype.onFloorLevelSceneOperations=function(e){var t=e.object;t.style.outlineColor=null,t.parents.query(".Campus")[0].visible=!0,t.visible=!0,t.building.floors.not(t).visible=!1,t.showAllRoofs(!1)},e.prototype.onFloorLevelPickedResultFunc=function(e){function t(e){return!e.app.level.current||e instanceof ar||e instanceof or||e instanceof gt||e instanceof _e}this.app.picker.pickedResultFunc=function(e){if(t(e))return e;for(var r=e.parents,i=0;i<r.length;i++){var n=r[i];if(t(n))return n}}},e.prototype.onFloorLevelFly=function(e){var t=e.object;if(e.previous instanceof ct)this.app.camera.flyTo(this.buildFlyParams({target:t},e)),this.clearCameraInfo("Floor");else{var r=this.getCameraPosition("Floor"),i=this.getCameraTarget("Floor");this.app.camera.flyTo(this.buildFlyParams({position:r,target:i},e))}},e.prototype.onFloorLevelLeaveSceneOperations=function(e){e.object.style.outlineColor=null,this.backupCameraInfo("Floor")},e.prototype.onRoomLevelSetBackground=function(e){},e.prototype.onRoomLevelSceneOperations=function(e){var t=e.object;t.style.outlineColor=null;for(var r=t.brothers.query(".Room"),i=0;i<r.length;i++)r[i].things.style.opacity=.25},e.prototype.onRoomLevelPickedResultFunc=function(e){function t(e){return!e.app.level.current||e instanceof ar||e instanceof or||e instanceof gt&&e!=e.app.level.current||!!(e instanceof _e&&e.app.level.current.things.has(e))}this.app.picker.pickedResultFunc=function(e){if(t(e))return e;for(var r=e.parents,i=0;i<r.length;i++){var n=r[i];if(t(n))return n}}},e.prototype.onRoomLevelFly=function(e){var t=e.object;this.app.camera.flyTo(this.buildFlyParams({target:t},e))},e.prototype.onRoomLevelLeaveSceneOperations=function(e){var t=e.object;t.style.outlineColor=null;for(var r=t.brothers.query(".Room"),i=0;i<r.length;i++)r[i].things.style.opacity=null},e.prototype.onThingLevelSetBackground=function(e){},e.prototype.onThingLevelSceneOperations=function(e){var t=e.object;t.style.outlineColor=null,t.brothers.query(".Thing").style.opacity=.25},e.prototype.onThingLevelPickedResultFunc=function(e){function t(e){var t=e.app.level.current;return!t||!!e.isChildOf(t)||e instanceof ar||e instanceof or||!!(e instanceof _e&&e.isBrotherOf(t))}this.app.picker.pickedResultFunc=function(e){if(t(e))return e;for(var r=e.parents,i=0;i<r.length;i++){var n=r[i];if(t(n))return n}}},e.prototype.onThingLevelFly=function(e){var t=e.object,r=G.parseValue(e.keepDirection,!0);this.app.camera.flyTo(this.buildFlyParams({target:t,keepDirection:r},e))},e.prototype.onThingLevelLeaveSceneOperations=function(e){var t=e.object;t.style.outlineColor=null,t.brothers.query(".Thing").style.opacity=null},e.prototype.init=function(){this.initAppEvents(),this.registerSceneLevelEvents()},e}(),$r=function(){function e(t){I(this,e),this.app=t}return e.prototype.isSupportWebGL=function(){if(void 0===this._supportWebGL)if("WebGLRenderingContext"in window){for(var e=document.createElement("canvas"),t=["webgl","experimental-webgl","ms-webgl","moz-webgl","opera-3d","webkit-3d","ms-3d","3d"],r="",i=!1,n=-1,o=t.length;++n<o;)try{if(e.getContext(t[n])){r=t[n],i=!0;break}}catch(e){}this._supportWebGL=!!i&&("webgl"==r||"experimental-webgl"==r)}else this._supportWebGL=!1;return this._supportWebGL},e}(),ei=function(){function e(t){I(this,e),this.app=t,this._materials={},this._materialsAlwaysOnTop={}}return e.prototype.get=function(e,t,r){r=r||{};var i;return e?(this._materials[e]=this._materials[e]||new THREE.SpriteMaterial({color:16777215,transparent:!0}),(i=this._materials[e]).refCount=i.refCount||1,r.skipRefCount||i.refCount++,t&&(this._materialsAlwaysOnTop[e]=this._materialsAlwaysOnTop[e]||i.clone(),(i=this._materialsAlwaysOnTop[e]).depthTest=!1,i.depthWrite=!1,i.refCount=i.refCount||1,r.skipAlwaysOnTopRefCount||i.refCount++)):(i=new THREE.SpriteMaterial({color:16777215,transparent:!0}),t&&(i.depthTest=!1,i.depthWrite=!1)),i},e.prototype.unloadMaterial=function(e,t){var r=t[e];r&&this.app.resourceManager.disposeMaterial(r)&&delete t[e]},e.prototype.unload=function(e){this.unloadMaterial(e,this._materials),this.unloadMaterial(e,this._materialsAlwaysOnTop)},e}(),ti=function(){function e(t,r){I(this,e),this.app=t,this.modelResource=t.modelResource,this.refCount=1,this.URL=r,this.node=null,this.animations=null,this.geometry=null,this.materials=null}return e.prototype.load=function(e){var t=e.node,r=e.animations,i=e.geometry,n=e.materials;if(i)this.animations=i.animations,this.geometry=i,this.materials=n;else if(t){var o=this.node!=t;this.node=t,r?this.animations=r:(o||null===r)&&(this.animations=null)}},e.prototype.get=function(){return this.refCount++,this},e.prototype.unload=function(){return!(0!==this.refCount&&(this.refCount--,this.refCount)||this.modelResource.residentMode||(this.app.resourceManager.unload(this.node),this.node=null,this.animations=null,this.geometry=null,this.materials=null,0))},e.prototype.cloneNode=function(){if(this.node){var e=this.node.clone();if(e.traverse(function(e){var t=e.geometry;t&&(t.refCount=t.refCount||1,t.refCount++)}),e.hasSkinnedMesh())for(var t=this.node.getSkinnedMeshes(),r=0;r<t.length;r++){var i=t[r],n=t[r].skeleton,o=e.getBones(this.node,t[r].skeleton),a=e.getSkinnedMeshes()[r],s=new THREE.Skeleton(o,n.boneInverses);a.bind(s,i.bindMatrix)}return e}if(this.geometry)return(a=new THREE.SkinnedMesh(this.geometry,this.materials)).scale.set(1,1,1),a},e}(),ri=function(){function e(t){I(this,e),this.app=t,this.isResidentMode=!1,this.models={},this.loadingModels={},this.waitModels=[]}return e.prototype.onBackgroundProgress=function(e){},e.prototype.get=function(e){var t=this.models[e];return t?t.get():null},e.prototype.set=function(e,t,r){var i=this.models[e];return i?i.unload():(i=new ti(this.app,e),this.models[e]=i),t&&r&&i.load({node:t,animations:r}),i},e.prototype.unload=function(e){if(void 0===e){for(var e in this.models)this.models[e].unload();return this.clear(),!0}var t=this.models[e];return!(!t||!t.unload()||(delete this.models[e],0))},e.prototype.clear=function(e){G.isNull(e)?this.models={}:delete this.models[e]},e.prototype._download=function(e,t,r,i,n){var o=this;new thingjs.GLTFLoader(this.app.loadingManager).loadFromURL({url:e,modelCallback:function(t){var i=t.url,n=o.get(i);n||(n=o.set(i)).load(t),delete o.loadingModels[e],r&&r(n)},errorCallback:function(t){delete o.loadingModels[e],n&&n(t)},jsonCallback:t,progressCallback:i})},e.prototype.download=function(e,t,r,i,n){this.loadingModels[e]?this.waitModels.push({url:e,jsonCallback:t,modelCallback:r,progressCallback:i,errorCallback:n}):(this.loadingModels[e]={},this._download(e,t,r,i,n))},e.prototype.preload=function(e,t){var r=(t=t||{}).complete;if(G.isArray(e))for(var i=0,n=e.length,o=0;o<n;o++)this.download(e[o],function(){},function(e){++i==n&&r&&r()},function(){},function(){++i==n&&r&&r()});else G.isString(e)&&this.download(e,function(){},function(e){r&&r()},function(){},function(){r&&r()})},e.prototype.needWait=function(e){var t=e.url;return!!this.loadingModels[t]},e.prototype.update=function(){for(var e=0;e<this.waitModels.length;e++){var t=this.waitModels[e];this.needWait(t)||(this._download(t.url,t.jsonCallback,t.modelCallback,t.progressCallback,t.errorCallback),this.waitModels.splice(e--,1))}},k(e,[{key:"residentMode",set:function(e){if(this.isResidentMode=e,!e){var t=[];for(var r in this.models){var i=this.models[r];0===i.refCount&&(o=i.URL,i.unload()&&t.push(o))}for(var n=0;n<t.length;n++){var o=t[n];delete this.models[o]}}},get:function(){return this.isResidentMode}}]),e}(),ii=function(){function e(t){I(this,e),this.app=t,this.particles={}}return e.prototype.get=function(e){return this.particles[e]},e.prototype.set=function(e,t){this.particles[e]=t},e.prototype.download=function(e,t){var r=e.appendPath("index.json"),i=this;new THREE.FileLoader(this.app.loadingManager).load(r,function(r){var n=JSON.parse(r);i.set(e,n),t&&t(n)},function(){},function(){})},e}(),ni=function(){function e(t){I(this,e),this.app=t,this.picker=t.picker,this.pickDownPosition=[0,0]}return e.prototype.processPicking=function(e){this.picker.processPicking(e)},e.prototype.processAreaPicking=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=this.picker,i=r.pickingArea,n=new Y(this.app);t?n.buildReturnObject(i.processPicking(r.areaCandidates)):(this.processPicking(e),r.areaCandidates.has(e.object)?n.buildReturnObject([e.object]):n.buildReturnObject([])),this.picker.setPickedObject(n),this.app.trigger(ve.AreaPicking,{objects:n})},e.prototype.onUpdate=function(e){var t=this.picker;if(!t.areaPicking){var r=t.pickingArea;r.started&&r.end()}t.update(this.app._deltaTime)},e.prototype.onMouseMove=function(e){var t=this.picker;if(t.areaPicking){var r=t.pickingArea;r.started&&(r.move(e.clientX,e.clientY),r.realTimePicking&&(e.areaPicking=!0,this.processAreaPicking(e)))}else this.processPicking(e),this.picker.setPickedObject(e.object)},e.prototype.onMouseUp=function(e){var t=this.picker;if(t.areaPicking){if(0==e.button){var r=Math.getDistance(this.pickDownPosition,[e.x,e.y])>4;e.finishedAreaPicking=!0,this.processAreaPicking(e,r),t.pickingArea.end()}}else e.ignoreFrameCheck=!0,t.processPicking(e)},e.prototype.onMouseDown=function(e){var t=this.picker;this.pickDownPosition=[e.clientX,e.clientY],t.areaPicking?0==e.button&&t.pickingArea.start(e.clientX,e.clientY):(e.ignoreFrameCheck=!0,t.processPicking(e))},e.prototype.onDoubleClick=function(e){e.ignoreFrameCheck=!0,this.processPicking(e)},e.prototype.onSingleClick=function(e){e.ignoreFrameCheck=!0,this.processPicking(e)},e.prototype.onClick=function(e){e.ignoreFrameCheck=!0,this.picker.processPicking(e)},e.prototype.onDragStart=function(e){var t=this.picker,r=t.processPicking(e);if(null!=r){var i=r.object;i&&(i.draggable?(i.dragState=ue.Dragging,i.internalUserData.prevPickable=i.pickable,i.pickable=!1,t.dragIntersect=r,this.app.camera.disable({rotate:!0})):e.object=null)}},e.prototype.onDrag=function(e){var t=this.picker;null!=t.dragIntersect&&(e.disableGPUPicker=!0,t.processPicking(e),delete e.disableGPUPicker,this.app.needUpdate=!0)},e.prototype.onDragEnd=function(e){var t=this.picker;if(null!=t.dragIntersect){var r=t.dragIntersect.object;r&&(r.dragState=ue.DragEnd);var i=r.internalUserData.prevPickable;i&&(r.pickable=i),delete r.internalUserData.prevPickable,e.object=r,t.dragIntersect=null,this.app.camera.resume({rotate:!0})}},e}(),oi=function(){function e(t){I(this,e),this.app=t,this.camera=t.camera,this.updateTime=0,this.lastAdjustCameraNear=0}return e.prototype.getAdjustCameraNear=function(e){var t=this.camera.distance;if(t>10){var r=this.camera.worldToScreen(this.camera.target),i=this.camera.screenToWorld(r);if(i){if(this.updateTime>=.5){this.updateTime=0;var n=G.parseVector3(i),o=G.parseVector3(this.camera.position),a=Math.min(t,n.distanceTo(o));if(a>e){var s=this.app.picker.intersectResult(r[0],r[1],null,{ignoreFrameCheck:!1,skipUpdateTexture:!0});s&&s.picked&&(n=s.getPickedPosition(!1))&&(n=G.parseVector3(n),a=Math.min(a,o.distanceTo(n)))}this.lastAdjustCameraNear=a/e}return this.lastAdjustCameraNear}}return this.camera.near},e.prototype.processAdjustCameraNear=function(){var e=this.app.camera.flying?80:40,t=Math.max(.1,this.getAdjustCameraNear(e));this.app.renderCamera.setNear(t)},e.prototype.onUpdate=function(){this.updateTime+=this.app._deltaTime},e.prototype.onEnter=function(){var e=this;this.app.on("cameraChange",function(t){e.camera.autoAdjustNear&&!e.camera.toggling&&e.processAdjustCameraNear()},"cameraState_change")},e.prototype.onLeave=function(){this.app.off("cameraChange","cameraState_change")},e}(),ai=function(){function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"translate",i=arguments[2];I(this,e),t&&(this._object=t,this._axis=null,this._prevPosition=this._object.node.position.clone(),this.init(t.app,r,i),this.control.attach(this._object.node),this.app.scene.add(this.control))}return e.prototype.init=function(e,t,r){this.app=e,this.control=new THREE.TransformControls(this.app.renderCamera,this.app.mainDomElement),this.control.traverse(function(e){e.userData.skipOutline=!0,e.userData.useVisibleOnly=!0});var i=this;this.control.addEventListener("change",function(e){i.onGizmoChange(e)}),this.control.addEventListener("objectChange",function(e){i.onGizmoObjectChange(e)}),this.control.addEventListener("mouseDown",function(e){i.onGizmoMouseDown(e)}),this.control.addEventListener("mouseUp",function(e){i.onGizmoMouseUp(e)}),this.mode="translate",G.isString(t)?(this.mode=t,this.params=r||{}):this.params=t||{},this.app.on("cameraViewChange",function(e){e.view==ne.Orthographic?i.setAxis("XZ"):i.setAxis("XYZ")}),this.app.camera.viewMode==ne.Orthographic&&this.setAxis("XZ")},e.prototype.onGizmoChange=function(e){},e.prototype.onGizmoObjectChange=function(e){if(this._object){var t=new THREE.Vector3;t.subVectors(this._object.node.position,this._prevPosition),this._object.updateBox(t),this._prevPosition.copy(this._object.node.position)}this.app.needUpdate=!0;var r=this.params.change;r&&r.call(this,{object:this._object})},e.prototype.onGizmoMouseDown=function(e){this.app.camera.disable({rotate:!0});var t=this.params.changeStart;t&&t.call(this,{object:this._object})},e.prototype.onGizmoMouseUp=function(e){this.app.camera.resume({rotate:!0});var t=this.params.changeEnd;t&&t.call(this,{object:this._object})},e.prototype.onRemove=function(){this.app.scene.remove(this.control),this.control.detach(),this.control.dispose()},e.prototype.onVisible=function(e){this.control.enabled&&(this.control.visible=e)},e.prototype.setAxis=function(e){if(this._axis=e,this._axis&&"XYZ"!=this._axis){var t=this,r=new THREE.Raycaster;this.control.userData.original_pointerHover=this.control.pointerHover,this.control.axis=e,this.control.pointerHover=function(e){if(void 0!==this.object&&!0!==this.dragging&&(void 0===e.button||0===e.button)){r.setFromCamera(e,this.camera);var i=r.intersectObjects(this._gizmo.picker[this.mode].children,!0)[0]||!1;i?-1!=t._axis.search(i.object.name)&&(this.axis=i.object.name):this.axis=""}}}else this.control.pointerHover=this.control.userData.original_pointerHover,delete this.control.userData.original_pointerHover},e.prototype.detach=function(){this.control.detach()},e.prototype.attach=function(e){this.control.attach(e)},e.prototype.setSize=function(e){console.warn("[AxisTransformControl] Please use '.size' to replace 'setSize()'"),this.size=e},k(e,[{key:"object",get:function(){return this.control.object}},{key:"node",get:function(){return this.control}},{key:"mode",set:function(e){if(e){if("translate"!=e&&"rotate"!=e&&"scale"!=e)return void console.error('[AxisTransformControl] mode is invalid, must be "translate/rotate/scale"');this.control.setMode(e)}},get:function(){return this.control.getMode()}},{key:"space",set:function(e){if(e){if("world"!=e&&"local"!=e)return void console.error('[AxisTransformControl] space is invalid, must be "world/local"');this.control.setSpace(e)}},get:function(){return this.control.space}},{key:"size",set:function(e){this.control.setSize(e)},get:function(){return this.control.size}},{key:"visible",set:function(e){this.control.visible=e,this.control.enabled=e},get:function(){return this.control.visible}}]),e}(),si=function(){function e(t){I(this,e),this.state=t,this.app=t.app,this.control=t.control,this.root=new THREE.Group,this.root.userData.childUseWorldAnglesAlways=!0,this.root.name="EditObjectGroup",this.lastRootPosition=null,this.lastRootScale=null,this.lastRootRotation=null}return e.prototype.hasChanged=function(){var e=this.root.position,t=this.root.scale,r=this.root.rotation;return!(this.lastRootPosition.equals(e)&&this.lastRootScale.equals(t)&&this.lastRootRotation.equals(r))},e.prototype.recordTranslation=function(){this.state.execute({type:"SetNodeTranslation",node:this.root,position:this.lastRootPosition,scale:this.lastRootScale,rotation:this.lastRootRotation}),this.synTranslation()},e.prototype.notify=function(e){for(var t=this.root.children,r=0;r<t.length;r++){var i=t[r].userData,n=this.app.objectManager.get(i.id);if(n){var o=n.userData._editCallbacks;o&&o[e].call(n);var a=n.userData.selectObjectCallback;a&&a.call(n)}}},e.prototype._pushSubNodeAttach=function(e,t,r,i,n){var o=this.app.objectManager.getAncestors(t);e.push({type:"AttachNode",node:o.node,nodeParent:o.node.userData.nodeParent})},e.prototype.recordSubNodeAttach=function(e,t,r,i){var n=[];this._pushSubNodeAttach(n,e,t,r,i),this.state.execute(n),this.synTranslation()},e.prototype._pushSubNodeOnlyAttach=function(e,t,r,i,n,o,a,s,l){for(var c=0;c<r.length;c++){var u=r[c];this.hasSelected(u)&&e.push({type:"AttachNode",node:r[c].node,nodeParent:i[c]})}},e.prototype.recordSubNodeOnlyAttach=function(e,t,r,i,n,o,a,s){var l=[];this._pushSubNodeOnlyAttach(l,e,t,r,i,n,o,a,s),this.state.execute(l),this.synTranslation()},e.prototype._pushNodeAttach=function(e,t,r,i,n){e.push({type:"AttachNode",node:t.node,nodeParent:r})},e.prototype.recordNodeAttach=function(e,t,r,i){var n=[];this._pushNodeAttach(n,e,t,r,i),this.state.execute(n),this.synTranslation()},e.prototype._pushNodeOnlyAttach=function(e,t,r,i,n,o,a,s,l){e.push({type:"AttachNode",node:t.node,nodeParent:r});for(var c=0;c<i.length;c++)i[c]!=t&&e.push({type:"AttachNode",node:i[c].node,nodeParent:n[c]})},e.prototype.recordNodeOnlyAttach=function(e,t,r,i,n,o,a,s){var l=[];this._pushNodeOnlyAttach(l,e,t,r,i,n,o,a,s),this.state.execute(l),this.synTranslation()},e.prototype._pushNodesAttach=function(e,t,r,i,n){for(var o=0;o<t.length;o++){var a=t[o],s=r[o];e.push({type:"AttachNode",node:a.node,nodeParent:s})}},e.prototype.recordNodesAttach=function(e,t,r,i){var n=[];this._pushNodesAttach(n,e,t,r,i),this.state.execute(n)},e.prototype._pushSubNodesAttach=function(e,t,r,i,n){},e.prototype.recordSubNodesAttach=function(e,t,r,i){var n=[];this._pushSubNodesAttach(n,e,t,r,i),this.state.execute(n)},e.prototype.synTranslation=function(){this.lastRootPosition=this.root.position.clone(),this.lastRootScale=this.root.scale.clone(),this.lastRootRotation=this.root.rotation.clone();for(var e=0;e<this.root.children.length;e++){var t=this.root.children[e].userData.id;t&&(this.app.objectManager.get(t).dirty=!0)}},e.prototype.updateRoot=function(){this.updateControl(),this.updateRootVisible(),this.updateRootPosition(),this.updateSelections(),this.synTranslation(),this.app.needUpdate=!0},e.prototype._getNodeCenterPosition=function(e){var t=new THREE.Vector3;if(this.state._isSubNode(e))e.getWorldPosition(t);else{var r=this.app.objectManager.get(e.userData.id);if(r){var i=r.position,n=r.centerPos;n?(t.set(n[0],0,n[1]),r.node.updateMatrixWorld(),t.applyMatrix4(r.node.matrixWorld),t.y=i[1]):t=G.parseVector3(i)}else e.getWorldPosition(t)}return t},e.prototype.clearSelections=function(){this.state._selectionObjects.clear()},e.prototype.addSelection=function(e){this.state._selectionObjects.add(e)},e.prototype.hasSelected=function(e){return this.state._selectionObjects.has(e)},e.prototype.updateSelections=function(){this.state.objects,this.clearSelections();for(var e=0;e<this.root.children.length;e++){var t=this.root.children[e].userData,r=t.id;if(r){var i=this.app.objectManager.get(r);t.subNode||this.addSelection(i)}}},e.prototype.updateControl=function(){this.control.object||this.root.children.length&&(this.control.attach(this.root),this.app.scene.add(this.control.node),this.synTranslation())},e.prototype.updateRootVisible=function(){this.root.children.length?this.root.visible=!0:this.root.visible=!1,this.control.visible=this.root.visible},e.prototype.updateRootPosition=function(){var e=this.root.children;if(e.length){for(var t=new THREE.Vector3,r=0;r<e.length;r++){var i=e[r],n=this._getNodeCenterPosition(i);t.add(n)}t.divideScalar(e.length);var o=this.root.parent.worldToLocal(t),a=this.root.detachChildren(this.app.scene);this.root.position.copy(o),this.root.attachChildren(a,this.app.scene)}},e.prototype.getObjectInfo=function(e,t){for(var r=new Set,i=this.root.children,n=0;n<i.length;n++){var o=i[n],a=this.app.objectManager.get(o.userData.id);if(!r.has(a)&&(r.add(a),e&&e.push(a),t)){var s=a.node.userData.nodeParent;t.push(s)}}},e.prototype.getSubNodeInfo=function(e,t){var r=this;this.root.traverse(function(i){var n=r.app.objectManager.get(i.userData.id);if(n&&-1!==n.getSubNodeIndex(i)&&(e&&e.push(i),t)){var o=i.userData.nodeParent;t.push(o)}})},e.prototype.recordNodeParent=function(e){e.isBaseObject&&(e=e.node);var t=e.parent;t!=this.root&&(e.userData.nodeParent=t)},e.prototype._pushAddObjects=function(e,t){if(t&&t.length){for(var r=[],i=0;i<t.length;i++)n=t[i],this.hasSelected(n)||r.push(n);if(r.length)for(i=0;i<r.length;i++){var n=r[i];this.recordNodeParent(n),e.push({type:"AttachNode",node:n.node,nodeParent:this.root})}}},e.prototype._dispatchBreakableEvent=function(e,t){return t.continueFlag=!0,this.app.trigger(e,t),t.continueFlag},e.prototype.addObjects=function(e){var t=[];this._pushAddObjects(t,e),this.state.execute(t),this.updateRoot()},e.prototype._pushAddSubNodes=function(e,t){if(t.length)for(var r=0;r<t.length;r++){var i=t[r];this.state._isSubNode(i)&&(i.isChildOf(this.root)||this.recordNodeParent(i))}},e.prototype.addSubNodes=function(e){var t=[];this._pushAddSubNodes(t,e),this.state.execute(t),this.updateRoot()},e.prototype.addSubNode=function(e){return!!this.state._isSubNode(e)&&(!!this.app.objectManager.getAncestors(e)&&(this.recordNodeParent(e),this.recordSubNodeAttach(e,this.root,this.state.selectOutlineColor,null),this.updateRoot(),!0))},e.prototype.addSubNodeOnly=function(e){if(!e)return!1;if(!e.userData.subNode)return!1;if(!this.app.objectManager.getAncestors(e))return!1;var t=[],r=[];this.getObjectInfo(t,r);var i=[],n=[];this.getSubNodeInfo(i,n);for(var o=0;o<i.length;o++)if(i[o]==e){i.splice(o,1);break}return this.recordNodeParent(e),this.recordSubNodeOnlyAttach(e,t,r,i,n,this.root,this.state.selectOutlineColor,null),this.updateRoot(),!0},e.prototype.add=function(e,t){t&&this.addSubNode(t.intersect.node)||(this.recordNodeParent(e),this.recordNodeAttach(e,this.root,this.state.selectOutlineColor,null),this.updateRoot())},e.prototype.addOnly=function(e,t){if(!(t&&this.addSubNodeOnly(t.intersect.node)||1==this.root.children.length&&this.has(e))){var r=[],i=[];this.getObjectInfo(r,i);var n=[],o=[];this.getSubNodeInfo(n,o),this.recordNodeParent(e),this.recordNodeOnlyAttach(e,this.root,r,i,n,o,this.state.selectOutlineColor,null),this.updateRoot()}},e.prototype.remove=function(e){if(this.state._isSubNode(e)){for(var t=this.root.children,r=0;r<t.length;r++)if((i=t[r])==e){o=i.userData.nodeParent,this.recordSubNodeAttach(e,o,null,this.state.selectOutlineColor);break}}else for(var t=this.root.children,r=0;r<t.length;r++){var i=t[r],n=this.app.objectManager.get(i.userData.id);if(e==n){this.app.trigger("unselectEditableObject",{object:n});var o=i.userData.nodeParent;this.recordNodeAttach(e,o,null,this.state.selectOutlineColor);break}}this.updateRoot()},e.prototype.removeAll=function(){if(this.root.children.length){var e=[],t=[];this.getObjectInfo(e,t);var r=[],i=[];this.getSubNodeInfo(r,i);for(var n=0;n<e.length;n++){var o=e[n];this.app.trigger("unselectEditableObject",{object:o})}this.state.canRespondFromCommandManager=!1,this.recordNodesAttach(e,t,null,this.state.selectOutlineColor),this.recordSubNodesAttach(r,i,null,this.state.selectOutlineColor),this.state.canRespondFromCommandManager=!0,this.updateRoot()}},e.prototype.has=function(e){var t=this.root.children;if(this.state._isSubNode(e)){for(r=0;r<t.length;r++)if((n=(i=t[r]).userData).subNode&&i==e)return!0}else for(var r=0;r<t.length;r++){var i=t[r],n=i.userData;if(!n.subNode&&e==this.app.objectManager.get(i.userData.id))return!0}return!1},e.prototype.attach=function(){this.root.attach(this.app.scene,this.app.scene)},e.prototype.detach=function(){this.removeAll(),this.control.detach(),this.app.scene.remove(this.control.node),this.root.detach(this.app.scene),this.updateRoot()},e.prototype.clearScene=function(){var e=[];this.state._pushDeleteSubNodes(e,this.state.subNodes),this.state._pushDeleteObjects(e,this.state.objects),this.state.execute(e,!0),this.updateRoot()},e.prototype.toJSON=function(){for(var e=Array.from(this.state._selectionObjects),t=0;t<e.length;t++)this.remove(e[t]);for(var r=this.state.subNodes,t=0;t<r.length;t++)this.remove(r[t]);for(var i=[],n=this.state.objects,t=0;t<n.length;t++){var o=n[t];i.push(o.toJSON())}for(t=0;t<r.length;t++)this.addSubNode(r[t]);for(t=0;t<e.length;t++)this.add(e[t]);return JSON.stringify(i)},e.prototype.pasteObjects=function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0],console.warn('[EditObjectState] we do not support ".pasteObjects()" anymore, please do not use it')},e.prototype.fromJSON=function(e){console.warn('[EditObjectState] we do not support ".fromJSON()" anymore, please do not use it')},e}(),li=function(){function e(t){I(this,e);var r=this;this.app=t,this.picker=t.picker,this.copyObjectsJSONData=[],this._selectionObjects=new Set,this.canRespondFromCommandManager=!1,this._enableDirectMode=!1,this._enableKeyMode=!1,this._enableAutoRemoveAllWhenClick=!0,this.commandManager=this.app.commandManager,this.commandManager.addEventListener("push",function(e){r.onPush(e)}),this.commandManager.addEventListener("redo",function(e){r.onRedo(e)}),this.commandManager.addEventListener("undo",function(e){r.onUndo(e)});var i={changeEnd:function(e){r.group.hasChanged()&&(r.group.recordTranslation(),r.group.notify("modify"))}};this.control=new ai,this.control.init(t,"translate",i),this.selectOutlineColor="#0000FF",this.group=new si(this)}return e.prototype.onPush=function(e){this.canRespondFromCommandManager&&this.group.updateRoot()},e.prototype.onRedo=function(e){this.canRespondFromCommandManager&&this.group.updateRoot()},e.prototype.onUndo=function(e){this.canRespondFromCommandManager&&this.group.updateRoot()},e.prototype.notify=function(e,t){var r=e.userData._editCallbacks;r&&r[t].call(e)},e.prototype.startDrag=function(e,t,r,i){if(e){i=i||.1,this.app.camera.disable({rotate:!0}),e.pickable=!1,e.catchEventAnyTime=!0,e.node.userData.skipPick=!0,e.position=app.camera.screenToWorld(t,r);var n=this;e.on("mousemove",function(e){var t=n.app.picker.pickWorldPosition(e.clientX,e.clientY);t||(t=n.app.camera.screenToWorld(e.clientX,e.clientY)),t&&(t[1]+=i,this.position=t)},"startDrag_mousemove"),e.on("mouseup",function(e){this.pickable=!0,this.catchEventAnyTime=!1,delete this.node.userData.skipPick,n.group._dispatchBreakableEvent("selectEditableObject",{object:this})&&n.selectObject(this),this.off("mousemove",null,"startDrag_mousemove"),this.off("mouseup",null,"startDrag_mouseup"),n.app.camera.resume({rotate:!0}),n.notify(this,"dragEnd")},"startDrag_mouseup")}},e.prototype.selectObject=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"translate",r=arguments[2];"translate"==t||"rotate"==t?(this.group.addOnly(e),r&&(e.userData.selectObjectCallback=r),this.setMode(t)):console.error("The mode must be 'translate' or 'rotate'")},e.prototype.unselectObject=function(e){this.group.remove(e)},e.prototype.setMode=function(e){e&&(this.control.mode=e)},e.prototype.parseParams=function(e){var t=e.type;if("RouteLine"==t||"PolygonLine"==t){var r=e.points;if(!r){r=[[-5,0,-5],[0,0,-5],[0,0,0],[0,0,5],[5,0,5]],e.points=r,e.style=e.style||{};var i=e.style;i.color=G.parseValue(i.color,5824222),e.image&&void 0===e.scrollUV&&(e.scrollUV=!0)}}else"Water"==t?(r=[[-20,0,-20],[-20,0,20],[20,0,20],[20,0,-20]],e.points=r,e.normalMap0=G.parseValue(e.normalMap0,"images/water/Water_1_M_Normal.jpg"),e.normalMap1=G.parseValue(e.normalMap1,"images/water/Water_2_M_Normal.jpg")):"Region"==t&&(r=[[-20,0,-20],[-20,0,20],[20,0,20],[20,0,-20]],e.points=r,e.fontColor=Math.random(),e.fontSize=Math.randomInt(9,32),e.fontText="");return G.cloneObject(e)},e.prototype.addObjects=function(e){for(var t=[],r=0;r<e.length;r++){var i=e[r];i instanceof ye?(i.internalUserData.editable=!0,t.push(i)):console.error("The object is not BaseObject, so we can not add object to edit state")}this.group.addObjects(t)},e.prototype.createObject=function(e,t){(e=e||{}).internalUserData={editable:!0};var r=(e=this.parseParams(e)).complete;e.complete=function(){r&&r()};var i=this.app.create(e);return t&&(i.userData._editCallbacks=t),i},e.prototype._pushDeselectObject=function(e,t){t&&e.push({type:"AttachNode",node:t.node,nodeParent:t.node.userData.nodeParent})},e.prototype._pushDeleteObject=function(e,t){t&&this._pushDeselectObject(e,t)},e.prototype.deleteObject=function(e){this.notify(e,"remove");var t=[];this._pushDeleteObject(t,e),this.execute(t,!0),this.group.updateRoot()},e.prototype._pushDeleteObjects=function(e,t){for(var r=0;r<t.length;r++){var i=t[r];this._pushDeleteObject(e,i)}},e.prototype.deleteObjects=function(e){for(var t=0;t<e.length;t++)this.notify(e[t],"remove");var r=[];this._pushDeleteObjects(r,e),this.execute(r,!0),this.group.updateRoot()},e.prototype._isSubNode=function(e){return!!e&&(!e.isBaseObject&&!!e.userData.subNode)},e.prototype._isBreakByControlAxis=function(e){var t=e.intersect;return!(t&&this._isSubNode(t.node)||!this.control.axis||!this.control.visible)},e.prototype._isCanPick=function(e){if(this._isBreakByControlAxis(e))return!1;var t=e.object;if(t){if(t==this.app.outdoors)return!1;if(!t.internalUserData.editable)return!1}return!0},e.prototype._getSortedSubNodes=function(e,t){for(var r=[],i=0;i<e.length;i++){var n=e[i],o=n.userData,a=this.app.objectManager.get(o.id),s=a.getSubNodeIndex(n);r.push({index:s,node:n,object:a})}return r.sort(t),r},e.prototype._pushInsertSubNode=function(e,t){},e.prototype.insertSubNode=function(){var e=this.subNodes;if(e.length){var t=[];this._pushInsertSubNode(t,e),this.execute(t,!0),this.group.updateRoot()}},e.prototype._pushDeleteSubNodes=function(e,t){},e.prototype.deleteSubNodes=function(e){var t=[];this._pushDeleteSubNodes(t,e),this.execute(t,!0),this.group.updateRoot()},e.prototype.deleteSelections=function(){var e=Array.from(this._selectionObjects);e.length&&this.deleteObjects(e);var t=this.subNodes;t.length&&this.deleteSubNodes(t)},e.prototype.deselectObjects=function(e){if(e)for(var t=0;t<e.length;t++)this.group.remove(e[t])},e.prototype.copyObjects=function(e){this.copyObjectsJSONData=[];for(var t=0;t<e.length;t++){var r=e[t],i=r.toJSON();delete i.id,delete i.parentId,delete i.localPosition,i.localPosition=r.localPosition,i.localAngles=r.localAngles,i.scale=r.scale,this.copyObjectsJSONData.push(JSON.stringify(i))}},e.prototype.selectAll=function(){this.group.addObjects(this.objects)},e.prototype.clearScene=function(){this.group.clearScene()},e.prototype.toJSON=function(){this._enableDirectMode=!0;var e=this.group.toJSON();return this._enableDirectMode=!1,e},e.prototype.fromJSON=function(e){e&&this.group.fromJSON(e)},e.prototype.execute=function(e,t){if(this._enableDirectMode){var r=this.commandManager.create(e,t);return r?r.execute():null}return this.commandManager.execute(e,t)},e.prototype.processAreaPicking=function(e){var t=e.objects;if(t){for(var r=this.objects,i=[],n=0;n<r.length;n++){var o=r[n];t.has(o)||i.push(o)}this.deselectObjects(i),t.length&&(t[0]instanceof ye?this.group.addObjects(t):this.group.addSubNodes(t))}},e.prototype.onMouseDown=function(e){},e.prototype.onMouseUp=function(e){e.finishedAreaPicking&&this.processAreaPicking(e)},e.prototype.onMouseMove=function(e){e.areaPicking&&(this._enableDirectMode=!0,this.processAreaPicking(e),this._enableDirectMode=!1)},e.prototype.onClick=function(e){if(this.app.events.canClick(e)){var t=this.app.isKeyPressed(me.Ctrl),r=e.object;if(r&&this._isCanPick(e))if(t){var i=e.intersect.node;this.group.has(r)?this.group.remove(r):this.group.has(i)?this.group.remove(i):this.group._dispatchBreakableEvent("selectEditableObject",{object:r})&&this.group.add(r,e)}else this.group._dispatchBreakableEvent("selectEditableObject",{object:r})&&this.group.addOnly(r,e);else t||this.enableAutoRemoveAllWhenClick&&this.group.removeAll()}},e.prototype.onKeyDown=function(e){if(this._enableKeyMode)switch(event.keyCode){case me.Q:this.control.setSpace("local"===this.control.space?"world":"local");break;case me.W:this.control.mode="translate";break;case me.E:this.control.mode="rotate";break;case me.R:break;case me.EqualSign:case me.Add:this.control.size=this.control.size+.1;break;case me.Dash:case me.Subtract:this.control.size=Math.max(this.control.size-.1,.1);break;case me.Y:this.app.isKeyPressed(me.Ctrl)&&this.commandManager.redo();break;case me.Z:this.app.isKeyPressed(me.Ctrl)&&this.commandManager.undo();break;case me.C:this.app.isKeyPressed(me.Ctrl)&&this.copyObjects(Array.from(this._selectionObjects));break;case me.V:this.app.isKeyPressed(me.Ctrl)&&this.pasteObjects();break;case me.A:this.app.isKeyPressed(me.Ctrl)&&this.selectAll();break;case me.Delete:this.deleteSelections()}},e.prototype.onKeyUp=function(e){},e.prototype.onUpdate=function(e){},e.prototype.onEnter=function(e,t){if(t){this.canRespondFromCommandManager=!0;var r=t.objects;if(r)for(var i=0;i<r.length;i++)this.group.add(r[i]);this.group.attach(),this.control.mode="translate";var n=this;this.app.on("areaPickStart",function(e){var t=n.candidateForSubNodes;t.length||(t=n.objects),n.app.picker.candidates=t},"editObject_areaPickStart"),this.app.on("areaPickEnd",function(e){n.app.picker.candidates=null},"editObject_areaPickEnd"),this.app.modelResource.residentMode=!0}else console.log("Gizmo state need params")},e.prototype.onLeave=function(e){this.group.detach(),this.canRespondFromCommandManager=!1,this.app.modelResource.residentMode=!1,this.app.off("areaPickStart",null,"editObject_areaPickStart"),this.app.off("areaPickEnd",null,"editObject_areaPickEnd")},k(e,[{key:"enableKeyMode",set:function(e){this._enableKeyMode=e},get:function(){return this._enableKeyMode}},{key:"areaPicking",set:function(e){this.picker.areaPicking=e,e||(this.picker.candidates=null)},get:function(){return this.picker.areaPicking}},{key:"enableAutoRemoveAllWhenClick",set:function(e){this._enableAutoRemoveAllWhenClick=e},get:function(){return this._enableAutoRemoveAllWhenClick}},{key:"objects",get:function(){var e=[];return this.app.objectManager.objects.forEach(function(t){t.internalUserData.editable&&e.push(t)}),e}},{key:"subNodes",get:function(){for(var e=[],t=this.group.root.children,r=0;r<t.length;r++){var i=t[r];i.userData.subNode&&e.push(i)}return e}},{key:"candidateForSubNodes",get:function(){for(var e=new Set,t=this.group.root.children,r=0;r<t.length;r++){var i=t[r].userData;if(i.subNode){var n=i.id;n&&e.add(this.app.objectManager.get(n))}}var o=[];return e.forEach(function(e){o=o.concat(e.subNodes)}),o}}]),e}(),ci=function(){function e(t){I(this,e),this.app=t,this.curVer=null,this.region=null,this.isDrawing=!1}return e.prototype.onMouseMove=function(e){if(this.region.vertices.length>0&&this.isDrawing&&e.object){var t,r=e.pickedPosition;t=r.hasOwnProperty("x")?new THREE.Vector3(r.x,r.y,r.z):new THREE.Vector3(r[0],r[1],r[2]),new THREE.Vector2(t.x,t.z),this.curVer=this.region.vertices[this.region.vertices.length-1];var i=[this.curVer,t];this.region.addCurLine(i,this.region.lineColor)}},e.prototype.onClick=function(e){if(0==e.button){if(e.object){var t,r=e.pickedPosition;t=r.hasOwnProperty("x")?new THREE.Vector3(r.x,r.y,r.z):new THREE.Vector3(r[0],r[1],r[2]),this.region.addPoint(t)}}else 2==e.button&&(this.isDrawing=!1,this.region.endBuild(),this.app.stateManager.change("SelectObject"))},e.prototype.onEnter=function(e,t){this.app.camera.enableRotate=!1,this.isDrawing=!0,this.region=this.app.create({type:"PolygonRegion"})},e.prototype.onLeave=function(e){this.app.camera.enableRotate=!0;var t=this.app.commandManager.create({type:"CreateRegion",vertices:this.region.vertices,pointColor:this.region.pointColor,lineColor:this.region.lineColor,regionColor:this.region.regionColor,fontInfo:this.region.fontInfo,areaInfo:this.region.areaInfo,id:this.region.id});this.app.commandManager.push(t),this.region=null},e}(),ui=ui||{};ui.candidate=new Set;var hi=function(){function e(t){I(this,e),this.app=t,this.selObj=null,this.isEdit=!1,this.events=new vr,this.editObjState=null;var r=this;this.addEventListener("selectChanged",function(){r.onSelectChanged()})}return e.prototype.addEventListener=function(e,t){this.events.addEventListener(e,t)},e.prototype.removeEventListener=function(e,t){this.events.removeEventListener(e,t)},e.prototype.dispatchEvent=function(e){this.events.dispatchEvent(e)},e.prototype.travelObj=function(e){if(!this.app.candidate)return null;for(;e&&!this.app.candidate.has(e);)e=e.parent;return e},e.prototype.select=function(e){this.selObj!=e&&(this.unselect(),this.selObj=e,this.selObj&&(this.selObj.style.outlineColor=255),this.dispatchEvent({type:"selectChanged"}),this.app.trigger("selectPolygonRegion",{obj:this.selObj}))},e.prototype.unselect=function(){this.selObj&&(this.selObj.style.outlineColor=null,this.selObj=null,this.dispatchEvent({type:"selectChanged"}),this.app.trigger("unSelectPolygonRegion"))},e.prototype.onSelectChanged=function(){this.isEdit&&(this.selObj?this.selObj.isPolygonRegion:this.editObjState&&(this.editObjState.onLeave(),this.editObjState=null))},e.prototype.onClick=function(e){if(0==e.button){this.app.candidate=new Set(this.app.query(".PolygonRegion").toArray());var t=this.travelObj(e.object);t?this.select(t):this.unselect()}},e.prototype.onEnter=function(e,t){t&&(this.isEdit=t.edit),this.app.candidate=new Set(this.app.query(".PolygonRegion").toArray())},e.prototype.onLeave=function(e){this.unselect(),this.app.candidate=null},e}(),pi=function(){function e(t){I(this,e),this.app=t,this.lineIndex=-1,this.floor=null,this.lines=[],this.routeLines=[],this.lineParams={},this._object=null,this._defaultObject=null,this.speed=0,this.liftSpeed=0,this.startCallback=null,this.changeFloorCallback=null,this.completeCallback=null,this._outputLog=!1,this._useQuickWeightMode=!0}return e.prototype.updateMapWeightFromFloor=function(e,t,r,i){var n=e[t.id];for(var o in n){var a=app.objectManager.get(o),s=0;if(this._useQuickWeightMode)s=a.distanceTo(r);else if(!(s=t.getFindingPathLength(a.position,r)))continue;var l=n[o];n[o]=s,i.push({values:n,key:o,oldValue:l})}},e.prototype.updateMapWeightFromDoors=function(e,t,r,i){for(var n=t.doors,o=0;o<n.length;o++){var a=n[o],s=e[a.id];if(s){var l=0;if(this._useQuickWeightMode)l=a.distanceTo(r);else if(!(l=t.getFindingPathLength(a.position,r)))continue;var c=t.id,u=s[c];s[c]=l,i.push({values:s,key:c,oldValue:u})}}},e.prototype.setupMap=function(e,t,r,i,n){var o=e.graph.map,a=[];return o[t.id]&&o[i.id]?(this.updateMapWeightFromFloor(o,t,r,a),this.updateMapWeightFromDoors(o,i,n,a),a):null},e.prototype.outputPathLog=function(e){for(var t="",r=0;r<e.length;r++){var i=this.app.objectManager.get(e[r]);i&&(t+="("+i.id+")=>")}t=t._trimRight("=>"),console.log(t)},e.prototype.findMiddleSegments=function(e,t){for(e.splice(0,3);e.length>4;){var r=this.app.objectManager.get(e[0]),i=this.app.objectManager.get(e[1]),n=this.app.objectManager.get(e[2]),o=i.findPath(r.position,n.position);if(!o)return null;t.push({floor:i,points:o,startEntry:r,endEntry:n}),e.splice(0,4)}},e.prototype.findPath=function(e,t,r,i){if(!(e&&t&&r&&i))return null;if(e.building!=r.building)return null;var n=e.building;n.setupGraph();var o=[];if(e==r){var a=e.findPath(t,i);if(!a)return null;o.push({floor:e,points:a})}else{var s=this.setupMap(n,e,t,r,i);if(!s)return null;var l=n.graph.findShortestPath(e.id,r.id);if(!l||!l.length)return null;this._outputLog&&this.outputPathLog(l);for(var c=0;c<s.length;c++){var u=s[c];u.values[u.key]=u.oldValue}var h=this.app.objectManager.get(l[1]),p=e.findPath(t,h.position);if(!p)return null;o.push({floor:e,points:p,entry:h}),this.findMiddleSegments(l,o);var d=this.app.objectManager.get(l[0]),f=r.findPath(d.position,i);if(!f)return null;o.push({floor:r,points:f,entry:d})}return this.createLine(o),o},e.prototype.clearPath=function(){this.destroyLine()},e.prototype.showPath=function(){if(this.routeLines.length)if(0===arguments.length)for(t=0;t<this.routeLines.length;t++)(r=this.routeLines[t].line).visible=!0;else if(1===arguments.length)for(var e=arguments[0],t=0;t<this.routeLines.length;t++){var r=this.routeLines[t].line;r.visible=e}else if(2===arguments.length)for(var i=arguments[0],e=arguments[1],t=0;t<this.routeLines.length;t++){var n=this.routeLines[t],o=n.floor,a=n.line;o==i&&(a.visible=e)}},e.prototype.createEvent=function(e){var t=e;return t.speed=this.speed,t.liftSpeed=this.liftSpeed,t},e.prototype.getLinesParent=function(e){return e.building?e.building:e},e.prototype.setLineParams=function(e){(e=e||{}).type=e.type||"RouteLine";var t=e.type;"Line"==t?(e.color=e.color||65280,e.dotSize=e.dotSize||2,e.dotColor=e.dotColor||16711680):"RouteLine"==t&&(e.scrollUV=G.parseValue(e.scrollUV,!1)),this.lineParams=e},e.prototype.createLine=function(e){if(e){var t=this.getLinesParent(e[0].floor);if(t){this.destroyLine(),this.lineIndex=0;for(var r=0;r<e.length;r++){var i=e[r],n=i.floor,o=i.points;this.lines.push({floor:n,points:o});var a=G.cloneObject(this.lineParams);a.parent=t,a.points=o,a.visible=!1,a.arrowFlag=r===e.length-1;var s=app.create(a);this.routeLines.push({floor:n,line:s})}}}},e.prototype.destroyLine=function(){if(this.lines.length){for(var e=0;e<this.routeLines.length;e++)this.routeLines[e].line.destroy();this.routeLines=[],this.lineIndex=-1,this.lines=[]}},e.prototype.start=function(e){if(e=e||{},this.stop(),this.lines.length&&(this.lineIndex=0,this.speed=e.speed,this.liftSpeed=e.liftSpeed,this.startCallback=e.start,this.beforeChangeFloorCallback=e.beforeChangeFloor,this.afterChangeFloorCallback=e.afterChangeFloor,this.completeCallback=e.complete,this.startCallback)){var t=this.lines[0],r=t.floor,i=t.points;this.startCallback(this.createEvent({floor:r,path:i}))}},e.prototype.stop=function(){this.lineIndex=-1,this._object&&this._object.stopMoving(),this.completeCallback&&this.completeCallback(this.createEvent({floor:this.floor,pos:this._object.position}))},e.prototype._goWithLineComplete=function(e){if(e<this.lines.length-1){var t=this;this._object.movePath({position:this.lines[e+1].points[0],speed:this.liftSpeed,complete:function(){var r=t.afterChangeFloorCallback;if(r){var i=t.lines[e].floor,n=t.lines[e+1].floor,o=t.lines[e+1].points,a=o[0];r(t.createEvent({curFloor:i,nextFloor:n,path:o,position:a}))}t.lineIndex=e+1}});var r=this.beforeChangeFloorCallback;if(r){var i=this.lines[e].floor,n=this.lines[e+1].floor,o=this.lines[e+1].points,a=this.lines[e].points[this.lines[e].points.length-1];r(this.createEvent({curFloor:i,nextFloor:n,path:o,position:a}))}}else{if(this.completeCallback){var s={floor:this.floor};if(this._object)s.pos=this._object.position;else{var l=this.lines[e];s.pos=l.points[l.points.length-1]}this.completeCallback(s)}this.lineIndex=-1}},e.prototype.goWithLine=function(){var e=this.lines[this.lineIndex],t=this.lineIndex;if(this.lineIndex=-1,this.floor=e.floor,this._object){var r=this;this._object.movePath({path:e.points,speed:this.speed,orientToPath:!0,complete:function(){r._goWithLineComplete(t)}})}else this._goWithLineComplete(t)},e.prototype.updateLineIndex=function(){-1!==this.lineIndex&&(this.lineIndex>=this.lines.length||this.goWithLine())},e.prototype.showNavigationHelper=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.app.query(".Floor").forEach(function(t){t.isOutdoors||t.showNavigationHelper(e)})},e.prototype.pickFloor=function(e){if(!e.picked)return null;var t=e.object;return t?{pos:e.pickedPosition,floor:t.floor}:null},e.prototype.onUpdate=function(e){this.updateLineIndex()},e.prototype.onEnter=function(e){this.setLineParams();var t=new THREE.Object3D;this._defaultObject=new ye(this.app,t,null),this._defaultObject.visible=!1,this._object=this._defaultObject,this.app.scene.add(t)},e.prototype.onLeave=function(e){this._defaultObject.destroy(),this._defaultObject=null,this._object=null},k(e,[{key:"outputLog",set:function(e){this._outputLog=e},get:function(){return this._outputLog}},{key:"object",set:function(e){this._object=e||this._defaultObject},get:function(){return this._object}}]),e}();m.prototype.execute=function(){this.camera.flyTo({position:this.position,target:this.target,time:this.time,complete:function(){}})},m.prototype.undo=function(){this.camera.flyTo({position:this.savedPosition,target:this.savedTarget,time:this.time,complete:function(){}})},g.prototype.execute=function(){var e=this.app.create({type:"PolygonRegion",vertices:this.vertices,pointColor:this.pointColor,lineColor:this.lineColor,regionColor:this.regionColor});this.id=e.id},g.prototype.undo=function(){var e=this.app.objectManager.get(this.id);e&&e.destroy()};var di={Normal:0,Expanding:1,Expanded:2,Unexpanding:3};v.prototype.initPosition=function(){for(var e=0;e<this.objs.length;e++){var t=this.objs[e];t.internalUserData.expandInitPos=t.internalUserData.expandInitPos||t.node.position.clone()}},v.prototype.clearInitPosition=function(){for(var e=0;e<this.objs.length;e++)delete this.objs[e].internalUserData.expandInitPos},v.prototype.setParam=function(e){this.objs=e.objects||this.objs,this.flyTime=e.time||this.flyTime||1e3,this.length=e.length||this.length||10,this.horzMode=G.parseValue(e.horzMode,this.horzMode),this.hideRoof=G.parseValue(e.hideRoof,this.hideRoof),this.callback=e.complete||this.callback,this.expandFloorsNumber=e.number||5},v.prototype.expandObj=function(e,t){this.initPosition();var r=G.parseVector3(e.internalUserData.expandInitPos).distanceTo(e.node.position),i=this.horzMode,n=t*this.length-r,o=0;e instanceof dt&&!G.isNull(this.hideRoof)&&e.showAllRoofs(!this.hideRoof);var a=this;e.expandTween=new TWEEN.Tween({progress:0}).to({progress:1},this.flyTime).easing(TWEEN.Easing.Linear.None).onUpdate(function(){var t=this._object.progress-o,r=n*t;o=this._object.progress,i?e.translateZ(r):e.translateY(r)}).onComplete(function(){a.onExpandComplete(),t==a.objs.length-1&&a.app.events.dispatchEvent({type:"expand",object:e.parent})}).start()},v.prototype.unexpandObj=function(e,t){var r=G.parseVector3(e.internalUserData.expandInitPos).distanceTo(e.node.position),i=this.horzMode,n=r,o=0,a=this;e.unexpandTween=new TWEEN.Tween({progress:0}).to({progress:1},this.flyTime).easing(TWEEN.Easing.Linear.None).onUpdate(function(){var t=this._object.progress-o,r=n*t;o=this._object.progress,i?e.translateZ(r):e.translateY(-r)}).onComplete(function(){e instanceof dt&&a.hideRoof&&e.showAllRoofs(a.hideRoof),a.onExpandComplete(),t==a.objs.length-1&&a.app.events.dispatchEvent({type:"unexpand",object:e.parent})}).start()},v.prototype.execute=function(){if(this.expandState!=di.Expanding&&this.expandState!=di.Expanded){this.expandState==di.Unexpanding&&this.stopExpanding(),this.expandingCount=0,this.expandState=di.Expanding;for(var e=0,t=0;t<this.objs.length;t++){var r=this.objs[t];this.expandObj(r,e),e++,this.horzLength&&e%this.expandFloorsNumber==0&&(e=0)}}},v.prototype.undo=function(){if(this.expandState!=di.Unexpanding&&this.expandState!=di.Normal){this.expandState==di.Expanding&&this.stopExpanding(),this.expandingCount=0,this.expandState=di.Unexpanding;for(var e=0;e<this.objs.length;e++){var t=this.objs[e];this.unexpandObj(t,e)}}},v.prototype.stopExpanding=function(){if(this.expandState!=di.Normal)for(var e=0;e<this.objs.length;e++){var t=this.objs[e];t.expandTween&&(t.expandTween.stop(),t.expandTween=null),t.unexpandTween&&(t.unexpandTween.stop(),t.unexpandTween=null)}},v.prototype.onExpandComplete=function(){this.expandState!=di.Normal?(this.expandingCount++,this.expandingCount<this.objs.length||(this.expandState==di.Expanding?(this.expandState=di.Expanded,this.callback&&this.callback(this.expandState)):this.expandState==di.Unexpanding&&(this.clearInitPosition(),this.expandState=di.Normal,this.callback&&this.callback(this.expandState)))):console.error("onExpandComplete Shound not come here!")},y.prototype.execute=function(){this.node.position.copy(this.position),this.node.scale.copy(this.scale),this.node.rotation.copy(this.rotation),this.node.updateMatrixWorld()},y.prototype.undo=function(){this.node.position.copy(this.oldPosition),this.node.scale.copy(this.oldScale),this.node.rotation.copy(this.oldRotation),this.node.updateMatrixWorld()},E.prototype.execute=function(){this.node&&this.nodeParent&&(this.nodeParent.updateMatrixWorld(),this.node.attach(this.nodeParent,this.app.scene))},E.prototype.undo=function(){this.node&&this.oldNodeParent&&(this.oldNodeParent.updateMatrixWorld(),this.node.attach(this.oldNodeParent,this.app.scene))},b.prototype.execute=function(){this.object.position=this.position,this.object.scale=this.scale,this.object.angles=this.angles},b.prototype.undo=function(){this.object.position=this.oldPosition,this.object.scale=this.oldScale,this.object.angles=this.oldAngles},x.prototype.execute=function(){var e=this.object.style;e._hasCloneMaterials=!1;var t=e.opacity,r=e.color,i=e.outlineColor;G.isNull(t)||(e.opacity=1,e.opacity=t),G.isNull(r)||(e.color=null,e.color=r),G.isNull(i)||(e.outlineColor=null,e.outlineColor=i)},x.prototype.undo=function(){},_.prototype.execute=function(){this.object.playAnimation(this.params)},_.prototype.undo=function(){};var fi=[],mi=function(){function e(t){if(I(this,e),t=t||{},this.tryUseCurrentApp(t))return e.current;e.current=this,this._useAsLoader=!1,this.disableCaptureRenderer=!1,this.tree={},this.domElement=null,this.scene=null,this.camera=null,this.renderCamera=null,this.picker=null,this.enableGPUPicker=!0,this.sceneURL="",this.baseURL=Z.toStr(Z.update([87,226,191,239,69,108,125,170,74,24,83,106,232,134,141,122,5,230,106,232,86,91,132,34,209,138,177,45,52,124])),this.modelURL="https://model.3dmomoda.com/models/",this._checker=null,this.spriteResource=null,this.modelResource=null,this.particleResource=null,this.objectManager=null,this.guiManager=null,this.server=null,this.viewPointManger=null,this.webViewManager=null,this.campusLoader=null,this.controls={},this.controlBaseId=0,this._elapsedTime=0,this._deltaTime=0,this._currentFrame=0,this.curView=null,this.bgColor=9474192,this.skyBoxName=null,this.stateManager=null,this.commandManager=null,this.inited=!1,this.initDomElementHeight="",this.renderStates={},this._extensions=[],this.completeCallback=null,this.successCallback=null,this.errorCallback=null,this.progressCallback=null,this.initCache(),this.parseOptions(t),this.init(t),this.initExtensions(t.extensions||fi),this.resizeLock=!1,this.uuid=Math.generateUUID()}return e.prototype.getV=function(){return new ur},e.prototype.tryUseCurrentApp=function(t){if(!e.current)return!1;if(!e.current.useAsLoader)return!1;var r=e.current,i=r.confirmURL(t.url);if(i){var n=t.position,o=t.angles,a=t.properties,s=t.isCamFitScene,l=t.disableCampusCache;r.objectManager.create({type:"Campus",url:i,position:n,angles:o,properties:a,isCamFitScene:s,disableCache:l,complete:function(){r.trigger("load",{campus:this,buildings:this.buildings})}}),this.setupComplete()}return!0},e.prototype.clearCache=function(){for(var e=THREE.Cache.files,t=Object.keys(e),r=0;r<t.length;r++){var i=t[r];G.isString(i)&&(i.search(/\.(jpg|jpeg)$/)>0||0===i.search(/^data\:image\/jpeg/))&&THREE.Cache.remove(i)}},e.prototype.hasCache=function(){return!!window.location.href.startsWith("http://www.thingjs.com/guide/?m=sample")},e.prototype.initCache=function(){this.cache.current=this.cache.current||this,this.cache.THREE?(THREE.Cache=this.cache.THREE.cache,this.clearCache()):this.hasCache()&&(THREE.Cache.enabled=!0,this.cache.THREE={cache:THREE.Cache})},e.prototype.parseOptions=function(e){this.options=e,this.appKey=e.appKey||e.ak||"app_test_key";var t=e.container||e.el||"div3d";t&&(G.isString(t)?this.domElement=document.getElementById(t):this.domElement=t),this.domElement?(this.domElement.style.cssText+="top: 0; left: 0; position: relative; overflow: hidden",!1===e.backwardEnabled&&this.setBackwardEnabled(!1),this.useOcclusionMap=!1,e.useOcclusionMap&&(this.useOcclusionMap=e.useOcclusionMap),this.splitLoadSpeed=.1,e.loadSpeed&&(this.splitLoadSpeed=e.loadSpeed),this.loadMode=0,e.loadMode&&(this.loadMode=e.loadMode),e.background&&(this.bgColor=e.background),e.skyBox&&(this.skyBoxName=e.skyBox),e.disableCaptureRenderer&&(this.disableCaptureRenderer=!0),G.isString(e.url)&&(this.sceneURL=this.confirmURL(e.url),(new ur).c()||(this.sceneURL="",this.url="")),G.parseValue(e.isMobile,!1)&&(this._isMobile=!0),this.modelURL=e.modelURL||this.modelURL,this.options.maxTextureSize=this.options.maxTextureSize||2048,this._useAsLoader=G.parseValue(this.options.useAsLoader,!1),this.enableGPUPicker=G.parseValue(e.enableGPUPicker,!this.isMobileDevice),this.completeCallback=G.parseFunction(e.complete),this.successCallback=G.parseFunction(e.success),this.errorCallback=G.parseFunction(e.error),this.progressCallback=G.parseFunction(e.progress)):$.Error(ee.NO_EL_ERROR)},e.prototype.confirmURL=function(e,t){if(!e)return"";if(G.isArray(e)){for(var r=0;r<e.length;r++)e[r]=this.confirmURL(e[r]);return e}return-1!=e.indexOf("http://")||-1!=e.indexOf("https://")?e:0==e.indexOf("./")||0==e.indexOf("../")||0==e.indexOf("/")?e:this.options.resourceLibraryUrl?this.options.resourceLibraryUrl.appendPath(e.trimLeft(this.options.resourceLibraryUrl)):(t=t||this.baseURL).appendPath(e)},e.prototype.confirmBaseURL=function(e){return this.options.resourceLibraryUrl?this.options.resourceLibraryUrl.appendPath("/"):e},e.prototype.collectRenderStates=function(){var e=this.renderer.info.memory,t=this.renderer.info.render;this.renderStates={geometries:e.geometries,textures:e.textures,frame:t.frame,calls:t.calls,triangles:t.triangles,points:t.points,lines:t.lines}},e.prototype.createRenderer=function(e,t,r){var i=document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),n=void 0;n=r?i.getContext("webgl",{antialias:!0,preserveDrawingBuffer:e,alpha:!0}):i.getContext("webgl2",{antialias:!0,preserveDrawingBuffer:e,alpha:!0})||i.getContext("webgl",{antialias:!0,preserveDrawingBuffer:e,alpha:!0});var o=new THREE.WebGLRenderer({canvas:i,context:n});o.info.autoReset=!1,o.setPixelRatio(window.devicePixelRatio);var a=this.calcRect();return o.setSize(a.width,a.height),t.appendChild(o.domElement),o.gammaFactor=o.capabilities.isWebGL2?1.8:1.6,o.gammaInput=!0,o.gammaOutput=!0,o.shadowMap.enabled=!0,o.shadowMap.type=THREE.PCFSoftShadowMap,o},e.prototype.resizeCaputureDivElement=function(e,t){if(this.captureDivElement){var r=this.captureDivElement.style;r.width=e+"px",r.height=t+"px",r.display="none",this.captureRenderer.setSize(e,t)}},e.prototype.init=function(e){var t=this;TWEEN.removeAll();var r=this.calcRect();this.renderCamera=new THREE.CombinedCamera(r.width,r.height,60,.1,1e4,-1e3,1e3);var i=e.renderer;this.renderer=i||this.createRenderer(this.disableCaptureRenderer,this.domElement,e.forceWebGL1),this.disableCaptureRenderer||(this.captureDivElement=document.createElement("div"),this.captureRenderer=this.createRenderer(!0,this.captureDivElement,e.forceWebGL1),this.resizeCaputureDivElement(r.width,r.height)),this.cssRenderer=new THREE.CSS3DRenderer,setTimeout(function(){t.cssRenderer.domElement.style.position="absolute",t.cssRenderer.domElement.style.top="0",t.cssRenderer.domElement.style.pointerEvents="none",t.cssRenderer.setSize(r.width,r.height),t.renderer.domElement.parentNode.appendChild(t.cssRenderer.domElement)},10),setTimeout(function(){var e=t.domElement.children;e.length&&e[0].length&&(e[0].children[0].style.pointerEvents="none")},1e3),this.cssScene=new THREE.Scene,this._checker=new $r(this),this.spriteResource=new ei(this),this.modelResource=new ri(this),this.particleResource=new ii(this),this.events=new _r(this),this.events.addEventListener("complete",function(){t.completeCallback&&t.completeCallback()}),this.events.addEventListener("success",function(){t.successCallback&&t.successCallback()}),this.events.addEventListener("error",function(){t.errorCallback&&t.errorCallback()}),this.events.addEventListener("progress",function(){t.progressCallback&&t.progressCallback()}),this.objectManager=new pr(this),this.guiManager=new fr(this),this.server=new Hr(this),this.viewPointManger=new Fr(this),this.commandManager=new Rr(this);var n=new THREE.Scene;this.scene=n,this.picker=new Gr(this,this.enableGPUPicker),this._selection=new Wr(this),this.stateManager=new Tr(this),this.camera=new Qr(this),this.loadingManager=new Cr(this),this.resourceManager=new Ar(this),this.webViewManager=new mr(this),this.rendererManager=new Or(this),this.campusLoader=new lt(this),this.register(),this.sceneLevel=new Jr(this),this.sceneRoot=new Kr(this),this.sceneManager=new Pr(this),this.sceneManager.enableDeafultViewPointFile=G.parseValue(this.options.enableDeafultViewPointFile,!1),this.sceneManager.defaultViewPointFileName=G.parseValue(this.options.defaultViewPointFileName,this.sceneManager.defaultViewPointFileName),this.mainUI=new Xr(this),this.checkAppKey()||this.mainUI.setupLogo(),this.debuggerManager=new kr(this),this.debugMode=G.parseValue(e.debugMode,!1),this.background=this.bgColor,this.skyBox=this.skyBoxName,this.sceneLevel.init(),this.defaultEvents=new Zr(this),window.addEventListener("resize",function(){t.resizeLock||t.resize()}),THREE.ImageUtils.crossOrigin="anonymous",this.events.dispatchEvent({type:"success"}),0!=this.sceneURL.length?this.objectManager.create({type:"Campus",url:this.sceneURL,isCamFitScene:!0,disableCache:this.options.disableCampusCache,complete:function(){t.trigger("load",{campus:this,buildings:this.buildings}),t.setupComplete()}}):this.setupComplete();for(var o=["cameraChange","load","create","destroy"],a=0;a<o.length;a++)this.events.addEventListener(o[a],function(){t.needUpdate=!0});this.changeStates(),this.clock=new THREE.Clock;var s=G.parseValue(e.autoTick,!0),l=this.tick.bind(this);return s&&(l(),this.renderer.setAnimationLoop(l)),this},e.prototype.initExtensions=function(e){var t=this;0!==e.length&&(this._extensions=e.map(function(e){return new e(t)}))},e.prototype.tick=function(){var e=this;this.debuggerManager.begin(),this._deltaTime=this.clock.getDelta(),this._elapsedTime=this.clock.getElapsedTime(),this._currentFrame++,this.collectRenderStates(),this.renderer.info.reset(),this.inited&&this.events.update(),this.camera.update(),this.resourceManager.update(),this.modelResource.update(),this.guiManager.update(),this.webViewManager.update(),this.stateManager.update(),this.campusLoader.update(),this.selection.update(),TWEEN.update()&&(this.needUpdate=!0),this._extensions.length>0&&this._extensions.forEach(function(t){return t.onBeforeRender(e)}),this.rendererManager.update(),this._extensions.length>0&&this._extensions.forEach(function(t){return t.onAfterRender(e)}),this.mainUI.render(),this.inited&&this.updateControls(),this.debuggerManager.end()},e.prototype.register=function(){this.stateManager.registerEx({Picker:ni}),this.stateManager.registerEx({CameraController:oi}),this.stateManager.registerEx({EditObject:li}),this.stateManager.registerEx({CreateRegion:ci,SelectObject:hi},"PolygonRegion"),this.stateManager.registerEx({Navigation:pi}),this.commandManager.register("CameraFlyTo",m),this.commandManager.register("ExpandObjects",v),this.commandManager.register("SetNodeTranslation",y),this.commandManager.register("AttachNode",E),this.commandManager.register("SetObjectTranslation",b),this.commandManager.register("SetObjectStyle",x),this.commandManager.register("PlayObjectAnimation",_),this.commandManager.register("CreateRegion",g)},e.prototype.changeStates=function(){this.stateManager.change("Picker"),this.stateManager.change("CameraController"),this.stateManager.change("Navigation")},e.prototype.setupComplete=function(){var e=this;this.inited=!0,setTimeout(function(){e.events&&e.events.dispatchEvent({type:"complete"})},10)},e.prototype.calcRect=function(){var e=this.domElement.style.width,t=this.domElement.style.height;""==t&&(window.getComputedStyle?t=window.getComputedStyle(this.domElement,null).getPropertyValue("height"):"auto"==(t=this.domElement.currentStyle.height)&&(t=this.domElement.offsetHeight),""==this.initDomElementHeight&&(this.initDomElementHeight=t),"0px"==t&&(t=""));var r=0==e.length||-1!==(e+"").indexOf("%")?this.domElement.clientWidth:e.match(/\d*[^px]/)[0],i=0==t.length||-1!==(t+"").indexOf("%")?this.domElement.clientHeight:t.match(/\d*[^px]/)[0];return 0==r&&(r=window.innerWidth),0==i&&(i=window.innerHeight),"0px"==this.initDomElementHeight&&(i=window.innerHeight),{width:Number(r),height:Number(i)}},e.prototype.isInScreen=function(e){var t=e[0],r=e[1];return!(t<0||r<0||t>=this.width||r>=this.height)},e.prototype.create=function(e){var t=(e=e||{}).type;return"UI"==t||"UIAnchor"==t?this.guiManager.create(e):this.objectManager.create(e)},e.prototype.resize=function(){var e=this.calcRect(),t=e.width,r=e.height;this.width=t,this.height=r,this.resizeCaputureDivElement(t,r),this.mainUI.resize(t,r),this.camera.resize(t,r),this.picker.resize(t,r),this.webViewManager.resize(t,r),this.rendererManager.resize(t,r),this.resizeControls(t,r),this.stateManager.dispatchEvent({stateType:"onResize",width:t,height:r}),this.events.dispatchEvent({type:"resize",size:[t,r]})},e.prototype.setBackwardEnabled=function(e){history.pushState(null,null,document.URL),window.addEventListener("popstate",function(){history.pushState(null,null,document.URL)})},e.prototype.query=function(e){if(G.isString(e)&&e.startsWith("/"))return new ye(this,this.scene,null).query(e);var t=new Y(this);return t.select(e,this.objectManager.objects),t},e.prototype.on=function(e,t,r,i,n,o){var a=this.events.bindCall(e,t,r,i,n,o);"filterPickedResults"==e&&(console.warn("Please use .picker.pickedResultsFunc=function(ev) to replace .on()"),this.picker.pickedResultsFunc=a.callback)},e.prototype.off=function(e,t,r){this.events.unbindCall(e,t,r),"filterPickedResults"==e&&(console.warn("Please use .picker.pickedResultsFunc=null to replace .on()"),this.picker.pickedResultsFunc=null)},e.prototype.one=function(e,t,r,i,n,o){this.events.bindCall(e,t,r,i,n,!0,o)},e.prototype.trigger=function(e,t,r,i){this.events&&(G.isString(t)?(r=i||r||{},this.events.dispatchCall(e,t,null,r)):((r=t||i||r||{}).type=e,r.bindObject=this,this.events.dispatchEvent(r),delete r.bindObject))},e.prototype.pauseEvent=function(e,t,r){this.events.pauseEvent(e,t,r)},e.prototype.pauseEventInFrame=function(e,t,r){this.events.pauseEvent(e,t,r,!0)},e.prototype.resumeEvent=function(e,t,r){this.events.resumeEvent(e,t,r)},e.prototype.execute=function(e){this.commandManager.execute(e)},e.prototype.addControl=function(e){if(null!=e)return e.id=this.controlBaseId++,e.onAdd(this),this.controls[e.id]=e,e},e.prototype.removeControl=function(e){if(null!=e)return e.onRemove(this),delete this.controls[e.id],e},e.prototype.updateControls=function(){for(var e in this.controls){var t=this.controls[e];t.onUpdate&&t.onUpdate()}},e.prototype.resizeControls=function(e,t){for(var r in this.controls){var i=this.controls[r];i.onResize&&i.onResize(e,t)}},e.prototype.getCampusJSON=function(e,t){return this.campusLoader.peekJSON(e,t)},e.prototype.loadJSONData=function(e,t){if(e){var r=t.complete;e=this.confirmURL(e),new THREE.FileLoader(this.loadingManager).load(e,function(e){if(e&&r){var t=G.objectKeysToLowerCase(JSON.parse(e));r(t)}},function(){},function(){})}},e.prototype.isKeyPressed=function(e){return this.events.isKeyPressed(e)},e.prototype.unloadResources=function(){this.events.clear(),this.root.init();for(var e=this.query("*"),t=0;t<e.length;t++)e[t].destroy();this.stateManager.clear(),this.stateManager.init(),this.register(),this.changeStates()},e.prototype.pauseUpdate=function(){this.resourceManager.pause()},e.prototype.resumeUpdate=function(){this.resourceManager.resume()},e.prototype.checkAppKey=function(){for(var e=Z.update(this.appKey),t=!0,r=[12,164,143,166,114,16,17,182,16,94,29,114,216,195,208,81,35,181,52,132,113,112,175,32,228,201,230,97,106,44,100,73,110,54,247,25],i=0;i<e.length;i++)if(e[i]!=r[i]){t=!1;break}return t},e.prototype.getRenderStates=function(){return this.renderStates},e.prototype.captureScreenshotToImage=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"jpeg",i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,n=arguments.length>4&&void 0!==arguments[4]&&arguments[4];try{var o;this.captureRenderer?(e&&t&&(this.resizeCaputureDivElement(e,t),this.renderCamera.setSize(e,t)),this.captureRenderer.render(this.scene,this.renderCamera),o=this.captureRenderer):o=this.renderer;var a="image/"+(r.isBlank()?"jpeg":r),s=o.domElement.toDataURL(a,i);if(n&&s.replace(a,"image/octet-stream"),this.captureRenderer&&e&&t){var l=this.calcRect();this.renderCamera.setSize(l.width,l.height),this.resizeCaputureDivElement(l.width,l.height)}return s}catch(e){return console.error(e),null}},e.prototype.captureScreenshot=function(e,t,r){try{var i=e.getExtension(),n=this.captureScreenshotToImage(t,r,i);n&&this.saveFile(e,n)}catch(e){return void console.error(e)}},e.prototype.saveFile=function(e,t){var r=document.createElement("a");"string"==typeof r.download?(document.body.appendChild(r),r.download=e,r.href=t,r.click(),document.body.removeChild(r)):location.replace(uri)},e.prototype.saveUTF8TextFile=function(e,t){var r=new Blob([t],{type:"text/plain;charset=UTF-8"}),i=window.URL.createObjectURL(r),n=document.createElement("a");n.href=i,n.download=e,n.click(),window.URL.revokeObjectURL(r)},e.prototype.load=function(e,t,r){console.warn("[App] please use loadCampus() instead"),this.loadCampus(e,{successCallback:t,errorCallback:r})},e.prototype.unload=function(e){console.warn("please use unloadCampus() instead"),this.unloadCampus(e)},e.prototype.loadScene=function(e,t,r){console.warn("[App] please use loadCampus() instead"),this.loadCampus(e,{successCallback:t,errorCallback:r})},e.prototype.unloadScene=function(e){console.warn("[App] please use unloadCampus() instead"),this.unloadCampus(e)},e.prototype.showScene=function(e,t){console.warn("[App] please use 'getCampus(url).visible=true/false' instead"),this.sceneManager.showScene(e,t)},e.prototype.saveAsImageData=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"jpeg",i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,n=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return console.warn("[App] Please use '.captureScreenshotToImage' to replace '.saveAsImageData'"),this.captureScreenshotToImage(e,t,r,i,n)},e.prototype.saveAsImage=function(e,t,r){console.warn("[App] Please use '.captureScreenshot' to replace '.saveAsImage'"),this.captureScreenshot(e,t,r)},e.prototype.setSkyEffect=function(e){console.warn("[App] Please use '.skyEffect={}' to replace '.setSkyEffect'"),this.skyEffect=e},e.prototype.setLighting=function(e){console.warn("[App] Please use '.lighting={}' to replace '.setLighting'"),this.lighting=e},e.prototype.setPostEffect=function(e,t){console.warn("[App] Please use '.postEffect={}' to replace '.setPostEffect'"),this.postEffect=e},e.prototype.setFog=function(e){console.warn("[App] Please use '.fog={}' to replace '.setFog'"),this.sceneManager.setFog(e)},e.prototype.loadCampus=function(e,t){return console.warn("[App] Please use 'app.create({type: 'Campus' ...}) ' to replace '.loadCampus'"),t=t||{},this.create(G.mergeObject(t,{type:"Campus",url:e}))},e.prototype.unloadCampus=function(e){console.warn("[App] Please use 'app.query('[url=?']).destroy() ' to replace '.unloadCampus'"),this.query("[url="+e+"]").destroy()},e.prototype.getCampus=function(e){console.warn("[App] Please use 'app.query('[url=?']) ' to replace '.getCampus'");var t=this.query("[url="+e+"]");return t.length?t[0]:null},e.prototype.showGrid=function(e,t,r,i,n){console.warn("[App] Please use 'app.root.showGrid()' to replace '.app.showGrid()'"),this.root.showGrid(e,t,r,i,n)},e.prototype.getGridSize=function(){return console.warn("[App] Please use 'app.root.gridSize' to replace '.app.getGridSize()'"),this.root.gridSize},k(e,[{key:"elapsedTime",get:function(){return Math.floor(1e3*this._elapsedTime)}},{key:"deltaTime",get:function(){return Math.floor(1e3*this._deltaTime)}},{key:"currentFrame",get:function(){return this._currentFrame}},{key:"pixelRatio",set:function(e){this.renderer.setPixelRatio(e)},get:function(){return this.renderer.getPixelRatio()}},{key:"selection",get:function(){return this._selection}},{key:"debugMode",set:function(e){this.debugger.enable=e},get:function(){return this.debugger.enable}},{key:"debugger",get:function(){return this.debuggerManager}},{key:"cache",get:function(){return this.hasCache()?(parent._thing_app_=parent._thing_app_||{},parent._thing_app_):{}}},{key:"skyEffect",set:function(e){e?this.sceneManager.setSkyEffect(e):this.sceneManager.closeSkyEffect()},get:function(){return this.sceneManager.skyEffectEnable?G.cloneObject(this.sceneManager.skyEffectLightConfigCache,!1):null}},{key:"lighting",set:function(e){e?this.sceneManager.setupSceneLights(e):this.sceneManager.closeSceneLights()},get:function(){return this.sceneManager.lightEnable?G.cloneObject(this.sceneManager._lightConfigCache,!1):null}},{key:"fog",set:function(e){e?this.sceneManager.setFog(e):this.sceneManager.closeFog()},get:function(){return this.sceneManager.fogEnable?G.cloneObject(this.sceneManager._fogConfig,!1):null}},{key:"postEffect",set:function(e){e?this.rendererManager.setPostEffect(e,!1):this.rendererManager.closePostEffect()},get:function(){return this.rendererManager.postEffectEnable?G.cloneObject(this.rendererManager._postEffectConfigCache,!1):null}},{key:"background",set:function(e){this.sceneManager.background=e;var t=G.parseColor(e,null);t&&(this.bgColor=t.getHex())},get:function(){var e=this.sceneManager.background||this.bgColor;return G.isNumber(e)?"#"+e.toString(16).toUpperCase():e}},{key:"backgroundAdditiveColor",set:function(e){this.sceneManager.backgroundAdditiveColor=e},get:function(){return this.sceneManager.backgroundAdditiveColor}},{key:"backgroundColorScaleFactor",set:function(e){this.sceneManager.backgroundColorScaleFactor=e},get:function(){return this.sceneManager.backgroundColorScaleFactor}},{key:"skyBox",set:function(e){this.sceneManager.skyBox=e},get:function(){return this.sceneManager.skyBox}},{key:"needUpdate",set:function(e){this.picker&&(this.picker.needUpdate=e),this.rendererManager&&(this.rendererManager.needUpdate=e)}},{key:"loadingProgressBar",get:function(){return this.mainUI.loadingProgressBar}},{key:"useAsLoader",set:function(e){this._useAsLoader=e},get:function(){return this._useAsLoader}},{key:"mainDomElement",get:function(){return this.domElement}},{key:"isMobileDevice",get:function(){if(void 0!==this._isMobile)return this._isMobile;if(!window.navigator)return this._isMobile=!0;var e=navigator.userAgent.toLowerCase();return this._isMobile=-1!=e.indexOf("mobile")||-1!=e.indexOf("android")}},{key:"browser",get:function(){if(void 0!==this._browserInfo)return this._browserInfo;this._browserInfo={};var e=function(){var e={},t=navigator.userAgent.toLowerCase().match(/(msie|firefox|chrome|opera|version).*?([\d.]+)/);return e.browser=t[1].replace(/version/,"safari"),e.ver=t[2],e}();return this._browserInfo.type=e.browser,this._browserInfo.version=e.ver,this._browserInfo}},{key:"level",get:function(){return this.sceneLevel}},{key:"root",get:function(){return this.sceneRoot}},{key:"checker",get:function(){return this._checker}},{key:"campuses",get:function(){return console.warn("[App] The 'app.campuses' will be deleted soon, please use 'app.root.campuses' to replace it"),this.root.campuses}},{key:"buildings",get:function(){return console.warn("[App] The 'app.buildings' will be deleted soon, please use 'app.root.defaultCampus.buildings' to replace it"),this.root.defaultCampus.buildings}},{key:"disableWarning",set:function(e){console.warn("[App] Please use 'Utils.disableWarning' to replace '.disableWarning'"),G.disableWarning=e}},{key:"disableTime",set:function(e){console.warn("[App] Please use 'Utils.disableTime' to replace '.disableTime'"),G.disableTime=e}},{key:"isShiftKeyPressed",get:function(){return console.warn("[App] Please use '.isKeyPressed(THING.KeyType.Shift)' to replace '.isShiftKeyPressed'"),this.events.isKeyPressed(me.Shift)}},{key:"isControlKeyPressed",get:function(){return console.warn("[App] Please use '.isKeyPressed(THING.KeyType.Ctrl)' to replace '.isControlKeyPressed'"),this.events.isKeyPressed(me.Ctrl)}},{key:"isAltKeyPressed",get:function(){return console.warn("[App] Please use '.isKeyPressed(THING.KeyType.Alt)' to replace '.isAltKeyPressed'"),this.events.isKeyPressed(me.Alt)}},{key:"isMobile",get:function(){return console.warn("[App] Please use '.isMobileDevice' to replace '.isMobile'"),this.isMobileDevice}},{key:"wireframeColor",set:function(e){return console.warn("[App] Please use '.app.root.wireframeColor' to replace '.wireframeColor'"),this.root.wireframeColor=e}},{key:"domOffset",set:function(e){console.warn("[App] domOffset is deprecated")}},{key:"outdoors",set:function(e){console.warn("[App] we will delete .outdoors in the future, please do not use it")},get:function(){return console.warn("[App] we will delete .outdoors in the future, please do not use it"),this.root?this.root.defaultCampus.outdoors:null}},{key:"loadingProgressBarVisible",set:function(e){console.warn("[App] Please use '.loadingProgressBar.visible = true/false' to replace '.loadingProgressBarVisible=true/false'"),this.mainUI.loadingProgressBar.visible=e},get:function(){return console.warn("[App] Please use '.loadingProgressBar.visible' to replace '.loadingProgressBarVisible'"),this.mainUI.loadingProgressBar.visible}},{key:"currentParentObject",set:function(e){console.warn("[App] Please use '.level.currentParentObject' to replace '.currentParentObject'"),this.level.currentParentObject=e},get:function(){return console.warn("[App] Please use '.level.currentParentObject' to replace '.currentParentObject'"),this.level.currentParentObject}}]),e}(),gi=65,vi=97,yi=90,Ei=122,bi=47,xi=92,_i=46,wi=58,Ti={};Ti.WHITE=16777215,Ti.SILVER=12632256,Ti.GRAY=8421504,Ti.BLACK=0,Ti.RED=16711680,Ti.MAROON=8388608,Ti.GREEN=32768,Ti.BLUE=255,Ti.NAVY=128,Ti.YELLOW=16776960,Ti.OLIVE=8421376,Ti.FUCHSIA=16711935,Ti.MAGENTA=16711935,Ti.LIME=914021,Ti.PURPLE=8388736,Ti.LAWN=3135031,Ti.AQUA=65535,Ti.CYAN=65535,Ti.TEAL=32896,Ti.ORANGE=16753920,Ti.VIOLET=7737555,Ti.GREENYELLOW=6617095,Ti.createFrustumFOV=function(e,t,r,i){var n=r*Math.tan(Math.degToRad(e)/2),o=-n,a=t*n,s=-a;return Ti.createFrustum(a,s,n,o,r,i)},Ti.createFrustum=function(e,t,r,i,n,o){function a(e,t,r){s(e,r),s(t,r)}function s(e,t){var r=new THREE.Vector3;r.copy(h[e]),l.vertices.push(r),l.colors.push(new THREE.Color(t))}var l=new THREE.Geometry,c=new THREE.LineBasicMaterial({color:16777215,linewidth:3,vertexColors:THREE.FaceColors}),u=o/n,h={ltn:new THREE.Vector3(e,r,n),lbn:new THREE.Vector3(e,i,n),rbn:new THREE.Vector3(t,i,n),rtn:new THREE.Vector3(t,r,n),ltf:new THREE.Vector3(u*e,u*r,o),lbf:new THREE.Vector3(u*e,u*i,o),rbf:new THREE.Vector3(u*t,u*i,o),rtf:new THREE.Vector3(u*t,u*r,o)};return a("ltn","lbn",Ti.RED),a("lbn","rbn",Ti.RED),a("rbn","rtn",Ti.RED),a("rtn","ltn",Ti.RED),a("ltf","lbf",Ti.LIME),a("lbf","rbf",Ti.LIME),a("rbf","rtf",Ti.LIME),a("rtf","ltf",Ti.LIME),a("ltf","ltn",Ti.BLUE),a("lbf","lbn",Ti.BLUE),a("rbf","rbn",Ti.BLUE),a("rtf","rtn",Ti.BLUE),new THREE.Line(l,c,THREE.LinePieces)},Math.ceilPowerOf2=function(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))},Math.floorPowerOf2=function(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))},Math.isPowerOf2=function(e){return e>0&&0==(e&e-1)},Math.roundUpPowerOf2=function(e){return e--,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,++e},Math.toInteger=function(e){return(e=+e)!=e?e=0:0!==e&&e!==1/0&&e!==-1/0&&(e=(e>0||-1)*Math.floor(Math.abs(e))),e},Math.clamp=function(e,t,r){return THREE.Math.clamp(e,t,r)},Math.randomFloat=function(e,t){return Math.random()*(t-e)+e},Math.randomInt=function(e,t){return Math.floor(Math.random()*(t-e+1))+e},Math.randomColor=function(){return Math.randomInt(0,16777215)},Math.randomFromArray=function(e){return e[Math.randomInt(0,e.length-1)]},Math.randomIndex=function(e){return e?Math.randomInt(0,e-1):0},Math.randomVector3=function(){var e=0,t=0,r=0;if(1==arguments.length)e=THREE.Math.randFloat(-range,range),t=THREE.Math.randFloat(-range,range),r=THREE.Math.randFloat(-range,range);else if(3==arguments.length){var i=arguments[0],n=arguments[1],o=arguments[2];e=THREE.Math.randFloat(-i,i),t=THREE.Math.randFloat(-n,n),r=THREE.Math.randFloat(-o,o)}return[e,t,r]},Math.lerp=function(e,t,r){return e+r*(t-e)},Math.matrixLerp=function(e,t,r){for(var i=new Three.Matrix4,n=0;n<16;n++)i[n]=e.elements[n]+(t.elements[n]-e.elements[n])*r;return i},Math.getDistance=function(){var e,t,r,i;2==arguments.length?(e=arguments[0][0],t=arguments[0][1],r=arguments[1][0],i=arguments[1][1]):4==arguments.length&&(e=arguments[0],t=arguments[1],r=arguments[2],i=arguments[3]);var n=r-e,o=i-t;return n*=n,o*=o,Math.sqrt(n+o)},Math.degToRad=function(e){return THREE.Math.degToRad(e)},Math.radToDeg=function(e){return THREE.Math.radToDeg(e)},Math.generateUUID=function(e){var t=THREE.Math.generateUUID();return e&&(t=t.replaceAll("-","")),t},Math.addVector3=function(e,t){return[e[0]+t[0],e[1]+t[1],e[2]+t[2]]},Math.subVector3=function(e,t){return[e[0]-t[0],e[1]-t[1],e[2]-t[2]]},Math.minVector3=function(e){if(!e.length)return null;if(1===e.length)return e[0].concat();for(var t=e[0].concat(),r=1;r<e.length;r++){var i=e[r];t[0]=Math.min(t[0],i[0]),t[1]=Math.min(t[1],i[1]),t[2]=Math.min(t[2],i[2])}return t},Math.maxVector3=function(e){if(!e.length)return null;if(1===e.length)return e[0].concat();for(var t=e[0].concat(),r=1;r<e.length;r++){var i=e[r];t[0]=Math.max(t[0],i[0]),t[1]=Math.max(t[1],i[1]),t[2]=Math.max(t[2],i[2])}return t},Math.getArea=function(e){for(var t=[],r=0;r<e.length;r++)t.push(G.parseVector3(e[r]));var i=THREE.ShapeUtils.area(t);return Math.abs(i)},Math.fract=function(e){return e-Math.floor(e)},Math.pointInPolygon=function(e,t){for(var r=e[0],i=e[1],n=!1,o=0,a=t.length-1;o<t.length;a=o++){var s=t[o][0],l=t[o][1],c=t[a][0],u=t[a][1];l>i!=u>i&&r<(c-s)*(i-l)/(u-l)+s&&(n=!n)}return n},Math.swapArray=function(e,t,r){return e[t]=e.splice(r,1,e[t])[0],e},Math.getDirection=function(e,t){var r=G.parseVector3(e),i=G.parseVector3(t),n=new THREE.Vector3;return n.subVector3(i,r),n.normalize(),n.toArray()},String.prototype.getNormalize=function(){var e=this.indexOf("://");return-1!==e?this.substring(0,e+3)+T(this.substring(e+3)):T(this)},String.prototype.startsWith=function(e){return this.slice(0,e.length)===e},String.prototype.endsWith=function(e){return-1!==this.indexOf(e,this.length-e.length)},String.prototype.contains=function(e){return this.indexOf(e)>=0},String.prototype.isBlank=function(){return G.isBlank(this)},String.prototype.getFileName=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=this.indexOf("\\")>=0?this.lastIndexOf("\\"):this.lastIndexOf("/");if(-1===t)return e?this:this.split(".")[0];var r=this.substring(t);return 0!==r.indexOf("\\")&&0!==r.indexOf("/")||(r=r.substring(1)),e?r:r.split(".")[0]},String.prototype.getPath=function(){var e=this.indexOf("\\")>=0?this.lastIndexOf("\\"):this.lastIndexOf("/");return this.substring(0,e)},String.prototype.getExtension=function(){var e=this.split(".");return e.length>1?e.pop():""},String.prototype._trimLeft=function(e){return void 0===e&&(e="s"),this.replace(new RegExp("^["+e+"]+"),"")},String.prototype._trimRight=function(e){return void 0===e&&(e="s"),this.replace(new RegExp("["+e+"]+$"),"")},String.prototype.trimBoth=function(e){return this._trimLeft(e)._trimRight(e)},String.prototype.appendPath=function(e){return this._trimRight("/")+"/"+e._trimLeft("/")._trimRight("/")},String.prototype.appendRandomSuffix=function(){return this.substring()+"?t="+(new Date).getTime()},String.prototype.equals=function(e){return arguments.length>1&&void 0!==arguments[1]&&!arguments[1]?this==e:this.toUpperCase()==e.toUpperCase()},String.prototype.replaceAll=function(e,t){if(!this.length)return"";for(var r=this.substring(0);-1!==r.indexOf(e);)r=r.replace(e,t);return r},String.prototype.removeAt=function(e){var t=this.substring(0);return e>=this.length?t:t.slice(0,e)+t.slice(e+1)},THREE.Color.prototype.copy=function(e){return e&&(this.r=e.r,this.g=e.g,this.b=e.b),this},THREE.Color.prototype.toHexString=function(){return"#"+this.getHexString().toUpperCase()},THREE.Line.prototype.updatePosition=function(e,t){var r=this.geometry.vertices;if(2==r.length){var i=r[0],n=r[1];i.equals(e)&&n.equals(t)||(i.x=e.x,i.y=e.y,i.z=e.z,n.x=t.x,n.y=t.y,n.z=t.z,this.geometry.boundingSphere=null,this.geometry.verticesNeedUpdate=!0,this.computeLineDistances())}},THREE.Vector3.prototype.getPositionFromSpherical=function(e,t,r){var i=new THREE.Vector3,n=Math.sin(r);return i.x=n*Math.cos(t),i.y=-Math.cos(r),i.z=n*Math.sin(t),i.normalize(),i.multiplyScalar(e),i.add(this),i},THREE.Vector3.prototype.getDirectionFromAngles=function(e,t,r){var i=new THREE.Vector3;return J.directionFromAlphaBeta(e,t,i),i.normalize(),i.multiplyScalar(r),i.add(this),i},THREE.Vector3.prototype.getMinVector=function(e){var t=this.clone();if(G.isArray(e))for(var r=0;r<e.length;r++)t.min(e[r]);else t.min(e);return t},THREE.Vector3.prototype.getMaxVector=function(e){var t=this.clone();if(G.isArray(e))for(var r=0;r<e.length;r++)t.max(e[r]);else t.min(e);return t},THREE.Vector3.prototype.toLogString=function(){return"x: "+this.x+", y: "+this.y+", z: "+this.z},THREE.Vector3.prototype.isEqual=function(e){return!!G.isEqual(this.x,e.x)&&!!G.isEqual(this.y,e.y)&&!!G.isEqual(this.z,e.z)},THREE.Vector3.prototype.log=function(){console.log(this.toLogString())},THREE.Object3D.prototype.isMaterialVisible=function(){var e=this.material;if(!e)return!1;if(void 0!==e.length){for(var t=0;t<e.length;t++)if(e[0].visible)return!0;return!1}return e.visible},THREE.Object3D.prototype.isRenderableObject=function(){return!!(this.isLight||this.isSprite||this.isMesh||this.isLine||this.isPoints||this.isImmediateRenderObject)},THREE.Object3D.prototype.cleanup=function(){function e(e){return!e.children.length}function t(e){return!(!e.isObject3D||e.isGroup||1!==e.children.length||!e.position.equals(new THREE.Vector3)||!e.quaternion.equals(new THREE.Quaternion)||!e.scale.equals(new THREE.Vector3(1,1,1)))}function r(i){for(var n=0,o=0;o<i.children.length;o++){var a=i.children[o];if(!a.isRenderableObject())if(e(a))a.parent=null,i.children.splice(o--,1),n++;else if(t(a)){var s=a.children[0];a.parent.add(s),a.removeBySelf(),n++}else n+=r(a)}return n}for(;r(this););},THREE.Object3D.prototype.hasBeforeRenderFunction=function(e){if(!this._beforeRenderFunctions)return!1;for(var t=0;t<this._beforeRenderFunctions.length;t++)if(this._beforeRenderFunctions[t].name==e)return!0;return!1},THREE.Object3D.prototype.addBeforeRenderFunction=function(e,t){if(this.traverseChild(function(r){r.isMesh&&r.addBeforeRenderFunction(e,t)}),this._beforeRenderFunctions=this._beforeRenderFunctions||[],this._beforeRenderFunctions.push({name:e,func:t}),1===this._beforeRenderFunctions.length){var r=this.onBeforeRender;r&&"function () {}"!=r.toString()&&this._beforeRenderFunctions.splice(0,0,{name:"__originalBeforeRender__",func:r});var i=this;this.onBeforeRender=function(e,t,r,n,o,a){for(var s=0,l=i._beforeRenderFunctions.length;s<l;s++){var c=i._beforeRenderFunctions[s].func.call(i,e,t,r,n,o,a);void 0!==c&&(o=c)}return o}}},THREE.Object3D.prototype.removeBeforeRenderFunction=function(e){this.traverseChild(function(t){t.isMesh&&t.removeBeforeRenderFunction(e)}),this._beforeRenderFunctions=this._beforeRenderFunctions||[];for(var t=0;t<this._beforeRenderFunctions.length;t++){var r=this._beforeRenderFunctions[t];(G.isFunction(e)?r.func:r.name)==e&&this._beforeRenderFunctions.splice(t--,1)}this._beforeRenderFunctions.length||(this.onBeforeRender=function(e,t,r){})},THREE.Object3D.prototype.pickable=function(e){this.traverse(function(t){var r=t.userData;e?delete r.skipPick:r.skipPick=!0})},THREE.Object3D.prototype.show=function(e){if(e)for(var t=this;t;)t.visible=!0,t=t.parent;else this.visible=e},THREE.Object3D.prototype.layerVisible=function(e){e?this.layers.enable(0):this.layers.disable(0)},THREE.Object3D.prototype.ensureParentsVisible=function(e){var t=this;this.traverseParents(function(r){var i=r.visible;r.visible=e,!i&&e&&r.traverse(function(e){e==t||e.isChildOf(t)||e.ensureVisible(!1,!1)})})},THREE.Object3D.prototype.ensureVisible=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(void 0===e)return this.userData.useVisibleOnly?this.visible:!!this.visible&&!!this.layers.mask;if(!G.isBoolean(e)){if(!this.userData.alwaysPickable)for(var r=this;r;){if(!r.visible)return!1;if(e&&!r.layers.test(e.layers))return!1;r=r.parent}return!0}var i=e;this.userData.useVisibleOnly?this.visible=i:(this.layerVisible(i),t&&(this.visible=i))},THREE.Object3D.prototype.traverseParents=function(e){if(e)for(var t=this.parent;t;t=t.parent)e(t)},THREE.Object3D.prototype.traverseChild=function(e){for(var t=this.children,r=0,i=t.length;r<i;r++)t[r].traverse(e)},THREE.Object3D.prototype.traverseBreakable=function(e){if(e(this))return this;for(var t=this.children,r=0,i=t.length;r<i;r++){var n=t[r].traverseBreakable(e);if(n)return n}return null},THREE.Object3D.prototype.traverseRenderableNodes=function(e){this.traverse(function(t){t.isRenderableObject()&&e(t)})},THREE.Object3D.prototype.getRoot=function(){var e=this.parent;if(!e)return this;for(;e.parent;)e=e.parent;return e},THREE.Object3D.prototype.indexOf=function(e){return e?this.children.indexOf(e):-1},THREE.Object3D.prototype.indexOfParent=function(){var e=this.parent;if(e)return e.children.indexOf(this)},THREE.Object3D.prototype.isChildOf=function(e){for(var t=this.parent;t;){if(t==e)return!0;t=t.parent}return!1},THREE.Object3D.prototype.getChildIndex=function(e){for(var t=0;t<this.children.length;t++)if(this.children[t]==e)return t;return-1},THREE.Object3D.prototype.getIndexPath=function(e){for(var t=[],r=this;r.parent;){var i=r.parent,n=i.getChildIndex(r);if(-1==n)break;if(t.push(n),i==e)break;r=i}return t},THREE.Object3D.prototype.getChildNodeByIndexPath=function(e){for(var t=this,r=0;r<e.length;r++){var i=e[r];if(i>=t.children.length)return null;t=t.children[i]}return t},THREE.Object3D.prototype.getChildNodesNumber=function(){var e=0;return this.traverse(function(){e++}),e},THREE.Object3D.prototype.getBones=function(e,t){for(var r=[],i=0;i<t.bones.length;i++){for(var n=t.bones[i].getIndexPath(e),o=this,a=n.length-1;a>=0;a--){var s=n[a];o=o.children[s]}r.push(o)}return r},THREE.Object3D.prototype._detach=function(e,t){this.applyMatrix(e.matrixWorld),e.remove(this),t.add(this)},THREE.Object3D.prototype._attach=function(e,t){this.applyMatrix((new THREE.Matrix4).getInverse(t.matrixWorld)),e.remove(this),t.add(this)},THREE.Object3D.prototype.attach=function(e,t,r){void 0===t?t=e:G.isBoolean(t)&&(r=t,t=e),this.parent&&(r&&this.updateWorldMatrix(!0,!1),this._detach(this.parent,t)),e&&(r&&(e.updateWorldMatrix(!0,!1),this.parent.updateWorldMatrix(!0,!1)),this._attach(t,e))},THREE.Object3D.prototype.detach=function(e){this.parent.updateMatrixWorld(),this._detach(this.parent,e)},THREE.Object3D.prototype.attachChildren=function(e,t){this.updateMatrixWorld();for(var r=0;r<e.length;r++)THREE.SceneUtils.attach(e[r],t,this)},THREE.Object3D.prototype.detachChildren=function(e){this.updateMatrixWorld();for(var t=this.children.concat(),r=0;r<t.length;r++)t[r]._detach(this,e);return t},THREE.Object3D.prototype.getChildrenNames=function(){var e=[];return this.traverse(function(t){t.name.isBlank()||e.push(t.name)}),e},THREE.Object3D.prototype.getVisibleChildrenNumber=function(){var e=0;return this.traverse(function(t){t.visible&&e++}),e},THREE.Object3D.prototype.getInvisibleChildrenNumber=function(){var e=0;return this.traverse(function(t){t.visible||e++}),e},THREE.Object3D.prototype.getParents=function(){for(var e=[],t=this.parent;t;t=t.parent)e.push(t);return e},THREE.Object3D.prototype.getMeshes=function(){var e=[];return this.traverse(function(t){t.isMesh&&e.push(t)}),e},THREE.Object3D.prototype.getSprites=function(){var e=[];return this.traverse(function(t){t.isSprite&&e.push(t)}),e},THREE.Object3D.prototype.getRenderableNodes=function(){var e=[];return this.traverse(function(t){t.isRenderableObject()&&e.push(t)}),e},THREE.Object3D.prototype.getTextures=function(){for(var e=this.getMaterials(),t=new Set,r=0;r<e.length;r++)for(var i=e[r],n=Object.keys(i),o=0;o<n.length;o++){var a=i[n[o]];a&&a.isTexture&&t.add(a)}return Array.from(t)},THREE.Object3D.prototype.getTexturesFromImage=function(e){for(var t=[],r=this.getTextures(),i=0;i<r.length;i++){var n=r[i];n.image==e&&t.push(n)}return t},THREE.Object3D.prototype.getTexturesFromURL=function(e){for(var t=[],r=this.getTextures(),i=0;i<r.length;i++){var n=r[i];n.image.currentSrc==e&&t.push(n)}return t},THREE.Object3D.prototype.getMaterials=function(){var e=new Set;return this.traverse(function(t){var r=t.material;if(r)if(G.isArray(r))for(var i=0;i<r.length;i++)e.add(r[i]);else e.add(r)}),Array.from(e)},THREE.Object3D.prototype.getMeshByName=function(e){var t=null;return this.traverseBreakable(function(r){if(r.isMesh&&r.name==e)return t=r,!0}),t},THREE.Object3D.prototype.hasMesh=function(){var e=!1;return this.traverseBreakable(function(t){if(t.isMesh)return e=!0}),e},THREE.Object3D.prototype.getMeshNames=function(){var e=[];return this.traverse(function(t){t.isMesh&&e.push(t.name)}),e},THREE.Object3D.prototype.getSkinnedMeshes=function(){var e=[];return this.traverse(function(t){t.isSkinnedMesh&&e.push(t)}),e},THREE.Object3D.prototype.hasSkinnedMesh=function(){var e=!1;return this.traverseBreakable(function(t){if(t.isSkinnedMesh)return e=!0}),e},THREE.Object3D.prototype.hasSprite=function(){var e=!1;return this.traverseBreakable(function(t){if(t.isSprite)return e=!0}),e},THREE.Object3D.prototype.hasMaterial=function(e){if(!e)return!1;var t=!1;return this.traverseBreakable(function(r){if(r.material==e)return t=!0}),t},THREE.Object3D.prototype.hasGeometry=function(e){if(!e)return!1;var t=!1;return this.traverseBreakable(function(r){if(r.geometry==e)return t=!0}),t},THREE.Object3D.prototype.hasTexture=function(e){function t(t){for(var r=Object.keys(t),i=0;i<r.length;i++){var n=t[r[i]];if(n&&n.isTexture&&n==e)return!0}return!1}if(!e)return!1;var r=!1;return this.traverseBreakable(function(e){var i=e.material;if(i)if(G.isArray(i)){if(t(i))return r=!0}else if(t(i))return r=!0}),r},THREE.Object3D.prototype.identity=function(){this.matrix.identity(),this.matrix.decompose(this.position,this.quaternion,this.scale),this.updateMatrixWorld(!0)},THREE.Object3D.prototype.replace=function(e,t,r){if(t&&t.isObject3D)for(var i=0;i<this.children.length;i++){var n=this.children[i];if(n==e){r&&r(n),n=void 0,t.parent=this,this.children[i]=t;break}}},THREE.Object3D.prototype.insert=function(e,t){e>this.children.length||t&&(this.children.splice(e,0,t),t.parent=this)},THREE.Object3D.prototype.removeBySelf=function(){this.parent&&this.parent.remove(this)},THREE.Object3D.prototype.getAngles=function(){return G.parseAngles(this.rotation)},THREE.Object3D.prototype.getFacesNumber=function(){var e=0;return this.traverse(function(t){if(t.isMesh){var r=t.geometry;r.isBufferGeometry?e+=r.index.count/3:r.isGeometry&&(e+=r.faces.length)}}),e},THREE.Object3D.prototype.getVerticesNumber=function(){var e=0;return this.traverse(function(t){if(t.isMesh){var r=t.geometry;r.isBufferGeometry?e+=r.index.count:r.isGeometry&&(e+=r.vertices.length)}}),e},THREE.Object3D.prototype.getNodes=function(){var e=[];return this.traverse(function(t){e.push(t)}),e},THREE.Object3D.prototype.getNodeByID=function(e){var t;return this.traverseBreakable(function(r){if(r.id==e)return t=r,!0}),t},THREE.Object3D.prototype.getNodeByUUID=function(e){var t;return this.traverseBreakable(function(r){if(r.uuid==e)return t=r,!0}),t},THREE.Object3D.prototype.setTransform=function(e){var t=new THREE.Vector3,r=new THREE.Vector3,i=new THREE.Quaternion;e.decompose(t,i,r),this.quaternion.copy(i),this.position.copy(t),this.scale.copy(r)},THREE.Object3D.prototype.keepSize=function(e,t,r){if(this.parent){var i=new THREE.Vector3;this.getWorldPosition(i);var n=e.sub(i).length();if(t.isVector2){var o=[r/t.x,r/t.y];this.scale.set(n/o[0],n/o[1],1)}}},THREE.Object3D.prototype._synSelfMatrixWorld=function(){this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)},THREE.Object3D.prototype._synMatrixWorld=function(){this.traverse(function(e){e._synSelfMatrixWorld()})},THREE.Object3D.prototype._setWorldPosition=function(e,t,r){var i=e;this.parent&&(t&&this.parent.updateMatrixWorld(),i=this.parent.worldToLocal(e)),this.position.set(i.x,i.y,i.z),r&&this._synMatrixWorld()},THREE.Object3D.prototype._setWorldAngles=function(e,t){for(var r=this.parent;r;r=r.parent){var i=G.parseQuaternion(r.rotation);i.inverse(),e.premultiply(i)}var n=G.parseEuler(e);this.rotation.copy(n),t&&this._synMatrixWorld()},THREE.Object3D.prototype._setWorldScale=function(e,t){for(var r=this.parent;r;r=r.parent){var i=new THREE.Vector3,n=new THREE.Quaternion,o=new THREE.Vector3;r.matrix.decompose(i,n,o),e.divide(o)}this.scale.copy(e),t&&this._synMatrixWorld()},THREE.Object3D.prototype.cloneByFilter=function(e){for(var t=this.clone(!1),r=0;r<this.children.length;r++){var i=this.children[r];if(!e||e(i)){var n=i.cloneByFilter(e);t.add(n)}}return t},THREE.Object3D.prototype.getForwardPosition=function(e){var t=new THREE.Vector3;return this.updateMatrixWorld(!0),this.getWorldDirection(t),t.normalize(),t.multiplyScalar(e),t.add(this.position),t},THREE.Matrix4.prototype.setScale=function(e){var t=this.elements;return t[0]=e.x,t[5]=e.y,t[10]=e.z,this},THREE.Euler.prototype.multiplyMatrix4=function(e){var t=new THREE.Quaternion;t.setFromEuler(this);var r=new THREE.Quaternion;r.setFromRotationMatrix(e),t.multiply(r),this.setFromQuaternion(t)},THREE.Euler.prototype.setRotationOrder=function(e){var t=new THREE.Quaternion;t.setFromEuler(this,!1),this.setFromQuaternion(t,e,!0)},THREE.Quaternion.prototype.multiplyMatrix4=function(e){var t=new THREE.Quaternion;t.setFromRotationMatrix(e),this.multiply(t)},THREE.Quaternion.prototype.getAngles=function(){return G.parseAngles(this)},THREE.PerspectiveCamera.prototype.orthoSize=function(e,t){var r=G.parseVector3(t),i=e.distanceTo(r),n=2*Math.tan(this.fov/2*Math.PI/180),o=n*i;return{x:o*this.aspect,y:o,depth:n,z:i}},THREE.OrthographicCamera.prototype.orthoSize=function(){return{x:(this.right-this.left)/this.zoom,y:(this.top-this.bottom)/this.zoom}},THREE.OrthographicCamera.prototype.resize=function(e,t){if(void 0!==this.userData){var r=this.userData.depth*this.userData.z,i=r*(e/t);this.left=-i/2,this.right=i/2,this.top=r/2,this.bottom=-r/2,this.updateProjectionMatrix()}},Object.defineProperty(THREE.CombinedCamera.prototype,"isPerspectiveCamera",{get:function(){return this.inPerspectiveMode}}),Object.defineProperty(THREE.CombinedCamera.prototype,"isOrthographicCamera",{get:function(){return this.inOrthographicMode}}),THREE.CombinedCamera.prototype.setNear=function(e){this.cameraP.near=e,this.cameraO.near=e,this.updateProjectionMatrix()},THREE.CombinedCamera.prototype.setFar=function(e){this.cameraP.far=e,this.cameraO.far=e,this.updateProjectionMatrix()},THREE.CombinedCamera.prototype.toPerspectiveCamera=function(){var e=new THREE.CombinedCamera(1,1,1,1,1,1,1);return e.fov=this.fov,e.left=this.left,e.right=this.right,e.top=this.top,e.bottom=this.bottom,e.cameraO=new THREE.OrthographicCamera(1,1,1,1,1,1),e.cameraO.copy(this.cameraO),e.cameraP=new THREE.PerspectiveCamera(1,1,1,1),e.cameraP.copy(this.cameraP),e.zoom=this.zoom,e.toPerspective(),e},THREE.CombinedCamera.prototype.toOrthoCamera=function(e,t){var r=this.cameraP.orthoSize(e,t),i=new THREE.CombinedCamera(r.x,r.y,this.fov,this.near,this.far,this.cameraO.near,this.cameraO.far);return i.orthoSize=r,i.toOrthographic(),i},THREE.CombinedCamera.prototype.lerpMatrix=function(e,t,r,i){var n=G.toMatrixElementsArray(e),o=G.toMatrixElementsArray(t);this.matrixTween&&this.matrixTween.stop(),this.matrixTween=new TWEEN.Tween(n).to(o,r).easing(TWEEN.Easing.Quintic.Out).onUpdate(function(){G.elementsArrayToMatrix(e,this._object)}).onComplete(function(){i&&i()}).start()},THREE.CombinedCamera.prototype.lerpToOrthographic=function(e,t,r,i){var n=this.toOrthoCamera(e,t);this.orthoSize=n.orthoSize,this.zoom=1;var o=this;this.lerpMatrix(this.projectionMatrix,n.projectionMatrix,r,function(){o.toOrthographic(),i&&i()})},THREE.CombinedCamera.prototype.lerpToPerspective=function(e,t){var r=this.toPerspectiveCamera(),i=this;this.lerpMatrix(this.projectionMatrix,r.projectionMatrix,e,function(){i.toPerspective(),t&&t()})},THREE.CombinedCamera.prototype.getEffectiveFOV=function(){return this.cameraP.getEffectiveFOV()},THREE.CombinedCamera.prototype.isInView=function(e){var t=new THREE.Matrix4;t.multiplyMatrices(this.projectionMatrix,this.matrixWorldInverse);var r=new THREE.Frustum;return r.setFromMatrix(t),r.intersectsBox(e)},THREE.Mesh.prototype.verticesCount=function(){return this.geometry?this.geometry.isBufferGeometry?this.geometry.attributes.position.count:this.geometry.vertices.length:0},THREE.Mesh.prototype.simplify=function(e){var t=Math.clamp(e,0,1),r=new THREE.SimplifyModifier,i=this.geometry;i instanceof THREE.BufferGeometry&&(i=(new THREE.Geometry).fromBufferGeometry(i)),i.mergeVertices();var n=Math.toInteger(i.vertices.length*(1-t)),o=r.modify(i,n);return new THREE.Mesh(o,this.material)},THREE.Mesh.prototype.getPerimeter=function(){var e=this.geometry.attributes.position;if(e.count<2)return 0;for(var t=0,r=new THREE.Vector2(e.getX(0),e.getZ(0)),i=1;i<e.count;i++){var n=new THREE.Vector2(e.getX(i),e.getZ(i));t+=n.distanceTo(r),r=n}return t+=r.distanceTo(new THREE.Vector2(e.getX(0),e.getZ(0)))},THREE.Mesh.prototype.getArea=function(){for(var e=this.geometry.attributes.position,t=[],r=0;r<e.count;r++){var i=new THREE.Vector2(e.getX(r),e.getZ(r));t.push(i)}var n=THREE.ShapeUtils.area(t);return Math.abs(n)},THREE.Mesh.prototype.getPoints=function(){var e=[],t=this.geometry.attributes;if(t)for(var r=t.position,i=0;i<r.count;i++)e.push([r.getX(i),r.getY(i),r.getZ(i)]);else{var n=this.geometry.vertices;if(n)for(i=0;i<n.length;i++){var o=n[i].clone();o.applyMatrix4(this.matrixWorld),e.push(o.toArray())}}return e},THREE.Mesh.prototype.getLabelPosition=function(e,t){var r=[];if(this.geometry.attributes)for(var i=this.geometry.attributes.position,n=0;n<i.count;n++)r.push([i.getX(n),i.getZ(n)]);else for(n=0;n<this.geometry.vertices.length;n++){var o=this.geometry.vertices[n];"xy"==t?r.push([o.x,o.y]):r.push([o.x,o.z])}if(!r.length)return null;var a=[];if(a.push(r),e&&0!=e.length)for(n=0;n<e.length;n++){var s=[e[n][0],e[n][1],e[n][2],e[n][3]];a.push(s)}var l,c=new polylabel(a);return l="xy"==t?this.localToWorld(new THREE.Vector3(c[0],c[1],0)):this.localToWorld(new THREE.Vector3(c[0],0,c[1])),this.getRayCastPosition(l)},THREE.Mesh.prototype.getAvaliableLabelPosition=function(e,t,r){this.updateMatrixWorld();var i=new THREE.Matrix4;i.getInverse(this.matrixWorld);for(var n=[],o=0;o<r.length;o++){var a=G.parseVector3(r[o]);a.applyMatrix4(i),n.push(a.toArray())}for(var s=[],o=0;o<e.length;o++){var l=e[o],c=l[0]/2,u=l[1]/2;if(0!=c&&0!=u){var h=this.getLabelPosition(r,t);if(!h)break;s.push(h),(h=h.clone()).applyMatrix4(i);var p=h.x,d="xy"==t?h.y:h.z,f=[p-c,d-u],m=[p+c,d-u],g=[p+c,d+u],v=[p-c,d+u];n.push([f,m,g,v])}}return s},THREE.Mesh.prototype.getRayCastPosition=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3;this.updateMatrixWorld();var r=new THREE.Vector3,i=new THREE.Vector3(0,1,0),n=this.position.clone();r.copy(i).applyQuaternion(this.quaternion),n.add(r.multiplyScalar(t)),n.applyMatrix4(this.matrixWorld);var o=new THREE.Vector3,a=new THREE.Vector3(0,-1,0),s=this.position.clone();o.copy(a).applyQuaternion(this.quaternion),s.add(o.multiplyScalar(t)),s.applyMatrix4(this.matrixWorld);var l=new THREE.Vector3;l.subVectors(s,n),l.normalize();var c=e.clone();c.add(l.clone().multiplyScalar(-t));var u=new THREE.Raycaster;u.ray.origin.copy(c),u.ray.direction.copy(l);var h=u.intersectObjectForcible(this,!0);return h.length?h[0].point:null},THREE.Mesh.prototype.raycast=function(){function e(e,t,r,i,n,o,a){return THREE.Triangle.getBarycoord(e,t,r,i,m),n.multiplyScalar(m.x),o.multiplyScalar(m.y),a.multiplyScalar(m.z),n.add(o).add(a),n.clone()}function t(e,t,r,i,n,o,a,s){if(null===(t.side===THREE.BackSide?i.intersectTriangle(a,o,n,!0,s):i.intersectTriangle(n,o,a,t.side!==THREE.DoubleSide,s)))return null;v.copy(s),v.applyMatrix4(e.matrixWorld);var l=r.ray.origin.distanceTo(v);return l<r.near||l>r.far?null:{distance:l,point:v.clone(),object:e}}function r(r,i,n,o,c,u,h,m){a.fromBufferAttribute(o,u),s.fromBufferAttribute(o,h),l.fromBufferAttribute(o,m);var v=t(r,r.material,i,n,a,s,l,g);if(v){c&&(p.fromBufferAttribute(c,u),d.fromBufferAttribute(c,h),f.fromBufferAttribute(c,m),v.uv=e(g,a,s,l,p,d,f));var y=new THREE.Face3(u,h,m);THREE.Triangle.getNormal(a,s,l,y.normal),v.face=y,v.faceIndex=u}return v}var i=new THREE.Matrix4,n=new THREE.Ray,o=new THREE.Sphere,a=new THREE.Vector3,s=new THREE.Vector3,l=new THREE.Vector3,c=new THREE.Vector3,u=new THREE.Vector3,h=new THREE.Vector3,p=new THREE.Vector2,d=new THREE.Vector2,f=new THREE.Vector2,m=new THREE.Vector3,g=new THREE.Vector3,v=new THREE.Vector3;return function(m,v){var y=this.geometry,E=this.material,b=this.matrixWorld;if(void 0!==E&&(null===y.boundingSphere&&y.computeBoundingSphere(),o.copy(y.boundingSphere),o.applyMatrix4(b),!1!==m.ray.intersectsSphere(o)&&(i.getInverse(b),n.copy(m.ray).applyMatrix4(i),null===y.boundingBox||!1!==n.intersectsBox(y.boundingBox)))){var x;if(y.isBufferGeometry){var _,w,T,M,R=y.index,S=y.attributes.position,P=y.attributes.uv;if(null!==R)for(M=0,C=R.count;M<C;M+=3)_=R.getX(M),w=R.getX(M+1),T=R.getX(M+2),(x=r(this,m,n,S,P,_,w,T))&&(x.faceIndex=Math.floor(M/3),v.push(x));else if(void 0!==S){var A=this.drawMode===THREE.TriangleStripDrawMode,C=Math.min(y.drawRange.count,S.count)-Math.max(y.drawRange.start,0),L=A?1:3;for(A&&(C-=2),M=0;M<C;M+=L)(x=r(this,m,n,S,P,_=M,w=M+1,T=M+2))&&v.push(x)}}else if(y.isGeometry){var O,H,F,I,k=Array.isArray(E),D=y.vertices,N=y.faces,j=y.faceVertexUvs[0];j.length>0&&(I=j);for(var U=0,B=N.length;U<B;U++){var V=N[U],z=k?E[V.materialIndex]:E;if(void 0!==z){if(O=D[V.a],H=D[V.b],F=D[V.c],!0===z.morphTargets){var q=y.morphTargets,G=this.morphTargetInfluences;a.set(0,0,0),s.set(0,0,0),l.set(0,0,0);for(var W=0,X=q.length;W<X;W++){var Y=G[W];if(0!==Y){var Q=q[W].vertices;a.addScaledVector(c.subVectors(Q[V.a],O),Y),s.addScaledVector(u.subVectors(Q[V.b],H),Y),l.addScaledVector(h.subVectors(Q[V.c],F),Y)}}a.add(O),s.add(H),l.add(F),O=a,H=s,F=l}if(x=t(this,z,m,n,O,H,F,g)){if(I&&I[U]){var J=I[U];p.copy(J[0]),d.copy(J[1]),f.copy(J[2]),x.uv=e(g,O,H,F,p,d,f)}x.face=V,x.faceIndex=U,v.push(x)}}}}}}}(),THREE.Raycaster.prototype.clone=function(){return new THREE.Raycaster(this.ray.origin.clone(),this.ray.direction.clone())},THREE.Raycaster.prototype._intersectObjectForcible=function(e,t,r,i){if(e.raycast(t,r),!0===i)for(var n=e.children,o=0,a=n.length;o<a;o++)this._intersectObjectForcible(n[o],t,r,!0)},THREE.Raycaster.prototype.intersectObjectForcible=function(e,t,r){var i=r||[];return this._intersectObjectForcible(e,this,i,t),i.sort(function(e,t){e.distance,t.distance}),i},THREE.Raycaster.prototype.intersectEnsureVisibleObject=function(e,t,r,i,n){if(!1!==e.ensureVisible(n)&&(e.raycast(t,r),!0===i))for(var o=e.children,a=0,s=o.length;a<s;a++)this.intersectEnsureVisibleObject(o[a],t,r,!0,n)},THREE.Raycaster.prototype.intersectEnsureVisibleObjects=function(e,t,r,i){if(!1===Array.isArray(t))return console.warn("THREE.Raycaster.intersectObjects: objects is not an Array."),e;for(var n=0,o=t.length;n<o;n++)this.intersectEnsureVisibleObject(t[n],this,e,r,i);return e.sort(function(e,t){return e.distance-t.distance}),e},THREE.Scene.prototype.verticesCount=function(){var e=0;return this.traverse(function(t){t.isMesh&&(e+=t.verticesCount())}),e},THREE.AnimationMixer.prototype.isRunning=function(){for(var e=this._actions,t=this._nActiveActions,r=0;r!==t;++r)if(e[r].isRunning())return!0;return!1},THREE.AnimationMixer.prototype.log=function(){for(var e=this.stats,t=0;t<this._actions.length;t++){var r=this._actions[t],i=r.getClip(),n=r.getEffectiveWeight();0!=n&&console.log("action: [name: "+i.name+", weight: "+n+"]")}console.log("action: "+e.actions.inUse+"/"+e.actions.total),console.log("bindings: "+e.bindings.inUse+"/"+e.bindings.total),console.log("controlInterpolants: "+e.controlInterpolants.inUse+"/"+e.controlInterpolants.total)},THREE.Material.prototype.copy=function(e){this.name=e.name,this.fog=e.fog,this.lights=e.lights,this.blending=e.blending,this.side=e.side,this.flatShading=e.flatShading,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.premultipliedAlpha=e.premultipliedAlpha,this.visible=e.visible,this.userData=JSON.parse(JSON.stringify(e.userData)),this.defines=void 0!==e.defines?JSON.parse(JSON.stringify(e.defines)):void 0,this.__texture=e.__texture,this.clipShadows=e.clipShadows,this.clipIntersection=e.clipIntersection;var t=e.clippingPlanes,r=null;if(null!==t){var i=t.length;r=new Array(i);for(var n=0;n!==i;++n)r[n]=t[n].clone()}return this.clippingPlanes=r,this.shadowSide=e.shadowSide,this.onBeforeCompile=e.onBeforeCompile,this},THREE.Box3.prototype.setFromVisibleObject=function(e){this.makeEmpty(),e.updateMatrixWorld(!0);var t=new THREE.Vector3,r=this,i=!1;if(e.traverseVisible(function(e){if(!e.isLight&&!e.userData.skipBoundingBox){var n=e.geometry;if(void 0!==n){if(n.isGeometry)for(var o=n.vertices,a=0,s=o.length;a<s;a++)t.copy(o[a]),t.applyMatrix4(e.matrixWorld),r.expandByPoint(t);else if(n.isBufferGeometry){var l=n.attributes.position;if(void 0!==l)for(var a=0,s=l.count;a<s;a++)t.fromBufferAttribute(l,a).applyMatrix4(e.matrixWorld),r.expandByPoint(t)}i=!0}}}),!i){var n=new THREE.Vector3;e.getWorldPosition(n),this.expandByPoint(n)}return this},THREE.ShaderChunk.alphatest_fragment="#ifdef ALPHATEST\n\tif ( diffuseColor.a < ALPHATEST ) {discard;} else {diffuseColor.a = opacity;}\n#endif\n",THREE.ShaderLib.normal.vertexShader=THREE.ShaderLib.normal.vertexShader.replace("#include <logdepthbuf_pars_vertex>","#include <logdepthbuf_pars_vertex> \n"+THREE.ShaderChunk.clipping_planes_pars_vertex),THREE.ShaderLib.normal.vertexShader=THREE.ShaderLib.normal.vertexShader.replace("#include <logdepthbuf_vertex>","#include <logdepthbuf_vertex> \n"+THREE.ShaderChunk.clipping_planes_vertex),THREE.ShaderLib.normal.fragmentShader=THREE.ShaderLib.normal.fragmentShader.replace("#include <logdepthbuf_pars_fragment>","#include <logdepthbuf_pars_fragment> \n"+THREE.ShaderChunk.clipping_planes_pars_fragment),THREE.ShaderLib.normal.fragmentShader=THREE.ShaderLib.normal.fragmentShader.replace("void main() {","void main() { \n"+THREE.ShaderChunk.clipping_planes_fragment),THREE.ShaderChunk.map_fragment=["","#ifdef USE_MAP","#ifdef USE_DIFFUSE_UV2","vec4 texelColor = texture2D( map, vUv2 );","#else","vec4 texelColor = texture2D( map, vUv );","#endif","texelColor = mapTexelToLinear( texelColor );","diffuseColor *= texelColor;","#endif",""].join("\n"),THREE.ShaderChunk.alphamap_fragment=["","#ifdef USE_ALPHAMAP","#ifdef USE_ALPHA_UV3","diffuseColor.a *= texture2D( alphaMap, vUv3).g;","#else","#ifdef USE_ALPHA_UV2","diffuseColor.a *= texture2D( alphaMap, vUv3).g;","#else","diffuseColor.a *= texture2D( alphaMap, vUv).g;","#endif","#endif","#endif",""].join("\n"),THREE.ShaderChunk.uv2_pars_fragment=["","#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP ) || defined (USE_DIFFUSE_UV2)","varying vec2 vUv2;","#endif","#if defined( USE_ALPHA_UV3 ) || defined( USE_ALPHA_UV2 )","varying vec2 vUv3;","#endif",""].join("\n"),THREE.ShaderChunk.uv2_pars_vertex=["","#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP ) || defined( USE_ALPHA_UV2 ) || defined (USE_DIFFUSE_UV2)","attribute vec2 uv2;","#endif","#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP ) || defined (USE_DIFFUSE_UV2)","varying vec2 vUv2;","#endif","#if defined( USE_ALPHA_UV2 ) || defined( USE_ALPHA_UV3 )","#ifdef USE_ALPHA_UV3","attribute vec2 uv3;","#endif","varying vec2 vUv3;","uniform mat3 uvTransform1;","#endif",""].join("\n"),THREE.ShaderChunk.uv2_vertex=["#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP ) || defined (USE_DIFFUSE_UV2)","#ifdef USE_DIFFUSE_UV2","vUv2 = (uvTransform * vec3(uv2, 1.0)).xy;","#else","vUv2 = uv2;","#endif","#endif","#ifdef USE_ALPHA_UV2","vUv3 = (uvTransform1 * vec3(uv2, 1.0)).xy;","#endif","#ifdef USE_ALPHA_UV3","vUv3 = (uvTransform1 * vec3(uv3, 1.0)).xy;","#endif",""].join("\n"),THREE.ShaderChunk.color_pars_vertex+=["","#ifdef USE_ALPHAINDEX","attribute float alphaIndex;","varying float vAlpha;","#endif",""].join("\n"),THREE.ShaderChunk.color_vertex+=["","#ifdef USE_ALPHAINDEX","vAlpha = alphaIndex;","#endif",""].join("\n"),THREE.ShaderChunk.color_pars_fragment+=["","#ifdef USE_ALPHAINDEX","varying float vAlpha;","#endif",""].join("\n"),THREE.ShaderChunk.color_fragment+=["","#ifdef USE_ALPHAINDEX","diffuseColor.a *= vAlpha;","#endif",""].join("\n"),THREE.ShaderLib.sprite.vertexShader=THREE.ShaderLib.sprite.vertexShader.replace("#include <clipping_planes_pars_vertex>","\n#include <clipping_planes_pars_vertex>\n#ifdef USE_GPUPICKER\n    uniform float baseId;\n    varying vec4 worldId;\n#endif\n"),THREE.ShaderLib.sprite.vertexShader=THREE.ShaderLib.sprite.vertexShader.replace("#include <fog_vertex>","\n#include <fog_vertex>\n#ifdef USE_GPUPICKER\n\tvec3 a = fract(vec3(1.0/255.0, 1.0/(255.0*255.0), 1.0/(255.0*255.0*255.0)) * baseId);\n\ta -= a.xxy * vec3(0.0, 1.0/255.0, 1.0/255.0);\n\tworldId = vec4(a,1);\n#endif\n"),THREE.ShaderLib.sprite.fragmentShader=THREE.ShaderLib.sprite.fragmentShader.replace("#include <clipping_planes_pars_fragment>","\n#include <clipping_planes_pars_fragment>\n#ifdef USE_GPUPICKER\n\tvarying vec4 worldId;\n#endif\n"),THREE.ShaderLib.sprite.fragmentShader=THREE.ShaderLib.sprite.fragmentShader.replace("#include <fog_fragment>","\n#include <fog_fragment>\n#ifdef USE_GPUPICKER\n    gl_FragColor = worldId;\n#endif\n"),THREE.ShaderLib.sprite.fragmentShader=THREE.ShaderLib.sprite.fragmentShader.replace("#include <clipping_planes_fragment>","\n#ifdef USE_MAP\n\t#ifdef USE_UV_DISCARD\n\t\tif (vUv.x < 0. || vUv.x > 1. || vUv.y < 0. || vUv.y > 1.) discard;\n\t#endif\n#endif\n#include <clipping_planes_fragment>\n"),THREE.ShaderChunk.skinning_vertex="\n#ifdef USE_SKINNING\nvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\nvec4 skinned = vec4( 0.0 );\nskinned += boneMatX * skinVertex * skinWeight.x;\nskinned += boneMatY * skinVertex * skinWeight.y;\nskinned += boneMatZ * skinVertex * skinWeight.z;\nskinned += boneMatW * skinVertex * skinWeight.w;\n\ntransformed = (localBindMatrixInverse * skinned ).xyz;\n\n#endif\n",THREE.ShaderChunk.skinning_pars_vertex="\n#ifdef USE_SKINNING\nuniform mat4 bindMatrix;\nuniform mat4 bindMatrixInverse;\nuniform mat4 localBindMatrixInverse;\n#ifdef BONE_TEXTURE\n\tuniform sampler2D boneTexture;\n\tuniform int boneTextureSize;\n\tmat4 getBoneMatrix( const in float i ) {\n\t\tfloat j = i * 4.0;\n\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\ty = dy * ( y + 0.5 );\n\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\treturn bone;\n\t}\n#else\n\tuniform mat4 boneMatrices[ MAX_BONES ];\n\tmat4 getBoneMatrix( const in float i ) {\n\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\treturn bone;\n\t}\n#endif\n#endif\n",THREE.ShaderChunk.aomap_fragment=["#ifdef USE_AOMAP","float ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity * 1.5 + (2.0 - 1.0) / 2.0 + 1.0;","#if defined( USE_ENVMAP ) && defined( PHYSICAL )","float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );","reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );","#endif","#endif"].join("\n"),THREE.ShaderChunk.emissivemap_fragment+=["","#ifdef STANDARD","totalEmissiveRadiance = vec3(0.0,0.0,0.0);","vec3 newEmissiveColor = emissive;","#ifdef USE_EMISSIVEMAP","newEmissiveColor = emissive * emissiveColor.rgb;","#endif","#endif",""].join("\n"),THREE.ShaderChunk.encodings_fragment=["gl_FragColor = linearToOutputTexel( gl_FragColor );","#ifdef USE_AOMAP","gl_FragColor.rgb *= ambientOcclusion;","#endif","#ifdef STANDARD","gl_FragColor.rgb += newEmissiveColor;","#endif"].join("\n"),THREE.ShaderChunk.tonemapping_fragment=["#if defined( TONE_MAPPING ) && defined(STANDARD)","gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );","#endif"].join("\n"),THREE.ShaderLib.cube.uniforms.colorMatrix={value:new THREE.Matrix4},THREE.ShaderLib.cube.fragmentShader="\nuniform samplerCube tCube;\nuniform mat4 colorMatrix;\nuniform float tFlip;\nuniform float opacity;\n\nvarying vec3 vWorldDirection;\n\nvoid main() {\n\n\tvec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );\n\n\tgl_FragColor = colorMatrix * mapTexelToLinear( texColor );\n\tgl_FragColor.a *= opacity;\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\n}\n",Math.distance=function(e,t){return console.warn("[Math] Please use 'Math.getDistance' to replace 'Math.distance'"),Math.getDistance(e,t)};var Mi=new THREE.EventDispatcher,Ri={mode:0,_strategies:new Map,addStrategy:function(e,t){Ri._strategies.set(e,t)}};Mi.addEventListener("obj_created",function(e){e.obj.addBeforeRenderFunction("MaterialManager",function(e,t,r,i,n,o){if(0!==Ri.mode&&n){if(Ri._strategies.get(Ri.mode))return Ri._strategies.get(Ri.mode).call(this,e,t,r,i,n,o);console.warn("no strategy mode found: "+Ri.mode)}})}),THREE.MsgCenter=Mi,THREE.MaterialManager=Ri;var Si=function(){function e(t){I(this,e);var r=t.image,i=t.opacity||.8,n=new THREE.SpriteMaterial({map:THREE.ImageUtils.loadTexture(r),opacity:i,transparent:!0});this._position=null,this._uiPosition=[1,1],Object.defineProperty(this,"position",{get:function(){return this._position},set:function(e){if(G.isNumber(e))switch(this._position=e,this._position){case se.LeftTop:this._uiPosition=[-1,-1];break;case se.RightTop:this._uiPosition=[1,-1];break;case se.LeftBottom:this._uiPosition=[-1,1];break;case se.RightBottom:this._uiPosition=[1,1]}return this._position}}),null!=t.position?this.position=t.position:this.position=se.RightBottom,this.size=t.size||50,this.offset=t.offset||[0,0],this.sprite=new THREE.Sprite(n),this.sprite.scale.set(this.size,this.size,1)}return e.prototype.onUpdate=function(){var e=this.app.mainUI.getRenderPosition(this._uiPosition,[this.size,this.size]);this.sprite.position.set(e[0]+this.offset[0],e[1]+this.offset[1],-10),this.sprite.material.rotation=this.app.renderCamera.rotation._z},e.prototype.onAdd=function(e){this.app=e,this.app.mainUI.scene2D.add(this.sprite)},e.prototype.onRemove=function(){this.app.mainUI.scene2D.remove(this.sprite)},e}(),Pi=function(){function e(t){I(this,e),this._controls=null}return e.prototype.onResize=function(){},e.prototype.onUpdate=function(){this._controls&&(this._controls.update(this.app._deltaTime),this.app.needUpdate=!0)},e.prototype.onAdd=function(e){this.app=e,e.camera.inputEnabled=!1,this._controls||(this._controls=new THREE.FreeMouseControls(e.renderCamera),this._controls.movementSpeed=.25),this._controls.enabled=!0},e.prototype.onRemove=function(){this.app.camera.inputEnabled=!0,this._controls&&(this._controls.dispose(),this._controls.enabled=!1,this._controls=null)},e}(),Ai=function(){function e(t){I(this,e),this._controls=null,t=t||{},this.walkSpeed=void 0===t.walkSpeed?.02:t.walkSpeed,this.turnSpeed=void 0===t.turnSpeed?.25:t.turnSpeed,this.jumpSpeed=void 0===t.jumpSpeed?3:t.jumpSpeed,this.enableKeyRotate=void 0!==t.enableKeyRotate&&t.enableKeyRotate,this.useGravity=void 0===t.useGravity||t.useGravity,this.gravity=t.gravity?t.gravity:9.8,this.eyeHeight=void 0===t.eyeHeight?1.6:t.eyeHeight,this.groundObjects=void 0===t.groundObjects?void 0:t.groundObjects,this.useCollision=void 0!==t.useCollision&&t.useCollision,this.collisionObjects=void 0===t.collisionObjects?void 0:t.collisionObjects,this._downRaycaster=new THREE.Raycaster,this._downRaycaster.ray.direction.set(0,-1,0),this._forwardRaycaster=new THREE.Raycaster,this._fallSpeed=0,this._prevCameraAdjustNear=!1,this._jumpBind=function(e){32==e.keyCode&&this.jump()}.bind(this)}return e.prototype.onResize=function(){},e.prototype.onUpdate=function(){var e=this.app.renderCamera,t=!1;if(this.useCollision){this._forwardRaycaster.ray.origin.copy(e.position),this._forwardRaycaster.ray.origin.y-=this.eyeHeight/2;var r=this._controls.getMoveDirection();this._forwardRaycaster.ray.direction.copy(r).normalize(),(i=this._forwardRaycaster.intersectObjects(this.collisionObjects,!0)).length>0&&i[0].distance<.5&&(t=!0)}if(this._controls&&(this._controls.movementSpeed=t?0:this.walkSpeed,this._controls.rotateSpeed=this.turnSpeed,this._controls.enableKeyRotate=this.enableKeyRotate,this._controls.update(),this.app.needUpdate=!0),this.useGravity){this._downRaycaster.ray.origin.copy(e.position);var i=this._downRaycaster.intersectObjects(this.groundObjects,!0);if(i.length<1)this._fallSpeed+=.0166*this.gravity,e.position.y-=Math.min(.0166*this._fallSpeed,this.eyeHeight-.001);else{var n=i[0].distance;n<=this.eyeHeight&&this._fallSpeed>=0?(this._fallSpeed=0,e.position.y=e.position.y-n+this.eyeHeight):(this._fallSpeed+=.0166*this.gravity,e.position.y-=Math.min(.0166*this._fallSpeed,this.eyeHeight-.001))}}},e.prototype.onAdd=function(e){this.app=e,this._prevCameraAdjustNear=e.camera.autoAdjustNear,e.camera.autoAdjustNear=!1,e.camera.inputEnabled=!1,this._controls||(this._controls=new THREE.FreeMouseControls(e.renderCamera),this._controls.movementSpeed=this.walkSpeed,this._controls.rotateSpeed=this.turnSpeed,this._controls.enableFly=!1),this._controls.enabled=!0,this.groundObjects=this.groundObjects||[this.app.outdoors.node],this.collisionObjects=this.collisionObjects||[this.app.scene],window.addEventListener("keydown",this._jumpBind,!1)},e.prototype.onRemove=function(){var e=this.app;e.camera.inputEnabled=!0,this._controls&&(this._controls.dispose(),this._controls.enabled=!1,this._controls=null),this.groundObjects=null,this.collisionObjects=null,window.removeEventListener("keydown",this._jumpBind,!1),e.camera.autoAdjustNear=this._prevCameraAdjustNear},e.prototype.jump=function(){0==this._fallSpeed&&(this._fallSpeed-=this.jumpSpeed)},e}(),Ci=function(){function e(t){I(this,e),this._controls=null,t=t||{},this.walkSpeed=void 0===t.walkSpeed?.02:t.walkSpeed,this.turnSpeed=void 0===t.turnSpeed?.25:t.turnSpeed,this.jumpSpeed=void 0===t.jumpSpeed?3:t.jumpSpeed,this.enableKeyRotate=void 0!==t.enableKeyRotate&&t.enableKeyRotate,this.useGravity=void 0===t.useGravity||t.useGravity,this.gravity=t.gravity?t.gravity:9.8,this.eyeHeight=void 0===t.eyeHeight?1.6:t.eyeHeight,this.groundObjects=void 0===t.groundObjects?void 0:t.groundObjects,this.useCollision=void 0!==t.useCollision&&t.useCollision,this.collisionObjects=void 0===t.collisionObjects?void 0:t.collisionObjects,this._downRaycaster=new THREE.Raycaster,this._downRaycaster.ray.direction.set(0,-1,0),this._forwardRaycaster=new THREE.Raycaster,this._fallSpeed=0}return e.prototype.onResize=function(){},e.prototype.onUpdate=function(){var e=this.app.renderCamera,t=!1;if(this.useCollision){this._forwardRaycaster.ray.origin.copy(e.position),this._forwardRaycaster.ray.origin.y-=this.eyeHeight/2;var r=this._controls.getMoveDirection();this._forwardRaycaster.ray.direction.copy(r).normalize(),(i=this._forwardRaycaster.intersectObjects(this.collisionObjects,!0)).length>0&&i[0].distance<.5&&(t=!0)}if(this._controls&&(this._controls.movementSpeed=t?0:this.walkSpeed,this._controls.rotateSpeed=this.turnSpeed,this._controls.enableKeyRotate=this.enableKeyRotate,this._controls.update(),this.app.needUpdate=!0),this.useGravity){this._downRaycaster.ray.origin.copy(e.position);var i=this._downRaycaster.intersectObjects(this.groundObjects,!0);if(i.length<1)this._fallSpeed+=.0166*this.gravity,e.position.y-=Math.min(.0166*this._fallSpeed,this.eyeHeight-.001);else{var n=i[0].distance;n<=this.eyeHeight&&this._fallSpeed>=0?(this._fallSpeed=0,e.position.y=e.position.y-n+this.eyeHeight):(this._fallSpeed+=.0166*this.gravity,e.position.y-=Math.min(.0166*this._fallSpeed,this.eyeHeight-.001))}}},e.prototype.onAdd=function(e){this.app=e,e.camera.inputEnabled=!1,this._controls||(this._controls=new THREE.FreeControls(e.renderCamera),this._controls.movementSpeed=this.walkSpeed,this._controls.rotateSpeed=this.turnSpeed,this._controls.enableFly=!1,e.renderCamera.rotation.x=0),this._controls.enabled=!0,this.groundObjects=this.groundObjects||[this.app.outdoors.node],this.collisionObjects=this.collisionObjects||[this.app.scene],this._createWalkButton()},e.prototype.onRemove=function(){this.app.camera.inputEnabled=!0,this._controls&&(this._controls.enabled=!1,this._controls=null),this.groundObjects=null,this.collisionObjects=null,this._removeWalkButton()},e.prototype._jump=function(){0==this._fallSpeed&&(this._fallSpeed-=this.jumpSpeed)},e.prototype._setMoveState=function(e,t){this._controls&&(this._controls.moveState[e]=t,this._controls.updateMovementVector())},e.prototype._setRotate=function(e,t){this._controls&&this._controls.rotateDelta.set(e,t)},e.prototype._createWalkButton=function(){function e(e){var t=e.changedTouches[0].pageX,c=e.changedTouches[0].pageY,u=t-a,h=c-s,p=t-n,d=c-o,f=parseFloat(r.width)/2;if(r._getDistance(p,d)<=f)i.style.left=u+"px",i.style.top=h+"px";else{var m=r._getNewPos(f,r._getRadian(p,d));i.style.left=m[0]+n-a+"px",i.style.top=m[1]+o-s+"px"}(l=Math.abs(p)>Math.abs(d)?p>0?"right":"left":d>0?"back":"forward")!==r._moveState&&(r._setMoveState(r._moveState,0),r._setMoveState(l,1),r._moveState=l)}var t=this.app,r=this;if(!(t.domElement.getElementsByClassName("walkbutton").length>0)){this._walkButtonDom=t.domElement.appendChild(document.createElement("div")),this._walkButtonDom.className="walkbutton",this._walkButtonDom.style.cssText="position: absolute;right: 0;bottom: 0;width: 0;height: 0;border-radius: 50%;box-sizing: border-box;z-index: 1000;background: #f0f0f0;";var i=this._walkButtonDom.appendChild(document.createElement("div"));i.style.cssText="width: 46%;height: 46%;border-radius: 50%;overflow: hidden;position: absolute;top: 27%;left: 27%;border-radius: 50%;background: #003A9E;",this._resizeWalkButton();var n,o,a,s,l;r._moveState="",this._walkButtonDom.addEventListener("touchstart",function(t){t.preventDefault(),n=t.changedTouches[0].pageX,o=t.changedTouches[0].pageY,a=t.changedTouches[0].pageX-i.offsetLeft,s=t.changedTouches[0].pageY-i.offsetTop,document.body.addEventListener("touchmove",e,!1)}),document.addEventListener("touchend",function(){document.body.removeEventListener("touchmove",e,!1),i.style.left="27%",i.style.top="27%",r._setMoveState(r._moveState,0),r._moveState=""})}},e.prototype._removeWalkButton=function(){var e=this.app.domElement.getElementsByClassName("walkbutton");e.length>0&&e[0].parentNode.removeChild(e[0])},e.prototype._getDistance=function(e,t){return Math.sqrt(Math.pow(e,2)+Math.pow(t,2))},e.prototype._getRadian=function(e,t){return Math.atan2(t,e)},e.prototype._getNewPos=function(e,t){var r=[];return r.push(Math.cos(t)*e),r.push(Math.sin(t)*e),r},e.prototype._getwindowOrientation=function(){return 180==window.orientation||0==window.orientation||90!=window.orientation&&-90!=window.orientation&&void 0},e.prototype._resizeWalkButton=function(){this.width=this._getwindowOrientation()?.2*this.app.domElement.offsetWidth:.2*this.app.domElement.offsetHeight,this._walkButtonDom.style.width=this.width+"px",this._walkButtonDom.style.height=this.width+"px",this._walkButtonDom.style.right=.5*this.width+"px",this._walkButtonDom.style.bottom=.3*this.width+"px"},e}(),Li=function(){function e(t){I(this,e),this.parseParam(t),this._enable=!0,this.scene=new THREE.Scene,this.camera=null,this.sprite=null,this.raycaster=new THREE.Raycaster,this.mouse=new THREE.Vector2,this.ratio=2,this.mainAspect=1,this.miniDom=null,this.renderTarget=null,this.inited=!1,this.savedSecondaryLight=this.app.sceneManager.secondaryLight.intensity,this.savedMainLight=this.app.sceneManager.mainLight.intensity,this.savedAmbientLight=this.app.sceneManager.ambientLight.intensity,this.create()}return e.prototype.parseParam=function(e){this.app=e.app,this._opacity=e.opacity||.7,this._posIndex=e.position||["posIndex"]||0,this.bIcon=e.bIcon||!0,this.width=e.width||150,this.height=e.height||150,this._scale=e.scale||1,this.center={};var t=this.app.root.box,r=(t.max.x+t.min.x)/2,i=(t.max.z+t.min.z)/2;if(e.sceneCenter?(this.center.x=e.sceneCenter[0],this.center.y=e.sceneCenter[1]):e.center?(this.center.x=e.center[0],this.center.y=e.center[1]):(this.center.x=r,this.center.y=i),this.angle=e.angle||0,this.canMoushWheel=e.mousewheel,this.ground=e.ground,!this.ground)for(var n=0;n<this.app.root.campuses.length;n++){var o=this.app.root.campuses[n].outdoors;if(o){this.ground=o.node.children;break}}},e.prototype.init2d=function(){function e(){n.raycaster.setFromCamera(n.mouse,n.camera);var e=n.raycaster.intersectObjects(n.ground);if(e.length>0){var t=e[0].point;n.app.camera.lookAt([t.x,t.y,t.z])}}if(this.miniDom=this.app.domElement.appendChild(document.createElement("div")),this.miniDom.className="minimap",this.miniDom.style.position="absolute",this.miniDom.style.cssText="position: absolute;width:"+this.width+";height:"+this.height+";border: 5px solid rgba(255, 255, 255, 0.8);border-radius: 3px;display: block;box-sizing: border-box;overflow:hidden",this.miniDom.style.zIndex=1e3,this.hasClose){var t=this.miniDom.appendChild(document.createElement("img"));t.className="minimap_closeBtn",t.style.position="absolute",t.style.width=this.width/5,t.style.right="1px",t.style.top="1px",t.src="https://speech.uinnova.com/static/wangsai/images/closeBtn.png",n=this,t.addEventListener("click",function(){close=!0,n.enable=!1})}var r=this.miniDom.appendChild(document.createElement("img"));r.className="minimap_cameraView",r.style.position="absolute",r.src="https://speech.uinnova.com/static/wangsai/images/cameraView.png";var i=this.miniDom.appendChild(document.createElement("img"));i.className="minimap_cameraCenter",i.src="https://speech.uinnova.com/static/wangsai/images/cameraCenter.png",r.style.width="40px",r.style.height="30px",this.miniDom.onmousedown=function(e){var t=e||event;t.cancelBubble=!0,t.stopPropagation()},this.miniDom.onmousemove=function(e){var t=e||event;t.cancelBubble=!0,t.stopPropagation()},this.miniDom.onmousewheel=function(e){var t=e||event;t.cancelBubble=!0,t.stopPropagation()},this.canMoushWheel&&this.miniDom.addEventListener("mousewheel",function(e){n.scale+=e.wheelDelta>0?.1:-.1},!1),this.miniDom.addEventListener("mousedown",function(t){0===t.button&&(n.mouse.x=t.clientX/(n.miniDom.clientWidth+10)*2-1,n.mouse.y=-t.clientY/(n.miniDom.clientWidth+10)*2+1,e(),n.miniDom.onmousemove=function(t){n.mouse.x=t.clientX/(n.miniDom.clientWidth+10)*2-1,n.mouse.y=-t.clientY/(n.miniDom.clientWidth+10)*2+1,e()},n.miniDom.onmouseup=function(){n.miniDom.onmousemove=null,n.miniDom.onmouseup=null})},!1);var n=this},e.prototype.init3d=function(){this.init2d();var e=this.app.root.box,t=e.max.x>e.max.z?e.max.x:e.max.z,r=Math.abs(e.min.x)>Math.abs(e.min.z)?Math.abs(e.min.x):Math.abs(e.min.z),i=t>r?t:r;i*=1/this.scale,this.camera=new THREE.OrthographicCamera(-i,i,i,-i,-1e4,1e4),this.camera.position.set(this.center.x,100,this.center.y),this.camera.up=new THREE.Vector3(0,0,-1).applyEuler(new THREE.Euler(0,this.angle*Math.PI/180,0,"XYZ")),this.camera.lookAt(new THREE.Vector3(this.center.x,-1,this.center.y));var n=this.app.domElement;this.mainAspect=n.clientWidth/n.clientHeight,this.ratio=n.clientWidth/i;var o=i,a=i*this.mainAspect,s=8*o<256?8*o:256,l=8*a<256*this.mainAspect?8*o:256*this.mainAspect;this.renderTarget=new THREE.WebGLRenderTarget(s,l,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,generateMipmaps:!1,format:THREE.RGBAFormat});var c=new THREE.SpriteMaterial({map:this.renderTarget.texture,overdraw:!1,transparent:!0,opacity:this._opacity});this.sprite=new THREE.Sprite(c),this.setMiniRect(),this.update();var u=this;window.onresize=function(){u.mainAspect=n.clientWidth/n.clientHeight,u.ratio=n.clientWidth/i,u.setMiniRect()},this.inited=!0},e.prototype.create=function(){this.inited||(this.init3d(),this.scene.add(this.camera),this.camera.add(this.sprite))},e.prototype.setMiniRect=function(){function e(e,r,i,n){t.miniDom.style.top=e,t.miniDom.style.left=r,t.miniDom.style.bottom=i,t.miniDom.style.right=n}this.miniDom.style.width=this.width+"px",this.miniDom.style.height=this.height+"px";var t=this,r=this.width/(.5*this.ratio),i=r*this.mainAspect;this.sprite.scale.set(r,i,1);var n,o,a=this.camera.right,s=this.camera.left;switch(this._posIndex){case 0:n=s+r/2,o=s+i/2,e("0px","0px",null,null);break;case 2:n=s+r/2,o=a-i/2,e(null,"0px","0px",null);break;case 1:n=a-r/2,o=s+i/2,e("0px",null,null,"0px");break;case 3:n=a-r/2,o=a-i/2,e(null,null,"0px","0px")}this.sprite.position.set(n,-o,0)},e.prototype.update=function(){this.app.sceneManager.mainLight.intensity=0,this.app.sceneManager.secondaryLight.intensity=0;var e=this.app.scene.background;this.app.scene.background=null,this.app.renderer.setClearColor(0,0),this.app.renderer.render(this.app.scene,this.camera,this.renderTarget,!0),this.app.sceneManager.secondaryLight.intensity=this.savedSecondaryLight,this.app.sceneManager.mainLight.intensity=this.savedMainLight,this.app.scene.background=e},e.prototype.destroy=function(){var e=this.scene.children.length;if(0!=e){if(e>0)for(var t=0;t<e;t++)this.scene.remove(this.scene.children[t]);this.camera=null,this.sprite=null,null!=this.miniDom&&(this.app.domElement.removeChild(this.miniDom),this.miniDom=null)}},e.prototype.render=function(){if(this.miniDom)if(this._enable){this.miniDom.style.display="block";var e=this;if(this.miniDom.childNodes.forEach(function(t){t.style.display=e.bIcon?"block":"none"}),null!=this.camera&&null!=this.renderTarget){var t=this.app.renderer.autoClear;this.app.renderer.autoClear=!1,this.app.renderer.render(this.scene,this.camera),this.app.renderer.autoClear=t;var r=this.app.camera.position,i=new THREE.Vector3(r[0],r[1],r[2]);if(0!=this.angle){var n=new THREE.Vector3(this.center.x,i.y,this.center.y),o=i.sub(n);o.applyEuler(new THREE.Euler(0,-this.angle*Math.PI/180,0,"XYZ")),o.add(n),i.copy(o)}var a=this.transToMinimapCoord(i).x,s=this.transToMinimapCoord(i).y;this.setImage(a,s,this.app.camera.position[1]);var l=this.app.camera.camera.rotation._z,c=(document.getElementsByClassName("minimap_cameraCenter")[0],document.getElementsByClassName("minimap_cameraView")[0]),u=0;u=l>=0?l/Math.PI*180:180*(2-Math.abs(l)/Math.PI),c.style.transform="rotate("+(-u+this.angle)+"deg)",c.style.transformOrigin="50% 100%"}}else this.miniDom.style.display="none"},e.prototype.transToMinimapCoord=function(e){var t,r;r=t=this.width/2;var i,n,o=t/((this.camera.right-this.camera.left)/2);return e.hasOwnProperty("x")?(i=e.x-this.center.x,n=e.z-this.center.y):(i=e[0]-this.center.x,n=e[2]-this.center.y),{x:i>=0?t-o*i:t+o*Math.abs(i),y:n>=0?r-o*n:r+o*Math.abs(n)}},e.prototype.setImage=function(e,t,r){var i,n=(i=r>80?r-80:0)*(1/(220/30))+15;n>30&&(n=30);var o=document.getElementsByClassName("minimap_cameraCenter")[0],a=document.getElementsByClassName("minimap_cameraView")[0],s=n;e>=n/2&&e<=this.width-n/2&&t>=n/2&&this.width,o.style.position="absolute",o.style.width=n+"px",o.style.height=s+"px",o.style.right=e-n/2+"px",o.style.bottom=t-s+"px",a.style.right=e-20+"px",a.style.bottom=t-s/2+"px"},k(e,[{key:"scale",set:function(e){this._scale=e,this.destroy(),this.inited=!1,this.create()},get:function(){return this._scale}},{key:"opacity",set:function(e){this._opacity=e,this.sprite.material.opacity=this._opacity},get:function(){return this._opacity}},{key:"posIndex",set:function(e){this._posIndex=e,this.setMiniRect()},get:function(){return this._posIndex}},{key:"enable",set:function(e){this._enable=e},get:function(){return this._enable}}]),e}(),Oi=function(){function e(t){I(this,e),this.minimap=null,this.param=t}return e.prototype.onAdd=function(e){null!=this.minimap&&this.onRemove(),this.param.app||(this.param.app=e),this.minimap=new Li(this.param)},e.prototype.onRemove=function(){this.minimap&&this.minimap.destroy()},e.prototype.onUpdate=function(){this.minimap&&this.minimap.render()},e}(),Hi=[1,1,1],Fi={id:"1",name:"a",visible:!0,position:Hi},Ii={buildings:{id:"1",name:"a",visible:!0,position:Hi,floors:{id:"1",name:"a",visible:!0,levelNum:0,things:Fi,position:Hi}},outdoor:{id:"1",name:"a",visible:!0,size:Hi,position:Hi,things:Fi},camera:{target:Hi,position:Hi}},ki={buildings:"buildings","buildings.id":"buildings.id","buildings.name":"buildings.name","buildings.center":"buildings.center","buildings.visible":"buildings.visible","buildings.position":"buildings.position","buildings.floors":"buildings.floors","buildings.floors.id":"buildings.floors.id","buildings.floors.name":"buildings.floors.name","buildings.floors.levelNum":"buildings.floors.levelNum","buildings.floors.center":"buildings.floors.center","buildings.floors.visible":"buildings.floors.visible","buildings.floors.things":"buildings.floors.things","buildings.floors.position":"buildings.floors.position","buildings.floors.things.id":"buildings.floors.things.id","buildings.floors.things.name":"buildings.floors.things.name","buildings.floors.things.center":"buildings.floors.things.center","buildings.floors.things.visible":"buildings.floors.things.visible","buildings.floors.things.position":"buildings.floors.things.position",outdoor:"outdoors","outdoor.id":"outdoors.id","outdoor.name":"outdoors.name","outdoor.visible":"outdoors.visible","outdoor.position":"outdoors.position","outdoor.things":"outdoors.things","outdoor.things.id":"outdoors.things.id","outdoor.things.name":"outdoors.things.name","outdoor.things.center":"outdoors.things.center","outdoor.things.visible":"outdoors.things.visible","outdoor.things.position":"outdoors.things.position",camera:"camera","camera.target":"camera.target","camera.position":"camera.position"},Di={},Ni={};e.REVISION="c0f8b3e9c64890524247ce830fb5a346bd50197fno",e.VERSION="1.2.4.1",e.App=mi,e.BaseObject=ye,e.Ground=je,e.Facade=be,e.Building=ct,e.Floor=dt,e.Room=gt,e.Thing=_e,e.Box=Re,e.Circle=Se,e.Sphere=Pe,e.Plane=Ae,e.Grid=Ce,e.Cylinder=Le,e.Tetrahedron=Oe,e.Shape=He,e.Door=Fe,e.ElevatorDoor=Ie,e.Elevator=ke,e.StairDoor=De,e.Stair=Ne,e.Line=Lt,e.PolygonLine=Ht,e.RouteLine=Ot,e.Water=er,e.WebView=ar,e.TextRegion=vt,e.Region=Et,e.PolygonRegion=bt,e.Marker=or,e.Campus=at,e.CameraController=Qr,e.Selector=Y,e.factory=hr,e.Helper=Ti,e.CompassControl=Si,e.FlyControl=Pi,e.WalkControl=Ai,e.WalkButtonControl=Ci,e.MiniMapControl=Oi,e.AxisTransformControl=ai,e.Utils=G,e.math=J,e.LerpType=ae,e.CornerType=se,e.SpaceType=le,e.CameraProjectionType=ne,e.CameraView=oe,e.DistributionsType={Box:1,Sphere:2,Disc:3},e.BlendingType=ce,e.WrapType={Repeat:"repeat",ClampToEdge:"clamptoedge",MirroredRepeat:"mirroredrepeat"},e.LoopType=he,e.DragState=ue,e.AreaPickType=pe,e.SkyBox={BlueSky:"BlueSky",MilkyWay:"MilkyWay",Night:"Night",SunCloud:"SunCloud"},e.IndependentControlType=de,e.LevelType=fe,e.KeyType=me,e.EventTag=ge,e.EventType=ve,e.DEFAULT_EXTENSIONS=fi,e.upupdate=Z,e.app_key=void 0,e.createObj=C,e.createPath=A,e.getPath=P,e.deletPath=function(e,t){var r=t.split(".");if(!(r.length<2)){var i=r[r.length-1];if(M(r[r.length-2])){var n=P(e,t,1);if(void 0!=n&&G.isArray(n))for(var o=0;o<n.length;o++)if(n[o][UID]==i){n.splice(o,1);break}}}},e.tranPath=S,e.appWrite=!1,e.treeConf=Ii,e.tranTree=ki,Object.defineProperty(e,"__esModule",{value:!0})});var THING=t3d;